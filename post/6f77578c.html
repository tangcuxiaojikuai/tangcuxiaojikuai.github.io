<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="赛题记录">
<meta property="og:type" content="article">
<meta property="og:title" content="2023-极客大挑战-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/6f77578c.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="赛题记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/6f77578c/image-20231107181701914.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/6f77578c/image-20231107183752038.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/6f77578c/image-20231107184055983.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/6f77578c/image-20231107184230427.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/6f77578c/image-20231107184344112.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/6f77578c/image-20231107184441636.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/6f77578c/image-20231107191309019.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/6f77578c/image-20231107194348306.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/6f77578c/image-20231107195806843.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/6f77578c/image-20231113142925845.png">
<meta property="article:published_time" content="2023-11-28T10:13:46.000Z">
<meta property="article:modified_time" content="2023-11-28T11:58:08.000Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tangcuxiaojikuai.xyz/post/6f77578c/image-20231107181701914.png">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/6f77578c.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2023-极客大挑战-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/6f77578c.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2023-极客大挑战-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-11-28 18:13:46 / 修改时间：19:58:08" itemprop="dateCreated datePublished" datetime="2023-11-28T18:13:46+08:00">2023-11-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/6f77578c.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/6f77578c.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>赛题记录</p>
<span id="more"></span>
<h2 id="Week-1"><a href="#Week-1" class="headerlink" title="Week 1"></a>Week 1</h2><h3 id="SignIn"><a href="#SignIn" class="headerlink" title="SignIn"></a>SignIn</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Bibo...Hello! 你好! こんにちは! Привет!</span><br><span class="line">5359437b48656c6c6f5f576f726c645f43727970746f5f6269626f6269626f7d…  Hmm... Something goes wrong with my grettings bot.</span><br></pre></td></tr></table></figure>
<p>十六进制解码即可。</p>
<p><img src="/post/6f77578c/image-20231107181701914.png" alt="image-20231107181701914"></p>
<p><br></p>
<p><br></p>
<h3 id="proof-of-work"><a href="#proof-of-work" class="headerlink" title="proof_of_work"></a>proof_of_work</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 59.110.20.54:5526 Build your own function to solve proof_of_work!</span><br></pre></td></tr></table></figure>
<p>确实是过个proof就送。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode,b64encode</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">	table = string.digits + string.ascii_letters</span><br><span class="line">	temp = r.recvuntil(<span class="string">b&quot;sha256(XXXX+&quot;</span>)</span><br><span class="line">	temp = r.recvline()</span><br><span class="line">	suffix = temp[:<span class="number">16</span>].decode()</span><br><span class="line">	hex1 = temp[<span class="number">20</span>:].strip().decode()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> tqdm(table):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> table:</span><br><span class="line">				<span class="keyword">for</span> m <span class="keyword">in</span> table:</span><br><span class="line">					temp1 = i+j+k+m</span><br><span class="line">					<span class="keyword">if</span>(sha256((temp1+suffix).encode()).hexdigest() == hex1):</span><br><span class="line">						r.sendline(temp1.encode())</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>, <span class="number">5526</span>)</span><br><span class="line">proof_of_work()</span><br><span class="line">r.recvline()</span><br><span class="line"><span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;st3p_1nt0_1nter4ctive_Crypt0graphy&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="SimpleRSA"><a href="#SimpleRSA" class="headerlink" title="SimpleRSA"></a>SimpleRSA</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">So simple RSA! Wait... Are you kidding me? https://en.wikipedia.org/wiki/RSA_(cryptosystem) </span><br><span class="line">hint: flag&lt;p</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">35</span></span><br><span class="line">p,q = [getPrime(<span class="number">2048</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;__&quot;</span>] </span><br><span class="line">n = p*q </span><br><span class="line">e = <span class="number">65537</span> </span><br><span class="line">c = gmpy2.powmod(bytes_to_long(flag),e,n) </span><br><span class="line"><span class="built_in">print</span>(p) </span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="comment">#24724324630507415330944861660078769085865178656494256140070836181271808964994457686409910764936630391300708451701526900994412268365698217113884698394658886249353179639767806926527103624836198494439742123128823109527320850165486500517304731554371680236789357527395416607541627295126502440202040826686102479225702795427693781581584928770373613126894936500089282093366117940069743670997994742595407158340397268147325612840109162997306902492023078425623839297511182053658542877738887677835528624045235391227122453939459585542485427063193993069301141720316104612551340923656979591045138487394366671477460626997125944456537</span></span><br><span class="line"><span class="comment">#510345661718450375632304764819724223824018609359964259503762283253350010161515190912152623604019093266967095847334388281390406831587663253164256543905694021952211220652820225527413861208452760215767828927039893435528572148282529198773772864255061213208279999011194952146362748485103032149806538140693537361755210176698895104708379400806511907719904867068865970241208806615061055047254026118016836750283966478103987375361826198930529462261013324904522014804502582865716441828895047550041401172127129749969507853355531197814919603963664646220505672302543085959372679395717892060245461464861507164276442140407308832537707450729432224150754603518526288767105682399190438680085925078051459448618725871249563011864525585870188123725554411655044152994826056900502298772802133526591794328224932405680583757307064395792317383571866619582974377344736930271554160701478385763426091091686496788999588340419226785217028504684542197970387916262126278955278523452903043316452825738030645100271595942652498852506660789605846309602343932245435421425673058238785509280366229754404949219663043627431437755087855502139890639468481922788973821783957766433857773771229298328019250652625289700950165414584983487319078090573179470893450632419467111117341472</span></span><br></pre></td></tr></table></figure>
<p>用p解密就好。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">p = <span class="number">24724324630507415330944861660078769085865178656494256140070836181271808964994457686409910764936630391300708451701526900994412268365698217113884698394658886249353179639767806926527103624836198494439742123128823109527320850165486500517304731554371680236789357527395416607541627295126502440202040826686102479225702795427693781581584928770373613126894936500089282093366117940069743670997994742595407158340397268147325612840109162997306902492023078425623839297511182053658542877738887677835528624045235391227122453939459585542485427063193993069301141720316104612551340923656979591045138487394366671477460626997125944456537</span></span><br><span class="line">c = <span class="number">510345661718450375632304764819724223824018609359964259503762283253350010161515190912152623604019093266967095847334388281390406831587663253164256543905694021952211220652820225527413861208452760215767828927039893435528572148282529198773772864255061213208279999011194952146362748485103032149806538140693537361755210176698895104708379400806511907719904867068865970241208806615061055047254026118016836750283966478103987375361826198930529462261013324904522014804502582865716441828895047550041401172127129749969507853355531197814919603963664646220505672302543085959372679395717892060245461464861507164276442140407308832537707450729432224150754603518526288767105682399190438680085925078051459448618725871249563011864525585870188123725554411655044152994826056900502298772802133526591794328224932405680583757307064395792317383571866619582974377344736930271554160701478385763426091091686496788999588340419226785217028504684542197970387916262126278955278523452903043316452825738030645100271595942652498852506660789605846309602343932245435421425673058238785509280366229754404949219663043627431437755087855502139890639468481922788973821783957766433857773771229298328019250652625289700950165414584983487319078090573179470893450632419467111117341472</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = inverse(e,p-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,p)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;Just_a_s1mple_modular_equation&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="OTPTwice"><a href="#OTPTwice" class="headerlink" title="OTPTwice"></a>OTPTwice</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I invented a new symmetric cryptosystem, and I believe you will never break it!</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor </span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># step0: key generation &amp; distribution</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s0</span>(<span class="params">msg</span>): </span><br><span class="line">    k1,k2 = [urandom(<span class="built_in">len</span>(msg)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;__&quot;</span>] </span><br><span class="line">    <span class="keyword">return</span> k1,k2 </span><br><span class="line"></span><br><span class="line"><span class="comment">#  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># step1: Alice encrypt M, and send it to Bob</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s1</span>(<span class="params">msg,k1</span>):</span><br><span class="line">    c1 = xor(msg,k1)</span><br><span class="line">    <span class="keyword">return</span> c1 </span><br><span class="line"></span><br><span class="line"><span class="comment"># step2: Bob encrypt c1, and send it to Alice </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s2</span>(<span class="params">msg,k2</span>):</span><br><span class="line">    c2 = xor(msg,k2) </span><br><span class="line">    <span class="keyword">return</span> c2 </span><br><span class="line"></span><br><span class="line"><span class="comment"># step3: Alice decrypt c2, and send it to Bob.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s3</span>(<span class="params">msg,k1</span>):</span><br><span class="line">    c3 = xor(msg,k1)</span><br><span class="line">    <span class="keyword">return</span> c3 </span><br><span class="line"></span><br><span class="line"><span class="comment"># step4: Bob decrypt c3, get M.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s4</span>(<span class="params">msg,k2</span>):</span><br><span class="line">    m_ = xor(msg,k2) </span><br><span class="line">    <span class="keyword">return</span> m_ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg,k1,k2</span>): </span><br><span class="line">    c1 = s1(msg,k1) </span><br><span class="line">    c2 = s2(c1,k2) </span><br><span class="line">    c3 = s3(c2,k1)</span><br><span class="line">    m_ = s4(c3,k2) </span><br><span class="line">    <span class="keyword">assert</span> msg == m_</span><br><span class="line"></span><br><span class="line"><span class="comment"># Here&#x27;s what hacker Eve got:</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_</span>(<span class="params">msg,k1,k2</span>):</span><br><span class="line">    c1 = s1(msg,k1) </span><br><span class="line">    c2 = s2(c1,k2) </span><br><span class="line">    c3 = s3(c2,k1)</span><br><span class="line">    m_ = s4(c3,k2) </span><br><span class="line">    <span class="keyword">if</span> HACK == <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(c1) </span><br><span class="line">        <span class="built_in">print</span>(c2) </span><br><span class="line">        <span class="built_in">print</span>(c3) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k1,k2 = s0(flag) </span><br><span class="line">encrypt_(flag,k1,k2) </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xdbi\xab\x8d\xfb0\xd3\xfe!\xf8Xpy\x80w\x8c\x87\xb9&#x27;</span></span><br><span class="line"><span class="string">b&#x27;o\xb0%\xfb\xdb\x0e\r\x04\xde\xd1\x9a\x08w\xda4\x0f\x0cR&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xe7\x80\xcd\ria\xb2\xca\x89\x1a\x9d;|#3\xf7\xbb\x96&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>题目看着比较长，但是其实几个函数功能都是重复的，均为异或操作。提取一下其实也就有：</p>
<script type="math/tex; mode=display">
c_1 = flag \oplus k_1</script><script type="math/tex; mode=display">
c_2 = c_1 \oplus k_2 =flag \oplus k_1 \oplus k_2</script><script type="math/tex; mode=display">
c_3 = c_2 \oplus k_1 = flag \oplus k_1 \oplus k_2 \oplus k_1 = flag \oplus k_2</script><p>那么就有：</p>
<script type="math/tex; mode=display">
c_2 \oplus c_1 = k_2</script><script type="math/tex; mode=display">
c_2 \oplus c_3 = k_1</script><script type="math/tex; mode=display">
flag = c_1 \oplus c_2 \oplus c_3</script><p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor </span><br><span class="line"></span><br><span class="line">c1 = <span class="string">b&#x27;\xdbi\xab\x8d\xfb0\xd3\xfe!\xf8Xpy\x80w\x8c\x87\xb9&#x27;</span></span><br><span class="line">c2 = <span class="string">b&#x27;o\xb0%\xfb\xdb\x0e\r\x04\xde\xd1\x9a\x08w\xda4\x0f\x0cR&#x27;</span></span><br><span class="line">c3 = <span class="string">b&#x27;\xe7\x80\xcd\ria\xb2\xca\x89\x1a\x9d;|#3\xf7\xbb\x96&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = xor(c1,xor(c2,c3))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;I_l0v3_Crypt0&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="OldAlgorithm"><a href="#OldAlgorithm" class="headerlink" title="OldAlgorithm"></a>OldAlgorithm</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">An old algorithm but widely used nowadays.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">pad = <span class="keyword">lambda</span> msg,padlen: msg+os.urandom(padlen-<span class="built_in">len</span>(msg))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = pad(flag,<span class="number">32</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(flag))</span><br><span class="line">p = [getPrime(<span class="number">16</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)] </span><br><span class="line">c = [bytes_to_long(flag)%i <span class="keyword">for</span> i <span class="keyword">in</span> p] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p=&#x27;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c=&#x27;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p= [58657, 47093, 47963, 41213, 57653, 56923, 41809, 49639, 44417, 38639, 39857, 53609, 55621, 41729, 60497, 44647, 39703, 55117, 44111, 57131, 37747, 63419, 63703, 64007, 46349, 39241, 39313, 44909, 40763, 46727, 34057, 56333]</span></span><br><span class="line"><span class="string">c= [36086, 4005, 3350, 23179, 34246, 5145, 32490, 16348, 13001, 13628, 7742, 46317, 50824, 23718, 32995, 7640, 10590, 46897, 39245, 16633, 31488, 36547, 42136, 52782, 31929, 34747, 29026, 18748, 6634, 9700, 8126, 5197]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>标题指的就是CRT。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">p= [<span class="number">58657</span>, <span class="number">47093</span>, <span class="number">47963</span>, <span class="number">41213</span>, <span class="number">57653</span>, <span class="number">56923</span>, <span class="number">41809</span>, <span class="number">49639</span>, <span class="number">44417</span>, <span class="number">38639</span>, <span class="number">39857</span>, <span class="number">53609</span>, <span class="number">55621</span>, <span class="number">41729</span>, <span class="number">60497</span>, <span class="number">44647</span>, <span class="number">39703</span>, <span class="number">55117</span>, <span class="number">44111</span>, <span class="number">57131</span>, <span class="number">37747</span>, <span class="number">63419</span>, <span class="number">63703</span>, <span class="number">64007</span>, <span class="number">46349</span>, <span class="number">39241</span>, <span class="number">39313</span>, <span class="number">44909</span>, <span class="number">40763</span>, <span class="number">46727</span>, <span class="number">34057</span>, <span class="number">56333</span>]</span><br><span class="line">c= [<span class="number">36086</span>, <span class="number">4005</span>, <span class="number">3350</span>, <span class="number">23179</span>, <span class="number">34246</span>, <span class="number">5145</span>, <span class="number">32490</span>, <span class="number">16348</span>, <span class="number">13001</span>, <span class="number">13628</span>, <span class="number">7742</span>, <span class="number">46317</span>, <span class="number">50824</span>, <span class="number">23718</span>, <span class="number">32995</span>, <span class="number">7640</span>, <span class="number">10590</span>, <span class="number">46897</span>, <span class="number">39245</span>, <span class="number">16633</span>, <span class="number">31488</span>, <span class="number">36547</span>, <span class="number">42136</span>, <span class="number">52782</span>, <span class="number">31929</span>, <span class="number">34747</span>, <span class="number">29026</span>, <span class="number">18748</span>, <span class="number">6634</span>, <span class="number">9700</span>, <span class="number">8126</span>, <span class="number">5197</span>]</span><br><span class="line"></span><br><span class="line">m = crt(p,c)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;CRT_1s_s0_ju1cy!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="easy-classic"><a href="#easy-classic" class="headerlink" title="easy_classic"></a>easy_classic</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">非常好套娃，使我的古典旋转</span><br></pre></td></tr></table></figure>
<p>几层密码及对应解密分别如下</p>
<h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">udzeojxuwqcu</span><br></pre></td></tr></table></figure>
<p><img src="/post/6f77578c/image-20231107183752038.png" alt="image-20231107183752038"></p>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ialhhooavtepcyr</span><br></pre></td></tr></table></figure>
<p>一眼就看出来是ilovecryptohaha，估计是个W型栅栏之类，反正是个置换密码。</p>
<h4 id="3"><a href="#3" class="headerlink" title="3"></a>3</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5a6H5a6Z5LiH5rOV55qE6YKj5Liq5rqQ5aS0</span><br></pre></td></tr></table></figure>
<p>base64</p>
<p><img src="/post/6f77578c/image-20231107184055983.png" alt="image-20231107184055983"></p>
<h4 id="4"><a href="#4" class="headerlink" title="4"></a>4</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">熊曰：呋食食食取噗山笨笨破嗄咯哈動嗡雜類嗒嘿啽沒歡破吖咬我啽寶盜噔咯沒</span><br></pre></td></tr></table></figure>
<p>开始以为是兽音，搜了才知道居然还有与熊论道加密，在线解密网址如下：</p>
<p><a target="_blank" rel="noopener" href="http://hi.pcmoe.net/">与熊论道/熊曰加密 - PcMoe!</a></p>
<p><img src="/post/6f77578c/image-20231107184230427.png" alt="image-20231107184230427"></p>
<h4 id="5"><a href="#5" class="headerlink" title="5"></a>5</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password: adltlfltqrcy</span><br><span class="line">key: 👝👘👠👩👞👘👤👜</span><br></pre></td></tr></table></figure>
<p>key用emoji解密得到：fairgame</p>
<p><img src="/post/6f77578c/image-20231107184344112.png" alt="image-20231107184344112"></p>
<p>显然是个提示，用playfair密码解。</p>
<p><img src="/post/6f77578c/image-20231107184441636.png" alt="image-20231107184441636"></p>
<p>最终得到flag：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SYC&#123;classical_1s_fun&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<p><br></p>
<h2 id="Week-2"><a href="#Week-2" class="headerlink" title="Week 2"></a>Week 2</h2><h3 id="PolyRSA"><a href="#PolyRSA" class="headerlink" title="PolyRSA"></a>PolyRSA</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Harder RSA. Check it out!</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *  </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span></span><br><span class="line">p,q = [getPrime(<span class="number">2048</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;__&quot;</span>] </span><br><span class="line">e1,e2 = [getPrime(<span class="number">17</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;__&quot;</span>] </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = p*q </span><br><span class="line">c1 = gmpy2.powmod(<span class="number">2</span>*p + <span class="number">3</span>*q,e1,n)</span><br><span class="line">c2 = gmpy2.powmod(<span class="number">5</span>*p + <span class="number">7</span>*q,e2,n) </span><br><span class="line">c = gmpy2.powmod(bytes_to_long(flag),e,n) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e1=&quot;</span>,e1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e2=&quot;</span>,e2) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c1=&quot;</span>,c1) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c2=&quot;</span>,c2) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span>,n)</span><br><span class="line"></span><br><span class="line"><span class="comment">#e1= 113717</span></span><br><span class="line"><span class="comment">#e2= 80737</span></span><br><span class="line"><span class="comment">#c1= 97528398828294138945371018405777243725957112272614466238005409057342884425132214761228537249844134865481148636534134025535106624840957740753950100180978607132333109806554009969378392835952544552269685553539656827070349532458156758965322477969141073720173165958341043159560928836304172136610929023123638981560836183245954461041167802574206323129671965436040047358250847178930436773249800969192016749684095882580749559014647942135761757750292281205876241566597813517452803933496218995755905344070203047797893640399372627351254542342772576533524820435965479881620338366838326652599102311019884528903481310690767832417584600334987458835108576322111553947045733143836419313427495888019352323209000292825566986863770366023326755116931788018138432898323148059980463407567431417724940484236335082696026821105627826117901730695680967455710434307270501190258033004471156993017301443803372029004817834317756597444195146024630164820841200575179112295902020141040090350486764038633257871003899386340004440642516190842086462237559715130631205046041819931656962904630367121414263911179041905140516402771368603623318492074423223885367923228718341206283572152570049573607906130786276734660847733952210105659707746969830132429975090175091281363770357</span></span><br><span class="line"><span class="comment">#c2= 353128571201645377052005694809874806643786163076931670184196149901625274899734977100920488129375537186771931435883114557320913415191396857882995726660784707377672210953334914418470453787964899846194872721616628198368241044602144880543115393715025896206210152190007408112767478800650578941849344868081146624444817544806046188600685873402369145450593575618922226415069043442295774369567389939040265656574664538667552522329712111984168798829635080641332045614585247317991581514218486004191829362787750803153463482021229058714990823658655863245025037102127138472397462755776598314247771125981017814912049441827643898478473451005083533693951329544115861795587564408860828213753948427321483082041546722974666875065831843384005041800692983406353922680299538080900818930589336142421748023025830846906503542594380663429947801329079870530727382679634952272644949425079242992486832995962516376820051495641486546631849426876810933393153871774796182078367277299340503872124124714036499367887886486264658590613431293656417255355575602576047502506125375605713228912611320198066713358654181533335650785578352716562937038768171269136647529849805172492594142026261051266577821582011917001752590659862613307646536049830151262848916867223615064832279222</span></span><br><span class="line"><span class="comment">#c= 375617816311787295279632219241669262704366237192565344884527300748210925539528834207344757670998995567820735715933908541800125317082581328287816628816752542104514363629022246620070560324071543077301256917337165566677142545053272381990573611757629429857842709092285442319141751484248315990593292618113678910350875156232952525787082482638460259354559904243062546518553607882194808191571131590524874275187750985821420412987586148770397073003186510357920710387377990379862185266175190503647626248057084923516190642292152259727446111686043531725993433395002330208067534104745851308178560234372373476331387737629284961288204368572750848248186692623500372605736825205759172773503283282321274793846281079650686871355211691681512637459986684769598186821524093789286661348936784712071312135814683041839882338235290487868969391040389837253093468883093296547473466050960563347060307256735803099039921213839491129726807647623542881247210251994139130146519265086673883077644185971830004165931626986486648581644383717994174627681147696341976767364316172091139507445131410662391699728189797082878876950386933926807186382619331901457205957462337191923354433435013338037399565519987793880572723211669459895193009710035003369626116024630678400746946356</span></span><br><span class="line"><span class="comment">#n= 728002565949733279371529990942440022467681592757835980552797682116929657292509059813629423038094227544032071413317330087468458736175902373398210691802243764786251764982802000867437756347830992118278032311046807282193498960587170291978547754942295932606784354258945168927044376692224049202979158068158842475322825884209352566494900083765571037783472505580851500043517614314755340168507097558967372661966013776090657685241689631615245294004694287660685274079979318342939473469143729494106686592347327776078649315612768988028622890242005700892937828732613800620455225438339852445425046832904615827786856105112781009995862999853122308496903885748394541643702103368974605177097553007573113536089894913967154637055293769061726082740854619536748297829779639633209710676774371525146758917646731487495135734759201537358734170552231657257498090553682791418003138924472103077035355223367678622115314235119493397080290540006942708439607767313672671274857069053688258983103863067394473084183472609906612056828326916114024662795812611685559034285371151973580240723680736227737324052391721149957542711415812665358477474058103338801398214688403784213100455466705770532894531602252798634923125974783427678469124261634518543957766622712661056594132089</span></span><br></pre></td></tr></table></figure>
<p>题目给了密文以及如下两个信息。要求分解n还原明文：</p>
<script type="math/tex; mode=display">
c_1 = (2p+3q)^{e_1} \quad(mod\;n)</script><script type="math/tex; mode=display">
c_2 = (5p+7q)^{e_2} \quad(mod\;n)</script><p>思路肯定是消p、q其中一个元，然后与n求gcd得到分解。</p>
<p>先统一指数：</p>
<script type="math/tex; mode=display">
c_1^{e_2} = (2p+3q)^{e_1e_2} \quad(mod\;n)</script><script type="math/tex; mode=display">
c_2^{e_1} = (5p+7q)^{e_1e_2} \quad(mod\;n)</script><p>由二项式定理展开得到：</p>
<script type="math/tex; mode=display">
c_1^{e_2} = (2p)^{e_1e_2}+(3q)^{e_1e_2} \quad(mod\;n)</script><script type="math/tex; mode=display">
c_2^{e_1} = (5p)^{e_1e_2}+(7q)^{e_1e_2} \quad(mod\;n)</script><p>然后配系数作差就能消掉其中一个，比如这里我们消去p：</p>
<script type="math/tex; mode=display">
5^{e_1e_2}c_1^{e_2} = 5^{e_1e_2}(2p)^{e_1e_2}+5^{e_1e_2}(3q)^{e_1e_2} \quad(mod\;n)</script><script type="math/tex; mode=display">
2^{e_1e_2}c_2^{e_1} = 2^{e_1e_2}(5p)^{e_1e_2}+2^{e_1e_2}(7q)^{e_1e_2} \quad(mod\;n)</script><p>作差得到：</p>
<script type="math/tex; mode=display">
5^{e_1e_2}c_1^{e_2}- 2^{e_1e_2}c_2^{e_1} = 5^{e_1e_2}(3q)^{e_1e_2} - 2^{e_1e_2}(7q)^{e_1e_2} \quad(mod\;n)</script><p>求解与n的gcd即可得到q，从而分解n还原明文。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *  </span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">e1= <span class="number">113717</span></span><br><span class="line">e2= <span class="number">80737</span></span><br><span class="line">c1= <span class="number">97528398828294138945371018405777243725957112272614466238005409057342884425132214761228537249844134865481148636534134025535106624840957740753950100180978607132333109806554009969378392835952544552269685553539656827070349532458156758965322477969141073720173165958341043159560928836304172136610929023123638981560836183245954461041167802574206323129671965436040047358250847178930436773249800969192016749684095882580749559014647942135761757750292281205876241566597813517452803933496218995755905344070203047797893640399372627351254542342772576533524820435965479881620338366838326652599102311019884528903481310690767832417584600334987458835108576322111553947045733143836419313427495888019352323209000292825566986863770366023326755116931788018138432898323148059980463407567431417724940484236335082696026821105627826117901730695680967455710434307270501190258033004471156993017301443803372029004817834317756597444195146024630164820841200575179112295902020141040090350486764038633257871003899386340004440642516190842086462237559715130631205046041819931656962904630367121414263911179041905140516402771368603623318492074423223885367923228718341206283572152570049573607906130786276734660847733952210105659707746969830132429975090175091281363770357</span></span><br><span class="line">c2= <span class="number">353128571201645377052005694809874806643786163076931670184196149901625274899734977100920488129375537186771931435883114557320913415191396857882995726660784707377672210953334914418470453787964899846194872721616628198368241044602144880543115393715025896206210152190007408112767478800650578941849344868081146624444817544806046188600685873402369145450593575618922226415069043442295774369567389939040265656574664538667552522329712111984168798829635080641332045614585247317991581514218486004191829362787750803153463482021229058714990823658655863245025037102127138472397462755776598314247771125981017814912049441827643898478473451005083533693951329544115861795587564408860828213753948427321483082041546722974666875065831843384005041800692983406353922680299538080900818930589336142421748023025830846906503542594380663429947801329079870530727382679634952272644949425079242992486832995962516376820051495641486546631849426876810933393153871774796182078367277299340503872124124714036499367887886486264658590613431293656417255355575602576047502506125375605713228912611320198066713358654181533335650785578352716562937038768171269136647529849805172492594142026261051266577821582011917001752590659862613307646536049830151262848916867223615064832279222</span></span><br><span class="line">c= <span class="number">375617816311787295279632219241669262704366237192565344884527300748210925539528834207344757670998995567820735715933908541800125317082581328287816628816752542104514363629022246620070560324071543077301256917337165566677142545053272381990573611757629429857842709092285442319141751484248315990593292618113678910350875156232952525787082482638460259354559904243062546518553607882194808191571131590524874275187750985821420412987586148770397073003186510357920710387377990379862185266175190503647626248057084923516190642292152259727446111686043531725993433395002330208067534104745851308178560234372373476331387737629284961288204368572750848248186692623500372605736825205759172773503283282321274793846281079650686871355211691681512637459986684769598186821524093789286661348936784712071312135814683041839882338235290487868969391040389837253093468883093296547473466050960563347060307256735803099039921213839491129726807647623542881247210251994139130146519265086673883077644185971830004165931626986486648581644383717994174627681147696341976767364316172091139507445131410662391699728189797082878876950386933926807186382619331901457205957462337191923354433435013338037399565519987793880572723211669459895193009710035003369626116024630678400746946356</span></span><br><span class="line">n= <span class="number">728002565949733279371529990942440022467681592757835980552797682116929657292509059813629423038094227544032071413317330087468458736175902373398210691802243764786251764982802000867437756347830992118278032311046807282193498960587170291978547754942295932606784354258945168927044376692224049202979158068158842475322825884209352566494900083765571037783472505580851500043517614314755340168507097558967372661966013776090657685241689631615245294004694287660685274079979318342939473469143729494106686592347327776078649315612768988028622890242005700892937828732613800620455225438339852445425046832904615827786856105112781009995862999853122308496903885748394541643702103368974605177097553007573113536089894913967154637055293769061726082740854619536748297829779639633209710676774371525146758917646731487495135734759201537358734170552231657257498090553682791418003138924472103077035355223367678622115314235119493397080290540006942708439607767313672671274857069053688258983103863067394473084183472609906612056828326916114024662795812611685559034285371151973580240723680736227737324052391721149957542711415812665358477474058103338801398214688403784213100455466705770532894531602252798634923125974783427678469124261634518543957766622712661056594132089</span></span><br><span class="line"></span><br><span class="line">t1 = <span class="built_in">pow</span>(<span class="number">3</span>,(e1*e2),n)</span><br><span class="line">t2 = <span class="built_in">pow</span>(<span class="number">7</span>,(e1*e2),n)</span><br><span class="line">temp1 = t2*<span class="built_in">pow</span>(c1,e2,n)</span><br><span class="line">temp2 = t1*<span class="built_in">pow</span>(c2,e1,n)</span><br><span class="line"></span><br><span class="line">p = GCD(temp1-temp2,n)</span><br><span class="line">q = n // p</span><br><span class="line">d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;poly_rsa_Just_need5_s1mple_gcd&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Simple3DES"><a href="#Simple3DES" class="headerlink" title="Simple3DES"></a>Simple3DES</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">题目链接：nc 59.110.20.54:23333 https://blog.csdn.net/Mr_wzc/article/details/121713518</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">xor = <span class="keyword">lambda</span> a,b: <span class="built_in">bytes</span>([a[i % <span class="built_in">len</span>(a)] ^ b[i % <span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line">pad = <span class="keyword">lambda</span> msg,padlen: msg+<span class="built_in">chr</span>((padlen-(<span class="built_in">len</span>(msg)%padlen))).encode()*(padlen-(<span class="built_in">len</span>(msg)%padlen))</span><br><span class="line"></span><br><span class="line">flag = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span>).encode()</span><br><span class="line">sec = os.urandom(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">banner = <span class="string">&#x27;|&#x27;</span>*<span class="number">70</span></span><br><span class="line"></span><br><span class="line">DEBUG = <span class="literal">False</span> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    digest = hashlib.sha256(proof.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:], digest))</span><br><span class="line">    x = <span class="built_in">input</span>(<span class="string">&quot;Give me XXXX: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x)!=<span class="number">4</span> <span class="keyword">or</span> hashlib.sha256((x+proof[<span class="number">4</span>:]).encode()).hexdigest() != digest:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Right!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">msg,key</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = long_to_bytes(key)</span><br><span class="line">        msg = xor(long_to_bytes(msg),sec)</span><br><span class="line">        des = DES3.new(key,DES3.MODE_ECB)</span><br><span class="line">        ct = xor(des.encrypt(pad(msg,<span class="number">8</span>)),sec)</span><br><span class="line">        <span class="keyword">return</span> bytes_to_long(ct)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> Exception</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">service</span>():</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        exit()</span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Simple DES Encryption Service&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line">    <span class="keyword">while</span> cnt&lt;<span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;1. Encrypt\n2. Get encrypted flag.&#x27;</span>)</span><br><span class="line">        choice = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> choice == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Input msg:&#x27;</span>)</span><br><span class="line">            msg = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).strip())</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Input key:&#x27;</span>)</span><br><span class="line">            key = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).strip())</span><br><span class="line">            <span class="built_in">print</span>(enc(msg,key))</span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Input key:&#x27;</span>)</span><br><span class="line">            key = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).strip())</span><br><span class="line">            <span class="built_in">print</span>(enc(bytes_to_long(flag),key))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            exit()</span><br><span class="line">        cnt+=<span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Bye!&#x27;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    service()</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    exit()</span><br></pre></td></tr></table></figure>
<p>题目基于3DES，其加密流程如下：</p>
<p><img src="/post/6f77578c/image-20231107191309019.png" alt="image-20231107191309019"></p>
<p>我们可以做的是：</p>
<ul>
<li>输入1，可以指定3DES密钥与一段明文，获得他的加密结果</li>
<li>输入2，可以指定密钥，获得flag的加密结果</li>
</ul>
<p>并且一共只有两次交互机会，所以可以知道预期应该是每个选项用一次。</p>
<p>然后需要注意，这里的enc函数并不是简单的3DES加密，而是有临时密钥sec的参与：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sec = os.urandom(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">msg,key</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = long_to_bytes(key)</span><br><span class="line">        msg = xor(long_to_bytes(msg),sec)</span><br><span class="line">        des = DES3.new(key,DES3.MODE_ECB)</span><br><span class="line">        ct = xor(des.encrypt(pad(msg,<span class="number">8</span>)),sec)</span><br><span class="line">        <span class="keyword">return</span> bytes_to_long(ct)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> Exception</span><br></pre></td></tr></table></figure>
<p>也就是说，enc的执行流程如下：</p>
<ul>
<li>将msg与sec异或，并进行填充</li>
<li>进行3DES加密</li>
<li>将得到的密文再与sec异或，得到最终密文值</li>
</ul>
<p>接下来阐述两种思路。</p>
<h4 id="弱密钥"><a href="#弱密钥" class="headerlink" title="弱密钥"></a>弱密钥</h4><p>这一部分我是看2022年的hackergame中，不可加密的异世界的wp了解到的：</p>
<p><a target="_blank" rel="noopener" href="https://tl2cents.github.io/2022/11/01/Hacker-Game-2022-出题记/">HackerGame 2022 出题记 | tl2cents blog</a></p>
<p>还有一些参考如下：</p>
<p><a target="_blank" rel="noopener" href="https://lightless.me/archives/DES-Weak-Keys.html">DES 弱密钥 - lightless blog</a></p>
<p>这就是说，DES加密中，存在一些密钥为弱密钥，如果使用弱密钥加密，会导致一个惨重结果：轮密钥全部相同。</p>
<p>这也就是说，使用弱密钥的话：</p>
<ul>
<li>对明文连续加密两次，仍然是明文</li>
<li>对密文连续解密两次，仍然是密文</li>
</ul>
<p>而3DES的密钥分为三个部分k1，k2，k3，加密流程是：</p>
<ul>
<li>用k1进行加密</li>
<li>用k2进行解密</li>
<li>用k3进行加密</li>
</ul>
<p>那么可以取巧的一个方式就是，我们选择两个弱密钥，按如下方式拼起来当作3DES的密钥：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">b&quot;\x01\x01\x01\x01\x01\x01\x01\x01&quot;</span>+<span class="string">b&quot;\xFE\xFE\xFE\xFE\xFE\xFE\xFE\xFE&quot;</span>+<span class="string">b&quot;\x01\x01\x01\x01\x01\x01\x01\x01&quot;</span></span><br></pre></td></tr></table></figure>
<p>那么我们第一次输入2，得到flag的加密值。第二次再把flag加密值发送回去让他加密即可，这样正好还抵消了sec的影响(可以自己推一下)，因此就能得到flag。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">	table = string.digits + string.ascii_letters</span><br><span class="line">	temp = r.recvuntil(<span class="string">b&quot;sha256(XXXX+&quot;</span>)</span><br><span class="line">	temp = r.recvline()</span><br><span class="line">	suffix = temp[:<span class="number">16</span>].decode()</span><br><span class="line">	hex1 = temp[<span class="number">20</span>:].strip().decode()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> tqdm(table):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> table:</span><br><span class="line">				<span class="keyword">for</span> m <span class="keyword">in</span> table:</span><br><span class="line">					temp1 = i+j+k+m</span><br><span class="line">					<span class="keyword">if</span>(sha256((temp1+suffix).encode()).hexdigest() == hex1):</span><br><span class="line">						r.sendline(temp1.encode())</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>, <span class="number">23333</span>)</span><br><span class="line">proof_of_work()</span><br><span class="line"></span><br><span class="line">xor = <span class="keyword">lambda</span> a,b: <span class="built_in">bytes</span>([a[i % <span class="built_in">len</span>(a)] ^ b[i % <span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line"><span class="comment">#2</span></span><br><span class="line">r.recvuntil(<span class="string">b&quot;Get encrypted flag.&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">key = <span class="string">b&quot;\x01\x01\x01\x01\x01\x01\x01\x01&quot;</span>+<span class="string">b&quot;\xFE\xFE\xFE\xFE\xFE\xFE\xFE\xFE&quot;</span>+<span class="string">b&quot;\x01\x01\x01\x01\x01\x01\x01\x01&quot;</span></span><br><span class="line">r.sendline(<span class="built_in">str</span>(bytes_to_long(key)).encode())</span><br><span class="line">enc = long_to_bytes(<span class="built_in">int</span>(r.recvline().strip().decode()))</span><br><span class="line"></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line">r.recvuntil(<span class="string">b&quot;Get encrypted flag.&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(bytes_to_long(enc)).encode())</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(bytes_to_long(key)).encode())</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(r.recvline().strip().decode()))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;DES_1s_0ut_0f_t1me&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="pad"><a href="#pad" class="headerlink" title="pad"></a>pad</h4><p>但是第二种估计才是预期解，注意到enc中加密流程中有个漏洞：</p>
<ul>
<li>将msg与sec异或，并进行填充</li>
<li>进行3DES加密</li>
<li>将得到的密文再与sec异或，得到最终密文值</li>
</ul>
<p>他将msg与sec异或后，再进行填充。而填充的方式如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pad = <span class="keyword">lambda</span> msg,padlen: msg+<span class="built_in">chr</span>((padlen-(<span class="built_in">len</span>(msg)%padlen))).encode()*(padlen-(<span class="built_in">len</span>(msg)%padlen))</span><br></pre></td></tr></table></figure>
<p>DES以8字节为一组进行分组加密。而这个pad是在msg恰好为8字节的整数倍时，仍然会进行8字节b”\x08”的填充。也就是说，如果我们发送一个空的字节串，对应的数字也就是0，那么靶机端加密的流程应该是：</p>
<ul>
<li>sec + b”\x08”*8</li>
<li>进行3DES加密</li>
<li>得到的密文再与sec异或，得到最终密文值</li>
</ul>
<p>而由于8字节为一组加密，所以第二组的密文值是：</p>
<script type="math/tex; mode=display">
3DES(padding) \oplus sec</script><p>而我们拥有密钥，自然也就能获得3DES(padding)的值，与密文异或就能得到sec的值。</p>
<p>有了sec后，输入2申请flag的密文，相信解密不是难事。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">	table = string.digits + string.ascii_letters</span><br><span class="line">	temp = r.recvuntil(<span class="string">b&quot;sha256(XXXX+&quot;</span>)</span><br><span class="line">	temp = r.recvline()</span><br><span class="line">	suffix = temp[:<span class="number">16</span>].decode()</span><br><span class="line">	hex1 = temp[<span class="number">20</span>:].strip().decode()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> tqdm(table):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> table:</span><br><span class="line">				<span class="keyword">for</span> m <span class="keyword">in</span> table:</span><br><span class="line">					temp1 = i+j+k+m</span><br><span class="line">					<span class="keyword">if</span>(sha256((temp1+suffix).encode()).hexdigest() == hex1):</span><br><span class="line">						r.sendline(temp1.encode())</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>, <span class="number">23333</span>)</span><br><span class="line">proof_of_work()</span><br><span class="line"></span><br><span class="line">xor = <span class="keyword">lambda</span> a,b: <span class="built_in">bytes</span>([a[i % <span class="built_in">len</span>(a)] ^ b[i % <span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line"><span class="comment">#2</span></span><br><span class="line">r.recvuntil(<span class="string">b&quot;Get encrypted flag.&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">key = <span class="string">b&quot;1234567887654321&quot;</span></span><br><span class="line">des = DES3.new(key,DES3.MODE_ECB)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(bytes_to_long(key)).encode())</span><br><span class="line">enc = long_to_bytes(<span class="built_in">int</span>(r.recvline().strip().decode()))</span><br><span class="line"></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line">r.recvuntil(<span class="string">b&quot;Get encrypted flag.&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;0&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(bytes_to_long(key)).encode())</span><br><span class="line">enc1 = long_to_bytes(<span class="built_in">int</span>(r.recvline().strip().decode()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#dec</span></span><br><span class="line">padding = <span class="string">b&quot;\x08&quot;</span>*<span class="number">8</span></span><br><span class="line">enc_pad1 = des.encrypt(padding)</span><br><span class="line">sec = xor(enc_pad1,enc1)[-<span class="number">8</span>:]</span><br><span class="line">temp = xor(des.decrypt(xor(sec,enc)),sec)</span><br><span class="line"><span class="built_in">print</span>(temp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;DES_1s_0ut_0f_t1me&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="JPGDiff"><a href="#JPGDiff" class="headerlink" title="JPGDiff"></a>JPGDiff</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">图片中的字符串即为flag</span><br></pre></td></tr></table></figure>
<p>题目给了两张图片，一张是经过某种加密后的图片，一张是hint。hint图片如下：</p>
<p><img src="/post/6f77578c/image-20231107194348306.png" alt="image-20231107194348306"></p>
<p>可以看到他分别给了2x2，4x4，8x8的几个图片的一种一次性走完所有点的走法，而由于加密后的图片是一个一维的点序列，因此可以知道：加密的图片就是按照这种走法得到的点的序列。</p>
<p>而由于加密图片共有65536=256x256个点，所以目标就是：</p>
<ul>
<li>找到这种走法的普遍函数形式，推广到256x256的正方形中</li>
<li>然后生成256x256的点的序列，然后用序列对应还原加密图片即可</li>
</ul>
<p>然后其实之前瞎翻，翻到春哥博客里看到过这个走法的加密函数：</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/643051459">[CryptoCTF] CryptoCTF 2023 medium分类 团队解题writeup 之二 - 知乎 (zhihu.com)</a></p>
<p>就直接去NSS上下载这个题目附件，用里面的函数直接跑一遍就能生成对应序列，然后对着还原即可。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sox</span>(<span class="params">n, d</span>):</span><br><span class="line">	x, y, t = <span class="number">0</span>, <span class="number">0</span>, d</span><br><span class="line">	<span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>):</span><br><span class="line">		u = <span class="number">1</span> &amp; t // <span class="number">2</span></span><br><span class="line">		v = <span class="number">1</span> &amp; t ^ u</span><br><span class="line">		x, y = spin(<span class="number">2</span>**s, x, y, u, v)</span><br><span class="line">		x += <span class="number">2</span>**s * u</span><br><span class="line">		y += <span class="number">2</span>**s * v</span><br><span class="line">		t = t // <span class="number">4</span></span><br><span class="line">	<span class="keyword">return</span> x, y</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spin</span>(<span class="params">n, x, y, u, v</span>):</span><br><span class="line">	<span class="keyword">if</span> v == <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">if</span> u == <span class="number">1</span>:</span><br><span class="line">			x = n - <span class="number">1</span> - x</span><br><span class="line">			y = n - <span class="number">1</span> - y</span><br><span class="line">		x, y = y, x</span><br><span class="line">	<span class="keyword">return</span> x, y</span><br><span class="line"></span><br><span class="line">n = <span class="number">256</span></span><br><span class="line">pix = []</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> trange(n**<span class="number">2</span>):</span><br><span class="line">    x, y = sox(n, d)</span><br><span class="line">    pix.append((x,y))</span><br><span class="line"></span><br><span class="line">image = Image.<span class="built_in">open</span>(<span class="string">r&quot;E:\题\极客大挑战 2023\week2\jpgdiff\ct.png&quot;</span>)</span><br><span class="line">width, height = image.size</span><br><span class="line">pixel_data = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">        pixel = image.getpixel((x, y))</span><br><span class="line">        pixel_data.append(pixel)</span><br><span class="line"></span><br><span class="line">image = Image.new(<span class="string">&quot;RGB&quot;</span>, (<span class="number">256</span>, <span class="number">256</span>))</span><br><span class="line">pixels = image.load()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">65536</span>):</span><br><span class="line">      x,y = pix[i]</span><br><span class="line">      pixels[y, x] = pixel_data[i]</span><br><span class="line"></span><br><span class="line">image.save(<span class="string">&quot;flag.png&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;H1LB5RT_C1pher&#125;</span></span><br></pre></td></tr></table></figure>
<p><img src="/post/6f77578c/image-20231107195806843.png" alt="image-20231107195806843"></p>
<p>然后对着flag进行搜索，可以找到对应的走法其实是叫做Hilbert曲线：</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1494903">希尔伯特曲线（Hilbert曲线含解析）-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<p><br></p>
<p><br></p>
<h3 id="Energetic-Carcano"><a href="#Energetic-Carcano" class="headerlink" title="Energetic_Carcano"></a>Energetic_Carcano</h3><p>题目来源：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">题目链接：nc 59.110.20.54:8763 https://en.wikipedia.org/wiki/Elliptic-curve_cryptography</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from sage.all import *</span></span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">import</span> string </span><br><span class="line"><span class="keyword">import</span> hashlib </span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">DEBUG = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">banner = <span class="string">&#x27;|&#x27;</span>*<span class="number">70</span> </span><br><span class="line">flag = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span>).encode()</span><br><span class="line">pbits = <span class="number">120</span></span><br><span class="line">abp = <span class="string">&quot;abp&quot;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>(): </span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    digest = hashlib.sha256(proof.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:], digest))</span><br><span class="line">    x = <span class="built_in">input</span>(<span class="string">&quot;Give me XXXX: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x)!=<span class="number">4</span> <span class="keyword">or</span> hashlib.sha256((x+proof[<span class="number">4</span>:]).encode()).hexdigest() != digest: </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Right!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">a,b,p,turn,ans</span>):</span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> turn == <span class="string">&quot;a&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(a) == ans </span><br><span class="line">        <span class="keyword">if</span> turn == <span class="string">&quot;b&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(b) == ans</span><br><span class="line">        <span class="keyword">if</span> turn == <span class="string">&quot;p&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(p) == ans  </span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>: </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        exit() </span><br><span class="line">    <span class="built_in">print</span>(banner) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\nHi Crypto-ers! AL3XEI here. I know you are excellent at math, so I prepared a game for u.&#x27;</span>) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;In the equation y^2 = x^3+ a*x + b (mod p), 4 points are given. Plz give me the right a, b or p to contine the game.&#x27;</span>) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Good Luck!\n&#x27;</span>) </span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        turn = random.choice(abp) </span><br><span class="line">        p = getPrime(pbits) </span><br><span class="line">        a,b = [next_prime(random.randint(<span class="number">2</span>,p)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span>] </span><br><span class="line">        curve = EllipticCurve(GF(p),[a,b]) </span><br><span class="line">        pts = [curve.random_point() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">        pts = [(_[<span class="number">0</span>], _[<span class="number">1</span>]) <span class="keyword">for</span> _ <span class="keyword">in</span> pts] </span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> pts:</span><br><span class="line">            <span class="built_in">print</span>(_,end=<span class="string">&quot; &quot;</span>) </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\nGive me &#x27;</span>+turn+<span class="string">&quot; :&quot;</span>) </span><br><span class="line">        ans = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>)) </span><br><span class="line">        <span class="keyword">if</span> check(a,b,p,turn,ans):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Good! Next challenge-&gt;\n&quot;</span>) </span><br><span class="line">            <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            pbits+=<span class="number">5</span>  </span><br><span class="line">            <span class="keyword">continue</span> </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>) </span><br><span class="line">            <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">            exit() </span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Congrats! Your flag is:&#x27;</span>,flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>) </span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">    exit() </span><br></pre></td></tr></table></figure>
<p>题意很简单，完成十轮挑战就能获得flag，每轮挑战内容为：</p>
<ul>
<li>生成一条随机椭圆曲线，给出其上四个点的坐标</li>
<li>要求提供给定参数p、a、b其中一个的值，提供正确则进行下一轮挑战</li>
</ul>
<p>我们知道椭圆曲线的点满足方程：</p>
<script type="math/tex; mode=display">
y^2 = x^3+ax+b \quad(mod\;p)</script><p>而我们有四个点的坐标，就有四组方程：</p>
<script type="math/tex; mode=display">
y_1^2 = x_1^3+ax_1+b \quad(mod\;p)</script><script type="math/tex; mode=display">
y_2^2 = x_2^3+ax_2+b \quad(mod\;p)</script><script type="math/tex; mode=display">
y_3^2 = x_3^3+ax_3+b \quad(mod\;p)</script><script type="math/tex; mode=display">
y_4^2 = x_4^3+ax_4+b \quad(mod\;p)</script><p>要求从四组方程中还原a、b、p，其实跟无参数的LCG很像，主要目的就是消元，求gcd得到p，然后再回到模方程中求解a、b。</p>
<p>消元过程如下，我们取前两组方程：</p>
<script type="math/tex; mode=display">
y_1^2 -  x_1^3 =ax_1+b \quad(mod\;p)</script><script type="math/tex; mode=display">
y_2^2 - x_2^3= ax_2+b \quad(mod\;p)</script><p>作差消掉b：</p>
<script type="math/tex; mode=display">
y_1^2 -  x_1^3 - y_2^2 + x_2^3=ax_1 - ax_2 \quad(mod\;p)</script><p>把a单独提出来：</p>
<script type="math/tex; mode=display">
(y_1^2 -  x_1^3 - y_2^2 + x_2^3)(x_1-x_2)^{-1} = a \quad(mod\;p)</script><p>同理，我们取第二三组方程也能得到：</p>
<script type="math/tex; mode=display">
(y_2^2 -  x_2^3 - y_3^2 + x_3^3)(x_2-x_3)^{-1} = a \quad(mod\;p)</script><p>那么作差就有：</p>
<script type="math/tex; mode=display">
(y_1^2 -  x_1^3 - y_2^2 + x_2^3)(x_1-x_2)^{-1} - (y_2^2 -  x_2^3 - y_3^2 + x_3^3)(x_2-x_3)^{-1} = 0 \quad(mod\;p)</script><p>那么同样再取一组求gcd，并消去小因子就能得到p，得到p过后还原ab就很轻松。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">	table = string.digits + string.ascii_letters</span><br><span class="line">	temp = r.recvuntil(<span class="string">b&quot;sha256(XXXX+&quot;</span>)</span><br><span class="line">	temp = r.recvline()</span><br><span class="line">	suffix = temp[:<span class="number">16</span>].decode()</span><br><span class="line">	hex1 = temp[<span class="number">20</span>:].strip().decode()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> tqdm(table):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> table:</span><br><span class="line">				<span class="keyword">for</span> m <span class="keyword">in</span> table:</span><br><span class="line">					temp1 = i+j+k+m</span><br><span class="line">					<span class="keyword">if</span>(sha256((temp1+suffix).encode()).hexdigest() == hex1):</span><br><span class="line">						r.sendline(temp1.encode())</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>(<span class="params">points</span>):</span><br><span class="line">    (x1,y1),(x2,y2),(x3,y3),(x4,y4) = points</span><br><span class="line">    t1 = (y2**<span class="number">2</span>-y1**<span class="number">2</span>-x2**<span class="number">3</span>+x1**<span class="number">3</span>)</span><br><span class="line">    t2 = (y3**<span class="number">2</span>-y2**<span class="number">2</span>-x3**<span class="number">3</span>+x2**<span class="number">3</span>)</span><br><span class="line">    t3 = (y4**<span class="number">2</span>-y3**<span class="number">2</span>-x4**<span class="number">3</span>+x3**<span class="number">3</span>)</span><br><span class="line">    k1p = t1*(x3-x2) - t2*(x2-x1)</span><br><span class="line">    k2p = t2*(x4-x3) - t3*(x3-x2)</span><br><span class="line">    k3p = t1*(x4-x3) - t3*(x2-x1)</span><br><span class="line">    p = GCD(k1p,k2p)</span><br><span class="line">    p = GCD(p,k3p)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">1000</span>):</span><br><span class="line">        <span class="keyword">while</span>(p % i == <span class="number">0</span>):</span><br><span class="line">            p //= i</span><br><span class="line">    a = inverse(x2-x1,p)*t1 % p</span><br><span class="line">    b = (y1**<span class="number">2</span>-x1**<span class="number">3</span>-a*x1) % p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a,b,p</span><br><span class="line">	</span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>,<span class="number">8763</span>)</span><br><span class="line">proof_of_work()</span><br><span class="line">r.recvuntil(<span class="string">b&quot;Good Luck!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;|&quot;</span>*<span class="number">70</span>)</span><br><span class="line">    r.recvline()</span><br><span class="line">    r.recvline()</span><br><span class="line">    points = r.recvline().strip().decode().split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    point_list = [[<span class="number">0</span>,<span class="number">0</span>] <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">if</span>(j % <span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">            point_list[j//<span class="number">2</span>][<span class="number">0</span>] = <span class="built_in">int</span>(points[j][<span class="number">1</span>:-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            point_list[j//<span class="number">2</span>][<span class="number">1</span>] = <span class="built_in">int</span>(points[j][:-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    a,b,p = calc(point_list)</span><br><span class="line"></span><br><span class="line">    r.recvuntil(<span class="string">b&quot;me &quot;</span>)</span><br><span class="line">    turn = r.recvline()</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">b&quot;a&quot;</span> <span class="keyword">in</span> turn):</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(a).encode())</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">b&quot;b&quot;</span> <span class="keyword">in</span> turn):</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(b).encode())</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">b&quot;p&quot;</span> <span class="keyword">in</span> turn):</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(p).encode())</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&quot;Congrats! Your flag is:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.recvline())	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;ECC_M4ster&#125;</span></span><br></pre></td></tr></table></figure>
<p>事实上，这题居然可以直接定义在ZZ域上，然后Groebner解。我开始认为必须在Zp域上才行，所以没有考虑过，涨知识了。</p>
<p><br></p>
<p><br></p>
<h3 id="Just-need-One"><a href="#Just-need-One" class="headerlink" title="Just need One"></a>Just need One</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">题目链接：nc 59.110.20.54:2613 One bullet to kill all Outlaws.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">import</span> string </span><br><span class="line"><span class="keyword">import</span> hashlib </span><br><span class="line"></span><br><span class="line">flag = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span>)</span><br><span class="line">DEBUG = <span class="literal">False</span></span><br><span class="line">banner = <span class="string">&#x27;|&#x27;</span>*<span class="number">70</span></span><br><span class="line"><span class="keyword">if</span> DEBUG:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;==DEBUG MODE==&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>(): </span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    digest = hashlib.sha256(proof.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:], digest))</span><br><span class="line">    x = <span class="built_in">input</span>(<span class="string">&quot;Give me XXXX: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x)!=<span class="number">4</span> <span class="keyword">or</span> hashlib.sha256((x+proof[<span class="number">4</span>:]).encode()).hexdigest() != digest: </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Right!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        exit() </span><br><span class="line">    <span class="built_in">print</span>(banner) </span><br><span class="line">    parms = [random.getrandbits(<span class="number">32</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>)] </span><br><span class="line">    res = res = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;Give me x calculating f(x) :\n&gt; &#x27;</span>))  </span><br><span class="line">    <span class="keyword">if</span> res &gt;= <span class="number">2</span>**<span class="number">32</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Give me something smaller.\n&quot;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">        exit() </span><br><span class="line"></span><br><span class="line">    cnt = <span class="number">0</span>  </span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>): </span><br><span class="line">        cnt += <span class="built_in">pow</span>(res,_)*parms[_]  </span><br><span class="line">    <span class="built_in">print</span>(cnt) </span><br><span class="line">    ans = <span class="built_in">input</span>(<span class="string">&#x27;Give me Coefficients :\n&gt; &#x27;</span>) </span><br><span class="line">    ans = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> ans.split(<span class="string">&quot;,&quot;</span>)] </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ans == parms:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Congrats! Your flag is:&#x27;</span>,flag)  </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>) </span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">    exit() </span><br></pre></td></tr></table></figure>
<p>这题题意如下：</p>
<ul>
<li>通过proof</li>
<li>生成长度为128的序列，序列中每个值是随机的32比特</li>
<li>可以输入一个小于2^32的res，当作多项式的x，并计算如下累加和cnt：</li>
</ul>
<script type="math/tex; mode=display">
cnt = \sum_{i=0}^{127}parms_i * res^i</script><ul>
<li>给出cnt，要求还原parms并输入给靶机，就能获得flag</li>
</ul>
<p>解决方式也很简单，注意到他其实只限制了res小于2^32，那么我们传入负数的话，绝对值大小是不会检查的。所以直接传-2^32或更小的2的幂次，然后将累加和逐次移位并处理对应的减法借位就有parms了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">	table = string.digits + string.ascii_letters</span><br><span class="line">	temp = r.recvuntil(<span class="string">b&quot;sha256(XXXX+&quot;</span>)</span><br><span class="line">	temp = r.recvline()</span><br><span class="line">	suffix = temp[:<span class="number">16</span>].decode()</span><br><span class="line">	hex1 = temp[<span class="number">20</span>:].strip().decode()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> tqdm(table):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> table:</span><br><span class="line">				<span class="keyword">for</span> m <span class="keyword">in</span> table:</span><br><span class="line">					temp1 = i+j+k+m</span><br><span class="line">					<span class="keyword">if</span>(sha256((temp1+suffix).encode()).hexdigest() == hex1):</span><br><span class="line">						r.sendline(temp1.encode())</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>, <span class="number">2613</span>)</span><br><span class="line">proof_of_work()</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">res = -<span class="number">2</span>**<span class="number">64</span></span><br><span class="line">r.sendline(<span class="built_in">str</span>(res).encode())</span><br><span class="line">cnt = <span class="built_in">int</span>(r.recvline().strip().decode())</span><br><span class="line">tt = cnt</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line"></span><br><span class="line">parms = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">	parms[i] = cnt &amp; ((<span class="number">1</span>&lt;&lt;<span class="number">64</span>)-<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">if</span>(i%<span class="number">2</span>):</span><br><span class="line">		parms[i] = <span class="number">2</span>**<span class="number">64</span>-parms[i]</span><br><span class="line">	<span class="keyword">elif</span>(i!=<span class="number">0</span> <span class="keyword">and</span> i%<span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">		parms[i] += <span class="number">1</span></span><br><span class="line">	cnt &gt;&gt;= <span class="number">64</span></span><br><span class="line"></span><br><span class="line">r.sendline(<span class="built_in">str</span>(parms)[<span class="number">1</span>:-<span class="number">1</span>].encode())</span><br><span class="line"><span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;Alg0r1thm_1s_s0_S1mpl3!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Fi1nd-th3-x’"><a href="#Fi1nd-th3-x’" class="headerlink" title="Fi1nd_th3_x’"></a>Fi1nd_th3_x’</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">听说在那个大陆有位叫jrl777的旅行者......Cryptoer穿越到了提瓦特就要拿出真本事！</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span>* </span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">r = getPrime(<span class="number">512</span>)</span><br><span class="line">e = getPrime(<span class="number">32</span>)</span><br><span class="line">n = p*q*r</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,phi)</span><br><span class="line">dP = d%((q-<span class="number">1</span>)*(r-<span class="number">1</span>))</span><br><span class="line">dQ = d%((p-<span class="number">1</span>)*(r-<span class="number">1</span>))</span><br><span class="line">dR = d%((p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = s2n(flag.encode())</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p=&#x27;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;q=&#x27;</span>,q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;r=&#x27;</span>,r)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;dP=&#x27;</span>,dP)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;dQ=&#x27;</span>,dQ)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;dR=&#x27;</span>,dR)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c=&#x27;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p= 13014610351521460822156239705430709078128228907778181478242620569429327799535062679140131416771915929573454741755415612880788196172134695027201422226050343</span></span><br><span class="line"><span class="string">q= 12772373441651008681294250861077909144300908972709561019514945881228862913558543752401850710742410181542277593157992764354184262443612041344749961361188667</span></span><br><span class="line"><span class="string">r= 12128188838358065666687296689425460086282352520167544115899775800918383085863282204525519245937988837403739683061218279585168168892037039644924073220678419</span></span><br><span class="line"><span class="string">dP= 116715737414908163105708802733763596338775040866822719131764691930369001776551671725363881836568414327815420649861207859100479999650414099346914809923964116101517432576562641857767638396325944526867458624878906968552835814078216316470330511385701105459053294771612727181278955929391807414985165924450505855941</span></span><br><span class="line"><span class="string">dQ= 44209639124029393930247375993629669338749966042856653556428540234515804939791650065905841618344611216577807325504984178760405516121845853248373571704473449826683120387747977520655432396578361308033763778324817416507993263234206797363191089863381905902638111246229641698709383653501799974217118168526572365797</span></span><br><span class="line"><span class="string">dR= 60735172709413093730902464873458655487237612458970735840670987186877666190533417038325630420791294593669609785154204677845781980482700493870590706892523016041087206844082222225206703139282240453277802870868459288354322845410191061009582969848870045522383447751431300627611762289800656277924903605593069856921</span></span><br><span class="line"><span class="string">c= 93063188325241977486352111369210103514669725591157371105152980481620575818945846725056329712195176948376321676112726029400835578531311113991944495646259750817465291340479809938094295621728828133981781064352306623727112813796314947081857025012662546178066873083689559924412320123824601550896063037191589471066773464829226873338699012924080583389032903142107586722373131642720522453842444615499672193051587154108368643495983197891525747653618742702589711752256009</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>Task.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5Lq65Lus5Y+q6K6w5b6X77yM6L+Z5pys5piv6aOO5ZKM5pel5Li955qE5LiA5aSp77yManJsNzc35q2j5Zyo572R5LiK5a2m5Lmg5a+G56CB5a2m44CC5b+954S25LmL6Ze077yM6buR6Imy5raI6YCA77yM5bGP5bmV55m95YWJ6aqk6LW377yM5omA5pyJ55qE6K665paH6YO95reh5Ye655y85biY44CC5LuW5Yed56We5LiA55yL77yM5Y205Y+q5pyJ5rex6YKD5aaC5aKo55qE4oCc5Y6f56We4oCd5LqM5a2X5Zyo5Zue5bqU552A44CC5pyq5Y+K5oCd6ICD77yManJsNzc36ISR6KKL5LiA6Zi15pmV55yp44CC6ICM5q2k5Yi777yM5o+Q55Om54m55aSn6ZmG5LiK56m65pyJ6YeR5YWJ6Zeq54OB77yM56m66Ze05Lmx5rWB5LmL5YaF77yM5LiD56eN5YWD57Sg5Yqb5pKV5byA5LqG5pe256m66KOC57yd77yM6aOO5bim5p2l5LqG5pWF5LqL55qE56eN5a2Q44CC5Y+v5YaN5Z2a5Zu655qE5bKp55+z5Lmf6Zq+6YCD56Oo5o2f55qE5ZG96L+Q44CC4oCc5LiW55WM77yM6YGX5b+Y5oiR44CC4oCd5LuW57uI56m25b+Y6K6w5LqG6Ieq5bexQ3J5cHRvZXLnmoTouqvku73jgILigJzmj5Dnk6bnibnlpKfpmYbnmoTml4XkurrvvIzkvaDog73mib7liLDmiJHpgZflpLHnmoTotKblj7flkJfvvJ/igJ0=</span><br></pre></td></tr></table></figure>
<p>先解task得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">人们只记得，这本是风和日丽的一天，jrl777正在网上学习密码学。忽然之间，黑色消退，屏幕白光骤起，所有的论文都淡出眼帘。他凝神一看，却只有深邃如墨的“原神”二字在回应着。未及思考，jrl777脑袋一阵晕眩。而此刻，提瓦特大陆上空有金光闪烁，空间乱流之内，七种元素力撕开了时空裂缝，风带来了故事的种子。可再坚固的岩石也难逃磨损的命运。“世界，遗忘我。”他终究忘记了自己Cryptoer的身份。“提瓦特大陆的旅人，你能找到我遗失的账号吗？”</span><br></pre></td></tr></table></figure>
<p>还是直接看题吧，题目给出以下几个值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dP = d%((q-<span class="number">1</span>)*(r-<span class="number">1</span>))</span><br><span class="line">dQ = d%((p-<span class="number">1</span>)*(r-<span class="number">1</span>))</span><br><span class="line">dR = d%((p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<p>然后也直接给了n的分解p、q、r以及密文，要求还原明文。</p>
<p>主要问题就在于，没有加密指数e，且加密指数e的比特是32，不太容易爆破，因此我们无法直接求得解密指数，只能用给的几个dP、dQ、dR来解题。(其实翻maple的博客翻到过有一个工具，可以非常快速的给出所有32比特的素数，但是这题肯定不是考这个哈哈。有兴趣的师傅也可以自己去找一找)</p>
<p>然后对dP熟悉一点的话，应该能知道，我们能获得以下几个解密值：</p>
<script type="math/tex; mode=display">
c^{dP} \equiv m \quad(mod\;qr)</script><script type="math/tex; mode=display">
c^{dQ} \equiv m \quad(mod\;pr)</script><script type="math/tex; mode=display">
c^{dR} \equiv m \quad(mod\;pq)</script><p>那么其实就是一个不互素的CRT，不清楚的师傅可以自己搜一搜原理，这里推荐一手Xenny师傅的密码工坊。</p>
<p>但是只追求出结果的话，用这个库里的函数可以一步到位，不管互不互素：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br></pre></td></tr></table></figure>
<p>当然我是建议了解清楚原理。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"></span><br><span class="line">p= <span class="number">13014610351521460822156239705430709078128228907778181478242620569429327799535062679140131416771915929573454741755415612880788196172134695027201422226050343</span></span><br><span class="line">q= <span class="number">12772373441651008681294250861077909144300908972709561019514945881228862913558543752401850710742410181542277593157992764354184262443612041344749961361188667</span></span><br><span class="line">r= <span class="number">12128188838358065666687296689425460086282352520167544115899775800918383085863282204525519245937988837403739683061218279585168168892037039644924073220678419</span></span><br><span class="line">dP= <span class="number">116715737414908163105708802733763596338775040866822719131764691930369001776551671725363881836568414327815420649861207859100479999650414099346914809923964116101517432576562641857767638396325944526867458624878906968552835814078216316470330511385701105459053294771612727181278955929391807414985165924450505855941</span></span><br><span class="line">dQ= <span class="number">44209639124029393930247375993629669338749966042856653556428540234515804939791650065905841618344611216577807325504984178760405516121845853248373571704473449826683120387747977520655432396578361308033763778324817416507993263234206797363191089863381905902638111246229641698709383653501799974217118168526572365797</span></span><br><span class="line">dR= <span class="number">60735172709413093730902464873458655487237612458970735840670987186877666190533417038325630420791294593669609785154204677845781980482700493870590706892523016041087206844082222225206703139282240453277802870868459288354322845410191061009582969848870045522383447751431300627611762289800656277924903605593069856921</span></span><br><span class="line">c= <span class="number">93063188325241977486352111369210103514669725591157371105152980481620575818945846725056329712195176948376321676112726029400835578531311113991944495646259750817465291340479809938094295621728828133981781064352306623727112813796314947081857025012662546178066873083689559924412320123824601550896063037191589471066773464829226873338699012924080583389032903142107586722373131642720522453842444615499672193051587154108368643495983197891525747653618742702589711752256009</span></span><br><span class="line"></span><br><span class="line">cp = <span class="built_in">pow</span>(c,dP,q*r)</span><br><span class="line">cq = <span class="built_in">pow</span>(c,dQ,p*r)</span><br><span class="line">cr = <span class="built_in">pow</span>(c,dR,p*q)</span><br><span class="line"></span><br><span class="line">N = [q*r,p*r,p*q]</span><br><span class="line">C = [cp,cq,cr]</span><br><span class="line">M = crt(N,C)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(M))</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;CRT_1s_f3n_but_Gen3hi_im9act_is_a_balabalaba&#125;</span></span><br></pre></td></tr></table></figure>
<p>然后就发现，这明文并不长，所以随便用一个模下的m都可以直接出结果，并不需要CRT。</p>
<p><br></p>
<p><br></p>
<h2 id="Week-3"><a href="#Week-3" class="headerlink" title="Week 3"></a>Week 3</h2><h3 id="Quick-Robert"><a href="#Quick-Robert" class="headerlink" title="Quick_Robert"></a>Quick_Robert</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 59.110.20.54:3042 https://en.wikipedia.org/wiki/Quadratic_residue</span><br></pre></td></tr></table></figure>
<p>题目没有给源码，nc上去后发现有proof_of_work，那么把proof过掉后靶机会发送题目任务如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><br><span class="line"></span><br><span class="line">Hi Crypto-ers! AL3XEI Here. In number theory, <span class="keyword">if</span> there exists an integer q satisfying x^<span class="number">2</span>=q(mod n), q <span class="keyword">is</span> so called a quadratic residue.</span><br><span class="line">We write this calculation <span class="keyword">as</span> L(a,p), which its value shows a <span class="keyword">is</span> <span class="keyword">or</span> <span class="keyword">is</span> <span class="keyword">not</span> quadratic residue modulo p.</span><br><span class="line">Below, you need to give me the answer of the <span class="built_in">sum</span> of L(a*l**<span class="number">2</span>+b*l+<span class="number">1</span>,p), where a,b are integers, p <span class="keyword">is</span> a prime, <span class="keyword">and</span> l rise <span class="keyword">from</span> <span class="number">0</span> to p-<span class="number">1.</span></span><br><span class="line">For example, given a = <span class="number">2</span>, b = <span class="number">3</span>, c = <span class="number">1</span>, p = <span class="number">5</span>, the answer will be</span><br><span class="line">L(<span class="number">1</span>, <span class="number">5</span>) + L(<span class="number">6</span>, <span class="number">5</span>) + L(<span class="number">15</span>, <span class="number">5</span>) + L(<span class="number">28</span>, <span class="number">5</span>) + L(<span class="number">45</span>, <span class="number">5</span>) = <span class="number">1.</span>      </span><br><span class="line">Hope you success!</span><br><span class="line"></span><br><span class="line">||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><br><span class="line"></span><br><span class="line"><span class="number">1809</span> * l**<span class="number">2</span> + <span class="number">204</span> * l + <span class="number">1</span></span><br><span class="line">p = <span class="number">191</span> (<span class="number">8</span> bits)</span><br><span class="line"></span><br><span class="line">&gt; <span class="type">Type</span> your answer:</span><br></pre></td></tr></table></figure>
<p>大致描述一下题目任务：</p>
<ul>
<li>L(a,p)是一个函数，根据a是模p下的二次剩余还是二次非剩余有不同的取值。按照例子的话，我认为应该是：</li>
</ul>
<script type="math/tex; mode=display">
\begin{equation}
L(a,p)=\left\{
    \begin{aligned}
    0 \quad a是模p下的二次剩余\\
    1 \quad a是模p下二次非剩余\\
    \end{aligned}
    \right
    .
\end{equation}</script><ul>
<li>然后，题目要求计算如下累加式并返回答案，答案正确即可进入下一轮：</li>
</ul>
<script type="math/tex; mode=display">
\sum_{l=0}^{p-1}{L(al^2+bl+1,p)}</script><p>没什么其他思路，不过第一轮p只有8bit所以可以先用欧拉判别式暴力计算一遍，然后会发现一个很巧的事实：</p>
<p>对于所有的 $ l \in [0,p-1]$，都有al^2+bl+1是模p下的二次剩余。多切几组数字也是这样的。</p>
<p>那这难道是个什么结论吗？并不是。因为如果自己生成一组a、b、p的话，基本上是满足不了这个结论的。说明这个a、b、p肯定是取的满足某个性质的特殊值。经过测试发现：给的a、b均满足a是二次剩余，且满足下面的完全平方式：</p>
<script type="math/tex; mode=display">
t^2 = a</script><script type="math/tex; mode=display">
ax^2+bx+1 = (tx+1)^2 \quad(mod\;p)</script><p>测试脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">a,b,c,p = <span class="number">1809</span>,<span class="number">204</span>,<span class="number">1</span>,<span class="number">191</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f = x^<span class="number">2</span> - a</span><br><span class="line">t = f.roots()</span><br><span class="line"></span><br><span class="line"><span class="comment">#ax^2+bx+1 -&gt; (tx+1)^2</span></span><br><span class="line"><span class="built_in">print</span>(b%p)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> t:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">int</span>(i[<span class="number">0</span>])*<span class="number">2</span>%p)</span><br></pre></td></tr></table></figure>
<p>所以才有为什么全部都是二次剩余。那么照这样来说我们每次传0给靶机就好。</p>
<p>但是实际上并不是这样的，测试出来需要每次传p-1给靶机，不知道是例子给错了还是什么情况，反正题目肯定是有点小问题。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 proof		</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">	table = string.digits + string.ascii_letters</span><br><span class="line">	temp = r.recvuntil(<span class="string">b&quot;sha256(XXXX+&quot;</span>)</span><br><span class="line">	temp = r.recvline()</span><br><span class="line">	suffix = temp[:<span class="number">16</span>].decode()</span><br><span class="line">	hex1 = temp[<span class="number">20</span>:].strip().decode()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> tqdm(table):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> table:</span><br><span class="line">				<span class="keyword">for</span> m <span class="keyword">in</span> table:</span><br><span class="line">					temp1 = i+j+k+m</span><br><span class="line">					<span class="keyword">if</span>(sha256((temp1+suffix).encode()).hexdigest() == hex1):</span><br><span class="line">						r.sendline(temp1.encode())</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>,<span class="number">3042</span>)</span><br><span class="line">proof_of_work()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 calculate</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_coeffcients</span>(<span class="params">expression</span>):</span><br><span class="line">	<span class="comment"># 定义匹配系数的正则表达式</span></span><br><span class="line">    pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(-?\d+)\s*\*\s*l\*\*2|(-?\d+)\s*\*\s*l|(-?\d+)&#x27;</span>)</span><br><span class="line">    <span class="comment"># 使用findall方法找到匹配的所有项</span></span><br><span class="line">    matches = pattern.findall(expression)</span><br><span class="line">    <span class="comment"># 将匹配结果转换为整数并存储在列表中</span></span><br><span class="line">    coefficients = [<span class="built_in">int</span>(<span class="keyword">match</span>[<span class="number">0</span>] <span class="keyword">or</span> <span class="keyword">match</span>[<span class="number">1</span>] <span class="keyword">or</span> <span class="keyword">match</span>[<span class="number">2</span>]) <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches]</span><br><span class="line">    <span class="keyword">return</span> coefficients</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_p</span>(<span class="params">equation</span>):</span><br><span class="line">    pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;\b\d+\b&#x27;</span>)</span><br><span class="line">    <span class="comment"># 使用search方法找到匹配的第一个数字</span></span><br><span class="line">    <span class="keyword">match</span> = pattern.search(equation)</span><br><span class="line">    p_value = <span class="built_in">int</span>(<span class="keyword">match</span>.group())</span><br><span class="line">    <span class="keyword">return</span> p_value</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&quot;|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):	</span><br><span class="line">	r.recvuntil(<span class="string">b&quot;|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||&quot;</span>)</span><br><span class="line">	r.recvline()</span><br><span class="line">	r.recvline()	</span><br><span class="line">	temp = r.recvline().strip().decode()		</span><br><span class="line">	a,b,c = find_coeffcients(temp)</span><br><span class="line">	p = find_p(r.recvline().strip().decode())</span><br><span class="line">	<span class="comment">#print(&quot;a,b,c,p = &quot;+str(a)+&quot;,&quot;+str(b)+&quot;,&quot;+str(c)+&quot;,&quot;+str(p))</span></span><br><span class="line">	r.recvuntil(<span class="string">b&quot;&gt; Type your answer:&quot;</span>)</span><br><span class="line">	r.sendline(<span class="built_in">str</span>(p-<span class="number">1</span>).encode())</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line"><span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;G00d!_u_4r3_Qu33n_0f_Quadratic&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h4><p>题目之后进行了update，对L函数作了详细说明，也就是勒让德符号：</p>
<script type="math/tex; mode=display">
\begin{equation}
L(a,p)=\left\{
    \begin{aligned}
    0 \quad a是模p下的某个因子\\
    1 \quad a是模p下的二次剩余\\
    -1 \quad a是模p下二次非剩余\\
    \end{aligned}
    \right
    .
\end{equation}</script><p>那么再看之前题目的例子就没问题了，回传p-1也是正确的。然后题目更新后还做了如下修改：</p>
<ul>
<li>每一轮的p都取了1000bit以上的大数</li>
<li>增加了三轮，现在需要通过十轮才有flag</li>
<li>a、b、p不再全部是特殊构造</li>
</ul>
<p>当然这个需要十轮是做出来才知道的。</p>
<p>然后我的做法也很简单，首先自己生成一些小的素数进行测试，找找规律：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calcsum</span>(<span class="params">a,b,c,p</span>):</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,p):</span><br><span class="line">        temp = a*i**<span class="number">2</span>+b*i+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(powmod(temp,(p-<span class="number">1</span>)//<span class="number">2</span>,p) == <span class="number">1</span>):</span><br><span class="line">            <span class="built_in">sum</span> += <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span>(powmod(temp,(p-<span class="number">1</span>)//<span class="number">2</span>,p) == p-<span class="number">1</span>):</span><br><span class="line">            <span class="built_in">sum</span> += -<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">sum</span> += <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    p = getPrime(<span class="number">18</span>)</span><br><span class="line">    a = random.randint(<span class="number">1</span>,p-<span class="number">1</span>)</span><br><span class="line">    b = random.randint(<span class="number">1</span>,p-<span class="number">1</span>)</span><br><span class="line">    c = <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(powmod(a,(p-<span class="number">1</span>)//<span class="number">2</span>,p),calcsum(a,b,c,p))</span><br></pre></td></tr></table></figure>
<p>然后就会发现测试出来，L函数的求和结果仅与a是否是模p下的二次剩余有关。如果a是模p下的二次剩余，求和结果为-1；否则为1。</p>
<p>当然还要考虑一种特殊情况，也就是update之前的那种特殊构造(虽然a、b如果是纯随机的话这种情况基本不太可能出现，但是出题人确实在题目中构造了这个情况)，我们用如下方法来核验是否能构成完全平方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(b*inverse(<span class="number">2</span>,p))**<span class="number">2</span> % p == a%p</span><br></pre></td></tr></table></figure>
<p>所以我们每次用以下条件语句，选择发送对应的求和结果给靶机就好：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>((b*inverse(<span class="number">2</span>,p))**<span class="number">2</span> % p == a%p):</span><br><span class="line">	res = p-<span class="number">1</span></span><br><span class="line"><span class="keyword">elif</span>(<span class="built_in">pow</span>(a,(p-<span class="number">1</span>)//<span class="number">2</span>,p) == <span class="number">1</span>):</span><br><span class="line">	res = -<span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	res = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 proof		</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">	table = string.digits + string.ascii_letters</span><br><span class="line">	temp = r.recvuntil(<span class="string">b&quot;sha256(XXXX+&quot;</span>)</span><br><span class="line">	temp = r.recvline()</span><br><span class="line">	suffix = temp[:<span class="number">16</span>].decode()</span><br><span class="line">	hex1 = temp[<span class="number">20</span>:].strip().decode()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> tqdm(table):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> table:</span><br><span class="line">				<span class="keyword">for</span> m <span class="keyword">in</span> table:</span><br><span class="line">					temp1 = i+j+k+m</span><br><span class="line">					<span class="keyword">if</span>(sha256((temp1+suffix).encode()).hexdigest() == hex1):</span><br><span class="line">						r.sendline(temp1.encode())</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>,<span class="number">3042</span>)</span><br><span class="line">proof_of_work()</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 calculate</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_coeffcients</span>(<span class="params">expression</span>):</span><br><span class="line">	<span class="comment"># 定义匹配系数的正则表达式</span></span><br><span class="line">	pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(-?\d+)\s*\*\s*l\*\*2|(-?\d+)\s*\*\s*l|(-?\d+)&#x27;</span>)</span><br><span class="line">	<span class="comment"># 使用findall方法找到匹配的所有项</span></span><br><span class="line">	matches = pattern.findall(expression)</span><br><span class="line">	<span class="comment"># 将匹配结果转换为整数并存储在列表中</span></span><br><span class="line">	coefficients = [<span class="built_in">int</span>(<span class="keyword">match</span>[<span class="number">0</span>] <span class="keyword">or</span> <span class="keyword">match</span>[<span class="number">1</span>] <span class="keyword">or</span> <span class="keyword">match</span>[<span class="number">2</span>]) <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches]</span><br><span class="line">	<span class="keyword">return</span> coefficients</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_p</span>(<span class="params">equation</span>):</span><br><span class="line">	pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;\b\d+\b&#x27;</span>)</span><br><span class="line">	<span class="comment"># 使用search方法找到匹配的第一个数字</span></span><br><span class="line">	<span class="keyword">match</span> = pattern.search(equation)</span><br><span class="line">	p_value = <span class="built_in">int</span>(<span class="keyword">match</span>.group())</span><br><span class="line">	<span class="keyword">return</span> p_value</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&quot;|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">10</span>):	</span><br><span class="line">	r.recvuntil(<span class="string">b&quot;|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||&quot;</span>)</span><br><span class="line">	r.recvline()</span><br><span class="line">	r.recvline()	</span><br><span class="line">	temp = r.recvline().strip().decode()</span><br><span class="line">	</span><br><span class="line">	a,b,c = find_coeffcients(temp)</span><br><span class="line">	p = find_p(r.recvline().strip().decode())</span><br><span class="line">	<span class="comment">#print(&quot;a,b,c,p = &quot;+str(a)+&quot;,&quot;+str(b)+&quot;,&quot;+str(c)+&quot;,&quot;+str(p))</span></span><br><span class="line">	r.recvuntil(<span class="string">b&quot;&gt; Type your answer:&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span>((b*inverse(<span class="number">2</span>,p))**<span class="number">2</span> % p == a%p):</span><br><span class="line">		res = p-<span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span>(<span class="built_in">pow</span>(a,(p-<span class="number">1</span>)//<span class="number">2</span>,p) == <span class="number">1</span>):</span><br><span class="line">		res = -<span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		res = <span class="number">1</span></span><br><span class="line">	r.sendline(<span class="built_in">str</span>(res).encode())</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line"><span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;G00d!_u_4r3_Qu33n_0f_Quadratic&#125;</span></span><br></pre></td></tr></table></figure>
<p>当然，题做完了还是要想想，排除掉能构成完全平方式的特殊情况后，为什么这个求和结果只与a是否是模p下的二次剩余有关。这个问题抽象出来其实就是勒让德符号求和，于是搜索关键词可以搜索到下面这篇文章：</p>
<p><a target="_blank" rel="noopener" href="https://imomath.com/index.cgi?page=quadraticCongruencesSumsLegendreSymbols">https://imomath.com/index.cgi?page=quadraticCongruencesSumsLegendreSymbols</a></p>
<p>这里阐述一下他的证明思路。</p>
<h5 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h5><p>首先需要知道一个引理：</p>
<blockquote>
<p>去除0，模p的完全剩余系中有(p-1)/2个二次剩余，有(p-1)/2个二次非剩余</p>
</blockquote>
<p>这个引理的证明也很简单，首先知道：</p>
<script type="math/tex; mode=display">
对于 \forall x \in(0,p),(\frac{x^2}{p}) = 1</script><p>也就是x^2形式的数均为二次剩余，这样也能求出模p下的全部二次剩余。而由于(p-x)^2和x^2模p下相同，因此可以两两配对，也就是模p的完全剩余系下共有(p-1)/2个二次剩余，剩下的(p-1)/2个数自然也就是二次非剩余。</p>
<p>有了这个引理后，我们先从最简单的情况开始，考虑对如下形式的f(x)求勒让德符号的和：</p>
<script type="math/tex; mode=display">
f(x) = ax+b</script><script type="math/tex; mode=display">
sum = \sum_{x=0}^{p-1}(\frac{f(x)}{p})</script><p>显然，由于ax+b也构成模p下的完全剩余系，所以同样有(p-1)/2个x使得f(x)是二次剩余，(p-1)/2个x使得f(x)是二次非剩余，然后还有一个x使得f(x)为0，因此求和结果是：</p>
<script type="math/tex; mode=display">
sum = \sum_{x=0}^{p-1}(\frac{f(x)}{p}) = 1*\frac{p-1}{2}+(-1)*\frac{p-1}{2}+0 = 0</script><h5 id="回到题目"><a href="#回到题目" class="headerlink" title="回到题目"></a>回到题目</h5><p>然后回到我们求勒让德符号和的f(x)形式，也就是：</p>
<script type="math/tex; mode=display">
f(x) = ax^2+bx+c</script><script type="math/tex; mode=display">
sum = \sum_{x=0}^{p-1}(\frac{f(x)}{p})</script><p>那么首先对f(x)进行一点处理，由于：</p>
<script type="math/tex; mode=display">
4af(x) = 4ax^2+4abx+4ac = (2ax+b)^2 - (b^2 - 4ac)</script><p>那么对于f(x)的勒让德符号有：</p>
<script type="math/tex; mode=display">
(\frac{4af(x)}{p}) = (\frac{4a}{p})(\frac{f(x)}{p})</script><p>所以对于我们需要求的和sum，可以写作：</p>
<script type="math/tex; mode=display">
\sum_{x=0}^{p-1}(\frac{4af(x)}{p}) = (\frac{4a}{p})\sum_{x=0}^{p-1}(\frac{f(x)}{p})</script><p>移项就得到(移项基于勒让德符号只有1、-1、0三个取值)：</p>
<script type="math/tex; mode=display">
sum = \sum_{x=0}^{p-1}(\frac{f(x)}{p}) = (\frac{4a}{p})\sum_{x=0}^{p-1}(\frac{4af(x)}{p})
=
(\frac{4a}{p})\sum_{x=0}^{p-1}(\frac{(2ax+b)^2 - (b^2 - 4ac)}{p})</script><p>而之所以要把x化成这个形式，是因为这样可以发现：2ax+b也构成了模p下的完全剩余系，所以其实(2ax+b)^2效果和x^2相同，然后我们把b^2-4ac记作D(就像二次函数的判别式)，，并且，由于勒让德符号的完全积性，(4a,p)=(a,p)，因此sum的表达式可以进一步简化为：</p>
<script type="math/tex; mode=display">
sum = (\frac{a}{p})\sum_{x=0}^{p-1}(\frac{x^2 - D}{p})</script><p>那么问题就简化成了求解出下面这个表达式的值：</p>
<script type="math/tex; mode=display">
\sum_{x=0}^{p-1}(\frac{x^2 - D}{p})</script><p>然后要求解这个式子又需要引入一个定理，这里我直接截图：</p>
<p><img src="/post/6f77578c/image-20231113142925845.png" alt="image-20231113142925845"></p>
<p>这个定理对我们现在推导的贡献是，他告诉我们以下式子的值为：</p>
<script type="math/tex; mode=display">
\sum_{x=0}^{p-1}(\frac{x^2 - D}{p}) \equiv -1 \quad(mod\;p)</script><p>而由于勒让德符号只有1、-1、0三个取值，所以就有：</p>
<script type="math/tex; mode=display">
\sum_{x=0}^{p-1}(\frac{x^2 - D}{p}) = -1 或p-1</script><p>那值在什么时候会分别取到-1和p-1呢？可以想到，如果等于p-1，那么对除了x^2-D零点以外的所有x，都有：</p>
<script type="math/tex; mode=display">
(\frac{x^2 - D}{p}) = 1</script><p>这也就是说所有x^-D都是模p下的二次剩余，因此只可能D是p的倍数。而此外的其他情况就有：</p>
<script type="math/tex; mode=display">
\sum_{x=0}^{p-1}(\frac{x^2 - D}{p}) = -1</script><p>然后由之前的推导有：</p>
<script type="math/tex; mode=display">
sum = (\frac{a}{p})\sum_{x=0}^{p-1}(\frac{x^2 - D}{p})</script><p>所以再排除了能构成完全平方式的情况后，我们只需要判断a是否是模p下的二次剩余就可以求解sum了。</p>
<p><br></p>
<p><br></p>
<h3 id="Diligent-Liszt"><a href="#Diligent-Liszt" class="headerlink" title="Diligent_Liszt"></a>Diligent_Liszt</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://en.wikipedia.org/wiki/Discrete_logarithm</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp </span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">DEBUG = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&quot;SYC&quot;</span>)</span><br><span class="line">nbits = <span class="number">512</span></span><br><span class="line">g = <span class="number">3</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_p_1</span>(<span class="params">digit</span>):</span><br><span class="line">    primes = []</span><br><span class="line">    pri = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">len</span>(primes)&lt;<span class="number">100</span>):</span><br><span class="line">        pri = gp.next_prime(pri)</span><br><span class="line">        primes.append(<span class="built_in">int</span>(pri))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        count = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> count &lt; <span class="number">2</span>**digit:</span><br><span class="line">            count *= random.choice(primes)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(gp.is_prime(count)):</span><br><span class="line">            <span class="keyword">return</span> count</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">p,q,r = [gen_p_1(nbits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;pqr&quot;</span>] </span><br><span class="line"></span><br><span class="line">n = p*q*r </span><br><span class="line">x = bytes_to_long(flag) </span><br><span class="line">y = gp.powmod(g,x,n) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(p))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(q))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;r = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(r))   </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;y = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(y)) </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> DEBUG:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;x = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(x)) </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 1068910928091265978478887270179608140018534288604159452828300604294675735481804963679672853224192480667904101881092533866322948043654533322038484907159945421</span></span><br><span class="line"><span class="string">q = 1711302770747802020613711652777299980542669713888988077474955896217408515180094849053961025086865697904731088087532944829046702427480842253022459937172565651</span></span><br><span class="line"><span class="string">r = 132969813572228739353704467775972551435751558645548804253458782569132362201099158857093676816706297676454547299888531536236748314013888413096371966359860637</span></span><br><span class="line"><span class="string">y = 5385116324746699759660077007129548063211490907227715474654765255668507958312745677683558789874078477569613259930365612562164095274660123330458355653249805062678976259429733060364358954180439218947514191603330532117142653558803034110759332447742304749985874760435453594107494324797235909651178472904825071375135846093354526936559640383917210702874692725723836865724807664892994298377375580807917514349966834376413176898806591411038129330967050554114677719107335006266</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>题目中三个数均满足p-1光滑，那么如果不给p、q、r分别的值也能分解出来。既然直接给了，那就分开用pohlig-hellman求DLP后再crt起来就好。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"></span><br><span class="line">p = <span class="number">1068910928091265978478887270179608140018534288604159452828300604294675735481804963679672853224192480667904101881092533866322948043654533322038484907159945421</span></span><br><span class="line">q = <span class="number">1711302770747802020613711652777299980542669713888988077474955896217408515180094849053961025086865697904731088087532944829046702427480842253022459937172565651</span></span><br><span class="line">r = <span class="number">132969813572228739353704467775972551435751558645548804253458782569132362201099158857093676816706297676454547299888531536236748314013888413096371966359860637</span></span><br><span class="line">y = <span class="number">5385116324746699759660077007129548063211490907227715474654765255668507958312745677683558789874078477569613259930365612562164095274660123330458355653249805062678976259429733060364358954180439218947514191603330532117142653558803034110759332447742304749985874760435453594107494324797235909651178472904825071375135846093354526936559640383917210702874692725723836865724807664892994298377375580807917514349966834376413176898806591411038129330967050554114677719107335006266</span></span><br><span class="line">g = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">xp = discrete_log(mod(y,p),mod(g,p))</span><br><span class="line">xq = discrete_log(mod(y,q),mod(g,q))</span><br><span class="line">xr = discrete_log(mod(y,r),mod(g,r))</span><br><span class="line"></span><br><span class="line">n = [p-<span class="number">1</span>,q-<span class="number">1</span>,r-<span class="number">1</span>]</span><br><span class="line">c = xp,xq,xr</span><br><span class="line">M = crt(n,c)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(M)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;D1scr3te_L0g_W1th_Mult1pl3_pr1m35&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="card-game"><a href="#card-game" class="headerlink" title="card_game"></a>card_game</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AL3XEI送给了你这个游戏的关键数据，你能预测接下来要出的牌吗 nc 59.110.20.54 4953</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> cards <span class="keyword">import</span> Heart, Spade, Club, Diamond</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choose_card</span>(<span class="params">num</span>):</span><br><span class="line">    x = (num&gt;&gt;<span class="number">5</span>)%<span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (Heart[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Heart&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> x%<span class="number">4</span> == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> (Spade[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Spade&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> x%<span class="number">4</span> == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> (Diamond[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Diamond&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (Club[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Club&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GAME</span>():</span><br><span class="line">    banner = <span class="string">&#x27;&#x27;&#x27; </span></span><br><span class="line"><span class="string"> ####    ##   #####  #####      ####    ##   #    # ###### </span></span><br><span class="line"><span class="string">#    #  #  #  #    # #    #    #    #  #  #  ##  ## #      </span></span><br><span class="line"><span class="string">#      #    # #    # #    #    #      #    # # ## # #####  </span></span><br><span class="line"><span class="string">#      ###### #####  #    #    #  ### ###### #    # #      </span></span><br><span class="line"><span class="string">#    # #    # #   #  #    #    #    # #    # #    # #      </span></span><br><span class="line"><span class="string"> ####  #    # #    # #####      ####  #    # #    # ######</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line"></span><br><span class="line">    meum = <span class="string">&#x27;&#x27;&#x27;option:</span></span><br><span class="line"><span class="string">    1: start game</span></span><br><span class="line"><span class="string">    2: get hint</span></span><br><span class="line"><span class="string">    3: exit</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(meum)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;input your option: &#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        your_input = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> your_input == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            n = getPrime(<span class="number">36</span>)</span><br><span class="line">            m = getPrime(<span class="number">16</span>)</span><br><span class="line">            c = getPrime(<span class="number">16</span>)</span><br><span class="line">            seed = getPrime(<span class="number">36</span>)</span><br><span class="line">            out = seed</span><br><span class="line">            <span class="built_in">round</span> = <span class="number">0</span></span><br><span class="line">            score = <span class="number">0</span></span><br><span class="line">            res = []</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="built_in">round</span> += <span class="number">1</span></span><br><span class="line">                res = []</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;round:<span class="subst">&#123;<span class="built_in">round</span>&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;score:<span class="subst">&#123;score&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">3</span>):</span><br><span class="line">                    out = (out*m+c)%n</span><br><span class="line">                    res.append(out)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">round</span> == <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">                        card, suit = choose_card(i)</span><br><span class="line">                        <span class="built_in">print</span>(card)</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">round</span>==<span class="number">2</span> <span class="keyword">or</span> <span class="built_in">round</span>==<span class="number">3</span>:  <span class="comment">#gift</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">                        card, suit = choose_card(i)</span><br><span class="line">                        <span class="built_in">print</span>(card)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&#x27;gift: <span class="subst">&#123;res&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    cards = []</span><br><span class="line">                    suits = []</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(res)):</span><br><span class="line">                        card, suit = choose_card(res[i])</span><br><span class="line">                        cards.append(card)</span><br><span class="line">                        suits.append(suit)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Give me your guess: (example: Heart_1 Club_2 Diamond_3)&quot;</span>)  </span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        g_1, g_2, g_3 = <span class="built_in">input</span>().split()</span><br><span class="line">                        g_1, g_2, g_3 = g_1.split(<span class="string">&#x27;_&#x27;</span>), g_2.split(<span class="string">&#x27;_&#x27;</span>), g_3.split(<span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">                    <span class="keyword">except</span> ValueError:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Please enter in the correct format.&quot;</span>)</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    <span class="keyword">if</span> (g_1[<span class="number">0</span>] == suits[<span class="number">0</span>] <span class="keyword">and</span> g_1[<span class="number">1</span>] == cards[<span class="number">0</span>][<span class="number">15</span>]) <span class="keyword">and</span> (g_2[<span class="number">0</span>] == suits[<span class="number">1</span>] <span class="keyword">and</span> g_2[<span class="number">1</span>] == cards[<span class="number">1</span>][<span class="number">15</span>]) <span class="keyword">and</span> (g_3[<span class="number">0</span>] == suits[<span class="number">2</span>] <span class="keyword">and</span> g_3[<span class="number">1</span>] == cards[<span class="number">2</span>][<span class="number">15</span>]):</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> cards:</span><br><span class="line">                            <span class="built_in">print</span>(i)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Congratulations! You matched the cards!&quot;</span>)</span><br><span class="line">                        score += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> cards:</span><br><span class="line">                            <span class="built_in">print</span>(i)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Try again!&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> score == <span class="number">50</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;The flag is your reward!&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(flag)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> your_input == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Have you ever heard of LCG?&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> your_input == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    GAME()</span><br></pre></td></tr></table></figure>
<p>card文件是给了很多如下形式的牌面字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">┌─────────┐</span></span><br><span class="line"><span class="string">│ A       │</span></span><br><span class="line"><span class="string">│         │</span></span><br><span class="line"><span class="string">│    ♥    │</span></span><br><span class="line"><span class="string">│         │</span></span><br><span class="line"><span class="string">│       A │</span></span><br><span class="line"><span class="string">└─────────┘&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>总的说来，题目代码很长，但是实际上仔细看完过后会发现考的东西真的很简单，我猜可能是有升级版的题目在后面，不然感觉有点浪费。</p>
<p>任务是这样的，题目给我们提供了三个选项，但是其实只有输入1有用。输入1后会发生：</p>
<ul>
<li>随机生成n、m、c、seed四个数，用这四个数实现以下的LCG：</li>
</ul>
<script type="math/tex; mode=display">
x = mx+c \quad(mod\;n)</script><ul>
<li>然后游戏开始，每一轮，用这个LCG生成三个数，并用这三个数计算牌的数字和花色</li>
<li>在第二轮和第三轮，会额外给出这一轮的三个数的值</li>
<li>从第四轮开始，要求我们预测这一轮的三张牌的数字和花色，预测正确则加一分，分数达到50就给flag</li>
</ul>
<p>而根据数字得到牌的计算方式choose_card(num)是题目给了我们的，所以目标就是得到LCG的每一轮的三个数的值。而我们有第二轮和第三轮的共六个LCG的数字序列。那么就可以完全复原LCG的各个参数m、c、n，然后就往后预测就可以了。</p>
<p>然后有一点需要注意，每一次发送的形式应该是如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(example: Heart_1 Club_2 Diamond_3)</span><br></pre></td></tr></table></figure>
<p>然后注意到他的牌的数字是这么取的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cards[<span class="number">0</span>][<span class="number">15</span>]</span><br></pre></td></tr></table></figure>
<p>也就是每张牌的第十五个字符。比如对于A：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">┌─────────┐</span></span><br><span class="line"><span class="string">│ A       │</span></span><br><span class="line"><span class="string">│         │</span></span><br><span class="line"><span class="string">│    ♥    │</span></span><br><span class="line"><span class="string">│         │</span></span><br><span class="line"><span class="string">│       A │</span></span><br><span class="line"><span class="string">└─────────┘&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>第十五个字符就恰好是A。然而对于10就不太一样了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">┌─────────┐</span></span><br><span class="line"><span class="string">│10       │</span></span><br><span class="line"><span class="string">│         │</span></span><br><span class="line"><span class="string">│    ♥    │</span></span><br><span class="line"><span class="string">│         │</span></span><br><span class="line"><span class="string">│       10│</span></span><br><span class="line"><span class="string">└─────────┘&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>其第十五个字符应该是0。所以要留意一下这个小细节。不过其实无伤大雅，因为就算猜错了他也不会退出，而还能继续猜，所以只要够50分就可以。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> powmod</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_LCG</span>(<span class="params">sequence</span>):</span><br><span class="line">    c1,c2,c3,c4,c5,c6 = sequence</span><br><span class="line"></span><br><span class="line">    t1 = c2-c1</span><br><span class="line">    t2 = c3-c2</span><br><span class="line">    t3 = c4-c3</span><br><span class="line">    t4 = c5-c4</span><br><span class="line">    T1 = t4*t2 - t3*t3</span><br><span class="line">    T2 = t3*t1 - t2*t2</span><br><span class="line">    n = GCD(T1,T2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">1000</span>):</span><br><span class="line">        <span class="keyword">while</span>(n % i == <span class="number">0</span>):</span><br><span class="line">            n //= i</span><br><span class="line"></span><br><span class="line">    m = inverse((c2-c1),n)*(c3-c2) % n</span><br><span class="line">    c = (-m*c2 + c3) % n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> m,c,n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getnext</span>(<span class="params">out,m,c,n</span>):</span><br><span class="line">    next_out = [out[-<span class="number">1</span>]]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        next_out.append((m*next_out[-<span class="number">1</span>]+c)%n)</span><br><span class="line">    <span class="keyword">return</span> next_out[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_card</span>(<span class="params">out</span>):</span><br><span class="line">    table_num = [<span class="string">&quot;A&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>,<span class="string">&quot;4&quot;</span>,<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;7&quot;</span>,<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>,<span class="string">&quot;0&quot;</span>,<span class="string">&quot;J&quot;</span>,<span class="string">&quot;Q&quot;</span>,<span class="string">&quot;K&quot;</span>]</span><br><span class="line">    table_suits = [<span class="string">&#x27;Heart&#x27;</span>,<span class="string">&#x27;Spade&#x27;</span>,<span class="string">&#x27;Diamond&#x27;</span>,<span class="string">&#x27;Club&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    res = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> out:</span><br><span class="line">        suits_order = (i &gt;&gt; <span class="number">5</span>) % <span class="number">4</span></span><br><span class="line">        num_order = (i &gt;&gt; <span class="number">6</span>) % <span class="number">13</span></span><br><span class="line">        res += (table_suits[suits_order] + <span class="string">&quot;_&quot;</span> + table_num[num_order] + <span class="string">&quot; &quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">    </span><br><span class="line">sequence = []</span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>,<span class="number">4953</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;input your option:&quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;gift: &quot;</span>)</span><br><span class="line">sequence += <span class="built_in">eval</span>(r.recvline().decode().strip())</span><br><span class="line">r.recvuntil(<span class="string">b&quot;gift: &quot;</span>)</span><br><span class="line">sequence += <span class="built_in">eval</span>(r.recvline().decode().strip())</span><br><span class="line">m,c,n = solve_LCG(sequence)</span><br><span class="line">out = getnext(sequence,m,c,n)</span><br><span class="line">res = gen_card(out)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;(example: Heart_1 Club_2 Diamond_3)&quot;</span>)</span><br><span class="line">r.sendline(res.encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">49</span>):</span><br><span class="line">    out = getnext(out,m,c,n)</span><br><span class="line">    res = gen_card(out)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;(example: Heart_1 Club_2 Diamond_3)&quot;</span>)</span><br><span class="line">    r.sendline(res.encode())</span><br><span class="line">r.recvuntil(<span class="string">b&quot;The flag is your reward!&quot;</span>)</span><br><span class="line">r.recvline()</span><br><span class="line"><span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;lcg_a@@@@@ttack&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="Week-4"><a href="#Week-4" class="headerlink" title="Week 4"></a>Week 4</h2><h3 id="EzComplex"><a href="#EzComplex" class="headerlink" title="EzComplex"></a>EzComplex</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">And u, my friend:  Complex factors! (In a double sense)</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage9.3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;FAKE&#123;Do_You_know_Complex_numbers&#125;&#x27;</span></span><br><span class="line">p = random_prime(<span class="number">1</span> &lt;&lt; <span class="number">384</span>)</span><br><span class="line">q = random_prime(<span class="number">1</span> &lt;&lt; <span class="number">384</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">N = <span class="built_in">pow</span>(p, <span class="number">2</span>) + <span class="built_in">pow</span>(q, <span class="number">2</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(N)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">122977267154486898127643454001467185956864368276013342450998567212966113302012584153291519651365278888605594000436279106907163024162771486315220072170917153855370362692990814276908399943293854077912175867886513964032241638851526276</span></span><br><span class="line"><span class="string">973990451943921675425625260267293227445098713194663380695161260771362036776671793195525239267004528550439258233703798932349677698127549891815995206853756301593324349871567926792912475619794804691721625860861059975526781239293017498</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>题目给了一个额外信息N如下，要求给出n的分解：</p>
<script type="math/tex; mode=display">
N = p^2 + q^2</script><p>结合题目名字complex，可以把这个数字放在复数域中分解，这是因为：</p>
<script type="math/tex; mode=display">
N = (p+qi)(p-qi)</script><p>因此在复数域中分解，并遍历所有可能的因子就能得到p和q。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = <span class="number">122977267154486898127643454001467185956864368276013342450998567212966113302012584153291519651365278888605594000436279106907163024162771486315220072170917153855370362692990814276908399943293854077912175867886513964032241638851526276</span></span><br><span class="line">N = <span class="number">973990451943921675425625260267293227445098713194663380695161260771362036776671793195525239267004528550439258233703798932349677698127549891815995206853756301593324349871567926792912475619794804691721625860861059975526781239293017498</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">zn = ZZ[i](N)</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> divisors(zn):</span><br><span class="line">    p = <span class="built_in">int</span>(d[<span class="number">0</span>])</span><br><span class="line">    q = <span class="built_in">int</span>(d[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> isPrime(q) <span class="keyword">and</span> p.bit_length() &gt; <span class="number">380</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">n  = p*q</span><br><span class="line">d = inverse(e,phi)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n))))</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;D0_you_like_r41n?_i_pref3r_R1_ng&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="ext-7gcd"><a href="#ext-7gcd" class="headerlink" title="ext^7gcd"></a>ext^7gcd</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">题目链接：nc 59.110.20.54:1789 （下sagemath! 不下的统统发配到安东星当嘿奴！）</span><br></pre></td></tr></table></figure>
<p>又是一个没有附件的题目，通过proof后我们可以看见题目内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><br><span class="line"></span><br><span class="line">Hi Crypto-ers! AL3XEI here. Solving extended gcd over <span class="number">2</span> primes can be easy, but what about <span class="number">7</span> primes?</span><br><span class="line">primes : [<span class="number">938770989594038574883307091377</span>, <span class="number">731124780451059048515699872973</span>, <span class="number">705906522337130351303390881793</span>, <span class="number">1259253321424214851154594220511</span>, <span class="number">638192849150199238389371476021</span>, <span class="number">1160157641563492827848830377527</span>, <span class="number">1225294646722407790694425867847</span>] ( <span class="number">100</span> bits )</span><br><span class="line">Give me a0,...a5,a6:</span><br></pre></td></tr></table></figure>
<p>题目意思也很明确，要求我们对7个素数求出扩展欧几里得的结果，也就是找到a0、a1、…a6满足：</p>
<script type="math/tex; mode=display">
\sum_{i=0}^{6}{a_ip_i} = d</script><p>其中d是7个素数的最大公约数，所以也就是1。并且经测试是不能发送0给靶机的。</p>
<p>我的做法也很简单，首先对前六个数两两使用exgcd，使得：</p>
<script type="math/tex; mode=display">
a_1p_1 + b_1p_2 = 1</script><script type="math/tex; mode=display">
a_2p_3 + b_2p_4 = 1</script><script type="math/tex; mode=display">
a_3p_5 + b_3p_6 = 1</script><p>所以就有：</p>
<script type="math/tex; mode=display">
(a_1p_1 + b_1p_2) + (a_2p_3 + b_2p_4) + (a_3p_5 + b_3p_6) = 3</script><p>然后再将3与最后一个素数做exgcd，就有：</p>
<script type="math/tex; mode=display">
a_4((a_1p_1 + b_1p_2) + (a_2p_3 + b_2p_4) + (a_3p_5 + b_3p_6)) + b_4p_7 = 1</script><p>将对应系数发送过去即可。测试后知道共有15轮挑战，并且发送的格式是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a,b,c,d,e,f,g</span><br></pre></td></tr></table></figure>
<p>也就是列表不带两边括号的形式。</p>
<p>然后如果限制只有不能发送0的话，那么方法太多太多了。比如想个简单一点的先让后六个a为1，然后把后六个素数的和与第一个素数做exgcd即可。再麻烦一点，甚至可以构造一个下面这样的格：</p>
<script type="math/tex; mode=display">
L=
\left(\begin{matrix}
-K & & & & &  & & \\
Kp_1 & 1& & & &  & & \\
Kp_2 & & 1& & &  & & \\
Kp_3 & & & 1& &  & & \\
Kp_4 & & & & 1&  & & \\
Kp_5 & & & & & 1 & & \\
Kp_6 & & & & &  & 1& \\
Kp_7 & & & & &  & & 1\\
\end{matrix}\right)</script><p>这是因为当满足题目需要的exgcd要求 $ \sum_{i=1}^{7}{a_ip_i} = 1 $时，这个格具有下面的线性关系：</p>
<script type="math/tex; mode=display">
(1,a_1,a_2,a_3,a_4,a_5,a_6,a_7)
\left(\begin{matrix}
-K & & & & &  & & \\
Kp_1 & 1& & & &  & & \\
Kp_2 & & 1& & &  & & \\
Kp_3 & & & 1& &  & & \\
Kp_4 & & & & 1&  & & \\
Kp_5 & & & & & 1 & & \\
Kp_6 & & & & &  & 1& \\
Kp_7 & & & & &  & & 1\\
\end{matrix}\right)
=(0,a_1,a_2,a_3,a_4,a_5,a_6,a_7)</script><p>所以可以规约出我们需要的ai向量，而之所以第一列乘上大系数K是为了保证第一项规约出0。不过既然有很多简单方法可选，这个方法就没太大必要了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256,sha1</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcdext</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">	table = string.digits + string.ascii_letters</span><br><span class="line">	temp = r.recvuntil(<span class="string">b&quot;sha256(XXXX+&quot;</span>)</span><br><span class="line">	temp = r.recvline()</span><br><span class="line">	suffix = temp[:<span class="number">16</span>].decode()</span><br><span class="line">	hex1 = temp[<span class="number">20</span>:].strip().decode()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> tqdm(table):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> table:</span><br><span class="line">				<span class="keyword">for</span> m <span class="keyword">in</span> table:</span><br><span class="line">					temp1 = i+j+k+m</span><br><span class="line">					<span class="keyword">if</span>(sha256((temp1+suffix).encode()).hexdigest() == hex1):</span><br><span class="line">						r.sendline(temp1.encode())</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line">					</span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>, <span class="number">1789</span>)</span><br><span class="line">proof_of_work()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">round</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">	r.recvuntil(<span class="string">b&#x27;primes :&#x27;</span>)</span><br><span class="line">	primes = <span class="built_in">eval</span>(r.recvline().strip().decode().split(<span class="string">&quot;(&quot;</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">	d,a1,b1 = gcdext(primes[<span class="number">0</span>],primes[<span class="number">1</span>])</span><br><span class="line">	d,a2,b2 = gcdext(primes[<span class="number">2</span>],primes[<span class="number">3</span>])</span><br><span class="line">	d,a3,b3 = gcdext(primes[<span class="number">4</span>],primes[<span class="number">5</span>])</span><br><span class="line">	d,a4,b4 = gcdext(<span class="number">3</span>,primes[<span class="number">6</span>])</span><br><span class="line"></span><br><span class="line">	t = [<span class="built_in">int</span>(a1)*<span class="built_in">int</span>(a4),<span class="built_in">int</span>(b1)*<span class="built_in">int</span>(a4),<span class="built_in">int</span>(a2)*<span class="built_in">int</span>(a4),<span class="built_in">int</span>(b2)*<span class="built_in">int</span>(a4),<span class="built_in">int</span>(a3)*<span class="built_in">int</span>(a4),<span class="built_in">int</span>(b3)*<span class="built_in">int</span>(a4),<span class="built_in">int</span>(b4)]</span><br><span class="line">	sum1 = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">		sum1 += t[i]*primes[i]</span><br><span class="line">	r.sendline(<span class="built_in">str</span>(t)[<span class="number">1</span>:-<span class="number">1</span>].encode())</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line"><span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;N0t_s0_e4sy_3xtgCd&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Algebra"><a href="#Algebra" class="headerlink" title="Algebra"></a>Algebra</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Recently jrl888 has learned something about groebner_basis.But could U plz help him to sovle his linear algebra homework?</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#utf-8</span></span><br><span class="line"><span class="comment">#sage</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,e</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> reduce(<span class="keyword">lambda</span> x,y:x&amp;y,[i^<span class="number">3</span> - <span class="number">10</span>*i^<span class="number">2</span> + <span class="number">31</span>*i - <span class="number">30</span>==<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> e])</span><br><span class="line"></span><br><span class="line">LEN = <span class="number">32</span></span><br><span class="line">flag = pad(flag,<span class="number">36</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">LongArray</span>(<span class="params">t:<span class="built_in">list</span></span>):</span><br><span class="line">    <span class="keyword">return</span> [bytes_to_long(t[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">BytesArray</span>(<span class="params">t:<span class="built_in">list</span></span>):</span><br><span class="line">    <span class="keyword">return</span> [long_to_bytes(t[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([a[i%<span class="built_in">len</span>(a)] ^^ b[i%<span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ArrayXor</span>(<span class="params">a:<span class="built_in">list</span>,b:<span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">return</span> [xor(a[i],b) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scissors</span>(<span class="params">flag:<span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">return</span> [flag[i:i+<span class="built_in">len</span>(flag)//<span class="number">3</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag), <span class="built_in">len</span>(flag)//<span class="number">3</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>(<span class="params">m: <span class="built_in">bytes</span>, bits: <span class="built_in">int</span>, level: <span class="built_in">int</span></span>):</span><br><span class="line">    p = getPrime(bits)</span><br><span class="line">    M = random_matrix(Zmod(p), LEN).matrix_from_rows_and_columns(<span class="built_in">range</span>(LEN), <span class="built_in">range</span>(LEN-level))</span><br><span class="line">    c = vector(GF(p), m) * M</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;p&quot;</span>: p, <span class="string">&quot;M&quot;</span>: M.<span class="built_in">list</span>(), <span class="string">&quot;c&quot;</span>: c.<span class="built_in">list</span>()&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">groebner_challenge</span>(<span class="params">m,e</span>):</span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    s = <span class="built_in">sum</span>(m)</span><br><span class="line">    c = [<span class="built_in">pow</span>(m[i],e[i],p) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">    c.insert(<span class="number">0</span>,s)</span><br><span class="line">    c.insert(<span class="number">0</span>,p)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">key = os.urandom(LEN)</span><br><span class="line">Get_key = challenge(key,<span class="number">256</span>,<span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line">S_bytes = scissors(flag)</span><br><span class="line">C_bytes = ArrayXor(S_bytes,key)</span><br><span class="line">C_long  = LongArray(C_bytes)</span><br><span class="line"></span><br><span class="line">groebner_challenge = groebner_challenge(C_long,e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;keyTask.chall&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">f&quot;<span class="subst">&#123;Get_key&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;groebnerTask.chall&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">f&quot;<span class="subst">&#123;groebner_challenge&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>然后还有两份数据文件，较长就不写出来了，有需要的师傅可以找我要。</p>
<p>简单描述一下题目任务：</p>
<ul>
<li>生成一个长度为32的随机字节串key，并进入challenge</li>
<li>challenge中，将key按字节拆成1x32的向量m，同时生成一个32x16的随机矩阵M以及随机素数p，并返回M以及模p下mM的计算结果c</li>
<li>将flag拆成三等分的字节串，每一部分均与key异或得到C_bytes，并转为列表C_long</li>
<li>对C_long进行groebner_challenge并返回结果</li>
</ul>
<p>所以其实题目主要也就分为两部分，一部分解challenge得到key，一部分解groebner_challenge得到C_long，然后异或就有flag，因此我的wp也分两部分阐述。</p>
<h4 id="challenge"><a href="#challenge" class="headerlink" title="challenge"></a>challenge</h4><p>这一部分主要在于key对应的m向量是按字节拆分，也就是说在模p下都是很小的量，所以可以用格规约出key，具体如何构造格可以见我写的这一篇中的Matrix一题的challenge3，是一模一样的：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/9b40da15.html">Crypto趣题-Lattice | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<h4 id="groebner-challenge"><a href="#groebner-challenge" class="headerlink" title="groebner_challenge"></a>groebner_challenge</h4><p>这一部分给了以下几组模等式：</p>
<script type="math/tex; mode=display">
m_0^{e_0} \equiv c_0 \quad(mod\;p)</script><script type="math/tex; mode=display">
m_1^{e_1} \equiv c_1 \quad(mod\;p)</script><script type="math/tex; mode=display">
m_2^{e_2} \equiv c_2 \quad(mod\;p)</script><p>其中mi就是我们需要求出的C_long中的三部分，除此之外还给出了两个信息，一个是mi的和：</p>
<script type="math/tex; mode=display">
m_0 + m_1 + m_2 = s</script><p>另一个是三个e满足的方程：</p>
<script type="math/tex; mode=display">
e_i^3 - 10e_i^2 + 3*e_i - 30==0</script><p>那么求解这个三次方程可以得到三个根5，3，2，那么我们对所有可能的3^3种e的组合分别求groebner，就会发现在分别取2，3，5的时候可以求出mi，然后异或key就能得到flag了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get key</span></span><br><span class="line">Get_key = </span><br><span class="line">p,M,c = Get_key[<span class="string">&quot;p&quot;</span>],Get_key[<span class="string">&quot;M&quot;</span>],Get_key[<span class="string">&quot;c&quot;</span>]</span><br><span class="line"></span><br><span class="line">MM = matrix(ZZ,<span class="number">32</span>,<span class="number">16</span>,M)</span><br><span class="line">E = diagonal_matrix([<span class="number">1</span>]*<span class="number">32</span>)</span><br><span class="line">P = diagonal_matrix([p]*<span class="number">16</span>)</span><br><span class="line">C = matrix(ZZ,c)</span><br><span class="line">L = block_matrix(ZZ,[[MM,E],[P,<span class="number">0</span>],[C,<span class="number">0</span>]])</span><br><span class="line">ML = L.LLL()</span><br><span class="line">key = <span class="built_in">list</span>(ML[<span class="number">1</span>][<span class="number">16</span>:])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">    key[i] = <span class="built_in">abs</span>(key[i])</span><br><span class="line">key = <span class="built_in">bytes</span>(key)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get e</span></span><br><span class="line">PR.&lt;i&gt; = PolynomialRing(ZZ)</span><br><span class="line">f = i^<span class="number">3</span> - <span class="number">10</span>*i^<span class="number">2</span> + <span class="number">31</span>*i - <span class="number">30</span></span><br><span class="line">res = f.roots()</span><br><span class="line">e = [i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> res]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 get C_long</span></span><br><span class="line">groebner_challenge = [<span class="number">175336555462486363373099551411803174933803940918372428249159666803182759268063415863987676455854054651631174131625763475189413468427467197699058719725221879406119373683175842618465694427132003565774900609456204965408254598477034791500576573579131820364396996254469692964946065509325801687720344376041097328929</span>, <span class="number">192597139210277682598060185912821582569043452465684540030278464832244948354365</span>, <span class="number">5415723658972576382153559473862560277755192970021711034483296770242757614573901416501357332661976379693731699836578087114136761491831672836130172409491889</span>, <span class="number">210713951733721296094981135225517096332793112439184310028590576805069783972692891743044656754643189870169698041576462365740899368554671164493356650858567594970345928936103914826926922045852943068526737627918609421198466329605091625</span>, <span class="number">93558120697660628972553751937347865465963385519812302371069578286123647411810258547153399045605149278436900736665388355004346922404097196048139360206875149390218160164739477798859206611473675859708579299466581718543909912951088772842957187413726251892347470983848602814387339449340072310561011153714207338630</span>]</span><br><span class="line">p,s,c = groebner_challenge[<span class="number">0</span>],groebner_challenge[<span class="number">1</span>],groebner_challenge[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">PR.&lt;x1,x2,x3&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f1 = x1+x2+x3-s</span><br><span class="line">f2 = x1^e[<span class="number">2</span>]-c[<span class="number">0</span>]</span><br><span class="line">f3 = x2^e[<span class="number">1</span>]-c[<span class="number">1</span>]</span><br><span class="line">f4 = x3^e[<span class="number">0</span>]-c[<span class="number">2</span>]</span><br><span class="line">F = [f1,f2,f3,f4]</span><br><span class="line">res = Ideal(F).groebner_basis()</span><br><span class="line"><span class="comment">#print(res)</span></span><br><span class="line">C_long = [<span class="number">175336555462486363373099551411803174933803940918372428249159666803182759268063415863987676455854054651631174131625763475189413468427467197699058719725221879406119373683175842618465694427132003565774900609456204965408254598477034791426984973114319422168794550068252297864611570239554629678043272534782205132762</span>,<span class="number">175336555462486363373099551411803174933803940918372428249159666803182759268063415863987676455854054651631174131625763475189413468427467197699058719725221879406119373683175842618465694427132003565774900609456204965408254598477034791441070070348726882479628953871755257672217743797421672257560044812378339845544</span>,<span class="number">175336555462486363373099551411803174933803940918372428249159666803182759268063415863987676455854054651631174131625763475189413468427467197699058719725221879406119373683175842618465694427132003565774900609456204965408254598477034791441077538064071473846707298910579940788965430025316563097279250948717798654116</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    C_long[i] = p - C_long[i]</span><br><span class="line"></span><br><span class="line"><span class="comment">#part4 get flag</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([a[i%<span class="built_in">len</span>(a)] ^^ b[i%<span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ArrayXor</span>(<span class="params">a:<span class="built_in">list</span>,b:<span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">return</span> [xor(a[i],b) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    C_long[i] = long_to_bytes(C_long[i])</span><br><span class="line">S_bytes = ArrayXor(C_long,key)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> S_bytes:</span><br><span class="line">    flag += i[:<span class="number">12</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;You_are_really_algebra_master&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="GoGoCrypto"><a href="#GoGoCrypto" class="headerlink" title="GoGoCrypto"></a>GoGoCrypto</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">题目链接：http://47.109.106.62:7842/ 带上你的web队友，拿下这道crypto web 题吧！（允许小范围爆破）</span><br></pre></td></tr></table></figure>
<p>题目文件很多，全部放在wp里有点长，需要的师傅找我要就可以了。解题要用到的主要的两个go文件如下：</p>
<p>publicController.go：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Controller</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;GoCode/myfunc&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span> </span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/base64&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span> </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PubController <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sid []<span class="type">byte</span> </span><br><span class="line"><span class="keyword">var</span> key []<span class="type">byte</span> </span><br><span class="line"><span class="keyword">var</span> iv []<span class="type">byte</span> </span><br><span class="line"><span class="keyword">var</span> nonce []<span class="type">byte</span> </span><br><span class="line"><span class="keyword">var</span> pwd <span class="type">string</span>  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SendJsonBack</span><span class="params">(feedback <span class="type">string</span>, check <span class="type">string</span>, c *gin.Context)</span></span> &#123;</span><br><span class="line">	messageMap := <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">		<span class="string">&quot;msg&quot;</span>:   feedback,</span><br><span class="line">		<span class="string">&quot;check&quot;</span>: check,</span><br><span class="line">	&#125;</span><br><span class="line">	c.JSON(http.StatusOK, messageMap)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pc PubController)</span></span> Router(pr *gin.Engine) &#123;</span><br><span class="line">	pr.GET(<span class="string">&quot;/&quot;</span>, pc.Room)</span><br><span class="line">	pr.POST(<span class="string">&quot;/api/dec&quot;</span>, pc.MyDec) </span><br><span class="line">	pr.POST(<span class="string">&quot;/api/check&quot;</span>, pc.CheckPwd)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pc PubController)</span></span> Room(c *gin.Context) &#123;</span><br><span class="line">	sid = Myfunc.GetRandBytes(<span class="number">16</span>) </span><br><span class="line">	key = Myfunc.GetRandBytes(<span class="number">16</span>) </span><br><span class="line">	iv = Myfunc.GetRandBytes(<span class="number">16</span>) </span><br><span class="line">	nonce = Myfunc.GetRandBytes(<span class="number">16</span>) </span><br><span class="line"></span><br><span class="line">	token, _ := Myfunc.AESEnc(sid, key, iv) </span><br><span class="line">	c.SetCookie(<span class="string">&quot;token&quot;</span>, base64.StdEncoding.EncodeToString(token), <span class="number">0</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">true</span>, <span class="literal">true</span>) </span><br><span class="line">	c.SetCookie(<span class="string">&quot;nonce&quot;</span>,base64.StdEncoding.EncodeToString(nonce) , <span class="number">0</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">true</span>, <span class="literal">true</span>) </span><br><span class="line">	fmt.Println(<span class="string">&quot;token:&quot;</span>, base64.StdEncoding.EncodeToString(token))	</span><br><span class="line">	c.HTML(http.StatusOK, <span class="string">&quot;index.html&quot;</span>, gin.H&#123;<span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span>&#125;) </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(pc PubController)</span></span> MyDec(c *gin.Context) &#123;</span><br><span class="line">	<span class="keyword">var</span> feedback <span class="type">string</span> </span><br><span class="line">	<span class="keyword">var</span> check <span class="type">string</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	Rec_err := c.PostForm(<span class="string">&quot;Rec&quot;</span>) </span><br><span class="line">	fmt.Println(<span class="string">&quot;Rec:&quot;</span>, Rec_err) </span><br><span class="line">	Rec, err := base64.StdEncoding.DecodeString(Rec_err) </span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		check = <span class="string">&quot;false&quot;</span> </span><br><span class="line">		feedback = <span class="string">&quot;Try again.&quot;</span> </span><br><span class="line">		SendJsonBack(feedback, check, c) </span><br><span class="line">		<span class="keyword">return</span> </span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	Pt_err, err := Myfunc.AESDec(Rec, key, iv) </span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> || base64.StdEncoding.EncodeToString(Pt_err) == base64.StdEncoding.EncodeToString(sid)&#123;</span><br><span class="line">		check = <span class="string">&quot;false&quot;</span> </span><br><span class="line">		feedback = <span class="string">&quot;Don&#x27;t try to fool me! Try again.&quot;</span> </span><br><span class="line">		SendJsonBack(feedback, check, c) </span><br><span class="line">		<span class="keyword">return</span> </span><br><span class="line">	&#125;</span><br><span class="line">	check = <span class="string">&quot;true&quot;</span> </span><br><span class="line">	feedback = <span class="string">&quot;Access Accepted.&quot;</span>  </span><br><span class="line">	Pt := base64.StdEncoding.EncodeToString(Pt_err) </span><br><span class="line">	fmt.Println(<span class="string">&quot;(DEBUG)Pt: &quot;</span>, Pt) </span><br><span class="line">	nonce_hash := Myfunc.Hash(nonce) </span><br><span class="line">	pwd = Pt+nonce_hash</span><br><span class="line">	fmt.Println(<span class="string">&quot;pwd: &quot;</span>,pwd)</span><br><span class="line">	SendJsonBack(feedback, check, c) </span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(pc PubController)</span></span> CheckPwd(c *gin.Context) &#123;</span><br><span class="line">	<span class="keyword">var</span> feedback <span class="type">string</span> </span><br><span class="line">	<span class="keyword">var</span> check <span class="type">string</span> </span><br><span class="line"></span><br><span class="line">	Rec := c.PostForm(<span class="string">&quot;Password&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> pwd == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		check = <span class="string">&quot;false&quot;</span> </span><br><span class="line">		feedback = <span class="string">&quot;Give me your token first.&quot;</span> </span><br><span class="line">		SendJsonBack(feedback, check, c) </span><br><span class="line">		<span class="keyword">return</span>  </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> Rec == pwd &#123;</span><br><span class="line">		check = <span class="string">&quot;true&quot;</span> </span><br><span class="line">		feedback = <span class="string">&quot;Your flag is: SYC&#123;AL3XEI_FAKE_FLAG&#125;&quot;</span> </span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		check =  <span class="string">&quot;false&quot;</span> </span><br><span class="line">		feedback = <span class="string">&quot;Oops! Please try again.&quot;</span> </span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	SendJsonBack(feedback, check, c) </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>myfunc.go：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Myfunc </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;crypto/aes&quot;</span></span><br><span class="line">    <span class="string">&quot;crypto/cipher&quot;</span></span><br><span class="line">    <span class="string">&quot;crypto/rand&quot;</span></span><br><span class="line">    <span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;crypto/sha512&quot;</span> </span><br><span class="line">	<span class="string">&quot;encoding/base64&quot;</span> </span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(err <span class="type">error</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetRandBytes</span><span class="params">(n <span class="type">int</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">	res := <span class="built_in">make</span>([]<span class="type">byte</span>, n) </span><br><span class="line">	_, e := rand.Read(res) </span><br><span class="line">	check(e) </span><br><span class="line">	<span class="keyword">return</span> res </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pad</span><span class="params">(pt []<span class="type">byte</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">	padlen := aes.BlockSize - (<span class="built_in">len</span>(pt) % aes.BlockSize) </span><br><span class="line">	padding := bytes.Repeat([]<span class="type">byte</span>&#123;<span class="type">byte</span>(padlen)&#125;, padlen) </span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">append</span>(pt, padding...) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unpad</span><span class="params">(pt []<span class="type">byte</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">	padlen := <span class="type">int</span>(pt[<span class="built_in">len</span>(pt)<span class="number">-1</span>]) </span><br><span class="line">	<span class="keyword">return</span> pt[:<span class="built_in">len</span>(pt)-padlen] </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AESEnc</span><span class="params">(pt []<span class="type">byte</span>, key []<span class="type">byte</span>, iv []<span class="type">byte</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	block, e := aes.NewCipher(key) </span><br><span class="line">	<span class="keyword">if</span> e != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, e </span><br><span class="line">	&#125;</span><br><span class="line">	pt_ := Pad(pt) </span><br><span class="line">	fmt.Println(<span class="string">&quot;(DEBUG) pt_: &quot;</span>, pt_)</span><br><span class="line">	ct := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="built_in">len</span>(pt_)) </span><br><span class="line">	m := cipher.NewCBCEncrypter(block, iv) </span><br><span class="line">	m.CryptBlocks(ct, pt_) </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> ct, <span class="literal">nil</span> </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AESDec</span><span class="params">(ct []<span class="type">byte</span>, key []<span class="type">byte</span>, iv []<span class="type">byte</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	block, e := aes.NewCipher(key) </span><br><span class="line">	<span class="keyword">if</span> e != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, e</span><br><span class="line">	&#125;</span><br><span class="line">	m := cipher.NewCBCDecrypter(block, iv) </span><br><span class="line">	pt_ := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="built_in">len</span>(ct)) </span><br><span class="line">	m.CryptBlocks(pt_, ct) </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> Unpad(pt_), <span class="literal">nil</span> </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hash</span><span class="params">(nonce []<span class="type">byte</span>)</span></span> <span class="type">string</span>&#123;</span><br><span class="line">	h := sha512.New() </span><br><span class="line">	h.Write(nonce) </span><br><span class="line">	nonce_hash := base64.StdEncoding.EncodeToString(h.Sum(<span class="literal">nil</span>)) </span><br><span class="line">	<span class="keyword">return</span> nonce_hash </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事实上我一点也不懂web，但是丢给chatgpt+问web队友很轻松就能大概搞清楚每个函数的意思。简单描述一下题目任务，有三个访问接口如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func (pc PubController) Router(pr *gin.Engine) &#123;</span><br><span class="line">	pr.GET(<span class="string">&quot;/&quot;</span>, pc.Room)</span><br><span class="line">	pr.POST(<span class="string">&quot;/api/dec&quot;</span>, pc.MyDec) </span><br><span class="line">	pr.POST(<span class="string">&quot;/api/check&quot;</span>, pc.CheckPwd)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>访问Room方法，我们可以从Cookie中得到token和nonce的值，token是sid经AES加密后的值；</p>
</li>
<li><p>访问MyDec方法，我们可以用post方式发送一个base64串让服务器解密，服务器正确解密后会检查解密结果是否等于sid，如果不相等则通过检查，并将解密后的结果连接上nonce的sha512值，作为pwd</p>
</li>
<li>访问CheckPwd方法，我们可以发送一个base64串，服务器base64解码后检查结果与pwd相等，则可以获得flag</li>
</ul>
<p>接下来看看怎么解题。首先，pwd的后半部分，也就是nonce的sha512值我们是可以获得的，因此主要要想的办法是如何去得到pwd的前半部分Pt，也就是MyDec中的AES解密结果。</p>
<p>然后我的做法也很简单，注意到AES解密后一定会unpad，而myfunc中的pad和unpad是pkcs#7的标准填充方式，而我们利用的点也主要在于unpad函数：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unpad</span><span class="params">(pt []<span class="type">byte</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">	padlen := <span class="type">int</span>(pt[<span class="built_in">len</span>(pt)<span class="number">-1</span>]) </span><br><span class="line">	<span class="keyword">return</span> pt[:<span class="built_in">len</span>(pt)-padlen] </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到它解填充时，只用最后一个字节的值当作填充长度，这对于标准填充过的密文来说，这样解填充当然是没问题的，但是如果不是标准填充过后的密文就会产生问题，这是因为在MyDec中我们可以发送任何base64串，只要他能正确AES解密，并且解密结果不等于sid(也就是token的解密值)，服务器就会把解密结果Pt当作pwd的前一部分。</p>
<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>也就是说，我们发送任意16字节密文的base64串，服务器应该都能AES解密出16字节明文并<strong>解填充</strong>，得到最终的Pt。而如果我们可以使解密出的最后一字节值恰为16，那么根据unpad的方式，Pt最终将会是一个空串，所以pwd其实就是nonce的sha512值，所以我们发送nonce的sha512值过去check就能得到flag。</p>
<p>至于如何使解密出的最后一字节值恰为16，我的方法是直接生日攻击就好，一次有1/256的概率成功，那么爆破256次就有大于50%的概率成功。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha512</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&quot;http://47.109.106.62:7842/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get nonce</span></span><br><span class="line">response = requests.get(base_url + <span class="string">&quot;/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    cookies = response.cookies</span><br><span class="line">    token_cookie = cookies.get(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">    nonce_cookie = cookies.get(<span class="string">&quot;nonce&quot;</span>)</span><br><span class="line"></span><br><span class="line">    token = unquote(token_cookie)</span><br><span class="line">    nonce = unquote(nonce_cookie)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Token:&quot;</span>, token)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Nonce:&quot;</span>, nonce)</span><br><span class="line">nonce_hash = b64encode(sha512(b64decode(nonce)).digest())</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get flag</span></span><br><span class="line">randombytes = <span class="string">b&quot;0&quot;</span> * <span class="number">15</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">256</span>):</span><br><span class="line">    <span class="comment">#get pwd</span></span><br><span class="line">    temp = randombytes + long_to_bytes(i)</span><br><span class="line">    temp = b64encode(temp)</span><br><span class="line">    data = &#123;<span class="string">&quot;Rec&quot;</span>: temp&#125;</span><br><span class="line">    response = requests.post(base_url + <span class="string">&quot;api/dec&quot;</span>, data=data)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#get flag</span></span><br><span class="line">    data = &#123;<span class="string">&quot;Password&quot;</span>: nonce_hash&#125;</span><br><span class="line">    response = requests.post(base_url + <span class="string">&quot;api/check&quot;</span>, data=data)</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;Oops!&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.text):</span><br><span class="line">        <span class="built_in">print</span>(response.text)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;N0t_S0_E45y_Cryp0W3b&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>可以发现刚才的方法是完全没用到token的，而如果用上token，我们则可以完全不爆破。思路就是：sid本身是个16字节的值，所以AES加密前会被填充为下面的形式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sid + <span class="string">b&quot;\x10&quot;</span>*<span class="number">16</span></span><br></pre></td></tr></table></figure>
<p>而又因为是CBC模式加密，所以我们用字节翻转攻击，改变第一组明文的最后一字节，从而实现把最后一个解密出的字节从16改成32，这样解填充的Pt也为空串。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha512</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&quot;http://47.109.106.62:7842/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get token&amp;nonce</span></span><br><span class="line">response = requests.get(base_url + <span class="string">&quot;/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    cookies = response.cookies</span><br><span class="line">    token_cookie = cookies.get(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">    nonce_cookie = cookies.get(<span class="string">&quot;nonce&quot;</span>)</span><br><span class="line"></span><br><span class="line">    token = unquote(token_cookie)</span><br><span class="line">    nonce = unquote(nonce_cookie)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Token:&quot;</span>, token)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Nonce:&quot;</span>, nonce)</span><br><span class="line">nonce_hash = b64encode(sha512(b64decode(nonce)).digest())</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get flag</span></span><br><span class="line">token1,token2 = b64decode(token)[:<span class="number">16</span>],b64decode(token)[<span class="number">16</span>:]</span><br><span class="line">token1 = token1[:-<span class="number">1</span>] + long_to_bytes((token1[-<span class="number">1</span>] ^ <span class="number">16</span> ^ <span class="number">32</span>))</span><br><span class="line">temp = b64encode(token1+token2)</span><br><span class="line">data = &#123;<span class="string">&quot;Rec&quot;</span>: temp&#125;</span><br><span class="line">response = requests.post(base_url + <span class="string">&quot;api/dec&quot;</span>, data=data)</span><br><span class="line"></span><br><span class="line"><span class="comment">#get flag</span></span><br><span class="line">data = &#123;<span class="string">&quot;Password&quot;</span>: nonce_hash&#125;</span><br><span class="line">response = requests.post(base_url + <span class="string">&quot;api/check&quot;</span>, data=data)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYC&#123;N0t_S0_E45y_Cryp0W3b&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/6f77578c.html" title="2023-极客大挑战-wp-crypto">https://tangcuxiaojikuai.xyz/post/6f77578c.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/df537e5d.html" rel="prev" title="2023-TPCTF-wp-crypto">
      <i class="fa fa-chevron-left"></i> 2023-TPCTF-wp-crypto
    </a></div>
      <div class="post-nav-item">
    <a href="/post/1b5eb6c5.html" rel="next" title="2023-ISCTF-wp-crypto">
      2023-ISCTF-wp-crypto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Week-1"><span class="nav-number">1.</span> <span class="nav-text">Week 1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SignIn"><span class="nav-number">1.1.</span> <span class="nav-text">SignIn</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#proof-of-work"><span class="nav-number">1.2.</span> <span class="nav-text">proof_of_work</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SimpleRSA"><span class="nav-number">1.3.</span> <span class="nav-text">SimpleRSA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OTPTwice"><span class="nav-number">1.4.</span> <span class="nav-text">OTPTwice</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OldAlgorithm"><span class="nav-number">1.5.</span> <span class="nav-text">OldAlgorithm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-classic"><span class="nav-number">1.6.</span> <span class="nav-text">easy_classic</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1"><span class="nav-number">1.6.1.</span> <span class="nav-text">1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2"><span class="nav-number">1.6.2.</span> <span class="nav-text">2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3"><span class="nav-number">1.6.3.</span> <span class="nav-text">3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4"><span class="nav-number">1.6.4.</span> <span class="nav-text">4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5"><span class="nav-number">1.6.5.</span> <span class="nav-text">5</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Week-2"><span class="nav-number">2.</span> <span class="nav-text">Week 2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PolyRSA"><span class="nav-number">2.1.</span> <span class="nav-text">PolyRSA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Simple3DES"><span class="nav-number">2.2.</span> <span class="nav-text">Simple3DES</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%B1%E5%AF%86%E9%92%A5"><span class="nav-number">2.2.1.</span> <span class="nav-text">弱密钥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pad"><span class="nav-number">2.2.2.</span> <span class="nav-text">pad</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPGDiff"><span class="nav-number">2.3.</span> <span class="nav-text">JPGDiff</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Energetic-Carcano"><span class="nav-number">2.4.</span> <span class="nav-text">Energetic_Carcano</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Just-need-One"><span class="nav-number">2.5.</span> <span class="nav-text">Just need One</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fi1nd-th3-x%E2%80%99"><span class="nav-number">2.6.</span> <span class="nav-text">Fi1nd_th3_x’</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Week-3"><span class="nav-number">3.</span> <span class="nav-text">Week 3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Quick-Robert"><span class="nav-number">3.1.</span> <span class="nav-text">Quick_Robert</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0"><span class="nav-number">3.1.1.</span> <span class="nav-text">更新</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">预备知识</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9B%9E%E5%88%B0%E9%A2%98%E7%9B%AE"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">回到题目</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Diligent-Liszt"><span class="nav-number">3.2.</span> <span class="nav-text">Diligent_Liszt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#card-game"><span class="nav-number">3.3.</span> <span class="nav-text">card_game</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Week-4"><span class="nav-number">4.</span> <span class="nav-text">Week 4</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#EzComplex"><span class="nav-number">4.1.</span> <span class="nav-text">EzComplex</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ext-7gcd"><span class="nav-number">4.2.</span> <span class="nav-text">ext^7gcd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Algebra"><span class="nav-number">4.3.</span> <span class="nav-text">Algebra</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#challenge"><span class="nav-number">4.3.1.</span> <span class="nav-text">challenge</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#groebner-challenge"><span class="nav-number">4.3.2.</span> <span class="nav-text">groebner_challenge</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GoGoCrypto"><span class="nav-number">4.4.</span> <span class="nav-text">GoGoCrypto</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="nav-number">4.4.1.</span> <span class="nav-text">方法一</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="nav-number">4.4.2.</span> <span class="nav-text">方法二</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">77</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
