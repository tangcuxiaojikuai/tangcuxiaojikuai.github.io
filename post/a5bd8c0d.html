<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="这篇文章主要记录一些分组密码相关的趣题">
<meta property="og:type" content="article">
<meta property="og:title" content="Crypto趣题-分组密码">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/a5bd8c0d.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="这篇文章主要记录一些分组密码相关的趣题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/a5bd8c0d/image-20231007231119071.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/a5bd8c0d/image-20231010101627908.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/a5bd8c0d/image-20231019210651725.png">
<meta property="article:published_time" content="2023-10-07T14:10:42.000Z">
<meta property="article:modified_time" content="2024-03-19T04:08:01.891Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tangcuxiaojikuai.xyz/post/a5bd8c0d/image-20231007231119071.png">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/a5bd8c0d.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Crypto趣题-分组密码 | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/a5bd8c0d.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Crypto趣题-分组密码
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-07 22:10:42" itemprop="dateCreated datePublished" datetime="2023-10-07T22:10:42+08:00">2023-10-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-03-19 12:08:01" itemprop="dateModified" datetime="2024-03-19T12:08:01+08:00">2024-03-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/crypto%E8%B6%A3%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">crypto趣题</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/a5bd8c0d.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/a5bd8c0d.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>这篇文章主要记录一些分组密码相关的趣题</p>
<span id="more"></span>
<h3 id="EASY-dfa"><a href="#EASY-dfa" class="headerlink" title="EASY_dfa"></a>EASY_dfa</h3><p>最近做到的我觉得相当有意思的一个题，在这里记录一下解题过程</p>
<p>题目来源：川渝网络安全竞赛 2022</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> sample, choice</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> hexdigits</span><br><span class="line"><span class="keyword">from</span> signal <span class="keyword">import</span> alarm</span><br><span class="line"></span><br><span class="line">logo = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> _______   ________  ________       ___    ___ </span></span><br><span class="line"><span class="string">|\  ___ \ |\   __  \|\   ____\     |\  \  /  /|</span></span><br><span class="line"><span class="string">\ \   __/|\ \  \|\  \ \  \___|_    \ \  \/  / /</span></span><br><span class="line"><span class="string"> \ \  \_|/_\ \   __  \ \_____  \    \ \    / / </span></span><br><span class="line"><span class="string">  \ \  \_|\ \ \  \ \  \|____|\  \    \/  /  /  </span></span><br><span class="line"><span class="string">   \ \_______\ \__\ \__\____\_\  \ __/  / /    </span></span><br><span class="line"><span class="string">    \|_______|\|__|\|__|\_________\\\___/ /    </span></span><br><span class="line"><span class="string">                       \|_________\|___|/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     ________  ________ ________         </span></span><br><span class="line"><span class="string">    |\   ___ \|\  _____\\\   __  \        </span></span><br><span class="line"><span class="string">    \ \  \_|\ \ \  \__/\ \  \|\  \       </span></span><br><span class="line"><span class="string">     \ \  \ \\\ \ \   __\\\ \   __  \      </span></span><br><span class="line"><span class="string">      \ \  \_\\\ \ \  \_| \ \  \ \  \     </span></span><br><span class="line"><span class="string">       \ \_______\ \__\   \ \__\ \__\    </span></span><br><span class="line"><span class="string">         \|_______|\|__|    \|__|\|__|    </span></span><br><span class="line"><span class="string">                                                                                                                                 </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_memu = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1. Encrypt</span></span><br><span class="line"><span class="string">2. Get flag</span></span><br><span class="line"><span class="string">3. Exit</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof</span>():</span><br><span class="line">    plain = <span class="string">&quot;&quot;</span>.join([choice(hexdigits) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    <span class="built_in">print</span>(plain)</span><br><span class="line">    s = sha256(plain.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;sha256(<span class="subst">&#123;plain[:<span class="number">16</span>]&#125;</span>xxxx) = <span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br><span class="line">    xxxx = <span class="built_in">input</span>(<span class="string">&quot;plz enter the xxxx: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> xxxx != plain[<span class="number">16</span>:]:</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rev</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        x = rotl(x, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotl</span>(<span class="params">x, n</span>): <span class="keyword">return</span> ((x &lt;&lt; n) &amp; <span class="number">0xffffffff</span>) | ((x &gt;&gt; (<span class="number">32</span> - n)) &amp; <span class="number">0xffffffff</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xorl</span>(<span class="params">x, y</span>): <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> a, b: a ^ b, x, y))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Int2List</span>(<span class="params">x</span>): <span class="keyword">return</span> [x &gt;&gt; <span class="number">24</span>, (x &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>, (x &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>, x &amp; <span class="number">0xff</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">List2Int</span>(<span class="params">x</span>): <span class="keyword">return</span> x[<span class="number">0</span>] &lt;&lt; <span class="number">24</span> | x[<span class="number">1</span>] &lt;&lt; <span class="number">16</span> | x[<span class="number">2</span>] &lt;&lt; <span class="number">8</span> | x[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Enc</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key</span>):</span><br><span class="line">        self.K = key</span><br><span class="line">        self.S = sample([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)], <span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">l</span>(<span class="params">self, B: <span class="built_in">list</span></span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">        B = List2Int(B)</span><br><span class="line">        B = B ^ rotl(B, <span class="number">2</span>) ^ rotl(B, <span class="number">10</span>) ^ rotl(B, <span class="number">18</span>) ^ rotl(B, <span class="number">24</span>)</span><br><span class="line">        <span class="keyword">return</span> Int2List(B)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, plain</span>):</span><br><span class="line">        T = xorl(self.K[:<span class="number">4</span>], plain)</span><br><span class="line">        T = Int2List(rev(List2Int(T)))</span><br><span class="line">        T = self.l([self.S[i] <span class="keyword">for</span> i <span class="keyword">in</span> T])</span><br><span class="line">        T = xorl(self.K[<span class="number">4</span>:], T)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(T).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">E</span>():</span><br><span class="line">    plain = <span class="built_in">input</span>(<span class="string">&quot;plz enter your plaintext: &quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;cipher = <span class="subst">&#123;C.encrypt(unhexlify(plain))&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Get_Flag</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;cipher = <span class="subst">&#123;f&#125;</span>&quot;</span>)</span><br><span class="line">    plain = <span class="built_in">input</span>(<span class="string">&quot;plz enter your plaintext: &quot;</span>)</span><br><span class="line">    c = C.encrypt(unhexlify(plain))</span><br><span class="line">    <span class="keyword">if</span> c == f:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;wrong!&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memu</span>():</span><br><span class="line">    choose = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> choose == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">        E()</span><br><span class="line">    <span class="keyword">elif</span> choose == <span class="string">&quot;2&quot;</span>:</span><br><span class="line">        Get_Flag()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Bye~&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    proof()</span><br><span class="line">    <span class="built_in">print</span>(logo)</span><br><span class="line">    key = urandom(<span class="number">8</span>)</span><br><span class="line">    C = Enc(key)</span><br><span class="line">    f = C.encrypt(urandom(<span class="number">4</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;sbox: <span class="subst">&#123;C.S&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(_memu)</span><br><span class="line">    alarm(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        memu()</span><br></pre></td></tr></table></figure>
<p>代码略有点长，一步一步来，还是从分析加密流程开始：</p>
<p>首先，要过一个proof，为爆破一个十六进制串的末四位哈希，这个本来没什么好讲的，但是仔细看可以发现题目这里锅了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">proof</span>():</span><br><span class="line">    plain = <span class="string">&quot;&quot;</span>.join([choice(hexdigits) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    <span class="built_in">print</span>(plain)</span><br><span class="line">    s = sha256(plain.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;sha256(<span class="subst">&#123;plain[:<span class="number">16</span>]&#125;</span>xxxx) = <span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br><span class="line">    xxxx = <span class="built_in">input</span>(<span class="string">&quot;plz enter the xxxx: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> xxxx != plain[<span class="number">16</span>:]:</span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure>
<p>可以看到，他直接print了明文串，因此只需要接受明文串，并把末四个十六进制数发送回去即可通过proof。其实这也没什么，不过是一个小失误。但之所以我要特地讲出来，在这篇wp后面会说明原因。</p>
<p>过了proof后，加密正式开始：</p>
<ul>
<li>生成一个8字节的随机密钥key</li>
<li>用这个key初始化一个Enc对象C</li>
<li>生成一个4字节的随机明文，记作plain，并用Enc对象C进行加密，得到f</li>
<li>给出C中的S盒</li>
<li>给我们10s时间，可以选择进行以下两种操作：</li>
<li><ul>
<li>输入”1”，可以自行构造一组明文进行加密，靶机端会返回加密后的密文</li>
<li>输入”2”，可以输入一个明文，如果输入的明文被加密后与f相等，则核验通过，发放flag</li>
</ul>
</li>
</ul>
<p>这是靶机端需完成的任务的逻辑，再来看看Enc对象具体是怎么加密的，也就是encrypt函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, plain</span>):</span><br><span class="line">    T = xorl(self.K[:<span class="number">4</span>], plain)</span><br><span class="line">    T = Int2List(rev(List2Int(T)))</span><br><span class="line">    T = self.l([self.S[i] <span class="keyword">for</span> i <span class="keyword">in</span> T])</span><br><span class="line">    T = xorl(self.K[<span class="number">4</span>:], T)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(T).<span class="built_in">hex</span>()</span><br></pre></td></tr></table></figure>
<ul>
<li>生成一个S盒，是一个(0,256)之间的随机置换</li>
<li>将明文与key的前四个字节作异或，得到T</li>
<li>第二行，做完了题也不知道有什么用，估计是出题没删干净</li>
<li>将T作S盒置换后，调用l函数，得到更新后的T</li>
<li>将T与key的后半段异或，并给出十六进制密文</li>
</ul>
<p>其中，l函数如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">l</span>(<span class="params">self, B: <span class="built_in">list</span></span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">    B = List2Int(B)</span><br><span class="line">    B = B ^ rotl(B, <span class="number">2</span>) ^ rotl(B, <span class="number">10</span>) ^ rotl(B, <span class="number">18</span>) ^ rotl(B, <span class="number">24</span>)</span><br><span class="line">    <span class="keyword">return</span> Int2List(B)</span><br></pre></td></tr></table></figure>
<p>你应该可以感觉到，如果能够知道l函数的密文，那么这种级别的加密对于z3来说，求解出明文不是难事。</p>
<p>至此，题目加密流程就梳理结束了，接下来进行到分析环节。</p>
<h4 id="思路一：生日攻击"><a href="#思路一：生日攻击" class="headerlink" title="思路一：生日攻击"></a>思路一：生日攻击</h4><p>刚才我特意说，题目的proof锅了，不需要实际爆破，作用就在这里。节省下来的爆破时间给生日攻击提供了一点可能性。</p>
<p>你可以发现，题目实质上就是要求给出正确的4个明文字节。而4个字节一共有2^32次方种可能性，因此我们随便输入四个字节给靶机，也有 $ \frac{1}{2^{32}}$ 的机会成功。而失败了的话，就重新连接靶机，再随便输入四个字节，如此重复。根据生日攻击理论，如果能够反复进行2^32次，我们就有超过50%的几率至少成功攻击一次，那么就能拿到flag。</p>
<p>当然，即使proof锅了，真的要进行2^32次方次的话，可以用tqdm测试一下大概需要600000个小时，仍然是不现实的。但是这确实是个思路，一点办法都没有的时候，可以拼拼运气。</p>
<h4 id="思路二：构造明文"><a href="#思路二：构造明文" class="headerlink" title="思路二：构造明文"></a>思路二：构造明文</h4><p>生日攻击只能说有非常微小的成功的机会。真正要做的话，还是得分析一下加密流程，以及如何构造出可用的明文。</p>
<p>首先要注意到，我们只有10s时间，这是个非常重要的信息。经过我用tqdm测试，我们大概最多能构造30-40组明文让服务器加密。并且，考虑到还需要用构造出的明文信息对f进行解密，实际上来说可能最多只能构造10-20组明文。</p>
<p>这个用处挺大的，直接完全排除了中间相遇攻击、建立字典查找等思路。因此现在的主要目标就是：如何用有限的、少量的明文，去泄露Enc对象C的信息，从而解密密文。</p>
<p>你应该能看出来，如果你能获得密钥key的完整8个字节，那么解密是很容易的，只需要对应异或、逆置换、z3解方程就可以解密出明文。</p>
<p>因此，重心放在求解key上也就是自然而然的思路。很容易想到，如果发送四个字节的”\x00”给靶机端，那么再观察encrypt函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, plain</span>):</span><br><span class="line">    T = xorl(self.K[:<span class="number">4</span>], plain)</span><br><span class="line">    T = Int2List(rev(List2Int(T)))</span><br><span class="line">    T = self.l([self.S[i] <span class="keyword">for</span> i <span class="keyword">in</span> T])</span><br><span class="line">    T = xorl(self.K[<span class="number">4</span>:], T)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(T).<span class="built_in">hex</span>()</span><br></pre></td></tr></table></figure>
<p>那么第一步得到的T其实就是key的前四个字节，在之后也是key的前四个字节进行置换、调用l函数等。</p>
<p>而第二次，考虑发送下面这样的字节串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&quot;\x00&quot;</span> * <span class="number">3</span> + <span class="string">b&quot;\x01&quot;</span></span><br></pre></td></tr></table></figure>
<p>可以发现，第一部得到的T，前面三个字节并没有受到影响，仍然是key的前三个字节，只有最后一字节的最后一比特取了反。因此，到第三步置换时，前三个字节的置换仍然是不变的，变的只有第四个字节。也就是说，经过这两次明文的发送，l函数输入的参数列表只有最后一个发生了改变！</p>
<p>而我们再看l函数加密过程，为了直观我画个图像：</p>
<p><img src="/post/a5bd8c0d/image-20231007231119071.png" alt="image-20231007231119071"></p>
<p>红色部分代表两次构造的明文在调l函数时的不同量，黄色部分代表得到密文，线条表示该线条与另一线条之间的五个部分异或得到下方的密文。</p>
<p>那么你仔细看这个图，你会发现，第二块密文和第三块密文，对于红色块异或的量是相同的！那么我们将两次服务器返回的密文异或，会发生什么呢？在下面的分析过程中，我们把key的前半部分记作key1，后半部分记作key2.</p>
<p>首先，我们把m经置换后的列表记作P(m)，经l函数后的列表记作l(P(m))，也就是m经第三步变换后，记作(l(P(m)))。那么两次构造明文到第三步前分别是key1、key1’，则有：</p>
<script type="math/tex; mode=display">
c1 \oplus c2 = (l(P(key_1)) \oplus key_2) \oplus (l(P(key_1')) \oplus key_2)</script><p>那么就可以消掉key2，即：</p>
<script type="math/tex; mode=display">
c1 \oplus c2 = l(P(key_1) \oplus l(P(key_1'))</script><p>而根据刚才的画图分析，密文中间两块对红色的异或利用是相同的，因此我们可以单独分析上式的中间两块，得到：</p>
<script type="math/tex; mode=display">
中间两块异或 = 两次明文的不同红色量异或</script><p>这一部分一定要结合图多理解理解，我没有想到讲的特别清楚的办法，如果哪里不明白可以与我交流。</p>
<p>而两次不同的红色量分别是(key1)和(key1^1)经置换得到的最后一字节，而我们拥有这个异或值以及S盒，因此可以反查到所有可能的解。一般来说会有1-4组。</p>
<p>那么通过上述方法，我们就获得了key1的一个字节，而类似的，通过构造下面几组明文并发送，可以通过相同的分析得到key1的剩下三个字节：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&quot;\x00&quot;</span>*<span class="number">2</span> + <span class="string">b&quot;\x01&quot;</span>*<span class="number">1</span> +<span class="string">b&quot;\x00&quot;</span>*<span class="number">1</span></span><br><span class="line"><span class="string">b&quot;\x00&quot;</span>*<span class="number">1</span> + <span class="string">b&quot;\x01&quot;</span>*<span class="number">1</span> +<span class="string">b&quot;\x00&quot;</span>*<span class="number">2</span></span><br><span class="line"><span class="string">b&quot;\x01&quot;</span>*<span class="number">1</span> + <span class="string">b&quot;\x00&quot;</span>*<span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>而有了key1后，我们就可以发送key1作为明文，那么经第一步异或后得到的T就是四个全零字节，那么也就自然的可以得到第三步置换以及加密后的值，再与服务器返回的密文异或就能得到key2.</p>
<p>得到key2后，解密相对来说就很容易了，可以自行逆序实现。</p>
<p>需要注意的是，有一个地方导致我们可能不成功：</p>
<ul>
<li>每次获得的key1的某字节可能有多解</li>
</ul>
<p>但是没关系，我们只需要多与靶机交互几次，直到满足key1的四个字节都是正确解即可。这一段可以用下面的代码本地调试一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> sample, choice</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> hexdigits</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rev</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        x = rotl(x, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">l</span>(<span class="params">B</span>):</span><br><span class="line">    B = List2Int(B)</span><br><span class="line">    B = B ^ rotl(B, <span class="number">2</span>) ^ rotl(B, <span class="number">10</span>) ^ rotl(B, <span class="number">18</span>) ^ rotl(B, <span class="number">24</span>)</span><br><span class="line">    <span class="keyword">return</span> Int2List(B)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotl</span>(<span class="params">x, n</span>): <span class="keyword">return</span> ((x &lt;&lt; n) &amp; <span class="number">0xffffffff</span>) | ((x &gt;&gt; (<span class="number">32</span> - n)) &amp; <span class="number">0xffffffff</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xorl</span>(<span class="params">x, y</span>): <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> a, b: a ^ b, x, y))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Int2List</span>(<span class="params">x</span>): <span class="keyword">return</span> [x &gt;&gt; <span class="number">24</span>, (x &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>, (x &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>, x &amp; <span class="number">0xff</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">List2Int</span>(<span class="params">x</span>): <span class="keyword">return</span> x[<span class="number">0</span>] &lt;&lt; <span class="number">24</span> | x[<span class="number">1</span>] &lt;&lt; <span class="number">16</span> | x[<span class="number">2</span>] &lt;&lt; <span class="number">8</span> | x[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">K,cipher</span>):</span><br><span class="line">    T = List2Int(xorl(K[<span class="number">4</span>:],cipher))</span><br><span class="line">    s = Solver() </span><br><span class="line">    B = BitVec(<span class="string">&#x27;B&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    s.add(B ^ rotl(B, <span class="number">2</span>) ^ rotl(B, <span class="number">10</span>) ^ rotl(B, <span class="number">18</span>) ^ rotl(B, <span class="number">24</span>) == T)</span><br><span class="line">    <span class="keyword">if</span> s.check() == sat:    <span class="comment">#检测是否有解</span></span><br><span class="line">        result = <span class="built_in">str</span>(s.model()) </span><br><span class="line">        T = Int2List(<span class="built_in">int</span>(result[<span class="number">5</span>:-<span class="number">1</span>]))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(T)):</span><br><span class="line">            T[i] = inv_S[T[i]]</span><br><span class="line">    T = List2Int(xorl(K[:<span class="number">4</span>],T))</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(T).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Enc</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key</span>):</span><br><span class="line">        self.K = key</span><br><span class="line">        self.S = sample([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)], <span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">l</span>(<span class="params">self, B: <span class="built_in">list</span></span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">        B = List2Int(B)</span><br><span class="line">        B = B ^ rotl(B, <span class="number">2</span>) ^ rotl(B, <span class="number">10</span>) ^ rotl(B, <span class="number">18</span>) ^ rotl(B, <span class="number">24</span>)</span><br><span class="line">        <span class="keyword">return</span> Int2List(B)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, plain</span>):</span><br><span class="line">        T = xorl(self.K[:<span class="number">4</span>], plain)</span><br><span class="line">        T = Int2List(rev(List2Int(T)))</span><br><span class="line">        temp = [self.S[i] <span class="keyword">for</span> i <span class="keyword">in</span> T]</span><br><span class="line">        T = self.l(temp)</span><br><span class="line">        T = xorl(self.K[<span class="number">4</span>:], T)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(T)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">E</span>(<span class="params">m</span>):</span><br><span class="line">    plain = hexlify(m)</span><br><span class="line">    <span class="keyword">return</span> C.encrypt(unhexlify(plain))</span><br><span class="line"></span><br><span class="line">fin = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            key = urandom(<span class="number">8</span>)</span><br><span class="line">            C = Enc(key)</span><br><span class="line">            x = []</span><br><span class="line">            x.append(E(<span class="string">b&quot;\x00&quot;</span>*<span class="number">4</span>))</span><br><span class="line">            x.append(E(<span class="string">b&quot;\x00&quot;</span>*<span class="number">3</span> + <span class="string">b&quot;\x01&quot;</span>*<span class="number">1</span> +<span class="string">b&quot;\x00&quot;</span>*<span class="number">0</span>))</span><br><span class="line">            x.append(E(<span class="string">b&quot;\x00&quot;</span>*<span class="number">2</span> + <span class="string">b&quot;\x01&quot;</span>*<span class="number">1</span> +<span class="string">b&quot;\x00&quot;</span>*<span class="number">1</span>))</span><br><span class="line">            x.append(E(<span class="string">b&quot;\x00&quot;</span>*<span class="number">1</span> + <span class="string">b&quot;\x01&quot;</span>*<span class="number">1</span> +<span class="string">b&quot;\x00&quot;</span>*<span class="number">2</span>))</span><br><span class="line">            x.append(E(<span class="string">b&quot;\x00&quot;</span>*<span class="number">0</span> + <span class="string">b&quot;\x01&quot;</span>*<span class="number">1</span> +<span class="string">b&quot;\x00&quot;</span>*<span class="number">3</span>))</span><br><span class="line">            c = urandom(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">            S = C.S</span><br><span class="line">            inv_S = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                inv_S[S[i]] = i</span><br><span class="line"></span><br><span class="line">            <span class="comment">#获取key</span></span><br><span class="line">            key_prefix = []</span><br><span class="line"></span><br><span class="line">            <span class="comment">#1.获取key[:4]</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">                <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">                    temp = (xorl(x[<span class="number">0</span>],x[i]))[i-<span class="number">2</span>]</span><br><span class="line">                <span class="keyword">elif</span>(i % <span class="number">2</span> == <span class="number">1</span>):</span><br><span class="line">                    temp = (xorl(x[<span class="number">0</span>],x[i]))[i]</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                    t1 = (S[j]&gt;&gt;<span class="number">6</span>) + ((S[j]&amp;<span class="number">0b111111</span>)&lt;&lt;<span class="number">2</span>)</span><br><span class="line">                    t2 = (S[j^<span class="number">1</span>]&gt;&gt;<span class="number">6</span>) + ((S[j^<span class="number">1</span>]&amp;<span class="number">0b111111</span>)&lt;&lt;<span class="number">2</span>)</span><br><span class="line">                    <span class="keyword">if</span>(t1^t2 == temp):</span><br><span class="line">                        key_prefix.append(inv_S[S[j]])</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">            key_prefix = key_prefix[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">            key_suffix = Int2List(bytes_to_long(E(long_to_bytes(List2Int(key_prefix)))))</span><br><span class="line">            T = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">            temp = l([S[i] <span class="keyword">for</span> i <span class="keyword">in</span> T])</span><br><span class="line">            key_suffix = xorl(temp, key_suffix)</span><br><span class="line">            key_final = long_to_bytes(List2Int(key_prefix)) + long_to_bytes(List2Int(key_suffix))</span><br><span class="line"></span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span>(decrypt(key_final,E(c)) == c.<span class="built_in">hex</span>()):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line">    fin += count</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(fin//<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>可以计算出，平均需要180次左右，能获得一次key1的完全正确的解。运气好的话几组就能出，运气不好接近一千组也有可能，不过没事，交互挂着跑就好。</p>
<p>而本地能正确解密的话，我们就能顺利编写靶机代码了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotl</span>(<span class="params">x, n</span>): <span class="keyword">return</span> ((x &lt;&lt; n) &amp; <span class="number">0xffffffff</span>) | ((x &gt;&gt; (<span class="number">32</span> - n)) &amp; <span class="number">0xffffffff</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xorl</span>(<span class="params">x, y</span>): <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> a, b: a ^ b, x, y))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">List2Int</span>(<span class="params">x</span>): <span class="keyword">return</span> x[<span class="number">0</span>] &lt;&lt; <span class="number">24</span> | x[<span class="number">1</span>] &lt;&lt; <span class="number">16</span> | x[<span class="number">2</span>] &lt;&lt; <span class="number">8</span> | x[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Int2List</span>(<span class="params">x</span>): <span class="keyword">return</span> [x &gt;&gt; <span class="number">24</span>, (x &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>, (x &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>, x &amp; <span class="number">0xff</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">l</span>(<span class="params">B</span>):</span><br><span class="line">    B = List2Int(B)</span><br><span class="line">    B = B ^ rotl(B, <span class="number">2</span>) ^ rotl(B, <span class="number">10</span>) ^ rotl(B, <span class="number">18</span>) ^ rotl(B, <span class="number">24</span>)</span><br><span class="line">    <span class="keyword">return</span> Int2List(B)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">K,cipher,inv_S</span>):</span><br><span class="line">    T = List2Int(xorl(K[<span class="number">4</span>:],cipher))</span><br><span class="line">    s = Solver() </span><br><span class="line">    B = BitVec(<span class="string">&#x27;B&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    s.add(B ^ rotl(B, <span class="number">2</span>) ^ rotl(B, <span class="number">10</span>) ^ rotl(B, <span class="number">18</span>) ^ rotl(B, <span class="number">24</span>) == T)</span><br><span class="line">    <span class="keyword">if</span> s.check() == sat:    <span class="comment">#检测是否有解</span></span><br><span class="line">        result = <span class="built_in">str</span>(s.model()) </span><br><span class="line">        T = Int2List(<span class="built_in">int</span>(result[<span class="number">5</span>:-<span class="number">1</span>]))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(T)):</span><br><span class="line">            T[i] = inv_S[T[i]]</span><br><span class="line">    T = List2Int(xorl(K[:<span class="number">4</span>],T))</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(T).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getflag</span>():</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                r = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28579</span>)</span><br><span class="line">                temp = r.recvline().strip().decode()[-<span class="number">4</span>:]</span><br><span class="line">                r.sendline(temp.encode())</span><br><span class="line">                r.recvuntil(<span class="string">b&quot;sbox: &quot;</span>)</span><br><span class="line">                S = <span class="built_in">eval</span>(r.recvline())</span><br><span class="line">                inv_S = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                    inv_S[S[i]] = i</span><br><span class="line"></span><br><span class="line">                x = []</span><br><span class="line">                <span class="comment">#0</span></span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">                r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot; plaintext: &quot;</span>)</span><br><span class="line">                r.sendline(hexlify(<span class="string">b&quot;\x00&quot;</span>*<span class="number">4</span>))</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;cipher =&quot;</span>)</span><br><span class="line">                x.append(unhexlify(r.recvline().strip()))</span><br><span class="line"></span><br><span class="line">                <span class="comment">#1</span></span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">                r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot; plaintext: &quot;</span>)</span><br><span class="line">                r.sendline(hexlify(<span class="string">b&quot;\x00&quot;</span>*<span class="number">3</span> + <span class="string">b&quot;\x01&quot;</span>*<span class="number">1</span> +<span class="string">b&quot;\x00&quot;</span>*<span class="number">0</span>))</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;cipher =&quot;</span>)		</span><br><span class="line">                x.append(unhexlify(r.recvline().strip()))</span><br><span class="line"></span><br><span class="line">                <span class="comment">#2</span></span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">                r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot; plaintext: &quot;</span>)</span><br><span class="line">                r.sendline(hexlify(<span class="string">b&quot;\x00&quot;</span>*<span class="number">2</span> + <span class="string">b&quot;\x01&quot;</span>*<span class="number">1</span> +<span class="string">b&quot;\x00&quot;</span>*<span class="number">1</span>))</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;cipher =&quot;</span>)</span><br><span class="line">                x.append(unhexlify(r.recvline().strip()))</span><br><span class="line"></span><br><span class="line">                <span class="comment">#3</span></span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">                r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot; plaintext: &quot;</span>)</span><br><span class="line">                r.sendline(hexlify(<span class="string">b&quot;\x00&quot;</span>*<span class="number">1</span> + <span class="string">b&quot;\x01&quot;</span>*<span class="number">1</span> +<span class="string">b&quot;\x00&quot;</span>*<span class="number">2</span>))</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;cipher =&quot;</span>)</span><br><span class="line">                x.append(unhexlify(r.recvline().strip()))</span><br><span class="line"></span><br><span class="line">                <span class="comment">#4</span></span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">                r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot; plaintext: &quot;</span>)</span><br><span class="line">                r.sendline(hexlify(<span class="string">b&quot;\x00&quot;</span>*<span class="number">0</span> + <span class="string">b&quot;\x01&quot;</span>*<span class="number">1</span> +<span class="string">b&quot;\x00&quot;</span>*<span class="number">3</span>))</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;cipher =&quot;</span>)</span><br><span class="line">                x.append(unhexlify(r.recvline().strip()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment">#获取key</span></span><br><span class="line">                key_prefix = []</span><br><span class="line"></span><br><span class="line">                <span class="comment">#1.获取key[:4]</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">                    <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">                        temp = (xorl(x[<span class="number">0</span>],x[i]))[i-<span class="number">2</span>]</span><br><span class="line">                    <span class="keyword">elif</span>(i % <span class="number">2</span> == <span class="number">1</span>):</span><br><span class="line">                        temp = (xorl(x[<span class="number">0</span>],x[i]))[i]</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>):</span><br><span class="line">                        t1 = (S[j]&gt;&gt;<span class="number">6</span>) + ((S[j]&amp;<span class="number">0b111111</span>)&lt;&lt;<span class="number">2</span>)</span><br><span class="line">                        t2 = (S[j^<span class="number">1</span>]&gt;&gt;<span class="number">6</span>) + ((S[j^<span class="number">1</span>]&amp;<span class="number">0b111111</span>)&lt;&lt;<span class="number">2</span>)</span><br><span class="line">                        <span class="keyword">if</span>(t1^t2 == temp):</span><br><span class="line">                            key_prefix.append(inv_S[S[j]])</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                key_prefix = key_prefix[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">                <span class="comment">#2.获取key[4:]</span></span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">                r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot; plaintext: &quot;</span>)</span><br><span class="line">                r.sendline(hexlify(long_to_bytes(List2Int(key_prefix))))</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;cipher =&quot;</span>)</span><br><span class="line">                key_suffix = Int2List(bytes_to_long(unhexlify(r.recvline().strip())))</span><br><span class="line">                T = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">                temp = l([S[i] <span class="keyword">for</span> i <span class="keyword">in</span> T])</span><br><span class="line">                key_suffix = xorl(temp, key_suffix)</span><br><span class="line">                key_final = long_to_bytes(List2Int(key_prefix)) + long_to_bytes(List2Int(key_suffix))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment">#获取flag</span></span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">                r.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">                temp = r.recvuntil(<span class="string">b&quot;cipher =&quot;</span>)</span><br><span class="line">                cipher = unhexlify(r.recvline().strip())</span><br><span class="line">                t = decrypt(key_final,cipher,inv_S)</span><br><span class="line">                r.sendline(t)</span><br><span class="line">                temp = r.recvline()</span><br><span class="line">                <span class="built_in">print</span>(temp)</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">b&quot;wrong&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> temp):</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                </span><br><span class="line">                r.close()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">getflag()</span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;4f9d3982-be4b-4c4a-8ca0-db1a69b28b03&#125;</span></span><br></pre></td></tr></table></figure>
<p>就这一题而言，还是有不少不是很好讲清楚的地方，可能我的做法也并不简洁。如果看了这篇文章你有任何想说的，都欢迎与我交流！</p>
<p><br></p>
<p><br></p>
<h3 id="newAES"><a href="#newAES" class="headerlink" title="newAES"></a>newAES</h3><p>题目来源：羊城杯 2023 决赛</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line">SboxOriginal = (</span><br><span class="line">    <span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,</span><br><span class="line">    <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>,</span><br><span class="line">    <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">    <span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>,</span><br><span class="line">    <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">    <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>,</span><br><span class="line">    <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>,</span><br><span class="line">    <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>,</span><br><span class="line">    <span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">    <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line">    <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>,</span><br><span class="line">    <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>,</span><br><span class="line">    <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>,</span><br><span class="line">    <span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>,</span><br><span class="line">    <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line">    <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">xtime = <span class="keyword">lambda</span> a: (((a &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x1B</span>) &amp; <span class="number">0xFF</span>) <span class="keyword">if</span> (a &amp; <span class="number">0x80</span>) <span class="keyword">else</span> (a &lt;&lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Rcon = (</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>, <span class="number">0x6C</span>, <span class="number">0xD8</span>, <span class="number">0xAB</span>, <span class="number">0x4D</span>, <span class="number">0x9A</span>,</span><br><span class="line">    <span class="number">0x2F</span>, <span class="number">0x5E</span>, <span class="number">0xBC</span>, <span class="number">0x63</span>, <span class="number">0xC6</span>, <span class="number">0x97</span>, <span class="number">0x35</span>, <span class="number">0x6A</span>,</span><br><span class="line">    <span class="number">0xD4</span>, <span class="number">0xB3</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0xEF</span>, <span class="number">0xC5</span>, <span class="number">0x91</span>, <span class="number">0x39</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text2matrix</span>(<span class="params">text</span>):</span><br><span class="line">    text = <span class="built_in">int</span>(text.<span class="built_in">hex</span>(), <span class="number">16</span>)</span><br><span class="line">    matrix = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        byte = (text &gt;&gt; (<span class="number">8</span> * (<span class="number">15</span> - i))) &amp; <span class="number">0xFF</span></span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            matrix.append([byte])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            matrix[i // <span class="number">4</span>].append(byte)</span><br><span class="line">    <span class="keyword">return</span> matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix2text</span>(<span class="params">matrix</span>):</span><br><span class="line">    text = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            text |= (matrix[i][j] &lt;&lt; (<span class="number">120</span> - <span class="number">8</span> * (<span class="number">4</span> * i + j)))</span><br><span class="line">    <span class="keyword">return</span> text.to_bytes(<span class="number">16</span>, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AES</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, master_key, Sbox=SboxOriginal</span>):</span><br><span class="line">        self.Sbox = Sbox</span><br><span class="line">        self.InvSbox = [<span class="number">0</span>]* <span class="number">256</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            self.InvSbox[self.Sbox[i]] = i</span><br><span class="line">        self.change_key(master_key)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">change_key</span>(<span class="params">self, master_key</span>):</span><br><span class="line">        self.round_keys = text2matrix(master_key)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>, <span class="number">4</span> * <span class="number">11</span>):</span><br><span class="line">            self.round_keys.append([])</span><br><span class="line">            <span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">                byte = self.round_keys[i - <span class="number">4</span>][<span class="number">0</span>]        \</span><br><span class="line">                     ^ self.Sbox[self.round_keys[i - <span class="number">1</span>][<span class="number">1</span>]]  \</span><br><span class="line">                     ^ Rcon[i // <span class="number">4</span>]</span><br><span class="line">                self.round_keys[i].append(byte)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">                    byte = self.round_keys[i - <span class="number">4</span>][j]    \</span><br><span class="line">                         ^ self.Sbox[self.round_keys[i - <span class="number">1</span>][(j + <span class="number">1</span>) % <span class="number">4</span>]]</span><br><span class="line">                    self.round_keys[i].append(byte)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                    byte = self.round_keys[i - <span class="number">4</span>][j]    \</span><br><span class="line">                         ^ self.round_keys[i - <span class="number">1</span>][j]</span><br><span class="line">                    self.round_keys[i].append(byte)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, plaintext</span>):</span><br><span class="line">        self.plain_state = text2matrix(plaintext)</span><br><span class="line"></span><br><span class="line">        self.__add_round_key(self.plain_state, self.round_keys[:<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">            self.__round_encrypt(self.plain_state, self.round_keys[<span class="number">4</span> * i : <span class="number">4</span> * (i + <span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line">        self.__sub_bytes(self.plain_state)</span><br><span class="line">        self.__shift_rows(self.plain_state)</span><br><span class="line">        self.__add_round_key(self.plain_state, self.round_keys[<span class="number">40</span>:])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> matrix2text(self.plain_state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self, ciphertext</span>):</span><br><span class="line">        self.cipher_state = text2matrix(ciphertext)</span><br><span class="line"></span><br><span class="line">        self.__add_round_key(self.cipher_state, self.round_keys[<span class="number">40</span>:])</span><br><span class="line">        self.__inv_shift_rows(self.cipher_state)</span><br><span class="line">        self.__inv_sub_bytes(self.cipher_state)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            self.__round_decrypt(self.cipher_state, self.round_keys[<span class="number">4</span> * i : <span class="number">4</span> * (i + <span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line">        self.__add_round_key(self.cipher_state, self.round_keys[:<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> matrix2text(self.cipher_state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add_round_key</span>(<span class="params">self, s, k</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                s[i][j] ^= k[i][j]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__round_encrypt</span>(<span class="params">self, state_matrix, key_matrix</span>):</span><br><span class="line">        self.__sub_bytes(state_matrix)</span><br><span class="line">        self.__shift_rows(state_matrix)</span><br><span class="line">        self.__mix_columns(state_matrix)</span><br><span class="line">        self.__add_round_key(state_matrix, key_matrix)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__round_decrypt</span>(<span class="params">self, state_matrix, key_matrix</span>):</span><br><span class="line">        self.__add_round_key(state_matrix, key_matrix)</span><br><span class="line">        self.__inv_mix_columns(state_matrix)</span><br><span class="line">        self.__inv_shift_rows(state_matrix)</span><br><span class="line">        self.__inv_sub_bytes(state_matrix)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__sub_bytes</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                s[i][j] = self.Sbox[s[i][j]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__inv_sub_bytes</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                s[i][j] = self.InvSbox[s[i][j]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__shift_rows</span>(<span class="params">self, s</span>):</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">1</span>], s[<span class="number">1</span>][<span class="number">1</span>], s[<span class="number">2</span>][<span class="number">1</span>], s[<span class="number">3</span>][<span class="number">1</span>] = s[<span class="number">1</span>][<span class="number">1</span>], s[<span class="number">2</span>][<span class="number">1</span>], s[<span class="number">3</span>][<span class="number">1</span>], s[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">2</span>], s[<span class="number">1</span>][<span class="number">2</span>], s[<span class="number">2</span>][<span class="number">2</span>], s[<span class="number">3</span>][<span class="number">2</span>] = s[<span class="number">2</span>][<span class="number">2</span>], s[<span class="number">3</span>][<span class="number">2</span>], s[<span class="number">0</span>][<span class="number">2</span>], s[<span class="number">1</span>][<span class="number">2</span>]</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">3</span>], s[<span class="number">1</span>][<span class="number">3</span>], s[<span class="number">2</span>][<span class="number">3</span>], s[<span class="number">3</span>][<span class="number">3</span>] = s[<span class="number">3</span>][<span class="number">3</span>], s[<span class="number">0</span>][<span class="number">3</span>], s[<span class="number">1</span>][<span class="number">3</span>], s[<span class="number">2</span>][<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__inv_shift_rows</span>(<span class="params">self, s</span>):</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">1</span>], s[<span class="number">1</span>][<span class="number">1</span>], s[<span class="number">2</span>][<span class="number">1</span>], s[<span class="number">3</span>][<span class="number">1</span>] = s[<span class="number">3</span>][<span class="number">1</span>], s[<span class="number">0</span>][<span class="number">1</span>], s[<span class="number">1</span>][<span class="number">1</span>], s[<span class="number">2</span>][<span class="number">1</span>]</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">2</span>], s[<span class="number">1</span>][<span class="number">2</span>], s[<span class="number">2</span>][<span class="number">2</span>], s[<span class="number">3</span>][<span class="number">2</span>] = s[<span class="number">2</span>][<span class="number">2</span>], s[<span class="number">3</span>][<span class="number">2</span>], s[<span class="number">0</span>][<span class="number">2</span>], s[<span class="number">1</span>][<span class="number">2</span>]</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">3</span>], s[<span class="number">1</span>][<span class="number">3</span>], s[<span class="number">2</span>][<span class="number">3</span>], s[<span class="number">3</span>][<span class="number">3</span>] = s[<span class="number">1</span>][<span class="number">3</span>], s[<span class="number">2</span>][<span class="number">3</span>], s[<span class="number">3</span>][<span class="number">3</span>], s[<span class="number">0</span>][<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mix_single_column</span>(<span class="params">self, a</span>):</span><br><span class="line">        t = a[<span class="number">0</span>] ^ a[<span class="number">1</span>] ^ a[<span class="number">2</span>] ^ a[<span class="number">3</span>]</span><br><span class="line">        u = a[<span class="number">0</span>]</span><br><span class="line">        a[<span class="number">0</span>] ^= t ^ xtime(a[<span class="number">0</span>] ^ a[<span class="number">1</span>])</span><br><span class="line">        a[<span class="number">1</span>] ^= t ^ xtime(a[<span class="number">1</span>] ^ a[<span class="number">2</span>])</span><br><span class="line">        a[<span class="number">2</span>] ^= t ^ xtime(a[<span class="number">2</span>] ^ a[<span class="number">3</span>])</span><br><span class="line">        a[<span class="number">3</span>] ^= t ^ xtime(a[<span class="number">3</span>] ^ u)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mix_columns</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            self.__mix_single_column(s[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__inv_mix_columns</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            u = xtime(xtime(s[i][<span class="number">0</span>] ^ s[i][<span class="number">2</span>]))</span><br><span class="line">            v = xtime(xtime(s[i][<span class="number">1</span>] ^ s[i][<span class="number">3</span>]))</span><br><span class="line">            s[i][<span class="number">0</span>] ^= u</span><br><span class="line">            s[i][<span class="number">1</span>] ^= v</span><br><span class="line">            s[i][<span class="number">2</span>] ^= u</span><br><span class="line">            s[i][<span class="number">3</span>] ^= v</span><br><span class="line"></span><br><span class="line">        self.__mix_columns(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mybox = [<span class="number">105</span>, <span class="number">121</span>, <span class="number">73</span>, <span class="number">89</span>, <span class="number">41</span>, <span class="number">57</span>, <span class="number">9</span>, <span class="number">25</span>, <span class="number">233</span>, <span class="number">249</span>, <span class="number">201</span>, <span class="number">217</span>, <span class="number">169</span>, <span class="number">185</span>, <span class="number">137</span>, <span class="number">153</span>, <span class="number">104</span>, <span class="number">120</span>, <span class="number">72</span>, <span class="number">88</span>, <span class="number">40</span>, <span class="number">56</span>, <span class="number">8</span>, <span class="number">24</span>, <span class="number">232</span>, <span class="number">248</span>, <span class="number">200</span>, <span class="number">216</span>, <span class="number">168</span>, <span class="number">184</span>, <span class="number">136</span>, <span class="number">152</span>, <span class="number">107</span>, <span class="number">123</span>, <span class="number">75</span>, <span class="number">91</span>, <span class="number">43</span>, <span class="number">59</span>, <span class="number">11</span>, <span class="number">27</span>, <span class="number">235</span>, <span class="number">251</span>, <span class="number">203</span>, <span class="number">219</span>, <span class="number">171</span>, <span class="number">187</span>, <span class="number">139</span>, <span class="number">155</span>, <span class="number">106</span>, <span class="number">122</span>, <span class="number">74</span>, <span class="number">90</span>, <span class="number">42</span>, <span class="number">58</span>, <span class="number">10</span>, <span class="number">26</span>, <span class="number">234</span>, <span class="number">250</span>, <span class="number">202</span>, <span class="number">218</span>, <span class="number">170</span>, <span class="number">186</span>, <span class="number">138</span>, <span class="number">154</span>, <span class="number">109</span>, <span class="number">125</span>, <span class="number">77</span>, <span class="number">93</span>, <span class="number">45</span>, <span class="number">61</span>, <span class="number">13</span>, <span class="number">29</span>, <span class="number">237</span>, <span class="number">253</span>, <span class="number">205</span>, <span class="number">221</span>, <span class="number">173</span>, <span class="number">189</span>, <span class="number">141</span>, <span class="number">157</span>, <span class="number">108</span>, <span class="number">124</span>, <span class="number">76</span>, <span class="number">92</span>, <span class="number">44</span>, <span class="number">60</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">236</span>, <span class="number">252</span>, <span class="number">204</span>, <span class="number">220</span>, <span class="number">172</span>, <span class="number">188</span>, <span class="number">140</span>, <span class="number">156</span>, <span class="number">111</span>, <span class="number">127</span>, <span class="number">79</span>, <span class="number">95</span>, <span class="number">47</span>, <span class="number">63</span>, <span class="number">15</span>, <span class="number">31</span>, <span class="number">239</span>, <span class="number">255</span>, <span class="number">207</span>, <span class="number">223</span>, <span class="number">175</span>, <span class="number">191</span>, <span class="number">143</span>, <span class="number">159</span>, <span class="number">110</span>, <span class="number">126</span>, <span class="number">78</span>, <span class="number">94</span>, <span class="number">46</span>, <span class="number">62</span>, <span class="number">14</span>, <span class="number">30</span>, <span class="number">238</span>, <span class="number">254</span>, <span class="number">206</span>, <span class="number">222</span>, <span class="number">174</span>, <span class="number">190</span>, <span class="number">142</span>, <span class="number">158</span>, <span class="number">97</span>, <span class="number">113</span>, <span class="number">65</span>, <span class="number">81</span>, <span class="number">33</span>, <span class="number">49</span>, <span class="number">1</span>, <span class="number">17</span>, <span class="number">225</span>, <span class="number">241</span>, <span class="number">193</span>, <span class="number">209</span>, <span class="number">161</span>, <span class="number">177</span>, <span class="number">129</span>, <span class="number">145</span>, <span class="number">96</span>, <span class="number">112</span>, <span class="number">64</span>, <span class="number">80</span>, <span class="number">32</span>, <span class="number">48</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">224</span>, <span class="number">240</span>, <span class="number">192</span>, <span class="number">208</span>, <span class="number">160</span>, <span class="number">176</span>, <span class="number">128</span>, <span class="number">144</span>, <span class="number">99</span>, <span class="number">115</span>, <span class="number">67</span>, <span class="number">83</span>, <span class="number">35</span>, <span class="number">51</span>, <span class="number">3</span>, <span class="number">19</span>, <span class="number">227</span>, <span class="number">243</span>, <span class="number">195</span>, <span class="number">211</span>, <span class="number">163</span>, <span class="number">179</span>, <span class="number">131</span>, <span class="number">147</span>, <span class="number">98</span>, <span class="number">114</span>, <span class="number">66</span>, <span class="number">82</span>, <span class="number">34</span>, <span class="number">50</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">226</span>, <span class="number">242</span>, <span class="number">194</span>, <span class="number">210</span>, <span class="number">162</span>, <span class="number">178</span>, <span class="number">130</span>, <span class="number">146</span>, <span class="number">101</span>, <span class="number">117</span>, <span class="number">69</span>, <span class="number">85</span>, <span class="number">37</span>, <span class="number">53</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">229</span>, <span class="number">245</span>, <span class="number">197</span>, <span class="number">213</span>, <span class="number">165</span>, <span class="number">181</span>, <span class="number">133</span>, <span class="number">149</span>, <span class="number">100</span>, <span class="number">116</span>, <span class="number">68</span>, <span class="number">84</span>, <span class="number">36</span>, <span class="number">52</span>, <span class="number">4</span>, <span class="number">20</span>, <span class="number">228</span>, <span class="number">244</span>, <span class="number">196</span>, <span class="number">212</span>, <span class="number">164</span>, <span class="number">180</span>, <span class="number">132</span>, <span class="number">148</span>, <span class="number">103</span>, <span class="number">119</span>, <span class="number">71</span>, <span class="number">87</span>, <span class="number">39</span>, <span class="number">55</span>, <span class="number">7</span>, <span class="number">23</span>, <span class="number">231</span>, <span class="number">247</span>, <span class="number">199</span>, <span class="number">215</span>, <span class="number">167</span>, <span class="number">183</span>, <span class="number">135</span>, <span class="number">151</span>, <span class="number">102</span>, <span class="number">118</span>, <span class="number">70</span>, <span class="number">86</span>, <span class="number">38</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">230</span>, <span class="number">246</span>, <span class="number">198</span>, <span class="number">214</span>, <span class="number">166</span>, <span class="number">182</span>, <span class="number">134</span>, <span class="number">150</span>]</span><br><span class="line">plaintext = <span class="string">b&quot;I will give you some hint: &quot;</span> + flag</span><br><span class="line">plaintext = pad(plaintext,<span class="number">16</span>,<span class="string">&quot;pkcs7&quot;</span>)</span><br><span class="line">ciphertext = <span class="string">b&quot;&quot;</span> </span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">aes = AES(key, Sbox=mybox)</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">len</span>(plaintext) &gt; <span class="number">0</span>:</span><br><span class="line">    ciphertext += aes.encrypt(plaintext[:<span class="number">16</span>])</span><br><span class="line">    plaintext = plaintext[<span class="number">16</span>:]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;ciphertext.<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c = 26ec146dddda72b791585e5ecbc6a947bd6159d4de35df6c7717cd8eca1acd319f07803d8127f41b7ac7cdadc250ec8bb66f3661d772665a1622ffeba82996551463b738a997cd2c7081894fa9a5246c</span></span><br></pre></td></tr></table></figure>
<p>题目代码不短，不过大部分是AES的具体实现，所以不用管。题目真正有用的信息其实就两点：</p>
<ul>
<li>更换了一个AES的S盒</li>
<li>给了两组明文，以及AES加密后的对应密文</li>
</ul>
<p>第一感觉应该是AES的某一部分作了小改动，然后导致产生了漏洞。但是把S盒换成普通的S盒之后，用自己构造的key，将明文分别用这个AES和cyberchef的AES进行加密，结果是完全一样的！说明这个AES真的就是完整、普通的AES加密，没有改动任何地方。</p>
<p>然后就懵了很久，因为好像没听说过AES还能已知明文攻击。但是题目目的其实已经很清楚了：根据这个更换的S盒以及两组明密文对，对AES进行已知明文攻击。</p>
<p>那肯定就是这个S盒设计的有问题，查阅后发现针对S盒确实有一种差分密码分析方式，然后就学习了一波：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43734797/article/details/124055427">密码分析（一）：差分密码分析-CSDN博客</a></p>
<p>简单说明一下我的理解，在这里我把差分分析的相关概念根据题目具体化一下：</p>
<p><strong>差分：</strong>两组明文的异或值，就是明文差分；同理，两组密文的异或值，就是密文差分。</p>
<p><strong>差分分析的依据：</strong>与密钥异或，不会改变差分</p>
<p>什么叫不会改变差分？我们把AES的行移位、列混淆都先不管，先单独看一下用到S盒的部分，也就是字节代换以及进行代换前的轮密钥加。这样的话，简单画个草图：</p>
<p><img src="/post/a5bd8c0d/image-20231010101627908.png" alt="image-20231010101627908"></p>
<p>那么不会改变差分就体现在下面的式子中：若有</p>
<script type="math/tex; mode=display">
m_1 \oplus m_2 = t</script><p>则：</p>
<script type="math/tex; mode=display">
m_1' \oplus m_2'  = (m_1\oplus roundkey) \oplus (m_2\oplus roundkey) = t</script><p>也就是说，轮密钥其实是对差分没有任何影响的，那么我们怎么利用这个事实进行攻击呢？</p>
<p>再回到刚才加密的那个图，可以看到，m1’经S盒代换后变成c1，m2’经S盒代换后变成c2，那么假设c1,c2的密文差分是r，那么我们就拥有了一个S盒的差分对 (t,r) 。</p>
<p>而S盒是一个字节代换操作，因此输入一共就有一个字节种可能，也就是256种，而对应的，所有可能的(m1,m2)明文对也就有256*256种，因此我们可以根据所有的(m1,m2)，用已知的S盒求出所有的(c1,c2)，从而求出所有明文差分及对应的密文差分，然后建立出一张S盒的差分表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        t[i^j][sbox[i]^sbox[j]] += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>那你应该要想到，这种差分对于一个设计良好的S盒来说，要显得很随机，因为S盒的字节代换本身是一个非线性操作，如果随机性不够，那么会让这个S盒有较大的概率暴露线性特征。</p>
<p>这么说可能还是有点抽象，直接列出两种S盒的差分表就直观了，简单打印一下前几行看看：</p>
<p>正常S盒的差分表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">256</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<p>这个题目的S盒的差分表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">256</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>能感受到区别了吧，这个题目的S盒的差分表完全就没有任何随机性，明文差分与密文差分完全是固定的！而这个固定的差分就不会受轮密钥加的影响，因此我们完全不需要密钥，把对应密钥的操作剔除掉即可。</p>
<p>也就是说，我们只需要将已知密文与未知密文求差分，然后将这个差分用AES解密(去除轮密钥加)，求出初始的明文差分，然后将这个差分与已知明文再求差分，就能得到未知的明文了。</p>
<p>需要注意的是，由于是对差分进行AES解密，所以用的并不是题目给的S盒，而是由S盒求出的差分S盒。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([i^j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(a,b)])</span><br><span class="line"></span><br><span class="line">xtime = <span class="keyword">lambda</span> a: (((a &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x1B</span>) &amp; <span class="number">0xFF</span>) <span class="keyword">if</span> (a &amp; <span class="number">0x80</span>) <span class="keyword">else</span> (a &lt;&lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">Rcon = (</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>, <span class="number">0x6C</span>, <span class="number">0xD8</span>, <span class="number">0xAB</span>, <span class="number">0x4D</span>, <span class="number">0x9A</span>,</span><br><span class="line">    <span class="number">0x2F</span>, <span class="number">0x5E</span>, <span class="number">0xBC</span>, <span class="number">0x63</span>, <span class="number">0xC6</span>, <span class="number">0x97</span>, <span class="number">0x35</span>, <span class="number">0x6A</span>,</span><br><span class="line">    <span class="number">0xD4</span>, <span class="number">0xB3</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0xEF</span>, <span class="number">0xC5</span>, <span class="number">0x91</span>, <span class="number">0x39</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text2matrix</span>(<span class="params">text</span>):</span><br><span class="line">    text = <span class="built_in">int</span>(text.<span class="built_in">hex</span>(), <span class="number">16</span>)</span><br><span class="line">    matrix = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        byte = (text &gt;&gt; (<span class="number">8</span> * (<span class="number">15</span> - i))) &amp; <span class="number">0xFF</span></span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            matrix.append([byte])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            matrix[i // <span class="number">4</span>].append(byte)</span><br><span class="line">    <span class="keyword">return</span> matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix2text</span>(<span class="params">matrix</span>):</span><br><span class="line">    text = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            text |= (matrix[i][j] &lt;&lt; (<span class="number">120</span> - <span class="number">8</span> * (<span class="number">4</span> * i + j)))</span><br><span class="line">    <span class="keyword">return</span> text.to_bytes(<span class="number">16</span>, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AES</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, Sbox</span>):</span><br><span class="line">        self.Sbox = Sbox</span><br><span class="line">        self.InvSbox = [<span class="number">0</span>]* <span class="number">256</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            self.InvSbox[self.Sbox[i]] = i</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self, ciphertext</span>):</span><br><span class="line">        self.cipher_state = text2matrix(ciphertext)</span><br><span class="line">        self.__inv_shift_rows(self.cipher_state)</span><br><span class="line">        self.__inv_sub_bytes(self.cipher_state)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            self.__round_decrypt(self.cipher_state)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> matrix2text(self.cipher_state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__round_decrypt</span>(<span class="params">self, state_matrix</span>):</span><br><span class="line">        self.__inv_mix_columns(state_matrix)</span><br><span class="line">        self.__inv_shift_rows(state_matrix)</span><br><span class="line">        self.__inv_sub_bytes(state_matrix)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__inv_sub_bytes</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                s[i][j] = self.InvSbox[s[i][j]]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__inv_shift_rows</span>(<span class="params">self, s</span>):</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">1</span>], s[<span class="number">1</span>][<span class="number">1</span>], s[<span class="number">2</span>][<span class="number">1</span>], s[<span class="number">3</span>][<span class="number">1</span>] = s[<span class="number">3</span>][<span class="number">1</span>], s[<span class="number">0</span>][<span class="number">1</span>], s[<span class="number">1</span>][<span class="number">1</span>], s[<span class="number">2</span>][<span class="number">1</span>]</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">2</span>], s[<span class="number">1</span>][<span class="number">2</span>], s[<span class="number">2</span>][<span class="number">2</span>], s[<span class="number">3</span>][<span class="number">2</span>] = s[<span class="number">2</span>][<span class="number">2</span>], s[<span class="number">3</span>][<span class="number">2</span>], s[<span class="number">0</span>][<span class="number">2</span>], s[<span class="number">1</span>][<span class="number">2</span>]</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">3</span>], s[<span class="number">1</span>][<span class="number">3</span>], s[<span class="number">2</span>][<span class="number">3</span>], s[<span class="number">3</span>][<span class="number">3</span>] = s[<span class="number">1</span>][<span class="number">3</span>], s[<span class="number">2</span>][<span class="number">3</span>], s[<span class="number">3</span>][<span class="number">3</span>], s[<span class="number">0</span>][<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mix_single_column</span>(<span class="params">self, a</span>):</span><br><span class="line">        t = a[<span class="number">0</span>] ^ a[<span class="number">1</span>] ^ a[<span class="number">2</span>] ^ a[<span class="number">3</span>]</span><br><span class="line">        u = a[<span class="number">0</span>]</span><br><span class="line">        a[<span class="number">0</span>] ^= t ^ xtime(a[<span class="number">0</span>] ^ a[<span class="number">1</span>])</span><br><span class="line">        a[<span class="number">1</span>] ^= t ^ xtime(a[<span class="number">1</span>] ^ a[<span class="number">2</span>])</span><br><span class="line">        a[<span class="number">2</span>] ^= t ^ xtime(a[<span class="number">2</span>] ^ a[<span class="number">3</span>])</span><br><span class="line">        a[<span class="number">3</span>] ^= t ^ xtime(a[<span class="number">3</span>] ^ u)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mix_columns</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            self.__mix_single_column(s[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__inv_mix_columns</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            u = xtime(xtime(s[i][<span class="number">0</span>] ^ s[i][<span class="number">2</span>]))</span><br><span class="line">            v = xtime(xtime(s[i][<span class="number">1</span>] ^ s[i][<span class="number">3</span>]))</span><br><span class="line">            s[i][<span class="number">0</span>] ^= u</span><br><span class="line">            s[i][<span class="number">1</span>] ^= v</span><br><span class="line">            s[i][<span class="number">2</span>] ^= u</span><br><span class="line">            s[i][<span class="number">3</span>] ^= v</span><br><span class="line"></span><br><span class="line">        self.__mix_columns(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sbox_diff</span>(<span class="params">sbox</span>):          </span><br><span class="line">    t = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            t[i^j][sbox[i]^sbox[j]] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    sbox_diff = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="keyword">if</span> t[i][j] == <span class="number">256</span>:</span><br><span class="line">                sbox_diff[i] = j</span><br><span class="line">    <span class="keyword">return</span> sbox_diff</span><br><span class="line"></span><br><span class="line">sbox = [<span class="number">105</span>, <span class="number">121</span>, <span class="number">73</span>, <span class="number">89</span>, <span class="number">41</span>, <span class="number">57</span>, <span class="number">9</span>, <span class="number">25</span>, <span class="number">233</span>, <span class="number">249</span>, <span class="number">201</span>, <span class="number">217</span>, <span class="number">169</span>, <span class="number">185</span>, <span class="number">137</span>, <span class="number">153</span>, <span class="number">104</span>, <span class="number">120</span>, <span class="number">72</span>, <span class="number">88</span>, <span class="number">40</span>, <span class="number">56</span>, <span class="number">8</span>, <span class="number">24</span>, <span class="number">232</span>, <span class="number">248</span>, <span class="number">200</span>, <span class="number">216</span>, <span class="number">168</span>, <span class="number">184</span>, <span class="number">136</span>, <span class="number">152</span>, <span class="number">107</span>, <span class="number">123</span>, <span class="number">75</span>, <span class="number">91</span>, <span class="number">43</span>, <span class="number">59</span>, <span class="number">11</span>, <span class="number">27</span>, <span class="number">235</span>, <span class="number">251</span>, <span class="number">203</span>, <span class="number">219</span>, <span class="number">171</span>, <span class="number">187</span>, <span class="number">139</span>, <span class="number">155</span>, <span class="number">106</span>, <span class="number">122</span>, <span class="number">74</span>, <span class="number">90</span>, <span class="number">42</span>, <span class="number">58</span>, <span class="number">10</span>, <span class="number">26</span>, <span class="number">234</span>, <span class="number">250</span>, <span class="number">202</span>, <span class="number">218</span>, <span class="number">170</span>, <span class="number">186</span>, <span class="number">138</span>, <span class="number">154</span>, <span class="number">109</span>, <span class="number">125</span>, <span class="number">77</span>, <span class="number">93</span>, <span class="number">45</span>, <span class="number">61</span>, <span class="number">13</span>, <span class="number">29</span>, <span class="number">237</span>, <span class="number">253</span>, <span class="number">205</span>, <span class="number">221</span>, <span class="number">173</span>, <span class="number">189</span>, <span class="number">141</span>, <span class="number">157</span>, <span class="number">108</span>, <span class="number">124</span>, <span class="number">76</span>, <span class="number">92</span>, <span class="number">44</span>, <span class="number">60</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">236</span>, <span class="number">252</span>, <span class="number">204</span>, <span class="number">220</span>, <span class="number">172</span>, <span class="number">188</span>, <span class="number">140</span>, <span class="number">156</span>, <span class="number">111</span>, <span class="number">127</span>, <span class="number">79</span>, <span class="number">95</span>, <span class="number">47</span>, <span class="number">63</span>, <span class="number">15</span>, <span class="number">31</span>, <span class="number">239</span>, <span class="number">255</span>, <span class="number">207</span>, <span class="number">223</span>, <span class="number">175</span>, <span class="number">191</span>, <span class="number">143</span>, <span class="number">159</span>, <span class="number">110</span>, <span class="number">126</span>, <span class="number">78</span>, <span class="number">94</span>, <span class="number">46</span>, <span class="number">62</span>, <span class="number">14</span>, <span class="number">30</span>, <span class="number">238</span>, <span class="number">254</span>, <span class="number">206</span>, <span class="number">222</span>, <span class="number">174</span>, <span class="number">190</span>, <span class="number">142</span>, <span class="number">158</span>, <span class="number">97</span>, <span class="number">113</span>, <span class="number">65</span>, <span class="number">81</span>, <span class="number">33</span>, <span class="number">49</span>, <span class="number">1</span>, <span class="number">17</span>, <span class="number">225</span>, <span class="number">241</span>, <span class="number">193</span>, <span class="number">209</span>, <span class="number">161</span>, <span class="number">177</span>, <span class="number">129</span>, <span class="number">145</span>, <span class="number">96</span>, <span class="number">112</span>, <span class="number">64</span>, <span class="number">80</span>, <span class="number">32</span>, <span class="number">48</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">224</span>, <span class="number">240</span>, <span class="number">192</span>, <span class="number">208</span>, <span class="number">160</span>, <span class="number">176</span>, <span class="number">128</span>, <span class="number">144</span>, <span class="number">99</span>, <span class="number">115</span>, <span class="number">67</span>, <span class="number">83</span>, <span class="number">35</span>, <span class="number">51</span>, <span class="number">3</span>, <span class="number">19</span>, <span class="number">227</span>, <span class="number">243</span>, <span class="number">195</span>, <span class="number">211</span>, <span class="number">163</span>, <span class="number">179</span>, <span class="number">131</span>, <span class="number">147</span>, <span class="number">98</span>, <span class="number">114</span>, <span class="number">66</span>, <span class="number">82</span>, <span class="number">34</span>, <span class="number">50</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">226</span>, <span class="number">242</span>, <span class="number">194</span>, <span class="number">210</span>, <span class="number">162</span>, <span class="number">178</span>, <span class="number">130</span>, <span class="number">146</span>, <span class="number">101</span>, <span class="number">117</span>, <span class="number">69</span>, <span class="number">85</span>, <span class="number">37</span>, <span class="number">53</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">229</span>, <span class="number">245</span>, <span class="number">197</span>, <span class="number">213</span>, <span class="number">165</span>, <span class="number">181</span>, <span class="number">133</span>, <span class="number">149</span>, <span class="number">100</span>, <span class="number">116</span>, <span class="number">68</span>, <span class="number">84</span>, <span class="number">36</span>, <span class="number">52</span>, <span class="number">4</span>, <span class="number">20</span>, <span class="number">228</span>, <span class="number">244</span>, <span class="number">196</span>, <span class="number">212</span>, <span class="number">164</span>, <span class="number">180</span>, <span class="number">132</span>, <span class="number">148</span>, <span class="number">103</span>, <span class="number">119</span>, <span class="number">71</span>, <span class="number">87</span>, <span class="number">39</span>, <span class="number">55</span>, <span class="number">7</span>, <span class="number">23</span>, <span class="number">231</span>, <span class="number">247</span>, <span class="number">199</span>, <span class="number">215</span>, <span class="number">167</span>, <span class="number">183</span>, <span class="number">135</span>, <span class="number">151</span>, <span class="number">102</span>, <span class="number">118</span>, <span class="number">70</span>, <span class="number">86</span>, <span class="number">38</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">230</span>, <span class="number">246</span>, <span class="number">198</span>, <span class="number">214</span>, <span class="number">166</span>, <span class="number">182</span>, <span class="number">134</span>, <span class="number">150</span>]</span><br><span class="line">m = <span class="string">b&quot;I will give you some hint: DASCT&quot;</span></span><br><span class="line">ciphertext = <span class="string">b&quot;&quot;</span> </span><br><span class="line">aes = AES(Sbox=get_sbox_diff(sbox))</span><br><span class="line"></span><br><span class="line">c = <span class="string">&quot;26ec146dddda72b791585e5ecbc6a947bd6159d4de35df6c7717cd8eca1acd319f07803d8127f41b7ac7cdadc250ec8bb66f3661d772665a1622ffeba82996551463b738a997cd2c7081894fa9a5246c&quot;</span></span><br><span class="line">c1 = long_to_bytes(<span class="built_in">int</span>(c[:<span class="number">64</span>],<span class="number">16</span>))</span><br><span class="line">c2 = long_to_bytes(<span class="built_in">int</span>(c[<span class="number">64</span>:],<span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;DASCT&quot;</span>,end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c2)//<span class="number">16</span>):</span><br><span class="line">    diff1 = xor(c1[:<span class="number">16</span>],c2[<span class="number">16</span>*i:<span class="number">16</span>*i+<span class="number">16</span>])</span><br><span class="line">    temp1 = aes.decrypt(diff1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(xor(temp1,m[:<span class="number">16</span>]))[<span class="number">2</span>:-<span class="number">1</span>],end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#DASCTF&#123;de423c9aa5df7e683bd4b08bbca2a3409c018867&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="aes"><a href="#aes" class="headerlink" title="aes"></a>aes</h3><p>题目来源：EIS 2019</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">msg, key</span>):</span><br><span class="line">    ctr = Counter.new(<span class="number">128</span>,  initial_value=<span class="built_in">sum</span>(msg))</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CTR, counter=ctr)</span><br><span class="line">    <span class="keyword">return</span> cipher.encrypt(msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    signal.alarm(<span class="number">60</span>)</span><br><span class="line">    key = os.urandom(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/home/ctf/flag&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        flag = f.read()</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">30</span></span><br><span class="line">    enc_flag = enc(flag, key)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Welcome to the our AES encryption system!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Here is your encrypted flag: <span class="subst">&#123;enc_flag&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            plaintext = <span class="built_in">input</span>(<span class="string">&quot;Please input your plaintext: &quot;</span>)</span><br><span class="line">            plaintext = <span class="built_in">bytes</span>.fromhex(plaintext)</span><br><span class="line">            ciphertext = enc(plaintext, key)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Here is your ciphertext: <span class="subst">&#123;ciphertext&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Error!&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Bye~&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>靶机提供了如下操作：</p>
<ul>
<li>连接上靶机后，开始计时60s</li>
<li>随机生成十六字节作为AES密钥</li>
<li>使用AES_CTR模式对flag进行加密，其中Counter由flag的所有字节和生成，并给出flag的加密值</li>
<li>可以与服务器进行三十次交互，每一次交互中，可以输入一段明文，并获得其AES_CTR模式的加密值，对应Counter仍然由输入明文的字节和产生</li>
</ul>
<p>首先就注意到用了一个平时不怎么见的AES_CTR模式，那么问题肯定也出在这里，先了解一波CTR模式是什么：</p>
<p><a target="_blank" rel="noopener" href="https://wumansgy.github.io/2018/11/03/AES的CTR模式加密解密详解/">AES的CTR模式加密解密详解 | Wuman’s Blog (wumansgy.github.io)</a></p>
<p>其核心如下：</p>
<p><img src="/post/a5bd8c0d/image-20231019210651725.png" alt="image-20231019210651725"></p>
<p>可以看到，他的AES加密是作用于Counter而非明文。也就是说，其加密流程是将被AES加密的Counter与明文异或得到密文。</p>
<p>而这道题显然提供了Counter的额外信息，也就是其initial_value是传入明文的字节和。而flag固定为30个字节，因此其和只有256*30种可能性，完全可以爆破。而当我们取的明文值字节和正好等于flag的字节和时，其AES加密的结果相同，因此有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag = flag_enc ^ input ^ input_enc</span><br></pre></td></tr></table></figure>
<p>至于限时60s以及限30次，完全不重要，因为可以反复连接靶机而flag不会变。当然注意输入明文长度应与flag一致，均为30。</p>
<p>然而，在NSS上复现本题时，爆破完所有范围依然没有结果，此时打印出传回的flag_enc，发现是45字节，说明题目改动了flag与容器镜像的附件，但是下发的附件忘记改了，因此需要扩大范围至256*45。并且由于改动过flag，那么flag头应该考虑”NSSCTF”。同时，考虑到flag均为可见字符，因此复现时还可以进一步缩小一点范围。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> count <span class="keyword">in</span> trange(<span class="number">256</span>//<span class="number">2</span>*<span class="number">3</span>):</span><br><span class="line">    r = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28353</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;flag:&quot;</span>)</span><br><span class="line">    flag_enc = <span class="built_in">eval</span>(r.recvline().strip().decode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">        r.recvuntil(<span class="string">b&quot;plaintext: &quot;</span>)</span><br><span class="line">        num = <span class="number">30</span> * count + i</span><br><span class="line">        input1 = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span>(num &gt; <span class="number">255</span>):</span><br><span class="line">            num -= <span class="number">255</span></span><br><span class="line">            input1 += <span class="string">b&quot;\xff&quot;</span></span><br><span class="line">        input1 += long_to_bytes(num)</span><br><span class="line">        pad = (<span class="number">45</span>-<span class="built_in">len</span>(input1))*<span class="string">b&quot;\x00&quot;</span></span><br><span class="line">        input1 += pad           </span><br><span class="line">        r.sendline(input1.<span class="built_in">hex</span>())</span><br><span class="line">        r.recvuntil(<span class="string">b&quot;ciphertext:&quot;</span>)</span><br><span class="line">        input_c = <span class="built_in">eval</span>(r.recvline().strip().decode())</span><br><span class="line">        flag = long_to_bytes(bytes_to_long(input_c) ^ bytes_to_long(flag_enc) ^ bytes_to_long(input1))</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">b&quot;NSSCTF&quot;</span> <span class="keyword">in</span> flag):</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            exit()</span><br><span class="line">    r.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;b93abc9b-7972-4c46-b13f-5eed06787edc&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="3DES"><a href="#3DES" class="headerlink" title="3DES"></a>3DES</h3><p>题目来源：暂不明确</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expand</span>(<span class="params">k</span>):</span><br><span class="line">    k=k.<span class="built_in">hex</span>()</span><br><span class="line">    k=<span class="string">&#x27;&#x27;</span>.join(<span class="string">&#x27;0&#x27;</span>+c <span class="keyword">for</span> c <span class="keyword">in</span> k)</span><br><span class="line">    k=<span class="built_in">bytes</span>.fromhex(k)</span><br><span class="line">    <span class="keyword">return</span> k</span><br><span class="line"></span><br><span class="line">k1=expand(os.urandom(<span class="number">4</span>))</span><br><span class="line">k2=expand(os.urandom(<span class="number">4</span>))</span><br><span class="line">k3=expand(os.urandom(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">msg=pad(<span class="string">b&#x27;The flag:&#x27;</span>+flag,<span class="number">8</span>)</span><br><span class="line">enc1=DES.new(k1,mode=DES.MODE_ECB).encrypt(msg)</span><br><span class="line">enc2=strxor(enc1,k2*(<span class="built_in">len</span>(msg)//<span class="built_in">len</span>(k2)))</span><br><span class="line">enc3=DES.new(k3,mode=DES.MODE_ECB).encrypt(enc2)</span><br><span class="line"><span class="built_in">print</span>(enc3.<span class="built_in">hex</span>())</span><br><span class="line"><span class="comment">#e31e0ba78a911e14e8a2ae20fc7410e5d615d6841671497ee576749128a6df8b442912d910e82bd3ee463adaeebf91321060225d1308c20c4044af1add539b48b80bce411aad4a24fba68a89b2bfd3c1ee7cdae49b48acfd</span></span><br></pre></td></tr></table></figure>
<p>题目先生成三个4字节的key，并按如下方式将他们扩展到八字节：</p>
<ul>
<li>转为十六进制</li>
<li>在每个十六进制字符前面加一个0</li>
<li>转为字节流</li>
</ul>
<p>举个例子，如果生成的四字节key是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&quot;1111&quot;</span></span><br></pre></td></tr></table></figure>
<p>其十六进制为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;31313131&quot;</span></span><br></pre></td></tr></table></figure>
<p>那么最终expand后得到的八字节就是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&#x27;\x03\x01\x03\x01\x03\x01\x03\x01&#x27;</span></span><br></pre></td></tr></table></figure>
<p>讲完这个过程后回头看题目，他将三个key分别用在：</p>
<ul>
<li>第一层的DES加密</li>
<li>第二层的异或加密</li>
<li>第三层的DES加密</li>
</ul>
<p>然后给出了9个字节的已知明文头以及密文，要求解出明文。</p>
<p>由于DES加密分组为8字节一组，所以现在我们相当于拥有一组已知的明密文对，而看到这几层加密不难想到是要中间相遇攻击。具体来说，中间相遇的思路是：</p>
<ul>
<li>爆破k1去加密已知明文分组，建立字典</li>
<li>爆破k3去解密对应密文分组，查字典</li>
<li>如果在字典中，则是可能的k1、k3，可以进行解密来看是否有可见flag来判断是否是正确的密钥对</li>
</ul>
<p>但是这样没有考虑到k2的影响，事实上由于k2的存在，是没有办法直接用k1的加密值去建立字典的。不过，注意到k2也expand了，所以其对应十六进制的奇数位置的字符都是0，所以这些位置的k1加密值等于没有异或，因此只需要把这些位置的字符存入字典即可。</p>
<p>这样解决了怎么去中间相遇的问题，下一个问题就是复杂度。由于k1、k3都是随机4字节，那么要爆破的话，首先时间复杂度就是2^32往上，并且建立的字典也有2^32项，还要存关键字以及值，所以内存怎么也得用几十G，还得换机器跑。虽然说如果用C++写以及合适的机器跑的话似乎也勉强可以接受，但是还是太臃肿了。</p>
<p>然后突然反应过来这是DES，而DES的密钥看似是64bit，实际上是56bit，因为每个字节的最后一位本来是用于奇偶校验的，并不参与加密解密。因此回看expand后的key就可以少爆8bit，这样一下子就大大减小了时间和空间的压力，几分钟就可以跑出来。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 construct dic</span></span><br><span class="line">msg = <span class="string">b&#x27;The flag&#x27;</span></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(product(<span class="built_in">range</span>(<span class="number">8</span>),repeat = <span class="number">8</span>)):</span><br><span class="line">    tt1 = [<span class="built_in">hex</span>(<span class="number">2</span>*j)[<span class="number">2</span>:] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">list</span>(i)]</span><br><span class="line">    temp=<span class="string">&#x27;&#x27;</span>.join(<span class="string">&#x27;0&#x27;</span>+c <span class="keyword">for</span> c <span class="keyword">in</span> tt1)</span><br><span class="line">    k1 = <span class="built_in">bytes</span>.fromhex(temp)</span><br><span class="line">    enc1 = DES.new(k1,mode=DES.MODE_ECB).encrypt(msg)</span><br><span class="line">    enc1 = enc1.<span class="built_in">hex</span>()</span><br><span class="line">    tt = enc1[<span class="number">0</span>] + enc1[<span class="number">2</span>] + enc1[<span class="number">4</span>] + enc1[<span class="number">6</span>] + enc1[<span class="number">8</span>] + enc1[<span class="number">10</span>] + enc1[<span class="number">12</span>] + enc1[<span class="number">14</span>]</span><br><span class="line">    dic[tt] = tt1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 mitm and get flag</span></span><br><span class="line">c_prefix = long_to_bytes(<span class="built_in">int</span>(<span class="string">&quot;e31e0ba78a911e14&quot;</span>,<span class="number">16</span>))</span><br><span class="line">c = long_to_bytes(<span class="built_in">int</span>(<span class="string">&quot;e31e0ba78a911e14e8a2ae20fc7410e5d615d6841671497ee576749128a6df8b442912d910e82bd3ee463adaeebf91321060225d1308c20c4044af1add539b48b80bce411aad4a24fba68a89b2bfd3c1ee7cdae49b48acfd&quot;</span>,<span class="number">16</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(product(<span class="built_in">range</span>(<span class="number">8</span>),repeat = <span class="number">8</span>)):</span><br><span class="line">    tt1 = [<span class="built_in">hex</span>(<span class="number">2</span>*j)[<span class="number">2</span>:] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">list</span>(i)]</span><br><span class="line">    temp=<span class="string">&#x27;&#x27;</span>.join(<span class="string">&#x27;0&#x27;</span>+k <span class="keyword">for</span> k <span class="keyword">in</span> tt1)</span><br><span class="line">    k3 = <span class="built_in">bytes</span>.fromhex(temp)</span><br><span class="line">    dec2 = DES.new(k3,mode=DES.MODE_ECB).decrypt(c_prefix)</span><br><span class="line">    dec2 = dec2.<span class="built_in">hex</span>()</span><br><span class="line">    tt = dec2[<span class="number">0</span>] + dec2[<span class="number">2</span>] + dec2[<span class="number">4</span>] + dec2[<span class="number">6</span>] + dec2[<span class="number">8</span>] + dec2[<span class="number">10</span>] + dec2[<span class="number">12</span>] + dec2[<span class="number">14</span>]</span><br><span class="line">    <span class="keyword">if</span>(tt <span class="keyword">in</span> dic):</span><br><span class="line">        k1 = dic[tt]</span><br><span class="line">        k1 = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;&#x27;</span>.join(<span class="string">&#x27;0&#x27;</span>+k <span class="keyword">for</span> k <span class="keyword">in</span> k1))</span><br><span class="line"></span><br><span class="line">        <span class="comment">#get k2</span></span><br><span class="line">        enc1 = DES.new(k1,mode=DES.MODE_ECB).encrypt(msg)</span><br><span class="line">        dec2 = DES.new(k3,mode=DES.MODE_ECB).decrypt(c_prefix)</span><br><span class="line">        k2 = strxor(enc1,dec2[:<span class="number">8</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment">#try to decrypt</span></span><br><span class="line">        dec2 = DES.new(k3,mode=DES.MODE_ECB).decrypt(c)</span><br><span class="line">        dec1 = strxor(dec2,k2*(<span class="built_in">len</span>(c)//<span class="built_in">len</span>(k2)))</span><br><span class="line">        flag = DES.new(k1,mode=DES.MODE_ECB).decrypt(dec1)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            flag = unpad(flag,<span class="number">8</span>).decode()</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#DASCTF&#123;b3ffef61aaa0d088baf2c53abd8cccbf21b8bcd697a335f46ccc6b542f5437e9&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/a5bd8c0d.html" title="Crypto趣题-分组密码">https://tangcuxiaojikuai.xyz/post/a5bd8c0d.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/601c0957.html" rel="prev" title="Crypto趣题-Oracle">
      <i class="fa fa-chevron-left"></i> Crypto趣题-Oracle
    </a></div>
      <div class="post-nav-item">
    <a href="/post/6a80d23a.html" rel="next" title="2023-0xGame-week1-wp-crypto">
      2023-0xGame-week1-wp-crypto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#EASY-dfa"><span class="nav-number">1.</span> <span class="nav-text">EASY_dfa</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E4%B8%80%EF%BC%9A%E7%94%9F%E6%97%A5%E6%94%BB%E5%87%BB"><span class="nav-number">1.1.</span> <span class="nav-text">思路一：生日攻击</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E4%BA%8C%EF%BC%9A%E6%9E%84%E9%80%A0%E6%98%8E%E6%96%87"><span class="nav-number">1.2.</span> <span class="nav-text">思路二：构造明文</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#newAES"><span class="nav-number">2.</span> <span class="nav-text">newAES</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aes"><span class="nav-number">3.</span> <span class="nav-text">aes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3DES"><span class="nav-number">4.</span> <span class="nav-text">3DES</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">101</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
