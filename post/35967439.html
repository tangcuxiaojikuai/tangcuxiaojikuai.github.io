<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="简单写一写题目wp。">
<meta property="og:type" content="article">
<meta property="og:title" content="2023-春秋杯网络安全联赛冬季赛-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/35967439.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="简单写一写题目wp。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-01-21T11:14:04.000Z">
<meta property="article:modified_time" content="2024-01-22T15:58:18.000Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/35967439.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2023-春秋杯网络安全联赛冬季赛-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/35967439.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2023-春秋杯网络安全联赛冬季赛-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-21 19:14:04" itemprop="dateCreated datePublished" datetime="2024-01-21T19:14:04+08:00">2024-01-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-22 23:58:18" itemprop="dateModified" datetime="2024-01-22T23:58:18+08:00">2024-01-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/35967439.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/35967439.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>简单写一写题目wp。</p>
<span id="more"></span>
<h3 id="not-wiener"><a href="#not-wiener" class="headerlink" title="not_wiener"></a>not_wiener</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random, os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line">flag=<span class="string">b&#x27;&#x27;</span></span><br><span class="line">x = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        q = getPrime(<span class="number">160</span>)</span><br><span class="line">        p = <span class="number">2</span> * getPrime(<span class="number">1024</span>-<span class="number">160</span>) * q+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    h = random.randint(<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">    g = powmod(h,(p-<span class="number">1</span>)//q, p)</span><br><span class="line">    y=<span class="built_in">pow</span>(g,x,p)</span><br><span class="line">    <span class="keyword">return</span> p,q,g,y</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cry</span>():</span><br><span class="line">    a =</span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = getPrime(<span class="number">512</span>)</span><br><span class="line">    d = getPrime(<span class="number">280</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    e = inverse(d, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">    c = <span class="built_in">pow</span>(a, e, n)</span><br><span class="line">    <span class="keyword">return</span> n,e,c</span><br><span class="line"></span><br><span class="line">p,q,g,y=gen_key()</span><br><span class="line">k1 = random.randint(<span class="number">1</span>, q-<span class="number">1</span>)</span><br><span class="line">h1 = bytes_to_long(sha1(os.urandom(<span class="number">20</span>)).digest())</span><br><span class="line">r1 = <span class="built_in">pow</span>(g, k1, p) % q</span><br><span class="line">s1 = ((h1 + x*r1) * invert(k1, q))% q</span><br><span class="line"></span><br><span class="line">n,e,c= cry()</span><br><span class="line"></span><br><span class="line">a=</span><br><span class="line">b= <span class="number">17474742587088593627</span></span><br><span class="line">k2 = a*k1 + b</span><br><span class="line">h2 = bytes_to_long(sha1(os.urandom(<span class="number">20</span>)).digest())</span><br><span class="line">r2 = <span class="built_in">pow</span>(g, k2, p) % q</span><br><span class="line">s2 = ((h2 + x*r2) * invert(k2, q)) % q</span><br><span class="line"><span class="built_in">print</span>(n,e,c)</span><br><span class="line"><span class="built_in">print</span>(p,q,g,y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;h1:%s r1:%s s1:%s&quot;</span>%(h1,r1,s1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;h2:%s r2:%s s2:%s&quot;</span>%(h2,r2,s2))</span><br></pre></td></tr></table></figure>
<p>题目看上去不算短，但其实对DSA比较熟悉的话，马上就可以看出这道题目的主体其实是一个线性k的DSA攻击，只是两个k的线性关系中，a被隐去了，所以就需要通过cry()函数提供的信息来解出。</p>
<p>而关于a的信息就是一个RSA加密结果，而在这个RSA加密中由于d较小，所以可以用boneh and durfee攻击得到d，然后就可以解密出a了。题目名字的not wiener也就用在这里，因为d的界大概是0.273，超过了wiener要求的$ \frac{1}{3}n^{\frac{1}{4}}$，但是却又小于boneh and durfee要求的理论上界0.292，而且并不极限所以不怎么需要调参数就能跑出来。</p>
<p>得到a过后就是个DSA的线性k攻击，主要思路就是用两次签名的式子消元解出私钥x，也就是题目中的flag。这一部分网上的资料很多并且我之前的博客也有讲过，其大概思路写下来也就是如下。因为有：</p>
<script type="math/tex; mode=display">
(h_1 + xr_1)k^{-1} = s_1 \quad(mod\;q)</script><script type="math/tex; mode=display">
(h_2 + xr_2)(ak+b)^{-1} = s_2 \quad(mod\;q)</script><p>由于k是线性关系，所以选择消去k或者x都可以也都很方便，这里就选择消去x为例。首先把逆元乘过去：</p>
<script type="math/tex; mode=display">
h_1 + xr_1 = s_1k \quad(mod\;q)</script><script type="math/tex; mode=display">
h_2 + xr_2 = s_2(ak+b) \quad(mod\;q)</script><p>为了消去x，再进行移项，并且配系数使两个等式可以作差：</p>
<script type="math/tex; mode=display">
xr_1r_2 = (s_1k-h_1)r_2 \quad(mod\;q)</script><script type="math/tex; mode=display">
xr_1r_2 = (s_2(ak+b)-h_2)r_1 \quad(mod\;q)</script><p>现在作差就可以消去x了，得到一个如下形式的等式：</p>
<script type="math/tex; mode=display">
(s_1k-h_1)r2 - (s_2(ak+b)-h_2)r_1 = 0 \quad(mod\;q)</script><p>现在已经可以直接求这个方程得到k了，不过也可以合并同类项，然后直接得到k的表达式来计算：</p>
<script type="math/tex; mode=display">
k(s_1r_2-s_2ar_1) = h_1r_2 - h_2r_1 + s_2br_1 \quad(mod\;q)</script><p>得到k过后随便带入一个式子就能得到x也就是flag。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get a(boneh and durfee)</span></span><br><span class="line">a = bytes_to_long(<span class="string">b&quot;6d70e71d06e29c742b86a6da0108238e&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 DSA&#x27;s linear k attack</span></span><br><span class="line">p= <span class="number">161310487790785086482919800040790794252181955976860261806376528825054571226885460699399582301663712128659872558133023114896223014064381772944582265101778076462675402208451386747128794418362648706087358197370036248544508513485401475977401111270352593919906650855268709958151310928767086591887892397722958234379</span></span><br><span class="line">q= <span class="number">1115861146902610160756777713087325311747309309771</span></span><br><span class="line">g= <span class="number">61073566757714587321114447684333928353300944355112378054603585955730395524359123615359185275743626350773632555967063692889668342544616165017003197599818881844811647270423070958521148291118914198811187731689123176313367399492561288350530256722898205674043032421874788802819858438796795768177550638273020791962</span></span><br><span class="line">y= <span class="number">23678147495254433946472657196764372220306841739888385605070426528738230369489739339976134564575544246606937803367113623097260181789372915552172469427842482448570540429192377881186772226796452797182435452490307834205012154495575570994963829345053331967442452842152258650027916313982835119514473311305158299360</span></span><br><span class="line">(h1, r1, s1) = <span class="number">535874494834828755542711401117152397489711233142</span>, <span class="number">117859946800380767356190121030392492081340616512</span>, <span class="number">26966646740134065096660259687229179143947213779</span></span><br><span class="line">(h2, r2, s2) = <span class="number">236574518096866758760287021848258048065293279716</span>, <span class="number">863199000523521111517835459866422731857447792677</span>, <span class="number">517924607931342012033031470185302567344725962419</span></span><br><span class="line"></span><br><span class="line">b = <span class="number">17474742587088593627</span></span><br><span class="line"></span><br><span class="line">k = (h1*r2-h2*r1 + b*s2*r1)*inverse(s1*r2-a*s2*r1,q) % q</span><br><span class="line">x = (k*s1 - h1)*inverse(r1,q) % q</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(x))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;l1near_k1s_unsafe&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="ez-ECC"><a href="#ez-ECC" class="headerlink" title="ez_ECC"></a>ez_ECC</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ECDSA算法确实是一种奇妙的算法，它已经在现实世界中得到了广泛的应用。但由于操作问题，我不小心在我的签名中泄露了太多的数据。即使我泄露了这么多数据，也应该是安全的吧？</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> ecdsa</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> ceil</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> secret,hint,flag,my_own_prime</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag.startwith(<span class="string">b&#x27;flag&#123;&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> bytes_to_long(secret).bit_length() == <span class="number">384</span></span><br><span class="line"></span><br><span class="line">curves = ecdsa.curves</span><br><span class="line">NIST256p = curves.NIST256p</span><br><span class="line">NIST384p = curves.NIST384p</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Random_EC</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,state = <span class="literal">None</span>,Gen_Curve = <span class="literal">True</span></span>):</span><br><span class="line">        <span class="keyword">if</span> state == <span class="literal">None</span>:</span><br><span class="line">            self.state = getRandomNBitInteger(<span class="number">512</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.state = state</span><br><span class="line">        <span class="keyword">if</span> Gen_Curve:</span><br><span class="line">            self.int_curve()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">int_curve</span>(<span class="params">self,CURVE = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> CURVE == <span class="literal">None</span>:</span><br><span class="line">            self.Curve = NIST256p</span><br><span class="line">            self.g = self.Curve.generator * self.state</span><br><span class="line">            num1 = getRandomNBitInteger(<span class="number">256</span>)</span><br><span class="line">            num2 = getRandomNBitInteger(<span class="number">256</span>)</span><br><span class="line">            self.P = num2*self.g</span><br><span class="line">            self.Q = num1*self.g</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get the confirmed curve</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            Curve, P, Q = CURVE</span><br><span class="line">            self.Curve = Curve</span><br><span class="line">            self.g = Curve.gen(<span class="number">0</span>)</span><br><span class="line">            self.P = P</span><br><span class="line">            self.Q = Q</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">int_getkey</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># To get the right random key</span></span><br><span class="line">        t = <span class="built_in">int</span>((self.state * self.Q).x())</span><br><span class="line">        self.int_updade()</span><br><span class="line">        <span class="keyword">return</span> t%(<span class="number">2</span>**<span class="number">250</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">RSA_reinforce</span>(<span class="params">self,key: <span class="built_in">int</span></span>):</span><br><span class="line">        p = my_own_prime(<span class="number">512</span>)</span><br><span class="line">        q = my_own_prime(<span class="number">512</span>)</span><br><span class="line">        n = p * q</span><br><span class="line">        leak = p + q</span><br><span class="line">        e = <span class="number">16542764952</span></span><br><span class="line">        c = <span class="built_in">pow</span>(key, e, n)</span><br><span class="line">        <span class="keyword">return</span> (c, n, leak)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">int_updade</span>(<span class="params">self</span>):</span><br><span class="line">        self.state = <span class="built_in">int</span>((self.state * self.P).x())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Random_key</span>(<span class="params">self, n:<span class="built_in">int</span></span>):</span><br><span class="line">        out = <span class="number">0</span></span><br><span class="line">        number = ceil(n/<span class="number">250</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(number):</span><br><span class="line">            out = (out&lt;&lt;<span class="number">250</span>) + self.int_getkey()</span><br><span class="line">        <span class="keyword">return</span> out % (<span class="number">2</span>^n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECDSA</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.Random = Random_EC()</span><br><span class="line">        self.Curve_length = <span class="number">384</span></span><br><span class="line">        self.curve = NIST384p</span><br><span class="line">        self.gen = self.curve.generator</span><br><span class="line">        self.pri_key = self.Random.Random_key((self.Curve_length*<span class="number">125</span>)//<span class="number">192</span>)</span><br><span class="line">        self.pub_key = self.pri_key * self.gen</span><br><span class="line">        self.order = self.curve.order</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_curve</span>(<span class="params">self, curve</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.Random = Random_EC()</span><br><span class="line">        self.Curve_length = <span class="number">384</span></span><br><span class="line">        self.curve = curve</span><br><span class="line">        self.gen = curve.generator</span><br><span class="line">        self.order = self.curve.order</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_pri_key</span>(<span class="params">self, d: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.pri_key = d</span><br><span class="line">        self.pub_key = d * self.gen</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self, msg: <span class="built_in">bytes</span>, K_time:<span class="built_in">int</span></span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> K_time == <span class="number">0</span>:</span><br><span class="line">            K = long_to_bytes(self.Random.Random_key(self.Curve_length))</span><br><span class="line">            k = <span class="built_in">int</span>(sha256(K).hexdigest(), <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            k = K_time</span><br><span class="line"></span><br><span class="line">        P = k * self.gen</span><br><span class="line">        r = <span class="built_in">int</span>(P.x())</span><br><span class="line">        k_v = <span class="built_in">int</span>(inverse(k, self.order))</span><br><span class="line">        e = <span class="built_in">int</span>(sha256(msg).hexdigest(), <span class="number">16</span>)</span><br><span class="line">        s = (e + self.pri_key * r) * k_v % self.order</span><br><span class="line">        <span class="comment"># print(&#x27;k = &#x27;,k)</span></span><br><span class="line">        <span class="keyword">return</span> r, s, k</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">self, msg: <span class="built_in">bytes</span>, signature: <span class="built_in">tuple</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        r, s = signature</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span>  <span class="number">0</span> &lt; r &lt; self.order</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">0</span> &lt; s &lt; self.order</span><br><span class="line"></span><br><span class="line">        e = <span class="built_in">int</span>(sha256(msg).hexdigest(), <span class="number">16</span>)</span><br><span class="line">        w = <span class="built_in">int</span>(inverse(s, self.order))</span><br><span class="line">        u1 = e * w % self.order</span><br><span class="line">        u2 = r * w % self.order</span><br><span class="line">        P = u1 * self.gen + u2 * self.pub_key</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(r) == <span class="built_in">int</span>(P.x())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">into_secret</span>(<span class="params">self, msg: <span class="built_in">int</span></span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line">        <span class="comment"># sage</span></span><br><span class="line">        E = EllipticCurve(GF(<span class="built_in">int</span>(NIST384p.curve.p())),[<span class="built_in">int</span>(NIST384p.curve.a()), <span class="built_in">int</span>(NIST384p.curve.b())])</span><br><span class="line">        Point = E.lift_x(msg)</span><br><span class="line">        Key = self.Random.Random_key(self.Curve_length)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(Key)*Point</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    hint = <span class="string">b&quot;****************************************************&quot;</span></span><br><span class="line">    flag = bytes_to_long(flag)</span><br><span class="line">    hint = bytes_to_long(hint)</span><br><span class="line">    secret = bytes_to_long(secret)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">250</span>):</span><br><span class="line">        SIGN = ECDSA()</span><br><span class="line"></span><br><span class="line">        Hint = SIGN.Random.RSA_reinforce(hint)</span><br><span class="line">        m1 = <span class="string">b&#x27;A typical Dual ec prng vulnerability applied to NSA, you can find its source in past papers.&#x27;</span></span><br><span class="line">        m2 = <span class="string">b&#x27;Hope you have learned a good foundation of ECDSA, it can help you better answer and understand this problem.&#x27;</span></span><br><span class="line">        C = flag^^secret</span><br><span class="line">        into_secret = SIGN.into_secret(secret)</span><br><span class="line">        sign1 = SIGN.sign(m1,<span class="number">0</span>)</span><br><span class="line">        sign2 = SIGN.sign(m2,sign1[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;C = <span class="subst">&#123;C&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Hint = <span class="subst">&#123;Hint&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;pub_key = <span class="subst">&#123;SIGN.pub_key.x(),SIGN.pub_key.y()&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;P = <span class="subst">&#123;<span class="built_in">int</span>(SIGN.Random.P.x()),<span class="built_in">int</span>(SIGN.Random.P.y())&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Q = <span class="subst">&#123;<span class="built_in">int</span>(SIGN.Random.Q.x()),<span class="built_in">int</span>(SIGN.Random.Q.y())&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;sign1 = <span class="subst">&#123;sign1[:<span class="number">2</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;sign2 = <span class="subst">&#123;sign2[:<span class="number">2</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;into_secret = <span class="subst">&#123;into_secret&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;-------------------------------------------------------------------&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Dual-EC"><a href="#Dual-EC" class="headerlink" title="Dual EC"></a>Dual EC</h4><p>这个题目就更长了，不过m1，m2中给了提示说题目与Dual EC伪随机数发生器相关，然后想到之前在Zima师傅的博客上好像有看到过一个有关的题目：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ZimaBlue/articles/17739366.html">第七届蓝帽杯全国大学生网络安全技能大赛 - ZimaB1ue - 博客园 (cnblogs.com)</a></p>
<p>两个题目确实是有不少相似之处，但是为了彻底弄明白整个题目，还是要把整个Dual EC的加密过程与后门搞清楚，然后也找到了一篇很好的材料：</p>
<p><a target="_blank" rel="noopener" href="https://tl2cents.github.io/2023/04/20/Cryptographic-Backdoor-1-Dual-EC/">密码学后门系列Ⅰ: Dual EC | tl2cents blog</a></p>
<p>如果各位师傅对整个过程还不太清楚的话，学习一下上面这篇博客之后再来看题目，帮助会更大。</p>
<p>简单总结一下，Dual EC其实就是一个伪随机数发生器，他选取E=NIST256p作为用于产生伪随机数的椭圆曲线，其产生随机数的步骤是：</p>
<ul>
<li>选取E上的两个随机点P、Q</li>
<li>初始化一个起始状态state(256bit)</li>
<li>每次要获取一个随机数时，就计算当前的stateQ的横坐标，并按要求截取对应比特，当作本次产生的伪随机数；产生伪随机数后，更新state为stateP的横坐标</li>
</ul>
<p>就是这么简洁，然后他的后门也很易懂，如果攻击者掌握了一个d值，这个d值满足：</p>
<script type="math/tex; mode=display">
P = dQ</script><p>那么对于任意一个产生的随机数，攻击者相当于知道了对应的stateQ点，那么又因为他知道d，所以他就有state*dQ点，也就是stateP点。也就是说，攻击者就能获取以后的所有伪随机数，这就是Dual EC的后门。</p>
<h4 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h4><p>首先就会发现这个hint其实很容易就能解，因为其实就是用leak和n去构造一个关于p和q的方程就能解出p、q。但是出题人还非要绕一下，e和phi是不互素的，还需要有限域开根或者AMM才能解出hint。总之解出来hint是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Anything greater than <span class="number">2</span>^<span class="number">15</span> <span class="keyword">is</span> really that<span class="string">&#x27;s too big</span></span><br></pre></td></tr></table></figure>
<p>当然现在是肯定完全不知道这句话是什么意思的，那就接着分析题目。接下来可以发现的一点是：所有签名的r值都相同。</p>
<p>这一点看代码也能看出，对m2的签名用的是签名m1时的k，所以存在一个k复用的问题。而签名的流程是：</p>
<script type="math/tex; mode=display">
s_1k = r_1*pri+e_1 \quad(mod\;order)</script><script type="math/tex; mode=display">
s_2k = r_2*pri+e_2 \quad(mod\;order)</script><p>而k相同会导致r相同，所以两式只需要简单作差消去k，就能求出pri的值：</p>
<script type="math/tex; mode=display">
pri = (e_2s_1 - e_1s_2)(r_1s_2-r_2s_1)^{-1} \quad(mod\;order)</script><p>既然能求出pri的值，而pri是250bit数量级，是一个state*Q的坐标的低250位，因此只需要爆破6位就可以得到这个点的完整坐标。而根据Dual EC的后门可以知道，如果我们有P=dQ的d这个值，就可以完全掌控后面所有的state，也就可以拿到之后用于加密secret的key值。那么问题就在于如何求出这个d。</p>
<p>而P、Q点的生成过程是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,state = <span class="literal">None</span>,Gen_Curve = <span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">if</span> state == <span class="literal">None</span>:</span><br><span class="line">        self.state = getRandomNBitInteger(<span class="number">512</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.state = state</span><br><span class="line">    <span class="keyword">if</span> Gen_Curve:</span><br><span class="line">        self.int_curve()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">int_curve</span>(<span class="params">self,CURVE = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> CURVE == <span class="literal">None</span>:</span><br><span class="line">        self.Curve = NIST256p</span><br><span class="line">        self.g = self.Curve.generator * self.state</span><br><span class="line">        num1 = getRandomNBitInteger(<span class="number">256</span>)</span><br><span class="line">        num2 = getRandomNBitInteger(<span class="number">256</span>)</span><br><span class="line">        self.P = num2*self.g</span><br><span class="line">        self.Q = num1*self.g</span><br></pre></td></tr></table></figure>
<p>蓝帽杯那个题目中，是由于num1和num2较小，所以可以用bsgs来碰撞出d值。但这个题目里很显然根本就没有任何方法可以利用。虽然说他给了很多组数据没错，但是这些数据之间其实可以说是完全独立的，没有什么联系。我也就卡在这一步了。</p>
<p>这个时候突然想起来貌似还有个hint没有用，他说的是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Anything greater than <span class="number">2</span>^<span class="number">15</span> <span class="keyword">is</span> really that<span class="string">&#x27;s too big</span></span><br></pre></td></tr></table></figure>
<p>然后就冒出一个比较大胆的猜想，这个意思难道是在说这么多组数据之中，存在一个小于2^15的d值？一旦有了这个想法，马上就能找到一个证明这个思路的依据：</p>
<ul>
<li>一共只有232组数据，和题目循环的250次不一样，显然动了手脚</li>
</ul>
<p>。。。。。。那么题目给这么多组明明就没有关系的数据也就说得通了。但是感觉其实就和前面的AMM一样，其实没有多大必要在这里设一道坎的，多少还是有点脑洞。</p>
<p>那么接下来要做的是就是对每一组依次试一下看存不存在小于2^15的d满足P=dQ，然后用存在的那一组解密即可。这里也有一点小的优化技巧，就是不要这样写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">15</span>):</span><br><span class="line">	<span class="keyword">if</span>(i*Q == P):</span><br><span class="line">		<span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>
<p>这样是很自然的写法，但是会做很多多余的点加法计算，就比如你计算9Q的时候，其实在前面计算8Q时已经算过8Q的值，只需要用那个8Q的值求8Q+Q就能得到9Q了。所以更好的方式是写成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">P = NIST_256_CURVE(P)</span><br><span class="line">Q = NIST_256_CURVE(Q)</span><br><span class="line">q0 = Q</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">15</span>):</span><br><span class="line">	<span class="keyword">if</span>(q0 == P):</span><br><span class="line">		<span class="built_in">print</span>(j,i)</span><br><span class="line">		<span class="built_in">print</span>(P)</span><br><span class="line">	q0 += Q</span><br></pre></td></tr></table></figure>
<p>这样会减少很多时间，本来爆破完所有数据可能要两小时，但这样五六分钟就可以搞定。</p>
<p>求出d过后就是控制Dual EC生成我们需要的伪随机数key，然后求逆并作点乘得到secret，并与C异或就得出flag了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> ceil</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get hint</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    c,n,leak = (<span class="number">12351774260625362799610458605055557349668978169954248709224197283033722650641969191523420968152180626844781310599988085824706330561484553939064653937267598659731237154241515349280967639128615784193195725170343153328247947729351564102666060302013802359410482179324719156651832539747622404434096773119440083329</span>, <span class="number">122908984806235457892414635852036332676574434804833208576141668077475917235411535511069143359388659946159724740722593181625712110278669227640297497485641848470391938438894136564046632275052354217712453952532772368082733299695485759213723305738760035793602060420638500827652832664161031815519780589765520132973</span>, <span class="number">22333858470427703056488469739724305644350178024239032705153649807913901449803887198889611591209527103787726531081225700412575986297091811550954958064297166</span>)</span><br><span class="line">    e = <span class="number">16542764952</span></span><br><span class="line">    p_q = iroot(leak^<span class="number">2</span>-<span class="number">4</span>*n,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">    p = (leak + p_q) // <span class="number">2</span></span><br><span class="line">    q = n // p</span><br><span class="line">    cq = <span class="built_in">pow</span>(c,inverse(e//<span class="number">24</span>,q-<span class="number">1</span>),q)</span><br><span class="line">    PR.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">    f = x^<span class="number">24</span> - cq</span><br><span class="line">    resq = f.roots()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> resq:</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(i[<span class="number">0</span>])))</span><br><span class="line">    <span class="comment">#hint: Anything greater than 2^15 is really that&#x27;s too big</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get d</span></span><br><span class="line"><span class="comment"># NIST P-256</span></span><br><span class="line">NIST_256_P = <span class="number">0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff</span></span><br><span class="line">NIST_256_K = GF(NIST_256_P)</span><br><span class="line">NIST_256_A = NIST_256_K(<span class="number">0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc</span>)</span><br><span class="line">NIST_256_B = NIST_256_K(<span class="number">0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b</span>)</span><br><span class="line">NIST_256_CURVE = EllipticCurve(NIST_256_K, (NIST_256_A, NIST_256_B))</span><br><span class="line">NIST_256_GEN = NIST_256_CURVE(<span class="number">0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296</span>, <span class="number">0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5</span>)</span><br><span class="line">NIST_256_ORDER = <span class="number">0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551</span> * <span class="number">0x1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># NIST P-384</span></span><br><span class="line">NIST_384_P = <span class="number">0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff</span></span><br><span class="line">NIST_384_K = GF(NIST_384_P)</span><br><span class="line">NIST_384_A = NIST_384_K(<span class="number">0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc</span>)</span><br><span class="line">NIST_384_B = NIST_384_K(<span class="number">0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef</span>)</span><br><span class="line">NIST_384_CURVE = EllipticCurve(NIST_384_K, (NIST_384_A, NIST_384_B))</span><br><span class="line">NIST_384_GEN = NIST_384_CURVE(<span class="number">0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7</span>, <span class="number">0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f</span>)</span><br><span class="line">NIST_384_ORDER = <span class="number">0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973</span> * <span class="number">0x1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#结合hint在2^15内爆破，发现第201组数据有异常：32309*Q = P</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;E:\vscode\py\crypto\春秋杯冬季赛 2023\ez_ECCc_output.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> trange(<span class="number">250</span>):</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">                <span class="built_in">exec</span>(f.readline())</span><br><span class="line">            f.readline()</span><br><span class="line">            P = NIST_256_CURVE(P)</span><br><span class="line">            Q = NIST_256_CURVE(Q)</span><br><span class="line">            q0 = Q</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">15</span>):</span><br><span class="line">                <span class="keyword">if</span>(q0 == P):</span><br><span class="line">                    <span class="built_in">print</span>(j,i)</span><br><span class="line">                    <span class="built_in">print</span>(P)</span><br><span class="line">                q0 += Q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 get pri</span></span><br><span class="line">C = <span class="number">28370462154406144789913243909256020527531135264361458510233553021695306448248185548876492600895007348961847185821989</span></span><br><span class="line">pub_key = (<span class="number">23063531651133054044852146745751828065565652508316078757465526964945889829041322577333868291426745685755660447945768</span> , <span class="number">38213774544479557349161813523787259744626407961805163166366401345392394160489749007540120063131112167181615738936602</span>)</span><br><span class="line">P = (<span class="number">99376526638506705902714648195970871631891150648967956889439656483745513799077</span>, <span class="number">49286347987713888387330453808791204691290920954467279402308313223992253330920</span>)</span><br><span class="line">Q = (<span class="number">95979043517822469787247449840043678535429394578371796773017425344169131078878</span>, <span class="number">94108817998367868965643129518919867199519351407755146103464278196693149407197</span>)</span><br><span class="line">r1,s1 = (<span class="number">32594514971850903210957109229029032596013744664454613348001968983388557886022626485537652491952756966982681985873826</span>, <span class="number">33822531453262141722363336331985371357432586409495680846477948429687072595338746861106767975593900234281162130620713</span>)</span><br><span class="line">r2,s2 = (<span class="number">32594514971850903210957109229029032596013744664454613348001968983388557886022626485537652491952756966982681985873826</span>, <span class="number">30963116078493244587396392437563800584802728459796510243236725881496588593849796130551914519859427419450232539678279</span>)</span><br><span class="line">into_secret = (<span class="number">12219467168510963191933866108724307399115854676119007622103880230537250338471252977689989738440080704914043187805666</span> , <span class="number">15140655916234412794356873631237108843402057349206472869810848889771783263614142207164313273971781373595696054566462</span>)</span><br><span class="line">e1 = <span class="built_in">int</span>(sha256(<span class="string">b&quot;A typical Dual ec prng vulnerability applied to NSA, you can find its source in past papers.&quot;</span>).hexdigest(), <span class="number">16</span>)</span><br><span class="line">e2 = <span class="built_in">int</span>(sha256(<span class="string">b&quot;Hope you have learned a good foundation of ECDSA, it can help you better answer and understand this problem.&quot;</span>).hexdigest(), <span class="number">16</span>)</span><br><span class="line">P = NIST_256_CURVE(P)</span><br><span class="line">Q = NIST_256_CURVE(Q)</span><br><span class="line">into_secret = NIST_384_CURVE(into_secret)</span><br><span class="line"></span><br><span class="line"><span class="comment">#shared-k attack</span></span><br><span class="line">r = r1 = r2</span><br><span class="line">o = NIST_384_ORDER</span><br><span class="line">pri = (e2*s1-e1*s2)*inverse(r1*s2-r2*s1,o) % o</span><br><span class="line"></span><br><span class="line">d = <span class="number">32309</span></span><br><span class="line"><span class="keyword">assert</span> d*Q==P</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part4 Dual_EC backdoor</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">int_getkey</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="comment"># To get the right random key</span></span><br><span class="line">    t = <span class="built_in">int</span>((state * Q)[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> t%(<span class="number">2</span>**<span class="number">250</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Random_key</span>(<span class="params">n,state</span>):</span><br><span class="line">    temp = state</span><br><span class="line">    out = <span class="number">0</span></span><br><span class="line">    number = ceil(n/<span class="number">250</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(number):</span><br><span class="line">        out = (out&lt;&lt;<span class="number">250</span>) + int_getkey(temp)</span><br><span class="line">        temp = <span class="built_in">int</span>((temp*P)[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> out % (<span class="number">2</span>^n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">6</span>):</span><br><span class="line">    r = i*<span class="number">2</span>^<span class="number">250</span> + pri</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        R = NIST_256_CURVE.lift_x(r)</span><br><span class="line">        S = d*R</span><br><span class="line">        state = <span class="built_in">int</span>(S[<span class="number">0</span>])</span><br><span class="line">        key = Random_key(<span class="number">384</span>,state)</span><br><span class="line">        secret = <span class="built_in">int</span>((inverse(key,o)*into_secret)[<span class="number">0</span>])</span><br><span class="line">        flag = long_to_bytes(<span class="built_in">int</span>(secret^^C))</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag):</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;EC_PRNG_DUAL_NSA_18saL_0dh1_fh2ass0j_happy&#125;</span></span><br></pre></td></tr></table></figure>
<p>然后里面的ez_ECCc_output.txt这个文件，就是用一些全局替换对题目的output简单做了下处理，具体来说长下面这个样子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pub_key = (<span class="number">7027198281618631109486546289418606436971306672049130948012540052979334787960281672746337056539439605928657120238948</span> , <span class="number">30133540967149613975580795321921856644836168481028610007698327788048304814516517723608956804180632040981935542511437</span>)</span><br><span class="line">P = (<span class="number">17823116086876603269147060388719138662933817343024907156946194895842434214281</span>, <span class="number">80495309605411726002105878653283056375715403786488100338817913553121489831495</span>)</span><br><span class="line">Q = (<span class="number">46211125703713341292250779219515629306817624623159126615353410671209836378592</span>, <span class="number">94299460316426215202488880100669252287366820173365904372956288139806594541521</span>)</span><br><span class="line">sign1 = (<span class="number">6024266653924965558891017862145460120918687496468619682171279074596829568579614877691814275653589570598579410112071</span>, <span class="number">38177481088058121800207400725752708499346593588334743367566585331125114008356717480483226246659297274051563633828949</span>)</span><br><span class="line">sign2 = (<span class="number">6024266653924965558891017862145460120918687496468619682171279074596829568579614877691814275653589570598579410112071</span>, <span class="number">16369791614659331230610038275555078273062830812174831682189450495008185190975437959806536731511751926751061875511021</span>)</span><br><span class="line">into_secret = (<span class="number">18008353077466326893639562184181541471523657777178523896116425154484047074966064804018839658773729302151970933329800</span> , <span class="number">9571770927641786375764966028815494982061521034302464222216678194218397272826459066078547700439904198852732709652236</span>)</span><br><span class="line"></span><br><span class="line">pub_key = (<span class="number">30952652464090154765700322426668773032420938414283809417202553773567574652233791704091301132956488800404306789683929</span> , <span class="number">24434565373866540175538188663428739461189279984830219306744288993496065112238042640140414987229292993385061168991884</span>)</span><br><span class="line">P = (<span class="number">61503409678425616256814824706718701705285717980372750579649622220042379199063</span>, <span class="number">41978512646631377264391570171154885686312333682242627154032473621923333680935</span>)</span><br><span class="line">Q = (<span class="number">240014305523009712905368281643270225420175458523341650798225304665234408613</span>, <span class="number">32766026654026451889850025426197960803468793975163659845047322191441149171379</span>)</span><br><span class="line">sign1 = (<span class="number">5416210854653151719049022358066744158998560461940033379429156268115331437487444739683004920113952381284779550518474</span>, <span class="number">22015555679435957137370999648019545701879994735584708151177942763291571402267659885807969927530527596907814361814246</span>)</span><br><span class="line">sign2 = (<span class="number">5416210854653151719049022358066744158998560461940033379429156268115331437487444739683004920113952381284779550518474</span>, <span class="number">15040404282504296230825332673502390022066437191583605036725522476133316703777454934819829899317477856672211592302446</span>)</span><br><span class="line">into_secret = (<span class="number">193136219101302929403672002025568011182508516205015861233115071685682648716347978711510614153126503990830819166256328501117112004986822861149334210295759079734086379886321520537693689496869032983739365453033379003922594948804120874</span>)</span><br><span class="line"></span><br><span class="line">pub_key = (<span class="number">23099020203147370343025197263073676926643140376101288717875201483840703687544603053757488654765255677440760503713978</span> , <span class="number">26114249417289088514441684945637228515176439146920836168796260800127107191830660494115786187518579103520377733967178</span>)</span><br><span class="line">P = (<span class="number">6394847313094066355092535870187127774709946937855744188908275981082478504869</span>, <span class="number">56646403494945610009636754829164685972045972046301795829835579362095319435811</span>)</span><br><span class="line">Q = (<span class="number">97716080684931874033397760667927007063270415118850496815451515445344135191822</span>, <span class="number">46519598120320390474773553046006013660088676744621584568185607341933322917054</span>)</span><br><span class="line">sign1 = (<span class="number">27086927550243061987095547909650882234082407878322873658240459376060724598083272966571400355987231527195299846018892</span>, <span class="number">23221862721323106146595388755440981055812829114828942824860327140563072790559259290097252303296557453898991310926722</span>)</span><br><span class="line">sign2 = (<span class="number">27086927550243061987095547909650882234082407878322873658240459376060724598083272966571400355987231527195299846018892</span>, <span class="number">22128212158572530213694047212096680763835792912115914158076280586875413266424638696597440583653147615519266382640505</span>)</span><br><span class="line">into_secret = (<span class="number">47049653917189265002689432956249150485391814948071645079435344313874379858788979536210104320058718078602413781801140430800896683283278287099214154956784204330473641487578641830520258749807353305263187416294227562859499072189690180</span>)</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="CF-is-Crypto-Faker"><a href="#CF-is-Crypto-Faker" class="headerlink" title="CF is Crypto Faker"></a>CF is Crypto Faker</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">学过AI的都知道，这题不是“纯密码”，密码假面人要披上AI的战衣，但他永远不会卸下密码的假面。</span><br></pre></td></tr></table></figure>
<p>题目(文件有六七个，这里只放对解题有用的几个文件)：</p>
<p>README.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Please firstly pay attention to the file named as &quot;task.py&quot;.</span><br><span class="line">The real flag is a little strange.</span><br><span class="line">However, there is no need to be messy in your mind just because of the &quot;appearance&quot; of the flag.</span><br><span class="line">Just be self-confident!</span><br></pre></td></tr></table></figure>
<p>task.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> initialize</span><br><span class="line"><span class="keyword">import</span> train</span><br><span class="line"><span class="keyword">import</span> valid</span><br><span class="line"><span class="keyword">import</span> test</span><br><span class="line"><span class="keyword">import</span> rec</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> message, flag_point</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;flag&#123;&quot;</span> + long_to_bytes(message) + long_to_bytes(flag_point) + <span class="string">b&quot;.&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The significant parameter n: %s&quot;</span> % <span class="built_in">hex</span>(n))</span><br><span class="line">phi0 = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">r = rec.rec(p, q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The unique parameter r: %s&quot;</span> % <span class="built_in">hex</span>(r))</span><br><span class="line"></span><br><span class="line">parameters = initialize.initialize(p, q)</span><br><span class="line">wild_phi = parameters[<span class="number">0</span>]</span><br><span class="line">wild_e = parameters[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Parameters are initialized to: \n  phi:%s\n&quot;</span> % <span class="built_in">hex</span>(wild_phi), <span class="string">&quot; e:%s&quot;</span> % <span class="built_in">hex</span>(wild_e))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;But they are wild and crazy!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;We have to give them a lesson!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;------&quot;</span>)</span><br><span class="line"></span><br><span class="line">parameters = train.train(wild_phi, wild_e, n, r, phi0)</span><br><span class="line">trained_phi = parameters[<span class="number">0</span>]</span><br><span class="line">trained_e = parameters[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Parameters are trained to: \n  phi:%s\n&quot;</span> % <span class="built_in">hex</span>(trained_phi), <span class="string">&quot; e:%s&quot;</span> % <span class="built_in">hex</span>(trained_e))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;After training, the two naughty parameters are more and more normal.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;It&#x27;s closer to your target!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;------&quot;</span>)</span><br><span class="line"></span><br><span class="line">parameters = valid.valid(trained_phi, trained_e, n)</span><br><span class="line">y_valid = parameters[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The encrypted output in validation set is %s&quot;</span> % <span class="built_in">hex</span>(y_valid))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;After validation, the model is more and more stable.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;To test the real flag!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;------&quot;</span>)</span><br><span class="line"></span><br><span class="line">parameters = test.test(trained_phi, trained_e, n)</span><br><span class="line">y_hat_cipher1 = parameters[<span class="number">0</span>]</span><br><span class="line">y_hat_cipher2 = parameters[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The final output is \n%s&quot;</span> % <span class="built_in">hex</span>(y_hat_cipher1), <span class="string">&quot;\n%s&quot;</span> % <span class="built_in">hex</span>(y_hat_cipher2))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;------&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>output.txt：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">The significant parameter n: <span class="number">0x81c5f040bfaea676120cd62c36ba7afb303561504bbf8609afa3da60fb6202ca875b0bd2a06143ebcd16fa615557ff159d97909160d68e1938b3ecaf57709b3d2698476b6dd203811b6a2ec6a6e2a7e213ab719bcd3ab49bb864b10e9c78ea3f501c0e2213dfe431043bb6f0cc2e8d77bfb43869b843af1a99ae81b87811e101</span></span><br><span class="line">The unique parameter r: <span class="number">0x4f37fe985d13ffde9867fa0063f68dea79196408b1404eadf03ea59297d629c2183a4a6a6647b6c4c99dd43bae8c4fa4691a608d20170fd42b18aef7efb3ae01cd3</span></span><br><span class="line">------</span><br><span class="line">Parameters are initialized to:</span><br><span class="line">  phi:<span class="number">0x81c5f040bfaea676120cd62c36ba7afb303561504bbf8609afa3da60fb6202ca875b0bd2a06143ebcd16fa615557ff159d97909160d68e1938b3ecaf57709648d78eb17edb46dda768a97d57e6bd1c48657393b7c0d9c574c38cc0a3545ce7d209ade33b8ac6b31a41fe9f4ed62b4ddd7b99859b74915f2031dd2f5f0499a2f8</span></span><br><span class="line">  e:<span class="number">0x2ebad696da6dda845bf03fdf34ee73d4849800de9267a5baa3c068e2d33a74727d00002fbfea775e5233087a9039d267130aa924a4f7fed3576f6ff7b8e1b2e8</span></span><br><span class="line">But they are wild <span class="keyword">and</span> crazy!</span><br><span class="line">We have to give them a lesson!</span><br><span class="line">------</span><br><span class="line">The loss <span class="keyword">is</span> -<span class="number">0x5144bdad7cc24f5348c5752dda0ff5fa7d72e36370d5af55eb6f590ac0764b843a06ee1a4651b8f3a6c878df56f1678454e58eaf0ede9a1eb0503dce6a1303b69e33bbaad112abb051a28d51a9fee629e89400a338bd02998568d044852f11e05572fc4a0ddacdf7342048295a4025394e77e973621a77ea5bbdb06af2cb72b2f8298e2cd16736454fd066d3d96a4f77cd094cd783ead17024de981df7ade84aa8c282b1ec6f8ec6ec4752727387ef637ba2a4eed8f83c77d5db14d297de8098</span></span><br><span class="line">Parameters are trained to:</span><br><span class="line">  phi:<span class="number">0x81c5f040bfaea676120cd62c36ba7afb303561504bbf8609afa3da60fb6202ca875b0bd2a06143ebcd16fa615557ff159d97909160d68e1938b3ecaf57709b3bb712fdcba325655f111918472d4353a66854ccda50b63a1047278c15a4b39cde898d054db87092958c7c05f8fa566dcd969b1ff4b7d1935c375a4af3bfc341b0</span></span><br><span class="line">  e:<span class="number">0x2c22193ad9abcca2f67552fc76dd07b3ef883f3d755c95119cdf82bb6a07c970fd37e582bb49250d8efaa29b8a59c82059165c654206a9d7261f6b45a90dc69</span></span><br><span class="line">After training, the two naughty parameters are more <span class="keyword">and</span> more normal.</span><br><span class="line">It<span class="string">&#x27;s closer to your target!</span></span><br><span class="line"><span class="string">------</span></span><br><span class="line"><span class="string">The encrypted output in validation set is 0x775cbee546e7579f0a69645b59f72f5c8ff0c538dd9a6e755969dee2ffb8748073c089557801dfb8bfae15baba9a909f3addac142ad928ac7cc453c72166dda235128de12965df4308997416e054ab1ab9af55c60533c7374096aa2d05339900b3e14f7148930bf083eb1eb9fa22b9a997f85b39501d3a9bdfa08e3389b8f2fe</span></span><br><span class="line"><span class="string">After validation, the model is more and more stable.</span></span><br><span class="line"><span class="string">To test the real flag!</span></span><br><span class="line"><span class="string">------</span></span><br><span class="line"><span class="string">The final output is</span></span><br><span class="line"><span class="string">0x29289e3d9275147b885b5061637564cbee3e4d9f48e52694e594f020e49da9b24d9246b2437fb2221fa86ca1a277f3fdd7ab5cad4738a02b66d47703ef816844a84c6c209c8251e8961c9ba2c791649e022627f86932d9700c3b1dc086e8b2747d0a5604955387a935464d3866dd4100b2f3d57603c728761d1d8ef7fdbdcbee</span></span><br><span class="line"><span class="string">0x2b0059f88454e0e36269c809b5d5b6b28e5bab3c87b20f9e55635239331100a0a582241e7a385034698b61ebf24b519e868617ff67974cc907cc61be38755737f9a6dbeb7890ff55550b1af1ecf635112fcaaa8b07a3972b3c6728cbcf2a3973a4d7bd92affec7e065e0ae83cd36858e6d983785a3668a8b82709d78a69796af</span></span><br><span class="line"><span class="string">------</span></span><br></pre></td></tr></table></figure>
<p>这个题确实不知道是什么情况，因为trained_phi、e以及n全部都给了，所以直接解密最后的密文然后拼起来就得到flag。</p>
<p>开始觉得估计是题目失误多给了数据，但是想了下怎么也说不太通。比如要说是多给了n，所以需要联立方程求n的话，由于题目剩下几个文件里，rec.py中是整除，所以基本等于把q给你，而后面的train中无论如何phi也不会变(毕竟随便乱变的话解密也不正确了)，只是会修改e的值而已，所以可以直接根据phi和q得到n。而要是多给了phi的话，由于有q也可以直接解出phi。而e又不可能不给，所以很奇怪。</p>
<p>也许就是出题人好心送一波分数也说不定？</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">0x81c5f040bfaea676120cd62c36ba7afb303561504bbf8609afa3da60fb6202ca875b0bd2a06143ebcd16fa615557ff159d97909160d68e1938b3ecaf57709b3d2698476b6dd203811b6a2ec6a6e2a7e213ab719bcd3ab49bb864b10e9c78ea3f501c0e2213dfe431043bb6f0cc2e8d77bfb43869b843af1a99ae81b87811e101</span></span><br><span class="line">r = <span class="number">0x4f37fe985d13ffde9867fa0063f68dea79196408b1404eadf03ea59297d629c2183a4a6a6647b6c4c99dd43bae8c4fa4691a608d20170fd42b18aef7efb3ae01cd3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get p,q</span></span><br><span class="line">q = GCD(n,r)</span><br><span class="line">p = n //q</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 好像根本不需要上一个步骤。。</span></span><br><span class="line">trained_phi = <span class="number">0x81c5f040bfaea676120cd62c36ba7afb303561504bbf8609afa3da60fb6202ca875b0bd2a06143ebcd16fa615557ff159d97909160d68e1938b3ecaf57709b3bb712fdcba325655f111918472d4353a66854ccda50b63a1047278c15a4b39cde898d054db87092958c7c05f8fa566dcd969b1ff4b7d1935c375a4af3bfc341b0</span></span><br><span class="line">trained_e = <span class="number">0x2c22193ad9abcca2f67552fc76dd07b3ef883f3d755c95119cdf82bb6a07c970fd37e582bb49250d8efaa29b8a59c82059165c654206a9d7261f6b45a90dc69</span></span><br><span class="line">c1 = <span class="number">0x29289e3d9275147b885b5061637564cbee3e4d9f48e52694e594f020e49da9b24d9246b2437fb2221fa86ca1a277f3fdd7ab5cad4738a02b66d47703ef816844a84c6c209c8251e8961c9ba2c791649e022627f86932d9700c3b1dc086e8b2747d0a5604955387a935464d3866dd4100b2f3d57603c728761d1d8ef7fdbdcbee</span></span><br><span class="line">c2 = <span class="number">0x2b0059f88454e0e36269c809b5d5b6b28e5bab3c87b20f9e55635239331100a0a582241e7a385034698b61ebf24b519e868617ff67974cc907cc61be38755737f9a6dbeb7890ff55550b1af1ecf635112fcaaa8b07a3972b3c6728cbcf2a3973a4d7bd92affec7e065e0ae83cd36858e6d983785a3668a8b82709d78a69796af</span></span><br><span class="line"></span><br><span class="line">d = inverse(trained_e, trained_phi)</span><br><span class="line">m1 = <span class="built_in">pow</span>(c1,d,n)</span><br><span class="line">m2 = <span class="built_in">pow</span>(c2,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m1))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m2))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;With the method of machine learning, it is available for Crypto-er to develop the modern cryptography.Don&#x27;t give up learning crypto.&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/35967439.html" title="2023-春秋杯网络安全联赛冬季赛-wp-crypto">https://tangcuxiaojikuai.xyz/post/35967439.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/3f46adc9.html" rel="prev" title="2023-ASISCTF-finals-wp-crypto">
      <i class="fa fa-chevron-left"></i> 2023-ASISCTF-finals-wp-crypto
    </a></div>
      <div class="post-nav-item">
    <a href="/post/ef78e9c1.html" rel="next" title="2022-西湖论剑-wp-crypto">
      2022-西湖论剑-wp-crypto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#not-wiener"><span class="nav-number">1.</span> <span class="nav-text">not_wiener</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ez-ECC"><span class="nav-number">2.</span> <span class="nav-text">ez_ECC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Dual-EC"><span class="nav-number">2.1.</span> <span class="nav-text">Dual EC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3"><span class="nav-number">2.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CF-is-Crypto-Faker"><span class="nav-number">3.</span> <span class="nav-text">CF is Crypto Faker</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">89</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
