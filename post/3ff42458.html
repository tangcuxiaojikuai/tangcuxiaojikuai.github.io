<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="写了一天的enigma还是没搞定，唉，古典！码力真的还是有点烂。 Matrix3是rec做的，不写在这篇，之后哪天有空把d3的两道matrix补上然后一起写一篇好了。">
<meta property="og:type" content="article">
<meta property="og:title" content="2024-WMCTF-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/3ff42458.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="写了一天的enigma还是没搞定，唉，古典！码力真的还是有点烂。 Matrix3是rec做的，不写在这篇，之后哪天有空把d3的两道matrix补上然后一起写一篇好了。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/3ff42458/image-20240909161527611.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/3ff42458/image-20240909182132058.png">
<meta property="article:published_time" content="2024-09-08T01:10:47.000Z">
<meta property="article:modified_time" content="2024-09-11T01:43:28.235Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tangcuxiaojikuai.xyz/post/3ff42458/image-20240909161527611.png">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/3ff42458.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2024-WMCTF-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/3ff42458.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2024-WMCTF-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-08 09:10:47" itemprop="dateCreated datePublished" datetime="2024-09-08T09:10:47+08:00">2024-09-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-11 09:43:28" itemprop="dateModified" datetime="2024-09-11T09:43:28+08:00">2024-09-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/3ff42458.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/3ff42458.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>写了一天的enigma还是没搞定，唉，古典！码力真的还是有点烂。</p>
<p>Matrix3是rec做的，不写在这篇，之后哪天有空把d3的两道matrix补上然后一起写一篇好了。</p>
<span id="more"></span>
<h3 id="K-Cessation"><a href="#K-Cessation" class="headerlink" title="K-Cessation"></a>K-Cessation</h3><p>题目描述：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">K-Cessation</span><br><span class="line">ChllengeInfo</span><br><span class="line">misc/crypto 进入无界之界</span><br><span class="line"><span class="comment">## 背景：</span></span><br><span class="line">K-Cessation 密码是一种使用 K 位轮从明文位中挑选下一个密文位的古典密码。</span><br><span class="line">当加密开始时，从轮子的最后一位开始。</span><br><span class="line">当轮子到达终点时，它会从头开始循环。</span><br><span class="line">对于每个明文位，轮子会旋转到轮子中与明文位匹配的下一个位，并将旋转的距离附加到密文中。</span><br><span class="line"></span><br><span class="line">因此，如果不知道轮子，就不可能解密密文。</span><br><span class="line">是这样吗？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 例子：</span></span><br><span class="line">要使用轮子 <span class="number">1100011011100011100110100011110110010110010100001011111011111010</span> 将“youtu.be/dQw4w9WgXcQ”编码为 <span class="number">64</span>-Cessation：</span><br><span class="line"><span class="number">1.</span> 将明文转换为比特： 01111001 01101111 01110101 01110100 01110101 <span class="number">00</span>101110 01100010 01100101 <span class="number">00</span>101111 01100100 <span class="number">0</span>1010001 01110111 0011 <span class="number">0</span>100 01110111 00111001 <span class="number">0</span>1010111 01100111 <span class="number">0</span>1011000 01100011 <span class="number">0</span>1010001</span><br><span class="line"><span class="number">2.</span>从wheel[-<span class="number">1</span>]到轮子中的下一个“<span class="number">0</span>”位，距离为<span class="number">3</span>，当前轮位置为wheel[<span class="number">2</span>]</span><br><span class="line"><span class="number">3.</span>从wheel[<span class="number">2</span>]到轮子中的下一个“<span class="number">1</span>”位，距离为<span class="number">3</span>，当前轮子位置为wheel[<span class="number">5</span>]</span><br><span class="line"><span class="number">4.</span> 重复步骤直到所有位都被编码</span><br><span class="line"><span class="number">5.</span>结果为<span class="number">3312121232111411211311221152515233123332223411313221112161142123243321244111111311111112111131113211132412111212112112321122115251142114213312132313311222111112</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 挑战：</span></span><br><span class="line">一个野生Flag使用 <span class="number">64</span>-Cessation 密码进行编码。</span><br><span class="line">轮子内容是未知的，它是 <span class="number">64</span> 位长。</span><br><span class="line">密文在 ciphertext.txt 中给出。</span><br><span class="line">该Flag已知是长度超过 <span class="number">64</span> 个字符的 ASCII 字符串。</span><br><span class="line">除此之外，该Flag的任何部分都是未知的，这意味着该Flag不是 WMCTF&#123;&#125; 或 FLAG&#123;&#125; 格式。</span><br><span class="line">提交时，请将Flag改为WMCTF&#123;&#125;格式。</span><br><span class="line">请注意，每个ASCII字节的最高有效位被随机翻转。</span><br><span class="line">您需要从密文中提取Flag并提交。</span><br><span class="line">为了您的方便，flag_hash.txt 中给出了该Flag的盐焗 SHA-<span class="number">256</span> 哈希值。</span><br><span class="line"></span><br><span class="line">ChllengeInfo-EN</span><br><span class="line">misc/crypto Enter the realm of no realm</span><br><span class="line"><span class="comment">## Background:</span></span><br><span class="line">K-Cessation cipher <span class="keyword">is</span> a cipher that uses a K bit wheel to pick the <span class="built_in">next</span> cipher bit <span class="keyword">from</span> plaintext bit.</span><br><span class="line">When encryption starts, the wheel starts at the last bit of the wheel.</span><br><span class="line">The wheel loops around when it reaches the end.</span><br><span class="line">For every plaintext bit, the wheel <span class="keyword">is</span> rotated to the <span class="built_in">next</span> bit <span class="keyword">in</span> the wheel that matches the plaintext bit, <span class="keyword">and</span> the distance rotated <span class="keyword">is</span> appended to the ciphertext.</span><br><span class="line"></span><br><span class="line">Therefore, <span class="keyword">if</span> the wheel <span class="keyword">is</span> <span class="keyword">not</span> known, it <span class="keyword">is</span> <span class="keyword">not</span> possible to decrypt the ciphertext.</span><br><span class="line">Or <span class="keyword">is</span> it?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Example:</span></span><br><span class="line">To encode <span class="string">&quot;youtu.be/dQw4w9WgXcQ&quot;</span> <span class="keyword">in</span> <span class="number">64</span>-Cessation <span class="keyword">with</span> the wheel <span class="number">1100011011100011100110100011110110010110010100001011111011111010</span>:</span><br><span class="line"><span class="number">1.</span> convert the plaintext to bits: 01111001 01101111 01110101 01110100 01110101 <span class="number">00</span>101110 01100010 01100101 <span class="number">00</span>101111 01100100 <span class="number">0</span>1010001 01110111 00110100 01110111 00111001 <span class="number">0</span>1010111 01100111 <span class="number">0</span>1011000 01100011 <span class="number">0</span>1010001</span><br><span class="line"><span class="number">2.</span> <span class="keyword">from</span> wheel[-<span class="number">1</span>] to the <span class="built_in">next</span> <span class="string">&quot;0&quot;</span> bit <span class="keyword">in</span> the wheel, distance <span class="keyword">is</span> <span class="number">3</span>, the current wheel position <span class="keyword">is</span> wheel[<span class="number">2</span>]</span><br><span class="line"><span class="number">3.</span> <span class="keyword">from</span> wheel[<span class="number">2</span>] to the <span class="built_in">next</span> <span class="string">&quot;1&quot;</span> bit <span class="keyword">in</span> the wheel, distance <span class="keyword">is</span> <span class="number">3</span>, the current wheel position <span class="keyword">is</span> wheel[<span class="number">5</span>]</span><br><span class="line"><span class="number">4.</span> repeat the steps until <span class="built_in">all</span> bits <span class="keyword">is</span> encoded</span><br><span class="line"><span class="number">5.</span> the result <span class="keyword">is</span> <span class="number">3312121232111411211311221152515233123332223411313221112161142123243321244111111311111112111131113211132412111212112112321122115251142114213312132313311222111112</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Challenge:</span></span><br><span class="line">A flag <span class="keyword">is</span> encoded <span class="keyword">with</span> <span class="number">64</span>-Cessation cipher.</span><br><span class="line">The wheel <span class="keyword">is</span> <span class="keyword">not</span> known <span class="keyword">except</span> that it <span class="keyword">is</span> <span class="number">64</span> bits long.</span><br><span class="line">The ciphertext <span class="keyword">is</span> given <span class="keyword">in</span> ciphertext.txt.</span><br><span class="line">The flag <span class="keyword">is</span> only known to be an ASCII string that <span class="keyword">is</span> longer than <span class="number">64</span> characters.</span><br><span class="line">No part of the flag <span class="keyword">is</span> known, which means the flag <span class="keyword">is</span> NOT <span class="keyword">in</span> WMCTF&#123;&#125; <span class="keyword">or</span> FLAG&#123;&#125; <span class="built_in">format</span>.</span><br><span class="line">When submitting, please make the flag <span class="keyword">in</span> WMCTF&#123;&#125; <span class="built_in">format</span>.</span><br><span class="line">Note that, The most significant bit of each ASCII byte <span class="keyword">is</span> flipped <span class="keyword">with</span> a random bit.</span><br><span class="line">You need to extract the flag <span class="keyword">from</span> the ciphertext <span class="keyword">and</span> submit it.</span><br><span class="line">For your convenience, a salted sha256 <span class="built_in">hash</span> of the flag <span class="keyword">is</span> given <span class="keyword">in</span> flag_hash.txt.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>,<span class="type">Union</span>,<span class="type">Literal</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">import</span> random,string,re</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">K_Cessation</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    ## Background:</span></span><br><span class="line"><span class="string">    K-Cessation cipher is a cipher that uses a K bit wheel to pick the next cipher bit from plaintext bit.</span></span><br><span class="line"><span class="string">    When encryption starts, the wheel starts at the last bit of the wheel.</span></span><br><span class="line"><span class="string">    The wheel loops around when it reaches the end.</span></span><br><span class="line"><span class="string">    For every plaintext bit, the wheel is rotated to the next bit in the wheel that matches the plaintext bit, and the distance rotated is appended to the ciphertext.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Therefore, if the wheel is not known, it is not possible to decrypt the ciphertext. </span></span><br><span class="line"><span class="string">    Or is it?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ## Example:</span></span><br><span class="line"><span class="string">    To encode &quot;youtu.be/dQw4w9WgXcQ&quot; in 64-Cessation with the wheel 1100011011100011100110100011110110010110010100001011111011111010:</span></span><br><span class="line"><span class="string">    1. convert the plaintext to bits: 01111001 01101111 01110101 01110100 01110101 00101110 01100010 01100101 00101111 01100100 01010001 01110111 00110100 01110111 00111001 01010111 01100111 01011000 01100011 01010001</span></span><br><span class="line"><span class="string">    2. from wheel[-1] to the next &quot;0&quot; bit in the wheel, distance is 3, the current wheel position is wheel[2]</span></span><br><span class="line"><span class="string">    3. from wheel[2] to the next &quot;1&quot; bit in the wheel, distance is 3, the current wheel position is wheel[5]</span></span><br><span class="line"><span class="string">    4. repeat the steps until all bits is encoded</span></span><br><span class="line"><span class="string">    5. the result is 3312121232111411211311221152515233123332223411313221112161142123243321244111111311111112111131113211132412111212112112321122115251142114213312132313311222111112</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ## Challenge:</span></span><br><span class="line"><span class="string">    A flag is encoded with 64-Cessation cipher. </span></span><br><span class="line"><span class="string">    The wheel is not known. </span></span><br><span class="line"><span class="string">    The ciphertext is given in ciphertext.txt.</span></span><br><span class="line"><span class="string">    The flag is only known to be an ascii string that is longer than 64 characters. </span></span><br><span class="line"><span class="string">    No part of the flag is known, which means the flag is NOT in WMCTF&#123;&#125; or FLAG&#123;&#125; format.</span></span><br><span class="line"><span class="string">    When submitting, please make the flag in WMCTF&#123;&#125; format.</span></span><br><span class="line"><span class="string">    The most significant bit of each byte is flipped with a random bit.</span></span><br><span class="line"><span class="string">    You need to extract the flag from the ciphertext and submit it.</span></span><br><span class="line"><span class="string">    For your convenience, a salted sha256 hash of the flag is given in flag_hash.txt.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__is_valid_wheel</span>(<span class="params">self</span>):</span><br><span class="line">        hasZero = <span class="literal">False</span></span><br><span class="line">        hasOne = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.wheel:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(i,<span class="built_in">int</span>):</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&quot;Wheel must be a list of int&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                hasZero = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">elif</span> i == <span class="number">1</span>:</span><br><span class="line">                hasOne = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">if</span> i &gt; <span class="number">1</span> <span class="keyword">or</span> i &lt; <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&quot;Wheel must be a list of 0s and 1s&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasZero <span class="keyword">or</span> <span class="keyword">not</span> hasOne:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Wheel must contain at least one 0 and one 1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,wheel:<span class="type">List</span>[<span class="built_in">int</span>]</span>):</span><br><span class="line">        self.wheel = wheel</span><br><span class="line">        self.__is_valid_wheel()</span><br><span class="line">        self.state = -<span class="number">1</span></span><br><span class="line">        self.finalized = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__find_next_in_wheel</span>(<span class="params">self,target:<span class="type">Literal</span>[<span class="number">1</span>,<span class="number">0</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        result = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            ptr = self.state + result</span><br><span class="line">            ptr = ptr % <span class="built_in">len</span>(self.wheel)</span><br><span class="line">            v = self.wheel[ptr]</span><br><span class="line">            <span class="keyword">if</span> v == target:</span><br><span class="line">                self.state = ptr</span><br><span class="line">                <span class="keyword">return</span> [result]</span><br><span class="line">            result+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter_bits</span>(<span class="params">self,data:<span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">yield</span> (b &gt;&gt; i) &amp; <span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__check_finalized</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.finalized:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;This instance has already been finalized&quot;</span>)</span><br><span class="line">        self.finalized = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self,data:<span class="type">Union</span>[<span class="built_in">str</span>,<span class="built_in">bytes</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        self.__check_finalized()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(data,<span class="built_in">str</span>):</span><br><span class="line">            data = data.encode()</span><br><span class="line">        out = []</span><br><span class="line">        <span class="keyword">for</span> bit <span class="keyword">in</span> self.__iter_bits(data):</span><br><span class="line">            rs = self.__find_next_in_wheel(bit)</span><br><span class="line">            <span class="comment"># print(f&quot;bit=&#123;bit&#125;,rs=&#123;rs&#125;,state=&#123;self.state&#125;&quot;)</span></span><br><span class="line">            out.extend(rs)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self,data:<span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        self.__check_finalized()</span><br><span class="line">        out = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">assert</span> <span class="built_in">type</span>(i) == <span class="built_in">int</span></span><br><span class="line">            self.state = self.state + i</span><br><span class="line">            self.state %= <span class="built_in">len</span>(self.wheel)</span><br><span class="line">            out.append(self.wheel[self.state])</span><br><span class="line">        long = <span class="string">&quot;&quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>,out))</span><br><span class="line">        <span class="keyword">return</span> long_to_bytes(<span class="built_in">int</span>(long,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate a random wheel with k bits.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">random_wheel</span>(<span class="params">k=<span class="number">64</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> [secrets.randbelow(<span class="number">2</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(k)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># the most significant bit of each byte is flipped with a random bit.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode_ascii_with_random_msb</span>(<span class="params">data:<span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    out = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">assert</span> b &lt; <span class="number">128</span>, <span class="string">&quot;not ascii&quot;</span></span><br><span class="line">        b = b ^ (<span class="number">0b10000000</span> * secrets.randbelow(<span class="number">2</span>))</span><br><span class="line">        out.append(b)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(out)</span><br><span class="line"></span><br><span class="line"><span class="comment"># for your convenience, here is the decoding function.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_ascii_with_random_msb</span>(<span class="params">data:<span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    out = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> data:</span><br><span class="line">        b = b &amp; <span class="number">0b01111111</span></span><br><span class="line">        out.append(b)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(out)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line">        <span class="keyword">from</span> flag <span class="keyword">import</span> wheel</span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;flag.py not found, using test flag&quot;</span>)</span><br><span class="line">        flag = <span class="string">&quot;THIS_IS_TEST_FLAG_WHEN_YOU_HEAR_THE_BUZZER_LOOK_AT_THE_FLAG_BEEEP&quot;</span></span><br><span class="line">        wheel = random_wheel(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># wheel is wheel and 64 bits</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">type</span>(wheel) == <span class="built_in">list</span> <span class="keyword">and</span> <span class="built_in">len</span>(wheel) == <span class="number">64</span> <span class="keyword">and</span> <span class="built_in">all</span>((i <span class="keyword">in</span> [<span class="number">0</span>,<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> wheel))</span><br><span class="line">    <span class="comment"># flag is flag and string</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">type</span>(flag) == <span class="built_in">str</span></span><br><span class="line">    <span class="comment"># flag is ascii</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">all</span>((<span class="built_in">ord</span>(c) &lt; <span class="number">128</span> <span class="keyword">for</span> c <span class="keyword">in</span> flag))</span><br><span class="line">    <span class="comment"># flag is long</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(flag) &gt; <span class="number">64</span></span><br><span class="line">    <span class="comment"># flag does not start with wmctf&#123; nor does it end with &#125;</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> flag.lower().startswith(<span class="string">&quot;wmctf&#123;&quot;</span>) <span class="keyword">and</span> <span class="keyword">not</span> flag.endswith(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line">    <span class="comment"># flag also does not start with flag&#123;</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> flag.lower().startswith(<span class="string">&quot;flag&#123;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># the most significant bit of each byte is flipped with a random bit.</span></span><br><span class="line">    plaintext = encode_ascii_with_random_msb(flag.encode())</span><br><span class="line"></span><br><span class="line">    c = K_Cessation(wheel)</span><br><span class="line">    ct = c.encrypt(plaintext)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;ciphertext.txt&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(ct))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> hashlib</span><br><span class="line">    <span class="comment"># for you can verify the correctness of your decryption.</span></span><br><span class="line">    <span class="comment"># or you can brute force the flag hash, it is just a &gt;64 length string :)</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag_hash.txt&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        salt = secrets.token_bytes(<span class="number">16</span>).<span class="built_in">hex</span>()</span><br><span class="line">        h = hashlib.sha256((salt + flag).encode()).hexdigest()</span><br><span class="line">        f.write(h + <span class="string">&quot;:&quot;</span> + salt)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># demostration that decryption works</span></span><br><span class="line">    c = K_Cessation(wheel)</span><br><span class="line">    pt = c.decrypt(ct)</span><br><span class="line">    pt = decode_ascii_with_random_msb(pt)</span><br><span class="line">    <span class="built_in">print</span>(pt)</span><br><span class="line">    <span class="keyword">assert</span> flag.encode() <span class="keyword">in</span> pt</span><br></pre></td></tr></table></figure>
<p>ciphertext.txt：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>flaghash.txt：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d650078ae91d82ebd1d586110960a789c1a15e2cbc053b9daf8d8a4905950720:b840089ce93581869e9c02a7b5aefa7b</span><br></pre></td></tr></table></figure>
<p>题目基于一个特殊的加密方式：</p>
<ul>
<li>初始化一个随机的长度为64的比特串wheel，并置初始指针为-1</li>
<li>把flag转为二进制串，并将他的MSB做随机处理</li>
<li>按flag比特进行加密。比如第一比特是0，那么指针向右循环移动至wheel下一个0的位置，并记录本次移动距离；第二比特为1，那么指针向右循环移动至wheel下一个1的位置，并记录本次移动距离。如此重复直到加密完所有比特</li>
<li>给出所有移动距离，要求还原明文</li>
</ul>
<p>可以看出，如果能恢复完整的wheel，就可以直接用作为密文的距离恢复flag的各个bit。而如果MSB没有处理的话，我们就拥有了wheel中64个一定为0的位置(这些位置会产生重复)，那么就对我们恢复wheel有很大帮助了。</p>
<p>然而问题就在于MSB有随机处理过，所以对于flag串我们可以说几乎是一无所知，因此要想别的办法。</p>
<p>而注意到以下几个事实：</p>
<ul>
<li>如果当前记录的距离为1，则本次移动涉及两个连续比特，没法得知这两个比特任意一个的信息</li>
<li>如果当前记录的距离为2，则本次移动涉及3个连续比特，可以知道的事实是：第二比特和第三比特一定不同</li>
<li>如果当前记录的距离为n，则本次移动涉及(n+1)个连续比特，可以知道的事实是：第2-n个比特一定相同，且一定和第n+1个比特不同</li>
</ul>
<p>而我们有足够多的密文，因此我们可以通过这样的关系，确定很多一定相同或一定不同的比特，也就是把所有比特分为两类。这个时候假设其中某一类比特是0，另一部分就是1，就得到了可能的wheel，然后结合flaghash对所有可能的wheel进行爆破就可以了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">c = [<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">flag_hash = <span class="string">&quot;d650078ae91d82ebd1d586110960a789c1a15e2cbc053b9daf8d8a4905950720&quot;</span></span><br><span class="line">salt = <span class="string">b&quot;b840089ce93581869e9c02a7b5aefa7b&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################################### part1 find same and diff</span></span><br><span class="line">same_set = []</span><br><span class="line">diff_set = []</span><br><span class="line">idx = -<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">    <span class="keyword">if</span>(c[i] == <span class="number">2</span>):</span><br><span class="line">        diff_set.append(<span class="built_in">str</span>([(idx + c[i] - <span class="number">1</span>) % <span class="number">64</span>, (idx + c[i]) % <span class="number">64</span>]))</span><br><span class="line">    <span class="keyword">elif</span>(c[i] &gt; <span class="number">2</span>):</span><br><span class="line">        temp = []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,c[i]):</span><br><span class="line">            temp.append((idx+j)%<span class="number">64</span>)</span><br><span class="line">        same_set.append(<span class="built_in">str</span>(temp))</span><br><span class="line">        diff_set.append(<span class="built_in">str</span>([(idx + c[i] - <span class="number">1</span>) % <span class="number">64</span>, (idx + c[i]) % <span class="number">64</span>]))</span><br><span class="line">    idx = (idx + c[i]) % <span class="number">64</span></span><br><span class="line"></span><br><span class="line">same_set = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">eval</span>,<span class="built_in">set</span>(same_set))))</span><br><span class="line">diff_set = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">eval</span>,<span class="built_in">set</span>(diff_set))))</span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################################### part2 find wheel(by hand)</span></span><br><span class="line">WHEEL = [<span class="string">&quot;*&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> brute <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    wheel = WHEEL</span><br><span class="line">    temp = <span class="built_in">bin</span>(brute)[<span class="number">2</span>:].zfill(<span class="number">3</span>)</span><br><span class="line">    wheel[<span class="number">0</span>] = <span class="built_in">int</span>(temp[<span class="number">0</span>])</span><br><span class="line">    wheel[<span class="number">42</span>] = <span class="built_in">int</span>(temp[<span class="number">1</span>])</span><br><span class="line">    wheel[<span class="number">49</span>] = <span class="built_in">int</span>(temp[<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        <span class="keyword">if</span>([i,i+<span class="number">1</span>] <span class="keyword">in</span> diff_set <span class="keyword">and</span> wheel[i] != <span class="string">&quot;*&quot;</span>):</span><br><span class="line">            wheel[i+<span class="number">1</span>] = <span class="number">1</span> - wheel[i]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            <span class="keyword">if</span>([i+t <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(j)] <span class="keyword">in</span> same_set <span class="keyword">and</span> wheel[i] != <span class="string">&quot;*&quot;</span>):</span><br><span class="line">                <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(j):</span><br><span class="line">                    wheel[i+t] = wheel[i]</span><br><span class="line">    </span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    idx = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        idx = (idx+c[i]) % <span class="number">64</span></span><br><span class="line">        <span class="keyword">if</span>(i % <span class="number">8</span> == <span class="number">0</span>):</span><br><span class="line">            flag += <span class="string">&quot;0&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag += <span class="built_in">str</span>(wheel[idx])</span><br><span class="line">    FLAG = long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    h = hashlib.sha256(salt + FLAG).hexdigest()</span><br><span class="line">    <span class="keyword">if</span>(h == flag_hash):</span><br><span class="line">        <span class="built_in">print</span>(FLAG)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#DoubleUmCtF[S33K1NG_tru7h-7h3_w1s3-f1nd_1n57e4d-17s_pr0f0und-4b5ence_n0w-g0_s0lv3-th3_3y3s-1n_N0ita]</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="FACRT"><a href="#FACRT" class="headerlink" title="FACRT"></a>FACRT</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR ERROR ERROR, please replace flag&#123;*&#125; to WMCTF&#123;*&#125;</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">Count=<span class="number">20</span></span><br><span class="line">p=getPrime(<span class="number">512</span>)</span><br><span class="line">q=getPrime(<span class="number">512</span>)</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">n=p*q</span><br><span class="line">d=gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">dp=d%(p-<span class="number">1</span>)</span><br><span class="line">dq=d%(q-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n=<span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line">flag=bytes_to_long(flag)</span><br><span class="line">length=flag.bit_length()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;length=<span class="subst">&#123;length&#125;</span>&quot;</span>)</span><br><span class="line">m=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Count):</span><br><span class="line">    m.append(getPrime(length))</span><br><span class="line">sq=[]</span><br><span class="line">sq_=[]</span><br><span class="line">sp=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Count):</span><br><span class="line">    sq.append(<span class="built_in">pow</span>(m[i],dq,q))</span><br><span class="line">    sq_.append(<span class="built_in">int</span>(<span class="string">&#x27;0&#x27;</span>*<span class="number">32</span>+<span class="built_in">bin</span>(<span class="built_in">pow</span>(m[i],dq,q))[<span class="number">2</span>:][<span class="number">32</span>:],<span class="number">2</span>))</span><br><span class="line">    sp.append(<span class="built_in">pow</span>(m[i], dp, p))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Count):</span><br><span class="line">    <span class="keyword">assert</span> sq_[i] &lt; q / <span class="number">32</span></span><br><span class="line">iq=inverse(q,p)</span><br><span class="line">s=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Count):</span><br><span class="line">    s.append(<span class="built_in">int</span>(sq_[i]+q*(((sp[i]-sq[i])*iq)%p)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;s=<span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c=<span class="subst">&#123;<span class="built_in">pow</span>(flag,e,n)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n=147633197136297320644148532167800594954463904917041365729781214689541810163409922050566363432759473356227399211204573839844534932354354132513677032099679754947582227369942835464578888307376910610182166537589845612944804885745392209830996561055058293663757559573736079810999615542354866920007861214183738025983</span></span><br><span class="line"><span class="string">length=455</span></span><br><span class="line"><span class="string">s=[135516280150137458535561766358086896198348823398876741567317041366935426854394060237235814065881756890818477438426875999503748746848408802883160976139168309216479723387043154316328752466115337006276833313025698482591954333004698732007362032602920842020200559463427548622804767419825141012760232500564198606888, 87138950331850035073233755923193357352015776817591237970872234630746818824503152055070348052111940612563932340910671611099400897135890145261451245577578879099083666861166614841834235097485990689182812564858373409987914436273165881047892580175317423057893816031028632720419872660582122916390309733324086153485, 138644295462947977586933469377687701489914340911921767410183452121042506019270712424245627451242649429408423057598802920666169608453899414528460692023716837136269325732757807484480055069814533664161537001762727348850128480964361110794017997076616622537153343830644577017008185863066319652708947485342513469942, 130919765117872700420555258668777170220585743300145967201676029268553369762501611700891574139388115937578229121079450407536963982339229719500478504489500235690293048515731859346431065030206394207045994366861194654126521065191859763903957682731311119322278004810859526215299984270862147897660764896871931296525, 114700370393183453087762195804219894122789831440066263230660331964018561704119945094712846882622289910478787117536755419287483635582978440493028286129198190921201156025431173751752743507530849046089710840106416071119787801330709608148349917138686962228418379795866832374558526179470426187199100866047189895398, 5526726757049511570122924251009639296817346269475117861098612689025237993752241296662636520025051472762072465223105287132204748691454643208692589407448303681720594661639751550346640974853714675951318971703834962983574657923366839131735681149307918005820142824780727533061358686675519367812942183782965460156, 144912005915009185433389709621768898379612902758176190094171990137016617813547436225820194585543950753591409962313416349983080186189291716456666174265994068233652987757656436662736504159419091874803636330149391525094620604417895137599924048423029008070688563937967247938795175561463188529887593887274447829757, 136250954616195732816473240575012270303125387854617764474032021538389021573726037002975200362404464882071072085887627232185387656472286476406393582907753248439212389626213347657516288312775908225085848334636924022113242155272938168661245231559256589332709251562390352253724058379737367174585436687621017694623, 62581851774850409035755528242738381905999051352008432547471965980273593728343556710086776830920012955472867109461528976241913935857428013748626805913556479910568244555311572298067590116614399220857206962127377751825672045446525674748896825242976163703599291103837976885179955618472741727241520609778322846005, 145854407984474847551927547284413490204495969306617565827750995876170774717809213321826036612782367152524129825636642176629348378245478404356883485091652713207020554564450132585121134356935492165152072283066165961023761302228624528890490009909363984222514631061033009247208437816124596049012309910840440309561, 124551623006909497965848991707513696948607938882176233365140848984406516643540438381538258922460588883294565931391660391812373244670311091543926813390568684148523894758100116918211999135492588543339785067482674405654655248001114133508625872962520401753384795662160688811171758878041475228921004115541651588149, 15938340419155549703292732921378484283671988749432038679365417994992859057494159116052524559743521485794692543381549875094855921795753932087886980295291140542937847588182771711846510176440458231173636452634043298156122152860644504752015830250690063832495966826188439527832958662817314634043438801092078111173, 86793422805279107846504839960808639992922541788273836408000957039906527697664805903722395255793430323591730573513732464380853123117859130756589515125491536316134863620706530836481623063642225089209431819777355554001327119466306759145993282751212553582691384017307673738794439532271560215747589628721710135897, 108675608374666743358023889479027512878400550037574532652565479774965642002565282273742545254311704772402696446846722391711332035309818100961301897022556307435354059324998874351394451945385491984524729822436607930537193897390621277431306545936473390631504396022406944910561421866589605078829721977335264154976, 87317748227288225233288224866786892964848811364878121564104341670954340348393418506174791619641614941888448848731903276361744955803183864888079233767189621441829023235771802783069311610169253651371628757455646066049167648114996530344278325612462268009587440597096690136975144034630898406289420602499264991623, 56652314874573546743584841968373113846850609963672297223607913939552862285375621862172324584570593402935091802803893885963277174956979046479939956703429737288793705461324779449285529662821030340203158503181009684937887687542388010343147675680002397630598445715400876202643169104742361423214638787268742234287, 98735788313453186782519834728824046613708479524564270665693218086798600541964070362862728960696910092702768075145925801913657156092005722008779014906938783990621453314812381950847944890837178907520481282447677162465215252648603374266972153988621533116563623242402366677831684416116807732808111964626488086987, 127540651954215161413641876933455408716614015796900097859173650400979733321781230732298931541274922911072112231027539634566966261240603321076224739659191443221985808678247919491141075440774231707687287562522535460013252508304387645505398442899700006526196099765002065480554613895222880144277349674640005507562, 133301958266564440496259158450519409455902192149222024966338884662576908051145274628854034018802181764563054480089111531034013218222971811942750317186820576575720998626362983321816936975595432624528396429872313110972358282919447478636004224335379606216720361742943716434992065840043748957089654449955193986860, 88160039502967812710045720428993741346375421128152598672398002732708719698481663322248764249302216242451840620334870977104442381110519298390156672581547539043729567682679341598750864890008905914145991583715826910836568061276943119691386206504777140515604809396852491015959654881350560399518061528959314304087]</span></span><br><span class="line"><span class="string">c=123907837039511977819816858353976764990739800475355111239750335121820426041872830656170595604631534502233882297517774737660499087852687022473212169680375890135271089504199640532421067201796868951827680690124297723304485612987566782809086630400500307531954278635605686302923551049889311808990254356288059153559</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>题目基于RSA的CRT，但是由于把$m^{d_q}$那部分的高位进行了处理，所以得到的最终结果并不是$m^d$。</p>
<p>而由CRT的式子有：</p>
<script type="math/tex; mode=display">
s_i = qt_i + (m_i^{d_q})_{lsb}</script><p>写成这个形式可以发现后面那一部分相对较小，所以其实就变成了一个AGCD问题：</p>
<script type="math/tex; mode=display">
s_i = qt_i + r_i</script><p>因此格一格就好。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">Count = <span class="number">20</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">147633197136297320644148532167800594954463904917041365729781214689541810163409922050566363432759473356227399211204573839844534932354354132513677032099679754947582227369942835464578888307376910610182166537589845612944804885745392209830996561055058293663757559573736079810999615542354866920007861214183738025983</span></span><br><span class="line">length = <span class="number">455</span></span><br><span class="line">s = [<span class="number">135516280150137458535561766358086896198348823398876741567317041366935426854394060237235814065881756890818477438426875999503748746848408802883160976139168309216479723387043154316328752466115337006276833313025698482591954333004698732007362032602920842020200559463427548622804767419825141012760232500564198606888</span>, <span class="number">87138950331850035073233755923193357352015776817591237970872234630746818824503152055070348052111940612563932340910671611099400897135890145261451245577578879099083666861166614841834235097485990689182812564858373409987914436273165881047892580175317423057893816031028632720419872660582122916390309733324086153485</span>, <span class="number">138644295462947977586933469377687701489914340911921767410183452121042506019270712424245627451242649429408423057598802920666169608453899414528460692023716837136269325732757807484480055069814533664161537001762727348850128480964361110794017997076616622537153343830644577017008185863066319652708947485342513469942</span>, <span class="number">130919765117872700420555258668777170220585743300145967201676029268553369762501611700891574139388115937578229121079450407536963982339229719500478504489500235690293048515731859346431065030206394207045994366861194654126521065191859763903957682731311119322278004810859526215299984270862147897660764896871931296525</span>, <span class="number">114700370393183453087762195804219894122789831440066263230660331964018561704119945094712846882622289910478787117536755419287483635582978440493028286129198190921201156025431173751752743507530849046089710840106416071119787801330709608148349917138686962228418379795866832374558526179470426187199100866047189895398</span>, <span class="number">5526726757049511570122924251009639296817346269475117861098612689025237993752241296662636520025051472762072465223105287132204748691454643208692589407448303681720594661639751550346640974853714675951318971703834962983574657923366839131735681149307918005820142824780727533061358686675519367812942183782965460156</span>, <span class="number">144912005915009185433389709621768898379612902758176190094171990137016617813547436225820194585543950753591409962313416349983080186189291716456666174265994068233652987757656436662736504159419091874803636330149391525094620604417895137599924048423029008070688563937967247938795175561463188529887593887274447829757</span>, <span class="number">136250954616195732816473240575012270303125387854617764474032021538389021573726037002975200362404464882071072085887627232185387656472286476406393582907753248439212389626213347657516288312775908225085848334636924022113242155272938168661245231559256589332709251562390352253724058379737367174585436687621017694623</span>, <span class="number">62581851774850409035755528242738381905999051352008432547471965980273593728343556710086776830920012955472867109461528976241913935857428013748626805913556479910568244555311572298067590116614399220857206962127377751825672045446525674748896825242976163703599291103837976885179955618472741727241520609778322846005</span>, <span class="number">145854407984474847551927547284413490204495969306617565827750995876170774717809213321826036612782367152524129825636642176629348378245478404356883485091652713207020554564450132585121134356935492165152072283066165961023761302228624528890490009909363984222514631061033009247208437816124596049012309910840440309561</span>, <span class="number">124551623006909497965848991707513696948607938882176233365140848984406516643540438381538258922460588883294565931391660391812373244670311091543926813390568684148523894758100116918211999135492588543339785067482674405654655248001114133508625872962520401753384795662160688811171758878041475228921004115541651588149</span>, <span class="number">15938340419155549703292732921378484283671988749432038679365417994992859057494159116052524559743521485794692543381549875094855921795753932087886980295291140542937847588182771711846510176440458231173636452634043298156122152860644504752015830250690063832495966826188439527832958662817314634043438801092078111173</span>, <span class="number">86793422805279107846504839960808639992922541788273836408000957039906527697664805903722395255793430323591730573513732464380853123117859130756589515125491536316134863620706530836481623063642225089209431819777355554001327119466306759145993282751212553582691384017307673738794439532271560215747589628721710135897</span>, <span class="number">108675608374666743358023889479027512878400550037574532652565479774965642002565282273742545254311704772402696446846722391711332035309818100961301897022556307435354059324998874351394451945385491984524729822436607930537193897390621277431306545936473390631504396022406944910561421866589605078829721977335264154976</span>, <span class="number">87317748227288225233288224866786892964848811364878121564104341670954340348393418506174791619641614941888448848731903276361744955803183864888079233767189621441829023235771802783069311610169253651371628757455646066049167648114996530344278325612462268009587440597096690136975144034630898406289420602499264991623</span>, <span class="number">56652314874573546743584841968373113846850609963672297223607913939552862285375621862172324584570593402935091802803893885963277174956979046479939956703429737288793705461324779449285529662821030340203158503181009684937887687542388010343147675680002397630598445715400876202643169104742361423214638787268742234287</span>, <span class="number">98735788313453186782519834728824046613708479524564270665693218086798600541964070362862728960696910092702768075145925801913657156092005722008779014906938783990621453314812381950847944890837178907520481282447677162465215252648603374266972153988621533116563623242402366677831684416116807732808111964626488086987</span>, <span class="number">127540651954215161413641876933455408716614015796900097859173650400979733321781230732298931541274922911072112231027539634566966261240603321076224739659191443221985808678247919491141075440774231707687287562522535460013252508304387645505398442899700006526196099765002065480554613895222880144277349674640005507562</span>, <span class="number">133301958266564440496259158450519409455902192149222024966338884662576908051145274628854034018802181764563054480089111531034013218222971811942750317186820576575720998626362983321816936975595432624528396429872313110972358282919447478636004224335379606216720361742943716434992065840043748957089654449955193986860</span>, <span class="number">88160039502967812710045720428993741346375421128152598672398002732708719698481663322248764249302216242451840620334870977104442381110519298390156672581547539043729567682679341598750864890008905914145991583715826910836568061276943119691386206504777140515604809396852491015959654881350560399518061528959314304087</span>]</span><br><span class="line">c = <span class="number">123907837039511977819816858353976764990739800475355111239750335121820426041872830656170595604631534502233882297517774737660499087852687022473212169680375890135271089504199640532421067201796868951827680690124297723304485612987566782809086630400500307531954278635605686302923551049889311808990254356288059153559</span></span><br><span class="line"></span><br><span class="line">L = Matrix(ZZ, Count, Count)</span><br><span class="line">L[<span class="number">0</span>,<span class="number">0</span>] = <span class="number">2</span>^length</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, Count):</span><br><span class="line">    L[<span class="number">0</span>,i] = s[i]</span><br><span class="line">    L[i,i] = -s[<span class="number">0</span>]</span><br><span class="line">res = L.LLL()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">q = s[<span class="number">0</span>] // (res[<span class="number">0</span>] // <span class="number">2</span>^length)</span><br><span class="line">p = n // q</span><br><span class="line"><span class="keyword">assert</span> n == p*q</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c, inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)), n))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;Th3_Simultaneous_Diophantine_Approximation_Approach&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">M = matrix(Zmod(n), [</span><br><span class="line">    [m, -m-p-q, -m-<span class="number">2</span>*p, <span class="number">2</span>*q-m],</span><br><span class="line">    [m+p+q,  m, <span class="number">2</span>*q-m,  m+<span class="number">2</span>*p],</span><br><span class="line">    [m+<span class="number">2</span>*p,  m-<span class="number">2</span>*q,  m, -m-p-q],</span><br><span class="line">    [m-<span class="number">2</span>*q, -m-<span class="number">2</span>*p,  m+p+q,  m]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">enc = M**e</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(enc))</span><br><span class="line">n=<span class="number">13228298199631335610499409465400552275305629934024756614227830931136508640681372951453757994834844498763877490566164031828108583453919741685657210448857955666192855872103622943922893572765718705893238315297600050789804418329650168680719372191579207505092037294294875908952803670819999025123209403251314588474192758376162806705064430837428828805477906627599506069017651159117664246131790529354533675662936081996490294431369820750274303028529977278828959613343997326534446148884333619071935180484450320323844737055406889458275298296950269660857078186043669204168045730995355857013530919638304423700701901063780318208789</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">enc=[(<span class="number">1491873293560323909465836471682585391496137454962536255211620436893391549603126009345148985699013899435764986980919290827837440218992944453711597495517127038406936254470963878149611067609857046502282994346483454884781103538081677117421537728730737422899739818406539050745938770868537148564365984825217449546939297237128543198112642950063626687602582556615437626388875069902892432216468378684299365817407995725759407957747215159745600867120912008194130121350313833434901083388223410629737737418961006112893999319596217781130922876695397872007871395908185274519733474161410964601075476672137735633842608230612826681061</span>, <span class="number">4956025543963860548224153175168493318238985854531591968596322951867101383038318092494673400475554880419342014784571362229741642826660412082585292197764604908450405263330703286845800303018092222139976907126517882830745820723998293430203137128739850924103620078289772876248014239067659155995114953314111131752812515097213052728067061893768763077056914111566820414025280534046400995356712414837449121046062079911435309295464490263283769221830037029108374974495201782045992874653920211537537724643230986981824349266978767367402293999209162694369772760075107747609491264902786041130826876918123202134703658442941891830242</span>, <span class="number">7710011511933273600956066580006667228795766247206337007278271463871915295714373557766306241838812677910529618690854981247073325175370147283360553440166198511565970962496527743224575526922830794861623489204146092991883999208502150565496732100104360091815826333424313805145648110936043125983239009895903602879010609096750963186952687545255588633288528372363096307287365891027749166227382683937570696463897150461450791183251190323380329123556440876127657763835466077899344290052877228945633508945118354870143193111572860186690380517929737934424809644493802524411423150714171313957036859668776471063633076408076909640002</span>, <span class="number">11534398990341303260469847611439061098979668999994719829731530111550470410818410249398161750557290507614569764189238005873703309686837109506327355518339608092717603460229057410906842405901627607535605010996612762231101162949308540690378638599362997229992351236008016988744038581908756449465377928987817065146363195497304246692426541055618255515479438494976345916998240594200316617809496338857712977577830501882906692816143225556486899297950715922558009978599642835535619697869607264637171021550028689009097951803276399427016025503188133689654404551377724037837852806988185689913776323215325531565269517783734339408476</span>), (<span class="number">8272272655667475062275256290232058957066644079493164645631507979269407257643054858959084594359289618344535475781592669598366940627259329603071918251093350757742450608772919657077093269747626483753261408171082167959058597605651875250516235062839356580988417216005103032704789431752339869128094449937203456721380243278949753976997368943660065728420992516032685654992370625071263250775078114517084554616874002085054985135905330486990533806699940249720584638848795544488453274230413407534397455841219333342020387788428122090873004297741106966487305425968561456558554466092569815882704042720181221565998242620838426378547</span>, <span class="number">1491873293560323909465836471682585391496137454962536255211620436893391549603126009345148985699013899435764986980919290827837440218992944453711597495517127038406936254470963878149611067609857046502282994346483454884781103538081677117421537728730737422899739818406539050745938770868537148564365984825217449546939297237128543198112642950063626687602582556615437626388875069902892432216468378684299365817407995725759407957747215159745600867120912008194130121350313833434901083388223410629737737418961006112893999319596217781130922876695397872007871395908185274519733474161410964601075476672137735633842608230612826681061</span>, <span class="number">11534398990341303260469847611439061098979668999994719829731530111550470410818410249398161750557290507614569764189238005873703309686837109506327355518339608092717603460229057410906842405901627607535605010996612762231101162949308540690378638599362997229992351236008016988744038581908756449465377928987817065146363195497304246692426541055618255515479438494976345916998240594200316617809496338857712977577830501882906692816143225556486899297950715922558009978599642835535619697869607264637171021550028689009097951803276399427016025503188133689654404551377724037837852806988185689913776323215325531565269517783734339408476</span>, <span class="number">5518286687698062009543342885393885046509863686818419606949559467264593344966999393687451752996031820853347871875309050581035258278549594402296657008691757154626884909607095200698318045842887911031614826093453957797920419121148018115222640091474847413276210960870562103807155559883955899139970393355410985595182149279411843518111743292173240172189378255236409761730285268089915079904407845416962979199038931535039503248118630426893973904973536402701301849508531248635101858831456390126301671539331965453701543943834029271584917779020531726432268541549866679756622580281184543056494059969527952637068824655703408568787</span>), (<span class="number">5518286687698062009543342885393885046509863686818419606949559467264593344966999393687451752996031820853347871875309050581035258278549594402296657008691757154626884909607095200698318045842887911031614826093453957797920419121148018115222640091474847413276210960870562103807155559883955899139970393355410985595182149279411843518111743292173240172189378255236409761730285268089915079904407845416962979199038931535039503248118630426893973904973536402701301849508531248635101858831456390126301671539331965453701543943834029271584917779020531726432268541549866679756622580281184543056494059969527952637068824655703408568787</span>, <span class="number">1693899209290032350029561853961491176325960934030036784496300819586038229862962702055596244277553991149307726376926025954405273767082632179329854930518347573475252411874565533016051166864091098357633304300987288558703255380341627990340733592216210275099686058286858920208765088911242575657831474263497523327829562878858560012637889781810573289998468132623160152019410564917347628322294190496820698085105580113583601615226595193787403730579261356270949634744354490998826451014726354434764158934421631314746785252130490031259272793762135971202673634665945166330192924007170167099754596422978892135432383280045978800313</span>, <span class="number">1491873293560323909465836471682585391496137454962536255211620436893391549603126009345148985699013899435764986980919290827837440218992944453711597495517127038406936254470963878149611067609857046502282994346483454884781103538081677117421537728730737422899739818406539050745938770868537148564365984825217449546939297237128543198112642950063626687602582556615437626388875069902892432216468378684299365817407995725759407957747215159745600867120912008194130121350313833434901083388223410629737737418961006112893999319596217781130922876695397872007871395908185274519733474161410964601075476672137735633842608230612826681061</span>, <span class="number">4956025543963860548224153175168493318238985854531591968596322951867101383038318092494673400475554880419342014784571362229741642826660412082585292197764604908450405263330703286845800303018092222139976907126517882830745820723998293430203137128739850924103620078289772876248014239067659155995114953314111131752812515097213052728067061893768763077056914111566820414025280534046400995356712414837449121046062079911435309295464490263283769221830037029108374974495201782045992874653920211537537724643230986981824349266978767367402293999209162694369772760075107747609491264902786041130826876918123202134703658442941891830242</span>), (<span class="number">1693899209290032350029561853961491176325960934030036784496300819586038229862962702055596244277553991149307726376926025954405273767082632179329854930518347573475252411874565533016051166864091098357633304300987288558703255380341627990340733592216210275099686058286858920208765088911242575657831474263497523327829562878858560012637889781810573289998468132623160152019410564917347628322294190496820698085105580113583601615226595193787403730579261356270949634744354490998826451014726354434764158934421631314746785252130490031259272793762135971202673634665945166330192924007170167099754596422978892135432383280045978800313</span>, <span class="number">7710011511933273600956066580006667228795766247206337007278271463871915295714373557766306241838812677910529618690854981247073325175370147283360553440166198511565970962496527743224575526922830794861623489204146092991883999208502150565496732100104360091815826333424313805145648110936043125983239009895903602879010609096750963186952687545255588633288528372363096307287365891027749166227382683937570696463897150461450791183251190323380329123556440876127657763835466077899344290052877228945633508945118354870143193111572860186690380517929737934424809644493802524411423150714171313957036859668776471063633076408076909640002</span>, <span class="number">8272272655667475062275256290232058957066644079493164645631507979269407257643054858959084594359289618344535475781592669598366940627259329603071918251093350757742450608772919657077093269747626483753261408171082167959058597605651875250516235062839356580988417216005103032704789431752339869128094449937203456721380243278949753976997368943660065728420992516032685654992370625071263250775078114517084554616874002085054985135905330486990533806699940249720584638848795544488453274230413407534397455841219333342020387788428122090873004297741106966487305425968561456558554466092569815882704042720181221565998242620838426378547</span>, <span class="number">1491873293560323909465836471682585391496137454962536255211620436893391549603126009345148985699013899435764986980919290827837440218992944453711597495517127038406936254470963878149611067609857046502282994346483454884781103538081677117421537728730737422899739818406539050745938770868537148564365984825217449546939297237128543198112642950063626687602582556615437626388875069902892432216468378684299365817407995725759407957747215159745600867120912008194130121350313833434901083388223410629737737418961006112893999319596217781130922876695397872007871395908185274519733474161410964601075476672137735633842608230612826681061</span>)]</span><br></pre></td></tr></table></figure>
<p>题目给出了一个奇怪的矩阵M：</p>
<script type="math/tex; mode=display">
M
=
\left(\begin{matrix}
m & -m-p-q & -m-2*p & 2*q-m\\
m+p+q & m & 2*q-m & m+2*p\\
m+2*p &  m-2*q & m & -m-p-q\\
m-2*q & -m-2*p & m+p+q &  m\\
\end{matrix}\right)</script><p>除了RSA的公钥n、e之外再给出$C=M^e$，要求m。</p>
<p>M显然有点特殊，所以先拆成一个反对称阵和单位阵的和形式：</p>
<script type="math/tex; mode=display">
A
=
\left(\begin{matrix}
0 & -m-p-q & -m-2*p & 2*q-m\\
m+p+q & 0 & 2*q-m & m+2*p\\
m+2*p &  m-2*q & 0 & -m-p-q\\
m-2*q & -m-2*p & m+p+q &  0\\
\end{matrix}\right)</script><script type="math/tex; mode=display">
M = A + mE</script><p>所以有：</p>
<script type="math/tex; mode=display">
C = M^e = (A + mE)^e</script><p>这样出来了一个二项式定理的形式，那么把他展开就得到：</p>
<script type="math/tex; mode=display">
C = A^e + emA^{e-1} + (\frac{e}{2})m^2A^{e-2} + ... + em^{e-1}A + m^eE</script><p>自己测试一下会发现A的偶次幂是个对角矩阵，因此最终C的非对角线元素都是上述二项式展开中A的奇数次幂贡献的。用小一点的e去factor一下非对角线元素的因子会发现这些和式均有共同因子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PR.&lt;m,p,q&gt; = PolynomialRing(ZZ)</span><br><span class="line">M = matrix([</span><br><span class="line">    [m, -m-p-q, -m-<span class="number">2</span>*p, <span class="number">2</span>*q-m],</span><br><span class="line">    [m+p+q,  m, <span class="number">2</span>*q-m,  m+<span class="number">2</span>*p],</span><br><span class="line">    [m+<span class="number">2</span>*p,  m-<span class="number">2</span>*q,  m, -m-p-q],</span><br><span class="line">    [m-<span class="number">2</span>*q, -m-<span class="number">2</span>*p,  m+p+q,  m]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">A = matrix([</span><br><span class="line">    [<span class="number">0</span>, -m-p-q, -m-<span class="number">2</span>*p, <span class="number">2</span>*q-m],</span><br><span class="line">    [m+p+q,  <span class="number">0</span>, <span class="number">2</span>*q-m,  m+<span class="number">2</span>*p],</span><br><span class="line">    [m+<span class="number">2</span>*p,  m-<span class="number">2</span>*q,  <span class="number">0</span>, -m-p-q],</span><br><span class="line">    [m-<span class="number">2</span>*q, -m-<span class="number">2</span>*p,  m+p+q,  <span class="number">0</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">E = Matrix(ZZ, identity_matrix(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(factor((A^<span class="number">1</span>)[<span class="number">1</span>,<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(factor((A^<span class="number">3</span>)[<span class="number">1</span>,<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(factor((A^<span class="number">5</span>)[<span class="number">1</span>,<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(factor((A^<span class="number">7</span>)[<span class="number">1</span>,<span class="number">0</span>]))</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m + p + q</span><br><span class="line">(-<span class="number">1</span>) * (m + p + q) * (<span class="number">3</span>*m^<span class="number">2</span> + <span class="number">6</span>*m*p + <span class="number">5</span>*p^<span class="number">2</span> - <span class="number">2</span>*m*q + <span class="number">2</span>*p*q + <span class="number">5</span>*q^<span class="number">2</span>)</span><br><span class="line">(m + p + q) * (<span class="number">3</span>*m^<span class="number">2</span> + <span class="number">6</span>*m*p + <span class="number">5</span>*p^<span class="number">2</span> - <span class="number">2</span>*m*q + <span class="number">2</span>*p*q + <span class="number">5</span>*q^<span class="number">2</span>)^<span class="number">2</span></span><br><span class="line">(-<span class="number">1</span>) * (m + p + q) * (<span class="number">3</span>*m^<span class="number">2</span> + <span class="number">6</span>*m*p + <span class="number">5</span>*p^<span class="number">2</span> - <span class="number">2</span>*m*q + <span class="number">2</span>*p*q + <span class="number">5</span>*q^<span class="number">2</span>)^<span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>所以可以提取出几组C中的代数关系：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(m + <span class="number">2</span>*p)*enc[<span class="number">1</span>,<span class="number">0</span>] == (m + p + q)*enc[<span class="number">2</span>,<span class="number">0</span>]</span><br><span class="line">(m - <span class="number">2</span>*q)*enc[<span class="number">1</span>,<span class="number">0</span>] == (m + p + q)*enc[<span class="number">3</span>,<span class="number">0</span>]</span><br><span class="line">p*q == n</span><br></pre></td></tr></table></figure>
<p>然后groebner就可以解掉。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">13228298199631335610499409465400552275305629934024756614227830931136508640681372951453757994834844498763877490566164031828108583453919741685657210448857955666192855872103622943922893572765718705893238315297600050789804418329650168680719372191579207505092037294294875908952803670819999025123209403251314588474192758376162806705064430837428828805477906627599506069017651159117664246131790529354533675662936081996490294431369820750274303028529977278828959613343997326534446148884333619071935180484450320323844737055406889458275298296950269660857078186043669204168045730995355857013530919638304423700701901063780318208789</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">enc = [(<span class="number">1491873293560323909465836471682585391496137454962536255211620436893391549603126009345148985699013899435764986980919290827837440218992944453711597495517127038406936254470963878149611067609857046502282994346483454884781103538081677117421537728730737422899739818406539050745938770868537148564365984825217449546939297237128543198112642950063626687602582556615437626388875069902892432216468378684299365817407995725759407957747215159745600867120912008194130121350313833434901083388223410629737737418961006112893999319596217781130922876695397872007871395908185274519733474161410964601075476672137735633842608230612826681061</span>, <span class="number">4956025543963860548224153175168493318238985854531591968596322951867101383038318092494673400475554880419342014784571362229741642826660412082585292197764604908450405263330703286845800303018092222139976907126517882830745820723998293430203137128739850924103620078289772876248014239067659155995114953314111131752812515097213052728067061893768763077056914111566820414025280534046400995356712414837449121046062079911435309295464490263283769221830037029108374974495201782045992874653920211537537724643230986981824349266978767367402293999209162694369772760075107747609491264902786041130826876918123202134703658442941891830242</span>, <span class="number">7710011511933273600956066580006667228795766247206337007278271463871915295714373557766306241838812677910529618690854981247073325175370147283360553440166198511565970962496527743224575526922830794861623489204146092991883999208502150565496732100104360091815826333424313805145648110936043125983239009895903602879010609096750963186952687545255588633288528372363096307287365891027749166227382683937570696463897150461450791183251190323380329123556440876127657763835466077899344290052877228945633508945118354870143193111572860186690380517929737934424809644493802524411423150714171313957036859668776471063633076408076909640002</span>, <span class="number">11534398990341303260469847611439061098979668999994719829731530111550470410818410249398161750557290507614569764189238005873703309686837109506327355518339608092717603460229057410906842405901627607535605010996612762231101162949308540690378638599362997229992351236008016988744038581908756449465377928987817065146363195497304246692426541055618255515479438494976345916998240594200316617809496338857712977577830501882906692816143225556486899297950715922558009978599642835535619697869607264637171021550028689009097951803276399427016025503188133689654404551377724037837852806988185689913776323215325531565269517783734339408476</span>), (<span class="number">8272272655667475062275256290232058957066644079493164645631507979269407257643054858959084594359289618344535475781592669598366940627259329603071918251093350757742450608772919657077093269747626483753261408171082167959058597605651875250516235062839356580988417216005103032704789431752339869128094449937203456721380243278949753976997368943660065728420992516032685654992370625071263250775078114517084554616874002085054985135905330486990533806699940249720584638848795544488453274230413407534397455841219333342020387788428122090873004297741106966487305425968561456558554466092569815882704042720181221565998242620838426378547</span>, <span class="number">1491873293560323909465836471682585391496137454962536255211620436893391549603126009345148985699013899435764986980919290827837440218992944453711597495517127038406936254470963878149611067609857046502282994346483454884781103538081677117421537728730737422899739818406539050745938770868537148564365984825217449546939297237128543198112642950063626687602582556615437626388875069902892432216468378684299365817407995725759407957747215159745600867120912008194130121350313833434901083388223410629737737418961006112893999319596217781130922876695397872007871395908185274519733474161410964601075476672137735633842608230612826681061</span>, <span class="number">11534398990341303260469847611439061098979668999994719829731530111550470410818410249398161750557290507614569764189238005873703309686837109506327355518339608092717603460229057410906842405901627607535605010996612762231101162949308540690378638599362997229992351236008016988744038581908756449465377928987817065146363195497304246692426541055618255515479438494976345916998240594200316617809496338857712977577830501882906692816143225556486899297950715922558009978599642835535619697869607264637171021550028689009097951803276399427016025503188133689654404551377724037837852806988185689913776323215325531565269517783734339408476</span>, <span class="number">5518286687698062009543342885393885046509863686818419606949559467264593344966999393687451752996031820853347871875309050581035258278549594402296657008691757154626884909607095200698318045842887911031614826093453957797920419121148018115222640091474847413276210960870562103807155559883955899139970393355410985595182149279411843518111743292173240172189378255236409761730285268089915079904407845416962979199038931535039503248118630426893973904973536402701301849508531248635101858831456390126301671539331965453701543943834029271584917779020531726432268541549866679756622580281184543056494059969527952637068824655703408568787</span>), (<span class="number">5518286687698062009543342885393885046509863686818419606949559467264593344966999393687451752996031820853347871875309050581035258278549594402296657008691757154626884909607095200698318045842887911031614826093453957797920419121148018115222640091474847413276210960870562103807155559883955899139970393355410985595182149279411843518111743292173240172189378255236409761730285268089915079904407845416962979199038931535039503248118630426893973904973536402701301849508531248635101858831456390126301671539331965453701543943834029271584917779020531726432268541549866679756622580281184543056494059969527952637068824655703408568787</span>, <span class="number">1693899209290032350029561853961491176325960934030036784496300819586038229862962702055596244277553991149307726376926025954405273767082632179329854930518347573475252411874565533016051166864091098357633304300987288558703255380341627990340733592216210275099686058286858920208765088911242575657831474263497523327829562878858560012637889781810573289998468132623160152019410564917347628322294190496820698085105580113583601615226595193787403730579261356270949634744354490998826451014726354434764158934421631314746785252130490031259272793762135971202673634665945166330192924007170167099754596422978892135432383280045978800313</span>, <span class="number">1491873293560323909465836471682585391496137454962536255211620436893391549603126009345148985699013899435764986980919290827837440218992944453711597495517127038406936254470963878149611067609857046502282994346483454884781103538081677117421537728730737422899739818406539050745938770868537148564365984825217449546939297237128543198112642950063626687602582556615437626388875069902892432216468378684299365817407995725759407957747215159745600867120912008194130121350313833434901083388223410629737737418961006112893999319596217781130922876695397872007871395908185274519733474161410964601075476672137735633842608230612826681061</span>, <span class="number">4956025543963860548224153175168493318238985854531591968596322951867101383038318092494673400475554880419342014784571362229741642826660412082585292197764604908450405263330703286845800303018092222139976907126517882830745820723998293430203137128739850924103620078289772876248014239067659155995114953314111131752812515097213052728067061893768763077056914111566820414025280534046400995356712414837449121046062079911435309295464490263283769221830037029108374974495201782045992874653920211537537724643230986981824349266978767367402293999209162694369772760075107747609491264902786041130826876918123202134703658442941891830242</span>), (<span class="number">1693899209290032350029561853961491176325960934030036784496300819586038229862962702055596244277553991149307726376926025954405273767082632179329854930518347573475252411874565533016051166864091098357633304300987288558703255380341627990340733592216210275099686058286858920208765088911242575657831474263497523327829562878858560012637889781810573289998468132623160152019410564917347628322294190496820698085105580113583601615226595193787403730579261356270949634744354490998826451014726354434764158934421631314746785252130490031259272793762135971202673634665945166330192924007170167099754596422978892135432383280045978800313</span>, <span class="number">7710011511933273600956066580006667228795766247206337007278271463871915295714373557766306241838812677910529618690854981247073325175370147283360553440166198511565970962496527743224575526922830794861623489204146092991883999208502150565496732100104360091815826333424313805145648110936043125983239009895903602879010609096750963186952687545255588633288528372363096307287365891027749166227382683937570696463897150461450791183251190323380329123556440876127657763835466077899344290052877228945633508945118354870143193111572860186690380517929737934424809644493802524411423150714171313957036859668776471063633076408076909640002</span>, <span class="number">8272272655667475062275256290232058957066644079493164645631507979269407257643054858959084594359289618344535475781592669598366940627259329603071918251093350757742450608772919657077093269747626483753261408171082167959058597605651875250516235062839356580988417216005103032704789431752339869128094449937203456721380243278949753976997368943660065728420992516032685654992370625071263250775078114517084554616874002085054985135905330486990533806699940249720584638848795544488453274230413407534397455841219333342020387788428122090873004297741106966487305425968561456558554466092569815882704042720181221565998242620838426378547</span>, <span class="number">1491873293560323909465836471682585391496137454962536255211620436893391549603126009345148985699013899435764986980919290827837440218992944453711597495517127038406936254470963878149611067609857046502282994346483454884781103538081677117421537728730737422899739818406539050745938770868537148564365984825217449546939297237128543198112642950063626687602582556615437626388875069902892432216468378684299365817407995725759407957747215159745600867120912008194130121350313833434901083388223410629737737418961006112893999319596217781130922876695397872007871395908185274519733474161410964601075476672137735633842608230612826681061</span>)]</span><br><span class="line">enc = Matrix(Zmod(n), enc)</span><br><span class="line"></span><br><span class="line"><span class="comment">########################################### </span></span><br><span class="line"><span class="comment">#(m + 2*p)*enc[1,0] == (m + p + q)*enc[2,0]</span></span><br><span class="line"><span class="comment">#(m - 2*q)*enc[1,0] == (m + p + q)*enc[3,0]</span></span><br><span class="line"><span class="comment">#p*q == n</span></span><br><span class="line"></span><br><span class="line">PR.&lt;m,p,q&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f1 = (m + <span class="number">2</span> * p) - (inverse(enc[<span class="number">1</span>,<span class="number">0</span>],n)*enc[<span class="number">2</span>,<span class="number">0</span>])*(m + p + q)</span><br><span class="line">f2 = (m - <span class="number">2</span> * q) - (inverse(enc[<span class="number">1</span>,<span class="number">0</span>],n)*enc[<span class="number">3</span>,<span class="number">0</span>])*(m + p + q)</span><br><span class="line">f3 = p*q</span><br><span class="line">res = Ideal([f1,f2,f3]).groebner_basis()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line">q = <span class="number">98199204383444167136509999317652307746300154257439691314026803510437035509888229764173492052858804263577571331383214859652229706329210472593337809065208882042178413249493877596701444929209070708258353144837330382092255133776768117120874000890494449018234172972678168219613884207547781528635959091301251971281</span></span><br><span class="line">p = n // q</span><br><span class="line"><span class="keyword">assert</span> p*q == n</span><br><span class="line"></span><br><span class="line">PR.&lt;m&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (m + <span class="number">2</span> * p) - (inverse(enc[<span class="number">1</span>,<span class="number">0</span>],n)*enc[<span class="number">2</span>,<span class="number">0</span>])*(m + p + q)</span><br><span class="line"><span class="comment">#print(f)</span></span><br><span class="line">flag = inverse(<span class="number">3297056809289327500256202079127136134187438944961708132751779704042134248345975436322191479293257096389543469387818190390952261259850867719244868774056284786555129809594382750795637970645528822198427409878547718771238431341613753773735778866319889665322786887273473714741059398430312523411707495791556075878244637630480194633873896328931631465317325085583101546945701547571540285337915330695525854299979138422312974757786532911019780366620715999126086808046470039825598115253747158220517041862628277627457873544852999345612018379688444091864667014856637790925604130983328623143861756949881991846056060324187971651968</span>,n) * (-<span class="number">1498891588977545370451304005269054204989297955532246655702497171972634294190353786886109979315712227670838063747138944971165078237866699516737057265958406033545290094866918511445027202221306581865115556251808822409761737528633460237914954126481851519653767357154958076960906373574059921391655491951867500826108554012342761055413189807372591262833424798009944360120455674246600349563624996782442874590028504156102295527090123626799675614654662807183634567377812300847810842883813710868799454486184658344859843573551816770639242317817513006458632518373823719039586807296528828652532914106040726579904539566401034957917</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag) % n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#WMCTF&#123;QU4t3rni0n_4nd_Matr1x_4r3_4un&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="C-O-N-N-E-C-T-1-0-N"><a href="#C-O-N-N-E-C-T-1-0-N" class="headerlink" title="C O N N E C T 1 0 N"></a>C O N N E C T 1 0 N</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hand 1n Hand, Heart t0 Heart</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">padding</span>(<span class="params">flag,length</span>):</span><br><span class="line">    head_length = random.randint(<span class="number">1</span>,length-<span class="built_in">len</span>(flag))</span><br><span class="line">    tail_length = length-<span class="built_in">len</span>(flag)-head_length</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        re = urandom(head_length)+flag+urandom(tail_length)</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">bin</span>(bytes_to_long(re)).count(<span class="string">&#x27;1&#x27;</span>)) % <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shuffle</span>(<span class="params">left,right</span>):</span><br><span class="line">    xor_string = [<span class="number">0</span>]*left+[<span class="number">1</span>]*right</span><br><span class="line">    random.shuffle(xor_string)</span><br><span class="line">    xor_string = <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> xor_string),<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> xor_string</span><br><span class="line"></span><br><span class="line">l,r = <span class="number">63</span>,<span class="number">65</span></span><br><span class="line">flag = padding(flag,(<span class="built_in">len</span>(flag)//<span class="number">4</span>+<span class="number">1</span>)*<span class="number">4</span>)</span><br><span class="line">S = [bytes_to_long(padding(flag[<span class="built_in">len</span>(flag)//<span class="number">4</span>*i:<span class="built_in">len</span>(flag)//<span class="number">4</span>*(i+<span class="number">1</span>)],(l+r)//<span class="number">8</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">data = [[[shuffle(r,l)^^S[_] <span class="keyword">if</span> j == <span class="string">&#x27;1&#x27;</span> <span class="keyword">else</span> shuffle(l,r)^^S[_] <span class="keyword">for</span> j <span class="keyword">in</span> (<span class="built_in">bin</span>(shuffle(r,l)^^S[_])[<span class="number">2</span>:].rjust(l+r,<span class="string">&#x27;0&#x27;</span>) <span class="keyword">if</span> i == <span class="string">&#x27;1&#x27;</span> <span class="keyword">else</span> <span class="built_in">bin</span>(shuffle(l,r)^^S[_])[<span class="number">2</span>:].rjust(l+r,<span class="string">&#x27;0&#x27;</span>))] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">bin</span>(S[_])[<span class="number">2</span>:].rjust(l+r,<span class="string">&#x27;0&#x27;</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>
<p>output很长不放在这里，自己本地生成些数据做也是一样的。</p>
<p>这次来自<a target="_blank" rel="noopener" href="https://yolbby.github.io/">@yolbby </a>，当时他出完之后我验了这道题，所以就没有在赛中打。</p>
<blockquote>
<p>yolbby出题很有意思，先只管出，然后我们一起再看能不能做XD</p>
<p>这题是他之前给他们学校招新赛的躲猫猫中一个题目的升级，不过真的升级太多了，所以打法完全不一样，因此也没有必要去找那个题目做参考。</p>
</blockquote>
<p>总而言之题目加密流程如下：</p>
<ul>
<li>将flag前后填上随机字节，使得其填充至指定长度，并保证填充后的flag的0、1比特数量不同</li>
<li>把flag分成长度相等的四部分，并转为整数，记在列表S里</li>
<li>对S中的每一部分分别进行后续加密</li>
</ul>
<p>由于S的四部分都是分开的，所以假设就加密第一部分好了。</p>
<blockquote>
<p>因为这么做可以少一层括号，括号多了真的头大TT</p>
</blockquote>
<p>先看一下shuffle这个函数，对于输入(l，r)，它的功能是输出一个随机比特串，但这个比特串0的数量为l，1的数量为r。</p>
<p>又因为题目生成的随机串只有(63,65)和(65,63)两种，不妨就把他们分别记为串a和串b，并记S[0]对应的比特串是m，那么加密流程是：</p>
<ul>
<li><p>对m按位加密，记当前位为s（以下以当前bit为1举例）：</p>
</li>
<li><p>如果s = 1，则生成随机串b1，并记：</p>
<script type="math/tex; mode=display">
c = b_1 \oplus m</script><ul>
<li><p>对于c的每一位，记当前位为t，</p>
</li>
<li><p>如果t = 1，则生成随机串b2，并计算d，放到data中：</p>
<script type="math/tex; mode=display">
d = b_2 \oplus m</script></li>
<li><p>如果t = 0，则生成随机串a2，并计算e，放到data中：</p>
<script type="math/tex; mode=display">
e = a_2 \oplus m</script></li>
</ul>
</li>
</ul>
<p>由于内外套了两层与m的异或，很难直接看出什么性质，所以我们不妨先假设一个简化的情形，也就是外层不与m异或：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = [[shuffle(r,l)^^secret <span class="keyword">if</span> j == <span class="string">&#x27;1&#x27;</span> <span class="keyword">else</span> shuffle(l,r)^^secret <span class="keyword">for</span> j <span class="keyword">in</span> (<span class="built_in">bin</span>(shuffle(r,l))[<span class="number">2</span>:].rjust(<span class="number">128</span>,<span class="string">&#x27;0&#x27;</span>) <span class="keyword">if</span> i == <span class="string">&#x27;1&#x27;</span> <span class="keyword">else</span> <span class="built_in">bin</span>(shuffle(l,r))[<span class="number">2</span>:].rjust(<span class="number">128</span>,<span class="string">&#x27;0&#x27;</span>))] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">bin</span>(secret)[<span class="number">2</span>:].rjust(<span class="number">128</span>,<span class="string">&#x27;0&#x27;</span>)]</span><br></pre></td></tr></table></figure>
<p>此时我们知道，如果m当前位s=1，那么data对应的这一行会有65个e串，63个d串；否则会有63个e串，65个d串。</p>
<p>m和data中的数据都是一个128bit的比特串，我们考虑对他们做一个映射：</p>
<script type="math/tex; mode=display">
\phi: (\{0,1\},\oplus) \rightarrow (\{1,-1\},\times)</script><p>这个映射显然是个同态，因为：</p>
<script type="math/tex; mode=display">
\phi(x_1 \oplus x_2) = \phi(x_1) \times \phi(x_2)</script><p>我们用data中的第一行展开分析，记第一行中每个数据分别为ci，那么此时m与ci的异或就可以同态到乘法：</p>
<script type="math/tex; mode=display">
m \oplus c_i \rightarrow  (m'_{1}c'_{i1},m'_{2}c'_{i2},...,m'_{128}c'_{i,128})</script><p>而我们知道m与ci的异或值要么是a串要么是b串，而由于a、b两种串做映射后变成1、-1的数量相差2，所以这其实告诉了我们一个映射后向量的内积关系：</p>
<script type="math/tex; mode=display">
\mathbf{m'} \cdot \mathbf{c_i'} = \pm 2</script><p>而这具体是2还是-2我们暂时不得而知，因为我们不清楚每个ci对应的是d串还是e串，但是有一个事情是确定的，那就是第一行d、e两种串的数量分别是63或者65，具体a是63还是b是63取决于m的第一bit。</p>
<p>既然总量上有差异，那么考虑把第一行所有内积进行加和，就得到：</p>
<script type="math/tex; mode=display">
\mathbf{m'} \cdot \sum_{i = 1}^{128} \mathbf{c_i'} = \pm 4</script><p>之所以是正负4，这是因为有63对两两抵消掉了，只剩下单出来的两个a串或b串，所以为正负4。</p>
<p>而现在要解决的问题是：到底每一行是正4还是-4？我们知道m当前bit如果是0，这一行d串更多，那么加和中会单出两个b串，所以会得到4；同理如果m当前bit是1就会得到-4。因此我们可以把所有加和写成一个矩阵方程：</p>
<script type="math/tex; mode=display">
\mathbf{m'} \cdot \sum_{i = 1}^{128}\sum_{j = 1}^{128} \mathbf{c_{ij}'} = 4\mathbf{m'}</script><p>把cij组成的矩阵记作M，就有：</p>
<script type="math/tex; mode=display">
\mathbf{m'}M = 4\mathbf{m'}</script><p>也就是：</p>
<script type="math/tex; mode=display">
\mathbf{m'}(M - 4E) = (0,0,...,0)</script><p>所以如果是这种情况就简单了，我们只需要求矩阵方程就可以得到m’，再映射回m。</p>
<p>在这个思路基础上，题目在外层多套了一层与m的异或，这使得下面的式子不一定成立：</p>
<script type="math/tex; mode=display">
\mathbf{m'} \cdot \sum_{i = 1}^{128} \mathbf{c_i'} = \pm 4</script><p>此时成立的应该是：（因为每更换一bit就会少一对a、b串，而多出两个单的a串或b串）</p>
<script type="math/tex; mode=display">
\mathbf{m'} \cdot \sum_{i = 1}^{128} \mathbf{c_i'} = \pm 4k</script><p>那么就有：</p>
<script type="math/tex; mode=display">
\mathbf{m'} M = (0,0,...,0) \quad(mod\;4)</script><p>而实际上进一步测试可以发现m一定满足且仅满足如下两种情况之一，具体是哪种取决于m汉明重量的奇偶性，事实上由于padding的特殊性一定满足模8为0：</p>
<script type="math/tex; mode=display">
\mathbf{m'} M = (4,4,...,4) \quad(mod\;8)</script><script type="math/tex; mode=display">
\mathbf{m'} M = (0,0,...,0) \quad(mod\;8)</script><p>不过不管哪种情况，由于m’是1、-1组成的短向量所以都可以BKZ。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = <span class="built_in">eval</span>(f.readline())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> datai <span class="keyword">in</span> data:</span><br><span class="line">    M = matrix(<span class="number">128</span>,<span class="number">128</span>)</span><br><span class="line">    v0 = zero_matrix(<span class="number">128</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    M = matrix(<span class="number">128</span>,<span class="number">128</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">            temp = <span class="built_in">bin</span>(datai[i][j])[<span class="number">2</span>:].zfill(<span class="number">128</span>)</span><br><span class="line">            m = [-<span class="number">1</span> <span class="keyword">if</span> tt == <span class="string">&#x27;1&#x27;</span> <span class="keyword">else</span> <span class="number">1</span> <span class="keyword">for</span> tt <span class="keyword">in</span> temp]</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">                M[k,i] += m[k]</span><br><span class="line"></span><br><span class="line">    L = block_matrix(ZZ,[</span><br><span class="line">        [identity_matrix(<span class="number">128</span>),M],</span><br><span class="line">        [<span class="number">0</span>,<span class="number">8</span>*identity_matrix(<span class="number">128</span>)]</span><br><span class="line">    ])</span><br><span class="line">    L[:,-<span class="number">128</span>:] *= <span class="number">2</span>^<span class="number">10</span></span><br><span class="line"></span><br><span class="line">    res = L.BKZ(block_size=<span class="number">28</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">all</span> (j == <span class="number">1</span> <span class="keyword">or</span> j == -<span class="number">1</span> <span class="keyword">for</span> j <span class="keyword">in</span> i[:<span class="number">128</span>])):</span><br><span class="line">            flag1 = <span class="string">&quot;&quot;</span></span><br><span class="line">            flag2 = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> i[:<span class="number">128</span>]:</span><br><span class="line">                <span class="keyword">if</span>(t == -<span class="number">1</span>):</span><br><span class="line">                    flag1 += <span class="string">&quot;0&quot;</span></span><br><span class="line">                    flag2 += <span class="string">&quot;1&quot;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    flag1 += <span class="string">&quot;1&quot;</span></span><br><span class="line">                    flag2 += <span class="string">&quot;0&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag1,<span class="number">2</span>)))</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag2,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#WMCTF&#123;CW</span></span><br><span class="line"><span class="comment">#02nec71on_Pw</span></span><br><span class="line"><span class="comment">#TUnSt4b13_2v</span></span><br><span class="line"><span class="comment">#_under_3L&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#WMCTF&#123;C02nec71on_UnSt4b13_under_3L&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Turing"><a href="#Turing" class="headerlink" title="*Turing"></a>*Turing</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Do as Turing did.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<p>重要一点的文件大概是以下几个：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_uppercase</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle, choice, randint</span><br><span class="line"><span class="keyword">from</span> pyenigma <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> myenigma <span class="keyword">import</span> myReflector, myrotors</span><br><span class="line"></span><br><span class="line">flag = </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">s1, s2</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s1) != <span class="built_in">len</span>(s2):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s1)):</span><br><span class="line">        <span class="keyword">if</span> s1[i] == s2[i]:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> (count/<span class="built_in">len</span>(s1)) &gt; <span class="number">0.85</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_recvall</span>(<span class="params">self</span>):</span><br><span class="line">        BUFF_SIZE = <span class="number">2048</span></span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            part = self.request.recv(BUFF_SIZE)</span><br><span class="line">            data += part</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(part) &lt; BUFF_SIZE:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> newline:</span><br><span class="line">                msg += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line">            self.request.sendall(msg)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recv</span>(<span class="params">self, prompt=<span class="string">b&#x27;[-] &#x27;</span></span>):</span><br><span class="line">        self.send(prompt, newline=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self._recvall()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">proof_of_work</span>(<span class="params">self</span>):</span><br><span class="line">        signal.alarm(<span class="number">60</span>)</span><br><span class="line">        random.seed(os.urandom(<span class="number">8</span>))</span><br><span class="line">        proof = <span class="string">&#x27;&#x27;</span>.join(</span><br><span class="line">            [random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">        _hexdigest = sha256(proof.encode()).hexdigest()</span><br><span class="line">        self.send(<span class="string">f&quot;[+] sha256(XXXX+<span class="subst">&#123;proof[<span class="number">4</span>:]&#125;</span>) == <span class="subst">&#123;_hexdigest&#125;</span>&quot;</span>.encode())</span><br><span class="line">        x = self.recv(prompt=<span class="string">b&#x27;[+] Plz tell me XXXX: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">4</span> <span class="keyword">or</span> sha256(x+proof[<span class="number">4</span>:].encode()).hexdigest() != _hexdigest:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.proof_of_work():</span><br><span class="line">            self.send(<span class="string">b&#x27;[!] Wrong!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        signal.alarm(<span class="number">150</span>)</span><br><span class="line">        key = ?</span><br><span class="line">        letters = <span class="built_in">list</span>(ascii_uppercase)</span><br><span class="line">        others = <span class="string">&quot;&quot;</span>.join([choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>)])</span><br><span class="line">        pos = randint(<span class="number">0</span>, <span class="built_in">len</span>(others))</span><br><span class="line">        text = others[:pos]+key+others[pos:]</span><br><span class="line">        dayrotors = <span class="built_in">tuple</span>(random.sample(myrotors, <span class="number">3</span>))</span><br><span class="line">        <span class="keyword">for</span> times <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            tmpkey = <span class="string">&quot;&quot;</span>.join([choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)])</span><br><span class="line">            shuffle(letters)</span><br><span class="line">            plugin = <span class="string">&quot; &quot;</span>.join([letters[<span class="number">2</span>*i]+letters[<span class="number">2</span>*i+<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line">            myEnigma = enigma.Enigma(myReflector, *dayrotors, tmpkey, plugin)</span><br><span class="line">            ctx = myEnigma.encipher(text)</span><br><span class="line">            self.send(ctx.encode())</span><br><span class="line">        datekey = <span class="string">&quot;&quot;</span>.join([choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)])</span><br><span class="line">        shuffle(letters)</span><br><span class="line">        plugin = <span class="string">&quot; &quot;</span>.join([letters[<span class="number">2</span>*i]+letters[<span class="number">2</span>*i+<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line">        myEnigma = enigma.Enigma(myReflector, *dayrotors, datekey, plugin)</span><br><span class="line">        ctx = myEnigma.encipher(text)</span><br><span class="line">        self.send(ctx.encode())</span><br><span class="line">        self.send(<span class="string">b&quot;now give me the plaintext:&quot;</span>)</span><br><span class="line">        ans = self.recv().decode()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check(ans, text):</span><br><span class="line">            self.send(<span class="string">b&#x27;nonono&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        self.send(<span class="string">b&#x27;here is your flag&#x27;</span>)</span><br><span class="line">        self.send(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ForkedServer</span>(socketserver.ForkingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">8840</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    <span class="built_in">print</span>(HOST, PORT)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>
<p>msg.txt：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Some of the German ciphertexts have been decrypted. Maybe you can find something different.</span><br><span class="line"></span><br><span class="line">SIXOCLOCKTHEWEATHERTODAYISCLEARRAININTHEEVENING</span><br><span class="line">HEILHITLERMORNINGGREETINGSTHEWEATHERTODAYISRAINYSUNNYLATER</span><br><span class="line">GOODMORNINGHOWAREYOUTHEWEATHERTODAYISCLOUDYWITHASLIGHTCHANCEOFSHOWERS</span><br><span class="line">HIHOHEILHITLERTHEWEATHERTODAYISHOTANDHUMID</span><br><span class="line">GREETINGSTHEWEATHERTODAYISWINDYANDCOLDTAKEGOODCARE</span><br><span class="line">HELLOTHEWEATHERTODAYISSUNNYANDBRIGHTHAVEAGREATDAY</span><br><span class="line">HEILHITLERMORNINGTHEWEATHERTODAYISFOGGYINTHEMORNINGCLEARINGUPLATER</span><br><span class="line">HIHOWASYOURNIGHTTHEWEATHERTODAYISCOOLANDPLEASANT</span><br><span class="line">GOODMORNINGHEILHITLERTHEWEATHERTODAYISRAINYWITHATHUNDERSTORMLATER</span><br><span class="line">HELLOTHEWEATHERTODAYISHOTANDDRYREMEMBERTODRINKWATER</span><br><span class="line">MORNINGGREETINGSTHEWEATHERTODAYISMISTYANDMOISTFEELINGREFRESHING</span><br></pre></td></tr></table></figure>
<p>由于确实一点都不了解enigma，所以要先找点东西学习一下，结合题目描述知道应该是要考图灵对enigma的破译，所以找了以下一些资料看：</p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/28397034/answer/41739506">(99+ 封私信 / 80 条消息) 《模仿游戏》中艾伦·图灵是如何破译英格玛的？ - 知乎 (zhihu.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av2884019/">【中字】二战间谍战——英格玛密码机下（解密）@阿尔法小分队科教组_哔哩哔哩_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1PL4y1H77Z/?spm_id_from=333.880.my_history.page.click">【计算机博物志】战争密码（下集）炸弹机_哔哩哔哩_bilibili</a></p>
<p>看完这几个会发现不管是加密方式还是破译方式，enigma都比想象的要简单很多，先简单总结一下。</p>
<h4 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h4><p>对于题目中的enigma，它有以下几个主要部件：</p>
<ul>
<li>五个加密转子(rotor)：每个转子代表着一个字母间的单表代换，记为I、II、III、IV、V。</li>
<li>一个反射器，仍然代表一个单表代换</li>
<li>一个插线板(plugin)：在输入和输出时将插线板连接的字母进行交换</li>
</ul>
<h4 id="密钥"><a href="#密钥" class="headerlink" title="密钥"></a>密钥</h4><p>每次加密时有以下一些不同的配置，这些配置共同构成本次enigma加密的密钥：</p>
<ul>
<li><p>五个rotors里面选取其中三个并作排列，如：IV、V、II</p>
<blockquote>
<p>种数共有 $A(5,3) = 5 \cdot 4 \cdot 3 = 60$</p>
</blockquote>
</li>
<li><p>每个被选中的rotor需要设置一个起始刻度，如：Q、V、M</p>
<blockquote>
<p>种数共有 $26^3 = 17576$ 种</p>
</blockquote>
</li>
<li><p>插线板需要选择十对字母两两组合，如：AB、CD、EF、GH、IJ、KL、MN、OP、QR、ST</p>
<blockquote>
<p>种数共有 $\prod_{i=0}^{9}(\frac{26-2i}{2}) \approx 2^{69}$ 种</p>
<p>剩下没有配对的六个字母可以看作自己和自己交换(也就是不交换)，如：UU、VV、WW、XX、YY、ZZ</p>
</blockquote>
</li>
</ul>
<p>所以一次enigma加密的密钥可以看成一个三元组：</p>
<p>key =（（IV、V、II）、（Q、V、M）、（AB、CD、EF、GH、IJ、KL、MN、OP、QR、ST））</p>
<p>对于破译者来说，如果这三个元素都获得了，就可以解本次enigma的全部密文。</p>
<h4 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h4><p>简单来讲，enigma加密的输入输出都是一个英语字母串，并且是按字符来的。我们不妨假设明文是TANG，那么以T这单个字符被上述密钥加密为例，具体来说过程是：</p>
<ul>
<li>输入T，经过plugin，变为S</li>
<li>B经过第一层转子IV，变为$\alpha$</li>
<li>$\alpha$经过第二层转子V，变为$\beta$</li>
<li>$\beta$经过第三层转子II，变为$\delta$</li>
<li>$\delta$经过反射器，变为$\gamma$</li>
<li>$\gamma$经过第三层转子II，变为$\theta$</li>
<li>$\theta$经过第二层转自V，变为$\epsilon$</li>
<li>$\epsilon$经过第一层转子IV，假设变为E</li>
<li>E经过plugin，变为F</li>
</ul>
<p>这就是单次字符加密的全过程，而随着输入字符变多，三个rotor会按如下规律转动(不然为什么叫转子)：</p>
<ul>
<li>每输入一个字符，第一层转子转动一格</li>
<li>第一层转子转动一圈，第二个转子就转动一格</li>
<li>第二层转子转动一圈，第三个转子就转动一格</li>
</ul>
<p>所以在第一个字符T被加密之后，第一个转子会转一格，那么我们加密第二个字符A的时候第一个转子的单表代换就发生了改变，所以即使第二个输入字母还是T，他的结果也不会和第一个相同。</p>
<p>具体来说对于字符的一次加密流程图如下：（这个图少了plug的部分）</p>
<p><img src="/post/3ff42458/image-20240909161527611.png" alt="image-20240909161527611"></p>
<h4 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h4><p>enigma机主要有两个重要性质：</p>
<ul>
<li><p>如果转子配置与plugin配置完全一样，那么如果加密 $\alpha$ 得到 $\beta$，在同样的配置下则一定有加密 $\beta$  得到 $\alpha$，这个性质也叫自反性</p>
<blockquote>
<p>从上面的单字符加密示意图也可以看出来，这有点光路图的感觉，而光路是可逆的XD，所以有完整密钥三元组的话，只需要用密钥配置enigma机，然后加密一遍密文就行了</p>
</blockquote>
</li>
<li><p>任何字符在任何转子配置下一定不会加密得到其本身，也就是无论什么时候加密 $\alpha$ 都一定不会得到 $\alpha$ </p>
</li>
</ul>
<p>了解上面这些对这个题目就已经差不多了，接下来就回到题目。</p>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><p>题意很简单：</p>
<ul>
<li><p>连接上靶机后，靶机先生成30个随机英语字母，然后随机选定一个位置pos，在pos处插入一段key，得到待加密的明文text</p>
</li>
<li><p>用不同的enigma密钥对text进行加密，并发送密文，重复11次(10次tmpkey和1次datekey本质上来说没啥区别)</p>
<blockquote>
<p>不同的enigma密钥指密钥的三个部分都完全不同：</p>
<ul>
<li>随机选的三个rotors以及排列顺序</li>
<li>三个rotors对应的起始刻度</li>
<li>plugin的设置</li>
</ul>
</blockquote>
</li>
<li><p>要求我们在150s内发送回一段文本ans，ans和text相同字母占比超过0.85就可以拿到flag</p>
</li>
</ul>
<h5 id="恢复text中的key"><a href="#恢复text中的key" class="headerlink" title="恢复text中的key"></a>恢复text中的key</h5><p>我们除了密文以外没有关于密钥的任何信息，好在题目还给了个task里完全没有出现过的msg，而很容易就联想到这个msg的内容应该和未知的静态key有关，而最合理的猜测就是key就在这段msg中。</p>
<p>与靶机简单交互一下会发现key的长度应该是17，所以现在的问题就是key究竟是msg中的哪17个字符。</p>
<p>此时我们就要利用上面讲的第二个性质：任何字符在任何转子配置下一定不会加密得到其本身，所以我们可以拿msg中的所有17个连续字符来与每次交互的11个密文做比对。具体步骤类似于滑动窗口，我们可以把11个密文以及我们假设的长为17的key一起排列起来，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">OSXJMOYNOBIUZBYHLTMLIMUDTBICTWVXSZEKHKAVPJKSLIP</span><br><span class="line">KXORTUUSVUXTTPILXXPXYKOSHJJNVYHWYGPMAWXPPDYVRFB</span><br><span class="line">EXFQKJIHGJNDPUQNLLCDWPQSFLBZRXPQKJYUDVDNARPLNJC</span><br><span class="line">ZYYGFLWHSOQAFJAYKUNKQUEWNGIRQCTJSEDAGGOLPEUOCIV</span><br><span class="line">FAZUNPEFDRKUOZXYAYRCRSEJTPFRHHODCQDCVMAWQBAKWXQ</span><br><span class="line">AYNWCKPGAHMRATCQAFZNUZTTHCICBYEXLXTGPOYNIINBEMR</span><br><span class="line">OAWFCWZMJWYAWNUNJNBDMLKGNNLTETMXJEGRDPXTZNHGEJK</span><br><span class="line">TCHIIJVNOVHUWLUFUQMWJHPXZHBUOXLKWVBMWXXJNDYOJKM</span><br><span class="line">QOMDJITPSUGFPCJTHJGZXISEVGQIWBKNQCFYROCZJBITTBK</span><br><span class="line">IIOKAPDFKFZRPKDJMAXNQYONBYDRSFREUDWBQWHXLVQUJNS</span><br><span class="line">FISNDRDZBHKJISFHVJXNRMRFAHCPILZANOUONMEGZGNFLXP</span><br><span class="line"></span><br><span class="line">XXXXXXXXXXXXXXXXX</span><br></pre></td></tr></table></figure>
<p>我们可以爆破msg里所有17个连续字符当作这段XXXXXXXXXXXXXXXXX，虽然位置pos我们并不知道，但是有一个事情是定的：这11个密文加密的都是同一个text，也就是key被加密的位置一样，所以如果当前爆破的key能够满足下面条件的话：</p>
<ul>
<li>key在某一个pos，与上面11段密文在当前位置的那一段都没有相同的字符</li>
</ul>
<p>这就说明它满足enigma的性质，就有可能是正确的key，反之则一定不是正确的key，可以用代码简单验证一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyenigma <span class="keyword">import</span> rotor </span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_uppercase</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> pyenigma <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint,choice,shuffle</span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################################## data</span></span><br><span class="line">myReflector=rotor.Reflector(<span class="string">&#x27;WOEHCKYDMTFRIQBZNLVJXSAUGP&#x27;</span>,<span class="string">&quot;myReflector&quot;</span>)</span><br><span class="line">myrotor1=rotor.Rotor(<span class="string">&#x27;UHQAOFBEPIKZSXNCWLGJMVRYDT&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor1&quot;</span>)</span><br><span class="line">myrotor2=rotor.Rotor(<span class="string">&#x27;RIKHFBUJDNCGWSMZVXEQATOLYP&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor2&quot;</span>)</span><br><span class="line">myrotor3=rotor.Rotor(<span class="string">&#x27;ENQXUJSIVGOMRLHYCDKTPWAFZB&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor3&quot;</span>)</span><br><span class="line">myrotor4=rotor.Rotor(<span class="string">&#x27;JECGYWNDPQUSXZMKHRLTAVFOIB&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor4&quot;</span>)</span><br><span class="line">myrotor5=rotor.Rotor(<span class="string">&#x27;EYDBNSFAPJTMGURLOIWCHXQZKV&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor5&quot;</span>)</span><br><span class="line">myrotors=[myrotor1,myrotor2,myrotor3,myrotor4,myrotor5]</span><br><span class="line"></span><br><span class="line">msgs = [<span class="string">&quot;SIXOCLOCKTHEWEATHERTODAYISCLEARRAININTHEEVENING&quot;</span>,</span><br><span class="line"><span class="string">&quot;HEILHITLERMORNINGGREETINGSTHEWEATHERTODAYISRAINYSUNNYLATER&quot;</span>,</span><br><span class="line"><span class="string">&quot;GOODMORNINGHOWAREYOUTHEWEATHERTODAYISCLOUDYWITHASLIGHTCHANCEOFSHOWERS&quot;</span>,</span><br><span class="line"><span class="string">&quot;HIHOHEILHITLERTHEWEATHERTODAYISHOTANDHUMID&quot;</span>,</span><br><span class="line"><span class="string">&quot;GREETINGSTHEWEATHERTODAYISWINDYANDCOLDTAKEGOODCARE&quot;</span>,</span><br><span class="line"><span class="string">&quot;HELLOTHEWEATHERTODAYISSUNNYANDBRIGHTHAVEAGREATDAY&quot;</span>,</span><br><span class="line"><span class="string">&quot;HEILHITLERMORNINGTHEWEATHERTODAYISFOGGYINTHEMORNINGCLEARINGUPLATER&quot;</span>,</span><br><span class="line"><span class="string">&quot;HIHOWASYOURNIGHTTHEWEATHERTODAYISCOOLANDPLEASANT&quot;</span>,</span><br><span class="line"><span class="string">&quot;GOODMORNINGHEILHITLERTHEWEATHERTODAYISRAINYWITHATHUNDERSTORMLATER&quot;</span>,</span><br><span class="line"><span class="string">&quot;HELLOTHEWEATHERTODAYISHOTANDDRYREMEMBERTODRINKWATER&quot;</span>,</span><br><span class="line"><span class="string">&quot;MORNINGGREETINGSTHEWEATHERTODAYISMISTYANDMOISTFEELINGREFRESHING&quot;</span>]</span><br><span class="line">msg = <span class="string">&quot;&quot;</span>.join(msgs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ciphers = []</span><br><span class="line">keypos = randint(<span class="number">0</span>,<span class="built_in">len</span>(msg)-<span class="number">17</span>)</span><br><span class="line">key = msg[keypos:keypos+<span class="number">17</span>]</span><br><span class="line">letters = <span class="built_in">list</span>(ascii_uppercase)</span><br><span class="line">others = <span class="string">&quot;&quot;</span>.join([choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>)])</span><br><span class="line">pos = randint(<span class="number">0</span>, <span class="built_in">len</span>(others))</span><br><span class="line">text = others[:pos]+key+others[pos:]</span><br><span class="line">dayrotors = <span class="built_in">tuple</span>(random.sample(myrotors, <span class="number">3</span>))</span><br><span class="line"><span class="keyword">for</span> times <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    tmpkey = <span class="string">&quot;&quot;</span>.join([choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)])</span><br><span class="line">    shuffle(letters)</span><br><span class="line">    plugin = <span class="string">&quot; &quot;</span>.join([letters[<span class="number">2</span>*i]+letters[<span class="number">2</span>*i+<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line">    myEnigma = enigma.Enigma(myReflector, *dayrotors, tmpkey, plugin)</span><br><span class="line">    ctx = myEnigma.encipher(text)</span><br><span class="line">    ciphers.append(ctx)</span><br><span class="line">datekey = <span class="string">&quot;&quot;</span>.join([choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)])</span><br><span class="line">shuffle(letters)</span><br><span class="line">plugin = <span class="string">&quot; &quot;</span>.join([letters[<span class="number">2</span>*i]+letters[<span class="number">2</span>*i+<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line">myEnigma = enigma.Enigma(myReflector, *dayrotors, datekey, plugin)</span><br><span class="line">ctx = myEnigma.encipher(text)</span><br><span class="line">ciphers.append(ctx)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################################## find key</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">all</span>(i != j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(a,b))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg)-<span class="number">17</span>):</span><br><span class="line">    mykey = msg[i:i+<span class="number">17</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">        RIGHT = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> cipher <span class="keyword">in</span> ciphers:</span><br><span class="line">            cpos = cipher[j:j+<span class="number">17</span>]</span><br><span class="line">            <span class="keyword">if</span>(check(mykey, cpos) == <span class="literal">False</span>):</span><br><span class="line">                RIGHT = <span class="number">0</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(RIGHT == <span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;possible_pos =&quot;</span>, j, <span class="string">&quot;possible_key =&quot;</span>, mykey)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pos, key)</span><br></pre></td></tr></table></figure>
<p>可以发现会有多个可能的key，说明密文组数还是不太够，但由于key显然是静态的，所以多次交互求个交集就可以了，最后可以得到key是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">&quot;THEWEATHERTODAYIS&quot;</span></span><br></pre></td></tr></table></figure>
<h5 id="恢复enigma的密钥"><a href="#恢复enigma的密钥" class="headerlink" title="恢复enigma的密钥"></a>恢复enigma的密钥</h5><p>在拥有key的同时，我们也拥有了pos，所以现在我们现在拥有很多个明密文对如下：（数据只做示例用）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    THEWEATHERTODAYIS</span><br><span class="line"></span><br><span class="line">RSQVJWPNHTWXTUYYXUSLJPHZZGSVEQJULPNTKEUKTSNLUTY</span><br><span class="line">TBYWYJSPCWKTVJHMQPGYMLNFPOAHDVSIHNILKYSFKRKYLQB</span><br><span class="line">BFDFWJIZGQKWZVBQRPJVHHDNNIKFYMNEOCGIQGZUWNOWBRY</span><br><span class="line">BKZCZWYPYGHTLVZLEWZBDWXOWKKCAMARACMQFWNNVWJEMWX</span><br><span class="line">FGQNJQCMMFFCTUBCWVDDGVUQGIQJSUEHCGBZCZJQSNMPEXF</span><br><span class="line">MRKOZUUVFJMQSIBEMKQMZUGBZWTUPHJFHUFKKYJHTMGWBEK</span><br><span class="line">AUUXGIQKPPDQPMXXIVKCQLVKIXGSQVOETMFSJJTHFPIFEPO</span><br><span class="line">CVLGZCNZTRNEFAPSFMFUMKVKNOVIOJEMAKRMWHMGQNZLTKU</span><br><span class="line">UEOSAUISNVEUFLNDIZHUDEZKUZHEVLNDBFOMCWXXHUXGUPL</span><br><span class="line">GNSTEFKMSGZTYNASKBJUUASCFEAWQBNBVMDLWUGOXMXNLFE</span><br><span class="line">IZGOPPYMQUGPCAIPXGFAFWZUKGWRZGRUBYGCCTRDCCPNFIO</span><br></pre></td></tr></table></figure>
<p>然而每次enigma加密用的密钥三元组都是不一样的，也就是说这么多组明密文对，每组其实都对应一个不同的enigma机，我们只需要破解其中一台，就可以恢复完整text了。因此不妨选第一组做示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    THEWEATHERTODAYIS</span><br><span class="line"></span><br><span class="line">RSQVJWPNHTWXTUYYXUSLJPHZZGSVEQJULPNTKEUKTSNLUTY</span><br></pre></td></tr></table></figure>
<p>此时我们知道的明密文对应关系是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">----THEWEATHERTODAYIS--------------------------</span><br><span class="line"></span><br><span class="line">----JWPNHTWXTUYYXUSLJ--------------------------</span><br></pre></td></tr></table></figure>
<p>图灵把这种明密文对叫做一个crib，而我们现在要做的就是利用这个crib去破解这台enigma完全未知的密钥三元组，我们再回顾一下这三元组分别是什么，有多少种可能：</p>
<blockquote>
<p>每次加密时有以下一些不同的配置，这些配置共同构成本次enigma加密的密钥：</p>
<ul>
<li><p>五个rotors里面选取其中三个并作排列，如：IV、V、II</p>
<blockquote>
<p>种数共有 $A(5,3) = 5 \cdot 4 \cdot 3 = 60$</p>
</blockquote>
</li>
<li><p>每个被选中的rotor需要设置一个起始刻度，如：Q、V、M</p>
<blockquote>
<p>种数共有 $26^3 = 17576$ 种</p>
</blockquote>
</li>
<li><p>插线板需要选择十对字母两两组合，如：AB、CD、EF、GH、IJ、KL、MN、OP、QR、ST</p>
<blockquote>
<p>种数共有 $\prod_{i=0}^{9}(\frac{26-2i}{2}) \approx 2^{69}$ 种</p>
<p>剩下没有配对的六个字母可以看作自己和自己交换(也就是不交换)，如：UU、VV、WW、XX、YY、ZZ</p>
</blockquote>
</li>
</ul>
</blockquote>
<p>可以看出如果直接暴力求解的话，复杂度其实主要来自于plug的设置，如果已知plug的话，剩下要爆破的复杂度一共为：</p>
<script type="math/tex; mode=display">
A(5,3) \cdot 26^3 = 1054560 \approx  2^{21}</script><p>这就很容易接受了。</p>
<p>而图灵做的工作意义很重大，他做到的事情概括下来是：</p>
<ul>
<li><p>假设给定一个或多个crib</p>
<blockquote>
<p>crib肯定越多越好，越长越好，因为额外信息就更多</p>
</blockquote>
</li>
<li><p>爆破密钥的前两个组成元素，也就是rotors和起始刻度</p>
</li>
<li><p>求出所有可能的plug设置</p>
</li>
</ul>
<p>也就是说，图灵可以用2^21左右的可以接受的复杂度来求出少数的可能的plug，这就很厉害了。</p>
<h6 id="效率很低的dfs"><a href="#效率很低的dfs" class="headerlink" title="效率很低的dfs"></a>效率很低的dfs</h6><p>而其实这个工作的思路虽然说不容易想到，但图灵已经做出了成果，而理解这个成果其实并不难，核心思路就是剪枝+回溯，我们以刚才的crib做例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">----THEWEATHERTODAYIS--------------------------</span><br><span class="line"></span><br><span class="line">----JWPNHTWXTUYYXUSLJ--------------------------</span><br></pre></td></tr></table></figure>
<p>我们爆破所有rotors和起始刻度，也就是我们除了plug的设置以外，当前的enigma已经可以跑起来了。那么对第一个字符T，我们知道其加密为了J，我们需要：</p>
<ul>
<li>假设plug中的设置含有”TA”，那么T经过plug会到A</li>
<li>把A送进我们当前配置好的enigma进行加密，他会出来一个确定的字符，假设为B</li>
<li>B经过plug得到J，说明plug中一定也含有”BJ”</li>
</ul>
<p>既然没有产生矛盾，那我们就继续向下推进一个字符，来到第二个字符H：</p>
<ul>
<li>由于plug中每个字符仅能与一个字符配对，而此时A、B在刚才的推导中都出现过了，所以我们此时假设plug中含有”HC”</li>
<li>把C送进我们当前配置好的enigma进行加密，他会出来一个确定的字符，假设为T</li>
<li>T经过plug得到W，说明plug中一定也含有”TW”</li>
</ul>
<p>此时就产生了矛盾，因为plug中每个字符仅能与一个字符配对，不会同时出现”TA”和”TW”。</p>
<p>这说明我们的假设中有地方出错了，那么我们就需要一层层向上回溯，而第一个回溯到的猜测点是”HC”，所以我们下面猜”HD”，然后如法炮制。</p>
<p>如果H和所有字母配对都会产生矛盾怎么办？这说明我们最开始猜测的”TA”就不对，那么我们就需要回溯到最开始，并猜测”TB”，然后往后进行。</p>
<p>如果T和所有字母配对都会产生矛盾怎么办？这说明一个事情：我们配置的enigma机出了问题，也就是说本次爆破的rotors和起始刻度是错误的，所以此时我们就该更换下一个待爆破的enigma机的配置，然后重复刚才的猜测-回溯过程了。</p>
<p>这一部分代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyenigma <span class="keyword">import</span> rotor </span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_uppercase</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> pyenigma <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint,choice,shuffle</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################################## data</span></span><br><span class="line">myReflector=rotor.Reflector(<span class="string">&#x27;WOEHCKYDMTFRIQBZNLVJXSAUGP&#x27;</span>,<span class="string">&quot;myReflector&quot;</span>)</span><br><span class="line">myrotor1=rotor.Rotor(<span class="string">&#x27;UHQAOFBEPIKZSXNCWLGJMVRYDT&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor1&quot;</span>)</span><br><span class="line">myrotor2=rotor.Rotor(<span class="string">&#x27;RIKHFBUJDNCGWSMZVXEQATOLYP&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor2&quot;</span>)</span><br><span class="line">myrotor3=rotor.Rotor(<span class="string">&#x27;ENQXUJSIVGOMRLHYCDKTPWAFZB&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor3&quot;</span>)</span><br><span class="line">myrotor4=rotor.Rotor(<span class="string">&#x27;JECGYWNDPQUSXZMKHRLTAVFOIB&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor4&quot;</span>)</span><br><span class="line">myrotor5=rotor.Rotor(<span class="string">&#x27;EYDBNSFAPJTMGURLOIWCHXQZKV&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor5&quot;</span>)</span><br><span class="line">myrotors=[myrotor1,myrotor2,myrotor3,myrotor4,myrotor5]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;THEWEATHERTODAYIS&quot;</span></span><br><span class="line">letters = <span class="built_in">list</span>(ascii_uppercase)</span><br><span class="line">others = <span class="string">&quot;&quot;</span>.join([choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>)])</span><br><span class="line">pos = randint(<span class="number">0</span>, <span class="built_in">len</span>(others))</span><br><span class="line">text = others[:pos]+key+others[pos:]</span><br><span class="line">dayrotors = <span class="built_in">tuple</span>(random.sample(myrotors, <span class="number">3</span>))</span><br><span class="line">tmpkey = <span class="string">&quot;&quot;</span>.join([choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)])</span><br><span class="line">shuffle(letters)</span><br><span class="line">plugin = <span class="string">&quot; &quot;</span>.join([letters[<span class="number">2</span>*i]+letters[<span class="number">2</span>*i+<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line">myEnigma = enigma.Enigma(myReflector, *dayrotors, tmpkey, plugin)</span><br><span class="line">ctx = myEnigma.encipher(text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################################## dfs</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">plug</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ascii_uppercase:</span><br><span class="line">        <span class="keyword">if</span>(plug.count(i) &gt;= <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">idx, rotors, XYZ, a, b, d, plug</span>):</span><br><span class="line">    temp_Enigma = enigma.Enigma(myReflector, *rotors, XYZ)</span><br><span class="line">    temp_msg = <span class="string">&quot;A&quot;</span>*idx + b</span><br><span class="line">    c = (temp_Enigma.encipher(temp_msg))[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(plug[<span class="built_in">ord</span>(c)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] == <span class="string">&quot;*&quot;</span> <span class="keyword">or</span> plug[<span class="built_in">ord</span>(c)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] == d):</span><br><span class="line">        <span class="keyword">return</span> c, <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> c, <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">idx, rotors, XYZ, plug</span>):</span><br><span class="line">    <span class="keyword">if</span>(check(plug) == <span class="literal">False</span>):</span><br><span class="line">        <span class="keyword">return</span>    </span><br><span class="line">    <span class="keyword">if</span>(idx == <span class="number">17</span>):</span><br><span class="line">        <span class="built_in">print</span>(plug)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    temp_plug = copy.deepcopy(plug)</span><br><span class="line"></span><br><span class="line">    a = pt[idx]</span><br><span class="line">    d = ct[idx]</span><br><span class="line">    <span class="keyword">if</span>(plug[<span class="built_in">ord</span>(a)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] != <span class="string">&quot;*&quot;</span>):</span><br><span class="line">        b = plug[<span class="built_in">ord</span>(a)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(plug[<span class="built_in">ord</span>(b)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] != a <span class="keyword">and</span> plug[<span class="built_in">ord</span>(b)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] != <span class="string">&quot;*&quot;</span>):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        c, res = test(idx, rotors, XYZ, a, b, d, plug)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(res == <span class="literal">True</span>):</span><br><span class="line">            temp_plug[<span class="built_in">ord</span>(a)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = b</span><br><span class="line">            temp_plug[<span class="built_in">ord</span>(b)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = a</span><br><span class="line">            temp_plug[<span class="built_in">ord</span>(c)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = d</span><br><span class="line">            temp_plug[<span class="built_in">ord</span>(d)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = c</span><br><span class="line">            find(idx+<span class="number">1</span>, rotors, XYZ, temp_plug)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> ascii_uppercase:</span><br><span class="line">            <span class="keyword">if</span>(plug[<span class="built_in">ord</span>(b)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] != <span class="string">&quot;*&quot;</span>):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            c, res = test(idx, rotors, XYZ, a, b, d, plug)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(res == <span class="literal">True</span>):</span><br><span class="line">                temp_plug[<span class="built_in">ord</span>(a)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = b</span><br><span class="line">                temp_plug[<span class="built_in">ord</span>(b)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = a</span><br><span class="line">                temp_plug[<span class="built_in">ord</span>(c)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = d</span><br><span class="line">                temp_plug[<span class="built_in">ord</span>(d)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = c</span><br><span class="line">                find(idx+<span class="number">1</span>, rotors, XYZ, temp_plug)</span><br><span class="line"></span><br><span class="line">                temp_plug = copy.deepcopy(plug)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################## show right plug config</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">1</span>):</span><br><span class="line">    right = [<span class="string">&quot;*&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        right[<span class="built_in">ord</span>(plugin[<span class="number">3</span>*j+<span class="number">0</span>]) - <span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = plugin[<span class="number">3</span>*j+<span class="number">1</span>]</span><br><span class="line">        right[<span class="built_in">ord</span>(plugin[<span class="number">3</span>*j+<span class="number">1</span>]) - <span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = plugin[<span class="number">3</span>*j+<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">        <span class="keyword">if</span>(right[i] == <span class="string">&#x27;*&#x27;</span>):</span><br><span class="line">            right[i] = <span class="built_in">chr</span>(i+<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################## data</span></span><br><span class="line">pt = text</span><br><span class="line">ct = ctx</span><br><span class="line">key = <span class="string">&quot;THEWEATHERTODAYIS&quot;</span></span><br><span class="line">plug = [<span class="string">&quot;*&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################## assume we know the rotors and tmpkey</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">1</span>):</span><br><span class="line">    find(<span class="number">0</span>, dayrotors, tmpkey, plug)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################## assume we don&#x27;t know the rotors and tmpkey</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    length = <span class="number">26</span>**<span class="number">3</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(product(letters,repeat=<span class="number">3</span>), total=length):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> permutations(myrotors,<span class="number">3</span>):</span><br><span class="line">            i = <span class="string">&quot;&quot;</span>.join(i)</span><br><span class="line">            j = myrotors[:<span class="number">3</span>]</span><br><span class="line">            find(<span class="number">0</span>, j, i, plug)</span><br></pre></td></tr></table></figure>
<p>可以测试出来这样回溯找到正确plug的概率是相当高的，然而问题就在于：他太慢了。测一下要爆的时间得要40h-250h不等（和实际的crib本身结构有关）。</p>
<p>而本身德军用enigma，他们的密钥是一天一换的，所以就算放在当时，我现在写的脚本可能实时性都不够强XD，因此要换思路。</p>
<h6 id="Turing’s-method"><a href="#Turing’s-method" class="headerlink" title="Turing’s method"></a>Turing’s method</h6><p>而图灵用的是一种更巧妙的剪枝思路，具体来说他做了下面的事情：</p>
<ul>
<li><p>我们仍然以刚才的crib为例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">----THEWEATHERTODAYIS--------------------------</span><br><span class="line"></span><br><span class="line">----JWPNHTWXTUYYXUSLJ--------------------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>由于enigma的自反性，crib中的明密文可以在同样的配置下互相加密得到，所以可以先把crib的结构绘制成图：</p>
<p><img src="/post/3ff42458/image-20240909182132058.png" alt="image-20240909182132058"></p>
</li>
<li><p>图中存在很特殊的结构，就是环，比如对于”TJSY”这个环，他是该段crib以下部分的明密文形成的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">----T---------T---Y-S--------------------------</span><br><span class="line"></span><br><span class="line">----J---------Y---S-J--------------------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>利用crib中这种环结构，我们可以进一步简化我们的搜索思路。我们从环的任意一个节点开始，比如T，假设他经过plug变成A，那么此时在给定的配置下，我们可以畅通无阻的跑一遍这个环，直到他回到T，也就是：（小写的字母代表变量）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">      ----T---------T---Y-S--------------------------</span><br><span class="line">plugin    |         |   | |</span><br><span class="line">      ----A---------r---q-p--------------------------</span><br><span class="line">enigma    |         |   | |</span><br><span class="line">      ----o---------q---p-o--------------------------</span><br><span class="line">plugin    |         |   | |</span><br><span class="line">      ----J---------Y---S-J--------------------------</span><br></pre></td></tr></table></figure>
<p>为什么说畅通无阻呢？因为我们假设plugin存在”TA”后，假设A经过给定配置的enigma会得到o，那么plugin就一定会有”Jo”，o又可以用enigma跑出p，就一定有”Sp”，如此类推，最后从上图中的第二个链条可以得到一个”Tr”。</p>
<p>那么，按照我们的推断，这个r一定得是A才行，否则说明我们的推断出错了。</p>
</li>
<li><p>这个环结构的好处在于，我们绕过了J、Y、S的plugin设置，只需要讨论T的同时，就可以知道J、Y、S的哪些plugin设置才是合理的。</p>
</li>
<li><p>而又因为enigma的自反性，一旦推出矛盾项，可以说明整个逻辑链条上的所有plugin设置都是不合理的。比如我们以假设”TA”开始推测，一路推测出”RJ”、”SE”、”XY”，最后产生矛盾的”TB”，这代表”TA”、”RJ”、”SE”、”XY”、”TB”都一定是不合理的，所以我们下一次推测就不需要再讨论”TB”了，从”TC”开始就行。</p>
</li>
</ul>
<p>然而对于一个环来说，即使我们当前爆破的enigma参数推的不正确，对于环依然是有一定概率存在字母，使得其不产生矛盾的。而这个概率直观来看也就是1/26。</p>
<p>而我们要爆破的enigma配置参数范围是：</p>
<script type="math/tex; mode=display">
60 \cdot 26^3 = 1054560 \approx  2^{21}</script><p>所以要想可能的plugin越少，就需要crib的环尽可能多，如果crib有三个环乃至四个环，那么得到的plugin就越少，就越可能正确。</p>
<p>因此如果从题目角度看，多roll一些crib，然后挑选其中环多一些的去爆破应该耗时会少很多，准确率也更高，用代码测试一下要roll到四个环及以上也并不需要太多次数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyenigma <span class="keyword">import</span> rotor </span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_uppercase</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pyenigma <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">myReflector=rotor.Reflector(<span class="string">&#x27;WOEHCKYDMTFRIQBZNLVJXSAUGP&#x27;</span>,<span class="string">&quot;myReflector&quot;</span>)</span><br><span class="line">myrotor1=rotor.Rotor(<span class="string">&#x27;UHQAOFBEPIKZSXNCWLGJMVRYDT&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor1&quot;</span>)</span><br><span class="line">myrotor2=rotor.Rotor(<span class="string">&#x27;RIKHFBUJDNCGWSMZVXEQATOLYP&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor2&quot;</span>)</span><br><span class="line">myrotor3=rotor.Rotor(<span class="string">&#x27;ENQXUJSIVGOMRLHYCDKTPWAFZB&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor3&quot;</span>)</span><br><span class="line">myrotor4=rotor.Rotor(<span class="string">&#x27;JECGYWNDPQUSXZMKHRLTAVFOIB&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor4&quot;</span>)</span><br><span class="line">myrotor5=rotor.Rotor(<span class="string">&#x27;EYDBNSFAPJTMGURLOIWCHXQZKV&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor5&quot;</span>)</span><br><span class="line">myrotors=[myrotor1,myrotor2,myrotor3,myrotor4,myrotor5]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####################### find some rings</span></span><br><span class="line">count1 = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="comment">########################################################## gen</span></span><br><span class="line">    letters = <span class="built_in">list</span>(ascii_uppercase)</span><br><span class="line">    key = <span class="string">&quot;THEWEATHERTODAYIS&quot;</span></span><br><span class="line">    text = key</span><br><span class="line">    dayrotors = [myrotors[<span class="number">0</span>],myrotors[<span class="number">1</span>],myrotors[<span class="number">2</span>]]</span><br><span class="line"></span><br><span class="line">    tmpkey = <span class="string">&quot;&quot;</span>.join([choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)])</span><br><span class="line">    shuffle(letters)</span><br><span class="line"></span><br><span class="line">    ttttt = [letters[<span class="number">2</span>*i]+letters[<span class="number">2</span>*i+<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">    plugin = <span class="string">&quot; &quot;</span>.join(ttttt)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ascii_uppercase:</span><br><span class="line">        <span class="keyword">if</span>(i <span class="keyword">not</span> <span class="keyword">in</span> plugin):</span><br><span class="line">            ttttt.append(i+i)</span><br><span class="line">    myEnigma = enigma.Enigma(myReflector, *dayrotors, tmpkey, plugin)</span><br><span class="line">    ctx = myEnigma.encipher(text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">########################################################## test </span></span><br><span class="line">    <span class="comment">############################################ find ring</span></span><br><span class="line">    pt = text</span><br><span class="line">    ct = ctx</span><br><span class="line">    rings = []</span><br><span class="line">    pair = [pt,ct]</span><br><span class="line"></span><br><span class="line">    G = nx.Graph()</span><br><span class="line">    G.add_edges_from([(pt[i],ct[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>)])</span><br><span class="line">    cycles = nx.simple_cycles(G)</span><br><span class="line">    rings = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cycles:</span><br><span class="line">        rings.append(i)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(rings) &gt;= <span class="number">4</span>):</span><br><span class="line">        <span class="built_in">print</span>(rings)</span><br><span class="line">        <span class="built_in">print</span>(count1)</span><br><span class="line">        <span class="built_in">print</span>(pt)</span><br><span class="line">        <span class="built_in">print</span>(ct)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    count1 += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>那么接下来就实现一下这种基于多环的dfs：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyenigma <span class="keyword">import</span> rotor </span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_uppercase</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pyenigma <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">myReflector=rotor.Reflector(<span class="string">&#x27;WOEHCKYDMTFRIQBZNLVJXSAUGP&#x27;</span>,<span class="string">&quot;myReflector&quot;</span>)</span><br><span class="line">myrotor1=rotor.Rotor(<span class="string">&#x27;UHQAOFBEPIKZSXNCWLGJMVRYDT&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor1&quot;</span>)</span><br><span class="line">myrotor2=rotor.Rotor(<span class="string">&#x27;RIKHFBUJDNCGWSMZVXEQATOLYP&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor2&quot;</span>)</span><br><span class="line">myrotor3=rotor.Rotor(<span class="string">&#x27;ENQXUJSIVGOMRLHYCDKTPWAFZB&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor3&quot;</span>)</span><br><span class="line">myrotor4=rotor.Rotor(<span class="string">&#x27;JECGYWNDPQUSXZMKHRLTAVFOIB&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor4&quot;</span>)</span><br><span class="line">myrotor5=rotor.Rotor(<span class="string">&#x27;EYDBNSFAPJTMGURLOIWCHXQZKV&#x27;</span>,<span class="string">&quot;A&quot;</span>,name=<span class="string">&quot;myrotor5&quot;</span>)</span><br><span class="line">myrotors=[myrotor1,myrotor2,myrotor3,myrotor4,myrotor5]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####################### find some rings</span></span><br><span class="line">count1 = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="comment">########################################################## gen</span></span><br><span class="line">    letters = <span class="built_in">list</span>(ascii_uppercase)</span><br><span class="line">    key = <span class="string">&quot;THEWEATHERTODAYIS&quot;</span></span><br><span class="line">    text = key</span><br><span class="line">    dayrotors = [myrotors[<span class="number">0</span>],myrotors[<span class="number">1</span>],myrotors[<span class="number">2</span>]]</span><br><span class="line"></span><br><span class="line">    tmpkey = <span class="string">&quot;&quot;</span>.join([choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)])</span><br><span class="line">    shuffle(letters)</span><br><span class="line"></span><br><span class="line">    plugin = <span class="string">&quot; &quot;</span>.join([letters[<span class="number">2</span>*i]+letters[<span class="number">2</span>*i+<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line">    myEnigma = enigma.Enigma(myReflector, *dayrotors, tmpkey, plugin)</span><br><span class="line">    ctx = myEnigma.encipher(text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">########################################################## test </span></span><br><span class="line">    <span class="comment">############################################ find ring</span></span><br><span class="line">    pt = text</span><br><span class="line">    ct = ctx</span><br><span class="line">    rings = []</span><br><span class="line">    pair = [pt,ct]</span><br><span class="line"></span><br><span class="line">    G = nx.Graph()</span><br><span class="line">    G.add_edges_from([(pt[i],ct[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>)])</span><br><span class="line">    cycles = nx.simple_cycles(G)</span><br><span class="line">    rings = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cycles:</span><br><span class="line">        rings.append(i)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">####################### choose ring nums &gt;= 10 to avoid collision</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(rings) &gt;= <span class="number">8</span>):</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">            <span class="built_in">print</span>(rings)</span><br><span class="line">            <span class="built_in">print</span>(count1)</span><br><span class="line">            <span class="built_in">print</span>(pt)</span><br><span class="line">            <span class="built_in">print</span>(ct)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    count1 += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################## add idx to ring</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_idx_to_ring</span>(<span class="params">ring</span>):</span><br><span class="line">    temp_ring = <span class="number">2</span>*ring</span><br><span class="line">    idx_ring = []</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    temp_pair = temp_ring[<span class="number">0</span>] + temp_ring[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>):</span><br><span class="line">            <span class="keyword">if</span>(pt[i] + ct[i] == temp_pair <span class="keyword">or</span> pt[i] + ct[i] == temp_pair[::-<span class="number">1</span>]):</span><br><span class="line">                idx_ring.append([ring[idx],i])</span><br><span class="line">                idx += <span class="number">1</span></span><br><span class="line">                temp_pair = temp_ring[idx] + temp_ring[idx+<span class="number">1</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(idx_ring) == <span class="built_in">len</span>(ring)):</span><br><span class="line">            <span class="keyword">return</span> idx_ring</span><br><span class="line"></span><br><span class="line">idx_rings = []</span><br><span class="line"><span class="keyword">for</span> ring <span class="keyword">in</span> rings:</span><br><span class="line">    idx_rings.append(add_idx_to_ring(ring))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(idx_rings)):</span><br><span class="line">    idx_rings[i] = idx_rings[i] + [idx_rings[i][<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################## dfs</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">plug</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ascii_uppercase:</span><br><span class="line">        <span class="keyword">if</span>(plug.count(i) &gt;= <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">record_bad_plug</span>(<span class="params">plug</span>):</span><br><span class="line">    <span class="keyword">global</span> bad_plug_dic</span><br><span class="line">    <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">enumerate</span>(plug):</span><br><span class="line">        <span class="keyword">if</span>(j == <span class="string">&quot;*&quot;</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        x,y = <span class="built_in">chr</span>(i+<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)), j</span><br><span class="line">        <span class="keyword">if</span>(y <span class="keyword">in</span> bad_plug_dic[x]):</span><br><span class="line">            bad_plug_dic[x].remove(y)</span><br><span class="line">        <span class="keyword">if</span>(x <span class="keyword">in</span> bad_plug_dic[y]):</span><br><span class="line">            bad_plug_dic[y].remove(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_ring</span>(<span class="params">a, b, ring, rotors, XYZ, plug</span>):</span><br><span class="line">    checkb = b</span><br><span class="line">    temp_plug = copy.deepcopy(plug)</span><br><span class="line"></span><br><span class="line">    temp_plug[<span class="built_in">ord</span>(a)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = b</span><br><span class="line">    temp_plug[<span class="built_in">ord</span>(b)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = a</span><br><span class="line"></span><br><span class="line">    pin = <span class="number">0</span></span><br><span class="line">    idx = ring[pin][<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        temp_Enigma = enigma.Enigma(myReflector, *rotors, XYZ)</span><br><span class="line">        temp_msg = <span class="string">&quot;A&quot;</span>*idx + b</span><br><span class="line">        c = (temp_Enigma.encipher(temp_msg))[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        pin = pin + <span class="number">1</span></span><br><span class="line">        d = ring[pin][<span class="number">0</span>]</span><br><span class="line">        idx = ring[pin][<span class="number">1</span>]</span><br><span class="line">        b = c</span><br><span class="line"></span><br><span class="line">        temp_plug[<span class="built_in">ord</span>(c)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = d</span><br><span class="line">        temp_plug[<span class="built_in">ord</span>(d)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = c</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(pin == <span class="built_in">len</span>(ring) - <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span>(checkb == b):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span>, temp_plug</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                record_bad_plug(temp_plug)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span>, temp_plug</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">rings, plug ,rotors, XYZ</span>):</span><br><span class="line">    <span class="keyword">if</span>(check(plug) == <span class="literal">False</span>):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(rings == []):</span><br><span class="line">        <span class="built_in">print</span>(plug)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    ring = rings[<span class="number">0</span>]</span><br><span class="line">    a = ring[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    temp_plug = copy.deepcopy(plug)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(plug[<span class="built_in">ord</span>(a)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] != <span class="string">&quot;*&quot;</span>):</span><br><span class="line">        b = plug[<span class="built_in">ord</span>(a)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)]</span><br><span class="line">        res, temp_plug = check_ring(a, b, ring, rotors, XYZ, temp_plug)</span><br><span class="line">        <span class="keyword">if</span>(res == <span class="literal">True</span>):</span><br><span class="line">            find(rings[<span class="number">1</span>:], temp_plug, rotors, XYZ)</span><br><span class="line">            temp_plug = copy.deepcopy(plug)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            temp_plug = copy.deepcopy(plug)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        temp = copy.deepcopy(bad_plug_dic[a])</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> temp:</span><br><span class="line">            res, temp_plug = check_ring(a, b, ring, rotors, XYZ, temp_plug)</span><br><span class="line">            <span class="keyword">if</span>(res == <span class="literal">True</span>):</span><br><span class="line">                find(rings[<span class="number">1</span>:], temp_plug, rotors, XYZ)</span><br><span class="line">            temp_plug = copy.deepcopy(plug)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment">########################################## show right plug config</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">1</span>):</span><br><span class="line">    right = [<span class="string">&quot;*&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        right[<span class="built_in">ord</span>(plugin[<span class="number">3</span>*j+<span class="number">0</span>]) - <span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = plugin[<span class="number">3</span>*j+<span class="number">1</span>]</span><br><span class="line">        right[<span class="built_in">ord</span>(plugin[<span class="number">3</span>*j+<span class="number">1</span>]) - <span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>)] = plugin[<span class="number">3</span>*j+<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">        <span class="keyword">if</span>(right[i] == <span class="string">&#x27;*&#x27;</span>):</span><br><span class="line">            right[i] = <span class="built_in">chr</span>(i+<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plug = [<span class="string">&quot;*&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)]</span><br><span class="line"><span class="comment">########################################## assume we know the rotors and tmpkey</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    bad_plug_dic = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ascii_uppercase:</span><br><span class="line">        bad_plug_dic[i] = [t <span class="keyword">for</span> t <span class="keyword">in</span> ascii_uppercase]</span><br><span class="line">    find(idx_rings, plug, dayrotors, tmpkey)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################## assume we don&#x27;t know the rotors and tmpkey</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">1</span>):</span><br><span class="line">    length = <span class="number">26</span>**<span class="number">3</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(product(letters,repeat=<span class="number">3</span>), total=length):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> permutations(myrotors,<span class="number">3</span>):</span><br><span class="line">            bad_plug_dic = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> tt <span class="keyword">in</span> ascii_uppercase:</span><br><span class="line">                bad_plug_dic[tt] = [t <span class="keyword">for</span> t <span class="keyword">in</span> ascii_uppercase]</span><br><span class="line">            i = <span class="string">&quot;&quot;</span>.join(i)</span><br><span class="line">            j = myrotors[:<span class="number">3</span>]</span><br><span class="line">            find(idx_rings, plug, j, i)</span><br></pre></td></tr></table></figure>
<p>这个脚本耗时就相对来说能接受很多了，爆破完所有一般只需要一小时以内，对于赛题来说，不管是多进程还是直接多次交互赌一个起始刻度都可以控制时间在150s内。</p>
<p>注意两点：</p>
<ul>
<li>上面控制了一直到roll出环数量大于等于8才开始搜索，不然可能的plugin会有点多。</li>
<li>最后得到的plugin貌似还是缺一些字符配对，不过我们可以有多种处理方式：<ul>
<li>1.对有输出的rotors及配置，再进行一次刚才低效率的彻底的深搜</li>
<li>2.直接爆破剩余的字符，这个复杂度并不大</li>
</ul>
</li>
</ul>
<p>不得不说这个破译真的很艺术，奈何码力不够强，比赛中知道破译手段但是码不出来，还是要多练习。</p>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/3ff42458.html" title="2024-WMCTF-wp-crypto">https://tangcuxiaojikuai.xyz/post/3ff42458.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/6452f9a0.html" rel="prev" title="2024-熵密杯-wp-crypto">
      <i class="fa fa-chevron-left"></i> 2024-熵密杯-wp-crypto
    </a></div>
      <div class="post-nav-item">
    <a href="/post/6d3f5803.html" rel="next" title="2024-江西省第三届天使杯网络安全技能大赛线上预选赛-wp-crypto">
      2024-江西省第三届天使杯网络安全技能大赛线上预选赛-wp-crypto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#K-Cessation"><span class="nav-number">1.</span> <span class="nav-text">K-Cessation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FACRT"><span class="nav-number">2.</span> <span class="nav-text">FACRT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RSA"><span class="nav-number">3.</span> <span class="nav-text">RSA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-O-N-N-E-C-T-1-0-N"><span class="nav-number">4.</span> <span class="nav-text">C O N N E C T 1 0 N</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Turing"><span class="nav-number">5.</span> <span class="nav-text">*Turing</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%84%E6%88%90"><span class="nav-number">5.1.</span> <span class="nav-text">组成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%86%E9%92%A5"><span class="nav-number">5.2.</span> <span class="nav-text">密钥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86"><span class="nav-number">5.3.</span> <span class="nav-text">加密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%A7%E8%B4%A8"><span class="nav-number">5.4.</span> <span class="nav-text">性质</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE"><span class="nav-number">5.5.</span> <span class="nav-text">题目</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%81%A2%E5%A4%8Dtext%E4%B8%AD%E7%9A%84key"><span class="nav-number">5.5.1.</span> <span class="nav-text">恢复text中的key</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%81%A2%E5%A4%8Denigma%E7%9A%84%E5%AF%86%E9%92%A5"><span class="nav-number">5.5.2.</span> <span class="nav-text">恢复enigma的密钥</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%95%88%E7%8E%87%E5%BE%88%E4%BD%8E%E7%9A%84dfs"><span class="nav-number">5.5.2.1.</span> <span class="nav-text">效率很低的dfs</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Turing%E2%80%99s-method"><span class="nav-number">5.5.2.2.</span> <span class="nav-text">Turing’s method</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">118</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tangcuxiaojikuai" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tangcuxiaojikuai" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
