<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="期末总算过去了，终于有时间来更新更新已经过去了大半个月的CryptoCTF。这次比赛和认识的一些师傅一起组了个小队cyberCryer，最后拿到了第二名：  虽然说这次比赛的一些题目实在有点无力吐槽，但是比赛中途大家一起加班加点肝题的乐趣是实打实的，再次感谢cyberCryer的各位师傅。( つ•̀ω•́)つ 由于大家一起在做题，所以部分题目的wp是我赛后复现的，并不一定是做题的师傅的思路。同时我">
<meta property="og:type" content="article">
<meta property="og:title" content="2024-CryptoCTF-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/cf09b856.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="期末总算过去了，终于有时间来更新更新已经过去了大半个月的CryptoCTF。这次比赛和认识的一些师傅一起组了个小队cyberCryer，最后拿到了第二名：  虽然说这次比赛的一些题目实在有点无力吐槽，但是比赛中途大家一起加班加点肝题的乐趣是实打实的，再次感谢cyberCryer的各位师傅。( つ•̀ω•́)つ 由于大家一起在做题，所以部分题目的wp是我赛后复现的，并不一定是做题的师傅的思路。同时我">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240630091043812.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240630113251927.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701095249427.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701095316721.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701103055895.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701103126855.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701103144061.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701103159097.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701103349848.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701103950864.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701104026332.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701104109464.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701141056368.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701141412956.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701141459600.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701141537346.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240701141559738.png">
<meta property="article:published_time" content="2024-07-01T07:48:40.000Z">
<meta property="article:modified_time" content="2024-07-01T09:51:29.085Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tangcuxiaojikuai.xyz/post/cf09b856/image-20240630091043812.png">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/cf09b856.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2024-CryptoCTF-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/cf09b856.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2024-CryptoCTF-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-07-01 15:48:40 / 修改时间：17:51:29" itemprop="dateCreated datePublished" datetime="2024-07-01T15:48:40+08:00">2024-07-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/cf09b856.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/cf09b856.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>期末总算过去了，终于有时间来更新更新已经过去了大半个月的CryptoCTF。这次比赛和认识的一些师傅一起组了个小队cyberCryer，最后拿到了第二名：</p>
<p><img src="/post/cf09b856/image-20240630091043812.png" alt="image-20240630091043812"></p>
<p>虽然说这次比赛的一些题目实在有点无力吐槽，但是比赛中途大家一起加班加点肝题的乐趣是实打实的，再次感谢cyberCryer的各位师傅。( つ•̀ω•́)つ</p>
<p>由于大家一起在做题，所以部分题目的wp是我赛后复现的，并不一定是做题的师傅的思路。同时我也记录了一些比赛中的有趣的动态，留作纪念。</p>
<span id="more"></span>
<h2 id="队伍其他师傅的wp指路："><a href="#队伍其他师傅的wp指路：" class="headerlink" title="队伍其他师傅的wp指路："></a>队伍其他师傅的wp指路：</h2><p>Zima：<a target="_blank" rel="noopener" href="https://www.zimablue.life/article/cctf2024_1.html">CRYPTOCTF2024(part1) | Zimablue’ Blog</a></p>
<p>……</p>
<p><br></p>
<p><br></p>
<h2 id="Warm-up"><a href="#Warm-up" class="headerlink" title="Warm-up"></a>Warm-up</h2><h3 id="Welcome-👋-367-solves-27-pts"><a href="#Welcome-👋-367-solves-27-pts" class="headerlink" title="Welcome! 👋(367 solves , 27 pts)"></a>Welcome! 👋(367 solves , 27 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">We are excited that you will be participating in 6th CryptoCTF, an engaging online event focused on challenging and improving your cryptography abilities. You&#x27;ll have the opportunity to dive into the captivating realm of ciphers, codes, and modern cryptosystems. 💪 ⚡ 💥 🔥</span><br></pre></td></tr></table></figure>
<p>直接交：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag: CCTF&#123;Harn3sS_Y0ur_CrYptO9rAphy_Pr0wEs5_💪_⚡_💥_🔥!&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="Easy"><a href="#Easy" class="headerlink" title="Easy"></a>Easy</h2><h3 id="Alibos-181-solves-36-pts"><a href="#Alibos-181-solves-36-pts" class="headerlink" title="Alibos(181 solves , 36 pts)"></a>Alibos(181 solves , 36 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Alibos, a classic cryptographic algorithm, is designed to safeguard non-sensitive data, providing a reliable solution for routine information protection.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> d, flag</span><br><span class="line"></span><br><span class="line">get_context().precision = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">m, d</span>):</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">str</span>(m)) &lt; d:</span><br><span class="line">		m = <span class="built_in">str</span>(m) + <span class="string">&#x27;1&#x27;</span> * (d - <span class="built_in">len</span>(<span class="built_in">str</span>(m)))</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">int</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">d</span>):</span><br><span class="line">	skey = getRandomRange(<span class="number">10</span> ** (d - <span class="number">1</span>), <span class="number">10</span> ** d)</span><br><span class="line">	pkey = <span class="built_in">int</span>(<span class="number">10</span>**d * (sqrt(skey) - floor(sqrt(skey))))</span><br><span class="line">	<span class="keyword">return</span> pkey, skey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, pkey</span>):</span><br><span class="line">	m = pad(m, <span class="built_in">len</span>(<span class="built_in">str</span>(pkey)))</span><br><span class="line">	d = <span class="built_in">len</span>(<span class="built_in">str</span>(pkey))</span><br><span class="line">	c = (pkey + d ** <span class="number">2</span> * m) % (<span class="number">10</span> ** d)</span><br><span class="line">	<span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">pkey, skey = genkey(d)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = encrypt(m, pkey)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;pkey = <span class="subst">&#123;pkey&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc  = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>output.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pkey = 8582435512564229286688465405009040056856016872134514945016805951785759509953023638490767572236748566493023965794194297026085882082781147026501124183913218900918532638964014591302221504335115379744625749001902791287122243760312557423006862735120339132655680911213722073949690947638446354528576541717311700749946777</span><br><span class="line">enc  = 6314597738211377086770535291073179315279171595861180001679392971498929017818237394074266448467963648845725270238638741470530326527225591470945568628357663345362977083408459035746665948779559824189070193446347235731566688204757001867451307179564783577100125355658166518394135392082890798973020986161756145194380336</span><br></pre></td></tr></table></figure>
<p>题目含有一个未知的量d，利用这个d生成了随机的skey和pkey，然后按如下方式加密：</p>
<script type="math/tex; mode=display">
c = pkey + d^2(pad(m)) \quad(mod\;10^d)</script><p>然而仔细看的话会发现加密式子里的d实际上是pkey的字符串长度，所以可以直接解出m然后去掉pad就行。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">pkey = <span class="number">8582435512564229286688465405009040056856016872134514945016805951785759509953023638490767572236748566493023965794194297026085882082781147026501124183913218900918532638964014591302221504335115379744625749001902791287122243760312557423006862735120339132655680911213722073949690947638446354528576541717311700749946777</span></span><br><span class="line">enc  = <span class="number">6314597738211377086770535291073179315279171595861180001679392971498929017818237394074266448467963648845725270238638741470530326527225591470945568628357663345362977083408459035746665948779559824189070193446347235731566688204757001867451307179564783577100125355658166518394135392082890798973020986161756145194380336</span></span><br><span class="line"></span><br><span class="line">d = <span class="built_in">len</span>(<span class="built_in">str</span>(pkey))</span><br><span class="line">m = (enc - pkey)*inverse(d**<span class="number">2</span>,<span class="number">10</span>**d) % <span class="number">10</span>**d</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">300</span>):</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">int</span>(<span class="built_in">str</span>(m)[:-i]))</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">b&quot;CCTF&quot;</span> <span class="keyword">in</span> flag):</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;h0M3_m4De_cRyp70_5ySTeM_1N_CryptoCTF!!!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Beheaded-32-solves-131-pts"><a href="#Beheaded-32-solves-131-pts" class="headerlink" title="Beheaded(32 solves , 131 pts)"></a>Beheaded(32 solves , 131 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The beheaded flags have had their headers removed, making them encrypted. Can a living entity truly survive without a head?</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> secrets.sh</span><br><span class="line"></span><br><span class="line">FLAGS=<span class="string">&quot;all_flags.txt&quot;</span></span><br><span class="line"><span class="built_in">rm</span> -f <span class="string">&quot;all_flags.enc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> flag; <span class="keyword">do</span></span><br><span class="line">	magick -background white -fill blue -pointsize 72 -size <span class="string">&quot;<span class="variable">$X</span>&quot;</span>x<span class="string">&quot;<span class="variable">$Y</span>&quot;</span> -gravity North caption:<span class="string">&quot;<span class="variable">$flag</span>&quot;</span> flag.ppm</span><br><span class="line">	<span class="built_in">tail</span> -n +4 flag.ppm &gt; <span class="built_in">tail</span></span><br><span class="line">	openssl enc -aes-256-ecb -pbkdf2 -nosalt -pass pass:<span class="string">&quot;<span class="variable">$KEY</span>&quot;</span> -<span class="keyword">in</span> <span class="built_in">tail</span> &gt;&gt; <span class="string">&quot;all_flags.enc&quot;</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="string">&quot;<span class="variable">$FLAGS</span>&quot;</span></span><br></pre></td></tr></table></figure>
<p>题目将flag串写在图片上，然后对这张图片进行ECB加密，最后得到密文文件。</p>
<p>原理的话其实并不复杂，对于一张图片来说，其分为了很多色块，而由于是ECB加密，所以对于相同的色块(也就是背景色)，其密文也一定是相同的，而这也说明一点——不是背景色块密文的地方，就一定有内容。所以可以统计密文来大致还原轮廓。而对于这个题目来讲，其就是把文字写在图片上的图片，所以还原轮廓就等于还原flag。</p>
<p>不过具体操作上应该还是挺有讲究，比如ppm格式、加密分组怎么对应色块等我都不是很清楚，但<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ZimaBlue">@Zima</a>正好了解这些，就用了一个工具直接把他梭掉了。</p>
<p><br></p>
<h3 id="Mashy-68-solves-71-pts"><a href="#Mashy-68-solves-71-pts" class="headerlink" title="Mashy(68 solves , 71 pts)"></a>Mashy(68 solves , 71 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mashy may seem like a simple cracking task, but you&#x27;ll need to open your eyes to identify the right things to crack.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> salt, flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>():</span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">s1, s2</span>):</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">bytes</span>([s1[_] ^ s2[_] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s1))])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;┃&quot;</span></span><br><span class="line">	pr(        <span class="string">&quot;┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓&quot;</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;.: Hi all, she did Mashy, you should do it too! Are you ready? :. &quot;</span>, border)</span><br><span class="line">	pr(        <span class="string">&quot;┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛&quot;</span>)</span><br><span class="line"></span><br><span class="line">	REC = []</span><br><span class="line">	cnt, STEP = <span class="number">0</span>, <span class="number">7</span></span><br><span class="line">	sh = md5(salt).digest()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		pr(border, <span class="string">f&#x27;Please send your first input:  &#x27;</span>)</span><br><span class="line">		d1 = sc().strip()</span><br><span class="line">		pr(border, <span class="string">f&#x27;Please send your second input: &#x27;</span>)</span><br><span class="line">		d2 = sc().strip()</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			d1 = hexlify(unhexlify(d1))</span><br><span class="line">			d2 = hexlify(unhexlify(d2))</span><br><span class="line">			h1 = md5(unhexlify(d1)).digest()</span><br><span class="line">			h2 = md5(unhexlify(d2)).digest()</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;Your inputs are not valid! Bye!!!&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span> d1 != d2 <span class="keyword">and</span> d1 <span class="keyword">not</span> <span class="keyword">in</span> REC <span class="keyword">and</span> d2 <span class="keyword">not</span> <span class="keyword">in</span> REC:</span><br><span class="line">			<span class="keyword">if</span> md5(xor(d1, d2)).hexdigest() != <span class="string">&#x27;ae09d7510659ca40eda3e45ca70e9606&#x27;</span>:</span><br><span class="line">				<span class="keyword">if</span> hexlify(xor(xor(h1, h2), sh)) == <span class="string">b&#x27;a483b30944cbf762d4a3afc154aad825&#x27;</span>:</span><br><span class="line">					REC += [d1, d2]</span><br><span class="line">					<span class="keyword">if</span> cnt == STEP:</span><br><span class="line">						die(border, <span class="string">f&#x27;Congrats! the flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">					pr(border, <span class="string">&#x27;Good job, try next level :P&#x27;</span>)</span><br><span class="line">					cnt += <span class="number">1</span></span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					die(border, <span class="string">&#x27;Your input is not correct! Bye!&#x27;</span>)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				die(border, <span class="string">&#x27;No this one! Sorry!!&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;Kidding me!? Bye!!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>这个题总的来说要完成七轮挑战，每一轮都需要输入两个十六进制串d1、d2，靶机会计算他们的md5值h1、h2，这些值如果满足以下要求就可以通过本轮挑战：</p>
<ul>
<li><p>d1不等于d2</p>
</li>
<li><p>d1、d2之前没有输入过</p>
</li>
<li><p>$d_1 \oplus d_2$的md5值不为’ae09d7510659ca40eda3e45ca70e9606’</p>
</li>
<li><p>$h_1 \oplus h_2 \oplus sh$的值为’a483b30944cbf762d4a3afc154aad825’，其中sh为(salt未知)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh = md5(salt).digest()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>怎么看都想不通要干什么，首先这个sh是不知道的，所以也就不知道h1异或h2到底要满足什么东西，只知道需要是一个定值；其次就是d1异或d2的md5值也不知道是什么，不过这个还好，仅仅是要求不为多少，很容易就能做到。</p>
<p>一头雾水的时候发现这个题解数蹭蹭涨，所以盲猜应该只是个md5的碰撞，也就是让d1、d2不等的情况下h1、h2相等，这也就意味着sh就是’a483b30944cbf762d4a3afc154aad825’。上在线网站生成几组前缀碰撞然后交互就好：</p>
<p><a target="_blank" rel="noopener" href="https://rivers.chaitin.cn/tools/md5fastcollision">MD5 在线碰撞 - 百川在线工具箱 (chaitin.cn)</a></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;01.cr.yp.toc.tf&quot;</span>,<span class="number">13771</span>)</span><br><span class="line"></span><br><span class="line">msg = [(<span class="string">b&quot;31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe11ecc10c7ab8b4fe112d7f29ceb2dae1f39ce7a691488bfb817b7685ad087a162b0ce0ea69b140e7274b44c43f183578392f9719b43d4966c321cc0a10e6fbd002869b42f9fad9eb869dc55d5d349835961b1fd36a0bbe76a9bb5f4f5cc54136dec48d74497bf6579a6bf9721b81078637b429cff958886bd816dc4333a338&quot;</span>,<span class="string">b&quot;31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe11ecc10c7ab8b4fe112d7f29ceb2dae1f39c67a691488bfb817b7685ad087a162b0ce0ea69b140e7274b44c4bf183578392f9719b43d4966c3214c0a10e6fbd002869b42f9fad9eb869dc55d5d349835961b9fd36a0bbe76a9bb5f4f5cc54136dec48d74497bf6579a6bf9729b80078637b429cff958886bd8165c4333a338&quot;</span>),</span><br><span class="line">       (<span class="string">b&quot;32000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ebcd0390c198c8f33b4a08cce32f47451b5002e68895b7505d12824a0a460d133de3eff34e4de89ceb27ed3bce211b4696fec6736c059058d8b60f6e473f6c701068abf2d6bc645c4589a6f0f5211f5fc903c96e789d91f8abb300d8176088b7d31d825897c9001cf409c45b3a50005e93e33f4f908f9df944a664c927d28d55&quot;</span>,<span class="string">b&quot;32000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ebcd0390c198c8f33b4a08cce32f47451b5002668895b7505d12824a0a460d133de3eff34e4de89ceb27ed3bcea11b4696fec6736c059058d8b60fee473f6c701068abf2d6bc645c4589a6f0f5211f5fc903c9ee789d91f8abb300d8176088b7d31d825897c9001cf409c45b3ad0ff5d93e33f4f908f9df944a6644927d28d55&quot;</span>),</span><br><span class="line">       (<span class="string">b&quot;3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000068270588dbc19cfe24db79019b0070d1823c4a4d6d816cdb22c2401a32081455e5db01c54c0ccf1b6706f061eec3e58ead12b5173dee55f954f9ac52a1a4bbedc32ab0ee3cae3896f9908a49d38cc5535c6c80661d262e1ec91a8639ecc7e1654086c61bf4cfe7fc6a7378f7809416ef39ae4ccc7fc29570c4c3a51b03fed7b9&quot;</span>,<span class="string">b&quot;3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000068270588dbc19cfe24db79019b0070d1823c4acd6d816cdb22c2401a32081455e5db01c54c0ccf1b6706f061ee43e68ead12b5173dee55f954f9acd2a1a4bbedc32ab0ee3cae3896f9908a49d38cc5535c6c80e61d262e1ec91a8639ecc7e1654086c61bf4cfe7fc6a7378f7801416ef39ae4ccc7fc29570c4c3a59b03fed7b9&quot;</span>),</span><br><span class="line">       (<span class="string">b&quot;3400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000025a80516e996c87574dc568d274da9d2d281b09bbc72f7ef46767961b4a708e969ebffe06a6e0945cbefe2f2fc41d89cb89c2574afb1fdbac5aca131cdf52d68b9e3c95615888cbc3d187ccd32f60d5b35636e925c1aa3002bb330c81b6088d8cbeb8014afc24f5e374ad05ab2f30d1fac7221195b7f3f1f19f5219ecaf948a2&quot;</span>,<span class="string">b&quot;3400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000025a80516e996c87574dc568d274da9d2d281b01bbc72f7ef46767961b4a708e969ebffe06a6e0945cbefe2f2fcc1d89cb89c2574afb1fdbac5aca1b1cdf52d68b9e3c95615888cbc3d187ccd32f60d5b35636e125c1aa3002bb330c81b6088d8cbeb8014afc24f5e374ad05ab2730d1fac7221195b7f3f1f19f5211ecaf948a2&quot;</span>),</span><br><span class="line">       (<span class="string">b&quot;35000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f56f1da5ad57f483059ae0869962f05204f954e2de9d56c55b168139ec372cefb1b307cbe84ce477cbff5df4d40bc46c08ceef8bb18bfc996b3b9fdaa7b72c17ee1cb3491794d6e2ff7d9914525cdf2d88b9314505ef864d201d2b364a6e25ae4d183e738c3c86e53e5ad1a1910c825cb1bcd59b97d1a3cf979668fbac6a138b&quot;</span>,<span class="string">b&quot;35000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f56f1da5ad57f483059ae0869962f05204f95462de9d56c55b168139ec372cefb1b307cbe84ce477cbff5df4d48bc46c08ceef8bb18bfc996b3b9f5aa7b72c17ee1cb3491794d6e2ff7d9914525cdf2d88b931c505ef864d201d2b364a6e25ae4d183e738c3c86e53e5ad1a1918c815cb1bcd59b97d1a3cf9796687bac6a138b&quot;</span>),</span><br><span class="line">       (<span class="string">b&quot;36000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f2b343c2bb614b7b4acc4e0ade8a5e4b2abb4eefe97ef7991832793e4e301637cf0becd84c43dbafeb43d0da12c8e2883e0d02ada60e678e3470ee866abe2fa713b8a521a986e75d821f74221fee2ea441b3ab462f29b56f862b00d05f60cdc1a9a1c92d04457bd6e693673963ab6e6b6c3552cd1c54efe627b342fecdfd8dea&quot;</span>,<span class="string">b&quot;36000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f2b343c2bb614b7b4acc4e0ade8a5e4b2abb4e6fe97ef7991832793e4e301637cf0becd84c43dbafeb43d0da1248e3883e0d02ada60e678e3470ee066abe2fa713b8a521a986e75d821f74221fee2ea441b3abc62f29b56f862b00d05f60cdc1a9a1c92d04457bd6e6936739632b6e6b6c3552cd1c54efe627b3427ecdfd8dea&quot;</span>),</span><br><span class="line">       (<span class="string">b&quot;370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d6afba61c0910b5ca21a9164b65134753b3845080d9afe6460237a1d938a8385204b0e85cce2b686b40d9b9c517e64b08ee01d02fa63470aa3b34c1e550d11356d867ea70e96b0257d9b1b20df1ee22603111180739001ad17bf6c8dd707932b34e97b62e74936197adcc2f93164b46c7c7e4bb7b6c1a55a21958961f7378be&quot;</span>,<span class="string">b&quot;370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d6afba61c0910b5ca21a9164b65134753b384d080d9afe6460237a1d938a8385204b0e85cce2b686b40d9b9c597e64b08ee01d02fa63470aa3b3441e550d11356d867ea70e96b0257d9b1b20df1ee22603111980739001ad17bf6c8dd707932b34e97b62e74936197adcc2f93964a46c7c7e4bb7b6c1a55a21958161f7378be&quot;</span>),</span><br><span class="line">       (<span class="string">b&quot;38000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c6eb639aedf271805029b40d4dc783ab8d769d35cb9032f9184641b94c881615f5f902cb5e8ba3176f2660d4f821828fdbed111365cc4dfbbf001ca884fcb74df4f681c17ed38f53b8346319fee0c2eaecf2ea2597f0ca2c04ed6c064e9e3ddd7d37ff3e54908e889a58455a8fd411bc0f75e93cadc453f6f89d16e8cd8e7c2a&quot;</span>,<span class="string">b&quot;38000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c6eb639aedf271805029b40d4dc783ab8d769db5cb9032f9184641b94c881615f5f902cb5e8ba3176f2660d4f8a1828fdbed111365cc4dfbbf001c2884fcb74df4f681c17ed38f53b8346319fee0c2eaecf2eaa597f0ca2c04ed6c064e9e3ddd7d37ff3e54908e889a58455a8f5411bc0f75e93cadc453f6f89d1668cd8e7c2a&quot;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    sh.sendline(msg[i][<span class="number">0</span>])</span><br><span class="line">    sh.sendline(msg[i][<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&quot;Congrats! the flag: &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sh.recvline())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;mD5_h4Sh_cOlL!Si0N_CrYp7o_ch41lEnGe!!!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h2><h3 id="Ahoo-29-solves-142-pts"><a href="#Ahoo-29-solves-142-pts" class="headerlink" title="Ahoo(29 solves , 142 pts)"></a>Ahoo(29 solves , 142 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ahoo, the swiftest and most graceful gazelle in Iran, is renowned for her unmatched beauty and uncanny ability to evade even the most cunning traps.</span><br></pre></td></tr></table></figure>
<p>没有附件，题目的题意是：</p>
<ul>
<li>给定一个正整数n(大概在几千这个数量级)，要求给出最小的正整数c，使得t=nc的汉明重量最小</li>
</ul>
<p>最开始当然只想到爆破，但是实际效果来说，爆破能够到的范围太小了，很容易出错。之后<a target="_blank" rel="noopener" href="https://yolbby.github.io/">@yolbby</a>想了一个用格的方法，差不多是：</p>
<ul>
<li>把t看作是一个背包，背包里的值是2^k，造格规约出来的短向量就是汉明重量比较小的。</li>
<li><p>这样能找到的c的范围就和格的维数直接相关，比如格大小为256，那么格能找到的最优解就是2^256以内的c，肯定是比爆破要好的</p>
</li>
<li><p>然后再单独处理一下汉明重量可能为2的情况。若汉明重量是2，那么可以写成t = 2^r(2^s+1) = nc，其实也就可以等价成c=2^s+1/n，所以可以再单独找一下比较大的c，就可以大于2^256。</p>
</li>
</ul>
<p>造格似乎有点不太好理解，其实就是利用这个等式：</p>
<script type="math/tex; mode=display">
t = nc</script><p>既然要让t汉明重量较小，所以如果把他用二进制表示的话，系数是很稀疏的，也就是如果写成：</p>
<script type="math/tex; mode=display">
t = a_02^0 + a_12^1 + a_22^2 + ... + a_{256}2^{256}</script><p>那么ai应该很多0，只有极少数是1。</p>
<p>那么把等式移一下项就变成了：</p>
<script type="math/tex; mode=display">
a_02^0 + a_12^1 + a_22^2 + ... + a_{256}2^{256} - cn = 0</script><p>所以就可以造格。</p>
<p>256这个数完全是自己选择的，要平衡一下能找到的范围和格规约的时间才行，选择256代表着可以找到2^256以内的t，大一点查找范围自然也大一些，但是规约就会慢。</p>
<p>上手实现了一下发现确实行，不过仍然有失败的可能，由于要通过20轮，优化了很久都没搞定，最多挂到十五十六轮的样子，所以这肯定不是通法。不过还是把solver发上来留作纪念：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    sh = remote(<span class="string">&quot;00.cr.yp.toc.tf&quot;</span>,<span class="number">17371</span>)</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        sh.recvuntil(<span class="string">b&quot;n = &quot;</span>)</span><br><span class="line">        nn = <span class="built_in">int</span>(sh.recvline().strip().decode().split(<span class="string">&quot;,&quot;</span>)[<span class="number">0</span>])</span><br><span class="line">        n = nn</span><br><span class="line">        <span class="built_in">print</span>(n)</span><br><span class="line">        <span class="keyword">while</span>(n % <span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        nums = <span class="number">256</span></span><br><span class="line">        K = <span class="number">2</span>^<span class="number">100</span></span><br><span class="line">        L = Matrix(ZZ,nums+<span class="number">1</span>,nums+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nums):</span><br><span class="line">            L[i,i] = <span class="number">1</span></span><br><span class="line">            L[i,-<span class="number">1</span>] = <span class="number">2</span>^i*K</span><br><span class="line">        L[-<span class="number">1</span>,-<span class="number">1</span>] = n*K</span><br><span class="line">        res = L.BKZ()</span><br><span class="line"></span><br><span class="line">        mini = <span class="number">2000</span></span><br><span class="line">        c = <span class="number">2</span>^<span class="number">512</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">            temp = i</span><br><span class="line">            ans = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span>((<span class="built_in">all</span>(j &lt;= <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> temp[:-<span class="number">1</span>])) <span class="keyword">or</span> (<span class="built_in">all</span>(j &gt;= <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> temp[:-<span class="number">1</span>]))):</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(temp[:-<span class="number">1</span>])):</span><br><span class="line">                    ans += temp[:-<span class="number">1</span>][k] * <span class="number">2</span>^k</span><br><span class="line">                cc = ans // n</span><br><span class="line">                <span class="keyword">while</span>(cc % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">and</span> cc &gt; <span class="number">0</span>):</span><br><span class="line">                    cc = cc &gt;&gt; <span class="number">1</span></span><br><span class="line">                temp = (<span class="built_in">bin</span>(ans)[<span class="number">2</span>:].count(<span class="string">&quot;1&quot;</span>))</span><br><span class="line">                <span class="keyword">if</span>(temp &lt; mini <span class="keyword">and</span> cc != <span class="number">0</span> <span class="keyword">and</span> cc &gt; <span class="number">0</span>):</span><br><span class="line">                    mini = temp</span><br><span class="line">                    c = cc</span><br><span class="line">                <span class="keyword">elif</span>(temp == mini <span class="keyword">and</span> cc != <span class="number">0</span> <span class="keyword">and</span> cc &gt; <span class="number">0</span> <span class="keyword">and</span> cc &lt; c):</span><br><span class="line">                    mini = temp</span><br><span class="line">                    c = cc</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#check 2</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100000</span>):</span><br><span class="line">            tt = <span class="string">&quot;1&quot;</span> + <span class="string">&quot;0&quot;</span>*i + <span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">int</span>(tt,<span class="number">2</span>) % n == <span class="number">0</span>):</span><br><span class="line">                mini = <span class="number">2</span></span><br><span class="line">                c = <span class="built_in">int</span>(tt,<span class="number">2</span>) // n</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bin</span>(nn*c))</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(mini).encode() + <span class="string">b&quot;,&quot;</span> + <span class="built_in">str</span>(c).encode())</span><br><span class="line"></span><br><span class="line">        sh.sendline(<span class="built_in">str</span>(mini).encode() + <span class="string">b&quot;,&quot;</span> + <span class="built_in">str</span>(c).encode())</span><br><span class="line">        tt = (sh.recvline())</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">b&quot;not&quot;</span> <span class="keyword">in</span> tt):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Not this time&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>()</span><br><span class="line">            sh.close()</span><br><span class="line">            sleep(<span class="number">5</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(sh.recvline())</span><br></pre></td></tr></table></figure>
<p>怎么都优化不出来的时候<a target="_blank" rel="noopener" href="https://wleukocytec.github.io/">@leukocyte</a>登场，他看出这实际上是一个关于同余最短路的算法题，所以直接交给他做，果然很快就秒了。但我的算法功底很烂，所以应该理解不了。</p>
<p>赛后看<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/702904244">春哥的wp</a>发现说可以求出前几项之后上OEIS查数列，就能查到关于通解的论文，以及前10000项的结果，所以可以查表然后发回去。</p>
<p><br></p>
<h3 id="Alilbols-59-solves-80-pts"><a href="#Alilbols-59-solves-80-pts" class="headerlink" title="Alilbols(59 solves , 80 pts)"></a>Alilbols(59 solves , 80 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Alilbols, a modified version of the Alibos cryptographic algorithm, offers enhanced security features to protect sensitive and confidential data.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> d, flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">d</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		f = getRandomRange(<span class="number">1</span>, <span class="built_in">int</span>(sqrt(<span class="number">2</span>) * <span class="number">10</span> ** d))</span><br><span class="line">		g = getRandomRange(<span class="number">10</span> ** d, <span class="built_in">int</span>(sqrt(<span class="number">2</span>) * <span class="number">10</span> ** d))</span><br><span class="line">		<span class="keyword">if</span> gcd(f, <span class="number">10</span> * g) == <span class="number">1</span>:</span><br><span class="line">			q = <span class="number">4</span> * <span class="number">100</span> ** d</span><br><span class="line">			h = inverse(f, q) * g % q</span><br><span class="line">			<span class="keyword">if</span> gcd(h, <span class="number">10</span> * d) == <span class="number">1</span>:</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">	pkey, skey = (d, h), (f, g)</span><br><span class="line">	<span class="keyword">return</span> pkey, skey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, pkey</span>):</span><br><span class="line">	d, h = pkey</span><br><span class="line">	q = <span class="number">4</span> * <span class="number">100</span> ** d</span><br><span class="line">	<span class="keyword">assert</span> m &lt; <span class="number">10</span> ** d</span><br><span class="line">	r = getRandomRange(<span class="number">1</span>, <span class="number">10</span> ** d // <span class="number">2</span>)</span><br><span class="line">	c = (r * h + m + r) % q</span><br><span class="line">	<span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">pkey, _ = genkey(d)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = encrypt(m, pkey)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;h = <span class="subst">&#123;pkey[<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>output.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">h = 1051643987107349427988807326909852110640860009433515828832892541964729933410444984350917250524103015414239941369074041041830326426044333499878031164851095096864048639115431370526747014210332286314344073411522846701723463410585601251886732229726828022089809603850477551571014006202841406236367999378786782206165205893353928598469661871284779486855440579818275314024966224282757807716013799903830828885606714972634243850947534165272668985513949964901606268939300116019465522042467054120201087606016018354238401711720121586874288767235317479748890350702705575809130664969776549574720593740409234863974057904204809404816059921579771581800937241591669455683460570640868196509926763901079838233646036933530095891316054589051458146768287967886035091641162494322987627448810201550901588438560433001422233269632915351406169253963308421081459981594969405377353502889363324282815864766827664453823780238352371809048289845094882346227809082005375092441877966603138648719670349093616548820955566204871333952902983753935678447080673827214244142614295192263451840766771122229866931492260663320087497820892824540996643905125018452302747847009</span><br><span class="line">c = 11913143174789215053772744981113562063689725867199301496294410323568897757042952642806438602327917861884988292757318755590132189620231444302311290566584065812614959093870787195145654508262419270742989923415342357807325941686508030706603920412262004324188375072184983301522882728578077572816154054220606088703932092256905881975876112779175003897105313776239681492514925430817300633974666123599685062340158348009344351002327049272743679109535286730751345284084148118733529966364414749672437370878526710641430471595906340522772252875146681541656231708112317601000655090279925720590940060372738708208419449824043905057860829031242339842131799965043031307394209699264362321397162645220002253271689678364848888381499587038475895945238726252440250183268252483198408039250213490525880829604473555612305513974817850974135874728084839426045420913060975464553734293001460752648937744531874552694145500413222582269910431269597066268600572899619407093373565994271589940926018891922169454906132284552523035481664164354874071831210264979733079749696197917769435226866441989054017071332158916586376454753209296136133271926449919437888563234409</span><br></pre></td></tr></table></figure>
<p>题目仍然是有一个未知的量d，利用这个d先生成了一组密钥pkey和skey，然后再用公钥pkey加密m得到密文c。</p>
<p>那么就先看这个genkey，其步骤是：</p>
<ul>
<li><p>生成f、g，满足：</p>
<script type="math/tex; mode=display">
f \in (1,\sqrt{2}\cdot 10^d)</script><script type="math/tex; mode=display">
g \in (10^d,\sqrt{2}\cdot 10^d)</script></li>
<li><p>生成q，满足$q = 4 \cdot 10^{2d}$</p>
</li>
<li><p>计算h：</p>
<script type="math/tex; mode=display">
h = f^{-1}g \quad(mod\;q)</script></li>
<li><p>得到公钥(d,h)，私钥(f,g)</p>
</li>
</ul>
<p>之后看encrypt：</p>
<ul>
<li><p>q还是上面那个q</p>
</li>
<li><p>取一个随机数r，$r \in (1,\frac{10^d}{2})$</p>
</li>
<li><p>计算密文c：</p>
<script type="math/tex; mode=display">
c = rh + m + r \quad(mod\;q)</script></li>
</ul>
<p>给出h、c，要求还原m。</p>
<p>可以看出他的genkey其实是一个ntru，所以有q的情况下可以造格得到f、g。然而问题在于题目没有给出q也没有给出d，但是可以发现c、h都是模q下的量，所以q应该会略大于c、h，因此可以简单在范围附近爆破一下d，检查一下规约出的f、g是否合理就行。</p>
<p>得到f、g之后就等于得到了私钥，之后类似ntru去解密。由于有：</p>
<script type="math/tex; mode=display">
c = rf^{-1}g + m + r \quad(mod\;q)</script><p>所以：</p>
<script type="math/tex; mode=display">
cf = r(f+g) + mf \quad(mod\;q)</script><p>和ntru一样，由于各个数字数量级均有限制，所以整个式子不模q也是成立的，也就是：</p>
<script type="math/tex; mode=display">
cf = r(f+g) + mf</script><p>所以有：</p>
<script type="math/tex; mode=display">
cf = mf \quad(mod\; f+g)</script><p>然后再在f+g下对f求逆就可以得到m。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">h = <span class="number">1051643987107349427988807326909852110640860009433515828832892541964729933410444984350917250524103015414239941369074041041830326426044333499878031164851095096864048639115431370526747014210332286314344073411522846701723463410585601251886732229726828022089809603850477551571014006202841406236367999378786782206165205893353928598469661871284779486855440579818275314024966224282757807716013799903830828885606714972634243850947534165272668985513949964901606268939300116019465522042467054120201087606016018354238401711720121586874288767235317479748890350702705575809130664969776549574720593740409234863974057904204809404816059921579771581800937241591669455683460570640868196509926763901079838233646036933530095891316054589051458146768287967886035091641162494322987627448810201550901588438560433001422233269632915351406169253963308421081459981594969405377353502889363324282815864766827664453823780238352371809048289845094882346227809082005375092441877966603138648719670349093616548820955566204871333952902983753935678447080673827214244142614295192263451840766771122229866931492260663320087497820892824540996643905125018452302747847009</span></span><br><span class="line">c = <span class="number">11913143174789215053772744981113562063689725867199301496294410323568897757042952642806438602327917861884988292757318755590132189620231444302311290566584065812614959093870787195145654508262419270742989923415342357807325941686508030706603920412262004324188375072184983301522882728578077572816154054220606088703932092256905881975876112779175003897105313776239681492514925430817300633974666123599685062340158348009344351002327049272743679109535286730751345284084148118733529966364414749672437370878526710641430471595906340522772252875146681541656231708112317601000655090279925720590940060372738708208419449824043905057860829031242339842131799965043031307394209699264362321397162645220002253271689678364848888381499587038475895945238726252440250183268252483198408039250213490525880829604473555612305513974817850974135874728084839426045420913060975464553734293001460752648937744531874552694145500413222582269910431269597066268600572899619407093373565994271589940926018891922169454906132284552523035481664164354874071831210264979733079749696197917769435226866441989054017071332158916586376454753209296136133271926449919437888563234409</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">560</span>,<span class="number">580</span>):</span><br><span class="line">    q = <span class="number">4</span> * <span class="number">100</span> ** d</span><br><span class="line">    <span class="keyword">if</span>(q &gt; c):</span><br><span class="line">        F = <span class="built_in">int</span>(sqrt(<span class="number">2</span>) * <span class="number">10</span> ** d)</span><br><span class="line">        G = <span class="built_in">int</span>(sqrt(<span class="number">2</span>) * <span class="number">10</span> ** d)</span><br><span class="line">        L = Matrix(ZZ, [[<span class="number">1</span>, h],</span><br><span class="line">                        [<span class="number">0</span>, q]])</span><br><span class="line">        res = L.LLL()[<span class="number">0</span>]</span><br><span class="line">        f, g = res[<span class="number">0</span>] , res[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">abs</span>(f) &lt; F <span class="keyword">and</span> <span class="built_in">abs</span>(g) &gt; <span class="number">10</span> ** d <span class="keyword">and</span> <span class="built_in">abs</span>(g) &lt; G <span class="keyword">and</span> f*g &gt; <span class="number">0</span>):</span><br><span class="line">            f = <span class="built_in">abs</span>(f)</span><br><span class="line">            g = <span class="built_in">abs</span>(g)</span><br><span class="line">            mf = c*f % q % (f+g)</span><br><span class="line">            m = mf * inverse(f,f+g) % (f+g)</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;4_c0N9rU3n7!aL_Pu81iC_k3Y_cRyp70_5ySTeM_1N_CCTF!!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Ally-22-solves-174-pts"><a href="#Ally-22-solves-174-pts" class="headerlink" title="Ally(22 solves , 174 pts)"></a>Ally(22 solves , 174 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ally enjoys the challenge of solving Diophantine equations, so help them tackle this latest complex equation as well.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>():</span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;┃&quot;</span></span><br><span class="line">	pr(        <span class="string">&quot;┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓&quot;</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;.::  Ally is my best friend, help him to solve his tough task  ::.&quot;</span>, border)</span><br><span class="line">	pr(        <span class="string">&quot;┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛&quot;</span>)</span><br><span class="line"></span><br><span class="line">	nbit = <span class="number">14</span></span><br><span class="line">	level, step = <span class="number">0</span>, <span class="number">19</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		pr(border, <span class="string">f&#x27;Please send your <span class="subst">&#123;nbit&#125;</span>-bit prime:  &#x27;</span>)</span><br><span class="line">		p = sc().strip()</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			p = <span class="built_in">int</span>(p)</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;Your input is not valid! Bye!!!&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> p.bit_length() == nbit:</span><br><span class="line">			pr(border, <span class="string">&#x27;Send the solution of the following Diophantine equation in positive integers x, y&#x27;</span>)</span><br><span class="line">			pr(border, <span class="string">f&#x27;<span class="subst">&#123;p&#125;</span> * (x - y)**3 = (x**2 + y) * (x + y**2)&#x27;</span>)</span><br><span class="line">			xy = sc().strip().decode()</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				x, y = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> xy.split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				die(border, <span class="string">&#x27;Your answer is not valid! Bye!!!&#x27;</span>)</span><br><span class="line">			<span class="keyword">if</span> p * (x - y)**<span class="number">3</span> == (x**<span class="number">2</span> + y) * (x + y**<span class="number">2</span>) <span class="keyword">and</span> x &gt; <span class="number">0</span> <span class="keyword">and</span> y &gt; <span class="number">0</span>:</span><br><span class="line">				<span class="keyword">if</span> level == step:</span><br><span class="line">					die(border, <span class="string">f&#x27;Congratz! You got the flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					pr(border, <span class="string">f&#x27;Good job, try the next step <span class="subst">&#123;level + <span class="number">2</span>&#125;</span>&#x27;</span>)</span><br><span class="line">					level += <span class="number">1</span></span><br><span class="line">					nbit = <span class="built_in">int</span>(<span class="number">1.2</span>*nbit) + getRandomRange(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				die(border, <span class="string">&#x27;Your answer is not correct! Bye!!&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;Kidding me!? Bye!!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>题目共19轮挑战，每一轮挑战需要满足：</p>
<ul>
<li><p>输入一个指定大小的素数p</p>
</li>
<li><p>给出下面丢番图方程的一个正整数解：</p>
<script type="math/tex; mode=display">
p(x - y)^3 = (x^2 + y)(x + y^2)</script></li>
</ul>
<p>赛中的时候研究这个研究了好久，既没有搜到啥论文，也没想到能怎么自己构造。最后<a target="_blank" rel="noopener" href="https://yolbby.github.io/">@yolbby</a>给出了一个巧妙的思路：</p>
<script type="math/tex; mode=display">
p = 4y+1</script><script type="math/tex; mode=display">
x = 2y+1</script><p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&#x27;01.cr.yp.toc.tf&#x27;</span>,<span class="number">13777</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">20</span>):</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;Please send your &#x27;</span>)</span><br><span class="line">    a = sh.recvuntil(<span class="string">b&#x27;-&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line">    a = <span class="built_in">int</span>(a)</span><br><span class="line">    sh.recvline()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        p = getPrime(a)</span><br><span class="line">        <span class="keyword">if</span> p % <span class="number">4</span> == <span class="number">1</span>:</span><br><span class="line">            y = (p-<span class="number">1</span>)//<span class="number">4</span></span><br><span class="line">            x = <span class="number">2</span>*y+<span class="number">1</span></span><br><span class="line">            sh.sendline(<span class="built_in">str</span>(p).encode())</span><br><span class="line">            sh.recvline()</span><br><span class="line">            sh.sendline(<span class="string">f&#x27;<span class="subst">&#123;x&#125;</span>,<span class="subst">&#123;y&#125;</span>&#x27;</span>.encode())</span><br><span class="line">            sh.recv()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sh.recvline())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;Di0phaNtinE_eQuaT1on_iZ_4n_equ4tion_wiTh_int3ger_solu7Ions_0nly!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Bada-51-solves-90-pts"><a href="#Bada-51-solves-90-pts" class="headerlink" title="Bada(51 solves , 90 pts)"></a>Bada(51 solves , 90 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The Bada equation contains an undetermined function. By closely examining how this equation behaves, you may be able to discover the concealed flag.</span><br></pre></td></tr></table></figure>
<p>依然没有附件，题目内容是：</p>
<p>存在一个未知的函数f，满足：</p>
<script type="math/tex; mode=display">
f(a+1,b) = f(a,b) + a</script><script type="math/tex; mode=display">
f(a,b+1) = f(a,b) - b</script><p>其中所有值都是整数，靶机会给出两个值：</p>
<script type="math/tex; mode=display">
f(x,y),f(1,1)</script><p>要求求出x，y。</p>
<p>可以看出，从(1,1)到(x,y)的迭代过程完全可以看作是两个不同的等差数列，也就是：</p>
<script type="math/tex; mode=display">
f(x,y) = f(1,1) + (1 + 2 + ... + (x-1)) - (1 + 2 + ... + (y-1))</script><p>而这两个等差数列又显然可以合成一个等差数列，也就是：</p>
<script type="math/tex; mode=display">
f(x,y) = f(1,1) + (y + (y+1) + ... + (x-1))</script><p>用求和公式就是：</p>
<script type="math/tex; mode=display">
f(x,y) = f(1,1) + \frac{(y+x-1)(x-y)}{2}</script><p>记：</p>
<script type="math/tex; mode=display">
d = f(x,y) - f(1,1)</script><p>所以有：</p>
<script type="math/tex; mode=display">
(y+x-1)(x-y) = 2d</script><p>然后交互过程中又发现了一个事情，那就是d总是一个素数，所以就很好办了，要使上式成立就只能：</p>
<script type="math/tex; mode=display">
x-y = 2</script><script type="math/tex; mode=display">
y + x - 1 = d</script><p>然后解方程就可以得到x、y了——然而发回去不对。</p>
<p>当时可能正是夜里三四点钟，<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ZimaBlue">@Zima</a>看了这题过后死活没看出解法哪里有问题，就叫我来；我看了看也死活没看出问题，就拉来了<a target="_blank" rel="noopener" href="https://yolbby.github.io/">@yolbby</a>；结果他也没看出来解法问题在哪，三脸懵逼。</p>
<p>第二天早上<a target="_blank" rel="noopener" href="https://hash-hash.github.io/">@hash-hash</a>起来之后就把他解掉了，看了看思路发现说其实上面的式子还有一个可能就是：</p>
<script type="math/tex; mode=display">
x-y = 1</script><script type="math/tex; mode=display">
y + x - 1 = 2d</script><p>而这样去解方程再发回去就正确了，只能说他的check逻辑不是太对(估计是直接判断是否和第二种这个解相等)。</p>
<p><br></p>
<h3 id="Duzly-0-solves-500-pts"><a href="#Duzly-0-solves-500-pts" class="headerlink" title="Duzly(0 solves , 500 pts)"></a>Duzly(0 solves , 500 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Duzly is a straightforward hash function design based on congruence relationships over a prime number modulus.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">m</span>):</span><br><span class="line">	m += <span class="string">b&#x27;\x8f&#x27;</span> * (<span class="number">8</span> - <span class="built_in">len</span>(m) % <span class="number">8</span>)</span><br><span class="line">	<span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">duzly</span>(<span class="params">m, C</span>):</span><br><span class="line">	ow, E = <span class="number">0</span>, [<span class="number">2</span>**<span class="number">24</span> + <span class="number">17</span>, <span class="number">2</span>**<span class="number">24</span> + <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">		ow += C[_] * <span class="built_in">pow</span>(m, E[_], p)</span><br><span class="line">	<span class="keyword">return</span> ow % p</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pashan</span>(<span class="params">msg</span>):</span><br><span class="line">	msg = pad(msg)</span><br><span class="line">	pash, msg = <span class="string">b&#x27;&#x27;</span>, [msg[<span class="number">8</span>*i:<span class="number">8</span>*(i+<span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg) // <span class="number">8</span>)]</span><br><span class="line">	<span class="keyword">for</span> m <span class="keyword">in</span> msg:</span><br><span class="line">		_h = duzly(bytes_to_long(m), C).to_bytes(<span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">		pash += _h</span><br><span class="line">	<span class="keyword">return</span> pash</span><br><span class="line"></span><br><span class="line">p = <span class="number">2</span>**<span class="number">64</span> - <span class="number">59</span></span><br><span class="line">C = [<span class="number">1</span>] + [randint(<span class="number">0</span>, p) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">flag = urandom(getRandomRange(<span class="number">0</span>, <span class="number">110</span>)) + flag + urandom(getRandomRange(<span class="number">0</span>, <span class="number">110</span>))</span><br><span class="line">_pash = pashan(flag)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;_pash_updated&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(C).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">f.write(_pash)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>题目不长，但是够狠。加密流程为：</p>
<ul>
<li><p>生成一个长度为6的随机列表C，第一个值是1，其他均为0-p的随机数</p>
</li>
<li><p>将flag首位进行两段长度未知的随机填充</p>
</li>
<li><p>将flag切分为长度为8的多个分组</p>
</li>
<li><p>对每个分组mi，进行如下加密得到对应密文ci：</p>
<script type="math/tex; mode=display">
c_i = C_0m_i^{2^{24}+17} + C_1m_i^{2^{24}+3} + C_2m_i^{3} + C_3m_i^{2} + C_4m_i^{1} + C_5m_i^{0} \quad(mod \; p)</script></li>
</ul>
<p>由于update里给出了C，所以这其实是一个关于mi的单变量方程，所以自然想到直接求根，然而这个多项式度是$2^{24}+17$，实在太大了，根本建不出来，所以要想下怎么降次。但是模数p是一个非常正常的素数(也就是longlong型的最大素数)，2^24虽然大，但完全不会是某个元素的阶，所以消不掉。</p>
<p>一筹莫展的时候想了点歪点子，首先可以知道，flag虽然在首尾进行了填充，但是”CCTF{“这五个字符仍然一定在里面。又因为八个字符八个字符分了组，所以这个flag头可能有如下八种切分方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CCTF&#123; + YYY</span><br><span class="line">X + CCTF&#123; + YY</span><br><span class="line">XX + CCTF&#123; + Y</span><br><span class="line">XXX + CCTF&#123;</span><br><span class="line">XXXX + CCTF | &#123; + YYYYYYY</span><br><span class="line">XXXXX + CCT | F&#123; + YYYYYY</span><br><span class="line">XXXXXX + CC | TF&#123; + YYYYY</span><br><span class="line">XXXXXXX + C | CTF&#123; + YYYY</span><br></pre></td></tr></table></figure>
<p>其中，X代表纯随机字符，Y代表可见字符。可以看出，八种情况中，只有5、6两组复杂度稍大，其他的情况复杂度都不算特别高，可以进行爆破。而期望是这样：如果得到了正确的flag头的内容，比如”CCTF{i_lo”这种，就可以合理猜测下一个分组的是ve开头，从而连蒙带猜往后一个分组一个分组爆。</p>
<p>然而事与愿违，我一开始密文读取方式错了，导致zima师傅写的c++的多进程爆破完全就没用对数据，自然也没结果。时间又很紧张，所以最后没有搞出来flag头，自然也就不存在往后的连蒙带猜了。</p>
<p>赛后看discord的讨论，突然反应过来正解应该怎么做。首先对于上面的ci，可以把它看成一个以mi为根的多项式：</p>
<script type="math/tex; mode=display">
f = C_0x^{2^{24}+17} + C_1x^{2^{24}+3} + C_2x^{3} + C_3x^{2} + C_4x^{1} + C_5x^{0} - c_i\quad(mod \; p)</script><p>而在模p下天然有一个以mi为根的多项式：</p>
<script type="math/tex; mode=display">
g = x^{p-1} - 1</script><p>所以如果求解两者的gcd就会得到：</p>
<script type="math/tex; mode=display">
gcd(f,g) = x - m_i</script><p>就有mi了。</p>
<p>但是，f、g的次数太大仍然是个问题，对于这一点的处理和我在NSSCTF的dlc出的一道<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/5457">Franklin</a>有点类似。由于f的次数较低，所以可以用f做商环，将g一步一步lift上去，之后再用HGCD求出两者的公因式，而在商环上lift的过程sage内部是有实现的。</p>
<p>然而，2^24这个数量级好像刚好超过了sage能处理的次数上限，所以没法直接做，并且由于有多个分组都要这么处理，所以可能要自己用c++手动写个多项式的lift，并且用更大内存的机器来跑才行。</p>
<p>要我写这个的话，我短时间是肯定憋不出来的，但是如果赛中早点想到这个思路，然后交给<a target="_blank" rel="noopener" href="https://wleukocytec.github.io/">@leukocyte</a>感觉肯定能写，还是有点可惜，自己出过的类似题没有联想上。</p>
<p><br></p>
<h3 id="Forghan-36-solves-119-pts"><a href="#Forghan-36-solves-119-pts" class="headerlink" title="Forghan(36 solves , 119 pts)"></a>Forghan(36 solves , 119 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The Forghan, the combination of RSA and DLP cryptography, may in certain instances prove more accessible than employing either method individually.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>():</span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_gen</span>(<span class="params">p</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		g = getRandomRange(<span class="number">2</span>, p - <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">pow</span>(g, (p-<span class="number">1</span>)//<span class="number">2</span> , p) != <span class="number">1</span>:</span><br><span class="line">			<span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;┃&quot;</span></span><br><span class="line">	pr(        <span class="string">&quot;┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓&quot;</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;Hi all, now it&#x27;s time to solve a strange and unusual RSA and DLP    &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;challenge about encryption! Follow the questions and find the secret&quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;flag! :)                                                            &quot;</span>, border)</span><br><span class="line">	pr(        <span class="string">&quot;┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛&quot;</span>)</span><br><span class="line">	nbit, b = <span class="number">256</span>, <span class="literal">False</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		pr(<span class="string">f&quot;| Options: \n|\t[G]et encrypted flag \n|\t[P]ublic parameters \n|\t[S]ubmit <span class="subst">&#123;nbit&#125;</span> primes \n|\t[Q]uit&quot;</span>)</span><br><span class="line">		ans = sc().decode().lower().strip()</span><br><span class="line">		<span class="keyword">if</span> ans == <span class="string">&#x27;g&#x27;</span>:</span><br><span class="line">			<span class="keyword">if</span> b == <span class="literal">True</span>:</span><br><span class="line">				l, n = <span class="built_in">len</span>(flag), (p**<span class="number">2</span> - <span class="number">1</span>) * (q**<span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">				gp, gq = find_gen(p), find_gen(q)</span><br><span class="line">				sp, sq = getRandomRange(<span class="number">1</span>, p), getRandomRange(<span class="number">1</span>, q)</span><br><span class="line">				flagp, flagq = flag[:l // <span class="number">2</span>], flag[l // <span class="number">2</span>:]</span><br><span class="line">				yp, yq = <span class="built_in">pow</span>(gp, sp, p), <span class="built_in">pow</span>(gq, sq, q)</span><br><span class="line">				cp, cq = <span class="built_in">pow</span>(bytes_to_long(flagp), yp, n), <span class="built_in">pow</span>(bytes_to_long(flagq), yq, n)</span><br><span class="line">				pr(border, <span class="string">f&#x27;cp = <span class="subst">&#123;cp&#125;</span>&#x27;</span>)</span><br><span class="line">				pr(border, <span class="string">f&#x27;cq = <span class="subst">&#123;cq&#125;</span>&#x27;</span>)</span><br><span class="line">			<span class="keyword">else</span>: pr(border, <span class="string">&#x27;Please first send your primes! :P&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">&#x27;Send your desired prime numbers separated by comma: &#x27;</span>)</span><br><span class="line">			P = sc()</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				p, q = P.split(<span class="string">b&#x27;,&#x27;</span>)</span><br><span class="line">				p, q = <span class="built_in">int</span>(p), <span class="built_in">int</span>(q)</span><br><span class="line">			<span class="keyword">except</span>: die(border, <span class="string">&#x27;Your input are not integer! Bye!!&#x27;</span>)</span><br><span class="line">			<span class="keyword">if</span> p != q <span class="keyword">and</span> isPrime(p) <span class="keyword">and</span> isPrime(q) <span class="keyword">and</span> p.bit_length() == q.bit_length() == nbit:</span><br><span class="line">				b = <span class="literal">True</span></span><br><span class="line">				pr(border, <span class="string">&#x27;Now you can get the encrypted flag in main menu!&#x27;</span>)</span><br><span class="line">			<span class="keyword">else</span>: die(border, <span class="string">&#x27;Sorry, your integers are not valid :/&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line">			<span class="keyword">if</span> b == <span class="literal">True</span>:</span><br><span class="line">				pr(border, <span class="string">f&#x27; gp = <span class="subst">&#123;gp&#125;</span>&#x27;</span>)</span><br><span class="line">				pr(border, <span class="string">f&#x27; gq = <span class="subst">&#123;gq&#125;</span>&#x27;</span>)</span><br><span class="line">				pr(border, <span class="string">f&#x27; yp = <span class="subst">&#123;yp&#125;</span>&#x27;</span>)</span><br><span class="line">				pr(border, <span class="string">f&#x27; yq = <span class="subst">&#123;yq&#125;</span>&#x27;</span>)</span><br><span class="line">			<span class="keyword">else</span>: pr(border, <span class="string">&#x27;Please first send your primes! :P&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;Quitting...&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;You should select valid choice!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>题目有三个选项，但是显然是有顺序的，具体来说应该按照下面来：</p>
<ul>
<li>选择”S”，可以输入256bit的素数p、q</li>
<li>选择”G”，靶机对flag进行加密，加密流程如下：</li>
<li><ul>
<li>生成n，$n = (p^2-1)(q^2-1)$</li>
<li>分别生成p、q下的一个随机二次非剩余gp、gq</li>
<li>生成p、q下的随机数sp、sq</li>
<li>将flag分为两段，记为flagp、flagq，对应数字记为mp、mq</li>
<li>计算yp、yq，$y_p = g_p^{s_p}\quad(mod\;p) , y_q = g_q^{s_q}\quad(mod\;q)$</li>
<li>计算密文cp、cq，$c_p = m_p^{y_p}\quad(mod\;n) , c_q = m_q^{y_q}\quad(mod\;n)$</li>
</ul>
</li>
<li><p>选择”P”，可以拿到gp、gq、yp、yq的值</p>
</li>
</ul>
<p>由于有yp、yq，所以对于密文最后一步的计算来说，其实就相当于解一个RSA，只是模数n变成了：</p>
<script type="math/tex; mode=display">
n = (p+1)(p-1)(q+1)(q-1)</script><p>由于flag是静态的，所以完全可以放在一个子群里去求解，比如放在模p-1下：</p>
<script type="math/tex; mode=display">
c_p = m_p^{y_p}\quad(mod\;p-1)</script><script type="math/tex; mode=display">
c_q = m_q^{y_q}\quad(mod\;p-1)</script><p>也就是说，只要知道p-1的分解，就可以求phi(p-1)，然后就可以解RSA解出mp、mq在p-1下的值，又由于flag是静态的，所以交互多次求crt，就能得到flag的完整值。而p、q都是自己构造的，所以想满足p-1能分解太容易了，比如最简单的情况就构造：</p>
<script type="math/tex; mode=display">
p = 2k + 1</script><p>令k是一个素数，就有：</p>
<script type="math/tex; mode=display">
\phi(p-1) = k - 1</script><p>之后的求解就很容易。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;00.cr.yp.toc.tf&quot;</span>, <span class="string">&quot;13337&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_prime</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(<span class="number">255</span>)</span><br><span class="line">        <span class="keyword">if</span> isPrime(<span class="number">2</span>*p+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span>*p+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">nums = <span class="number">10</span></span><br><span class="line">P = [gen_prime() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nums)]</span><br><span class="line">mp = []</span><br><span class="line">mq = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nums):</span><br><span class="line">    sh.sendline(<span class="string">b&quot;s&quot;</span>)</span><br><span class="line">    sh.recvline(<span class="string">b&#x27;Send your desired prime numbers separated by comma: &#x27;</span>)</span><br><span class="line">    q = getPrime(<span class="number">256</span>)</span><br><span class="line">    sh.sendline((<span class="built_in">str</span>(P[i])+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(q).encode()))</span><br><span class="line"></span><br><span class="line">    sh.sendline(<span class="string">b&quot;g&quot;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;cp = &quot;</span>)</span><br><span class="line">    cp = <span class="built_in">int</span>(sh.recvline().strip().decode())</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;cq = &quot;</span>)</span><br><span class="line">    cq = <span class="built_in">int</span>(sh.recvline().strip().decode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    sh.sendline(<span class="string">b&quot;p&quot;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;gp = &quot;</span>)</span><br><span class="line">    gp = <span class="built_in">int</span>(sh.recvline().strip().decode())</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;gq = &quot;</span>)</span><br><span class="line">    gq = <span class="built_in">int</span>(sh.recvline().strip().decode())</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;yp = &quot;</span>)</span><br><span class="line">    yp = <span class="built_in">int</span>(sh.recvline().strip().decode())</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;yq = &quot;</span>)</span><br><span class="line">    yq = <span class="built_in">int</span>(sh.recvline().strip().decode())</span><br><span class="line"></span><br><span class="line">    k = (P[i] - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    mp.append(<span class="built_in">pow</span>(cp,inverse(yp,k-<span class="number">1</span>),P[i]))</span><br><span class="line">    mq.append(<span class="built_in">pow</span>(cq,inverse(yq,k-<span class="number">1</span>),P[i]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mp = crt(P,mp)[<span class="number">0</span>]</span><br><span class="line">Mq = crt(P,mq)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(Mp))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(Mq))</span><br></pre></td></tr></table></figure>
<p>如果这题需要用到DLP的话，那构造p-1光滑应该是好点，然而sp、sq完全用不到，所以不用考虑。</p>
<p><br></p>
<h3 id="Honey-48-solves-95-pts"><a href="#Honey-48-solves-95-pts" class="headerlink" title="Honey(48 solves , 95 pts)"></a>Honey(48 solves , 95 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Honey is a concealed cryptographic algorithm designed to provide secure encryption for sensitive messages.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_params</span>(<span class="params">nbit</span>):</span><br><span class="line">	p, Q, R, S = getPrime(nbit), [], [], []</span><br><span class="line">	d = <span class="built_in">int</span>(sqrt(nbit &lt;&lt; <span class="number">1</span>))</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(d):</span><br><span class="line">		Q.append(getRandomRange(<span class="number">1</span>, p - <span class="number">1</span>))</span><br><span class="line">		R.append(getRandomRange(<span class="number">0</span>, p - <span class="number">1</span>))</span><br><span class="line">		S.append(getRandomRange(<span class="number">0</span>, p - <span class="number">1</span>))</span><br><span class="line">	<span class="keyword">return</span> p, Q, R, S</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, params</span>):</span><br><span class="line">	p, Q, R, S = params</span><br><span class="line">	<span class="keyword">assert</span> m &lt; p</span><br><span class="line">	d = <span class="built_in">int</span>(sqrt(p.bit_length() &lt;&lt; <span class="number">1</span>))</span><br><span class="line">	C = []</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(d):</span><br><span class="line">		r, s = [getRandomNBitInteger(d) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;01&#x27;</span>]</span><br><span class="line">		c = Q[_] * m + r * R[_] + s * S[_]</span><br><span class="line">		C.append(c % p)</span><br><span class="line">	<span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nbit = <span class="number">512</span></span><br><span class="line">params = gen_params(<span class="number">512</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">C = encrypt(m, params)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;params_enc.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(<span class="string">f&#x27;p = <span class="subst">&#123;params[<span class="number">0</span>]&#125;</span>\n&#x27;</span>)</span><br><span class="line">f.write(<span class="string">f&#x27;Q = <span class="subst">&#123;params[<span class="number">1</span>]&#125;</span>\n&#x27;</span>)</span><br><span class="line">f.write(<span class="string">f&#x27;R = <span class="subst">&#123;params[<span class="number">2</span>]&#125;</span>\n&#x27;</span>)</span><br><span class="line">f.write(<span class="string">f&#x27;S = <span class="subst">&#123;params[<span class="number">3</span>]&#125;</span>\n&#x27;</span>)</span><br><span class="line">f.write(<span class="string">f&#x27;C = <span class="subst">&#123;C&#125;</span>&#x27;</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>params_enc.txt：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">10580731215444436219213907263947534038012197972307836319229421193761088798378768844649759133142120180834573817149711299466707823017636232456526471274387917</span></span><br><span class="line">Q = [<span class="number">6718668664591596190749745980002066645380242844394957953766947533978323053938214647829798301606252456858132121628517723050462291300790766055200866765561610</span>, <span class="number">8738840830394886495658505803088103824478963010774845789433253508554356383249611502157307334585157729703873877797759121271071421201959116272886732798936523</span>, <span class="number">4388762712805764363921857352899834586382140923234814556069490536704913653848525595836491615636446563386705915348021173847271741862809075809151508973332816</span>, <span class="number">3663706247989213864330218414789109172658418861584264092087052781618522795676355371739296186667918464732397854703792563460353675590182379535358561615166754</span>, <span class="number">10397730940373180549512945920847346184926672474430866208628825035104473525758952069910968144296138220861205803231072660136999110567752870928953292888013817</span>, <span class="number">7950983396364741732874562189206547723862955251595526752956177377987683115942827501152009639962778147887569469649852864894630521759276627026901168996371682</span>, <span class="number">4533165373271154956275563812280832107592547920299130443910706773435844651231402604986107252454770256826684895729900344877444002682896222483157835711226276</span>, <span class="number">234527648838985018479849393379369972316648524004050156622962478277970628212208049885578895953447529009579881605066831810617219492342569126524704457098602</span>, <span class="number">870946394610707169333783318085559836426827503011955242395779894700298192587685130680102208909573921059078858816359885827349281892186755920839352494224983</span>, <span class="number">5025393101560564396356619431938053414422489109406396725377683594254768077793838379117179092536396259414266971990125716674162127500490058572594571364978294</span>, <span class="number">5914192169617888877888201158713062853387719050723973971874176184801960297380845845091259990664210178355882621876155306106794686897854891414999449337977781</span>, <span class="number">2315609284318723939818174971181608382568372323836754133265010413836452399043354382657889810068171230196496294710150903020084150025606782486579490225752163</span>, <span class="number">7278167622527482910919537896950398911672667355929695202886784227621290914468002099686668156909569183497765732237075799745632960354306268680765408194219074</span>, <span class="number">3334584846711780119716613440720851482199838919351927489954344426327712973616885459737471991960238971274273643566666607141850753561424427088261862873317161</span>, <span class="number">10418397794302836806813296591826255845845380563102199636140458670781241436466478273414138749593148481207713557016996462238845705251702717702279222414513227</span>, <span class="number">8928267741189301140931758366885435860144549752680480164627323600501278650103818630920534258909582593266779000356145650416276415560226176904904552964196921</span>, <span class="number">3371514716248416335324237152123624115597170761078576760713238311485522010416246207731778456501311675041827750001670698984335573888627309609534659722697174</span>, <span class="number">3802217515688979225517388823688564230191961273039428065604146662684362686419670392762755984078261072614619934671572327384351597903233780846163893180876244</span>, <span class="number">2363399549320749312563257796730356164186914867645487733176402567625567991193120859507532138374793392237469893062402307645814490930874653088116729203724851</span>, <span class="number">10221767730316631512882371487958453352895713655492241322139865275323706929127996334620105099751973217983332705204535216804829987329684674632121801754529472</span>, <span class="number">2309440702968799222696132507585555901684240893289264193546892279919675495689944211715270510347394465285317239758024734161176699837687742722383530547735726</span>, <span class="number">5768185970426887633783322939933762164095055854707759575404348181421158843802654199133776622565384843677610666356549368021172121302926969754865633752131083</span>, <span class="number">3229518654067354667224244723968136366109210341994628338992752927462431316675552817799465987425719486448276862390918033544772400219803600904202906882850710</span>, <span class="number">9261930571620802581580992489567043178258044978932724785185749415955521702331959591680386023118398455066896674799447994060060156036800986190467008880726445</span>, <span class="number">2202162000802916921896507108984564185119471354726317829850206292755815439071735424116041491064894922930900262540589602333676063925873357256494020426758849</span>, <span class="number">1449198886322850923273373987785167865779477069790726992542423846556138762913056524689998313112599261515223680429584445016474216381861998363527368722991846</span>, <span class="number">8372052560034461177472546395510480308837387803551378399004608402463282066003862653368875671946863748209051044725913651881213858335224750549176875818647614</span>, <span class="number">1554572177534183877889322947083536921680809086638640689433294150868422460719624621258231995856944045776876555664816113444481761122803489100212103150005950</span>, <span class="number">10304720995101153898600333216365877709018991122985401884049110267116778080162237155472336396606109372189653686733770775660895990549286854727042270667997449</span>, <span class="number">9702831715765050072649082617719386580543641764650576307262259428035281535816750758018451681417440458250169771442858047124693499821240155899358663466925522</span>, <span class="number">4983986466837077050816175727911146971276599399191126236666755181304580074902883995859030897874305902445659355326021836801836996577665092276845357389900055</span>, <span class="number">983210432268706135181772492997088637756153310076409721616450343187239073604891492532080986521255675448499887782529162112441952861587689660048849369850769</span>]</span><br><span class="line">R = [<span class="number">8922553268219903948421811612403588317187402276064169063400419617931637566221670948925221403527928336656976084021780421068421112325215152715630319708159148</span>, <span class="number">1960697234007608888633325436691320507012497445090151112947144246088597317322303593936974554881161091213718329061011703885436579261559669838148253146762736</span>, <span class="number">5876944865176517279136475269375710514719489457672467542904948332791352244229042691977616905122711469012731652511966060550749288338599104284986451669586397</span>, <span class="number">10560136356360422684127995001096871178761635291417665630629868184624616925939841693017240341233504589896610287855672892399213367967385666891688408976236926</span>, <span class="number">477096251733995832965266836067676961413182629438628989729801411920869543083075545758386996801847267554704996660190900105380190625423846876906822024677634</span>, <span class="number">7001514955678391252130680521301315254365131738168087539892724691183104608345983375763663321467662055864103520121513349630333839818372656472731157470876337</span>, <span class="number">3894488356665934776074291789545516608573077899099880057920210752197885106521699021123658077208789295954145485399473386424677782787720074605813565437678385</span>, <span class="number">6084641463140385894120457093933350076091808742065950836200598466936433741373700151235571333073965513559605688011967994215074945374832957951384088589789549</span>, <span class="number">6429023674027239778212676334778900557043774851747196071499704016422574667955121145943674677254291410204037372996870181094090300709994594837656541352954321</span>, <span class="number">974464046378184190666336249935678253753198649184272269465353741281529523364289314148552833155935080422698020734516538377662137879089845095565536185765703</span>, <span class="number">5275384626572520577089146723078373110279682903874445477027602487061203157331398955233780208890725281673434536867800450553737656852356536771518379108118530</span>, <span class="number">7195767683001605593626199889963767438584070902169912442665828755648712278523740276132000225353756257232761885567134364203207306842108602537457408438487869</span>, <span class="number">1960155276835684836483043402384876176138942980630724993481564836712252228823186653467973806509964860286129730847244573674203959835565358735171611743573721</span>, <span class="number">6414607819273473402861616605113355396690170400984793217629732347141796693554056264547151212348354332930126795040213921009711560216969452391748438893237750</span>, <span class="number">3344964019305423035551401397282638905496921053458747459062023331678484337724980196690184898986671355848101101352105363764794975082772539709853216580762130</span>, <span class="number">5599385562588302350377616767130563945375472947459594912838322011021483641484084692396462025157944023828872267520122213089523093591160284337483108416804096</span>, <span class="number">9490045098551912983475126253859124028793327975874647810947095579199208473971726763051464010595903748080632329362605820021188148160826282120484098519748832</span>, <span class="number">980400922804123638777377509067942595214234592161404114303498013065244168965487370334832921426484278913774963761155003569793282819717667783351454812080994</span>, <span class="number">2772369382727364487748752144766350276094463435156818133766210304998890765120785013435379746537938377688617479112518505844159436213691418873590807740501183</span>, <span class="number">2338271137215119073302625621754099128003710500967811947590498668688826448575898279561111743087002717955161536157254689000474464404087443266193145449601031</span>, <span class="number">11773104862539842923315548180471993854469651503131148446111338098437913152663007837927793233931818835121946274135336436554801339749906320765919816150768</span>, <span class="number">7022131435585860015767289025786078578929344550873832550705723505006303288639135070849692494020122369694090619694760175970759059981608871097298624956669246</span>, <span class="number">9062158671807923729547552523768819638817707994079942965412925347441853183471973898478745711676153003756450481351777543455041815438536630317647408008349357</span>, <span class="number">641428039466528875429106458292463262780539744201857515833377175893334510962304373010401729801987725599439620073783868719664061882399367340158128062151780</span>, <span class="number">9636846145225909579086917154824161374486916920345217833190333031690359415616710658317308376119096253360425924297858397657697468296746934075225665559206030</span>, <span class="number">480796179229094678008918831581475398488769027287954488301969143979307355466114726392701279092691566949082439457297527772794149828193400419285116237063338</span>, <span class="number">7726757640854263742178678415761753342099387727318458723726925176786999799204056696883433346568600944559959849253863013300907357120126559055735593380638961</span>, <span class="number">551534415366550033034654093228329954588738781407008585088422737955391043381667720876717529438845777841508116853874405455280903517864352822604194884203656</span>, <span class="number">2135598634800053933515509095633720732412542790075717247869348997292949946344227105219967710854885153055617943193159899627517699960920415492992774438014041</span>, <span class="number">1680242449902645450228202409049382139482100876672724104665964994414865664877710770701122475977142858601068246748276652246938681740022531970523695731126206</span>, <span class="number">436320498659370791836085607479390848415464961245449366885835640616716752879866126057724425537944356751844317980881005608075886211154052092270888058429787</span>, <span class="number">4102523817041969170017113001399252035243358293719837916039521471412151711746047572340376418109842112515873700164747338421862615679590520014959369523777063</span>]</span><br><span class="line">S = [<span class="number">4389820170235953517860364281419052587762385444517203945856665517072263529411621622474249480804818285716662154444854074939122170918939074730520091008754679</span>, <span class="number">10274488321950407401790238304858775303749809597573328350457719402010568443492374388509295355784873292280254116167747959663379913408799485392015111636115272</span>, <span class="number">7413556897779783875511997253964328306011661062497568739340607424890313315434489440969977560260194970241163209968988660276109536299848001455072705137702052</span>, <span class="number">10385679419514177727801069016719283683697529805734389950368725106396939072509839502286093730172215158898251533786500497578747904349856564856054102927847131</span>, <span class="number">6386209810414906928429352824399745808560059492214757951425372272591372428785367326567204502131184260857447725722068674542931096991341451850846209503213310</span>, <span class="number">699060860182347708294712482476262878008951502586470987307146194685783850677219935862211847525612405824474382122868643521962157410369483858428437433802395</span>, <span class="number">3482063900392942412450041046839813864192488604261419419162091087116878838189062406913587662602295096636481252242577251563441565388543873530900962308450590</span>, <span class="number">5752782775722534186844731777766684686828626762801341093006843547008915880093927377014105260314050196609699164926717998841388194942556402699285523644651583</span>, <span class="number">4477944786670422304592908174461368396168580171651041832449759231077050962444090886920563302603784981035116689839335069690875797644553684152368376089740517</span>, <span class="number">5663531682848751034979876476955107364567717396957230368140915480695954150088052156264521615690161327525898382714131905580517915060427960250740110846321921</span>, <span class="number">5343294510843224726960051115907810365241970373986845465490090821566645536683695042467985025063439338770116316455211944030125820601506874250685838077414765</span>, <span class="number">8432688027895892738831218358369397874948328355540048945541749304849571948638169902486647265119397307193449002927427840453857643697175667051504836511635801</span>, <span class="number">8974418251288081645329898313903422373193272601106837017923535786950979222125740970411725976034947989767143786286397290996756916960291029965672692318584390</span>, <span class="number">3367471493907450997862234076499110882206518716388236141312548251406626961838619595519805436447472248133422979102036617759221276869918910189482246041609756</span>, <span class="number">9787518698663334219763616437865759554315749369906898604904977007297368987715422535407542350049111845605011307829034744443271718643291528381794716569586150</span>, <span class="number">7423298611637442306439453382713995476685370148677494272333567929180589186347708172471032286209947149761644993151042408431548488945145292037694546868884030</span>, <span class="number">5591656321514817104832226351286824953278894430528912246855770091334337189386156994498331013600732669813560603667226878637404391237947398475280409452591013</span>, <span class="number">6425108527382412819259579180312607504985609322110590326058191420486308943785080395001318724782575187718535133704219706236946232717333616646838328259100174</span>, <span class="number">1986072520726417425427679478185786673218113837249425820170849864471171328875606626923270664642579676457285438864056080352157246995774517812392120146048999</span>, <span class="number">5085759490547346080963649291763871068034757573012867868532204864022791365366745839456310985148663327808561601274994541505734129506831803550600738607170703</span>, <span class="number">6883330982174382523423400136207766091739299571009207949454774998664997037115272990237878573502506026799645646664956134682833693219974019271740996314084220</span>, <span class="number">3008412285222633004812698063455902388460013611944185187747762649311442328686187279186972723448077521425052318221865300502697494418867793831761784796146329</span>, <span class="number">9547325670583212399117684599284936334790443591395268814958834705867928621240882386996085347052830889322724160452729359284992294890584292625829913315628265</span>, <span class="number">1387461799657365419593288084566026147529011675413652640829187706708872066267641962620159408303872024421411747751690792902149761832079721583778430712988299</span>, <span class="number">2093635222672050417361673475374966389314266702410603863643637918543784930893405832179904330416148995313591588929177333026382745340633946128791737631559286</span>, <span class="number">8413424329301946557805781268429552577339778139904799140486659388945506980343653897206690153402822892272378378085908749995513711021119914769801970795906117</span>, <span class="number">6743445162380434316634371637355512041805280159276931422012464596435558338432827675791139455542184532473287436049595748235961499758716697674776760822162391</span>, <span class="number">1706184129470213725753097073154985919221181897433450716898208607625832464228411992900434982560203334218404626447424408012817411257665032706434306723906871</span>, <span class="number">1188503046129710474378492502021666062040985983530761819828342979325166292485440608536173516789179154601587903599847267180858095017007891547798890802090080</span>, <span class="number">6398862094282462456834873185064362330936738060688527379705123125559724680574585721467123968313071365176318010618981170019917278363707049487278610027058585</span>, <span class="number">1827205671808118170959457466922915851906256049105694256301380823860317738339383848734269783842511423911532135506082729000044271560428423457063013176002958</span>, <span class="number">4296939764995860347968082436772567300063081379392577066061720737920992283479200350022263164173968370055486217109628430523063986426005741344085155171587948</span>]</span><br><span class="line">C = [<span class="number">2312453804397990204892582347458673184184584053391181580849656202381982276483135032773767708029907426388840618138608941250788745829088238589339462137662516</span>, <span class="number">10523194306636352419831471584744199603299973937259007033119401866043123235256118686290774285411893111835433604432082195914308420845569896693674208644701928</span>, <span class="number">8625321422409900297730698589684636810222608572364004227411854906715574297306124060030713845833976664653817196364988412308992879167741430256046508164902265</span>, <span class="number">2203036357494864574281685606458518951592160562338358743010726696365683441724958156704554110208947394458113054047499157258753175446414976136008162642109757</span>, <span class="number">7440676439428237992864596387460092947449968530635365999432104198675297081825315672568959667296286389774687367936168132053293001589687795737604457160906082</span>, <span class="number">2264157050840270501520646271743213633490605461967539030408028006097728678459599299655371587125945029431528702214373899493252891890106222569122603386717360</span>, <span class="number">6089828885562252420652081197249651438359320954630388805129416420415135298321118452771481678140904854945253504361325478946359729157231808943846058944117026</span>, <span class="number">10539688120079451218718476929576210805778407047878263373562960368159158621424931104363627052374700437454925765616146962059684388174993415278124860987310938</span>, <span class="number">6303692164422236243124789748609418445914012315334563733630138248326249660310698584154622748275297380026916444293448955157206727703202478794453250926439643</span>, <span class="number">881942845076614931271891025655927553295291244201690295230440723375006916146507322259936249039275621554840488955637696630030022348109669072833863866985225</span>, <span class="number">10106348190249831893088197931090851286229747534150777530156601113972916238286905365616240501204440809598108220364456446320022747806334510176621958436096123</span>, <span class="number">8324531392881516178541244041903222514911964835924579628962940318936570586739198442236357026438613345385230182029810965182157993322744038688573053225547374</span>, <span class="number">5078708553426349749719952343873018594648548601008242439539543130067536764970709366523519348572603124221309659983256536103306454063139670063244331611755453</span>, <span class="number">8542547993117228744822361667182819410791296436924016725757178153507707272004493213120780743910507865839367749205817741703451968423781285521621014600059589</span>, <span class="number">3073352723766074586873446203285051955281142348730058300259816322651361605792426446390729367386148254808552616968786890277451301146248756651016086606742804</span>, <span class="number">5269945451683706496607356863109615383647000556701922770404180133092195426319754674753614204346587769298246334991876508268642550219392732660290378353338400</span>, <span class="number">6262348731181694593163187372863680743743096474259867989757989072530511417286900866334036812204673457159090130621478933266270029789176903023636735673595513</span>, <span class="number">3297899863181037954379261853482229450757449782777910450819629975965660022355584717412057615899333569245281976118829898854119850433763380827003244277020101</span>, <span class="number">7487260566995972228255217362172107520309457024141075543923988636564806307827017535285595701845830793533604534902349660541692391232785351590333159515799384</span>, <span class="number">10324279404125558600858330541468243667961239247663241031255287540601841176203292036413076990028875224629890818418992943759206077129550049357885152924273782</span>, <span class="number">8044925106089251438446731137002808317322635126054485149617494154471416674741758172633019611642437845768869330746423337854351186668227486117398013073824286</span>, <span class="number">4234270952814400783009242730655483882561531800274439758860142245952005010632014464198770218689605527760730047723966950012227395838571254801244673898812828</span>, <span class="number">638896609043108497262778277770178050665854883307447937008504779907661322405672174519391657570064336725509768185637608044022219246206471015980252602095129</span>, <span class="number">5180216795602211214280366461349507739255238657924206736673167715462995927060334503420979145327254053283011116720223275075476559911219732336496503542596869</span>, <span class="number">4889582376915206124736222022750168286228699065224704085027955184917144323557844593386817223260498520607466742269645929630472738644444652704289510157100913</span>, <span class="number">5012604326308554636339480431591200785633930724891396744558818436357664982175033998281443810436271724799610836412819040278374041390604150781759163613994682</span>, <span class="number">3219038638665180576932584279254771209098300305384572525709292133614238552451580810601286362213655499134538083785424726484119059950676285763438331520089227</span>, <span class="number">6419694420004223063062285264931096360778228156157853232796125041025067958687740255716444718822744614217377927689465894996156144384079594697465808095114901</span>, <span class="number">9910546009146267464166501179537825349776178695164070160517872596078275117785713000045215455672195660329319962408970209137481672915542900445933477806115760</span>, <span class="number">1420603945244588398788478464408905133932325733716125030735921688979482121297328679317495694245547716568441401137633433150951713462958551532394178628021900</span>, <span class="number">6208847506587273852328049116772424002595270959861992270025537759079430511161476024600259347318966551584005222005704567718008394909230998308545154993159673</span>, <span class="number">10385926333158107236552504228168776101396372491461292301486697050842973861408756486936932908479675556344542947425765714101814836237112561730341100901890350</span>]</span><br></pre></td></tr></table></figure>
<p>题目给了d组如下等式：</p>
<script type="math/tex; mode=display">
c_i = Q_im + r_iR_i + s_iS_i \quad(mod\;p)</script><p>所有c、Q、R、S均已知，要求还原m。同时，每次的ri、si都是d bit的数，p是512bit。</p>
<p>由列表长度可以知道d就是32，所以r、s都是很小的量，因此自然想到消去m做一个HNP。消去的方式也很朴素，就是取第0组和第i组的等式：</p>
<script type="math/tex; mode=display">
c_0 = Q_0m + r_0R_0 + s_0S_0 \quad(mod\;p)</script><script type="math/tex; mode=display">
c_i = Q_im + r_iR_i + s_iS_i \quad(mod\;p)</script><p>分别将m前系数乘至相等：</p>
<script type="math/tex; mode=display">
Q_ic_0 = Q_iQ_0m + r_0Q_iR_0 + s_0Q_iS_0 \quad(mod\;p)</script><script type="math/tex; mode=display">
Q_0c_i = Q_0Q_im + r_iQ_0R_i + s_iQ_0S_i \quad(mod\;p)</script><p>然后作差就消掉m了，之后就是造个格子去做HNP就行。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">10580731215444436219213907263947534038012197972307836319229421193761088798378768844649759133142120180834573817149711299466707823017636232456526471274387917</span></span><br><span class="line">Q = [<span class="number">6718668664591596190749745980002066645380242844394957953766947533978323053938214647829798301606252456858132121628517723050462291300790766055200866765561610</span>, <span class="number">8738840830394886495658505803088103824478963010774845789433253508554356383249611502157307334585157729703873877797759121271071421201959116272886732798936523</span>, <span class="number">4388762712805764363921857352899834586382140923234814556069490536704913653848525595836491615636446563386705915348021173847271741862809075809151508973332816</span>, <span class="number">3663706247989213864330218414789109172658418861584264092087052781618522795676355371739296186667918464732397854703792563460353675590182379535358561615166754</span>, <span class="number">10397730940373180549512945920847346184926672474430866208628825035104473525758952069910968144296138220861205803231072660136999110567752870928953292888013817</span>, <span class="number">7950983396364741732874562189206547723862955251595526752956177377987683115942827501152009639962778147887569469649852864894630521759276627026901168996371682</span>, <span class="number">4533165373271154956275563812280832107592547920299130443910706773435844651231402604986107252454770256826684895729900344877444002682896222483157835711226276</span>, <span class="number">234527648838985018479849393379369972316648524004050156622962478277970628212208049885578895953447529009579881605066831810617219492342569126524704457098602</span>, <span class="number">870946394610707169333783318085559836426827503011955242395779894700298192587685130680102208909573921059078858816359885827349281892186755920839352494224983</span>, <span class="number">5025393101560564396356619431938053414422489109406396725377683594254768077793838379117179092536396259414266971990125716674162127500490058572594571364978294</span>, <span class="number">5914192169617888877888201158713062853387719050723973971874176184801960297380845845091259990664210178355882621876155306106794686897854891414999449337977781</span>, <span class="number">2315609284318723939818174971181608382568372323836754133265010413836452399043354382657889810068171230196496294710150903020084150025606782486579490225752163</span>, <span class="number">7278167622527482910919537896950398911672667355929695202886784227621290914468002099686668156909569183497765732237075799745632960354306268680765408194219074</span>, <span class="number">3334584846711780119716613440720851482199838919351927489954344426327712973616885459737471991960238971274273643566666607141850753561424427088261862873317161</span>, <span class="number">10418397794302836806813296591826255845845380563102199636140458670781241436466478273414138749593148481207713557016996462238845705251702717702279222414513227</span>, <span class="number">8928267741189301140931758366885435860144549752680480164627323600501278650103818630920534258909582593266779000356145650416276415560226176904904552964196921</span>, <span class="number">3371514716248416335324237152123624115597170761078576760713238311485522010416246207731778456501311675041827750001670698984335573888627309609534659722697174</span>, <span class="number">3802217515688979225517388823688564230191961273039428065604146662684362686419670392762755984078261072614619934671572327384351597903233780846163893180876244</span>, <span class="number">2363399549320749312563257796730356164186914867645487733176402567625567991193120859507532138374793392237469893062402307645814490930874653088116729203724851</span>, <span class="number">10221767730316631512882371487958453352895713655492241322139865275323706929127996334620105099751973217983332705204535216804829987329684674632121801754529472</span>, <span class="number">2309440702968799222696132507585555901684240893289264193546892279919675495689944211715270510347394465285317239758024734161176699837687742722383530547735726</span>, <span class="number">5768185970426887633783322939933762164095055854707759575404348181421158843802654199133776622565384843677610666356549368021172121302926969754865633752131083</span>, <span class="number">3229518654067354667224244723968136366109210341994628338992752927462431316675552817799465987425719486448276862390918033544772400219803600904202906882850710</span>, <span class="number">9261930571620802581580992489567043178258044978932724785185749415955521702331959591680386023118398455066896674799447994060060156036800986190467008880726445</span>, <span class="number">2202162000802916921896507108984564185119471354726317829850206292755815439071735424116041491064894922930900262540589602333676063925873357256494020426758849</span>, <span class="number">1449198886322850923273373987785167865779477069790726992542423846556138762913056524689998313112599261515223680429584445016474216381861998363527368722991846</span>, <span class="number">8372052560034461177472546395510480308837387803551378399004608402463282066003862653368875671946863748209051044725913651881213858335224750549176875818647614</span>, <span class="number">1554572177534183877889322947083536921680809086638640689433294150868422460719624621258231995856944045776876555664816113444481761122803489100212103150005950</span>, <span class="number">10304720995101153898600333216365877709018991122985401884049110267116778080162237155472336396606109372189653686733770775660895990549286854727042270667997449</span>, <span class="number">9702831715765050072649082617719386580543641764650576307262259428035281535816750758018451681417440458250169771442858047124693499821240155899358663466925522</span>, <span class="number">4983986466837077050816175727911146971276599399191126236666755181304580074902883995859030897874305902445659355326021836801836996577665092276845357389900055</span>, <span class="number">983210432268706135181772492997088637756153310076409721616450343187239073604891492532080986521255675448499887782529162112441952861587689660048849369850769</span>]</span><br><span class="line">R = [<span class="number">8922553268219903948421811612403588317187402276064169063400419617931637566221670948925221403527928336656976084021780421068421112325215152715630319708159148</span>, <span class="number">1960697234007608888633325436691320507012497445090151112947144246088597317322303593936974554881161091213718329061011703885436579261559669838148253146762736</span>, <span class="number">5876944865176517279136475269375710514719489457672467542904948332791352244229042691977616905122711469012731652511966060550749288338599104284986451669586397</span>, <span class="number">10560136356360422684127995001096871178761635291417665630629868184624616925939841693017240341233504589896610287855672892399213367967385666891688408976236926</span>, <span class="number">477096251733995832965266836067676961413182629438628989729801411920869543083075545758386996801847267554704996660190900105380190625423846876906822024677634</span>, <span class="number">7001514955678391252130680521301315254365131738168087539892724691183104608345983375763663321467662055864103520121513349630333839818372656472731157470876337</span>, <span class="number">3894488356665934776074291789545516608573077899099880057920210752197885106521699021123658077208789295954145485399473386424677782787720074605813565437678385</span>, <span class="number">6084641463140385894120457093933350076091808742065950836200598466936433741373700151235571333073965513559605688011967994215074945374832957951384088589789549</span>, <span class="number">6429023674027239778212676334778900557043774851747196071499704016422574667955121145943674677254291410204037372996870181094090300709994594837656541352954321</span>, <span class="number">974464046378184190666336249935678253753198649184272269465353741281529523364289314148552833155935080422698020734516538377662137879089845095565536185765703</span>, <span class="number">5275384626572520577089146723078373110279682903874445477027602487061203157331398955233780208890725281673434536867800450553737656852356536771518379108118530</span>, <span class="number">7195767683001605593626199889963767438584070902169912442665828755648712278523740276132000225353756257232761885567134364203207306842108602537457408438487869</span>, <span class="number">1960155276835684836483043402384876176138942980630724993481564836712252228823186653467973806509964860286129730847244573674203959835565358735171611743573721</span>, <span class="number">6414607819273473402861616605113355396690170400984793217629732347141796693554056264547151212348354332930126795040213921009711560216969452391748438893237750</span>, <span class="number">3344964019305423035551401397282638905496921053458747459062023331678484337724980196690184898986671355848101101352105363764794975082772539709853216580762130</span>, <span class="number">5599385562588302350377616767130563945375472947459594912838322011021483641484084692396462025157944023828872267520122213089523093591160284337483108416804096</span>, <span class="number">9490045098551912983475126253859124028793327975874647810947095579199208473971726763051464010595903748080632329362605820021188148160826282120484098519748832</span>, <span class="number">980400922804123638777377509067942595214234592161404114303498013065244168965487370334832921426484278913774963761155003569793282819717667783351454812080994</span>, <span class="number">2772369382727364487748752144766350276094463435156818133766210304998890765120785013435379746537938377688617479112518505844159436213691418873590807740501183</span>, <span class="number">2338271137215119073302625621754099128003710500967811947590498668688826448575898279561111743087002717955161536157254689000474464404087443266193145449601031</span>, <span class="number">11773104862539842923315548180471993854469651503131148446111338098437913152663007837927793233931818835121946274135336436554801339749906320765919816150768</span>, <span class="number">7022131435585860015767289025786078578929344550873832550705723505006303288639135070849692494020122369694090619694760175970759059981608871097298624956669246</span>, <span class="number">9062158671807923729547552523768819638817707994079942965412925347441853183471973898478745711676153003756450481351777543455041815438536630317647408008349357</span>, <span class="number">641428039466528875429106458292463262780539744201857515833377175893334510962304373010401729801987725599439620073783868719664061882399367340158128062151780</span>, <span class="number">9636846145225909579086917154824161374486916920345217833190333031690359415616710658317308376119096253360425924297858397657697468296746934075225665559206030</span>, <span class="number">480796179229094678008918831581475398488769027287954488301969143979307355466114726392701279092691566949082439457297527772794149828193400419285116237063338</span>, <span class="number">7726757640854263742178678415761753342099387727318458723726925176786999799204056696883433346568600944559959849253863013300907357120126559055735593380638961</span>, <span class="number">551534415366550033034654093228329954588738781407008585088422737955391043381667720876717529438845777841508116853874405455280903517864352822604194884203656</span>, <span class="number">2135598634800053933515509095633720732412542790075717247869348997292949946344227105219967710854885153055617943193159899627517699960920415492992774438014041</span>, <span class="number">1680242449902645450228202409049382139482100876672724104665964994414865664877710770701122475977142858601068246748276652246938681740022531970523695731126206</span>, <span class="number">436320498659370791836085607479390848415464961245449366885835640616716752879866126057724425537944356751844317980881005608075886211154052092270888058429787</span>, <span class="number">4102523817041969170017113001399252035243358293719837916039521471412151711746047572340376418109842112515873700164747338421862615679590520014959369523777063</span>]</span><br><span class="line">S = [<span class="number">4389820170235953517860364281419052587762385444517203945856665517072263529411621622474249480804818285716662154444854074939122170918939074730520091008754679</span>, <span class="number">10274488321950407401790238304858775303749809597573328350457719402010568443492374388509295355784873292280254116167747959663379913408799485392015111636115272</span>, <span class="number">7413556897779783875511997253964328306011661062497568739340607424890313315434489440969977560260194970241163209968988660276109536299848001455072705137702052</span>, <span class="number">10385679419514177727801069016719283683697529805734389950368725106396939072509839502286093730172215158898251533786500497578747904349856564856054102927847131</span>, <span class="number">6386209810414906928429352824399745808560059492214757951425372272591372428785367326567204502131184260857447725722068674542931096991341451850846209503213310</span>, <span class="number">699060860182347708294712482476262878008951502586470987307146194685783850677219935862211847525612405824474382122868643521962157410369483858428437433802395</span>, <span class="number">3482063900392942412450041046839813864192488604261419419162091087116878838189062406913587662602295096636481252242577251563441565388543873530900962308450590</span>, <span class="number">5752782775722534186844731777766684686828626762801341093006843547008915880093927377014105260314050196609699164926717998841388194942556402699285523644651583</span>, <span class="number">4477944786670422304592908174461368396168580171651041832449759231077050962444090886920563302603784981035116689839335069690875797644553684152368376089740517</span>, <span class="number">5663531682848751034979876476955107364567717396957230368140915480695954150088052156264521615690161327525898382714131905580517915060427960250740110846321921</span>, <span class="number">5343294510843224726960051115907810365241970373986845465490090821566645536683695042467985025063439338770116316455211944030125820601506874250685838077414765</span>, <span class="number">8432688027895892738831218358369397874948328355540048945541749304849571948638169902486647265119397307193449002927427840453857643697175667051504836511635801</span>, <span class="number">8974418251288081645329898313903422373193272601106837017923535786950979222125740970411725976034947989767143786286397290996756916960291029965672692318584390</span>, <span class="number">3367471493907450997862234076499110882206518716388236141312548251406626961838619595519805436447472248133422979102036617759221276869918910189482246041609756</span>, <span class="number">9787518698663334219763616437865759554315749369906898604904977007297368987715422535407542350049111845605011307829034744443271718643291528381794716569586150</span>, <span class="number">7423298611637442306439453382713995476685370148677494272333567929180589186347708172471032286209947149761644993151042408431548488945145292037694546868884030</span>, <span class="number">5591656321514817104832226351286824953278894430528912246855770091334337189386156994498331013600732669813560603667226878637404391237947398475280409452591013</span>, <span class="number">6425108527382412819259579180312607504985609322110590326058191420486308943785080395001318724782575187718535133704219706236946232717333616646838328259100174</span>, <span class="number">1986072520726417425427679478185786673218113837249425820170849864471171328875606626923270664642579676457285438864056080352157246995774517812392120146048999</span>, <span class="number">5085759490547346080963649291763871068034757573012867868532204864022791365366745839456310985148663327808561601274994541505734129506831803550600738607170703</span>, <span class="number">6883330982174382523423400136207766091739299571009207949454774998664997037115272990237878573502506026799645646664956134682833693219974019271740996314084220</span>, <span class="number">3008412285222633004812698063455902388460013611944185187747762649311442328686187279186972723448077521425052318221865300502697494418867793831761784796146329</span>, <span class="number">9547325670583212399117684599284936334790443591395268814958834705867928621240882386996085347052830889322724160452729359284992294890584292625829913315628265</span>, <span class="number">1387461799657365419593288084566026147529011675413652640829187706708872066267641962620159408303872024421411747751690792902149761832079721583778430712988299</span>, <span class="number">2093635222672050417361673475374966389314266702410603863643637918543784930893405832179904330416148995313591588929177333026382745340633946128791737631559286</span>, <span class="number">8413424329301946557805781268429552577339778139904799140486659388945506980343653897206690153402822892272378378085908749995513711021119914769801970795906117</span>, <span class="number">6743445162380434316634371637355512041805280159276931422012464596435558338432827675791139455542184532473287436049595748235961499758716697674776760822162391</span>, <span class="number">1706184129470213725753097073154985919221181897433450716898208607625832464228411992900434982560203334218404626447424408012817411257665032706434306723906871</span>, <span class="number">1188503046129710474378492502021666062040985983530761819828342979325166292485440608536173516789179154601587903599847267180858095017007891547798890802090080</span>, <span class="number">6398862094282462456834873185064362330936738060688527379705123125559724680574585721467123968313071365176318010618981170019917278363707049487278610027058585</span>, <span class="number">1827205671808118170959457466922915851906256049105694256301380823860317738339383848734269783842511423911532135506082729000044271560428423457063013176002958</span>, <span class="number">4296939764995860347968082436772567300063081379392577066061720737920992283479200350022263164173968370055486217109628430523063986426005741344085155171587948</span>]</span><br><span class="line">C = [<span class="number">2312453804397990204892582347458673184184584053391181580849656202381982276483135032773767708029907426388840618138608941250788745829088238589339462137662516</span>, <span class="number">10523194306636352419831471584744199603299973937259007033119401866043123235256118686290774285411893111835433604432082195914308420845569896693674208644701928</span>, <span class="number">8625321422409900297730698589684636810222608572364004227411854906715574297306124060030713845833976664653817196364988412308992879167741430256046508164902265</span>, <span class="number">2203036357494864574281685606458518951592160562338358743010726696365683441724958156704554110208947394458113054047499157258753175446414976136008162642109757</span>, <span class="number">7440676439428237992864596387460092947449968530635365999432104198675297081825315672568959667296286389774687367936168132053293001589687795737604457160906082</span>, <span class="number">2264157050840270501520646271743213633490605461967539030408028006097728678459599299655371587125945029431528702214373899493252891890106222569122603386717360</span>, <span class="number">6089828885562252420652081197249651438359320954630388805129416420415135298321118452771481678140904854945253504361325478946359729157231808943846058944117026</span>, <span class="number">10539688120079451218718476929576210805778407047878263373562960368159158621424931104363627052374700437454925765616146962059684388174993415278124860987310938</span>, <span class="number">6303692164422236243124789748609418445914012315334563733630138248326249660310698584154622748275297380026916444293448955157206727703202478794453250926439643</span>, <span class="number">881942845076614931271891025655927553295291244201690295230440723375006916146507322259936249039275621554840488955637696630030022348109669072833863866985225</span>, <span class="number">10106348190249831893088197931090851286229747534150777530156601113972916238286905365616240501204440809598108220364456446320022747806334510176621958436096123</span>, <span class="number">8324531392881516178541244041903222514911964835924579628962940318936570586739198442236357026438613345385230182029810965182157993322744038688573053225547374</span>, <span class="number">5078708553426349749719952343873018594648548601008242439539543130067536764970709366523519348572603124221309659983256536103306454063139670063244331611755453</span>, <span class="number">8542547993117228744822361667182819410791296436924016725757178153507707272004493213120780743910507865839367749205817741703451968423781285521621014600059589</span>, <span class="number">3073352723766074586873446203285051955281142348730058300259816322651361605792426446390729367386148254808552616968786890277451301146248756651016086606742804</span>, <span class="number">5269945451683706496607356863109615383647000556701922770404180133092195426319754674753614204346587769298246334991876508268642550219392732660290378353338400</span>, <span class="number">6262348731181694593163187372863680743743096474259867989757989072530511417286900866334036812204673457159090130621478933266270029789176903023636735673595513</span>, <span class="number">3297899863181037954379261853482229450757449782777910450819629975965660022355584717412057615899333569245281976118829898854119850433763380827003244277020101</span>, <span class="number">7487260566995972228255217362172107520309457024141075543923988636564806307827017535285595701845830793533604534902349660541692391232785351590333159515799384</span>, <span class="number">10324279404125558600858330541468243667961239247663241031255287540601841176203292036413076990028875224629890818418992943759206077129550049357885152924273782</span>, <span class="number">8044925106089251438446731137002808317322635126054485149617494154471416674741758172633019611642437845768869330746423337854351186668227486117398013073824286</span>, <span class="number">4234270952814400783009242730655483882561531800274439758860142245952005010632014464198770218689605527760730047723966950012227395838571254801244673898812828</span>, <span class="number">638896609043108497262778277770178050665854883307447937008504779907661322405672174519391657570064336725509768185637608044022219246206471015980252602095129</span>, <span class="number">5180216795602211214280366461349507739255238657924206736673167715462995927060334503420979145327254053283011116720223275075476559911219732336496503542596869</span>, <span class="number">4889582376915206124736222022750168286228699065224704085027955184917144323557844593386817223260498520607466742269645929630472738644444652704289510157100913</span>, <span class="number">5012604326308554636339480431591200785633930724891396744558818436357664982175033998281443810436271724799610836412819040278374041390604150781759163613994682</span>, <span class="number">3219038638665180576932584279254771209098300305384572525709292133614238552451580810601286362213655499134538083785424726484119059950676285763438331520089227</span>, <span class="number">6419694420004223063062285264931096360778228156157853232796125041025067958687740255716444718822744614217377927689465894996156144384079594697465808095114901</span>, <span class="number">9910546009146267464166501179537825349776178695164070160517872596078275117785713000045215455672195660329319962408970209137481672915542900445933477806115760</span>, <span class="number">1420603945244588398788478464408905133932325733716125030735921688979482121297328679317495694245547716568441401137633433150951713462958551532394178628021900</span>, <span class="number">6208847506587273852328049116772424002595270959861992270025537759079430511161476024600259347318966551584005222005704567718008394909230998308545154993159673</span>, <span class="number">10385926333158107236552504228168776101396372491461292301486697050842973861408756486936932908479675556344542947425765714101814836237112561730341100901890350</span>]</span><br><span class="line"></span><br><span class="line">d = <span class="built_in">len</span>(C)</span><br><span class="line">nums = <span class="built_in">len</span>(C)</span><br><span class="line"></span><br><span class="line">L = Matrix(ZZ,<span class="number">3</span>*nums,<span class="number">3</span>*nums)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*nums):</span><br><span class="line">    L[i,i] = <span class="number">1</span></span><br><span class="line">L[<span class="number">2</span>*nums,<span class="number">2</span>*nums] = <span class="number">2</span>^<span class="number">32</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,nums):</span><br><span class="line">    L[<span class="number">0</span>,<span class="number">2</span>*nums+i] = R[<span class="number">0</span>]*Q[i]</span><br><span class="line">    L[<span class="number">1</span>,<span class="number">2</span>*nums+i] = S[<span class="number">0</span>]*Q[i]</span><br><span class="line">    L[<span class="number">2</span>*i,<span class="number">2</span>*nums+i] = -R[i]*Q[<span class="number">0</span>]</span><br><span class="line">    L[<span class="number">1</span>+<span class="number">2</span>*i,<span class="number">2</span>*nums+i] = -S[i]*Q[<span class="number">0</span>]</span><br><span class="line">    L[<span class="number">2</span>*nums,<span class="number">2</span>*nums+i] = C[i]*Q[<span class="number">0</span>] - C[<span class="number">0</span>]*Q[i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,nums):</span><br><span class="line">    L[-i,-i] = p</span><br><span class="line">L[:,-<span class="number">1</span>:] *= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = L.LLL()</span><br><span class="line">r0,s0 = res[<span class="number">0</span>][<span class="number">0</span>],res[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">m = (C[<span class="number">0</span>] - r0*R[<span class="number">0</span>] - s0*S[<span class="number">0</span>])*inverse(Q[<span class="number">0</span>],p) % p</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;3X7eNdED_H!dD3n_nNm8eR_pR0Bl3m_iN_CCTF!!&#125;</span></span><br></pre></td></tr></table></figure>
<p>可以看到m其实也不大，所以不消m直接规约也可以。</p>
<p><br></p>
<h3 id="Joe-19-120-solves-47-pts"><a href="#Joe-19-120-solves-47-pts" class="headerlink" title="Joe-19(120 solves , 47 pts)"></a>Joe-19(120 solves , 47 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Joe-19 is a cryptographic system that leverages a top-secret version of GPT AI technology to develop advanced and robust cryptographic tools.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> GPT <span class="keyword">import</span> GPT6 <span class="comment"># deep fake </span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">P = [GPT6(<span class="string">&#x27;A 512-bit prime appears in consecutive digits of e&#x27;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">n, m = prod(P), bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, <span class="number">0x10001</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>output.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n = 8098851734937207931222242323719278262039311278408396153102939840336549151541408692581651429325092535316359074019383926520363453725271849258924996783681725111665666420297112252565291898169877088446887149672943461236879128453847442584868198963005276340812322871768679441501282681171263391133217373094824601748838255306528243603493400515452224778867670063040337191204276832576625227337670689681430055765023322478267339944312535862682499007423158988134472889946113994555274385595499503495488202251032898470224056637967019786473820952632846823442509236976892995505554046850101313269847925347047514591030406052185186963433</span><br><span class="line">c = 7109666883988892105091816608945789114105575520302872143453259352879355990908149124303310269223886289484842913063773914475282456079383409262649058768777227206800315566373109284537693635270488429501591721126853086090237488579840160957328710017268493911400151764046320861154478494943928510792105098343926542515526432005970840321142196894715037239909959538873866099850417570975505565638622448664580282210383639403173773002795595142150433695880167315674091756597784809792396452578104130341085213443116999368555639128246707794076354522200892568943534878523445909591352323861659891882091917178199085781803940677425823784662</span><br></pre></td></tr></table></figure>
<p>看这题的时候一脸懵逼，这意思是不是用65537去连续拼接得到一个512bit的素数p？尝试了一下无果之后就先跑去做别的题目了。</p>
<p>之后回来看发现已经被@Astrageldon解决了，不过文档里没有写过程。之后又问了下<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ZimaBlue">@Zima</a>，他告诉我可以：</p>
<p><img src="/post/cf09b856/image-20240630113251927.png" alt="image-20240630113251927"></p>
<p>XD</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">8098851734937207931222242323719278262039311278408396153102939840336549151541408692581651429325092535316359074019383926520363453725271849258924996783681725111665666420297112252565291898169877088446887149672943461236879128453847442584868198963005276340812322871768679441501282681171263391133217373094824601748838255306528243603493400515452224778867670063040337191204276832576625227337670689681430055765023322478267339944312535862682499007423158988134472889946113994555274385595499503495488202251032898470224056637967019786473820952632846823442509236976892995505554046850101313269847925347047514591030406052185186963433</span></span><br><span class="line">c = <span class="number">7109666883988892105091816608945789114105575520302872143453259352879355990908149124303310269223886289484842913063773914475282456079383409262649058768777227206800315566373109284537693635270488429501591721126853086090237488579840160957328710017268493911400151764046320861154478494943928510792105098343926542515526432005970840321142196894715037239909959538873866099850417570975505565638622448664580282210383639403173773002795595142150433695880167315674091756597784809792396452578104130341085213443116999368555639128246707794076354522200892568943534878523445909591352323861659891882091917178199085781803940677425823784662</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">7728751393377105569802455757436190501772466214587592374418657530064998056688376964229825501195065837843125232135309371235243969149662310110328243570065781</span></span><br><span class="line">q = <span class="number">9688632098638681429535439991332657144752666147923336383829750592576742104399942931057096761773496510622226977570278994077236841491368959008277469453600569</span></span><br><span class="line">r = <span class="number">10019005372961705640183251650710051163228093250949727357306333102512304273058618645339800283588040423877666492199352609508401454089083503146788384653241593</span></span><br><span class="line">s = <span class="number">10795109107229646654467923653403055635071360620150038008453082390943756377071343139771120080956310498862485323957447467376538994662280143050510681877597429</span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c, inverse(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)*(s-<span class="number">1</span>)), n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;ASIS_h1r3_7aL3nT5_t0_cO1La8orAt3_!N_Crypto_CTF!&#125;</span></span><br></pre></td></tr></table></figure>
<p>之后看<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/702939109">春哥的wp</a>才知道题面的e说的是自然对数那个e，所以预期应该是要枚举这个数字的连续bit去找素数。</p>
<p><br></p>
<h3 id="Melek-66-solves-73-pts"><a href="#Melek-66-solves-73-pts" class="headerlink" title="Melek(66 solves , 73 pts)"></a>Melek(66 solves , 73 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Melek is a secret sharing scheme that may be relatively straightforward to break - what are your thoughts on the best way to approach it?</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, nbit</span>):</span><br><span class="line">	m, p = bytes_to_long(msg), getPrime(nbit)</span><br><span class="line">	<span class="keyword">assert</span> m &lt; p</span><br><span class="line">	e, t = randint(<span class="number">1</span>, p - <span class="number">1</span>), randint(<span class="number">1</span>, nbit - <span class="number">1</span>)</span><br><span class="line">	C = [randint(<span class="number">0</span>, p - <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(t - <span class="number">1</span>)] + [<span class="built_in">pow</span>(m, e, p)]</span><br><span class="line">	R.&lt;x&gt; = GF(p)[]</span><br><span class="line">	f = R(<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t): f += x**(t - i - <span class="number">1</span>) * C[i]</span><br><span class="line">	P = [<span class="built_in">list</span>(<span class="built_in">range</span>(nbit))]</span><br><span class="line">	shuffle(P)</span><br><span class="line">	P = P[:t]</span><br><span class="line">	PT = [(a, f(a)) <span class="keyword">for</span> a <span class="keyword">in</span> [randint(<span class="number">1</span>, p - <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(t)]]</span><br><span class="line">	<span class="keyword">return</span> e, p, PT</span><br><span class="line"></span><br><span class="line">nbit = <span class="number">512</span></span><br><span class="line">enc = encrypt(flag, nbit)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>output太长就不放在这，可以去NSSCTF下载附件。</p>
<p>这个题目过于直白，首先在模p下建立一个度为t-1的多项式f，其中常数项是flag加密后的密文，其他系数均未知。然后随机给出了t个点值对，并且给了e、p的值。显然拉格朗日插值过后再对e求一次关于p-1的逆就行。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e,p,PT = </span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">recover_f = PR.lagrange_polynomial(PT)</span><br><span class="line">c = recover_f(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">m2 = <span class="built_in">pow</span>(c,inverse(e//<span class="number">2</span>,p-<span class="number">1</span>),p)</span><br><span class="line">PR.&lt;y&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f = y^<span class="number">2</span> - m2</span><br><span class="line">res = f.roots()</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(res[<span class="number">1</span>][<span class="number">0</span>])))</span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;SSS_iZ_4n_3fF!ciEn7_5ecr3T_ShArIn9_alGorItHm!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Nabat-25-solves-159-pts"><a href="#Nabat-25-solves-159-pts" class="headerlink" title="Nabat(25 solves , 159 pts)"></a>Nabat(25 solves , 159 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Nabat is a cryptographic challenge that explores the representation of polynomials within a specific polynomial ring structure.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>(): </span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">randstr</span>(<span class="params">l</span>):</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([printable[randint(<span class="number">0</span>, <span class="number">90</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">f, l</span>):</span><br><span class="line">	R = PolynomialRing(ZZ, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">	f, g = R(f), R(x^<span class="number">2</span> + x + <span class="number">2</span>)</span><br><span class="line">	coefs = f.<span class="built_in">list</span>()</span><br><span class="line">	_b1 = <span class="built_in">all</span>(<span class="built_in">abs</span>(_) &lt;= <span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> coefs)</span><br><span class="line">	_b2 = f.degree() + <span class="number">1</span> - <span class="number">2</span> * n(log(l)) &gt;= <span class="number">0</span></span><br><span class="line">	_b3 = coefs.count(<span class="number">0</span>) &gt;= <span class="number">2</span> * f.degree() // <span class="number">3</span> - <span class="number">3</span></span><br><span class="line">	_b4 = (f - l) % g == <span class="number">0</span></span><br><span class="line">	<span class="keyword">if</span> _b1 <span class="keyword">and</span> _b2 <span class="keyword">and</span> _b3 <span class="keyword">and</span> _b4:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;┃&quot;</span></span><br><span class="line">	pr(        <span class="string">&quot;┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓&quot;</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;Welcome to the NABAT challenge, your mission is to validate the main&quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;check function in the provided system, Try your best to find flag :)&quot;</span>, border)</span><br><span class="line">	pr(        <span class="string">&quot;┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛&quot;</span>)</span><br><span class="line">	step = <span class="number">12</span></span><br><span class="line">	R = PolynomialRing(ZZ, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">	pr(border, <span class="string">f&quot;Send a polynomial that satisfies the check function for each given `n&#x27;.&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, step):</span><br><span class="line">		n = randint(<span class="number">2</span>**i, <span class="number">2</span>**(i + <span class="number">1</span>))</span><br><span class="line">		pr(border, <span class="string">f&quot;Your are in step <span class="subst">&#123;i&#125;</span> and n = <span class="subst">&#123;n&#125;</span>, please send the polynomial f:&quot;</span>)</span><br><span class="line">		_f = sc().decode()</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			_f = R(_f)</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			die(border, <span class="string">f&quot;The polynomial you provided is is not valid!&quot;</span>)</span><br><span class="line">		_b = check(_f, n)</span><br><span class="line">		<span class="keyword">if</span> _b:</span><br><span class="line">			<span class="keyword">if</span> i == step - <span class="number">1</span>:</span><br><span class="line">				die(border, <span class="string">f&#x27;Congrats, you got the flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				pr(border, <span class="string">f&#x27;You have successfully passed step <span class="subst">&#123;i&#125;</span>. Please proceed to the next step :)&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">f&quot;Your input does not meet the requirements!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>题目有12轮挑战，每轮挑战会先生成一个随机数n(随着轮数变大)，需要给出一个多项式f，f满足四个条件就可以通过本轮挑战：</p>
<ul>
<li>所有系数需要为1，0，-1</li>
<li>f的度d要大于等于$2logn - 1$</li>
<li>系数为0的数量要大于等于$\lfloor \frac{2d}{3} \rfloor-3$</li>
<li>f-n是g的因子</li>
</ul>
<p>其中，g是：</p>
<script type="math/tex; mode=display">
x^2 + x + 2</script><p>和其他商环类题一样的思路，由于在模g下有：</p>
<script type="math/tex; mode=display">
x^2 + x + 2 = 0 \quad(mod \; g)</script><p>所以：</p>
<script type="math/tex; mode=display">
x^2 + x = -2 \quad(mod \; g)</script><p>同理就有：</p>
<script type="math/tex; mode=display">
x^{i+2} + x^{i+1} = -2x^i \quad(mod \; g)</script><p>所以说其实整个多项式f的系数的产生过程，其实可以看作是从常数n开始的向高次项系数的迭代。而为了满足剩下三个要求，通俗一点来说就是要迭代的越彻底越好，也就是每一项的系数都要尽可能消成0。</p>
<p>那就从常数n开始思考，假设他约减了k0个2之后变成1、0或者-1，记这个系数为a0，也就是：</p>
<script type="math/tex; mode=display">
n - 2k_0 = a_0 \quad a_0 \in \{1,0,-1\}</script><p>那么接下来，一次项和二次项的系数就变成了k0，对于一次项来说，其约减k1个2之后变成a1，a1同样只能取1、0或者-1，那么这个k1又会贡献给二次项和三次项，所以二次项会从k0+k1开始约减，依此类推。整个多项式系数就会变成如下的线性迭代过程：</p>
<script type="math/tex; mode=display">
(1,k_0,k_1,...k_{d-2})
\left(\begin{matrix}
1&n\\
&2&1&1\\
&&2&1&1\\
&&&2&1&1\\
&&&&\ddots&\ddots&\ddots\\
&&&&&2&1&1\\

\end{matrix}\right)
=
(1,a_0,a_1,...,a_d)</script><p>所以对上面的格进行规约就可以得到需要的结果。至于度怎么选择，为了满足题目条件的话应该是越大越好？这里我取了400。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">f, l</span>):</span><br><span class="line">    R = PolynomialRing(ZZ, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">    f, g = R(f), R(x^<span class="number">2</span> + x + <span class="number">2</span>)</span><br><span class="line">    coefs = f.<span class="built_in">list</span>()</span><br><span class="line">    _b1 = <span class="built_in">all</span>(<span class="built_in">abs</span>(_) &lt;= <span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> coefs)</span><br><span class="line">    _b2 = f.degree() + <span class="number">1</span> - <span class="number">2</span> * <span class="built_in">int</span>(log(l)) &gt;= <span class="number">0</span></span><br><span class="line">    _b3 = coefs.count(<span class="number">0</span>) &gt;= <span class="number">2</span> * f.degree() // <span class="number">3</span> - <span class="number">3</span></span><br><span class="line">    _b4 = (f - l) % g == <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> _b1 <span class="keyword">and</span> _b2 <span class="keyword">and</span> _b3 <span class="keyword">and</span> _b4:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getf</span>(<span class="params">l</span>):</span><br><span class="line">    d = <span class="number">400</span></span><br><span class="line">    <span class="keyword">assert</span> d &gt; <span class="number">2</span>*<span class="built_in">int</span>(log(l)) + <span class="number">1</span></span><br><span class="line">    L = Matrix(ZZ,d,d+<span class="number">2</span>)</span><br><span class="line">    L[<span class="number">0</span>,<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    L[<span class="number">0</span>,<span class="number">1</span>] = l</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,d):</span><br><span class="line">        L[i,i] = <span class="number">2</span></span><br><span class="line">        L[i,i+<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">        L[i,i+<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">    res = L.LLL()</span><br><span class="line">    </span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(ZZ)</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">if</span> v[<span class="number">0</span>] == -<span class="number">1</span>:</span><br><span class="line">            v = -v</span><br><span class="line">        <span class="keyword">elif</span> v[<span class="number">0</span>] == <span class="number">1</span>:</span><br><span class="line">            f = PR(v[<span class="number">1</span>:].<span class="built_in">list</span>())</span><br><span class="line">            <span class="keyword">if</span> check(f, l):</span><br><span class="line">                <span class="keyword">return</span> f</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">step = <span class="number">12</span></span><br><span class="line">R = PolynomialRing(ZZ, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, step):</span><br><span class="line">    n = randint(<span class="number">2</span>**i, <span class="number">2</span>**(i + <span class="number">1</span>))</span><br><span class="line">    f = getf(n)</span><br><span class="line">    <span class="built_in">print</span>(i,f)</span><br></pre></td></tr></table></figure>
<p>这个题目赛中的时候，在未更新之前，其实一共需要通过40轮，并且条件3限制为：</p>
<ul>
<li>系数为0的数量要大于等于$\lfloor \frac{2d}{3} \rfloor$</li>
</ul>
<p>可以用这个方法检查一下，发现通过概率低了很多很多。赛中<a target="_blank" rel="noopener" href="https://wleukocytec.github.io/">@leukocyte</a>和<a target="_blank" rel="noopener" href="https://hash-hash.github.io/">@hash-hash</a>也是利用三值多项式来约减系数，不过应该是用了另一个策略来满足后三个条件。然后大家一起挂那个脚本，最好的时候也就挂到了28轮。看discord才发现果然又是题的问题。</p>
<p><br></p>
<h3 id="Nazdone-35-solves-122-pts"><a href="#Nazdone-35-solves-122-pts" class="headerlink" title="Nazdone(35 solves , 122 pts)"></a>Nazdone(35 solves , 122 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Nazdone is a cryptographic exercise focused on the practical challenges of generating random prime numbers for real-world applications.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> params, flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sol</span>(<span class="params">m, a, z</span>):</span><br><span class="line">	p = m * (a - <span class="number">1</span>) % <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		R = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, a))</span><br><span class="line">		shuffle(R)</span><br><span class="line">		<span class="keyword">for</span> r <span class="keyword">in</span> R[:z]:</span><br><span class="line">			p += getRandomRange(<span class="number">0</span>, <span class="number">2</span>) * m ** r</span><br><span class="line">		<span class="keyword">if</span> isPrime(p):</span><br><span class="line">			<span class="keyword">return</span> p</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			p = m * (a - <span class="number">1</span>) % <span class="number">2</span> + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p, q, r = [sol(*params) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;007&#x27;</span>]</span><br><span class="line">n = p * q * r</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, params[<span class="number">0</span>] ** <span class="number">3</span> + params[<span class="number">2</span>] - <span class="number">2</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>output.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n = 301929748923678449872944933611657670834216889867340028357609265175830693931365828840717548752313862343315133541384709574659039910206634528428504034051556622114290811586746168354731258756502196637977942743110508997919976400864419640496894428180120687863921269087080600917900477624095004141559042793509244689248253036809126205146653922738685595903222471152317095497914809983689734189245440774658145462867680027337</span><br><span class="line">c = 104375152140523502741159687674899095271676058870899569351687154311685938980840028326701029233383897490722759532494438442871187152038720886122756131781086198384270569105043114469786514257765392820254951665751573388426239366215033932234329514161827069071792449190823827669673064646681779764841034307000600929149689291216313319444583032339045277433847691961234044840927155960887984372868669401051358701522484473320</span><br></pre></td></tr></table></figure>
<p>题目的params由三个未知量m、a、z构成，利用这三个值生成了三个素数p、q、r，具体生成过程也就是sol函数，流程是：</p>
<ul>
<li><p>取p初始值，为1或者2</p>
</li>
<li><p>随机打乱1到a的列表，并取前z项，记为a1,a2,…,az，之后将p加上如下值：</p>
<script type="math/tex; mode=display">
\sum_{i=1}^{z}{b_i}m^{a_i}</script><p>其中bi是随机的0或者1</p>
</li>
<li><p>检查p是否是素数，是的话就返回</p>
</li>
</ul>
<p>可以看出，其实p就等于：</p>
<script type="math/tex; mode=display">
1 + \sum_{i=1}^{z}{b_i}m^{a_i}</script><p>或者：</p>
<script type="math/tex; mode=display">
2 + \sum_{i=1}^{z}{b_i}m^{a_i}</script><p>而p、q、r都是这种类型的素数，其乘积构成n。最后按如下方式加密：</p>
<script type="math/tex; mode=display">
c = flag^{m^3 + z - 2} \quad (mod\;n)</script><p>仅给出n、c，要求还原flag。</p>
<p>首先，对于params的三个参数m、a、z可以说是一无所知，必须要利用n来还原他们，还原的依据就是p、q、r满足的等式。不妨假设他们都是第一种类型(第二种同理)，那么n就该等于：</p>
<script type="math/tex; mode=display">
n = (1 + \sum_{i=1}^{z}{b_{pi}}m^{a_{pi}})(1 + \sum_{i=1}^{z}{b_{qi}}m^{a_{qi}})(1 + \sum_{i=1}^{z}{b_{ri}}m^{a_{ri}})</script><p>可以看出，如果进行展开的话，在模m下n就为1(如果是第二种类型就为8)，因此我们可以简单爆破一下，就可以拿到m：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">301929748923678449872944933611657670834216889867340028357609265175830693931365828840717548752313862343315133541384709574659039910206634528428504034051556622114290811586746168354731258756502196637977942743110508997919976400864419640496894428180120687863921269087080600917900477624095004141559042793509244689248253036809126205146653922738685595903222471152317095497914809983689734189245440774658145462867680027337</span></span><br><span class="line">c = <span class="number">104375152140523502741159687674899095271676058870899569351687154311685938980840028326701029233383897490722759532494438442871187152038720886122756131781086198384270569105043114469786514257765392820254951665751573388426239366215033932234329514161827069071792449190823827669673064646681779764841034307000600929149689291216313319444583032339045277433847691961234044840927155960887984372868669401051358701522484473320</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">2000</span>):</span><br><span class="line">    <span class="keyword">if</span>(n % m == <span class="number">1</span> <span class="keyword">or</span> n % m == <span class="number">8</span>):</span><br><span class="line">        <span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure>
<p>但是这样可以发现备选项还是有一点多，这个时候就要利用另一个事实，也就是bi只会是0或1这个条件。仍然用第一种情形进行讨论，n减去1后，他应该是一个较稀疏的m进制数才对(第二种类型则为n-8)。所以可以优化一下刚才的脚本来得到更符合要求的m：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getbase</span>(<span class="params">num,base</span>):</span><br><span class="line">    li = []</span><br><span class="line">    <span class="keyword">while</span>(num &gt; <span class="number">0</span>):</span><br><span class="line">        li.append(num % base)</span><br><span class="line">        num //= base</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(li)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">301929748923678449872944933611657670834216889867340028357609265175830693931365828840717548752313862343315133541384709574659039910206634528428504034051556622114290811586746168354731258756502196637977942743110508997919976400864419640496894428180120687863921269087080600917900477624095004141559042793509244689248253036809126205146653922738685595903222471152317095497914809983689734189245440774658145462867680027337</span></span><br><span class="line">c = <span class="number">104375152140523502741159687674899095271676058870899569351687154311685938980840028326701029233383897490722759532494438442871187152038720886122756131781086198384270569105043114469786514257765392820254951665751573388426239366215033932234329514161827069071792449190823827669673064646681779764841034307000600929149689291216313319444583032339045277433847691961234044840927155960887984372868669401051358701522484473320</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">2000</span>):</span><br><span class="line">    <span class="keyword">if</span>(n % m == <span class="number">1</span>):</span><br><span class="line">        li = getbase(n-<span class="number">1</span>,m)</span><br><span class="line">        <span class="built_in">print</span>(m,li)</span><br><span class="line">    <span class="keyword">elif</span>(n % m == <span class="number">8</span>):</span><br><span class="line">        li = getbase(n-<span class="number">8</span>,m)</span><br><span class="line">        <span class="built_in">print</span>(m,li)</span><br></pre></td></tr></table></figure>
<p>输出的数据是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> <span class="number">706</span></span><br><span class="line"><span class="number">3</span> <span class="number">862</span></span><br><span class="line"><span class="number">4</span> <span class="number">1059</span></span><br><span class="line"><span class="number">6</span> <span class="number">1226</span></span><br><span class="line"><span class="number">8</span> <span class="number">1629</span></span><br><span class="line"><span class="number">9</span> <span class="number">1744</span></span><br><span class="line"><span class="number">12</span> <span class="number">2004</span></span><br><span class="line"><span class="number">18</span> <span class="number">2954</span></span><br><span class="line"><span class="number">19</span> <span class="number">839</span></span><br><span class="line"><span class="number">24</span> <span class="number">3424</span></span><br><span class="line"><span class="number">29</span> <span class="number">3960</span></span><br><span class="line"><span class="number">36</span> <span class="number">4296</span></span><br><span class="line"><span class="number">53</span> <span class="number">6012</span></span><br><span class="line"><span class="number">58</span> <span class="number">6201</span></span><br><span class="line"><span class="number">72</span> <span class="number">7464</span></span><br><span class="line"><span class="number">87</span> <span class="number">9354</span></span><br><span class="line"><span class="number">106</span> <span class="number">10491</span></span><br><span class="line"><span class="number">116</span> <span class="number">11106</span></span><br><span class="line"><span class="number">159</span> <span class="number">15052</span></span><br><span class="line"><span class="number">174</span> <span class="number">15315</span></span><br><span class="line"><span class="number">212</span> <span class="number">18447</span></span><br><span class="line"><span class="number">232</span> <span class="number">18933</span></span><br><span class="line"><span class="number">261</span> <span class="number">22756</span></span><br><span class="line"><span class="number">318</span> <span class="number">25573</span></span><br><span class="line"><span class="number">348</span> <span class="number">28334</span></span><br><span class="line"><span class="number">361</span> <span class="number">8489</span></span><br><span class="line"><span class="number">424</span> <span class="number">34794</span></span><br><span class="line"><span class="number">477</span> <span class="number">37056</span></span><br><span class="line"><span class="number">522</span> <span class="number">38266</span></span><br><span class="line"><span class="number">607</span> <span class="number">42389</span></span><br><span class="line"><span class="number">636</span> <span class="number">49836</span></span><br><span class="line"><span class="number">696</span> <span class="number">47656</span></span><br><span class="line"><span class="number">954</span> <span class="number">67644</span></span><br><span class="line"><span class="number">1044</span> <span class="number">76347</span></span><br><span class="line"><span class="number">1272</span> <span class="number">85161</span></span><br><span class="line"><span class="number">1537</span> <span class="number">93384</span></span><br><span class="line"><span class="number">1908</span> <span class="number">119410</span></span><br></pre></td></tr></table></figure>
<p>可以看出m很可能等于19。</p>
<p>然后用.log检查一下n在19进制下的最大次数，可以发现是321，说明p、q、r三个素数的次数差不多都在107左右。而又因为作为m进制的数字，其系数都为0或1，因此就只需要做个深搜即可，深搜思路和二进制下深搜基本没差：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">pl,ql,rl,h</span>):</span><br><span class="line">    <span class="keyword">if</span>(h &gt; <span class="number">200</span>):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    mask = m**h</span><br><span class="line">    <span class="keyword">if</span>(pl*ql*rl % mask != n % mask):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(n % pl == <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(pl)</span><br><span class="line">    <span class="keyword">if</span>(n % ql == <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(ql)</span><br><span class="line">    <span class="keyword">if</span>(n % rl == <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(rl)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                    find(i*<span class="number">19</span>**h+pl,j*<span class="number">19</span>**h+ql,k*<span class="number">19</span>**h+rl,h+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">find(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>得到p、q、r：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">3530869780887683268140728773245395170410635845517928489976021534009516369358447511411853596093628646212566313257712207746790503704123439</span></span><br><span class="line">q = <span class="number">1274643990900453659882765495755380673132370043776742526720540623203930562265302201405804416214498793910236254519606076438989349099317154363</span></span><br><span class="line">r = <span class="number">67086525836865982094673880600810256005961617151283317566078153226175705789594094624822652838168627925461219084263915001883644637391279141</span></span><br></pre></td></tr></table></figure>
<p>然后就是常规RSA解密，虽然z并不知道，但是显然范围也很小，所以爆破就好。</p>
<p>完整exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getbase</span>(<span class="params">num,base</span>):</span><br><span class="line">    li = []</span><br><span class="line">    <span class="keyword">while</span>(num &gt; <span class="number">0</span>):</span><br><span class="line">        li.append(num % base)</span><br><span class="line">        num //= base</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(li)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">301929748923678449872944933611657670834216889867340028357609265175830693931365828840717548752313862343315133541384709574659039910206634528428504034051556622114290811586746168354731258756502196637977942743110508997919976400864419640496894428180120687863921269087080600917900477624095004141559042793509244689248253036809126205146653922738685595903222471152317095497914809983689734189245440774658145462867680027337</span></span><br><span class="line">c = <span class="number">104375152140523502741159687674899095271676058870899569351687154311685938980840028326701029233383897490722759532494438442871187152038720886122756131781086198384270569105043114469786514257765392820254951665751573388426239366215033932234329514161827069071792449190823827669673064646681779764841034307000600929149689291216313319444583032339045277433847691961234044840927155960887984372868669401051358701522484473320</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################### part1 get m</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">2000</span>):</span><br><span class="line">        <span class="keyword">if</span>(n % m == <span class="number">1</span>):</span><br><span class="line">            li = getbase(n-<span class="number">1</span>,m)</span><br><span class="line">            <span class="built_in">print</span>(m,li)</span><br><span class="line">        <span class="keyword">elif</span>(n % m == <span class="number">8</span>):</span><br><span class="line">            li = getbase(n-<span class="number">8</span>,m)</span><br><span class="line">            <span class="built_in">print</span>(m,li)</span><br><span class="line">m = <span class="number">19</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################### part2 find p,q,r</span></span><br><span class="line"><span class="comment">#print(int(n.log(m)))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">pl,ql,rl,h</span>):</span><br><span class="line">    <span class="keyword">if</span>(h &gt; <span class="number">200</span>):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    mask = m**h</span><br><span class="line">    <span class="keyword">if</span>(pl*ql*rl % mask != n % mask):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(n % pl == <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(pl)</span><br><span class="line">    <span class="keyword">if</span>(n % ql == <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(ql)</span><br><span class="line">    <span class="keyword">if</span>(n % rl == <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(rl)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                    find(i*<span class="number">19</span>**h+pl,j*<span class="number">19</span>**h+ql,k*<span class="number">19</span>**h+rl,h+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#find(2,2,2,0)</span></span><br><span class="line">p = <span class="number">3530869780887683268140728773245395170410635845517928489976021534009516369358447511411853596093628646212566313257712207746790503704123439</span></span><br><span class="line">q = <span class="number">1274643990900453659882765495755380673132370043776742526720540623203930562265302201405804416214498793910236254519606076438989349099317154363</span></span><br><span class="line">r = <span class="number">67086525836865982094673880600810256005961617151283317566078153226175705789594094624822652838168627925461219084263915001883644637391279141</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################### part3 dec</span></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">321</span>):</span><br><span class="line">    e = <span class="number">19</span> ** <span class="number">3</span> + i - <span class="number">2</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        d = inverse(e,phi)</span><br><span class="line">        flag = long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">b&quot;CCTF&quot;</span> <span class="keyword">in</span> flag):</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;nUmb3r5_1N_D!fFerEn7_8As35_4r3_n!cE!?&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="RM2-64-solves-75-pts"><a href="#RM2-64-solves-75-pts" class="headerlink" title="RM2(64 solves , 75 pts)"></a>RM2(64 solves , 75 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The RM2 cryptosystem is a minimalist design that exhibits remarkable resilience, making it exceptionally difficult to compromise.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>(): </span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">randstr</span>(<span class="params">l</span>):</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([printable[randint(<span class="number">0</span>, <span class="number">90</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, p, q</span>):</span><br><span class="line">	e = <span class="number">65537</span></span><br><span class="line">	m1, m2 = msg[:<span class="built_in">len</span>(msg) &gt;&gt; <span class="number">1</span>], msg[<span class="built_in">len</span>(msg) &gt;&gt; <span class="number">1</span>:]</span><br><span class="line">	m1, m2 = bytes_to_long(m1), bytes_to_long(m2)</span><br><span class="line">	c1, c2 = <span class="built_in">pow</span>(m1, e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>)), <span class="built_in">pow</span>(m2, e, (<span class="number">2</span>*p + <span class="number">1</span>) * (<span class="number">2</span>*q + <span class="number">1</span>))</span><br><span class="line">	<span class="keyword">return</span> (c1, c2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;┃&quot;</span></span><br><span class="line">	pr(        <span class="string">&quot;┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓&quot;</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;.: Welcome to RM2 task! Your mission is break our cryptosystem :. &quot;</span>, border)</span><br><span class="line">	pr(        <span class="string">&quot;┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛&quot;</span>)</span><br><span class="line">	nbit, _b = <span class="number">1024</span>, <span class="literal">False</span></span><br><span class="line">	pr(border, <span class="string">f&quot;Please provide your desired <span class="subst">&#123;nbit&#125;</span>-bit prime numbers p, q:&quot;</span>)</span><br><span class="line">	inp = sc().decode()</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		p, q = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> inp.split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line">		<span class="keyword">if</span> p.bit_length() == q.bit_length() == nbit <span class="keyword">and</span> isPrime(p) <span class="keyword">and</span> isPrime(q) <span class="keyword">and</span> p != q:</span><br><span class="line">			_b = <span class="literal">True</span></span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		die(border, <span class="string">f&quot;The input you provided is is not valid!&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> _b:</span><br><span class="line">		e, n =  <span class="number">65537</span>, p * q</span><br><span class="line">		s = randstr(nbit &gt;&gt; <span class="number">4</span>).encode()</span><br><span class="line">		m = bytes_to_long(s)</span><br><span class="line">		<span class="keyword">assert</span> m &lt; n &gt;&gt; <span class="number">2</span></span><br><span class="line">		c1, c2 = encrypt(s, p, q)</span><br><span class="line">		pr(border, <span class="string">f&#x27;c1 = <span class="subst">&#123;c1&#125;</span>&#x27;</span>)</span><br><span class="line">		pr(border, <span class="string">f&#x27;c2 = <span class="subst">&#123;c2&#125;</span>&#x27;</span>)</span><br><span class="line">		pr(border, <span class="string">f&#x27;Now, send us the secret string to get the flag: &#x27;</span>)</span><br><span class="line">		_m = sc().strip()</span><br><span class="line">		<span class="keyword">if</span> _m == s:</span><br><span class="line">			die(border, <span class="string">f&#x27;Congrats, you got the flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">f&#x27;The secret string is not correct! Bye!!&#x27;</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		die(border, <span class="string">f&quot;Your input does not meet the requirements!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>简单来说，题目可以输入两个1024bit的素数p、q，之后会生成一个随机字符串s，将其分为两部分后分别变为整数m1、m2，并计算：</p>
<script type="math/tex; mode=display">
c_1 = m_1^e \quad(mod\;(p-1)(q-1))</script><script type="math/tex; mode=display">
c_2 = m_2^e \quad(mod\;(2p+1)(2q+1))</script><p>给出c1、c2，如果之后能正确输入s，就可以拿到flag。</p>
<p>两个都可以看做是RSA，所以只要知道模数的全部分解就可以做了。而对于两者来说都可以用一个很简单的方法去构造：</p>
<ul>
<li>生成素数k</li>
<li>令p=2k+1</li>
<li>检查p和2p+1是否都是素数</li>
</ul>
<p>如此一来就有：</p>
<script type="math/tex; mode=display">
\phi(p-1) = \phi(2k) = k-1</script><script type="math/tex; mode=display">
\phi(2p+1) = 2p</script><p>然后就解RSA就行了。</p>
<p><br></p>
<h3 id="Soufia-36-solves-119-pts"><a href="#Soufia-36-solves-119-pts" class="headerlink" title="Soufia(36 solves , 119 pts)"></a>Soufia(36 solves , 119 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The Soufia equation incorporates an undisclosed random oracle function. Can you analyze the equation and infer the unknown function&#x27;s value?</span><br></pre></td></tr></table></figure>
<p>还是没有附件，和Bada类似，题目内容是：</p>
<p>存在一个未知的函数f，满足：</p>
<script type="math/tex; mode=display">
f(tx) + tf(y) = f(f(x+y))</script><p>给出两个点值对：</p>
<script type="math/tex; mode=display">
(x_1,f(x_1))</script><script type="math/tex; mode=display">
(x_2,f(x_2))</script><p>要求可以对任意的f(x)求出x。</p>
<p>这种函数方程题目一般来说要做以下几个事情：</p>
<ul>
<li>去掉多层复合</li>
<li>代一些特值</li>
</ul>
<p>比如对于这个题目的函数f，先令x=0有</p>
<script type="math/tex; mode=display">
f(0) + tf(y) = f(f(y))</script><p>然后令y=0，x=y就得到：</p>
<script type="math/tex; mode=display">
f(ty) + tf(0) = f(f(y))</script><p>作差就可以去掉双层复合，得到：</p>
<script type="math/tex; mode=display">
f(0) + tf(y) - f(ty) - tf(0) = 0</script><p>其实到这里可以看出一点端倪，就是：</p>
<script type="math/tex; mode=display">
f(0) - tf(0) = f(ty) - tf(y)</script><p>这其实也可以看作是：</p>
<script type="math/tex; mode=display">
f(t0) - tf(0) = f(ty) - tf(y)</script><p>上式对于任意的y恒成立，也就有：</p>
<script type="math/tex; mode=display">
F(x) = f(tx) - tf(x)</script><p>是一个常函数。而显然当f(x)是线性函数一定满足这个条件，所以直接由题目两点建一个线性的f(x)就可以了。</p>
<p>而说到这个题目就不得不吐槽一下他的靶机，这个靶机从开始到比赛结束，整个队伍里都只有<a target="_blank" rel="noopener" href="https://blog.shangchen.club/">@上辰</a>能连上，发邮件给主办方，他们也没增加这个题目的靶机。<a target="_blank" rel="noopener" href="https://hash-hash.github.io/">@hash-hash</a>在做这个题的时候怎么连怎么挂，非常折磨。</p>
<p><br></p>
<h3 id="Vantuk-51-solves-90-pts"><a href="#Vantuk-51-solves-90-pts" class="headerlink" title="Vantuk(51 solves , 90 pts)"></a>Vantuk(51 solves , 90 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The Vantuk equation is complex, designed to conceal flag components, yet it appears deceptively simple on the surface.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">u</span>(<span class="params">a, x, y</span>):</span><br><span class="line">	<span class="keyword">assert</span> a.is_integer() <span class="keyword">and</span> x.is_rational() <span class="keyword">and</span> y.is_rational()</span><br><span class="line">	<span class="keyword">return</span> x + Rational((a * x - y)/(x ** <span class="number">2</span> + y ** <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">v</span>(<span class="params">a, x, y</span>):</span><br><span class="line">	<span class="keyword">assert</span> a.is_integer() <span class="keyword">and</span> x.is_rational() <span class="keyword">and</span> y.is_rational()</span><br><span class="line">	<span class="keyword">return</span> y - Rational((x + a * y)/(x ** <span class="number">2</span> + y ** <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">m1 = Integer(bytes_to_long(flag[:<span class="built_in">len</span>(flag)//<span class="number">2</span>]))</span><br><span class="line">m2 = Integer(bytes_to_long(flag[<span class="built_in">len</span>(flag)//<span class="number">2</span>:]))</span><br><span class="line">a = Integer(randint(<span class="number">1</span>, <span class="number">1</span> &lt;&lt; <span class="number">512</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;A = <span class="subst">&#123;u(<span class="number">5</span>, a, <span class="number">4</span>*a)&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;U = <span class="subst">&#123;u(a, m1, m2)&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;V = <span class="subst">&#123;v(a, m1, m2)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>output.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A = 6080057478320734754578252336954411086329731226445881868123716230995225973869803901199434606333357820515656618869146654158788168766842914410452961599054518002813068771365518772891986864276289860125347726759503163130747954047189098354503529975642910040243893426023284760560550058749486622149336255123273699589/10166660077500992696786674322778747305573988490459101951030888617339232488971703619809763229396514541455656973227690713112602531083990085142454453827397614</span><br><span class="line">U = 3225614773582213369706292127090052479554140270383744354251548034114969532022146352828696162628127070196943244336606099417210627640399143341122777407316956319347428454301338989662689983156270502206905873768685192940264891098471650041034871787036353839986435/9195042623204647899565271327907071916397082689301388805795886223781949921278129819112624089473306486581983153439866384171645444456400131619437018878598534536108398238424609</span><br><span class="line">V = 1971582892158351181843851788527088806814104010680626247728311504906886858748378948163011806974145871263749452213375101951129675358232283650086419295655854343862361076089682606804214329522917382524296561295274823374483828323983651110722084223144007926678084087/9195042623204647899565271327907071916397082689301388805795886223781949921278129819112624089473306486581983153439866384171645444456400131619437018878598534536108398238424609</span><br></pre></td></tr></table></figure>
<p>题目将flag分为两段m1、m2，并取一个随机数a，之后给出以下几个值：</p>
<script type="math/tex; mode=display">
A = a + \frac{5a-4a}{a^2 + 16a^2} = \frac{17a^2 + 1}{17a}</script><script type="math/tex; mode=display">
U = m_1 + \frac{am_1-m_2}{m_1^2 + m_2^2}</script><script type="math/tex; mode=display">
V = m_2 - \frac{m_1 + am_2}{m_1^2 + m_2^2}</script><p>要求还原flag。</p>
<p>由于A仅仅是关于a的式子，所以利用其分子分母两个方程应该可以解出a来，注意到分子分母可能有经过化简，所以把化简的倍数k也当作变量，去解一个二元方程组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">t1 = <span class="number">6080057478320734754578252336954411086329731226445881868123716230995225973869803901199434606333357820515656618869146654158788168766842914410452961599054518002813068771365518772891986864276289860125347726759503163130747954047189098354503529975642910040243893426023284760560550058749486622149336255123273699589</span></span><br><span class="line">t2 = <span class="number">10166660077500992696786674322778747305573988490459101951030888617339232488971703619809763229396514541455656973227690713112602531083990085142454453827397614</span></span><br><span class="line">PR.&lt;k,a&gt; = PolynomialRing(ZZ)</span><br><span class="line">f1 = <span class="number">17</span>*a^<span class="number">2</span> + <span class="number">1</span> - k*t1</span><br><span class="line">f2 = <span class="number">17</span>*a - k*t2</span><br><span class="line">h = f1.sylvester_matrix(f2, k).det()</span><br><span class="line">res = h.univariate_polynomial().monic().roots()</span><br><span class="line">a = <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"><span class="keyword">assert</span> a &lt; (<span class="number">1</span> &lt;&lt; <span class="number">512</span>)</span><br></pre></td></tr></table></figure>
<p>解得a为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">598038828088293688046274960163455723857293440615241291237111095137601911115982565871162542905677325967979821954570041947800148887293534420144379636905742</span><br></pre></td></tr></table></figure>
<p>得到a之后的步骤就同理了，只不过变成利用U、V去解关于m1、m2、k1、k2的方程而已。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################### part1 get a</span></span><br><span class="line">A1 = <span class="number">6080057478320734754578252336954411086329731226445881868123716230995225973869803901199434606333357820515656618869146654158788168766842914410452961599054518002813068771365518772891986864276289860125347726759503163130747954047189098354503529975642910040243893426023284760560550058749486622149336255123273699589</span></span><br><span class="line">A2 = <span class="number">10166660077500992696786674322778747305573988490459101951030888617339232488971703619809763229396514541455656973227690713112602531083990085142454453827397614</span></span><br><span class="line">PR.&lt;k,a&gt; = PolynomialRing(ZZ)</span><br><span class="line">f1 = <span class="number">17</span>*a^<span class="number">2</span> + <span class="number">1</span> - k*A1</span><br><span class="line">f2 = <span class="number">17</span>*a - k*A2</span><br><span class="line">h = f1.sylvester_matrix(f2, k).det()</span><br><span class="line">res = h.univariate_polynomial().monic().roots()</span><br><span class="line">a = <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"><span class="keyword">assert</span> a &lt; (<span class="number">1</span> &lt;&lt; <span class="number">512</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################### part2 get m1,m2</span></span><br><span class="line">U1 = <span class="number">3225614773582213369706292127090052479554140270383744354251548034114969532022146352828696162628127070196943244336606099417210627640399143341122777407316956319347428454301338989662689983156270502206905873768685192940264891098471650041034871787036353839986435</span></span><br><span class="line">U2 = <span class="number">9195042623204647899565271327907071916397082689301388805795886223781949921278129819112624089473306486581983153439866384171645444456400131619437018878598534536108398238424609</span></span><br><span class="line">V1 = <span class="number">1971582892158351181843851788527088806814104010680626247728311504906886858748378948163011806974145871263749452213375101951129675358232283650086419295655854343862361076089682606804214329522917382524296561295274823374483828323983651110722084223144007926678084087</span></span><br><span class="line">V2 = <span class="number">9195042623204647899565271327907071916397082689301388805795886223781949921278129819112624089473306486581983153439866384171645444456400131619437018878598534536108398238424609</span></span><br><span class="line"></span><br><span class="line">PR.&lt;k1,k2,m1,m2&gt; = PolynomialRing(ZZ)</span><br><span class="line">f1 = m1*(m1^<span class="number">2</span>+m2^<span class="number">2</span>) + a*m1 - m2 - k1*U1</span><br><span class="line">f2 = m1^<span class="number">2</span> + m2^<span class="number">2</span> - k1*U2</span><br><span class="line">f3 = m2*(m1^<span class="number">2</span>+m2^<span class="number">2</span>) - m1 - a*m2 - k2*V1</span><br><span class="line">f4 = m1^<span class="number">2</span> + m2^<span class="number">2</span> - k2*V2</span><br><span class="line"></span><br><span class="line">g1 = f1.sylvester_matrix(f2, k1).det()</span><br><span class="line">g2 = f3.sylvester_matrix(f4, k2).det()</span><br><span class="line"></span><br><span class="line">hm1 = g1.sylvester_matrix(g2, m2).det().univariate_polynomial().monic().roots()</span><br><span class="line">hm2 = g1.sylvester_matrix(g2, m1).det().univariate_polynomial().monic().roots()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(hm1[<span class="number">0</span>][<span class="number">0</span>])) + long_to_bytes(<span class="built_in">int</span>(hm2[<span class="number">0</span>][<span class="number">0</span>])))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;d!D_y0U_5oLv3_7HiS_eQu4T!On_wItH_uSing_c0mPlEx_Num8erS!!?&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="Hard"><a href="#Hard" class="headerlink" title="Hard"></a>Hard</h2><h3 id="Chochol-15-solves-226-pts"><a href="#Chochol-15-solves-226-pts" class="headerlink" title="Chochol(15 solves , 226 pts)"></a>Chochol(15 solves , 226 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Chochol is an unusual cryptosystem that encrypts messages by blending them within elliptic curves - see if you can crack it.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>(<span class="params">nbit</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		p, q = [getPrime(nbit) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">		<span class="keyword">if</span> p % <span class="number">4</span> == q % <span class="number">4</span> == <span class="number">3</span> <span class="keyword">and</span> p &lt; q:</span><br><span class="line">			a = randint(<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">			Ep, Eq = EllipticCurve(GF(p), [a, <span class="number">0</span>]), EllipticCurve(GF(q), [a, <span class="number">0</span>])</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				Gp, Gq = Ep.lift_x(<span class="number">2024</span>), Eq.lift_x(<span class="number">2024</span>)</span><br><span class="line">				s = randint(<span class="number">1</span>, p)</span><br><span class="line">				Hp, Hq = s * Gp, s * Gq</span><br><span class="line">				pkey = (Gp, Hp, Gq, Hq)</span><br><span class="line">				skey = (p, q, s)</span><br><span class="line">				<span class="keyword">return</span> pkey, skey</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">pkey, skey = keygen(<span class="number">128</span>)</span><br><span class="line">p, q, s = skey</span><br><span class="line">n = p * q</span><br><span class="line">m = bytes_to_long(flag.lstrip(<span class="string">b&#x27;CCTF&#123;&#x27;</span>).rstrip(<span class="string">b&#x27;&#125;&#x27;</span>))</span><br><span class="line"><span class="keyword">assert</span> m &lt; n</span><br><span class="line">c = <span class="built_in">pow</span>(m, s, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Gp = <span class="subst">&#123;pkey[<span class="number">0</span>].xy()&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Hp = <span class="subst">&#123;pkey[<span class="number">1</span>].xy()&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Gq = <span class="subst">&#123;pkey[<span class="number">2</span>].xy()&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Hq = <span class="subst">&#123;pkey[<span class="number">3</span>].xy()&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c  = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>output.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Gp = (2024, 77522466419731346352388161327659294096)</span><br><span class="line">Hp = (187001239996895215821259450553198409012, 158495938026527642884038157170741730943)</span><br><span class="line">Gq = (2024, 92609909821520263487623088269239797003)</span><br><span class="line">Hq = (191534442430060308634251661645421139195, 102273233384427938890774177710170123915)</span><br><span class="line">c  = 15084463560924811262750235394027264639346464192638172940901706702947534963652</span><br></pre></td></tr></table></figure>
<p>题目非常非常的直白，给出两条椭圆曲线：</p>
<script type="math/tex; mode=display">
E_p:y^2 = x^3 + ax \quad(mod\;p)</script><script type="math/tex; mode=display">
E_q:y^2 = x^3 + ax \quad(mod\;q)</script><p>然后生成随机数s，并给出四个点Gp,Gq,Hp,Hq，满足：</p>
<script type="math/tex; mode=display">
H_p = sG_p</script><script type="math/tex; mode=display">
H_q = sG_q</script><p>最后把flag进行RSA加密并给出c：</p>
<script type="math/tex; mode=display">
c = m^s \quad(mod\;n)</script><p>要求还原flag。</p>
<p>要解最后的RSA，不仅要有加密指数s，也需要有n的分解，而我们的数据仅有密文c和四个点Gp,Gq,Hp,Hq，并没有他们所在有限域的信息。所以第一步只能是利用点在曲线上这个信息，去消a或者做一次groebner得到一个p的倍数k1p，同理也就有k2q。由于p、q都只有128bit，所以挂yafu有机会分解出来，又因为两个曲线a相同，所以两个一起挂，谁更快挂出来就可以直接求a，那另一个就可以不用挂了。</p>
<p>得到p、q之后就好办了，对同源熟悉一些的话可以知道p、q模4余3并且是这个曲线方程形式时，这是一条超奇异椭圆曲线，阶为p+1，所以既可以做MOV attack求出s，也可以选取p+1的一些小因子和q+1的一些小因子去Pohlig-Hellman，再crt起来就行。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">Gp = (<span class="number">2024</span>, <span class="number">77522466419731346352388161327659294096</span>)</span><br><span class="line">Hp = (<span class="number">187001239996895215821259450553198409012</span>, <span class="number">158495938026527642884038157170741730943</span>)</span><br><span class="line">Gq = (<span class="number">2024</span>, <span class="number">92609909821520263487623088269239797003</span>)</span><br><span class="line">Hq = (<span class="number">191534442430060308634251661645421139195</span>, <span class="number">102273233384427938890774177710170123915</span>)</span><br><span class="line">c  = <span class="number">15084463560924811262750235394027264639346464192638172940901706702947534963652</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################# get q</span></span><br><span class="line">q = <span class="number">278451262698064898668334196027031252819</span></span><br><span class="line">PR.&lt;a&gt; = PolynomialRing(Zmod(q))</span><br><span class="line">x3,y3 = Gq[<span class="number">0</span>],Gq[<span class="number">1</span>]</span><br><span class="line">x4,y4 = Hq[<span class="number">0</span>],Hq[<span class="number">1</span>]</span><br><span class="line">f3 = y3^<span class="number">2</span> - x3^<span class="number">3</span> - a*x3</span><br><span class="line">f4 = y4^<span class="number">2</span> - x4^<span class="number">3</span> - a*x4</span><br><span class="line">qq = <span class="number">1293030084926293436183849323949823514874151405643244735656543151754612840701244335038404810744976684941536215639890425</span></span><br><span class="line">q = <span class="number">278451262698064898668334196027031252819</span></span><br><span class="line">fac = <span class="number">28338689773015872412188935645719088445835579</span></span><br><span class="line">res = Ideal([f3,f4]).groebner_basis()</span><br><span class="line">a = q - <span class="number">150779601446914247367064450767283168919</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################# get p</span></span><br><span class="line">x1,y1 = Gp[<span class="number">0</span>],Gp[<span class="number">1</span>]</span><br><span class="line">x2,y2 = Hp[<span class="number">0</span>],Hp[<span class="number">1</span>]</span><br><span class="line">f1 = y1^<span class="number">2</span> - x1^<span class="number">3</span> - a*x1</span><br><span class="line">f2 = y2^<span class="number">2</span> - x2^<span class="number">3</span> - a*x2</span><br><span class="line">pp = <span class="number">1408163190634528995462435641953100501680643957675634911266005150804547379301555317411069040554339057760687942005173</span></span><br><span class="line">p = <span class="number">243678574849421895808521345944938402807</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ep, Eq = EllipticCurve(GF(p), [a, <span class="number">0</span>]), EllipticCurve(GF(q), [a, <span class="number">0</span>])</span><br><span class="line">Gp = Ep(Gp)</span><br><span class="line">Hp = Ep(Hp)</span><br><span class="line">Gq = Eq(Gq)</span><br><span class="line">Hq = Eq(Hq)</span><br><span class="line"></span><br><span class="line"><span class="comment">############################ </span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    ordp = Ep.order()</span><br><span class="line">    ordq = Eq.order()</span><br><span class="line">    <span class="built_in">print</span>(factor(ordp))</span><br><span class="line">    <span class="built_in">print</span>(factor(ordq))</span><br><span class="line"></span><br><span class="line">    r2 = <span class="number">321810878759529563693</span></span><br><span class="line">    sp = (Hp).log(Gp)</span><br><span class="line">    <span class="built_in">print</span>(sp)</span><br><span class="line">    sq = (r2*Hq).log(r2*Gq)</span><br><span class="line"></span><br><span class="line">    modp = Ep.order()</span><br><span class="line">    modq = Eq.order() // r2</span><br><span class="line"></span><br><span class="line">    s = crt([modp,modq] , [sp,sq])[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = <span class="number">172134561985710786674839705035313724070</span></span><br><span class="line"><span class="keyword">assert</span> s*Gp == Hp <span class="keyword">and</span> s*Gq == Hq</span><br><span class="line">tt = GCD(s,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">d = inverse(s//tt,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">n = p*q</span><br><span class="line">m16 = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d = inverse(s//<span class="number">6</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,p*q)</span><br><span class="line">mp = m%p</span><br><span class="line">mq = m%q</span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = PolynomialRing(GF(p))</span><br><span class="line">f = x^<span class="number">6</span>-mp</span><br><span class="line">pp = (f.roots())</span><br><span class="line">R.&lt;x&gt; = PolynomialRing(GF(q))</span><br><span class="line">f = x^<span class="number">6</span>-mq</span><br><span class="line">qq = (f.roots())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> pp:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> qq:</span><br><span class="line">        m = crt([<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>])],[p,q])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)).decode())</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;m1X!n9__3cC__&amp;_R54_!&#125;</span></span><br></pre></td></tr></table></figure>
<p>这个题开始flag值不对，和<a target="_blank" rel="noopener" href="https://yolbby.github.io/">@yolbby</a>一起做出来之后怎么都交不上。这全是可见字符，语句还有意义，这还能不对？发邮件给主办方之后发现确实是他们设置错了。。。</p>
<p><br></p>
<h3 id="Imen-19-solves-194-pts"><a href="#Imen-19-solves-194-pts" class="headerlink" title="Imen(19 solves , 194 pts)"></a>Imen(19 solves , 194 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Imen presents a challenging task involving a novel and creative cryptosystem, inviting you to attempt to break it and obtain the flag.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">load(<span class="string">&#x27;secret.sage&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>():</span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genimen</span>(<span class="params">k, p, _B</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		A = random_matrix(GF(p), k)</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">				A[i, j] = <span class="built_in">int</span>(A[i, j]) % (_B + <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">if</span> det(A) != <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">return</span> A</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;┃&quot;</span></span><br><span class="line">	pr(        <span class="string">&quot;┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓&quot;</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;Hi all, now it&#x27;s time to solve a new and creative IMEN challenge    &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;In each step, try to find the unknown permutation to get the flag!  &quot;</span>, border)</span><br><span class="line">	pr(        <span class="string">&quot;┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛&quot;</span>)</span><br><span class="line">	nbit, step = <span class="number">128</span>, <span class="number">12</span></span><br><span class="line">	<span class="keyword">for</span> level <span class="keyword">in</span> <span class="built_in">range</span>(step):</span><br><span class="line">		k, l, p, B = <span class="number">3</span>, <span class="number">12</span> + level, getPrime(nbit), <span class="number">14</span> + (level + <span class="number">1</span>)</span><br><span class="line">		nbit = <span class="built_in">int</span>((k * l) ** B).bit_length() + <span class="number">5</span> </span><br><span class="line">		<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">			A = [genimen(k, p, B) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l)]</span><br><span class="line">			L = <span class="built_in">list</span>(<span class="built_in">range</span>(l))</span><br><span class="line">			shuffle(L)</span><br><span class="line">			M = prod([A[_] <span class="keyword">for</span> _ <span class="keyword">in</span> L])</span><br><span class="line">			<span class="keyword">if</span> check(A, M): <span class="keyword">break</span></span><br><span class="line">		<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">			pr(<span class="string">f&quot;| Options: \n|\t[G]et <span class="subst">&#123;l&#125;</span> matrices \n|\t[P]roduct of matrices \n|\t[S]ubmit the permutation \n|\t[Q]uit&quot;</span>)</span><br><span class="line">			ans = sc().decode().lower().strip()</span><br><span class="line">			<span class="keyword">if</span> ans == <span class="string">&#x27;g&#x27;</span>:</span><br><span class="line">				<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">					pr(border, <span class="string">f&#x27;<span class="subst">&#123;A[i]&#125;</span>&#x27;</span>)</span><br><span class="line">			<span class="keyword">elif</span> ans == <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line">				pr(border, <span class="string">f&#x27;M = <span class="subst">&#123;M&#125;</span>&#x27;</span>)</span><br><span class="line">			<span class="keyword">elif</span> ans == <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">				_p = sc().decode()</span><br><span class="line">				<span class="keyword">try</span>:</span><br><span class="line">					_p = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> _p.split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line">				<span class="keyword">except</span>:</span><br><span class="line">					die(border, <span class="string">f&#x27;Your permutation is not valid!&#x27;</span>)</span><br><span class="line">				<span class="keyword">if</span> _p == L:</span><br><span class="line">					<span class="keyword">if</span> level == step - <span class="number">1</span>:</span><br><span class="line">						die(border, <span class="string">f&#x27;Congratulation! You got the flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">					<span class="keyword">else</span>:</span><br><span class="line">						pr(border, <span class="string">f&#x27;gj, you got the <span class="subst">&#123;level&#125;</span>, try the next level now!&#x27;</span>)</span><br><span class="line">						<span class="keyword">break</span></span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					die(border, <span class="string">f&#x27;The permutation is not corr3ct! Bye!!&#x27;</span>)</span><br><span class="line">			<span class="keyword">elif</span> ans == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">				die(border, <span class="string">&#x27;Quitting...&#x27;</span>)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				die(border, <span class="string">&#x27;You should select valid choice!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>题目共12轮挑战，每一轮挑战流程是：</p>
<ul>
<li><p>生成素数p，大小随轮数增加</p>
</li>
<li><p>生成 $l$ 个模p下的矩阵，个数也随轮数增加：</p>
<script type="math/tex; mode=display">
A_1,A_2,...,A_l</script></li>
<li><p>随机打乱矩阵次序后，计算乘积M：</p>
<script type="math/tex; mode=display">
M = A_iA_j...A_k \quad(i,j,...,k = Permutation(1,2,...,l))</script></li>
<li><p>给出M和按顺序的矩阵列表，要求计算出这个置换</p>
</li>
</ul>
<p>完成全部12轮挑战就可以拿到flag了。</p>
<p>注意到生成矩阵Ai时，除了固定的维数k、随机的素数p以外，还有一个参数是B，他把A中的每个元素限制在了0-B内。生成几组数据可以发现，这样做之后，M其实根本就没有模p，是在ZZ上成立的。</p>
<p>所以思路就很好办，我们枚举A中的所有元素As，去计算：</p>
<script type="math/tex; mode=display">
T = A_s^{-1}M = A_s^{-1}A_iA_j...A_k</script><p>逆矩阵在ZZ下求即可，可以发现，由于矩阵乘法没有交换律，所以当且仅当枚举到As为Ai的时候，恰好可以消掉，也就是：</p>
<script type="math/tex; mode=display">
T = A_i^{-1}M = (A_i^{-1}A_i)A_j...A_k = A_j...A_k</script><p>所以仍是一个ZZ下的矩阵，而其他的矩阵会导致T不再是ZZ下的矩阵，因此就可以求出置换了。(因为ZZ并不是一个域，里面除去0的元素并不都有乘法逆元，所以求逆会出现分数)</p>
<p>可以用下面的脚本简单验证这个思路的正确性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genimen</span>(<span class="params">k, p, _B</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		A = random_matrix(GF(p), k)</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">				A[i, j] = <span class="built_in">int</span>(A[i, j]) % (_B + <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">if</span> det(A) != <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">return</span> A</span><br><span class="line"></span><br><span class="line">nbit, step = <span class="number">128</span>, <span class="number">12</span></span><br><span class="line"><span class="keyword">for</span> level <span class="keyword">in</span> <span class="built_in">range</span>(step):</span><br><span class="line">	k, l, p, B = <span class="number">3</span>, <span class="number">12</span> + level, getPrime(nbit), <span class="number">14</span> + (level + <span class="number">1</span>)</span><br><span class="line">	nbit = <span class="built_in">int</span>((k * l) ** B).bit_length() + <span class="number">5</span> </span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		A = [genimen(k, p, B) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l)]</span><br><span class="line">		L = <span class="built_in">list</span>(<span class="built_in">range</span>(l))</span><br><span class="line">		M = prod([A[_] <span class="keyword">for</span> _ <span class="keyword">in</span> L])</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;Round <span class="subst">&#123;level&#125;</span>:&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(Matrix(ZZ,A[<span class="number">0</span>])^(-<span class="number">1</span>)*Matrix(ZZ,M))</span><br><span class="line">	<span class="built_in">print</span>(Matrix(ZZ,A[<span class="number">1</span>])^(-<span class="number">1</span>)*Matrix(ZZ,M))</span><br></pre></td></tr></table></figure>
<p>这个题目在没有update之前，好像最后几轮矩阵的值会超过p，可能就不太好做了。还有这个题目的输入输出处理更是依托。</p>
<p><br></p>
<h3 id="Latifa-22-solves-174-pts"><a href="#Latifa-22-solves-174-pts" class="headerlink" title="Latifa(22 solves , 174 pts)"></a>Latifa(22 solves , 174 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Latifa is a tricky yet enjoyable challenge, akin to solving a puzzle in a dream-like state.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> b, g, flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, b, g</span>):</span><br><span class="line">	i, c = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		N, D = b * g, n(<span class="built_in">pow</span>(g, Rational(<span class="number">2</span>*i/m)), prec = b) + g</span><br><span class="line">		s = N/D</span><br><span class="line">		c += s</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> i &gt;= m:</span><br><span class="line">			<span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag.lstrip(<span class="string">b&#x27;CCTF&#123;&#x27;</span>).rstrip(<span class="string">b&#x27;&#125;&#x27;</span>))</span><br><span class="line">c = encrypt(m, b, g)</span><br><span class="line"><span class="comment"># Takes many many years :(</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>output.txt：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="number">1.802740943639362458394687428102524270510281665315000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e47</span></span><br></pre></td></tr></table></figure>
<p>6.9的凌晨六点左右，我和<a target="_blank" rel="noopener" href="https://yolbby.github.io/">@yolbby</a>做完Chochol之后怎么都交不上flag(原因就是上面说的，主办方flag设置错了)。然后他说他去看点别的，就去看了这个Latifa。</p>
<p>结果10分钟左右他就做完回来了：</p>
<p><img src="/post/cf09b856/image-20240701095249427.png" alt="image-20240701095249427"></p>
<p><img src="/post/cf09b856/image-20240701095316721.png" alt="image-20240701095316721"></p>
<p>然后就好奇地来看了一下这个题目，他用未知的b、g，对flag进行了如下加密：</p>
<script type="math/tex; mode=display">
c = \sum_{i=0}^{m-1}\frac{bg}{g^{\frac{2i}{m}} + g}</script><p>把上下的g约一下得到：</p>
<script type="math/tex; mode=display">
c = \sum_{i=0}^{m-1}\frac{b}{g^{\frac{2i}{m}-1} + 1}</script><p>由于这学期刚好选修了一门电子信息数学基础，重温了下高数，所以看到这个想到了定积分，但是既然十分钟就能搞定，应该不是这么做的吧？</p>
<p>首先可以发现c最后的值一定包含因子b，所以先查一下c的所有因子组合找一下b。但是根本不知道怎么判断b正不正确，所以打印了一下long_to_bytes，结果就出了……</p>
<p>我也很懵，看了下yolbby写在文档的东西也是这么做的，等他期末考完问问他当时做这个是怎么想。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">a = [<span class="number">3</span>,<span class="number">5</span>,<span class="number">379</span>,<span class="number">39719</span>,<span class="number">8959787</span>,<span class="number">891059823255825019255461632769683</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">7</span>):</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> combinations(a,t):</span><br><span class="line">		l = prod(i)</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			<span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(l)).decode())</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			<span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#CCTF&#123;h4Lf_7UrN_5ym3Try!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="O7R-23-solves-169-pts"><a href="#O7R-23-solves-169-pts" class="headerlink" title="O7R(23 solves , 169 pts)"></a>O7R(23 solves , 169 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The O7R cryptosystem combines RSA key recovery techniques with a 7-segment digit representation, resulting in a unique and robust design.</span><br></pre></td></tr></table></figure>
<p>题目给的是pdf文件，核心一点的部分是：</p>
<p><img src="/post/cf09b856/image-20240701103055895.png" alt="image-20240701103055895"></p>
<p><img src="/post/cf09b856/image-20240701103126855.png" alt="image-20240701103126855"></p>
<p>数据：</p>
<p><img src="/post/cf09b856/image-20240701103144061.png" alt="image-20240701103144061"></p>
<p><img src="/post/cf09b856/image-20240701103159097.png" alt="image-20240701103159097"></p>
<p><img src="/post/cf09b856/image-20240701103349848.png" alt="image-20240701103349848"></p>
<p>先阐述下题目内容，题目给出了用七段数码管表示的p、q、n、n^2、c等五个数值，他们满足：</p>
<ul>
<li>c是没有损坏的(也就是c的所有数字都完好)</li>
<li>剩余的四个数值，都是经过了损坏的，损坏的含义是：每个七段数码管表示的数字，有50%的概率爆掉随机一根数码管</li>
</ul>
<p>要求还原flag。</p>
<p>首先明确这个损坏的含义，50%的概率爆掉随机一根数码管，也就是说一个数字可能根本不会坏，就算损坏了，也最多是一根数码管不亮。所以对于其中每一个数字，他的可能性都是有限的，比如举几个例子：</p>
<p><img src="/post/cf09b856/image-20240701103950864.png" alt="image-20240701103950864"></p>
<p>这个可能是5、6或9。</p>
<p><img src="/post/cf09b856/image-20240701104026332.png" alt="image-20240701104026332"></p>
<p>这个可能是1、7。</p>
<p><img src="/post/cf09b856/image-20240701104109464.png" alt="image-20240701104109464"></p>
<p>这个只能是4，因为最多掉一根管，他补任何一个地方都不会成为其他数字。</p>
<p>这么看来的话，只需要把每个数字的可能性都列出来，然后深搜剪枝就可以了。由于每个数字的可能性都不多(最多也就是上面这个5的情况，共3种)，所以其实完全不需要n^2，直接用pq=n来剪枝就行。</p>
<p>思路很清晰，但是怎么样做才能方便地把每个数字的可能性都列出来？和<a target="_blank" rel="noopener" href="https://yolbby.github.io/">@yolbby</a>合计了一下，与其切分图片提像素然后分类，不如直接肉眼一个一个写，我写p、他写q，然后再分行写n。为了统一，把可能性写成二重列表的形式如下(用p的前几位举例)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">7</span>],[<span class="number">3</span>],[<span class="number">2</span>],[<span class="number">6</span>,<span class="number">8</span>],...]</span><br></pre></td></tr></table></figure>
<p>折磨就这么开始了，凌晨的时候，两个人盯着电脑屏幕老眼昏花的写，而且每个位置还要仔细地去想所有的可能性，因为漏了就很麻烦。</p>
<p>然后又拉着<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ZimaBlue">@Zima</a>一起折磨，好不容易把p、q、n全部写完了，一剪发现连10位都剪不出来，说明最后十位就有错。然后三个人又一起debug。debug老半天终于把p、q剪出来了，然后发现好像还没有弄c，不过c挺好办，因为没有损坏，但是直接OCR识别出来的还是不少错(特别容易漏1)，然后又是一起肉眼debug才把c弄出来。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = [[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;0&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;5&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;0&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;8&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>]]</span><br><span class="line"></span><br><span class="line">p = [[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;0&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;6&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;0&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;3&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">q = [[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;9&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;0&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;1&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;9&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;9&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;6&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;0&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;9&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;9&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],</span><br><span class="line">     [<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;2&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;1&quot;</span>],[<span class="string">&quot;6&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;5&quot;</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;9&quot;</span>],[<span class="string">&quot;4&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;9&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;3&quot;</span>],[<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;0&quot;</span>],[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;7&quot;</span>],[<span class="string">&quot;0&quot;</span>,<span class="string">&quot;8&quot;</span>],[<span class="string">&quot;9&quot;</span>]]</span><br><span class="line"></span><br><span class="line">P = p[::-<span class="number">1</span>]</span><br><span class="line">Q = q[::-<span class="number">1</span>]</span><br><span class="line">N = n[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">pl,ql,nl,h</span>):</span><br><span class="line">    p_pos = P[h-<span class="number">1</span>]</span><br><span class="line">    q_pos = Q[h-<span class="number">1</span>]</span><br><span class="line">    n_pos = N[h-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    mask = <span class="number">10</span>**h</span><br><span class="line">    <span class="keyword">if</span>(h == <span class="built_in">len</span>(Q)):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">int</span>(pl))</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">int</span>(ql))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> p_pos:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> q_pos:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> n_pos:</span><br><span class="line">                ppl = <span class="built_in">int</span>(i + pl)</span><br><span class="line">                qql = <span class="built_in">int</span>(j + ql)</span><br><span class="line">                nnl = <span class="built_in">int</span>(k + nl)</span><br><span class="line">                <span class="keyword">if</span>(ppl*qql % mask == nnl % mask):</span><br><span class="line">                    find(i+pl,j+ql,k+nl,h+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#find(&quot;&quot;,&quot;&quot;,&quot;&quot;,1)</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">7326673976775677403615902952775786009780696864351810113969520603559523530618382637866632341958388570488543071638027072634087397361132795284727648994814597</span></span><br><span class="line">q = <span class="number">7075605374343310393660736847187727587911784641033429799366923429044581810690842608691612098700666156539827395662425799607464237168537039463467940973806709</span></span><br><span class="line">n = p*q</span><br><span class="line">c = <span class="number">3562663791006368034141977288433903435480729754256243271724528203580472770993094486280368310543613382256743525891807443983661459665243901555404810179525594817342115941001759547407703653781422057871347356603203075709275979343680289210665741824992476238299997444201948575831891922291318008008982215564064059476</span></span><br><span class="line"></span><br><span class="line">d = inverse(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">flag = long_to_bytes(<span class="built_in">pow</span>(c,d,n))</span><br><span class="line"><span class="keyword">if</span>(<span class="string">b&quot;CCTF&quot;</span>) <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;5eVEn_S39Men7_RSA_w!Th_k3Y_rEc0v3Ry!!!&#125;</span></span><br></pre></td></tr></table></figure>
<p>痛苦。TT</p>
<p><br></p>
<h3 id="Solmaz-11-solves-271-pts"><a href="#Solmaz-11-solves-271-pts" class="headerlink" title="Solmaz(11 solves , 271 pts)"></a>Solmaz(11 solves , 271 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solmaz has developed a simple and visually appealing cryptosystem based on Elliptic Curve Cryptography, but its potential vulnerabilities require further investigation.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_param</span>(<span class="params">nbit</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		t = prod([getPrime(nbit &gt;&gt; <span class="number">3</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)])</span><br><span class="line">		p = <span class="number">4</span> * t ** <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> is_prime(p):</span><br><span class="line">			c = randint(<span class="number">3</span>, p - <span class="number">3</span>) ** <span class="number">2</span> % p</span><br><span class="line">			E = EllipticCurve(GF(p), [c, <span class="number">0</span>])</span><br><span class="line">			<span class="keyword">if</span> E.order() == p - <span class="number">1</span>:</span><br><span class="line">				<span class="keyword">return</span> p, c</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, x, p, c</span>):</span><br><span class="line">	E = EllipticCurve(GF(p), [c, <span class="number">0</span>])</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			P = E.lift_x(x)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			x += <span class="number">1</span></span><br><span class="line">	<span class="keyword">assert</span> m &lt; p - <span class="number">1</span></span><br><span class="line">	Q = m * P</span><br><span class="line">	<span class="keyword">return</span> P, Q, m</span><br><span class="line"></span><br><span class="line">nbit, x = <span class="number">256</span>, <span class="number">1337</span></span><br><span class="line">m = bytes_to_long(flag.lstrip(<span class="string">b&#x27;CCTF&#123;&#x27;</span>).rstrip(<span class="string">b&#x27;&#125;&#x27;</span>))</span><br><span class="line">p, c = gen_param(nbit)</span><br><span class="line">P, Q, m = encrypt(m, x, p, c)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;P = <span class="subst">&#123;P.x(), P.y()&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Q = <span class="subst">&#123;Q.x(), Q.y()&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>output.txt：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">P = (<span class="number">1338</span>, <span class="number">9218578132576071095213927906233283616907115389852794510465118810355739314264</span>)</span><br><span class="line">Q = (<span class="number">3454561753909947353764378180794889923919743476068813953002808647958908878895</span>, <span class="number">17267599534808803050751150297274989016063324917454246976792837120400888025519</span>)</span><br></pre></td></tr></table></figure>
<p>题目生成4个32bit的素数，记为q1、q2、q3、q4，然后计算：</p>
<script type="math/tex; mode=display">
p = 4(q_1q_2q_3q_4)^2 + 1</script><p>然后取随机数c，得到模p下的椭圆曲线，满足阶为p-1：</p>
<script type="math/tex; mode=display">
E_p:y^2 = x^3 + cx</script><blockquote>
<p>由于p模4余1，所以这个构造和前面的Chochol又不一样，虽然形式相同，但并不是超奇异的，所以才能使阶为p-1</p>
</blockquote>
<p>之后给出曲线上的两个点P、Q，满足Q=mP，要求还原m。</p>
<p>依然没有模数p和c，所以同样做groebner得到一个p的倍数kp，然后由于p-1显然是个光滑数，所以想到利用Pollard p-1来分解他。</p>
<p>但是虽然说确实光滑，但是32bit的素数好像还是稍微大了一些，但是之前在maple博客有一篇文章看到过一个叫gmp-ecm的工具好像可以用：</p>
<p><a target="_blank" rel="noopener" href="https://blog.maple3142.net/2022/11/06/n1ctf-2022-writeups/?highlight=n1ctf#ezdlp">N1CTF 2022 Writeups | 廢文集中區 (maple3142.net)</a></p>
<p>然后就在队伍里问了问有没有师傅用过，<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ZimaBlue">@Zima</a>和<a target="_blank" rel="noopener" href="https://wleukocytec.github.io/">@leukocyte</a>试了一下好像不太行，可能是因为每个素因子都平方了一下的缘故。</p>
<p>所以最后还是想着直接写一个p-1光滑的分解脚本，回顾一下Pollard p-1的原理，其实就是构造一个t，使得：</p>
<script type="math/tex; mode=display">
t = r(p-1)</script><p>那么由于费马小定理，就有：</p>
<script type="math/tex; mode=display">
a^t = 1 \quad(mod\;p)</script><p>所以可以求：</p>
<script type="math/tex; mode=display">
gcd(a^t-1,kp)</script><p>从而得到p。</p>
<p>关键的一步就是怎么构造出这样的t，由于：</p>
<script type="math/tex; mode=display">
p-1 = 4(q_1q_2q_3q_4)^2</script><p>所以只要从4开始，乘上所有32bit素因子的平方，这样的t就一定是p-1的倍数。</p>
<p>而要遍历所有32bit的因子，对于python而言有点大了，所以想的是用C++的NTL库去做这个事情。但配这个环境好像实在有点麻烦，所以交给了Zima。Zima提示说gmpy2的nextprime也许可以，所以我也就写了个python的脚本挂着，结果挂了一小时左右真的出了分解。</p>
<p>分解完就好做了，由于保证了阶为p-1，p-1也光滑，所以直接求DLP就可以。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">P = (<span class="number">1338</span>, <span class="number">9218578132576071095213927906233283616907115389852794510465118810355739314264</span>)</span><br><span class="line">Q = (<span class="number">3454561753909947353764378180794889923919743476068813953002808647958908878895</span>, <span class="number">17267599534808803050751150297274989016063324917454246976792837120400888025519</span>)</span><br><span class="line"></span><br><span class="line">x1,y1 = P[<span class="number">0</span>],P[<span class="number">1</span>]</span><br><span class="line">x2,y2 = Q[<span class="number">0</span>],Q[<span class="number">1</span>]</span><br><span class="line">PR.&lt;c,t&gt; = PolynomialRing(ZZ)</span><br><span class="line">f1 = y1^<span class="number">2</span> - x1^<span class="number">3</span> - c*x1</span><br><span class="line">f2 = y2^<span class="number">2</span> - x2^<span class="number">3</span> - c*x2</span><br><span class="line">res = Ideal([f1,f2]).groebner_basis()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">p = <span class="number">55454940004513276799611588380059302189664933020838413515384708243928267219228512844352832003082349090934777517286737687281070260517892560156083453894086877367076953177914949876201881341274104406095268673060476748059522884381040212</span></span><br><span class="line">p = <span class="number">1846015660040154116831101677935731707303583319663256520946194832443059845383265967606382443176439867135351202904588407039443283680086981350429332914636635325121016081809085910600024068461413790906246868559</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    i = next_prime(<span class="number">2</span>^<span class="number">31</span>)</span><br><span class="line">    a = <span class="number">2</span>^<span class="number">4</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        a = powmod(a,i^<span class="number">2</span>,p)</span><br><span class="line">        <span class="keyword">if</span>(gcd(a-<span class="number">1</span>,p) != <span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(gcd(a-<span class="number">1</span>,p))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        i = next_prime(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pp = <span class="number">30126567747372029007183424263223733382328264316268541293679065617875255137317</span></span><br><span class="line">PR.&lt;c,t&gt; = PolynomialRing(Zmod(pp))</span><br><span class="line">f1 = y1^<span class="number">2</span> - x1^<span class="number">3</span> - c*x1</span><br><span class="line">f2 = y2^<span class="number">2</span> - x2^<span class="number">3</span> - c*x2</span><br><span class="line">res = Ideal([f1,f2]).groebner_basis()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">c = pp - <span class="number">12551276475019101031129136087416454095594035188486953048519662649803219581851</span></span><br><span class="line">E = EllipticCurve(GF(pp), [c, <span class="number">0</span>])</span><br><span class="line">P = E(P)</span><br><span class="line">Q = E(Q)</span><br><span class="line">m = Q.log(P)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#3cC_d1ViSibil!7Y</span></span><br></pre></td></tr></table></figure>
<p>这个题也很扯，开始的附件里求完m发现不对，等了一会儿发现果然又要redownload。</p>
<p><br></p>
<h3 id="Tesvir-27-solves-150-pts"><a href="#Tesvir-27-solves-150-pts" class="headerlink" title="Tesvir(27 solves , 150 pts)"></a>Tesvir(27 solves , 150 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tesvir, an advanced and unbreakable cryptosystem, emerged as a revolutionary development in the 20th century cryptographic landscape.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note: The provided code is unclean and lacks efficient performance!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_params</span>(<span class="params">p, h</span>):</span><br><span class="line">	F = GF(p ** h)</span><br><span class="line">	R = PolynomialRing(GF(p), <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">	P = Permutations(p)</span><br><span class="line">	r = P.random_element()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		f = R.random_element(degree = h)</span><br><span class="line">		<span class="keyword">if</span> f.is_irreducible():</span><br><span class="line">			f *= f.<span class="built_in">list</span>()[-<span class="number">1</span>] ** -<span class="number">1</span></span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	</span><br><span class="line">	g = F.gen()</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		_ = randint(<span class="number">1</span>, p ** h - <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">if</span> gcd(_, p ** h - <span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">			g = g ** _</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	</span><br><span class="line">	RR.&lt;x&gt; = GF(p**h)[]</span><br><span class="line">	f = RR(f)</span><br><span class="line">	t = f.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">return</span> g, t, r</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">p, h, params</span>):</span><br><span class="line">	g, t, r = params</span><br><span class="line">	pubkey, d = [], randint(<span class="number">1</span>, p ** h - <span class="number">1</span>)</span><br><span class="line">	P = Permutations(p)</span><br><span class="line">	pi = P.random_element()</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line">		b = discrete_log(t + r[pi[_] - <span class="number">1</span>] - <span class="number">1</span>, g)</span><br><span class="line">		c = (b + d) % (p ** h - <span class="number">1</span>)</span><br><span class="line">		pubkey.append(c)</span><br><span class="line">	privkey = (d, pi, t, g)</span><br><span class="line">	<span class="keyword">return</span> pubkey, privkey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">msg, p, h</span>):</span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	B = <span class="built_in">bin</span>(m)[<span class="number">2</span>:].zfill(<span class="number">8</span> * <span class="built_in">len</span>(msg))</span><br><span class="line">	BA = [B[i*h:(i+<span class="number">1</span>)*h] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(B) // h)]</span><br><span class="line">	M = []</span><br><span class="line">	<span class="keyword">for</span> ba <span class="keyword">in</span> BA:</span><br><span class="line">		m = ba.ljust(p, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">		m = m[:-h + m.count(<span class="string">&#x27;1&#x27;</span>)] + <span class="string">&#x27;1&#x27;</span> * (h - m.count(<span class="string">&#x27;1&#x27;</span>))</span><br><span class="line">		M.append(m)</span><br><span class="line">	<span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, pubkey, p, h</span>):</span><br><span class="line">	M, C = encode(msg, p, h), []</span><br><span class="line">	<span class="keyword">for</span> m <span class="keyword">in</span> M:</span><br><span class="line">		s = <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line">			s += <span class="built_in">int</span>(m[i]) * pubkey[i]</span><br><span class="line">		C.append(s % (p ** h - <span class="number">1</span>))</span><br><span class="line">	<span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line">p, h = <span class="number">223</span>, <span class="number">24</span></span><br><span class="line">params = gen_params(p, h)</span><br><span class="line">g, t, r = params</span><br><span class="line">pubkey, _ = genkey(p, h, params)</span><br><span class="line">enc = encrypt(flag, pubkey, p, h)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;r = <span class="subst">&#123;r&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;pubkey  = <span class="subst">&#123;pubkey&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>输出也有点长，不放在这里了。</p>
<p>先梳理一下题目内容。首先是gen_params：</p>
<ul>
<li>生成有限域：</li>
</ul>
<script type="math/tex; mode=display">
F = GF(223^{24})</script><ul>
<li>生成一个1-223的随机置换r</li>
<li>生成度为24的不可约多项式f</li>
<li>生成F的生成元g</li>
<li>把f转到F下并求出根t</li>
</ul>
<p>然后是genkey：</p>
<ul>
<li><p>生成一个随机数d</p>
</li>
<li><p>再生成一个1-223的随机置换pi</p>
</li>
<li><p>对0-223的j，分别计算bj，满足：</p>
<script type="math/tex; mode=display">
g^{b_j} = t + r_{p_{ij}} - 1</script></li>
<li><p>计算cj，满足：</p>
<script type="math/tex; mode=display">
c_j = b_j + d \quad(mod\;223^{24}-1)</script></li>
<li><p>所有cj作为公钥</p>
</li>
</ul>
<p>说实话，看到这里真的一头雾水，gen_params的内容以及这个223让我联想到之前学了一点点的Reed Solomon Code，但是本身就学了点皮毛，完全不会用。然后这个genkey也一点没看出要干嘛。</p>
<p>总之先继续往下，还剩一个encode和encrypt，具体来说encode是：</p>
<ul>
<li>把明文按24bit分成若干组，分别进行加密</li>
<li>对于每个分组m，填充0使其长度为223</li>
<li>之后，从末尾开始将0换成1，使得最终的m一共含有24个1</li>
</ul>
<p>最后是encrypt：</p>
<ul>
<li>对于每个m，计算向量m和C在模p^h-1下的内积</li>
</ul>
<p>看完发现这不就是个背包吗，而且由于每个m其实都只由24bit生成，一一对应，所以直接爆破就好了，也就是对所有24bit的m，计算最后的密文值来建立字典，然后查字典就行。</p>
<p>又因为m只能是可见字符，所以只需要用可见字符建字典就够了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> printable</span><br><span class="line"></span><br><span class="line">r = [<span class="number">115</span>, <span class="number">149</span>, <span class="number">46</span>, <span class="number">15</span>, <span class="number">122</span>, <span class="number">10</span>, <span class="number">81</span>, <span class="number">136</span>, <span class="number">65</span>, <span class="number">166</span>, <span class="number">219</span>, <span class="number">156</span>, <span class="number">129</span>, <span class="number">170</span>, <span class="number">214</span>, <span class="number">210</span>, <span class="number">223</span>, <span class="number">21</span>, <span class="number">179</span>, <span class="number">72</span>, <span class="number">67</span>, <span class="number">85</span>, <span class="number">220</span>, <span class="number">183</span>, <span class="number">5</span>, <span class="number">212</span>, <span class="number">134</span>, <span class="number">106</span>, <span class="number">139</span>, <span class="number">188</span>, <span class="number">146</span>, <span class="number">102</span>, <span class="number">125</span>, <span class="number">22</span>, <span class="number">221</span>, <span class="number">87</span>, <span class="number">126</span>, <span class="number">51</span>, <span class="number">153</span>, <span class="number">159</span>, <span class="number">116</span>, <span class="number">32</span>, <span class="number">144</span>, <span class="number">205</span>, <span class="number">55</span>, <span class="number">127</span>, <span class="number">222</span>, <span class="number">93</span>, <span class="number">71</span>, <span class="number">201</span>, <span class="number">20</span>, <span class="number">75</span>, <span class="number">123</span>, <span class="number">41</span>, <span class="number">25</span>, <span class="number">33</span>, <span class="number">114</span>, <span class="number">192</span>, <span class="number">120</span>, <span class="number">70</span>, <span class="number">96</span>, <span class="number">211</span>, <span class="number">8</span>, <span class="number">180</span>, <span class="number">26</span>, <span class="number">147</span>, <span class="number">28</span>, <span class="number">34</span>, <span class="number">177</span>, <span class="number">199</span>, <span class="number">92</span>, <span class="number">11</span>, <span class="number">198</span>, <span class="number">29</span>, <span class="number">89</span>, <span class="number">37</span>, <span class="number">74</span>, <span class="number">162</span>, <span class="number">133</span>, <span class="number">97</span>, <span class="number">79</span>, <span class="number">69</span>, <span class="number">35</span>, <span class="number">80</span>, <span class="number">124</span>, <span class="number">101</span>, <span class="number">216</span>, <span class="number">61</span>, <span class="number">117</span>, <span class="number">173</span>, <span class="number">176</span>, <span class="number">53</span>, <span class="number">98</span>, <span class="number">150</span>, <span class="number">4</span>, <span class="number">42</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">112</span>, <span class="number">195</span>, <span class="number">38</span>, <span class="number">218</span>, <span class="number">178</span>, <span class="number">157</span>, <span class="number">19</span>, <span class="number">206</span>, <span class="number">172</span>, <span class="number">181</span>, <span class="number">17</span>, <span class="number">62</span>, <span class="number">103</span>, <span class="number">182</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">161</span>, <span class="number">171</span>, <span class="number">175</span>, <span class="number">95</span>, <span class="number">148</span>, <span class="number">217</span>, <span class="number">193</span>, <span class="number">187</span>, <span class="number">66</span>, <span class="number">90</span>, <span class="number">104</span>, <span class="number">24</span>, <span class="number">76</span>, <span class="number">60</span>, <span class="number">108</span>, <span class="number">6</span>, <span class="number">131</span>, <span class="number">196</span>, <span class="number">128</span>, <span class="number">184</span>, <span class="number">163</span>, <span class="number">137</span>, <span class="number">105</span>, <span class="number">189</span>, <span class="number">86</span>, <span class="number">174</span>, <span class="number">91</span>, <span class="number">64</span>, <span class="number">57</span>, <span class="number">118</span>, <span class="number">77</span>, <span class="number">140</span>, <span class="number">190</span>, <span class="number">194</span>, <span class="number">200</span>, <span class="number">43</span>, <span class="number">16</span>, <span class="number">44</span>, <span class="number">30</span>, <span class="number">207</span>, <span class="number">94</span>, <span class="number">9</span>, <span class="number">68</span>, <span class="number">135</span>, <span class="number">169</span>, <span class="number">204</span>, <span class="number">143</span>, <span class="number">160</span>, <span class="number">100</span>, <span class="number">23</span>, <span class="number">191</span>, <span class="number">113</span>, <span class="number">111</span>, <span class="number">185</span>, <span class="number">213</span>, <span class="number">58</span>, <span class="number">130</span>, <span class="number">197</span>, <span class="number">59</span>, <span class="number">40</span>, <span class="number">186</span>, <span class="number">54</span>, <span class="number">52</span>, <span class="number">12</span>, <span class="number">18</span>, <span class="number">132</span>, <span class="number">83</span>, <span class="number">82</span>, <span class="number">202</span>, <span class="number">3</span>, <span class="number">141</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">165</span>, <span class="number">14</span>, <span class="number">63</span>, <span class="number">84</span>, <span class="number">109</span>, <span class="number">152</span>, <span class="number">155</span>, <span class="number">36</span>, <span class="number">7</span>, <span class="number">138</span>, <span class="number">154</span>, <span class="number">49</span>, <span class="number">78</span>, <span class="number">168</span>, <span class="number">73</span>, <span class="number">151</span>, <span class="number">50</span>, <span class="number">209</span>, <span class="number">158</span>, <span class="number">119</span>, <span class="number">110</span>, <span class="number">145</span>, <span class="number">88</span>, <span class="number">47</span>, <span class="number">203</span>, <span class="number">142</span>, <span class="number">31</span>, <span class="number">208</span>, <span class="number">27</span>, <span class="number">121</span>, <span class="number">164</span>, <span class="number">167</span>, <span class="number">48</span>, <span class="number">107</span>, <span class="number">215</span>, <span class="number">99</span>]</span><br><span class="line">pubkey  = [<span class="number">4579387258479099442826389140450017183599598717619029205</span>, <span class="number">50797264141313161541250199298799563140155742676514856070</span>, <span class="number">219434691099250615018456858310069756006004009383046642143</span>, <span class="number">11468330660842953225747497191767883930924930581150665808</span>, <span class="number">42194638083287011574373249814732023116819279406149017814</span>, <span class="number">134902545392443293573158976620222083109565710059582776902</span>, <span class="number">3625160144836978085583648268825293444860869777878716136</span>, <span class="number">166813383914408395764151023241147502314266684547884287332</span>, <span class="number">29943565577633575933303332141205158945650619101645934495</span>, <span class="number">17247055180775323745936195042907464159475314878330706940</span>, <span class="number">132701774141813613088531286364104917554398118755301161215</span>, <span class="number">206201625677033303772404919447115617309491897222468899200</span>, <span class="number">128759746088591221813929603681654308197557770578218948759</span>, <span class="number">183360234828977645180158181331005804200611579381078449242</span>, <span class="number">3433497919764270981254123021568517019107322906407838775</span>, <span class="number">180827244701547409769187849611685260472147977186544075612</span>, <span class="number">90094342976044807455290765016453082784682254114643836710</span>, <span class="number">140026255208288075756758769477351349475202860424951564344</span>, <span class="number">44112364626789590294371548773210573275126865083833640129</span>, <span class="number">151820161852264758050222465177459785347971580873896530205</span>, <span class="number">222641568922329016629261535558799809898506907527486806640</span>, <span class="number">35846272444624180096743012590749051207738305050375026589</span>, <span class="number">110125275231759529474921195973993669124331074146968153872</span>, <span class="number">11904056771999183668735243652491014687752264483508519866</span>, <span class="number">119911867667253049327009237856594634409002462712397844820</span>, <span class="number">161987059546037388210491693488518594653631887673204452021</span>, <span class="number">190788561858532711625259038792473501768790789526603183037</span>, <span class="number">171042759190856745199182923448465366839589623183777310937</span>, <span class="number">101801200452544922434731443664964969246088222257527659764</span>, <span class="number">140090724075803428561186326582496226733538620993806652027</span>, <span class="number">176639396674357206316302178630628292675252712623699685490</span>, <span class="number">224783685350046016548546283210616077635030923321729671618</span>, <span class="number">157686979388371420253523386799757123908864516455322611545</span>, <span class="number">28199419400037879567825862396075374687069854583804945245</span>, <span class="number">171978417782412325892218086069748164824402244074965942435</span>, <span class="number">150310833853533773405964930253939487392079866821627398318</span>, <span class="number">98831345742413826709455556687993160848501023377907278651</span>, <span class="number">154123567141389311086541742847650387097698934736160865023</span>, <span class="number">121630066975031002990840926074186080216239975029293476812</span>, <span class="number">31286696313154799066012880007327124505421721519900715948</span>, <span class="number">101968393996191205796932269707677612467402575382356961248</span>, <span class="number">2499136180549370600650171447598502321445026784559416298</span>, <span class="number">16848125897903955338136140634369505392045684150115786655</span>, <span class="number">47578327339400295189131054328443796093121978922647143447</span>, <span class="number">24179233030291902452310675469039369826988576939199879176</span>, <span class="number">105273037901112446462027934415037990047326123775284256167</span>, <span class="number">57411134139938220106040243797683715192527950831820732678</span>, <span class="number">10195725519763357104221976240106299814337949772923615115</span>, <span class="number">58166560063884761465783400200196628538821017285137875256</span>, <span class="number">54605784905038131389770213608353236551670620624534944596</span>, <span class="number">38226456600614157062858559660172787082020565146605850918</span>, <span class="number">197663869365124319457839210919740591516696780039282126370</span>, <span class="number">54967216556218275683218087499570854735333195406411928855</span>, <span class="number">35042906559524305301502230096462527221023815082011655179</span>, <span class="number">171952564704992857457616532638790008890189941636196696639</span>, <span class="number">13591589636081003740574689687993869647237413563256792156</span>, <span class="number">57500559744886027958431694115198596269754572013078937199</span>, <span class="number">156436123898613669232291346505787899872553219088301314205</span>, <span class="number">57806240192751898104001203282509821193881347139984859692</span>, <span class="number">75418944937404633800905243484214892003346945987666650321</span>, <span class="number">217951708406473977895295349132268568429989686999505522686</span>, <span class="number">176304391015211148283705335593955617239819817843077950051</span>, <span class="number">55758125847440048397087822777244647091332565999126988186</span>, <span class="number">67763984529554201139494025200729662864492800619660213727</span>, <span class="number">191656222762556273307219102885834144624172791167272826527</span>, <span class="number">227057602273122755633874913712839974408374157556787076376</span>, <span class="number">33453697550484714961091977965265482703240184817695545931</span>, <span class="number">12925259442356937434080842924124428578042373548580641181</span>, <span class="number">129261341826868448249871227617413161190310094555223712007</span>, <span class="number">71767590488420142133048641448102466710457459547821693469</span>, <span class="number">103075493305044879489908640369142480134843220688626837743</span>, <span class="number">12297364715802489173873556831742255265347989101674609502</span>, <span class="number">150291384287610485111409155980244572563593549745010253623</span>, <span class="number">33554524283172661611961357763141315669196684041832264667</span>, <span class="number">107585516815880888762810129132766424476978665361986789693</span>, <span class="number">36898755542881194892338867205127165804165674781364624017</span>, <span class="number">138477491659893664966890466537007728539785384371165227574</span>, <span class="number">65080684456472796307268797791487491498452724689891503205</span>, <span class="number">54048070387499035173896610221943137253486493038088391758</span>, <span class="number">173153561765864340705771824025973165939007109224817507817</span>, <span class="number">99568762534450608460985163776495428624938259974357002753</span>, <span class="number">108073734079270345964706401004242426736899095097270034663</span>, <span class="number">211296070795991107573611899784372810320165661065744807048</span>, <span class="number">191950980282295846436480586220709004688220897961209478055</span>, <span class="number">219870789829809143290238261647242433619723780668567898644</span>, <span class="number">82846254389400741644821834447511166580591663882000899601</span>, <span class="number">147335705565643026701833336777988683175003463278814922435</span>, <span class="number">6677330657331868597177080912636187709184247213001090915</span>, <span class="number">65509954025264162376897683857059640795180443611539638608</span>, <span class="number">97788348508348672587427253412621341354516347030316943263</span>, <span class="number">50339872017921024171565922882962110596867515107807632791</span>, <span class="number">20404897329900652246085973695039579378539236291786309377</span>, <span class="number">121628627709837892062339399628512721395766452440642156526</span>, <span class="number">117664673632829519874589853389281010878033806284806858518</span>, <span class="number">3494726644577971223092642563152500568596276988795464645</span>, <span class="number">223190741523925264571455759912144998793891033522018823048</span>, <span class="number">124704306247788182879460388204439451710110862604146656179</span>, <span class="number">179566098748276203619721337178633709517431960525191942726</span>, <span class="number">173695293570764259997115035606911185447598999607810255972</span>, <span class="number">98378718420486206578551644649570093764645689842230247773</span>, <span class="number">36294885445792353105870401865114008348319522604135751238</span>, <span class="number">88351601718747228918743630494029404621883715463441833300</span>, <span class="number">136753888328355936111533885450395887852887609650952850511</span>, <span class="number">88826423819149324073976027277400003130267101605703817417</span>, <span class="number">153626347770151869159701273708416238028320992726042173456</span>, <span class="number">48447665799548951912445970765509796863255819192369137317</span>, <span class="number">25926148818727084305421258039188486622091968754727603495</span>, <span class="number">75433007506007981941697739028886717357568843374886617854</span>, <span class="number">163403523743183107337343618869709094774134312669607579337</span>, <span class="number">90195006643240793119903093662362093956207796050824877543</span>, <span class="number">76931655268596842019773587962860622955093248369876788943</span>, <span class="number">167125463295542690682664785803694224887085948995189999120</span>, <span class="number">165912236533045749391666265104352059105394417883439144504</span>, <span class="number">102981866240314860142794639939500562112030796419343035128</span>, <span class="number">123694742410185960631033448288250064254819985873351326165</span>, <span class="number">146592629552828995525189097760808351453961284758262774466</span>, <span class="number">203019861676583573314131259559172588655975662889495156847</span>, <span class="number">10036161500498212898467897368941308147748449303016069174</span>, <span class="number">87685737716753006215675653796273463223114323170147465929</span>, <span class="number">70329560627252087252573684487639836859071522052119307709</span>, <span class="number">136915861244063044189262984270735166984429581745567649014</span>, <span class="number">73329998651742245723573422155349760954316509103924762273</span>, <span class="number">113734525875359728198291451178172485335376151605520663473</span>, <span class="number">208813187221334309596716858611421084130040781080505004952</span>, <span class="number">103875031262332837491631581905413234953377770241528241376</span>, <span class="number">13243847546817072175843419982531752763684782213514268707</span>, <span class="number">120001744407132173260771636243615527375774917295121354322</span>, <span class="number">89851436867267737223022839170104811357555399505302690249</span>, <span class="number">19106651045250061786958853204442871931070349664665906834</span>, <span class="number">208140981493299248238118954460510449680605048319117899909</span>, <span class="number">120436526754234062175517049489497536862368615535960465554</span>, <span class="number">41291126508960073783277550372758414648175366207183334071</span>, <span class="number">2749944545805905720645531699140358480207253897204188026</span>, <span class="number">152081380532436580972673620869155127882780286091923495345</span>, <span class="number">100852343092400579536924309146452168877906896247239016614</span>, <span class="number">72079920508055254975205188574206595876645959712620597055</span>, <span class="number">64522268400191343447596383230061887992830219982859913739</span>, <span class="number">152197766648262372890520836531877829770805996935738924903</span>, <span class="number">210877734181002617812004654242222645876962178158868141209</span>, <span class="number">24683946164990045540189560349129683887167164299195625775</span>, <span class="number">206820209167550683642789721762915236268108999576680456003</span>, <span class="number">57710866387091758853441183389265772964358226230824623991</span>, <span class="number">179747783113998854176536062668891588251038080701285687124</span>, <span class="number">111115053514467266934252222133378536223568883659999381505</span>, <span class="number">194310031249253577037158724020305219028469221832006495335</span>, <span class="number">54171305756709974148893255631810739380658440555289725183</span>, <span class="number">36081061592476397164849907656781564201428054975112151104</span>, <span class="number">166387522179865867529326169813325590271108420005029369186</span>, <span class="number">50236753450199839053294465580343603952154218305737501432</span>, <span class="number">70229038648249274204999881080972889501721690256998625762</span>, <span class="number">169828815141066923955361893760454462461324854178070409119</span>, <span class="number">26513302826439642958218716242634740776783823741312689484</span>, <span class="number">185293148966236856497840087050705776290599263752404971816</span>, <span class="number">210075369853066586284316297419359553539776027083874134267</span>, <span class="number">41205384335146937893146509772611998036936514483031810977</span>, <span class="number">204592520934960087493828781217416383428211029411383214329</span>, <span class="number">76065261425709174633836852053941128687067031775700625939</span>, <span class="number">203179613168733078332953358441061351071432612584054415916</span>, <span class="number">66513708250927489690305470142866176469513954748228766009</span>, <span class="number">20175814755308115791665314547889139205636005255804299913</span>, <span class="number">41078990455149658170563497862994645535886142813093891945</span>, <span class="number">228716072689925880543313659773455487756692019817537192658</span>, <span class="number">88391808755246018940367365181350246171557051014871850843</span>, <span class="number">139071342756333141894701291100940798956239314294905885889</span>, <span class="number">34147579027293395946839437099948813145351207426978539631</span>, <span class="number">104582557632522499285198546400846355094887074031948009088</span>, <span class="number">193859720380076021440874403745137391037512325878308523794</span>, <span class="number">225121265357955697363133178349606491945064525800785037545</span>, <span class="number">160720585717566128665444228898129797771581562781360670661</span>, <span class="number">195166070960955730159221227940352776779707446869688343508</span>, <span class="number">133627947376034537976383882910801869861246650572569070695</span>, <span class="number">16719370811161879662359147931457873453820872914250387809</span>, <span class="number">155580990893469680143665368454873188094047243027201936841</span>, <span class="number">18694763141354823690068972812866289937107702217472736692</span>, <span class="number">180898634569544925760572911334766030238281261919118297851</span>, <span class="number">159751985510351400082345385715475564587105850170299678853</span>, <span class="number">155124615247547146942168765500966248268323206179567419205</span>, <span class="number">39649641204773451404479536238969341384057353458256712174</span>, <span class="number">216313168003657711664578876360545799473306544830810266276</span>, <span class="number">2436503838732292885729786856280366925839569007022405596</span>, <span class="number">29242869292273221923479959280952424708462203556781794240</span>, <span class="number">21353805727988428836254728455321385646191528588118693349</span>, <span class="number">184613959938479515383397207452089562397995531746818305735</span>, <span class="number">140289186800524865867557270107130302338585963835219455920</span>, <span class="number">14428539381784887761791822212123106533195544480287429965</span>, <span class="number">40063122489718320389768387980387937974266804567069179915</span>, <span class="number">55679889320878386368056199019499075551252069356762025349</span>, <span class="number">228364327140445947910507206533691038804961948329604730314</span>, <span class="number">137306250863214464757975768638682609074020140712052016591</span>, <span class="number">152391609702632678722030482025816660799366940635319107692</span>, <span class="number">194331603613786615373811392732597540342727111461284467597</span>, <span class="number">112113260165766031933616735889437144400364790129165745472</span>, <span class="number">164499490550482070591340758879746189249388690835705287235</span>, <span class="number">20402415569195842441186230361383311044896719963531571028</span>, <span class="number">225143804839005659587542376622296525537292745802892642188</span>, <span class="number">219943480713442124639466865807923792140876225471303796193</span>, <span class="number">100202994621560168061154249542004856938325751300523918584</span>, <span class="number">166436226032756440467049814076007698369014463998417351566</span>, <span class="number">18518355241335588006356643517380924818275705817097834578</span>, <span class="number">169604362625557928746484454468713671095324100635870987551</span>, <span class="number">159533814543444317784990508257554461271048535710886251037</span>, <span class="number">133643088722739646000296360061097750513592416981320784101</span>, <span class="number">25825717351397349919398666003417921265219251686879820730</span>, <span class="number">103890888915605250679479877052313405985439478970128423397</span>, <span class="number">175772907838636899849299085810673621817614674781130017660</span>, <span class="number">43252300614589311522387147190442713053937984366326355858</span>, <span class="number">16873508457113580715891642673658667475105208209712112109</span>, <span class="number">204936077584769128504523195223183609999978573880209766347</span>, <span class="number">146181990984131617454963783388766051702152117818499103400</span>, <span class="number">226800051676747490358957570441842948948454336820531603559</span>, <span class="number">13156759590500952498608314082303404240995496109216133020</span>, <span class="number">162761766626445741079367215153670009011553941246752760271</span>, <span class="number">123445831125323393499253996280041267200348094380668843306</span>, <span class="number">121602035722307931614892071798221758823002664577511063923</span>, <span class="number">23269715190123797016604529624307223622512790793866100396</span>, <span class="number">201076240655311730254977907588618994829092140461549116438</span>, <span class="number">186737762068262742773830024339577470536847993539671779909</span>, <span class="number">64769358039037097203493324824901293008710108086262539570</span>, <span class="number">76036556626637280604159891162317494917916766168683677624</span>, <span class="number">122041751030855798908591443027132885210134390844715030960</span>, <span class="number">6420731920346907316661151593704807667310013944904682276</span>, <span class="number">133261601326695897123023151238223660543182011673252011668</span>, <span class="number">30312418798752835863188687757298737341991779619884584800</span>]</span><br><span class="line">enc = [<span class="number">121773698579173930646656942313646818799949564181892514859</span>, <span class="number">110363069068565613417175306995877029091942876457783351430</span>, <span class="number">67317447763346252995608047282163289259952724379009239066</span>, <span class="number">40661215922494279426540413963914475266467025509037412483</span>, <span class="number">199660192385826369347118319254502285195924547332922588842</span>, <span class="number">210938210594770518313394647530370135516757130870441793616</span>, <span class="number">164968164223840366829073701035700449613620360889464719358</span>, <span class="number">47722780186684500642502897705647627086520536818326027744</span>, <span class="number">172004040329747663442384678364642020997081017719965572563</span>, <span class="number">168534236138473024418565955930918724937733991774575045958</span>, <span class="number">10055390150692383401863041865436699229887022636104189218</span>, <span class="number">192916357157635434222013845041170212448835303838788802734</span>, <span class="number">68753529179558868929323016763964628261555073720614388332</span>, <span class="number">23143793866551418276708722027637360095751061589410241996</span>, <span class="number">12858601314274634932275239968551622469282315096707517108</span>, <span class="number">186769443202545717151434669644556005309108741078385143683</span>, <span class="number">48691603859905562687745717731829643706189835379113081935</span>]</span><br><span class="line"></span><br><span class="line">p,h = <span class="number">223</span>,<span class="number">24</span></span><br><span class="line">mod = (p ** h - <span class="number">1</span>)</span><br><span class="line">dic = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(product(printable,repeat=<span class="number">3</span>),total=<span class="built_in">len</span>(printable)**<span class="number">3</span>):</span><br><span class="line">    tt = <span class="built_in">bin</span>(bytes_to_long(<span class="string">&quot;&quot;</span>.join(i).encode()))[<span class="number">2</span>:].zfill(<span class="number">24</span>)</span><br><span class="line">    m = tt.ljust(p, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    m = m[:-h + m.count(<span class="string">&#x27;1&#x27;</span>)] + <span class="string">&#x27;1&#x27;</span> * (h - m.count(<span class="string">&#x27;1&#x27;</span>))</span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line">        s += <span class="built_in">int</span>(m[j]) * pubkey[j]</span><br><span class="line">    s %= mod</span><br><span class="line">    dic[s] = <span class="string">&quot;&quot;</span>.join(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="built_in">print</span>(dic[i],end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ASIS&#123;h0W_dO_yUo_5oLvE_tH!s_m1X3D_5eMi_H4rD_T4Sk!!?&#125;</span></span><br></pre></td></tr></table></figure>
<p>不过flag头为什么不是CCTF？</p>
<p><br></p>
<p><br></p>
<h2 id="Tough"><a href="#Tough" class="headerlink" title="Tough"></a>Tough</h2><h3 id="Capac-5-solves-375-pts"><a href="#Capac-5-solves-375-pts" class="headerlink" title="Capac(5 solves , 375 pts)"></a>Capac(5 solves , 375 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Capac is a specialized case of elliptic curve cryptography, which we&#x27;ve used to develop a new system. Fully cracking it requires deep understanding of all details.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">iscube</span>(<span class="params">n, p</span>): </span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">pow</span>(n, (p-<span class="number">1</span>) // gcd(<span class="number">3</span>, p-<span class="number">1</span>), p) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">issquare</span>(<span class="params">n, p</span>): </span><br><span class="line">	<span class="keyword">return</span> Mod(n, p).is_square()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_prime</span>(<span class="params">nbit, t</span>):</span><br><span class="line">	P = []</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">		<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">			p = getPrime(nbit)</span><br><span class="line">			<span class="keyword">if</span> p % <span class="number">3</span> * p % <span class="number">4</span> == <span class="number">3</span>:</span><br><span class="line">				P.append(p)</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">return</span> P</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">P, Q, c, n</span>):</span><br><span class="line">	<span class="comment"># Add two points P and Q on curve x^3 + c*y^3 + c^2*z^3 - 3*c*x*y*z = 1 in Zmod(n) </span></span><br><span class="line">	(x1, y1, z1) = P</span><br><span class="line">	(x2, y2, z2) = Q</span><br><span class="line">	x3 = (x1*x2 + c*(y2*z1	+ y1*z2))	% n</span><br><span class="line">	y3 = (x2*y1 + x1*y2		+ c*z1*z2)	% n</span><br><span class="line">	z3 = (y1*y2 + x2*z1		+ x1*z2)	% n</span><br><span class="line">	<span class="keyword">return</span> (x3, y3, z3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">P, g, c, n</span>):</span><br><span class="line">	<span class="comment"># Scalar multiplication on curve</span></span><br><span class="line">	(x1, y1, z1) = P</span><br><span class="line">	(x2, y2, z2) = (<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">bin</span>(g)[<span class="number">2</span>:]:</span><br><span class="line">		(x2, y2, z2) = add((x2, y2, z2), (x2, y2, z2), c, n)</span><br><span class="line">		<span class="keyword">if</span> b == <span class="string">&#x27;1&#x27;</span>: </span><br><span class="line">			(x2, y2, z2) = add((x2, y2, z2), (x1, y1, z1), c, n)</span><br><span class="line">	<span class="keyword">return</span> (x2, y2, z2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>(<span class="params">nbit, r, s</span>):</span><br><span class="line">	p, q = gen_prime(nbit, <span class="number">2</span>)</span><br><span class="line">	n, o = p^r * q^s, p*q*(p^<span class="number">2</span>+p+<span class="number">1</span>)*(q^<span class="number">2</span>+q+<span class="number">1</span>)*(p - <span class="number">1</span>)^<span class="number">2</span>*(q - <span class="number">1</span>)^<span class="number">2</span></span><br><span class="line">	e = randint(<span class="number">1</span>, n)</span><br><span class="line">	<span class="keyword">while</span> gcd(e, o) != <span class="number">1</span>: e = randint(<span class="number">1</span>, n)</span><br><span class="line">	E = [</span><br><span class="line">		p^(<span class="number">2</span>*(r-<span class="number">1</span>))*q^(<span class="number">2</span>*(s-<span class="number">1</span>))*(p^<span class="number">2</span>+p+<span class="number">1</span>)*(q^<span class="number">2</span>+q+<span class="number">1</span>),</span><br><span class="line">		p^(<span class="number">2</span>*(r-<span class="number">1</span>))*q^(<span class="number">2</span>*(s-<span class="number">1</span>))*(p - <span class="number">1</span>)^<span class="number">2</span>*(q - <span class="number">1</span>)^<span class="number">2</span>,</span><br><span class="line">		p^(<span class="number">2</span>*(r-<span class="number">1</span>))*q^(<span class="number">2</span>*(s-<span class="number">1</span>))*(p^<span class="number">2</span>+p+<span class="number">1</span>)*(q - <span class="number">1</span>)^<span class="number">2</span>,</span><br><span class="line">		p^(<span class="number">2</span>*(r-<span class="number">1</span>))*q^(<span class="number">2</span>*(s-<span class="number">1</span>))*(p - <span class="number">1</span>)^<span class="number">2</span>*(q^<span class="number">2</span>+q+<span class="number">1</span>)</span><br><span class="line">		]</span><br><span class="line">	D = [inverse(e, _) <span class="keyword">for</span> _ <span class="keyword">in</span> E]</span><br><span class="line">	<span class="keyword">return</span> (n, e), (p, q, D)</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, pubkey</span>):</span><br><span class="line">	(n, e) = pubkey</span><br><span class="line">	(x, y) = m</span><br><span class="line">	c = ((<span class="number">1</span> - x^<span class="number">3</span>) * inverse(y^<span class="number">3</span>, n)) % n</span><br><span class="line">	enc = mul((x, y, <span class="number">0</span>), e, c, n)</span><br><span class="line">	<span class="keyword">return</span> enc</span><br><span class="line">	</span><br><span class="line">nbit, r, s = <span class="number">128</span>, <span class="number">4</span>, <span class="number">6</span></span><br><span class="line">pubkey, _ = keygen(nbit, r, s)</span><br><span class="line"></span><br><span class="line">l = <span class="built_in">len</span>(flag)</span><br><span class="line">m = (bytes_to_long(flag[:l//<span class="number">2</span>]), bytes_to_long(flag[l//<span class="number">2</span>:]))</span><br><span class="line"><span class="keyword">assert</span> m[<span class="number">0</span>] &lt; pubkey[<span class="number">0</span>] <span class="keyword">and</span> m[<span class="number">1</span>] &lt; pubkey[<span class="number">0</span>]</span><br><span class="line">enc = encrypt(m, pubkey)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;pubkey = <span class="subst">&#123;pubkey&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>output.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pubkey = (88952423353141033373010851411899063207359252317845617788486152084097996161951607075526045796294269180195617694600310298365306053247057038631088894596240751441036842918276089201617169287026865078594774765749720881882802881828282593949861999972983150274426090825607252511101783484830324425960589823065107734367701062429129988752511807642589018556438468736528286490143324590323667921809, 14614034441012778293137473086633630265649701969941154268770044720080815753509578891278180391973505358690528554774945713350178015180660958849492699471696540533037229348328187546698408636098560882156797223120456953146198082440467610904542891004365972384778900094467795995848069039170326511960815050814119987884996078973626805712610037071776396313451847840676985037388757858071864447123)</span><br><span class="line">enc = (74158970310971046231997292851174632705425701438436982687926541524724544224231671471756658836625071336004647139089957902974649062221314465084271501589880770583941500196989635332899104572053993557369592779214576832520061811752375562631936339531925289336294731237548348991115741285818322588605461239511885627502936265303243765703454352951543594465847846082641044334665902197532903361220, 32862210810953363269397127296728098991061383898392345745080345431931505360414244177467955530544676345008050896351576923265903524343350732466422536502620280273396299390682777548383347188854201456093950612280100041148727882639697090249087208377309058187228075582307715470057023215738254854627890486238852220413501003095534357306896337255070197365694626426757850493485339926618395215692, 8760728942548667764591709653964398229332835041712977477051692400662690767214082230265877984156055902045022941831987525871134103847451840503068333260259579853989011172849487654339072318429238338649112865664749209365538613493979432571794717299576778336030161337610867161636673944099727796251480137420420611432383002785264268560701104663971345262296523136517664986251708476458028224136)</span><br></pre></td></tr></table></figure>
<p>最重量级的一题。</p>
<p>题目基于Cubic Pell Curve的加密，和前段时间DASCTF的一样，关于这个加密系统的论文是：</p>
<p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2024/385.pdf">385.pdf (iacr.org)</a></p>
<p>具体加密和解密步骤参考论文就可以了，总之只要有私钥——也就是n的分解的话就可以做。其中n是这样的形式：</p>
<script type="math/tex; mode=display">
n = p^4q^6</script><p>其中p、q均为128bit的素数。</p>
<p>问题就在于，整个题目就完完全全是把这个加密实现了一遍，完全没看出什么漏洞，那怎么解？不过考虑到p、q都是128bit，说大的话也不算大(前面几个题不也是128bit挂yafu吗)，所以还是先给n开了个根之后挂了个yafu。一时半会儿没有动静，就先挂住了。</p>
<p>距离比赛结束还剩几小时的时候，实在觉得又困又饿(通宵+没吃饭)，其他题也做的差不多了，就想着差不多出门吃个饭，这个时候想起还挂了个yafu，然后切过去看了看：</p>
<p><img src="/post/cf09b856/image-20240701141056368.png" alt="image-20240701141056368"></p>
<p>太逆天了，硬挂32949.2510秒出了分解，所以说factorCTF不是没有道理，发到群里大火也炸锅了哈哈哈：</p>
<p><img src="/post/cf09b856/image-20240701141412956.png" alt="image-20240701141412956"></p>
<p><img src="/post/cf09b856/image-20240701141459600.png" alt="image-20240701141459600"></p>
<p><img src="/post/cf09b856/image-20240701141537346.png" alt="image-20240701141537346"></p>
<p><img src="/post/cf09b856/image-20240701141559738.png" alt="image-20240701141559738"></p>
<p>之后把这个分解给<a target="_blank" rel="noopener" href="https://hash-hash.github.io/">@hash-hash</a>(因为他之前解过DASCTF那个，应该改一改就能用)，也是很快就搞定了，这里偷懒搬一搬他的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pell_Curve</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, a, N</span>):</span><br><span class="line">        self.a = a</span><br><span class="line">        self.N = N</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_on_curve</span>(<span class="params">self, point</span>):</span><br><span class="line">        <span class="keyword">if</span> point <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        x, y, z = point</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            x**<span class="number">3</span> + self.a * y**<span class="number">3</span> + self.a**<span class="number">2</span> * z**<span class="number">3</span> - <span class="number">3</span> * self.a * x * y * z</span><br><span class="line">        ) % self.N == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, P, Q</span>):</span><br><span class="line">        x1, y1, z1 = P</span><br><span class="line">        x2, y2, z2 = Q</span><br><span class="line">        x3 = (x1 * x2 + self.a * (y2 * z1 + y1 * z2)) % self.N</span><br><span class="line">        y3 = (x2 * y1 + x1 * y2 + self.a * z1 * z2) % self.N</span><br><span class="line">        z3 = (y1 * y2 + x2 * z1 + x1 * z2) % self.N</span><br><span class="line">        <span class="keyword">return</span> (x3, y3, z3)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self, P, x</span>):</span><br><span class="line">        Q = (<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">while</span> x &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> x &amp; <span class="number">1</span>:</span><br><span class="line">                Q = self.add(Q, P)</span><br><span class="line">            P = self.add(P, P)</span><br><span class="line">            x &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>(<span class="params">E, Q, r, s</span>):</span><br><span class="line">    lcg = LCG(E, Q)</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        p = lcg.get_prime()</span><br><span class="line">        q = lcg.get_prime()</span><br><span class="line">        <span class="built_in">print</span>(p, q)</span><br><span class="line">        <span class="keyword">if</span> p % <span class="number">3</span> == <span class="number">1</span> <span class="keyword">and</span> q % <span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">            N = p**r * q**s</span><br><span class="line">            e = <span class="number">0x20002</span></span><br><span class="line">            <span class="keyword">return</span> (N, e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">M, N, e</span>):</span><br><span class="line">    xm, ym = M</span><br><span class="line">    M = (xm, ym, <span class="number">0</span>)</span><br><span class="line">    a = (<span class="number">1</span> - xm**<span class="number">3</span>) * inverse(ym**<span class="number">3</span>, N) % N</span><br><span class="line">    curve = Pell_Curve(<span class="built_in">int</span>(a), N)</span><br><span class="line">    <span class="keyword">if</span> curve.is_on_curve(M):</span><br><span class="line">        <span class="keyword">return</span> curve.mul(M, e), curve.is_on_curve(curve.mul(M, e))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">q = <span class="number">171955359080932502551172606124599656543</span></span><br><span class="line">p = <span class="number">242195390295637766135570468161415180323</span></span><br><span class="line"></span><br><span class="line">r, s = <span class="number">4</span>, <span class="number">6</span></span><br><span class="line"></span><br><span class="line">n, e = (<span class="number">88952423353141033373010851411899063207359252317845617788486152084097996161951607075526045796294269180195617694600310298365306053247057038631088894596240751441036842918276089201617169287026865078594774765749720881882802881828282593949861999972983150274426090825607252511101783484830324425960589823065107734367701062429129988752511807642589018556438468736528286490143324590323667921809</span>, <span class="number">14614034441012778293137473086633630265649701969941154268770044720080815753509578891278180391973505358690528554774945713350178015180660958849492699471696540533037229348328187546698408636098560882156797223120456953146198082440467610904542891004365972384778900094467795995848069039170326511960815050814119987884996078973626805712610037071776396313451847840676985037388757858071864447123</span>)</span><br><span class="line">x, y, z = (<span class="number">74158970310971046231997292851174632705425701438436982687926541524724544224231671471756658836625071336004647139089957902974649062221314465084271501589880770583941500196989635332899104572053993557369592779214576832520061811752375562631936339531925289336294731237548348991115741285818322588605461239511885627502936265303243765703454352951543594465847846082641044334665902197532903361220</span>, <span class="number">32862210810953363269397127296728098991061383898392345745080345431931505360414244177467955530544676345008050896351576923265903524343350732466422536502620280273396299390682777548383347188854201456093950612280100041148727882639697090249087208377309058187228075582307715470057023215738254854627890486238852220413501003095534357306896337255070197365694626426757850493485339926618395215692</span>, <span class="number">8760728942548667764591709653964398229332835041712977477051692400662690767214082230265877984156055902045022941831987525871134103847451840503068333260259579853989011172849487654339072318429238338649112865664749209365538613493979432571794717299576778336030161337610867161636673944099727796251480137420420611432383002785264268560701104663971345262296523136517664986251708476458028224136</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = [</span><br><span class="line"></span><br><span class="line">    <span class="number">38082677088809290708888864314473611698208489947149149020141323354876853986846324667486599783099732449253321999219530956251885062836963617473433230328586192652813973364030607478840215477264438623285384369097235663234708836294503355550514113793191654083605154926924302782918924474190008822819680949832855309114998683480624021568578210762241091831893916401635203167722829317883574117304</span>,</span><br><span class="line"> <span class="number">55542785903937490819242771302549793176088751965230011448729375621780480702917260980627366579559731499071481465701273803009160786625112585403160409241867914028776478433782380129148977220686475108517789796522840237011806357784338595091229781789385237782508264914170678295844412591496324511913794387127204408153535129355464447351230388778897031953295817190543912286619989423406655977700</span>,</span><br><span class="line"> <span class="number">32809102117103053026047707178806708898308641810687342740050761956023499193587988346676441294031383037731625771964079418993097123328311195543468739276724770166588580694731012772209001624219626666752889679553768268558153713398821943876723711708308989355210892928040680077147537640505525324780317757262161253076610556164212322764995420591745497492132140599484611217302174245592265314953</span>,</span><br><span class="line"> <span class="number">50269210932231253136401614166882890376188903828768205168638814222927125909658924659817208090491382087549785238445822265750372847116460163473195918190006491542551085764482785422517763367641663151985295106979372842335251234888657183417439379704502573054114002915287055590073025757811841013874431194556510352115147002039052748547647598608401437613534041388393320336199334351115347175349</span>]</span><br><span class="line"></span><br><span class="line">C = (<span class="number">74158970310971046231997292851174632705425701438436982687926541524724544224231671471756658836625071336004647139089957902974649062221314465084271501589880770583941500196989635332899104572053993557369592779214576832520061811752375562631936339531925289336294731237548348991115741285818322588605461239511885627502936265303243765703454352951543594465847846082641044334665902197532903361220</span>, <span class="number">32862210810953363269397127296728098991061383898392345745080345431931505360414244177467955530544676345008050896351576923265903524343350732466422536502620280273396299390682777548383347188854201456093950612280100041148727882639697090249087208377309058187228075582307715470057023215738254854627890486238852220413501003095534357306896337255070197365694626426757850493485339926618395215692</span>, <span class="number">8760728942548667764591709653964398229332835041712977477051692400662690767214082230265877984156055902045022941831987525871134103847451840503068333260259579853989011172849487654339072318429238338649112865664749209365538613493979432571794717299576778336030161337610867161636673944099727796251480137420420611432383002785264268560701104663971345262296523136517664986251708476458028224136</span>)</span><br><span class="line"></span><br><span class="line">Fp = GF(p)</span><br><span class="line">Fq = GF(q)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a0 <span class="keyword">in</span> a:</span><br><span class="line">    curve = Pell_Curve(<span class="built_in">int</span>(a0), n)</span><br><span class="line">    <span class="keyword">try</span>: </span><br><span class="line">        root = Fp(a0).nth_root(<span class="number">3</span>)</span><br><span class="line">        phi1 = p^(<span class="number">2</span>*(r-<span class="number">1</span>))*(p-<span class="number">1</span>)^<span class="number">2</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        phi1 = p^(<span class="number">2</span>*(r-<span class="number">1</span>))*(p^<span class="number">2</span>+p+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>: </span><br><span class="line">        root = Fq(a0).nth_root(<span class="number">3</span>)</span><br><span class="line">        phi2 = q^(<span class="number">2</span>*(s-<span class="number">1</span>))*(q-<span class="number">1</span>)^<span class="number">2</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        phi2 = q^(<span class="number">2</span>*(s-<span class="number">1</span>))*(q^<span class="number">2</span>+q+<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    phi = phi1*phi2</span><br><span class="line">    d = inverse_mod(e, phi)</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(curve.mul(C, d)[<span class="number">0</span>]))</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(curve.mul(C, d)[<span class="number">1</span>]))</span><br><span class="line">    </span><br><span class="line"><span class="comment">#CCTF&#123;n3W_Publ1c_k3Y_crYp70sy5T3m_8a5Ed_ON_7h3_cBb!c_Pell_curV3s!!!&#125;</span></span><br></pre></td></tr></table></figure>
<p>这个题就这么结束了，有点奇妙。</p>
<blockquote>
<p>赛后看<a target="_blank" rel="noopener" href="https://d33b4t0.com/archives/">deebato</a>他们硬挂yafu没直接显示结果，但是在log里找到了分解，突然感觉我这里分解出因子的时候可能也远远不到32949.2510这么多秒，只是程序没运行完没显示罢了，又学到一招。</p>
<p>关于这个题，其实赛中<a target="_blank" rel="noopener" href="https://yolbby.github.io/">@yolbby</a>想出了一个很合理的思路，只是对于这个题的数据来说并不太适用，我把他的想法出成了一题，放在了<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/5638">NSSCTF</a>上</p>
<p>相对于这个题目，仅仅是把p、q改成了512bit，别的都没有变，有兴趣的师傅可以做做看</p>
</blockquote>
<p><br></p>
<h3 id="Jonon-13-solves-247-pts"><a href="#Jonon-13-solves-247-pts" class="headerlink" title="Jonon(13 solves , 247 pts)"></a>Jonon(13 solves , 247 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The Jonon challenge is a variation of the Imen challenge, and it provides a similar level of difficulty as the original version - it&#x27;s an enjoyable experience.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> printable <span class="keyword">as</span> prn</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genimen</span>(<span class="params">k, p, _B</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		A = random_matrix(GF(p), k)</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">				A[i, j] = <span class="built_in">int</span>(A[i, j]) % (_B + <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">if</span> det(A) != <span class="number">0</span>: <span class="keyword">return</span> A</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">k, p, _B, l</span>):</span><br><span class="line">	sA = [genimen(k, p, _B) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l + <span class="number">1</span>)]</span><br><span class="line">	L = <span class="built_in">list</span>(<span class="built_in">range</span>(l))</span><br><span class="line">	shuffle(L)</span><br><span class="line">	s, pE = randint(<span class="number">1</span>, p - <span class="number">1</span>), prod([sA[_] <span class="keyword">for</span> _ <span class="keyword">in</span> L])</span><br><span class="line">	sD, sE = sA[-<span class="number">1</span>], s * pE</span><br><span class="line">	pkey = [sE * _ * sD * sE.inverse() <span class="keyword">for</span> _ <span class="keyword">in</span> sA[:-<span class="number">1</span>]], sA[:-<span class="number">1</span>], pE</span><br><span class="line">	skey = L, s, sE, sD</span><br><span class="line">	<span class="keyword">return</span> pkey, skey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">pkey, _p</span>):</span><br><span class="line">	pA, psA, pE = pkey</span><br><span class="line">	k = pA[<span class="number">0</span>].nrows()</span><br><span class="line">	C = identity_matrix(GF(p), k)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> _p: C *= pA[i]</span><br><span class="line">	<span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line">nbit = <span class="number">256</span></span><br><span class="line">k, l, p, _B = <span class="number">5</span>, <span class="number">19</span>, getPrime(nbit), <span class="number">63</span></span><br><span class="line">_p = <span class="built_in">list</span>(<span class="built_in">range</span>(l))</span><br><span class="line">shuffle(_p)</span><br><span class="line">flag = <span class="string">&#x27;CCTF&#123;&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join([prn[<span class="number">10</span> + _p[_]] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l)]) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">pkey, skey = genkey(k, p, _B, l)</span><br><span class="line">C = encrypt(pkey, _p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;pkey = <span class="subst">&#123;pkey&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;C = <span class="subst">&#123;C&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>output比较长，也不放在这里。</p>
<p>可以看出这个题和Imen相当的神似，只是稍稍变了一些。先把genkey梳理一下：</p>
<ul>
<li><p>生成l+1个模p下的矩阵：</p>
<script type="math/tex; mode=display">
sA_1,sA_2,...,sA_{l+1}</script></li>
<li><p>生成随机数s</p>
</li>
<li><p>将sA打乱后，计算其乘积pE：</p>
<script type="math/tex; mode=display">
pE = sA_isA_j...sA_k\quad(i,j,...,k = Permutation(1,2,...,l+1))</script></li>
<li><p>计算：</p>
<script type="math/tex; mode=display">
sD = sA_{l+1}</script><script type="math/tex; mode=display">
sE = s \cdot pE</script></li>
<li><p>再依次计算下面矩阵的值得到列表，并和sA(不包含sD)和pE一同作为公钥pkey：</p>
<script type="math/tex; mode=display">
sE \cdot sA_{i} \cdot sD \cdot sE^{-1} \quad ,i \in \{1,2,...,l\}</script></li>
<li><p>打乱后的列表L，s，sE和sD作为私钥</p>
</li>
</ul>
<p>然后是encrypt：</p>
<ul>
<li><p>先生成一个1-l的随机置换pi，并用这个置换生成flag(也就是求出置换就有flag)</p>
</li>
<li><p>生成pkey，skey</p>
</li>
<li><p>计算C：</p>
<script type="math/tex; mode=display">
C = \prod_{i=pi_1}^{pi_l}(sE \cdot sA_{i} \cdot sD \cdot sE^{-1})</script></li>
</ul>
<p>要求求出置换。</p>
<p>首先，所有矩阵都是模p下的，虽然我们并没有p，但是我们有所有的：</p>
<script type="math/tex; mode=display">
T_i = sE \cdot sA_{i} \cdot sD \cdot sE^{-1} \quad ,i \in \{1,2,...,l\}</script><p>求逆得到：</p>
<script type="math/tex; mode=display">
T_i^{-1} = sE \cdot sD^{-1} \cdot sA_i^{-1} \cdot sE^{-1} ,i \in \{1,2,...,l\}</script><p>所以有：</p>
<script type="math/tex; mode=display">
T_iT_j = sE \cdot sA_i \cdot sA_j^{-1} \cdot sE^{-1}</script><p>然后又因为逆矩阵具有下面的性质：</p>
<script type="math/tex; mode=display">
(sA)^{-1} = s^{-1}A^{-1}</script><p>所以说上面的式子又可以变成：</p>
<script type="math/tex; mode=display">
T_iT_j = (s\cdot pE) \cdot sA_i \cdot sA_j^{-1} \cdot (s^{-1} \cdot pE^{-1})</script><p>也就是：</p>
<script type="math/tex; mode=display">
T_iT_j = pE \cdot sA_i \cdot sA_j^{-1} \cdot pE^{-1}</script><p>而这几个矩阵都是公钥里的，所以可以在ZZ上直接求这个矩阵，那么两者的行列式在模p下应该相等，所以可以多求几组作差，然后gcd就得到p了。</p>
<p>有了p过后，又因为：</p>
<script type="math/tex; mode=display">
T_i = pE \cdot sA_{i} \cdot sD \cdot pE^{-1} \quad ,i \in \{1,2,...,l\}</script><p>所以又很轻松就可以在模p下计算出sD来。</p>
<p>之后就很好办了，现在我们拥有C，要求对应的置换：</p>
<script type="math/tex; mode=display">
C = \prod_{i=pi_1}^{pi_l}(sE \cdot sA_{i} \cdot sD \cdot sE^{-1})</script><p>而可以看出，首位的sE和sE^(-1)无非是对矩阵做了相似，而相似前后，矩阵的迹是不会变的，又因为sA和sD都较小，所以可以通过枚举sA，然后判断迹是增大还是减小来检查枚举的是否正确，就得到了置换。</p>
<p>然而有个细节需要注意，那就是题目设置的数量级会使得最终C的迹也会超过p的大小，所以先枚举出可能的初始路径之后，再进行搜索才行。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> printable <span class="keyword">as</span> prn</span><br><span class="line"></span><br><span class="line">T = </span><br><span class="line">sA = </span><br><span class="line">pE = </span><br><span class="line">C = </span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################## part1 get p</span></span><br><span class="line">t1 = Matrix(ZZ,T[<span class="number">0</span>])*Matrix(ZZ,T[<span class="number">1</span>])^(-<span class="number">1</span>)</span><br><span class="line">t2 = Matrix(ZZ,pE)*Matrix(ZZ,sA[<span class="number">0</span>])*Matrix(ZZ,sA[<span class="number">1</span>])^(-<span class="number">1</span>)*Matrix(ZZ,pE)^(-<span class="number">1</span>)</span><br><span class="line">t3 = Matrix(ZZ,T[<span class="number">0</span>])*Matrix(ZZ,T[<span class="number">2</span>])^(-<span class="number">1</span>)</span><br><span class="line">t4 = Matrix(ZZ,pE)*Matrix(ZZ,sA[<span class="number">0</span>])*Matrix(ZZ,sA[<span class="number">2</span>])^(-<span class="number">1</span>)*Matrix(ZZ,pE)^(-<span class="number">1</span>)</span><br><span class="line">t5 = Matrix(ZZ,T[<span class="number">0</span>])*Matrix(ZZ,T[<span class="number">3</span>])^(-<span class="number">1</span>)</span><br><span class="line">t6 = Matrix(ZZ,pE)*Matrix(ZZ,sA[<span class="number">0</span>])*Matrix(ZZ,sA[<span class="number">3</span>])^(-<span class="number">1</span>)*Matrix(ZZ,pE)^(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kp = gcd(gcd(t1.det()-t2.det() , t3.det()-t4.det()) , t5.det()-t6.det())</span><br><span class="line">p = kp.numerator()</span><br><span class="line"><span class="keyword">assert</span> isPrime(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################## part2 get sD</span></span><br><span class="line">F = GF(p)</span><br><span class="line">T = [Matrix(F,i) <span class="keyword">for</span> i <span class="keyword">in</span> T]</span><br><span class="line">sA = [Matrix(F,i) <span class="keyword">for</span> i <span class="keyword">in</span> sA]</span><br><span class="line">pE = Matrix(F,pE)</span><br><span class="line">C = Matrix(F,C)</span><br><span class="line">sD = sA[<span class="number">0</span>]^(-<span class="number">1</span>)*pE^(-<span class="number">1</span>)*T[<span class="number">0</span>]*pE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################## part3 trace</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">temp,setT,path</span>):</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">all</span>(i[<span class="number">0</span>] == <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> setT)):</span><br><span class="line">        flag = <span class="string">&#x27;CCTF&#123;&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join([prn[<span class="number">10</span> + path[_]] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>)]) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    tt = [ii <span class="keyword">for</span> ii <span class="keyword">in</span> setT]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(setT)):</span><br><span class="line">        <span class="keyword">if</span>((setT[i][<span class="number">1</span>]^(-<span class="number">1</span>)*temp).trace() &lt; temp.trace()):</span><br><span class="line">            tt[i][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">            find(setT[i][<span class="number">1</span>]^(-<span class="number">1</span>)*temp , tt , path+[i])</span><br><span class="line">            tt[i][<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">T_table = [[<span class="number">1</span>,i] <span class="keyword">for</span> i <span class="keyword">in</span> T]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>):</span><br><span class="line">            temp = T[i]^(-<span class="number">1</span>)*T[j]^(-<span class="number">1</span>)*T[k]^(-<span class="number">1</span>)*C</span><br><span class="line">            tt = [ii <span class="keyword">for</span> ii <span class="keyword">in</span> T_table]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">bin</span>(<span class="built_in">int</span>(temp.trace()))) &lt; <span class="number">232</span>:</span><br><span class="line">                tt[i][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">                tt[j][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">                tt[k][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">                find(temp , tt , [k,j,i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;mpradjnkfcqhilsoebg&#125;</span></span><br></pre></td></tr></table></figure>
<p>和Imen一样，这个题的输出也是依托，要自己处理一下变成列表形式。</p>
<p><br></p>
<h3 id="Rehawk-9-solves-300-pts"><a href="#Rehawk-9-solves-300-pts" class="headerlink" title="Rehawk(9 solves , 300 pts)"></a>Rehawk(9 solves , 300 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rehawk is an advanced, modern cryptosystem of great complexity that only seasoned cryptographers can comprehend, with few able to successfully break it.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_params</span>(<span class="params">m</span>):</span><br><span class="line">	C = CyclotomicField(m)</span><br><span class="line">	F, PHI = C.maximal_totally_real_subfield()</span><br><span class="line">	d = F.degree()</span><br><span class="line">	D = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(d)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(d)]</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(d):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>):</span><br><span class="line">			<span class="keyword">if</span> (i - j) % <span class="number">2</span> == <span class="number">0</span>: D[i][j] = binomial(i, (i - j) &gt;&gt; <span class="number">1</span>)		</span><br><span class="line">	D = Matrix(D)</span><br><span class="line">	O = [F(_) <span class="keyword">for</span> _ <span class="keyword">in</span> D.inverse()]</span><br><span class="line">	<span class="keyword">return</span> (C, F, PHI, O, D)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">F, O, D, _B</span>):</span><br><span class="line">	_d, g = F.degree(), F.gen()</span><br><span class="line">	a = <span class="built_in">sum</span>([randint(-_B, _B + <span class="number">1</span>) * g**_ <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(_d)])</span><br><span class="line">	A = a.matrix().LLL()</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		b = <span class="built_in">sum</span>([randint(-_B, _B + <span class="number">1</span>) * g**_ <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(_d)])</span><br><span class="line">		B = b.matrix().LLL()</span><br><span class="line">		C = block_matrix([[A], [B]]).change_ring(ZZ)</span><br><span class="line">		R, M = C.hermite_form(transformation = <span class="literal">True</span>)</span><br><span class="line">		<span class="keyword">if</span> R[<span class="number">0</span>:_d] == identity_matrix(_d): <span class="keyword">break</span></span><br><span class="line">	c, d = F(-M[<span class="number">0</span>][_d:<span class="number">2</span>*_d]*B) / b, F(M[<span class="number">0</span>][<span class="number">0</span>:_d]*A) / a</span><br><span class="line">	n = (a*c + b*d) / (a**<span class="number">2</span> + b**<span class="number">2</span>)</span><br><span class="line">	N = vector(n) * D</span><br><span class="line">	_n = <span class="built_in">sum</span>(<span class="built_in">round</span>(N[_]) * O[_] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(_d))</span><br><span class="line">	_c, _d = c - _n * a, d - _n * b</span><br><span class="line">	skey = Matrix([[a, _c], [b, _d]])</span><br><span class="line">	pkey = (skey + identity_matrix(<span class="number">2</span>)) * (skey.T - identity_matrix(<span class="number">2</span>))</span><br><span class="line">	<span class="keyword">return</span> (skey, pkey)</span><br><span class="line"></span><br><span class="line">nbit = <span class="number">4</span> * <span class="number">32</span></span><br><span class="line">C, F, PHI, O, D = gen_params(nbit)</span><br><span class="line">skey, pkey = genkey(F, O, D, nbit &gt;&gt; <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">str</span>(<span class="built_in">sum</span>(skey.coefficients()).polynomial()(<span class="number">2</span>^<span class="number">128</span>))</span><br><span class="line">flag = <span class="string">&#x27;CCTF&#123;&#x27;</span> + sha256(flag.encode()).hexdigest() + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;flag_update.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(flag)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;pubkey_update&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(pkey).encode())</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>output.txt：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[            -<span class="number">4602774218265912404</span>*zeta1280^<span class="number">31</span> - <span class="number">25509381853469544908</span>*zeta1280^<span class="number">30</span> + <span class="number">129376017982404349488</span>*zeta1280^<span class="number">29</span> + <span class="number">716286531689185935744</span>*zeta1280^<span class="number">28</span> - <span class="number">1632208466401721293158</span>*zeta1280^<span class="number">27</span> - <span class="number">9028003170806549615013</span>*zeta1280^<span class="number">26</span> + <span class="number">12206704950441875625482</span>*zeta1280^<span class="number">25</span> + <span class="number">67457290883578785545644</span>*zeta1280^<span class="number">24</span> - <span class="number">60204416625997809670344</span>*zeta1280^<span class="number">23</span> - <span class="number">332433796634335506443469</span>*zeta1280^<span class="number">22</span> + <span class="number">206123873952616279215906</span>*zeta1280^<span class="number">21</span> + <span class="number">1137323310449735580891532</span>*zeta1280^<span class="number">20</span> - <span class="number">502186108465894748616016</span>*zeta1280^<span class="number">19</span> - <span class="number">2769056905000016534751538</span>*zeta1280^<span class="number">18</span> + <span class="number">878039249325641175319414</span>*zeta1280^<span class="number">17</span> + <span class="number">4838663751293786838127040</span>*zeta1280^<span class="number">16</span> - <span class="number">1097188014524649363149070</span>*zeta1280^<span class="number">15</span> - <span class="number">6043236501081735721161712</span>*zeta1280^<span class="number">14</span> + <span class="number">964124818127455367449150</span>*zeta1280^<span class="number">13</span> + <span class="number">5308004439355857834330485</span>*zeta1280^<span class="number">12</span> - <span class="number">578006232877698984851372</span>*zeta1280^<span class="number">11</span> - <span class="number">3181061779748249841736219</span>*zeta1280^<span class="number">10</span> + <span class="number">224962785316232564841220</span>*zeta1280^<span class="number">9</span> + <span class="number">1237722919632690072191185</span>*zeta1280^<span class="number">8</span> - <span class="number">52424883340535911897910</span>*zeta1280^<span class="number">7</span> - <span class="number">288372879182213647372365</span>*zeta1280^<span class="number">6</span> + <span class="number">6357946814410664097444</span>*zeta1280^<span class="number">5</span> + <span class="number">34967804349427160519879</span>*zeta1280^<span class="number">4</span> - <span class="number">302245973040480152708</span>*zeta1280^<span class="number">3</span> - <span class="number">1662172616495876145310</span>*zeta1280^<span class="number">2</span> + <span class="number">2366049046813041208</span>*zeta1280 + <span class="number">13011646416303986233</span>                     <span class="number">20341475869141650336</span>*zeta1280^<span class="number">31</span> + <span class="number">1951592807564566629</span>*zeta1280^<span class="number">30</span> - <span class="number">571077856249690441621</span>*zeta1280^<span class="number">29</span> - <span class="number">55295108849716726354</span>*zeta1280^<span class="number">28</span> + <span class="number">7196660823549758544764</span>*zeta1280^<span class="number">27</span> + <span class="number">702767505392614093619</span>*zeta1280^<span class="number">26</span> - <span class="number">53765538109270297626741</span>*zeta1280^<span class="number">25</span> - <span class="number">5291465118503133518883</span>*zeta1280^<span class="number">24</span> + <span class="number">264923914169814211875106</span>*zeta1280^<span class="number">23</span> + <span class="number">26259460116858500856269</span>*zeta1280^<span class="number">22</span> - <span class="number">906245929396843087071465</span>*zeta1280^<span class="number">21</span> - <span class="number">90407733487003834471466</span>*zeta1280^<span class="number">20</span> + <span class="number">2206203021593936629146834</span>*zeta1280^<span class="number">19</span> + <span class="number">221362527660366178501972</span>*zeta1280^<span class="number">18</span> - <span class="number">3854747120193508447272846</span>*zeta1280^<span class="number">17</span> - <span class="number">388741550159692397343437</span>*zeta1280^<span class="number">16</span> + <span class="number">4813958180021168270877045</span>*zeta1280^<span class="number">15</span> + <span class="number">487624064628609110025176</span>*zeta1280^<span class="number">14</span> - <span class="number">4227967989714953615984050</span>*zeta1280^<span class="number">13</span> - <span class="number">429881071729752134763778</span>*zeta1280^<span class="number">12</span> + <span class="number">2533644029049790041455129</span>*zeta1280^<span class="number">11</span> + <span class="number">258414888967057871397446</span>*zeta1280^<span class="number">10</span> - <span class="number">985769426015678192342018</span>*zeta1280^<span class="number">9</span> - <span class="number">100792924475518106238832</span>*zeta1280^<span class="number">8</span> + <span class="number">229662454242100806590311</span>*zeta1280^<span class="number">7</span> + <span class="number">23526719373273264108474</span>*zeta1280^<span class="number">6</span> - <span class="number">27847921707112376241503</span>*zeta1280^<span class="number">5</span> - <span class="number">2856416535680139555816</span>*zeta1280^<span class="number">4</span> + <span class="number">1323714816988549264238</span>*zeta1280^<span class="number">3</span> + <span class="number">135871497938828491146</span>*zeta1280^<span class="number">2</span> - <span class="number">10362137493026264546</span>*zeta1280 - <span class="number">1063759814089207676</span>]</span><br><span class="line">[                    <span class="number">20341475868748923024</span>*zeta1280^<span class="number">31</span> + <span class="number">1951592806605672059</span>*zeta1280^<span class="number">30</span> - <span class="number">571077856238540660223</span>*zeta1280^<span class="number">29</span> - <span class="number">55295108822895822100</span>*zeta1280^<span class="number">28</span> + <span class="number">7196660823407758697940</span>*zeta1280^<span class="number">27</span> + <span class="number">702767505055806319373</span>*zeta1280^<span class="number">26</span> - <span class="number">53765538108198903629865</span>*zeta1280^<span class="number">25</span> - <span class="number">5291465115995185819391</span>*zeta1280^<span class="number">24</span> + <span class="number">264923914164486524534940</span>*zeta1280^<span class="number">23</span> + <span class="number">26259460104538909856351</span>*zeta1280^<span class="number">22</span> - <span class="number">906245929378464841397589</span>*zeta1280^<span class="number">21</span> - <span class="number">90407733444980990175230</span>*zeta1280^<span class="number">20</span> + <span class="number">2206203021548855068437216</span>*zeta1280^<span class="number">19</span> + <span class="number">221362527558328990088394</span>*zeta1280^<span class="number">18</span> - <span class="number">3854747120114205378128966</span>*zeta1280^<span class="number">17</span> - <span class="number">388741549981824734924651</span>*zeta1280^<span class="number">16</span> + <span class="number">4813958179921541651869291</span>*zeta1280^<span class="number">15</span> + <span class="number">487624064406937426541122</span>*zeta1280^<span class="number">14</span> - <span class="number">4227967989627007169290270</span>*zeta1280^<span class="number">13</span> - <span class="number">429881071535409363510562</span>*zeta1280^<span class="number">12</span> + <span class="number">2533644028996862789742983</span>*zeta1280^<span class="number">11</span> + <span class="number">258414888850769755761022</span>*zeta1280^<span class="number">10</span> - <span class="number">985769425995015280773042</span>*zeta1280^<span class="number">9</span> - <span class="number">100792924430327984016820</span>*zeta1280^<span class="number">8</span> + <span class="number">229662454237274355481855</span>*zeta1280^<span class="number">7</span> + <span class="number">23526719362754563876958</span>*zeta1280^<span class="number">6</span> - <span class="number">27847921706526106032793</span>*zeta1280^<span class="number">5</span> - <span class="number">2856416534405482802868</span>*zeta1280^<span class="number">4</span> + <span class="number">1323714816960654684330</span>*zeta1280^<span class="number">3</span> + <span class="number">135871497878260136072</span>*zeta1280^<span class="number">2</span> - <span class="number">10362137492807861970</span>*zeta1280 - <span class="number">1063759813615106246</span> <span class="number">9479323308436728508</span>*zeta1280^<span class="number">31</span> - <span class="number">70533314534492196905</span>*zeta1280^<span class="number">30</span> - <span class="number">265607299367708827120</span>*zeta1280^<span class="number">29</span> + <span class="number">1979831130978284462763</span>*zeta1280^<span class="number">28</span> + <span class="number">3341016926189694874654</span>*zeta1280^<span class="number">27</span> - <span class="number">24945362580283401746400</span>*zeta1280^<span class="number">26</span> - <span class="number">24917836206749318963324</span>*zeta1280^<span class="number">25</span> + <span class="number">186334783002684698789191</span>*zeta1280^<span class="number">24</span> + <span class="number">122586899086925146656452</span>*zeta1280^<span class="number">23</span> - <span class="number">918010464058548571922420</span>*zeta1280^<span class="number">22</span> - <span class="number">418740666342845811245466</span>*zeta1280^<span class="number">21</span> + <span class="number">3139891285412312572660856</span>*zeta1280^<span class="number">20</span> + <span class="number">1018079424800570481061316</span>*zeta1280^<span class="number">19</span> - <span class="number">7642962939237553667703665</span>*zeta1280^<span class="number">18</span> - <span class="number">1776769434047526922198020</span>*zeta1280^<span class="number">17</span> + <span class="number">13352594357905645275206924</span>*zeta1280^<span class="number">16</span> + <span class="number">2216659229139532144217196</span>*zeta1280^<span class="number">15</span> - <span class="number">16673676083116486323107226</span>*zeta1280^<span class="number">14</span> - <span class="number">1945146801270513519057908</span>*zeta1280^<span class="number">13</span> + <span class="number">14642857602023675891482054</span>*zeta1280^<span class="number">12</span> + <span class="number">1164803955054950478252698</span>*zeta1280^<span class="number">11</span> - <span class="number">8774263024173173761196618</span>*zeta1280^<span class="number">10</span> - <span class="number">452930026846689350220538</span>*zeta1280^<span class="number">9</span> + <span class="number">3413634778211777313137122</span>*zeta1280^<span class="number">8</span> + <span class="number">105476445981425991518928</span>*zeta1280^<span class="number">7</span> - <span class="number">795268995785895547201508</span>*zeta1280^<span class="number">6</span> - <span class="number">12785805943160598272756</span>*zeta1280^<span class="number">5</span> + <span class="number">96428355297618433095990</span>*zeta1280^<span class="number">4</span> + <span class="number">607656823442098385608</span>*zeta1280^<span class="number">3</span> - <span class="number">4583526826365167751127</span>*zeta1280^<span class="number">2</span> - <span class="number">4756628030961100976</span>*zeta1280 + <span class="number">35880078853642750464</span>]</span><br></pre></td></tr></table></figure>
<p>这个题目看了一眼我就被劝退了，又是分圆域又是hermite矩阵的，看着就头大。</p>
<p>然后<a target="_blank" rel="noopener" href="https://yolbby.github.io/">@yolbby</a>一语点醒梦中人，定位到这里：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">skey = Matrix([[a, _c], [b, _d]])</span><br><span class="line">pkey = (skey + identity_matrix(<span class="number">2</span>)) * (skey.T - identity_matrix(<span class="number">2</span>))</span><br><span class="line"><span class="keyword">return</span> (skey, pkey)</span><br></pre></td></tr></table></figure>
<p>可以看出skey和pkey都是2x2的矩阵，并且还存在关系如下：</p>
<script type="math/tex; mode=display">
P = (S + I)(S^T-I)</script><p>而其实这相当于四个方程四个未知数，只是元素在一个陌生一点的域中而已，sage依然是可以正常处理的。也就是说，用这四个方程去resultant就可以把skey完全解出来。又由于flag是根据skey生成的，所以解出来之后就可以拿到flag。</p>
<p>exp(from yolbby)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">r&#x27;C:\Users\chax\Desktop\rehawk_updated\pubkey_update&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">C = CyclotomicField(<span class="number">128</span>)</span><br><span class="line">F, PHI = C.maximal_totally_real_subfield()</span><br><span class="line">d = F.degree()</span><br><span class="line">D = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(d)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(d)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(d):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> (i - j) % <span class="number">2</span> == <span class="number">0</span>: D[i][j] = binomial(i, (i - j) &gt;&gt; <span class="number">1</span>)</span><br><span class="line">D = Matrix(D)</span><br><span class="line">O = [F(_) <span class="keyword">for</span> _ <span class="keyword">in</span> D.inverse()]</span><br><span class="line">a = f.readline().replace(<span class="string">b&#x27;                     &#x27;</span>,<span class="string">b&#x27;,&#x27;</span>).replace(<span class="string">b&#x27;^&#x27;</span>,<span class="string">b&#x27;**&#x27;</span>)</span><br><span class="line">zeta1280 = F.gen()</span><br><span class="line">a = matrix(F,<span class="built_in">eval</span>(a))</span><br><span class="line">b = [<span class="number">20341475868748923024</span>*zeta1280**<span class="number">31</span> + <span class="number">1951592806605672059</span>*zeta1280**<span class="number">30</span> - <span class="number">571077856238540660223</span>*zeta1280**<span class="number">29</span> - <span class="number">55295108822895822100</span>*zeta1280**<span class="number">28</span> + <span class="number">7196660823407758697940</span>*zeta1280**<span class="number">27</span> + <span class="number">702767505055806319373</span>*zeta1280**<span class="number">26</span> - <span class="number">53765538108198903629865</span>*zeta1280**<span class="number">25</span> - <span class="number">5291465115995185819391</span>*zeta1280**<span class="number">24</span> + <span class="number">264923914164486524534940</span>*zeta1280**<span class="number">23</span> + <span class="number">26259460104538909856351</span>*zeta1280**<span class="number">22</span> - <span class="number">906245929378464841397589</span>*zeta1280**<span class="number">21</span> - <span class="number">90407733444980990175230</span>*zeta1280**<span class="number">20</span> + <span class="number">2206203021548855068437216</span>*zeta1280**<span class="number">19</span> + <span class="number">221362527558328990088394</span>*zeta1280**<span class="number">18</span> - <span class="number">3854747120114205378128966</span>*zeta1280**<span class="number">17</span> - <span class="number">388741549981824734924651</span>*zeta1280**<span class="number">16</span> + <span class="number">4813958179921541651869291</span>*zeta1280**<span class="number">15</span> + <span class="number">487624064406937426541122</span>*zeta1280**<span class="number">14</span> - <span class="number">4227967989627007169290270</span>*zeta1280**<span class="number">13</span> - <span class="number">429881071535409363510562</span>*zeta1280**<span class="number">12</span> + <span class="number">2533644028996862789742983</span>*zeta1280**<span class="number">11</span> + <span class="number">258414888850769755761022</span>*zeta1280**<span class="number">10</span> - <span class="number">985769425995015280773042</span>*zeta1280**<span class="number">9</span> - <span class="number">100792924430327984016820</span>*zeta1280**<span class="number">8</span> + <span class="number">229662454237274355481855</span>*zeta1280**<span class="number">7</span> + <span class="number">23526719362754563876958</span>*zeta1280**<span class="number">6</span> - <span class="number">27847921706526106032793</span>*zeta1280**<span class="number">5</span> - <span class="number">2856416534405482802868</span>*zeta1280**<span class="number">4</span> + <span class="number">1323714816960654684330</span>*zeta1280**<span class="number">3</span> + <span class="number">135871497878260136072</span>*zeta1280**<span class="number">2</span> - <span class="number">10362137492807861970</span>*zeta1280 - <span class="number">1063759813615106246</span>,<span class="number">9479323308436728508</span>*zeta1280**<span class="number">31</span> - <span class="number">70533314534492196905</span>*zeta1280**<span class="number">30</span> - <span class="number">265607299367708827120</span>*zeta1280**<span class="number">29</span> + <span class="number">1979831130978284462763</span>*zeta1280**<span class="number">28</span> + <span class="number">3341016926189694874654</span>*zeta1280**<span class="number">27</span> - <span class="number">24945362580283401746400</span>*zeta1280**<span class="number">26</span> - <span class="number">24917836206749318963324</span>*zeta1280**<span class="number">25</span> + <span class="number">186334783002684698789191</span>*zeta1280**<span class="number">24</span> + <span class="number">122586899086925146656452</span>*zeta1280**<span class="number">23</span> - <span class="number">918010464058548571922420</span>*zeta1280**<span class="number">22</span> - <span class="number">418740666342845811245466</span>*zeta1280**<span class="number">21</span> + <span class="number">3139891285412312572660856</span>*zeta1280**<span class="number">20</span> + <span class="number">1018079424800570481061316</span>*zeta1280**<span class="number">19</span> - <span class="number">7642962939237553667703665</span>*zeta1280**<span class="number">18</span> - <span class="number">1776769434047526922198020</span>*zeta1280**<span class="number">17</span> + <span class="number">13352594357905645275206924</span>*zeta1280**<span class="number">16</span> + <span class="number">2216659229139532144217196</span>*zeta1280**<span class="number">15</span> - <span class="number">16673676083116486323107226</span>*zeta1280**<span class="number">14</span> - <span class="number">1945146801270513519057908</span>*zeta1280**<span class="number">13</span> + <span class="number">14642857602023675891482054</span>*zeta1280**<span class="number">12</span> + <span class="number">1164803955054950478252698</span>*zeta1280**<span class="number">11</span> - <span class="number">8774263024173173761196618</span>*zeta1280**<span class="number">10</span> - <span class="number">452930026846689350220538</span>*zeta1280**<span class="number">9</span> + <span class="number">3413634778211777313137122</span>*zeta1280**<span class="number">8</span> + <span class="number">105476445981425991518928</span>*zeta1280**<span class="number">7</span> - <span class="number">795268995785895547201508</span>*zeta1280**<span class="number">6</span> - <span class="number">12785805943160598272756</span>*zeta1280**<span class="number">5</span> + <span class="number">96428355297618433095990</span>*zeta1280**<span class="number">4</span> + <span class="number">607656823442098385608</span>*zeta1280**<span class="number">3</span> - <span class="number">4583526826365167751127</span>*zeta1280**<span class="number">2</span> - <span class="number">4756628030961100976</span>*zeta1280 + <span class="number">35880078853642750464</span>]</span><br><span class="line">b = matrix(F,b)</span><br><span class="line">pkey = block_matrix([[a],[b]])</span><br><span class="line">a2_c_2 = pkey[<span class="number">0</span>,<span class="number">0</span>]+<span class="number">1</span></span><br><span class="line">b_c = ((pkey[<span class="number">0</span>,<span class="number">1</span>]-pkey[<span class="number">1</span>,<span class="number">0</span>])/<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">ab_cd = pkey[<span class="number">0</span>,<span class="number">1</span>]-b_c</span><br><span class="line">b2_d_2 = pkey[<span class="number">1</span>,<span class="number">1</span>]+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a2_c_2)</span><br><span class="line"><span class="built_in">print</span>(ab_cd)</span><br><span class="line"><span class="built_in">print</span>(b2_d_2)</span><br><span class="line"></span><br><span class="line">R.&lt;a,b,c,d&gt; = PolynomialRing(F)</span><br><span class="line">f1 = a^<span class="number">2</span>+c^<span class="number">2</span>-a2_c_2</span><br><span class="line">f2 = a*b+c*d-ab_cd</span><br><span class="line">f3 = b^<span class="number">2</span>+d^<span class="number">2</span>-b2_d_2</span><br><span class="line">f4 = b-c-b_c</span><br><span class="line"></span><br><span class="line">h1 = f1.sylvester_matrix(f4, b).det()</span><br><span class="line">h2 = f2.sylvester_matrix(f4, b).det()</span><br><span class="line">h3 = f3.sylvester_matrix(f4, b).det()</span><br><span class="line">g1 = h1.sylvester_matrix(h2, c).det()</span><br><span class="line">g2 = h1.sylvester_matrix(h3, c).det()</span><br><span class="line">t = g1.sylvester_matrix(g2, d).det()</span><br><span class="line"></span><br><span class="line">R.&lt;a&gt; = PolynomialRing(F)</span><br><span class="line">t = R(t)</span><br><span class="line"><span class="comment">#print(t.roots())</span></span><br><span class="line"></span><br><span class="line">a = -<span class="number">8</span>*zeta1280^<span class="number">31</span> + <span class="number">6</span>*zeta1280^<span class="number">30</span> + <span class="number">11</span>*zeta1280^<span class="number">29</span> - <span class="number">11</span>*zeta1280^<span class="number">28</span> - <span class="number">2</span>*zeta1280^<span class="number">27</span> - <span class="number">30</span>*zeta1280^<span class="number">26</span> + <span class="number">12</span>*zeta1280^<span class="number">25</span> - <span class="number">3</span>*zeta1280^<span class="number">24</span> + <span class="number">6</span>*zeta1280^<span class="number">23</span> + <span class="number">18</span>*zeta1280^<span class="number">22</span> - <span class="number">15</span>*zeta1280^<span class="number">21</span> + <span class="number">32</span>*zeta1280^<span class="number">20</span> - <span class="number">22</span>*zeta1280^<span class="number">19</span> + <span class="number">26</span>*zeta1280^<span class="number">18</span> + <span class="number">4</span>*zeta1280^<span class="number">17</span> + <span class="number">22</span>*zeta1280^<span class="number">16</span> - <span class="number">13</span>*zeta1280^<span class="number">15</span> + <span class="number">29</span>*zeta1280^<span class="number">14</span> - <span class="number">6</span>*zeta1280^<span class="number">13</span> - <span class="number">24</span>*zeta1280^<span class="number">12</span> - <span class="number">3</span>*zeta1280^<span class="number">11</span> - <span class="number">27</span>*zeta1280^<span class="number">10</span> + <span class="number">30</span>*zeta1280^<span class="number">9</span> + <span class="number">20</span>*zeta1280^<span class="number">8</span> + <span class="number">26</span>*zeta1280^<span class="number">7</span> + <span class="number">29</span>*zeta1280^<span class="number">6</span> - <span class="number">13</span>*zeta1280^<span class="number">5</span> - <span class="number">12</span>*zeta1280^<span class="number">4</span> + <span class="number">10</span>*zeta1280^<span class="number">3</span> - <span class="number">15</span>*zeta1280^<span class="number">2</span> + <span class="number">21</span>*zeta1280 + <span class="number">17</span></span><br><span class="line">R.&lt;c&gt; = PolynomialRing(F)</span><br><span class="line">f1 = a^<span class="number">2</span>+c^<span class="number">2</span>-a2_c_2</span><br><span class="line"><span class="comment">#print(f1.roots())</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">196363659</span>*zeta1280^<span class="number">31</span> + <span class="number">479447260</span>*zeta1280^<span class="number">30</span> - <span class="number">5574890698</span>*zeta1280^<span class="number">29</span> - <span class="number">13410452103</span>*zeta1280^<span class="number">28</span> + <span class="number">70999923425</span>*zeta1280^<span class="number">27</span> + <span class="number">168403887120</span>*zeta1280^<span class="number">26</span> - <span class="number">535696998441</span>*zeta1280^<span class="number">25</span> - <span class="number">1253973849729</span>*zeta1280^<span class="number">24</span> + <span class="number">2663843670086</span>*zeta1280^<span class="number">23</span> + <span class="number">6159795499952</span>*zeta1280^<span class="number">22</span> - <span class="number">9189122836929</span>*zeta1280^<span class="number">21</span> - <span class="number">21011422148145</span>*zeta1280^<span class="number">20</span> + <span class="number">22540780354795</span>*zeta1280^<span class="number">19</span> + <span class="number">51018594206807</span>*zeta1280^<span class="number">18</span> - <span class="number">39651534571929</span>*zeta1280^<span class="number">17</span> - <span class="number">88933831209400</span>*zeta1280^<span class="number">16</span> + <span class="number">49813309503893</span>*zeta1280^<span class="number">15</span> + <span class="number">110835841742009</span>*zeta1280^<span class="number">14</span> - <span class="number">43973223346903</span>*zeta1280^<span class="number">13</span> - <span class="number">97171385626612</span>*zeta1280^<span class="number">12</span> + <span class="number">26463625856054</span>*zeta1280^<span class="number">11</span> + <span class="number">58144057818179</span>*zeta1280^<span class="number">10</span> - <span class="number">10331455784462</span>*zeta1280^<span class="number">9</span> - <span class="number">22595061111030</span>*zeta1280^<span class="number">8</span> + <span class="number">2413225554250</span>*zeta1280^<span class="number">7</span> + <span class="number">5259350115786</span>*zeta1280^<span class="number">6</span> - <span class="number">293135104364</span>*zeta1280^<span class="number">5</span> - <span class="number">637328376483</span>*zeta1280^<span class="number">4</span> + <span class="number">13947289953</span>*zeta1280^<span class="number">3</span> + <span class="number">30284177528</span>*zeta1280^<span class="number">2</span> - <span class="number">109201303</span>*zeta1280 - <span class="number">237050725</span></span><br><span class="line">c = -c</span><br><span class="line">b = c+b_c</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line">R.&lt;d&gt; = PolynomialRing(F)</span><br><span class="line">f3 = b^<span class="number">2</span>+d^<span class="number">2</span>-b2_d_2</span><br><span class="line"><span class="built_in">print</span>(f3.roots())</span><br><span class="line">d = <span class="number">266010789</span>*zeta1280^<span class="number">31</span> + <span class="number">482737266</span>*zeta1280^<span class="number">30</span> - <span class="number">7361323736</span>*zeta1280^<span class="number">29</span> - <span class="number">13829433097</span>*zeta1280^<span class="number">28</span> + <span class="number">91483219711</span>*zeta1280^<span class="number">27</span> + <span class="number">177606388336</span>*zeta1280^<span class="number">26</span> - <span class="number">674398006293</span>*zeta1280^<span class="number">25</span> - <span class="number">1350408311994</span>*zeta1280^<span class="number">24</span> + <span class="number">3281208330570</span>*zeta1280^<span class="number">23</span> + <span class="number">6762561063913</span>*zeta1280^<span class="number">22</span> - <span class="number">11091831601900</span>*zeta1280^<span class="number">21</span> - <span class="number">23477085414453</span>*zeta1280^<span class="number">20</span> + <span class="number">26707622486418</span>*zeta1280^<span class="number">19</span> + <span class="number">57918642171854</span>*zeta1280^<span class="number">18</span> - <span class="number">46200520267420</span>*zeta1280^<span class="number">17</span> - <span class="number">102400447660711</span>*zeta1280^<span class="number">16</span> + <span class="number">57184654198715</span>*zeta1280^<span class="number">15</span> + <span class="number">129209740105463</span>*zeta1280^<span class="number">14</span> - <span class="number">49834602378781</span>*zeta1280^<span class="number">13</span> - <span class="number">114489362577117</span>*zeta1280^<span class="number">12</span> + <span class="number">29667951387175</span>*zeta1280^<span class="number">11</span> + <span class="number">69115665617763</span>*zeta1280^<span class="number">10</span> - <span class="number">11481488829941</span>*zeta1280^<span class="number">9</span> - <span class="number">27050018004836</span>*zeta1280^<span class="number">8</span> + <span class="number">2664050718278</span>*zeta1280^<span class="number">7</span> + <span class="number">6330200656934</span>*zeta1280^<span class="number">6</span> - <span class="number">322126775377</span>*zeta1280^<span class="number">5</span> - <span class="number">769914149547</span>*zeta1280^<span class="number">4</span> + <span class="number">15288262361</span>*zeta1280^<span class="number">3</span> + <span class="number">36657928391</span>*zeta1280^<span class="number">2</span> - <span class="number">119641092</span>*zeta1280 - <span class="number">287055447</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a*b+c*d == ab_cd)</span><br><span class="line">skey = matrix([[a,c],[b,d]])</span><br><span class="line"></span><br><span class="line">P = (skey + identity_matrix(<span class="number">2</span>)) * (skey.T - identity_matrix(<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(P[<span class="number">0</span>,<span class="number">0</span>] == pkey[<span class="number">0</span>,<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(P[<span class="number">0</span>,<span class="number">1</span>] == pkey[<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(P[<span class="number">1</span>,<span class="number">0</span>] == pkey[<span class="number">1</span>,<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(P[<span class="number">1</span>,<span class="number">1</span>] == pkey[<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line">flag = <span class="built_in">str</span>(<span class="built_in">sum</span>(skey.coefficients()).polynomial()(<span class="number">2</span>^<span class="number">128</span>))</span><br><span class="line">flag = <span class="string">&#x27;CCTF&#123;&#x27;</span> + sha256(flag.encode()).hexdigest() + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Vorop-7-solves-334-pts"><a href="#Vorop-7-solves-334-pts" class="headerlink" title="Vorop(7 solves , 334 pts)"></a>Vorop(7 solves , 334 pts)</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vorop is a post-modern cryptosystem with diverse applications in finite fields and matrices - thoroughly analyze it to attempt breaking it.</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>(): </span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rand_utm</span>(<span class="params">F, n</span>):</span><br><span class="line">	M = matrix(F, n, n)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i, n):</span><br><span class="line">			M[i,j] = F.random_element()</span><br><span class="line">	<span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upper</span>(<span class="params">F, M</span>):</span><br><span class="line">	r, c = M.nrows(), M.ncols()</span><br><span class="line">	_U = matrix(F, r, c)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r):</span><br><span class="line">		_U[i, i] = M[i, i]</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, c):</span><br><span class="line">			_U[i, j] = M[i, j] + M[j, i]</span><br><span class="line">	<span class="keyword">return</span> _U</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">q, m, d, u</span>):</span><br><span class="line">	n = m + d + u</span><br><span class="line">	F = GF(q)</span><br><span class="line">	O = random_matrix(F, u, m + d)</span><br><span class="line">	c = O.ncols()</span><br><span class="line">	I = identity_matrix(F, c)</span><br><span class="line">	OI = block_matrix([[O], [I]])</span><br><span class="line">	P = []</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">		A = rand_utm(F, u)</span><br><span class="line">		B = random_matrix(F, u, m + d)</span><br><span class="line">		C = O.transpose() * A * O + O.transpose() * B</span><br><span class="line">		C = upper(F, C)</span><br><span class="line">		D = matrix(F, m + d, u)</span><br><span class="line">		Q = block_matrix([[A, B], [D, C]])</span><br><span class="line">		P.append(Q)		</span><br><span class="line">	<span class="keyword">return</span> (O, OI), P</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">iszero</span>(<span class="params">M</span>):</span><br><span class="line">	F, r, c = M.base_ring(), M.nrows(), M.ncols()</span><br><span class="line">	<span class="keyword">return</span> matrix(F, r, c) == M</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">n2F</span>(<span class="params">n</span>):</span><br><span class="line">	z = GF(<span class="number">256</span>).gen()</span><br><span class="line">	G, g = <span class="built_in">bin</span>(n)[<span class="number">2</span>:].zfill(<span class="number">8</span>), GF(<span class="number">256</span>)(<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">		g += <span class="built_in">int</span>(G[i]) * z ^ (<span class="number">7</span> - i)</span><br><span class="line">	<span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compress</span>(<span class="params">M</span>):</span><br><span class="line">	r, c = M.nrows(), M.ncols()</span><br><span class="line">	_M = matrix(r, c)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(c):</span><br><span class="line">			_M[i, j] = M[i][j].to_integer()</span><br><span class="line">	<span class="keyword">return</span> _M</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">oracle</span>(<span class="params">O</span>) :</span><br><span class="line">	F = O.base_ring()</span><br><span class="line">	r, c = O.nrows(), O.ncols()</span><br><span class="line">	n = r + c</span><br><span class="line">	I = identity_matrix(F, c)</span><br><span class="line">	OI = block_matrix([[O], [I]])</span><br><span class="line">	U = matrix(F, n, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">while</span>(iszero(U)):</span><br><span class="line">		V = random_matrix(F, c, <span class="number">1</span>)</span><br><span class="line">		U = OI * V</span><br><span class="line">	<span class="keyword">return</span> U</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isequal</span>(<span class="params">F, A, B</span>):</span><br><span class="line">	l, k = <span class="built_in">len</span>(A), <span class="built_in">len</span>(B)</span><br><span class="line">	<span class="keyword">if</span> l != k: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	n = A[<span class="number">0</span>].nrows()</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">		V = random_matrix(F, n, <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">			r = V.transpose() * A[_] * V</span><br><span class="line">			s = V.transpose() * B[_] * V</span><br><span class="line">			<span class="keyword">if</span> r != s: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">P, OI</span>):</span><br><span class="line">	r, c, F = P[<span class="number">0</span>].nrows(), OI.ncols(), OI.base_ring()</span><br><span class="line">	B, Z = [], []</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> P:</span><br><span class="line">		Z.append(matrix(F, c, c))</span><br><span class="line">		B.append(OI.transpose() * _ * OI)</span><br><span class="line">	<span class="keyword">return</span> isequal(F, B, Z)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;┃&quot;</span></span><br><span class="line">	pr(        <span class="string">&quot;┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓&quot;</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;  .: Welcome to VOROP oracle! Try to break this cryptosystem :.   &quot;</span>, border)</span><br><span class="line">	pr(        <span class="string">&quot;┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛&quot;</span>)</span><br><span class="line">	q, m, d, u = <span class="number">2</span>**<span class="number">8</span>, <span class="number">38</span>, <span class="number">8</span>, <span class="number">86</span></span><br><span class="line">	params = (q, m, d, u)</span><br><span class="line">	F = GF(q)</span><br><span class="line">	(O, OI), P = genkey(q, m, d, u)</span><br><span class="line">	U = oracle(O)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> verify(P, OI):	</span><br><span class="line">		pr(<span class="string">&quot;| Options: \n|\t[G]et the parameters \n|\t[O]racle output \n|\t[P]ublic key \n|\t[V]erify \n|\t[Q]uit&quot;</span>)</span><br><span class="line">		ans = sc().decode().lower().strip()</span><br><span class="line">		<span class="keyword">if</span> ans == <span class="string">&#x27;g&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">f&quot;The parameters are q, m, d, u = <span class="subst">&#123;q, m, d, u&#125;</span>&quot;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;o&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">f&quot;The oracle output U = <span class="subst">&#123;compress(U.transpose())&#125;</span>&quot;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">f&quot;Public key P is very large matrix, I will print row by row!&quot;</span>)</span><br><span class="line">			<span class="keyword">for</span> p <span class="keyword">in</span> P:</span><br><span class="line">				_p = compress(p)</span><br><span class="line">				<span class="keyword">for</span> _r <span class="keyword">in</span> _p:</span><br><span class="line">					pr(border, <span class="string">f&quot;<span class="subst">&#123;_r&#125;</span>&quot;</span>)</span><br><span class="line">				pr(border, <span class="string">&quot;━&quot;</span> * <span class="number">40</span>)</span><br><span class="line">			pr(border, <span class="string">&quot;Done!&quot;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;v&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">f&quot;You should send a matrix with the appropriate size!&quot;</span>)</span><br><span class="line">			pr(border, <span class="string">f&quot;So please send it row by row separated by comma &#x27;,&#x27;&quot;</span>)</span><br><span class="line">			B = []</span><br><span class="line">			<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(m + d):</span><br><span class="line">				pr(border, <span class="string">f&quot;Send the row <span class="subst">&#123;_&#125;</span>:&quot;</span>)</span><br><span class="line">				_r = sc().decode().split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">				<span class="keyword">try</span>:</span><br><span class="line">					_r = [n2F(<span class="built_in">int</span>(_)) <span class="keyword">for</span> _ <span class="keyword">in</span> _r]</span><br><span class="line">					B.append(_r)</span><br><span class="line">				<span class="keyword">except</span>:</span><br><span class="line">					die(border, <span class="string">f&quot;The input you provided is is not valid!&quot;</span>)</span><br><span class="line">			_b, B = <span class="literal">False</span>, matrix(F, B)</span><br><span class="line">			<span class="keyword">if</span> B.ncols() == m + d + u:</span><br><span class="line">				_b = verify(P, B.transpose()) <span class="keyword">and</span> <span class="keyword">not</span> B.is_zero()</span><br><span class="line">				<span class="keyword">if</span> _b:</span><br><span class="line">					die(border, <span class="string">f&#x27;Congrats, you got the flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					die(border, <span class="string">f&#x27;The provided matrix is not correct! Bye!!&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;Quitting...&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">f&quot;Your input does not meet the requirements!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>知识盲区，按<a target="_blank" rel="noopener" href="https://hash-hash.github.io/">@hash-hash</a>的说法是基于多变量的一道题目，之前稍微看过一点多变量，但除了还记得油变量和醋变量之外，其他的完全不懂了。</p>
<p>直接写attack好像很折磨，hashhash就发动群友一起找现成的attack，然后<a target="_blank" rel="noopener" href="https://wleukocytec.github.io/">@leukocyte</a>找到了这篇：</p>
<p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2024/279.pdf">https://eprint.iacr.org/2024/279.pdf</a></p>
<p>里面有实现：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/River-Moreira-Ferreira/prov-attack">https://github.com/River-Moreira-Ferreira/prov-attack</a></p>
<p>hashhash稍微调调就能用了，但我确实是一点都整不明白，直接躺好。而且hashhash好像还发现了个非预期。</p>
<p>然而奇怪的事情又发生了——交互总是会卡在第33轮，开始怀疑是网的问题，所以大家都跑了一遍，都卡在33轮。leukocyte最后发现他远端下发的参数和题目附件的不一样，对应改一改就好了。</p>
<p>但还是完全不懂多变量，有空学一学。</p>
<p><br></p>
<p><br></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>虽然比赛槽点很多，但是总而言之，一群喜欢密码的师傅聚一块儿打比赛本来就是很开心的事情，明年继续加油。</p>
<p>还有就是比赛结束第二天去CTFtime建战队的时候发现cyberCryer这个战队名<strong>被 抢 注 了</strong>，真是离了大谱。给CTFtime发feedback过后恢复了正常，然而排名似乎不太好改了，发feedback、发邮件甚至去推上at都没有人理，伤心。</p>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/cf09b856.html" title="2024-CryptoCTF-wp-crypto">https://tangcuxiaojikuai.xyz/post/cf09b856.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/ee681ca2.html" rel="prev" title="2024-京麒CTF-wp-crypto">
      <i class="fa fa-chevron-left"></i> 2024-京麒CTF-wp-crypto
    </a></div>
      <div class="post-nav-item">
    <a href="/post/a02848e0.html" rel="next" title="2024-春秋杯网络安全联赛夏季赛-wp-crypto">
      2024-春秋杯网络安全联赛夏季赛-wp-crypto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%98%9F%E4%BC%8D%E5%85%B6%E4%BB%96%E5%B8%88%E5%82%85%E7%9A%84wp%E6%8C%87%E8%B7%AF%EF%BC%9A"><span class="nav-number">1.</span> <span class="nav-text">队伍其他师傅的wp指路：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Warm-up"><span class="nav-number">2.</span> <span class="nav-text">Warm-up</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Welcome-%F0%9F%91%8B-367-solves-27-pts"><span class="nav-number">2.1.</span> <span class="nav-text">Welcome! 👋(367 solves , 27 pts)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Easy"><span class="nav-number">3.</span> <span class="nav-text">Easy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Alibos-181-solves-36-pts"><span class="nav-number">3.1.</span> <span class="nav-text">Alibos(181 solves , 36 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Beheaded-32-solves-131-pts"><span class="nav-number">3.2.</span> <span class="nav-text">Beheaded(32 solves , 131 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mashy-68-solves-71-pts"><span class="nav-number">3.3.</span> <span class="nav-text">Mashy(68 solves , 71 pts)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Medium"><span class="nav-number">4.</span> <span class="nav-text">Medium</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Ahoo-29-solves-142-pts"><span class="nav-number">4.1.</span> <span class="nav-text">Ahoo(29 solves , 142 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Alilbols-59-solves-80-pts"><span class="nav-number">4.2.</span> <span class="nav-text">Alilbols(59 solves , 80 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ally-22-solves-174-pts"><span class="nav-number">4.3.</span> <span class="nav-text">Ally(22 solves , 174 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bada-51-solves-90-pts"><span class="nav-number">4.4.</span> <span class="nav-text">Bada(51 solves , 90 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Duzly-0-solves-500-pts"><span class="nav-number">4.5.</span> <span class="nav-text">Duzly(0 solves , 500 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Forghan-36-solves-119-pts"><span class="nav-number">4.6.</span> <span class="nav-text">Forghan(36 solves , 119 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Honey-48-solves-95-pts"><span class="nav-number">4.7.</span> <span class="nav-text">Honey(48 solves , 95 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Joe-19-120-solves-47-pts"><span class="nav-number">4.8.</span> <span class="nav-text">Joe-19(120 solves , 47 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Melek-66-solves-73-pts"><span class="nav-number">4.9.</span> <span class="nav-text">Melek(66 solves , 73 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nabat-25-solves-159-pts"><span class="nav-number">4.10.</span> <span class="nav-text">Nabat(25 solves , 159 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nazdone-35-solves-122-pts"><span class="nav-number">4.11.</span> <span class="nav-text">Nazdone(35 solves , 122 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RM2-64-solves-75-pts"><span class="nav-number">4.12.</span> <span class="nav-text">RM2(64 solves , 75 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Soufia-36-solves-119-pts"><span class="nav-number">4.13.</span> <span class="nav-text">Soufia(36 solves , 119 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vantuk-51-solves-90-pts"><span class="nav-number">4.14.</span> <span class="nav-text">Vantuk(51 solves , 90 pts)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hard"><span class="nav-number">5.</span> <span class="nav-text">Hard</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chochol-15-solves-226-pts"><span class="nav-number">5.1.</span> <span class="nav-text">Chochol(15 solves , 226 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Imen-19-solves-194-pts"><span class="nav-number">5.2.</span> <span class="nav-text">Imen(19 solves , 194 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Latifa-22-solves-174-pts"><span class="nav-number">5.3.</span> <span class="nav-text">Latifa(22 solves , 174 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#O7R-23-solves-169-pts"><span class="nav-number">5.4.</span> <span class="nav-text">O7R(23 solves , 169 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solmaz-11-solves-271-pts"><span class="nav-number">5.5.</span> <span class="nav-text">Solmaz(11 solves , 271 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tesvir-27-solves-150-pts"><span class="nav-number">5.6.</span> <span class="nav-text">Tesvir(27 solves , 150 pts)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tough"><span class="nav-number">6.</span> <span class="nav-text">Tough</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Capac-5-solves-375-pts"><span class="nav-number">6.1.</span> <span class="nav-text">Capac(5 solves , 375 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Jonon-13-solves-247-pts"><span class="nav-number">6.2.</span> <span class="nav-text">Jonon(13 solves , 247 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rehawk-9-solves-300-pts"><span class="nav-number">6.3.</span> <span class="nav-text">Rehawk(9 solves , 300 pts)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vorop-7-solves-334-pts"><span class="nav-number">6.4.</span> <span class="nav-text">Vorop(7 solves , 334 pts)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">7.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
