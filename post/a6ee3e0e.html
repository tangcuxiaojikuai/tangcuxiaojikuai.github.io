<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="CryptoCTF，如果是学密码的师傅的话，应该不需要再介绍这个比赛了。复现过程中学到了不少东西，而且有一个好处就是，不会的题目都有详细的wp可以看(๑¯ω¯๑)。 写这篇文章的目的主要是记录和分享自己复现的思路与过程。因此，对于我不看wp做不出来的的题目，标个*常看常新；对于我看了wp也暂时做不明白的题目标个$，希望以后某天可以学会。 每个题目就放一下题面，可以在NSS平台上下载完整题目附件。题">
<meta property="og:type" content="article">
<meta property="og:title" content="2023-CryptoCTF-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/a6ee3e0e.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="CryptoCTF，如果是学密码的师傅的话，应该不需要再介绍这个比赛了。复现过程中学到了不少东西，而且有一个好处就是，不会的题目都有详细的wp可以看(๑¯ω¯๑)。 写这篇文章的目的主要是记录和分享自己复现的思路与过程。因此，对于我不看wp做不出来的的题目，标个*常看常新；对于我看了wp也暂时做不明白的题目标个$，希望以后某天可以学会。 每个题目就放一下题面，可以在NSS平台上下载完整题目附件。题">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-02-12T09:18:05.000Z">
<meta property="article:modified_time" content="2024-02-12T13:48:49.837Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/a6ee3e0e.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2023-CryptoCTF-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/a6ee3e0e.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2023-CryptoCTF-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-02-12 17:18:05 / 修改时间：21:48:49" itemprop="dateCreated datePublished" datetime="2024-02-12T17:18:05+08:00">2024-02-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/a6ee3e0e.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/a6ee3e0e.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>CryptoCTF，如果是学密码的师傅的话，应该不需要再介绍这个比赛了。复现过程中学到了不少东西，而且有一个好处就是，不会的题目都有详细的wp可以看(๑¯ω¯๑)。</p>
<p>写这篇文章的目的主要是记录和分享自己复现的思路与过程。因此，对于我不看wp做不出来的的题目，标个*常看常新；对于我看了wp也暂时做不明白的题目标个$，希望以后某天可以学会。</p>
<p>每个题目就放一下题面，可以在NSS平台上下载完整题目附件。题目顺序就按春乎里看到的easy、medium、hard、tough来。</p>
<span id="more"></span>
<h2 id="easy"><a href="#easy" class="headerlink" title="easy"></a>easy</h2><h3 id="Did-it"><a href="#Did-it" class="headerlink" title="Did it!"></a>Did it!</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>():</span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">did</span>(<span class="params">n, l, K, A</span>):</span><br><span class="line">	A, K = <span class="built_in">set</span>(A), <span class="built_in">set</span>(K)</span><br><span class="line">	R = [<span class="built_in">pow</span>(_, <span class="number">2</span>, n) + randint(<span class="number">0</span>, <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> A - K]</span><br><span class="line">	<span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;+&quot;</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;.::   Hi all, she DID it, you should do it too! Are you ready? ::.  &quot;</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	_flag = <span class="literal">False</span></span><br><span class="line">	n, l = <span class="number">127</span>, <span class="number">20</span></span><br><span class="line">	N = <span class="built_in">set</span>(<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0</span>, n)))</span><br><span class="line">	K = [randint(<span class="number">0</span>, n-<span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l)]</span><br><span class="line">	cnt, STEP = <span class="number">0</span>, <span class="number">2</span> * n // l - <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		ans = sc().decode().strip()</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			_A = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _  <span class="keyword">in</span> ans.split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(_A) &lt;= l <span class="keyword">and</span> <span class="built_in">set</span>(_A).issubset(N):</span><br><span class="line">				DID = did(n, l, K, _A)</span><br><span class="line">				pr(border, <span class="string">f&#x27;DID = <span class="subst">&#123;DID&#125;</span>&#x27;</span>)</span><br><span class="line">				<span class="keyword">if</span> <span class="built_in">set</span>(_A) == <span class="built_in">set</span>(K):</span><br><span class="line">					_flag = <span class="literal">True</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				die(border, <span class="string">&#x27;Exception! Bye!!&#x27;</span>)</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;Your input is not valid! Bye!!&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span> _flag:</span><br><span class="line">			die(border, <span class="string">f&#x27;Congrats! the flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span> cnt &gt; STEP:</span><br><span class="line">			die(border, <span class="string">f&#x27;Too many tries, bye!&#x27;</span>)</span><br><span class="line">		cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>题目是一个猜数游戏，其步骤为：</p>
<ul>
<li>生成一个列表K，K中元素是20个0到126的随机数(可以相同)</li>
<li>有最多11次猜测机会，每次机会可以：</li>
<li><ul>
<li>最多输入20个数字，要求每个数字也在0到126之间，这些输入的数字构成一个集合A</li>
<li>对于集合A-K中的每个数，靶机计算该数模127下的平方，并随机返回这个值或这个值+1</li>
</ul>
</li>
<li>如果某次输入的集合A和K相等，就得到flag</li>
</ul>
<p>也就是说任务是要利用这最多11次靶机的返回信息，把集合K猜全，然后在第12次输入K集合给靶机，就能得到flag。</p>
<p>那最简单的思路，就是每次传20个不同的数字进去，这样7次就可以传完所有0-126之间的数。然后对于每一次靶机的返回，如果其返回长度和我们传入的长度不一样，说明传入的数字里有在K中的数。而我们知道，返回的值都是在A中、却不在K中的数字产生的，那么我们可以逐个核验我们传入的数字，看他们平方后的值或平方后的值+1是否在返回值中，如果不在，那么这个数字就是K中的数字。</p>
<p>但是这样做有个问题就是，即使一个数字确实在K中，他平方后的值或平方后的值+1也可能在返回值里，所以可能会被错误地认为他不在K中，导致我们找不全。而这也很好处理，我们只需要把所有平方后的值或平方后的值+1均两两不同的数字放在同一次传入里就可以了，这样就不会漏掉K中的任何一个数字。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28552</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 construct division of number</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">construct_set</span>(<span class="params">n</span>):</span><br><span class="line">    setlist = [[] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(setlist)):</span><br><span class="line">            Issame = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">len</span>(setlist[j]) &lt; <span class="number">20</span>):</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> setlist[j]:</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">pow</span>(i,<span class="number">2</span>,n) == <span class="built_in">pow</span>(k,<span class="number">2</span>,n) <span class="keyword">or</span> <span class="built_in">pow</span>(i,<span class="number">2</span>,n) == <span class="built_in">pow</span>(k,<span class="number">2</span>,n)-<span class="number">1</span> <span class="keyword">or</span> <span class="built_in">pow</span>(i,<span class="number">2</span>,n) == <span class="built_in">pow</span>(k,<span class="number">2</span>,n)+<span class="number">1</span>):</span><br><span class="line">                        Issame = <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span>(Issame == <span class="number">0</span>):</span><br><span class="line">                    setlist[j].append(i)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">while</span>([] <span class="keyword">in</span> setlist):</span><br><span class="line">        setlist=setlist[:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> setlist</span><br><span class="line">n = <span class="number">127</span></span><br><span class="line">setlist = construct_set(n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 send set by set and get flag</span></span><br><span class="line">K = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(setlist)):</span><br><span class="line">    ans = setlist[i]</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(ans)[<span class="number">1</span>:-<span class="number">1</span>].encode())</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;DID = &quot;</span>)</span><br><span class="line">    did = <span class="built_in">eval</span>(sh.recvline().strip().decode())</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(did) != <span class="built_in">len</span>(ans)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> ans:</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">pow</span>(j,<span class="number">2</span>,n) <span class="keyword">not</span> <span class="keyword">in</span> did <span class="keyword">and</span> <span class="built_in">pow</span>(j,<span class="number">2</span>,n)+<span class="number">1</span> <span class="keyword">not</span> <span class="keyword">in</span> did):</span><br><span class="line">                K.append(j)</span><br><span class="line"></span><br><span class="line">sh.sendline(<span class="built_in">str</span>(K)[<span class="number">1</span>:-<span class="number">1</span>].encode())</span><br><span class="line">sh.recvline()</span><br><span class="line"><span class="built_in">print</span>(sh.recvline())</span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;437477ea-448e-4737-8f69-d491a82f8188&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Suction"><a href="#Suction" class="headerlink" title="Suction"></a>Suction</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>(<span class="params">nbit, r</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		p, q = [getPrime(nbit) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;__&#x27;</span>]</span><br><span class="line">		e, n = getPrime(<span class="number">16</span>), p * q</span><br><span class="line">		phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">if</span> GCD(e, phi) == <span class="number">1</span>:</span><br><span class="line">			N = <span class="built_in">bin</span>(n)[<span class="number">2</span>:-r]</span><br><span class="line">			E = <span class="built_in">bin</span>(e)[<span class="number">2</span>:-r]</span><br><span class="line">			PKEY = N + E</span><br><span class="line">			pkey = (n, e)</span><br><span class="line">			<span class="keyword">return</span> PKEY, pkey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, pkey, r</span>):</span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	n, e = pkey</span><br><span class="line">	c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">	C = <span class="built_in">bin</span>(c)[<span class="number">2</span>:-r]</span><br><span class="line">	<span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line">r, nbit = <span class="number">8</span>, <span class="number">128</span></span><br><span class="line">PKEY, pkey = keygen(nbit, r)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;PKEY = <span class="subst">&#123;<span class="built_in">int</span>(PKEY, <span class="number">2</span>)&#125;</span>&#x27;</span>)</span><br><span class="line">FLAG = flag.lstrip(<span class="string">b&#x27;CCTF&#123;&#x27;</span>).rstrip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">enc = encrypt(FLAG, pkey, r)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;<span class="built_in">int</span>(enc, <span class="number">2</span>)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>题目基于一个RSA，n由128bit的素数p、q组成。并且隐去了n、e、c的低8位。</p>
<p>除了128bit较小外，没有看出什么特别的攻击点，那么应该就只能先爆破n的低位，然后去查factordb看看他的分解是不是两个128bit的素数。得到n的分解后，就继续爆破e、c的低位并且尝试进行解密，看解出来的是不是都是可见字符就可以了。</p>
<p>三个低八位未知，那么一起爆的话是2^24的复杂度，并且里面涉及到要查factordb，显然比较慢。一些优化的思路就是：</p>
<ul>
<li>n的最低位一定是1，减少1bit的爆破量。并且单独爆破n得到其分解</li>
<li>e的最低位也一定是1，且可以check他是不是素数</li>
</ul>
<p>如此就可以一分钟左右就得到结果。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> factordb.factordb <span class="keyword">import</span> FactorDB</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">PKEY = <span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396672</span></span><br><span class="line">ENC = <span class="number">127194641882350916936065994389482700479720132804140137082316257506737630761</span></span><br><span class="line">eh = <span class="built_in">int</span>(<span class="built_in">bin</span>(PKEY)[<span class="number">2</span>:][-<span class="number">8</span>:],<span class="number">2</span>)*<span class="number">2</span>**<span class="number">8</span></span><br><span class="line">nh = <span class="built_in">int</span>(<span class="built_in">bin</span>(PKEY)[<span class="number">2</span>:][:-<span class="number">8</span>],<span class="number">2</span>)*<span class="number">2</span>**<span class="number">8</span></span><br><span class="line">ch = <span class="built_in">int</span>(<span class="built_in">bin</span>(ENC)[<span class="number">2</span>:],<span class="number">2</span>)*<span class="number">2</span>**<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 bruteforce to factor n</span></span><br><span class="line"><span class="keyword">for</span> nl <span class="keyword">in</span> trange(<span class="number">2</span>**<span class="number">7</span>):</span><br><span class="line">    n = nh + <span class="number">2</span>*nl + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    f = FactorDB(n)</span><br><span class="line">    f.connect()</span><br><span class="line">    fs = f.get_factor_list()</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(fs) == <span class="number">2</span>):</span><br><span class="line">        p = fs[<span class="number">0</span>]</span><br><span class="line">        q = fs[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span>(isPrime(p) <span class="keyword">and</span> isPrime(q) <span class="keyword">and</span> <span class="built_in">len</span>(<span class="built_in">bin</span>(p)[<span class="number">2</span>:]) == <span class="number">128</span>):</span><br><span class="line">            phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 bruteforce c,e</span></span><br><span class="line"><span class="keyword">for</span> el <span class="keyword">in</span> trange(<span class="number">2</span>**<span class="number">7</span>):</span><br><span class="line">    e = eh + <span class="number">2</span>*el + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">not</span> isPrime(e)):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> cl <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            c = ch + cl</span><br><span class="line">            d = invert(e,phi)</span><br><span class="line">            flag = long_to_bytes(<span class="built_in">pow</span>(c,d,n)).decode()</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;6oRYGy&amp;Dc$G2ZS&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Blue-Office"><a href="#Blue-Office" class="headerlink" title="Blue Office"></a>Blue Office</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/enc python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> seed, flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_seed</span>(<span class="params">s</span>):</span><br><span class="line">	i, j, k = <span class="number">0</span>, <span class="built_in">len</span>(s), <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> i &lt; j:</span><br><span class="line">		k = k + <span class="built_in">ord</span>(s[i])</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> i &lt; j:</span><br><span class="line">		<span class="keyword">if</span> (i % <span class="number">2</span>) != <span class="number">0</span>:</span><br><span class="line">			k = k - (<span class="built_in">ord</span>(s[i]) * (j - i + <span class="number">1</span>))            </span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			k = k + (<span class="built_in">ord</span>(s[i]) * (j - i + <span class="number">1</span>))</span><br><span class="line">	</span><br><span class="line">		k = k % <span class="number">2147483647</span></span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">	k = (k * j) % <span class="number">2147483647</span></span><br><span class="line">	<span class="keyword">return</span> k</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reseed</span>(<span class="params">s</span>):</span><br><span class="line">	<span class="keyword">return</span> s * <span class="number">214013</span> + <span class="number">2531011</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">s, msg</span>):</span><br><span class="line">	<span class="keyword">assert</span> s &lt;= <span class="number">2</span>**<span class="number">32</span></span><br><span class="line">	c, d = <span class="number">0</span>, s</span><br><span class="line">	enc, l = <span class="string">b&#x27;&#x27;</span>, <span class="built_in">len</span>(msg)</span><br><span class="line">	<span class="keyword">while</span> c &lt; l:</span><br><span class="line">		d = reseed(d)</span><br><span class="line">		enc += (msg[c] ^ ((d &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>)).to_bytes(<span class="number">1</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">		c += <span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line">enc = encrypt(seed, flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;binascii.hexlify(enc)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>genseed函数看着并不是很简单，但是细看发现根本就没有用到。而加密过程是逐字符的，设当前待加密字符是m，那么加密过程就是：</p>
<ul>
<li>更新d：d = ad+b</li>
<li>取用d的低24位的高8位，与m异或得到c</li>
</ul>
<p>也就是说每次用到的其实都只是d的低24位而已，那么可以把整个过程都视作模2^24下的，那么seed也就只需要其模2^24下的值，那么爆破2^24就可以了。</p>
<p>exp：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import *</span><br><span class="line">from tqdm import *</span><br><span class="line"></span><br><span class="line">enc = long_to_bytes(int(&#x27;b0cb631639f8a5ab20ff7385926383f89a71bbc4ed2d57142e05f39d434fce&#x27;,16))</span><br><span class="line"></span><br><span class="line">mod = 2**24</span><br><span class="line">for seed in trange(2**24):</span><br><span class="line">    s = seed</span><br><span class="line">    flag = &quot;&quot;</span><br><span class="line">    for i in range(len(enc)):</span><br><span class="line">        s = (s*214013+2531011)%(mod)</span><br><span class="line">        flag += chr(enc[i] ^ ((s&gt;&gt;16)&amp;0xff))</span><br><span class="line">    if(&quot;CCTF&quot; in flag):</span><br><span class="line">        print(flag)</span><br><span class="line"></span><br><span class="line">#CCTF&#123;__B4ck_0r!F1c3__C1pHeR_!!&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="medium"><a href="#medium" class="headerlink" title="medium"></a>medium</h2><h3 id="Derik"><a href="#Derik" class="headerlink" title="Derik"></a>Derik</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> C, e, d, p, q, r, flag</span><br><span class="line"></span><br><span class="line">O = [<span class="number">1391526622949983</span>, <span class="number">2848691279889518</span>, <span class="number">89200900157319</span>, <span class="number">31337</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> isPrime(e) <span class="keyword">and</span> isPrime(d) <span class="keyword">and</span> isPrime(p) <span class="keyword">and</span> isPrime(q) <span class="keyword">and</span> isPrime(r)</span><br><span class="line"><span class="keyword">assert</span> C[<span class="number">0</span>] * p - C[<span class="number">1</span>] * q &gt;= <span class="number">0</span></span><br><span class="line"><span class="keyword">assert</span> C[<span class="number">2</span>] * q - C[<span class="number">3</span>] * r &gt;= <span class="number">0</span></span><br><span class="line"><span class="keyword">assert</span> C[<span class="number">4</span>] * r - C[<span class="number">5</span>] * p &gt;= <span class="number">0</span></span><br><span class="line"><span class="keyword">assert</span> (C[<span class="number">0</span>] * p - C[<span class="number">1</span>] * q) ** e + (C[<span class="number">2</span>] * q - C[<span class="number">3</span>] * r) ** e + (C[<span class="number">4</span>] * r - C[<span class="number">5</span>] * p) ** e == d * (C[<span class="number">0</span>] * p - C[<span class="number">1</span>] * q) * (C[<span class="number">2</span>] * q - C[<span class="number">3</span>] * r) * (C[<span class="number">4</span>] * r - C[<span class="number">5</span>] * p)</span><br><span class="line"><span class="keyword">assert</span> C[<span class="number">6</span>] * e - C[<span class="number">7</span>] * d == O[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">n = e * d * p * q * r</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, <span class="number">65537</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;C = <span class="subst">&#123;C&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>题目给了两组方程：</p>
<script type="math/tex; mode=display">
X^e+Y^e+Z^e = dXYZ</script><script type="math/tex; mode=display">
C_6e-C_7d = O_3</script><p>其中，X、Y、Z分别是如下正整数：</p>
<script type="math/tex; mode=display">
X = C_0p-C_1q</script><script type="math/tex; mode=display">
Y = C_2q-C_3r</script><script type="math/tex; mode=display">
Z = C_4r-C_5p</script><p>然后题目用e、d、p、q、r组成一个多素数RSA加密，并给出C和O列表。也就是说要通过上面的方程解出e、d、p、q、r这五个参数进行RSA解密。</p>
<p>那么着手点肯定是这个方程：</p>
<script type="math/tex; mode=display">
C_6e-C_7d = O_3</script><p>二元一次方程，显然有无穷组解，那么就取最小的一组解(3，73)，也刚好都是素数。代入到上面的方程就是：</p>
<script type="math/tex; mode=display">
X^3+Y^3+Z^3 = 73XYZ</script><p>这个之前有见过也是椭圆曲线方程(其实就是在春哥这题的wp里见的)，所以可以直接调sage里的方法直接构建一条椭圆曲线出来，找到它上面的点，并映射回这个方程上看看有无X、Y、Z都是正整数的点。然后就会发现其实列表O的前三项就是待求的X、Y、Z的值，这也侧面说明e和d就是这组解。</p>
<p>所以说其实就算不知道这是椭圆曲线，动动脑洞也可以做，因为列表O的前三项在题目中根本没用到。</p>
<p>然后就是根据X、Y、Z解 出p、q、r了，这一部分可以写作一个矩阵方程形式：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}
C_0&-C_1&\\
&C_2&-C_3\\
-C_5&&C_4\\
\end{matrix}
\right)
\left(\begin{matrix}
p\\
q\\
r\\
\end{matrix}
\right)
=
\left(\begin{matrix}
X\\
Y\\
Z\\
\end{matrix}
\right)</script><p>那么就可以解得p、q、r。至此参数全部都有了，就可以RSA解密。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">O = [<span class="number">1391526622949983</span>, <span class="number">2848691279889518</span>, <span class="number">89200900157319</span>, <span class="number">31337</span>]</span><br><span class="line">C = [<span class="number">5960650533801939766973431801711817334521794480800845853788489396583576739362531091881299990317357532712965991685855356736023156123272639095501827949743772</span>, <span class="number">6521307334196962312588683933194431457121496634106944587943458360009084052009954473233805656430247044180398241991916007097053259167347016989949709567530079</span>, <span class="number">1974144590530162761749719653512492399674271448426179161347522113979158665904709425021321314572814344781742306475435350045259668002944094011342611452228289</span>, <span class="number">2613994669316609213059728351496129310385706729636898358367479603483933513667486946164472738443484347294444234222189837370548518512002145671578950835894451</span>, <span class="number">8127380985210701021743355783483366664759506587061015828343032669060653534242331741280215982865084745259496501567264419306697788067646135512747952351628613</span>, <span class="number">5610271406291656026350079703507496574797593266125358942992954619413518379131260031910808827754539354830563482514244310277292686031300804846114623378588204</span>, <span class="number">10543</span>, <span class="number">4</span>]</span><br><span class="line">c = <span class="number">80607532565510116966388633842290576008441185412513199071132245517888982730482694498575603226192340250444218146275844981580541820190393565327655055810841864715587561905777565790204415381897361016717820490400344469662479972681922265843907711283466105388820804099348169127917445858990935539611525002789966360469324052731259957798534960845391898385316664884009395500706952606508518095360995300436595374193777531503846662413864377535617876584843281151030183895735511854</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get e,d</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        <span class="keyword">if</span>((C[<span class="number">6</span>]*e-O[<span class="number">3</span>])%C[<span class="number">7</span>]==<span class="number">0</span>):</span><br><span class="line">            d = (C[<span class="number">6</span>]*e-O[<span class="number">3</span>])//C[<span class="number">7</span>]</span><br><span class="line">            <span class="keyword">if</span>(isPrime(d)):</span><br><span class="line">                <span class="built_in">print</span>(e,d)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="comment">#e,d = 3,73</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 construct ECC to get a solution of X^3+Y^3+Z^3=73XYZ</span></span><br><span class="line">R.&lt;x,y,z&gt; = QQ[]</span><br><span class="line">cubic = x^<span class="number">3</span> + y^<span class="number">3</span> + z^<span class="number">3</span> - <span class="number">73</span>*x*y*z</span><br><span class="line">P = [<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">E = EllipticCurve_from_cubic(cubic, P, morphism=<span class="literal">False</span>)</span><br><span class="line">f = EllipticCurve_from_cubic(cubic, P, morphism=<span class="literal">True</span>)</span><br><span class="line">finv = f.inverse()</span><br><span class="line">R = E.gens()[<span class="number">0</span>]</span><br><span class="line">PP = f(P)</span><br><span class="line"><span class="built_in">print</span>(finv(R)) <span class="comment">#find solution of original equation</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 solve equation of Matrix</span></span><br><span class="line">L = Matrix(ZZ,[[C[<span class="number">0</span>],  -C[<span class="number">1</span>], <span class="number">0</span>],</span><br><span class="line">               [<span class="number">0</span>,     C[<span class="number">2</span>],  -C[<span class="number">3</span>]],</span><br><span class="line">               [-C[<span class="number">5</span>], <span class="number">0</span>,     C[<span class="number">4</span>]]])</span><br><span class="line">vec = vector(ZZ,[<span class="number">1391526622949983</span>,<span class="number">2848691279889518</span>,<span class="number">89200900157319</span>])</span><br><span class="line">p,q,r = L.solve_right(vec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part4 get flag</span></span><br><span class="line">phi = (e-<span class="number">1</span>)*(d-<span class="number">1</span>)*(p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">n = e*d*p*q*r</span><br><span class="line">d = inverse(<span class="number">65537</span>,phi)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;____Sylvester____tHE0r3m_Of_D3r!va7i0n!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Barak"><a href="#Barak" class="headerlink" title="Barak"></a>Barak</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_barak</span>(<span class="params">P, E</span>):</span><br><span class="line">	c, d, p = E</span><br><span class="line">	x, y = P</span><br><span class="line">	<span class="keyword">return</span> (x**<span class="number">3</span> + y**<span class="number">3</span> + c - d*x*y) % p == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_barak</span>(<span class="params">P, Q, E</span>):</span><br><span class="line">	<span class="keyword">if</span> P == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">		<span class="keyword">return</span> Q</span><br><span class="line">	<span class="keyword">if</span> Q == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">		<span class="keyword">return</span> P</span><br><span class="line">	<span class="keyword">assert</span> on_barak(P, E) <span class="keyword">and</span> on_barak(Q, E)</span><br><span class="line">	x1, y1 = P</span><br><span class="line">	x2, y2 = Q</span><br><span class="line">	<span class="keyword">if</span> P == Q:</span><br><span class="line">		x3 = y1 * (c - x1**<span class="number">3</span>) * inverse(x1**<span class="number">3</span> - y1**<span class="number">3</span>, p) % p</span><br><span class="line">		y3 = x1 * (y1**<span class="number">3</span> - c) * inverse(x1**<span class="number">3</span> - y1**<span class="number">3</span>, p) % p</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">		x3 = (y1**<span class="number">2</span>*x2 - y2**<span class="number">2</span>*x1) * inverse(x2*y2 - x1*y1, p) % p</span><br><span class="line">		y3 = (x1**<span class="number">2</span>*y2 - x2**<span class="number">2</span>*y1) * inverse(x2*y2 - x1*y1, p) % p</span><br><span class="line">	<span class="keyword">return</span> (x3, y3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul_barak</span>(<span class="params">m, P, E</span>):</span><br><span class="line">	<span class="keyword">if</span> P == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">		<span class="keyword">return</span> P</span><br><span class="line">	R = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">while</span> m != <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">if</span> m &amp; <span class="number">1</span>:</span><br><span class="line">			R = add_barak(R, P, E)</span><br><span class="line">		m = m &gt;&gt; <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> m != <span class="number">0</span>:</span><br><span class="line">			P = add_barak(P, P, E)</span><br><span class="line">	<span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rand_barak</span>(<span class="params">E</span>):</span><br><span class="line">	c, d, p = E</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		y = randint(<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">		K = Zmod(p)</span><br><span class="line">		P.&lt;x&gt; = PolynomialRing(K) </span><br><span class="line">		f = x**<span class="number">3</span> - d*x*y + c + y^<span class="number">3</span></span><br><span class="line">		R = f.roots()</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			r = R[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">			<span class="keyword">return</span> (r, y)</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">73997272456239171124655017039956026551127725934222347</span></span><br><span class="line">d = <span class="number">68212800478915688445169020404812347140341674954375635</span></span><br><span class="line">c = <span class="number">1</span></span><br><span class="line">E = (c, d, p)</span><br><span class="line"></span><br><span class="line">P = rand_barak(E)</span><br><span class="line"></span><br><span class="line">FLAG = flag.lstrip(<span class="string">b&#x27;CCTF&#123;&#x27;</span>).rstrip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">m = bytes_to_long(FLAG) </span><br><span class="line"><span class="keyword">assert</span> m &lt; p</span><br><span class="line">Q = mul_barak(m, P, E)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;P = <span class="subst">&#123;P&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Q = <span class="subst">&#123;Q&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>题目给出了一条曲线，其方程是：</p>
<script type="math/tex; mode=display">
X^3+ Y^3 +1 = dXY \quad(mod\;p)</script><p>并且定义了这条曲线上的加法和倍点公式，然后取上面一个随机点P，求得其m倍点Q，给出P、Q要求还原m。</p>
<p>才做完Derik这个题，这个题就倍感亲切，因为显然通过以下换元：</p>
<script type="math/tex; mode=display">
X = \frac{X'}{Z'}</script><script type="math/tex; mode=display">
Y = \frac{Y'}{Z'}</script><p>这样曲线方程就直接变成了刚才才见过的三次齐次方程形式：</p>
<script type="math/tex; mode=display">
X'^3+ Y'^3 +Z'^3 = dX'Y'Z' \quad(mod\;p)</script><p>那么就构建出椭圆曲线直接求DLP就好了。然后有一点需要注意的是，直接求DLP得到的并不是明文，这说明明文大于点P的阶，所以还需要小爆一下。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">73997272456239171124655017039956026551127725934222347</span></span><br><span class="line">d = <span class="number">68212800478915688445169020404812347140341674954375635</span></span><br><span class="line">c = <span class="number">1</span></span><br><span class="line">P = (<span class="number">71451574057642615329217496196104648829170714086074852</span>, <span class="number">69505051165402823276701818777271117086632959198597714</span>)</span><br><span class="line">Q = (<span class="number">40867727924496334272422180051448163594354522440089644</span>, <span class="number">56052452825146620306694006054673427761687498088402245</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 construct ECC to get a solution of X^3+Y^3+Z^3=dXYZ</span></span><br><span class="line">R.&lt;x,y,z&gt; = Zmod(p)[]</span><br><span class="line">cubic = x^<span class="number">3</span> + y^<span class="number">3</span> + z^<span class="number">3</span> - d*x*y*z</span><br><span class="line">E = EllipticCurve_from_cubic(cubic,morphism=<span class="literal">True</span>)</span><br><span class="line">P = E(P)</span><br><span class="line">Q = E(Q)</span><br><span class="line">m = P.discrete_log(Q)</span><br><span class="line">P_ord = P.order()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        flag = long_to_bytes(<span class="built_in">int</span>(m)).decode()</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        m += P_ord</span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;_hE5S!4n_f0rM_0F_3CC!!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Risk"><a href="#Risk" class="headerlink" title="Risk"></a>Risk</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> m, flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genPrime</span>(<span class="params">m, nbit</span>):</span><br><span class="line">	<span class="keyword">assert</span> m &gt;= <span class="number">2</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		a = getRandomNBitInteger(nbit // m)</span><br><span class="line">		r = getRandomNBitInteger(m ** <span class="number">2</span> - m + <span class="number">2</span>)</span><br><span class="line">		p = a ** m + r</span><br><span class="line">		<span class="keyword">if</span> isPrime(p):</span><br><span class="line">			<span class="keyword">return</span> (p, r)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">m, nbit</span>):</span><br><span class="line">	p, r = genPrime(m, nbit // <span class="number">2</span>)</span><br><span class="line">	q, s = genPrime(m, nbit // <span class="number">2</span>)</span><br><span class="line">	n = p * q</span><br><span class="line">	e = r * s</span><br><span class="line">	<span class="keyword">return</span> (e, n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, pkey</span>):</span><br><span class="line">	e, n = pkey</span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">	<span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">pkey = genkey(m, <span class="number">2048</span>)</span><br><span class="line">enc = encrypt(flag, pkey)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;pkey = <span class="subst">&#123;pkey&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>题目基于RSA加密，只是参数生成方式有一些特殊，具体来说是：</p>
<script type="math/tex; mode=display">
p = a_1^m + r</script><script type="math/tex; mode=display">
q = a_2^m + s</script><script type="math/tex; mode=display">
e = rs</script><p>而观察e的大小可以知道r、s的数量级是14bit，也就知道了m的具体取值是4，同时获取e的分解也是可以得到r、s的具体指的。那么现在就有：</p>
<script type="math/tex; mode=display">
n = pq = (a_1^4 + r)(a_2^4 + s)</script><p>要从这个式子再想办法得到a1、a2的值就可以分解n了。</p>
<p>而copper显然是不行，因为虽然a1、a2的确是小根，但是相应的多项式次数也很高，上界达不到要求。那么为了获得分解我选择把式子展开看看：</p>
<script type="math/tex; mode=display">
n =a_1^4a_2^4 + sa_1^4 + ra_2^4 + rs</script><p>可以发现，由于其他项相对于第一项来说都太小了，那么对n开四次方，得到的就是a1a2的精确值。也就是说，现在整个式子的未知量就剩下：</p>
<script type="math/tex; mode=display">
sa_1^4,ra_2^4</script><p>而我们知道他们的和是：</p>
<script type="math/tex; mode=display">
sa_1^4+ra_2^4 = n -a_1^4a_2^4 - rs</script><p>而又可以构造出他们的积：</p>
<script type="math/tex; mode=display">
sa_1^4\times ra_2^4 = rs(a_1^4a_2^4)</script><p>所以就可以用韦达定理来解出sa1^4和ra2^4，就获得n的全部分解了。</p>
<p>分解完过后发现还不能直接解密，因为e和phi不互素。这里应该用有限域开根或AMM加上CRT来求得明文，但是注意到题目里的p、q都是1024bit的数字了，所以明文很大概率小于他们。因此我偷懒直接模q下有限域开个根就可以解(因为e与p-1的GCD比较大)，明文也确实短的符合预期。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e,n = (<span class="number">150953688</span>, <span class="number">373824666550208932851344358703053061405262438259996622188837935528607451817812480600479188884096072016823491996056842120586016323642383543231913508464973502962030059403443181467594283936168384790367731793997013711256520780338341018619858240958105689126133812557401122953030695509876185592917323138313818881164334490044163316692588337720342646339764174333821950301279825316497898035760524780198230860089280791887363472060435443944632303774987556026740232641561706904946900169858650106994947597642013168757868017723456208796677559254390940651802333382820063200360490892131573853635471525711894510477078934343423255983</span>)</span><br><span class="line">c = <span class="number">275574424285842306309073814038154403551700455145115884031072340378743712325975683329051874910297915882286569143815715537085387363420246497061870251520240399514896001311724695996978111559476733709139080970977190150345474341853495386364275702356438666152069791355990718058189043717952080875207858163490627801836274404446661613239167700736337269924479349700031535265765885064606399858172168036794462235707003475360358004643720927563261787867952228496769300443415094124132722170498229611285689671203272698693505808912907778910378274197503048226322090611405601517624884408718689404556983397217070272851442351897456769883</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 factor n</span></span><br><span class="line">a1a2 = iroot(n,<span class="number">4</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="comment">#n=(a1^4+r)(a2^4+s)</span></span><br><span class="line"><span class="comment">#t1=sa1^4,t2=ra2^4</span></span><br><span class="line"><span class="comment">#use Vieta theorem</span></span><br><span class="line">t1_t2 = n - e - a1a2**<span class="number">4</span></span><br><span class="line">t1t2 = e*a1a2**<span class="number">4</span></span><br><span class="line">delta = t1_t2**<span class="number">2</span>-<span class="number">4</span>*t1t2</span><br><span class="line">t1 = (t1_t2+iroot(delta,<span class="number">2</span>)[<span class="number">0</span>])//<span class="number">2</span></span><br><span class="line">t2 = (t1_t2-iroot(delta,<span class="number">2</span>)[<span class="number">0</span>])//<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">2</span>**<span class="number">14</span>,<span class="number">2</span>):</span><br><span class="line">    <span class="keyword">if</span>(iroot(t1//s,<span class="number">4</span>)[<span class="number">1</span>]):</span><br><span class="line">        a1 = iroot(t1//s,<span class="number">4</span>)[<span class="number">0</span>]</span><br><span class="line">        r = e // s</span><br><span class="line">        a2 = iroot(t2//r,<span class="number">4</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">p = a1**<span class="number">4</span>+r</span><br><span class="line">q = a2**<span class="number">4</span>+s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get flag</span></span><br><span class="line">cq = <span class="built_in">pow</span>(c,inverse(e//<span class="number">72</span>,q-<span class="number">1</span>),q)</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(q))</span><br><span class="line">f = x^<span class="number">72</span> - cq</span><br><span class="line">resq = f.roots()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> resq:</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(i[<span class="number">0</span>])))</span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;S!mP1E_A7t4cK_0n_SpEc1aL-5trucTur3D_RSA_pR1me5!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Roldy"><a href="#Roldy" class="headerlink" title="Roldy"></a>Roldy</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pyope.ope <span class="keyword">import</span> OPE <span class="keyword">as</span> enc</span><br><span class="line"><span class="keyword">from</span> pyope.ope <span class="keyword">import</span> ValueRange</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> key, flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>(): </span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, key, params</span>):</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(msg) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">		msg += (<span class="number">16</span> - <span class="built_in">len</span>(msg) % <span class="number">16</span>) * <span class="string">b&#x27;*&#x27;</span></span><br><span class="line">	p, k1, k2 = params</span><br><span class="line">	msg = [msg[_*<span class="number">16</span>:_*<span class="number">16</span> + <span class="number">16</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg) // <span class="number">16</span>)]</span><br><span class="line">	m = [bytes_to_long(_) <span class="keyword">for</span> _ <span class="keyword">in</span> msg]</span><br><span class="line">	inra = ValueRange(<span class="number">0</span>, <span class="number">2</span>**<span class="number">128</span>)</span><br><span class="line">	oura = ValueRange(k1 + <span class="number">1</span>, k2 * p + <span class="number">1</span>)</span><br><span class="line">	_enc = enc(key, in_range = inra, out_range = oura)</span><br><span class="line">	C = [_enc.encrypt(_) <span class="keyword">for</span> _ <span class="keyword">in</span> m]</span><br><span class="line">	<span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;|&quot;</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">&quot; Welcome to Roldy combat, we implemented an encryption method to    &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot; protect our secret. Please note that there is a flaw in our method &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot; Can you examine it and get the flag?                               &quot;</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	pr(border, <span class="string">&#x27;Generating parameters, please wait...&#x27;</span>)</span><br><span class="line">	p, k1, k2 = [getPrime(<span class="number">129</span>)] + [getPrime(<span class="number">64</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;__&#x27;</span>]</span><br><span class="line">	C = encrypt(flag, key, (p, k1, k2))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">			pr(<span class="string">&quot;| Options: \n|\t[E]ncrypted flag! \n|\t[T]ry encryption \n|\t[Q]uit&quot;</span>)</span><br><span class="line">			ans = sc().decode().lower().strip()</span><br><span class="line">			<span class="keyword">if</span> ans == <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">				pr(border, <span class="string">f&#x27;encrypt(flag, key, params) = <span class="subst">&#123;C&#125;</span>&#x27;</span>)</span><br><span class="line">			<span class="keyword">elif</span> ans == <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">				pr(border, <span class="string">&#x27;Please send your message to encrypt: &#x27;</span>)</span><br><span class="line">				msg = sc().rstrip(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">				<span class="keyword">if</span> <span class="built_in">len</span>(msg) &gt; <span class="number">64</span>:</span><br><span class="line">					pr(border, <span class="string">&#x27;Your message is too long! Sorry!!&#x27;</span>)</span><br><span class="line">				C = encrypt(msg, key, (p, k1, k2))</span><br><span class="line">				pr(border, <span class="string">f&#x27;C = <span class="subst">&#123;C&#125;</span>&#x27;</span>)</span><br><span class="line">			<span class="keyword">elif</span> ans == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">				die(border, <span class="string">&quot;Quitting ...&quot;</span>)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				die(border, <span class="string">&quot;Bye ...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>题目基于OPE加密(一会儿来说这是什么)，他先生成加密需要的p、k1、k2三个参数，然后用这几个参数和秘密的key对flag进行OPE加密。然后我们有无数次交互机会，每次有以下选项：</p>
<ul>
<li>输入e，得到flag的OPE加密结果</li>
<li>输入t，可以发送明文，并获取他的所有参数均相同的OPE加密值</li>
</ul>
<p>我也完全不懂OPE是什么，就上网查了一下，知道它叫做保序加密算法。而顾名思义，他有一个性质是：</p>
<ul>
<li>若明文m1&lt;m2，则密文c1&lt;c2</li>
</ul>
<p>那么就很简单了，由于有无限次交互机会，我们可以对每一段flag的明文去二分查找，用返回的密文是否大于flag的对应密文值来判断flag在哪一个区间，从而逐步确定flag每段明文的具体值。</p>
<p>我是一段一段来的，实际上也可以所有段一起二分来节省2/3的时间(因为一共有三段)，但是我太懒就不改了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28724</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;Generating parameters, please wait...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get flag_enc</span></span><br><span class="line">sh.sendline(<span class="string">b&quot;e&quot;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;params) = &quot;</span>)</span><br><span class="line">C = <span class="built_in">eval</span>(sh.recvline().strip().decode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 binary_search</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(C)):</span><br><span class="line">    left = <span class="number">0</span></span><br><span class="line">    right = <span class="number">2</span>**<span class="number">128</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> trange(<span class="number">128</span>):</span><br><span class="line">        temp = (left+right)//<span class="number">2</span></span><br><span class="line">        sh.recvuntil(<span class="string">b&quot;[Q]uit&quot;</span>)</span><br><span class="line">        sh.sendline(<span class="string">b&quot;t&quot;</span>)</span><br><span class="line">        sh.recvuntil(<span class="string">b&quot;Please send your message to encrypt: &quot;</span>)</span><br><span class="line">        sh.sendline(long_to_bytes(temp))</span><br><span class="line">        sh.recvuntil(<span class="string">b&quot;C = &quot;</span>)</span><br><span class="line">        ans = <span class="built_in">eval</span>(sh.recvline().strip().decode())[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">abs</span>(ans - C[i]) &lt;= <span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(temp))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span>(ans &lt; C[i]):</span><br><span class="line">            left = temp</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;8ce5d404-e7c2-46c7-985d-bc5a74a4eb8c&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Bertrand"><a href="#Bertrand" class="headerlink" title="* Bertrand"></a>* Bertrand</h3><p>题目基于Hilbert曲线，极客大挑战的wp里有写过，由于涉及到图像加密，感觉有点费事，复现就不做了。</p>
<p><br></p>
<p><br></p>
<h3 id="Insights"><a href="#Insights" class="headerlink" title="Insights"></a>Insights</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getRandomNBits</span>(<span class="params">n</span>):</span><br><span class="line">	nb = <span class="string">&#x27;1&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(randint(<span class="number">0</span>, <span class="number">1</span>)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>)])</span><br><span class="line">	<span class="keyword">return</span> nb</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getLeader</span>(<span class="params">L, n</span>):</span><br><span class="line">	nb = L + getRandomNBits(n)</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">int</span>(nb, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genPrime</span>(<span class="params">L, nbit</span>):</span><br><span class="line">	l = <span class="built_in">len</span>(L)</span><br><span class="line">	<span class="keyword">assert</span> nbit &gt;= l</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		p = getLeader(L, nbit - l)</span><br><span class="line">		<span class="keyword">if</span> is_prime(p):</span><br><span class="line">			<span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genKey</span>(<span class="params">L, nbit</span>):</span><br><span class="line">	p, q = [genPrime(L, nbit) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;__&#x27;</span>]</span><br><span class="line">	n = p * q</span><br><span class="line">	d = next_prime(<span class="built_in">pow</span>(n, <span class="number">0.2919</span>))</span><br><span class="line">	phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">	e = inverse(d, phi)</span><br><span class="line">	pubkey, privkey = (n, e), (p, q)</span><br><span class="line">	<span class="keyword">return</span> pubkey, privkey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, pubkey</span>):</span><br><span class="line">	n, e = pubkey</span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">	<span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">nbit = <span class="number">1024</span></span><br><span class="line">L = <span class="built_in">bin</span>(bytes_to_long(<span class="string">b&#x27;Practical&#x27;</span>))[<span class="number">2</span>:]</span><br><span class="line">pubkey, privkey = genKey(L, nbit)</span><br><span class="line">p, q = privkey</span><br><span class="line">c = encrypt(flag, pubkey)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Information:&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span> * <span class="number">85</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;p * q&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e = <span class="subst">&#123;pubkey[<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;<span class="built_in">bin</span>(p)[<span class="number">2</span>:<span class="built_in">len</span>(L)]&#125;</span>...[REDACTED]&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;q = <span class="subst">&#123;<span class="built_in">bin</span>(q)[<span class="number">2</span>:<span class="built_in">len</span>(L)]&#125;</span>...[REDACTED]&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span> * <span class="number">85</span>)</span><br></pre></td></tr></table></figure>
<p>题目基于RSA加密，参数的特殊点在于：</p>
<ul>
<li>d是个略大于n^0.2919的量</li>
<li>p、q高72位相同</li>
</ul>
<p>这个d的界一看就是boneh的界，所以就是想办法把p、q高位相同想办法利用进boneh and durfee attack去扩大求根的上界。那么就依据boneh and durfee attack的思路，写出下面的式子：</p>
<script type="math/tex; mode=display">
ed = 1 + k(p-1)(q-1)</script><p>由于e和n的数量级很接近，那么k也就比d大不了多少，因此k也可以看作是一个略大于n^0.2919的小量。之后先把式子展开：</p>
<script type="math/tex; mode=display">
ed = 1 + k(n-(p+q)+1)</script><p>由于p、q高位相同，记高位为h，那么p、q可以写作：</p>
<script type="math/tex; mode=display">
p = h + p_l</script><script type="math/tex; mode=display">
q = h + q_l</script><p>代入刚才的式子里：</p>
<script type="math/tex; mode=display">
ed = 1 + k(n-(2h + p_l+ q_l)+1)</script><p>然后整理一下式子：</p>
<script type="math/tex; mode=display">
ed = 1 + k(n+1-2h -(p_l+ q_l))</script><p>那么，因为n是奇数，所以n+1+2h是偶数，并且pl+ql也是偶数，所以式子又可以写成：</p>
<script type="math/tex; mode=display">
ed = 1 + 2k(\frac{n+1-2h}{2} -\frac{p_l+ q_l}{2})</script><p>此时就可以视作一个模e下的X、Y的多项式，去用boneh and durfee attack解小根：</p>
<script type="math/tex; mode=display">
f = 1 + X(A +Y) \quad(mod\;e)</script><p>m改大一点一直到8就能有根，然后就可以得到d的值去进行解密。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting debug to true will display more informations</span></span><br><span class="line"><span class="string">about the lattice, the bounds, the vectors...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting strict to true will stop the algorithm (and</span></span><br><span class="line"><span class="string">return (-1, -1)) if we don&#x27;t have a correct </span></span><br><span class="line"><span class="string">upperbound on the determinant. Note that this </span></span><br><span class="line"><span class="string">doesn&#x27;t necesseraly mean that no solutions </span></span><br><span class="line"><span class="string">will be found since the theoretical upperbound is</span></span><br><span class="line"><span class="string">usualy far away from actual results. That is why</span></span><br><span class="line"><span class="string">you should probably use `strict = False`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">This is experimental, but has provided remarkable results</span></span><br><span class="line"><span class="string">so far. It tries to reduce the lattice as much as it can</span></span><br><span class="line"><span class="string">while keeping its efficiency. I see no reason not to use</span></span><br><span class="line"><span class="string">this option, but if things don&#x27;t work, you should try</span></span><br><span class="line"><span class="string">disabling it</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># stop removing if lattice reaches that dimension</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Functions</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display stats on helpful vectors</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>:</span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="built_in">print</span> (a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tries to remove unhelpful vectors</span></span><br><span class="line"><span class="comment"># we start at current = n-1 (last vector)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line">    <span class="comment"># end of our recursive function</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we start by checking from the end</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment"># if it is unhelpful:</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">            <span class="comment"># let&#x27;s check if it affects other vectors</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># if another vector is affected:</span></span><br><span class="line">                <span class="comment"># we increase the count</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:0</span></span><br><span class="line">            <span class="comment"># if no other vectors end up affected</span></span><br><span class="line">            <span class="comment"># we remove it</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;* removing unhelpful vector&quot;</span>, ii)</span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:1</span></span><br><span class="line">            <span class="comment"># if just one was affected we check</span></span><br><span class="line">            <span class="comment"># if it is affecting someone else</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># if it is affecting even one vector</span></span><br><span class="line">                    <span class="comment"># we give up on this one</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># remove both it if no other vector was affected and</span></span><br><span class="line">                <span class="comment"># this helpful vector is not helpful enough</span></span><br><span class="line">                <span class="comment"># compared to our unhelpful one</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;* removing unhelpful vectors&quot;</span>, ii, <span class="string">&quot;and&quot;</span>, affected_vector_index)</span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1,-1 if `strict=true`, and determinant doesn&#x27;t bound</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string">    * d &lt; N^delta</span></span><br><span class="line"><span class="string">    * |x| &lt; e^delta</span></span><br><span class="line"><span class="string">    * |y| &lt; e^0.5</span></span><br><span class="line"><span class="string">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts list of monomials</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts (selected by Herrman and May)</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts list of monomials</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Prototype to reduce the lattice</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment"># automatically remove</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># reset dimension</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if vectors are helpful</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># check if determinant is correctly bounded</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;looking for independent vectors in the lattice&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line">            <span class="comment"># for i and j, create the two polynomials</span></span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># resultant</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># are these good polynomials?</span></span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nbit = <span class="number">1024</span></span><br><span class="line">n = <span class="number">12765231982257032754070342601068819788671760506321816381988340379929052646067454855779362773785313297204165444163623633335057895252608396010414744222572161530653104640020689896882490979790275711854268113058363186249545193245142912930804650114934761299016468156185416083682476142929968501395899099376750415294540156026131156551291971922076435528869024742993840057342092865203064721826362149723366381892539617642364692012936270150691803063945919154346756726869466855557344213050973081755499746750276623648407677639812809665472258655462846021403503851719008687214848550916999977775070011121527941755954255781343103086789</span></span><br><span class="line">e = <span class="number">459650454686946706615371845737527916539205656667844780634386049268800615782964920944229084502752167395446158290854047696006034750210758341744841762479191173017773034647739346927390580848998121830029134542880713409306092967282675122699586503684943407535067216738556403169403622104762516293879994387324370835718056251706150557820106296417750402984941838652433642298378976899556042987560946508887315484380807248331504458640857234708123277403252632993828101306072382329879857946191508782246793011691530554606521701055094223574951862129713872918021549814674387049788995785872980320871421550616327471735316980754238323013</span></span><br><span class="line">c = <span class="number">10992248752412909788626396175372747713079469256270100576886987393986576680666320383209810005318254336440105142571546847427454822405793626080251363454531982746373841267986148332456716023293306870382809568309620264499225135226626560298741596462262513921032733814032790312163314776421380481083058518893602887082464123177575742160690315666730642727773288362853901330620841098230284739614618790097180848133698381487679399364400048499041582830157094876815030301231505774900176910650887780842536610942820066913075027528705150102760422836458745949063992228680293226303245265232017738712226154128654682937687199768621565945171</span></span><br><span class="line">L = <span class="built_in">bin</span>(bytes_to_long(<span class="string">b&#x27;Practical&#x27;</span>))[<span class="number">2</span>:]</span><br><span class="line">ph = <span class="built_in">int</span>(L+<span class="string">&quot;1&quot;</span>,<span class="number">2</span>)*<span class="number">2</span>^(nbit-<span class="built_in">len</span>(L+<span class="string">&quot;1&quot;</span>))</span><br><span class="line">qh = ph <span class="comment">#known 72 high bits</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 boneh and durfee to get d</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">1</span>):</span><br><span class="line">    m = <span class="number">8</span></span><br><span class="line">    delta = <span class="number">0.30</span></span><br><span class="line">    t = <span class="built_in">int</span>((<span class="number">1</span>-<span class="number">2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">    X = <span class="number">2</span>*floor(n^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">    Y = <span class="number">2</span>^(nbit-<span class="built_in">len</span>(L+<span class="string">&quot;1&quot;</span>))   <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line"></span><br><span class="line">    A = (n+<span class="number">1</span>)//<span class="number">2</span> - (ph+qh)//<span class="number">2</span></span><br><span class="line">    PR.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    pol = <span class="number">1</span>+x*(A+y)</span><br><span class="line">    res = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get d</span></span><br><span class="line">k2 = <span class="number">49977986915659605429345289223812619569200398624947376450000245097914425323254468264973009610079433427753410860067909320180393446912719527813521669872296939128853941260184779168808</span></span><br><span class="line">pl_ql = -<span class="number">26225793397477672414138436461088692023641486423848109679632696585093272843809115665873260921093208795526382416734843864007298933841051250143140940470093595985249689125607975667724436632465193533116961405126679193559648564948639967803860314403909842190409143666008313060949901033553728989</span></span><br><span class="line">d = (<span class="number">1</span>+k2*(A+pl_ql)) // e</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;RSA_N3w_rEc0rd5_4Nd_nEw_!nSi9h75!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Resuction"><a href="#Resuction" class="headerlink" title="Resuction"></a>Resuction</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>(<span class="params">nbit, r</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		p, q = [getPrime(nbit) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;__&#x27;</span>]</span><br><span class="line">		d, n = getPrime(<span class="number">64</span>), p * q</span><br><span class="line">		phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">if</span> GCD(d, phi) == <span class="number">1</span>:</span><br><span class="line">			e = inverse(d, phi)</span><br><span class="line">			N = <span class="built_in">bin</span>(n)[<span class="number">2</span>:-r]</span><br><span class="line">			E = <span class="built_in">bin</span>(e)[<span class="number">2</span>:-r]</span><br><span class="line">			PKEY = N + E</span><br><span class="line">			pkey = (n, e)</span><br><span class="line">			<span class="keyword">return</span> PKEY, pkey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, pkey, r</span>):</span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	n, e = pkey</span><br><span class="line">	c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">	C = <span class="built_in">bin</span>(c)[<span class="number">2</span>:-r]</span><br><span class="line">	<span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line">r, nbit = <span class="number">8</span>, <span class="number">1024</span></span><br><span class="line">PKEY, pkey = keygen(nbit, r)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;PKEY = <span class="subst">&#123;<span class="built_in">int</span>(PKEY, <span class="number">2</span>)&#125;</span>&#x27;</span>)</span><br><span class="line">FLAG = flag.lstrip(<span class="string">b&#x27;CCTF&#123;&#x27;</span>).rstrip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">enc = encrypt(FLAG, pkey, r)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;<span class="built_in">int</span>(enc, <span class="number">2</span>)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>和suction一样隐去了n、e、c的低8位，不同之处在于：</p>
<ul>
<li>p、q从128bit提升到了1024位</li>
<li>d仅有64bit</li>
</ul>
<p>由于d很小所以想到wiener，并且由于n、e仅有低8位不知道，所以其实有：</p>
<script type="math/tex; mode=display">
\frac{e'}{n'} \approx \frac{e}{n}</script><p>所以直接对e’、n’进行连分数展开就能找到d，然后爆破n、c的低8位就可以解密了，优化的思路也一样，n一定是奇数所以固定了LSB，可以少爆破一位，并且可以用powmod加速。但是因为本身已经很快了所以只是锦上添花。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">PKEY = <span class="number">14192646310719975031517528381795548241077678859071194396837281472399230674325587198691913743313024193030641258581477544395982020385534616950314446352119543012689979705497443206671093873748633162188213109347667494028713308821945628880987033909436936504594085029207071182583896573425433818693447573712242776054326253393149643818428222532313129014785625379928796322492111783102063504659053965652092334907431265629283336869752591405010801363428649651892548988084920295512198406822149854508798413366425646089176325412867633899847841343293434518769693835679828109184625256833518392375615524221729773443578746961887429674099018040291053535429314874943299587513900900515776980848746070077651676814430155460898107362207677739452859298842563030631706907437662807884529549746843462830493900480079096937402325307522965877069080418178692616875205678928420840955518031258855869218152431304423803589723140983606576549207164114711076498723237274262054605174412193097533550076687418481230734706280737017543741247718967059747548710091320650704988384742281590019869955579949961574733610565593105027342454880292474482792325237942870408329807427182014062811782475262070063065860763705715879581562335668163076088547827008755841277828137570366416095778</span></span><br><span class="line">ENC = <span class="number">93313196155732054514477836642637636744872135106456047659057794344503071105783322399713135615723000054324693644981340568454628360027598469597864407205974007198804288563284521413279406211756674451582156555173212403946908121125010635246043311803494356106191509999360722019559999844621905376368824621365540442906142224342650371557766313381899279520110833822291649001754956653102495882094754863493058001964760438040783400782352466943990226083197340594364084294954324101604417550048379969516185353765224920719355485680872367930581872987972421836853197205534334204586713387469939986387582911728909524428102693874671302382</span></span><br><span class="line"></span><br><span class="line">eh = <span class="built_in">int</span>(<span class="built_in">bin</span>(PKEY)[<span class="number">2</span>:][<span class="number">2048</span>-<span class="number">8</span>:],<span class="number">2</span>)*<span class="number">2</span>**<span class="number">8</span></span><br><span class="line">nh = <span class="built_in">int</span>(<span class="built_in">bin</span>(PKEY)[<span class="number">2</span>:][:<span class="number">2048</span>-<span class="number">8</span>],<span class="number">2</span>)*<span class="number">2</span>**<span class="number">8</span></span><br><span class="line">ch = <span class="built_in">int</span>(<span class="built_in">bin</span>(ENC)[<span class="number">2</span>:],<span class="number">2</span>)*<span class="number">2</span>**<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continuedFra</span>(<span class="params">x, y</span>):</span><br><span class="line">    cF = []</span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        cF += [x // y]</span><br><span class="line">        x, y = y, x % y</span><br><span class="line">    <span class="keyword">return</span> cF</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Simplify</span>(<span class="params">ctnf</span>):</span><br><span class="line">    numerator = <span class="number">0</span></span><br><span class="line">    denominator = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> ctnf[::-<span class="number">1</span>]:</span><br><span class="line">        numerator, denominator = denominator, x * denominator + numerator</span><br><span class="line">    <span class="keyword">return</span> (numerator, denominator)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getit</span>(<span class="params">c</span>):</span><br><span class="line">    cf = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(c)):</span><br><span class="line">        cf.append(Simplify(c[:i]))</span><br><span class="line">    <span class="keyword">return</span> cf</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 use wiener to get d</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">1</span>):</span><br><span class="line">    cf = continuedFra(eh, nh)</span><br><span class="line">    <span class="keyword">for</span> d,k <span class="keyword">in</span> getit(cf):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(<span class="built_in">bin</span>(d)[<span class="number">2</span>:]) == <span class="number">64</span> <span class="keyword">and</span> isPrime(d)):</span><br><span class="line">            <span class="built_in">print</span>(d)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">d = <span class="number">10254340117704573547</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 bruteforce n,c</span></span><br><span class="line"><span class="keyword">for</span> nl <span class="keyword">in</span> trange(<span class="number">1</span>,<span class="number">2</span>**<span class="number">8</span>,<span class="number">2</span>):</span><br><span class="line">    <span class="keyword">for</span> cl <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">8</span>):</span><br><span class="line">        n = nh+nl</span><br><span class="line">        c = ch+cl</span><br><span class="line">        flag = powmod(c,d,n)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            flag = long_to_bytes(flag).decode()</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;aIr_pr3s5urE_d!Ff3rEn7i4L_8eTw3eN_ArEa5!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Blobfish"><a href="#Blobfish" class="headerlink" title="* Blobfish"></a>* Blobfish</h3><p>更偏misc一点，思路应该是用PNG文件头去明文攻击？没有特别想做，就不做了。</p>
<p><br></p>
<p><br></p>
<h3 id="ASIv1"><a href="#ASIv1" class="headerlink" title="ASIv1"></a>ASIv1</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base</span>(<span class="params">n, l</span>):</span><br><span class="line">    D = []</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        n, r = <span class="built_in">divmod</span>(n, l)</span><br><span class="line">        D.append(r)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(d) <span class="keyword">for</span> d <span class="keyword">in</span> <span class="built_in">reversed</span>(D)) <span class="keyword">or</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asiv_prng</span>(<span class="params">seed</span>):</span><br><span class="line">	l = <span class="built_in">len</span>(seed)</span><br><span class="line">	_seed = base(bytes_to_long(seed), <span class="number">3</span>)</span><br><span class="line">	_seed = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> _seed]</span><br><span class="line">	_l = <span class="built_in">len</span>(_seed)</span><br><span class="line">	R = [[getRandomRange(<span class="number">0</span>, <span class="number">3</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(_l)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(_l**<span class="number">2</span>)]</span><br><span class="line">	S = []</span><br><span class="line">	<span class="keyword">for</span> r <span class="keyword">in</span> R:</span><br><span class="line">		s = <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(_l):</span><br><span class="line">			s += (r[_] * _seed[_]) % <span class="number">3</span></span><br><span class="line">		<span class="comment"># s += getRandomRange(0, 3)</span></span><br><span class="line">		s %= <span class="number">3</span></span><br><span class="line">		S.append(s)</span><br><span class="line">	<span class="keyword">return</span> R, S</span><br><span class="line"></span><br><span class="line">seed = flag.lstrip(<span class="string">b&#x27;CCTF&#123;&#x27;</span>).rstrip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">R, S = asiv_prng(seed)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(<span class="string">f&#x27;R = <span class="subst">&#123;R&#125;</span>\nS = <span class="subst">&#123;S&#125;</span>&#x27;</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>其实就是解个矩阵方程就好，这题是之前复现完ASIV2顺手写掉的。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;E:\题\历届赛题\cryptoCTF 2023\ASlv1\ASIv1\output.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">exec</span>(f.read())</span><br><span class="line"></span><br><span class="line">l = <span class="built_in">len</span>(R[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">R_ = Matrix(GF(<span class="number">3</span>),l+<span class="number">1</span>,l)</span><br><span class="line">S_ = vector(GF(<span class="number">3</span>),l+<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l+<span class="number">1</span>):</span><br><span class="line">    R_[i] = R[i]</span><br><span class="line">    S_[i] = S[i]</span><br><span class="line"><span class="built_in">print</span>(R_.rank())</span><br><span class="line">seed = R_.solve_right(S_)</span><br><span class="line"></span><br><span class="line">temp = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">str</span>,seed))</span><br><span class="line">flag = <span class="string">&quot;&quot;</span>.join(temp)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">3</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;3Xpl0i7eD_bY_AtT4ck3r!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="TPSD"><a href="#TPSD" class="headerlink" title="* TPSD"></a>* TPSD</h3><p>NSSCTF上没看见这题，在春乎看了下题目和解答，不利用搜索引擎，光靠自己想应该是很难想到。</p>
<p><br></p>
<p><br></p>
<h3 id="Trex"><a href="#Trex" class="headerlink" title="* Trex"></a>* Trex</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>():</span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_inputs</span>(<span class="params">a, b, c</span>):</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>(<span class="built_in">isinstance</span>(x, <span class="built_in">int</span>) <span class="keyword">for</span> x <span class="keyword">in</span> [a, b, c]):</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">if</span> a == <span class="number">0</span> <span class="keyword">or</span> b == <span class="number">0</span> <span class="keyword">or</span> c == <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">if</span> a == b <span class="keyword">or</span> b == c <span class="keyword">or</span> a == c:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_solution</span>(<span class="params">a, x, y, z</span>):</span><br><span class="line">	<span class="keyword">return</span> (x*x + y*y - x*y - a*(z**<span class="number">3</span>)) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;|&quot;</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;.::   Hi all, she DID it, you should do it too! Are you ready? ::.  &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;Welcome to the Ternary World! You need to pass each level until 20  &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;to get the flag. Pay attention that your solutions should be nonzero&quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;distinct integers. Let&#x27;s start!                                     &quot;</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	level, step = <span class="number">0</span>, <span class="number">19</span></span><br><span class="line">	<span class="keyword">while</span> level &lt;= step:</span><br><span class="line">		a = random.randint(<span class="number">2</span>**(level * <span class="number">12</span>), <span class="number">2</span>**(level*<span class="number">12</span> + <span class="number">12</span>))</span><br><span class="line">		equation = <span class="string">f&#x27;x^2 + y^2 - xy = <span class="subst">&#123;a&#125;</span>*z^3&#x27;</span></span><br><span class="line">		pr(<span class="string">f&quot;Level <span class="subst">&#123;level + <span class="number">1</span>&#125;</span>: <span class="subst">&#123;equation&#125;</span>&quot;</span>)</span><br><span class="line">		inputs = <span class="built_in">input</span>().strip().split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			x, y, z = <span class="built_in">map</span>(<span class="built_in">int</span>, inputs)</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			die(border, <span class="string">&quot;Invalid input, Bye!!&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> check_inputs(x, y, z):</span><br><span class="line">			<span class="keyword">if</span> check_solution(a, x, y, z):</span><br><span class="line">				pr(border, <span class="string">&quot;Correct! Try the next level :)&quot;</span>)</span><br><span class="line">				level += <span class="number">1</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				pr(border, <span class="string">&quot;You didn&#x27;t provide the correct solution.&quot;</span>)</span><br><span class="line">				die(border, <span class="string">&quot;Better luck next time!&quot;</span>)			</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			pr(border, <span class="string">&quot;Your solutions should be non-zero distinct integers&quot;</span>)</span><br><span class="line">			die(border, <span class="string">&quot;Quiting...&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> level == step:</span><br><span class="line">			pr(border, <span class="string">&quot;Congratulations! You&#x27;ve successfully solved all the equations!&quot;</span>)</span><br><span class="line">			die(border, <span class="string">f&quot;flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>题目需要完成19轮挑战得到flag，具体来说每轮挑战是：</p>
<ul>
<li>生成一个与轮数有关的数值a并给出</li>
<li>需要输入两两不相同且均不为0的整数x、y、z，使他们满足方程：</li>
</ul>
<script type="math/tex; mode=display">
x^2 + y^2 -xy = az^3</script><p>这题想复杂了，因为观察到这个似乎也挺像一条曲线的形式，所以一直在想有没有办法还原，然后往椭圆曲线上靠，然后去找到整点。看了春哥的wp发现思路其实很简单也很巧妙。</p>
<p>由于题目要求两两不等，所以不妨就把y记作x+t，t不为0，那么代入原式就有：</p>
<script type="math/tex; mode=display">
x^2 + (x+t)^2 -x(x+t) = az^3</script><p>也就是：</p>
<script type="math/tex; mode=display">
x^2 + xt + t^2 = az^3</script><p>而由于我们只需要一个特解，所以在这里构造x=t，就有：</p>
<script type="math/tex; mode=display">
3t^2 = az^3</script><p>所以发现，当$t = 3a^2, z = 3a$时，就获得我们需要的一组解：</p>
<script type="math/tex; mode=display">
(x,y,z) = (3a^2,6a^2,3a)</script><p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28525</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">19</span>):</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;x^2 + y^2 - xy = &quot;</span>)</span><br><span class="line">    temp = sh.recvline().strip().decode()</span><br><span class="line">    a = <span class="built_in">int</span>(temp[:temp.index(<span class="string">&quot;*&quot;</span>)])</span><br><span class="line">    </span><br><span class="line">    solution = <span class="built_in">str</span>(<span class="number">3</span>*a**<span class="number">2</span>)+<span class="string">&quot;,&quot;</span>+<span class="built_in">str</span>(<span class="number">6</span>*a**<span class="number">2</span>)+<span class="string">&quot;,&quot;</span>+<span class="built_in">str</span>(<span class="number">3</span>*a)</span><br><span class="line">    sh.sendline(solution.encode())</span><br><span class="line">sh.recvline()</span><br><span class="line">sh.recvline()</span><br><span class="line"><span class="built_in">print</span>(sh.recvline())</span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;fe6abdba-5047-47a9-94f6-3d954d3b7734&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Keymoted"><a href="#Keymoted" class="headerlink" title="Keymoted"></a>Keymoted</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_koymoted</span>(<span class="params">nbit</span>):</span><br><span class="line">	p = getPrime(nbit)</span><br><span class="line">	a, b = [randint(<span class="number">1</span>, p - <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;__&#x27;</span>]</span><br><span class="line">	Ep = EllipticCurve(GF(p), [a, b])</span><br><span class="line">	tp = p + <span class="number">1</span> - Ep.order()</span><br><span class="line">	_s = p ^^ ((<span class="number">2</span> ** (nbit - <span class="number">1</span>)) + <span class="number">2</span> ** (nbit // <span class="number">2</span>))</span><br><span class="line">	q = next_prime(<span class="number">2</span> * _s + <span class="number">1</span>)</span><br><span class="line">	Eq = EllipticCurve(GF(q), [a, b])</span><br><span class="line">	n = p * q</span><br><span class="line">	tq = q + <span class="number">1</span> - Eq.order()</span><br><span class="line">	e = <span class="number">65537</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		<span class="keyword">if</span> gcd(e, (p**<span class="number">2</span> - tp**<span class="number">2</span>) * (q**<span class="number">2</span> - tq**<span class="number">2</span>)) == <span class="number">1</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			e = next_prime(e)</span><br><span class="line">	pkey, skey = (n, e, a, b), (p, q)</span><br><span class="line">	<span class="keyword">return</span> pkey, skey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, pkey, skey</span>):</span><br><span class="line">	n, e, a, b = pkey</span><br><span class="line">	p, q = skey</span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	<span class="keyword">assert</span> m &lt; n</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		xp = (m**<span class="number">3</span> + a*m + b) % p</span><br><span class="line">		xq = (m**<span class="number">3</span> + a*m + b) % q</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">pow</span>(xp, (p-<span class="number">1</span>)//<span class="number">2</span>, p) == <span class="built_in">pow</span>(xq, (q-<span class="number">1</span>)//<span class="number">2</span>, q) == <span class="number">1</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			m += <span class="number">1</span></span><br><span class="line">	eq1, eq2 = Mod(xp, p), Mod(xq, q)</span><br><span class="line">	rp, rq = sqrt(eq1), sqrt(eq2)</span><br><span class="line">	_, x, y = xgcd(p, q)</span><br><span class="line">	Z = Zmod(n)</span><br><span class="line">	x = (Z(rp) * Z(q) * Z(y) + Z(rq) * Z(p) * Z(x)) % n</span><br><span class="line">	E = EllipticCurve(Z, [a, b])</span><br><span class="line">	P = E(m, x)</span><br><span class="line">	enc = e * P</span><br><span class="line">	<span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line">nbit = <span class="number">256</span></span><br><span class="line">pkey, skey = gen_koymoted(nbit)</span><br><span class="line">enc = encrypt(flag, pkey, skey)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;pkey = <span class="subst">&#123;pkey&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>题目生成两个素数p、q，并依据p、q和随机的a、b造出两个椭圆曲线Ep、Eq，然后将flag值m作为P点的横坐标，在Ep、Eq上分别计算出其纵坐标后crt得到flag在En下的纵坐标，就得到En下的P点。然后给出n和P的e倍点Q，要求还原m。</p>
<p>而p、q的生成方式是有玄机的，注意到q为：</p>
<script type="math/tex; mode=display">
2(p \oplus 2^{255} \oplus 2^{128})+1 + delta</script><p>delta是nextprime产生的小量，并且由于p本身是256bit，所以第一个异或可以看作是减，那么如果爆破delta的话，其实整个式子就可以看作是：</p>
<script type="math/tex; mode=display">
2(p - 2^{255} \pm 2^{128})+1 + delta</script><p>代入到n=pq就有：</p>
<script type="math/tex; mode=display">
n = p(2(p - 2^{255} \pm 2^{128})+1 + delta)</script><p>那么对这个一元二次方程求根就得到p了，然后就得到q。</p>
<p>之后就分别造出Ep、Eq，在两条曲线上分别求出P点，然后crt组合得到En下的横坐标就是flag了。由于要保证y^2在p、q下都是二次剩余所以有一点偏差，不过问题不大。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">pkey = (<span class="number">6660938713055850877314255610895820875305739186102790477966786501810416821294442374977193379731704125177528590285016474818841859956990486067573436301232301</span>, <span class="number">65537</span>, <span class="number">5539256645640498184116966196249666621079506508209770360679460869295427007578</span>, <span class="number">20151017657582479433586370393795140515103572865771721775868586710594524816458</span>)</span><br><span class="line">enc = (<span class="number">6641320679869421443758875467781930795132746694454926965779628505713445486895274490835545942727970688359873955019634877304270220728625521646208912044469433</span>,<span class="number">2856872654927815636828860866843721158889474116106462420201092148493803550131351543372740950198853438539317164093538508795630146854596724019329887894933972</span>)</span><br><span class="line">n,e,a,b = pkey</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 factor n</span></span><br><span class="line">PR.&lt;p&gt; = PolynomialRing(ZZ)</span><br><span class="line"><span class="keyword">for</span> delta <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    f = p*(<span class="number">2</span>*(p-<span class="number">2</span>^<span class="number">255</span>+<span class="number">2</span>^<span class="number">128</span>)+<span class="number">1</span>+delta)-n</span><br><span class="line">    res = f.roots()</span><br><span class="line">    <span class="keyword">if</span>(res != []):</span><br><span class="line">        p = <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">        q = n // p</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    f = p*(<span class="number">2</span>*(p-<span class="number">2</span>^<span class="number">255</span>-<span class="number">2</span>^<span class="number">128</span>)+<span class="number">1</span>+delta)-n</span><br><span class="line">    res = f.roots()</span><br><span class="line">    <span class="keyword">if</span>(res != []):</span><br><span class="line">        p = <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">        q = n // p</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get flag</span></span><br><span class="line">Ep = EllipticCurve(GF(p), [a, b])</span><br><span class="line">Eq = EllipticCurve(GF(q), [a, b])</span><br><span class="line">Cp = Ep(enc)</span><br><span class="line">Mp = inverse(e,Ep.order())*Cp</span><br><span class="line">Cq = Eq(enc)</span><br><span class="line">Mq = inverse(e,Eq.order())*Cq</span><br><span class="line"></span><br><span class="line">En = EllipticCurve(Zmod(n), [a, b])</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line">X = crt([p,q],[<span class="built_in">int</span>(Mp.xy()[<span class="number">0</span>]),<span class="built_in">int</span>(Mq.xy()[<span class="number">0</span>])])[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(X))</span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;a_n3W_4t7aCk_0n_RSA_a9ain!?&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="hard"><a href="#hard" class="headerlink" title="hard"></a>hard</h2><h3 id="Big"><a href="#Big" class="headerlink" title="Big"></a>Big</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha512</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">nbit</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		p = getPrime(nbit)</span><br><span class="line">		<span class="keyword">if</span> p % <span class="number">4</span> == <span class="number">3</span>:</span><br><span class="line">			q = <span class="built_in">int</span>(<span class="built_in">str</span>(p)[::-<span class="number">1</span>])</span><br><span class="line">			<span class="keyword">if</span> isPrime(q):</span><br><span class="line">				<span class="keyword">return</span> p * q, (p, q)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup</span>(<span class="params">msg, pkey</span>):</span><br><span class="line">	hid = sha512(msg).digest()</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		a = bytes_to_long(hid)</span><br><span class="line">		<span class="keyword">if</span> kronecker(a, pkey) == <span class="number">1</span>:</span><br><span class="line">			<span class="keyword">return</span> a</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			hid = sha512(hid).digest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, pkey</span>):</span><br><span class="line">	a, m = setup(msg, pkey), bytes_to_long(msg)</span><br><span class="line">	B, C = <span class="built_in">bin</span>(m)[<span class="number">2</span>:], []</span><br><span class="line">	<span class="keyword">for</span> b <span class="keyword">in</span> B:</span><br><span class="line">		<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">			t = randint(<span class="number">1</span>, pkey)</span><br><span class="line">			<span class="keyword">if</span> kronecker(t, pkey) == <span class="number">2</span> * <span class="built_in">int</span>(b) - <span class="number">1</span>:</span><br><span class="line">				C.append((t - a * inverse(t, pkey)) % pkey)</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">return</span> (a, C)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pkey, privkey = genkey(<span class="number">512</span>)</span><br><span class="line">E = encrypt(flag, pkey)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;pkey = <span class="subst">&#123;pkey&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;E = <span class="subst">&#123;E&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>题目生成两个素数p、q，他们互为十进制逆序，并取乘积为n。然后题目将flag逐比特加密，加密方式为：</p>
<ul>
<li>若当前bit为0，则取满足$(\frac{t}{n})=-1$的t</li>
<li>若当前bit为1，则取满足$(\frac{t}{n})=1$的t</li>
<li>给出 $t-at^{-1}$ 模n下的值，记为c</li>
</ul>
<p>其中的符号是雅可比符号，a为已知量且$(\frac{a}{n})=1$。</p>
<p>那么首先要获得n的分解，由于p、q互为十进制逆序所以可以剪枝。这一部分就不细讲了，我写的另一篇中有类似的题目：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/342113ee.html">Crypto趣题-剪枝 | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>分解出p、q后，就可以在模p和模q下分别解出每一bit中t的值。这里以模p为例，也就是解这个方程：</p>
<script type="math/tex; mode=display">
t^2-ct-a = 0 \quad(mod\;p)</script><p>我们求出t的最终目的是计算出t对n的雅可比符号，从而确定flag的对应bit取值。而雅可比符号有如下性质：</p>
<script type="math/tex; mode=display">
(\frac{t}{n}) = (\frac{t}{p})(\frac{t}{q})</script><p>所以我们可以分别求t对p、t对q的雅可比符号并相乘，就得到t对n的雅可比符号，就可以逐bit确定flag了。</p>
<p>但是有一个问题需要注意，由于我们解的方程是二次方程，所以一般情况下会有两个解。应该取哪一个解去求雅可比符号呢？</p>
<p>事实上取哪一个都没有影响，这是因为，我们记两个解分别为t1、t2，那么由韦达定理有：</p>
<script type="math/tex; mode=display">
t_1t_2 = -a \quad(mod\;p)</script><p>对这个式子应用欧拉判别式：</p>
<script type="math/tex; mode=display">
t_1^{\frac{p-1}{2}}t_2^{\frac{p-1}{2}} = (-a)^{\frac{p-1}{2}} \quad(mod\;p)</script><p>而可以检查，a在模p、模q下均是二次非剩余，并且发现p、q都是4k+3型的素数，所以有：</p>
<script type="math/tex; mode=display">
t_1^{\frac{p-1}{2}}t_2^{\frac{p-1}{2}} = (-1)^{2k+1}(-1) = 1 \quad(mod\;p)</script><p>这说明t1、t2在模p下的二次剩余性相同，在模q下也同理。所以取哪个根计算结果都一样。</p>
<p>春哥的解释里有一点小错误，就是$(\frac{a}{n})=1$并不能说明a就是模n下的二次剩余，反而，由于a在模p下、模q下都是二次非剩余，所以a在模n下也是二次非剩余。这也是QR假设的困难性所在：雅可比映射的核中既有二次剩余也有二次非剩余，目前如果不知道n的分解的话，没有有效的算法来判定。</p>
<p>但是有一点可以说明，如果$(\frac{a}{n})=-1$的话，那a一定不是模n下的二次剩余。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">pkey = <span class="number">72271787633166084700895603235291055045699965307538401174867474485084272711938364003794151073975875159886045553516299177522950407802715116792937858353646755246888532333536918663888208381012106370000886903776721867958523682675624556576505534100750339626081218194389244007622749982917071344697799413034317147013</span></span><br><span class="line">E = </span><br><span class="line"></span><br><span class="line">n = pkey</span><br><span class="line">a,tlist = E[<span class="number">0</span>],E[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get p,q</span></span><br><span class="line">dec_len = <span class="number">154</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">ph,qh,pl,ql</span>):</span><br><span class="line">    <span class="comment">#check1</span></span><br><span class="line">    padding0 = (dec_len-<span class="built_in">len</span>(ph)-<span class="built_in">len</span>(pl))*<span class="string">&quot;0&quot;</span></span><br><span class="line">    padding9 = (dec_len-<span class="built_in">len</span>(ph)-<span class="built_in">len</span>(pl))*<span class="string">&quot;9&quot;</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">int</span>(qh+padding0+ql)*<span class="built_in">int</span>(ph+padding0+pl) &gt; n <span class="keyword">or</span> <span class="built_in">int</span>(qh+padding9+ql)*<span class="built_in">int</span>(ph+padding9+pl) &lt; n):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment">#check2</span></span><br><span class="line">    mask = <span class="number">10</span>**<span class="built_in">len</span>(pl)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">int</span>(ql)*<span class="built_in">int</span>(pl) % mask != n % mask):</span><br><span class="line">        <span class="keyword">return</span>   </span><br><span class="line">    <span class="comment">#return</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(ph+pl) == dec_len):</span><br><span class="line">        p = <span class="built_in">int</span>(ph+pl)</span><br><span class="line">        q = <span class="built_in">int</span>(qh+ql)</span><br><span class="line">        <span class="keyword">if</span>(p*q==n):</span><br><span class="line">            <span class="built_in">print</span>(p)</span><br><span class="line">            <span class="built_in">print</span>(q)</span><br><span class="line">    <span class="comment">#search  </span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            find(ph + <span class="built_in">str</span>(i), qh + <span class="built_in">str</span>(j), <span class="built_in">str</span>(j) + pl, <span class="built_in">str</span>(i) + ql)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>,<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>,<span class="number">2</span>):</span><br><span class="line">            find(<span class="built_in">str</span>(i),<span class="built_in">str</span>(j),<span class="built_in">str</span>(j),<span class="built_in">str</span>(i))</span><br><span class="line">p = <span class="number">7690745050590286968025665448815927548186441771518218204702842288098845344789340509868897149374937793107491606741591691437711395848517107039674900831427939</span></span><br><span class="line">q = <span class="number">9397241380094769307017158485931177341961951476061947013977394739417988689050439874435488908822482074028128151771446818457295188445665208696820950505470967</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get flag bit by bit</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(tlist):</span><br><span class="line">    PR.&lt;t&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">    f = t^<span class="number">2</span> -i*t - a</span><br><span class="line">    resp = f.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    PR.&lt;t&gt; = PolynomialRing(Zmod(q))</span><br><span class="line">    f = t^<span class="number">2</span> -i*t - a</span><br><span class="line">    resq = f.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(kronecker(resp,p)*kronecker(resq,q) == <span class="number">1</span>):</span><br><span class="line">        flag += <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CCTF&#123;_Cocks_18e_5chEm3&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Marjan"><a href="#Marjan" class="headerlink" title="Marjan"></a>Marjan</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="number">114863632180633827211184132915225798242263961691870412740605315763112513729991</span></span><br><span class="line">A = -<span class="number">3</span></span><br><span class="line">B = <span class="number">105675527217961035404524512435875047840495516468907806313576241823653895562912</span></span><br><span class="line">E = EllipticCurve(GF(p), [A, B])</span><br><span class="line">G = E.random_point()</span><br><span class="line">_o = E.order()</span><br><span class="line">original_msg = <span class="string">&#x27;I love all cryptographers!!!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>():</span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>(<span class="params">E</span>):</span><br><span class="line">	skey = randint(<span class="number">1</span>, _o)</span><br><span class="line">	pkey = skey * G</span><br><span class="line">	<span class="keyword">return</span> pkey, skey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, pkey</span>):</span><br><span class="line">	e, l = randint(<span class="number">1</span>, _o), <span class="built_in">len</span>(msg)</span><br><span class="line">	m1, m2 = bytes_to_long(msg[:l // <span class="number">2</span>]), bytes_to_long(msg[l // <span class="number">2</span>:])</span><br><span class="line">	<span class="keyword">assert</span> m1 &lt; p <span class="keyword">and</span> m2 &lt; p</span><br><span class="line">	e1, e2 = (e * pkey).xy()</span><br><span class="line">	c1, c2 = m1 * e1 % p, m2 * e2 % p</span><br><span class="line">	<span class="keyword">return</span> (c1, c2, e * G)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">msg, skey</span>):</span><br><span class="line">	_tail = bytes_to_long(sha256(<span class="built_in">str</span>(skey).encode(<span class="string">&#x27;utf-8&#x27;</span>)).digest()) % (<span class="number">1</span> &lt;&lt; <span class="number">24</span>)</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		K = [randint(<span class="number">1</span>, <span class="number">2</span>**<span class="number">255</span>) // (<span class="number">1</span> &lt;&lt; <span class="number">24</span>) + _tail <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;__&#x27;</span>]</span><br><span class="line">		r, s = <span class="built_in">int</span>((K[<span class="number">0</span>] * G).xy()[<span class="number">0</span>]), <span class="built_in">int</span>((K[<span class="number">1</span>] * G).xy()[<span class="number">1</span>])</span><br><span class="line">		<span class="keyword">if</span> r * s != <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	h = bytes_to_long(sha256(msg).digest())</span><br><span class="line">	t = inverse(K[<span class="number">0</span>], _o) * (h * r - s * skey) % _o</span><br><span class="line">	<span class="keyword">return</span> (r, s, t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">msg, pkey, _sign</span>):</span><br><span class="line">	r, s, t = [<span class="built_in">int</span>(_) % _o <span class="keyword">for</span> _ <span class="keyword">in</span> _sign]</span><br><span class="line">	h = bytes_to_long(sha256(msg.encode(<span class="string">&#x27;utf-8&#x27;</span>)).digest())</span><br><span class="line">	u = <span class="built_in">int</span>(h * r * inverse(t, _o) % _o)</span><br><span class="line">	v = <span class="built_in">int</span>(s * inverse(t, _o) % _o)</span><br><span class="line">	<span class="comment"># u = h * r * inverse(t, _o) % _o</span></span><br><span class="line">	<span class="comment"># v = s * inverse(t, _o) % _o</span></span><br><span class="line">	_R = (u * G - v * pkey).xy()[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">return</span> _R == r</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;|&quot;</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;Hi all, now it&#x27;s time to solve a probably simple ECC challenge about&quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;encryption and signing in elliptic curves! Follow the questions and &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;find the secret flag, are you ready!?                               &quot;</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	pkey, skey = keygen(E)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		pr(<span class="string">&quot;| Options: \n|\t[E]ncrypt a message! \n|\t[G]et the flag \n|\t[P]ublic Key \n|\t[S]ign a message \n|\t[V]erify signature \n|\t[Q]uit&quot;</span>)</span><br><span class="line">		ans = sc().decode().lower().strip()</span><br><span class="line">		<span class="keyword">if</span> ans == <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">&#x27;Send your message here: &#x27;</span>)</span><br><span class="line">			_msg = sc()</span><br><span class="line">			_enc = encrypt(_msg, pkey)</span><br><span class="line">			pr(border, <span class="string">f&#x27;enc = <span class="subst">&#123;_enc&#125;</span>&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;g&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">&#x27;You should send the valid signature for my given message!&#x27;</span>)</span><br><span class="line">			pr(border, <span class="string">&#x27;Send the signature of original message here: &#x27;</span>)</span><br><span class="line">			_sgn = sc().split(<span class="string">b&#x27;,&#x27;</span>)</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				_sgn = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> _sgn]</span><br><span class="line">				<span class="keyword">if</span> verify(original_msg, pkey, _sgn):</span><br><span class="line">					die(border, <span class="string">f&#x27;Congratz! You got the flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					pr(border, <span class="string">&#x27;Your signature is not correct!&#x27;</span>)</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				<span class="keyword">import</span> traceback; traceback.print_exc()</span><br><span class="line">				pr(border, <span class="string">&#x27;Try to send valid signature!&#x27;</span>)</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">&#x27;Send your message to sign: &#x27;</span>)</span><br><span class="line">			_msg = sc()</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(_msg) &gt;= <span class="number">10</span>:</span><br><span class="line">				die(border, <span class="string">&#x27;Sorry, I sign only short messages! :/&#x27;</span>)</span><br><span class="line">			_sgn = sign(_msg, skey)</span><br><span class="line">			pr(border, <span class="string">f&#x27;sgn = <span class="subst">&#123;_sgn&#125;</span>&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;v&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">&#x27;Send your signature to verify: &#x27;</span>)</span><br><span class="line">			_sgn = sc().split(<span class="string">b&#x27;,&#x27;</span>)</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				_sgn = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> _sgn]</span><br><span class="line">				pr(border, <span class="string">&#x27;Send your message: &#x27;</span>)</span><br><span class="line">				_msg = sc()</span><br><span class="line">				<span class="keyword">if</span> verify(_msg, pkey, _sgn):</span><br><span class="line">					pr(border, <span class="string">&#x27;Your message successfully verified :)&#x27;</span>)</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					pr(border, <span class="string">&#x27;Verification failed :(&#x27;</span>)</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				pr(border, <span class="string">&#x27;Try to send valid signature!&#x27;</span>)</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">f&#x27;pkey = <span class="subst">&#123;pkey&#125;</span>&#x27;</span>)</span><br><span class="line">			pr(border, <span class="string">f&#x27;G = <span class="subst">&#123;G&#125;</span>&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;Quitting...&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;You should select valid choice!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>题目基于ECDSA，理论上来说，可以申请无数次不同消息的签名，靶机会返回对应签名值。而如果成功伪造出指定消息</p>
<p>‘I love all cryptographers!!!’的签名的话就可以拿到flag。而由于送去签名的消息有长度限制不能大于等于10，所以没法直接把指定消息拿去签名。</p>
<p>为了方便，把私钥记为d，那么签名过程是这样的：</p>
<script type="math/tex; mode=display">
t = K^{-1}(hr+sd) \quad(mod\;o)</script><p>并返回给你r、s、t。其中o是曲线的阶。</p>
<p>而签名过程中有个极其显眼的地方告诉你要HNP：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">K = [randint(<span class="number">1</span>, <span class="number">2</span>**<span class="number">255</span>) // (<span class="number">1</span> &lt;&lt; <span class="number">24</span>) + _tail <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;__&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>这里直接用了整除，说明K最多也就231bit。那么为了利用HNP，仍然是常用思路，把后面的若干组签名与第0组签名作个差消去d，然后用多组这样的等式造格，从而规约出所有K。</p>
<p>还是写一下吧，比如对于第0组和第1组，分别有：</p>
<script type="math/tex; mode=display">
t_0K_0 = h_0r_0+s_0d \quad(mod\;o)</script><script type="math/tex; mode=display">
t_1K_1 = h_1r_1+s_1d \quad(mod\;o)</script><p>为了消去d，把d的系数配成相同：</p>
<script type="math/tex; mode=display">
s_1t_0K_0 = s_1h_0r_0+s_1s_0d \quad(mod\;o)</script><script type="math/tex; mode=display">
s_0t_1K_1 = s_0h_1r_1+s_0s_1d \quad(mod\;o)</script><p>那么作差就得到：</p>
<script type="math/tex; mode=display">
s_1h_0r_0 - s_0h_1r_1 + s_0t_1K_1 - s_1t_0K_0 = 0 \quad(mod\;o)</script><p>由于r、s、t、h均已知(h是送去签名的消息的哈希值)，所以可以简化写为：</p>
<script type="math/tex; mode=display">
A_1K_1 + B_1K_0 + C_1 = 0 \quad(mod\;o)</script><p>那么申请多组签名，就有多组等式：</p>
<script type="math/tex; mode=display">
A_iK_i + B_iK_0 + C_i + u_io =  0</script><p>然后就可以造格了，假设算上第0组，一共申请了n+1组签名，就有n个上面这样的式子，那么造的格子长下面这样：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}
1&&&&&&A_1&A_2&\cdots&A_n\\
&1&&&&&B_1\\
&&\ddots&&&&&\ddots\\
&&&1&&&&&B_{n-1}\\
&&&&1&&&&&B_{n}\\
&&&&&2^{231}&C_1&C_2&\cdots&C_n\\
&&&&&&o\\
&&&&&&&o\\
&&&&&&&&\ddots\\
&&&&&&&&&o\\
\end{matrix}
\right)</script><p>这个格具有的线性关系是：</p>
<script type="math/tex; mode=display">
(K_0,K_1,...K_n,1,u_1,u_2,...u_n)
\left(\begin{matrix}
1&&&&&&A_1&A_2&\cdots&A_n\\
&1&&&&&B_1\\
&&\ddots&&&&&\ddots\\
&&&1&&&&&B_{n-1}\\
&&&&1&&&&&B_{n}\\
&&&&&2^{231}&C_1&C_2&\cdots&C_n\\
&&&&&&o\\
&&&&&&&o\\
&&&&&&&&\ddots\\
&&&&&&&&&o\\
\end{matrix}
\right)
=
(K_0,K_1,...K_n,2^{231},0,0,...,0)</script><p>本来想着反正不限制组数，偷懒就不算高斯启发式了，直接来50组莽试。结果申请签名的中途总是会在某一次的时候断掉，根本就申请不完50组。然后再审了下代码发现，因为曲线阶o并不是一个素数，所以签名中的求逆操作并不总会成功。那就只能少申请一些增大申请完成的概率。</p>
<p>但是还是死活出不来，无奈之下去看了春哥和maple的wp，发现的确是有一个很坑的点就是申请签名操作中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_msg = sc()</span><br></pre></td></tr></table></figure>
<p>和之前的靶机题目不一样，这里没有取[:-1]的操作，也就是说我们发过去的消息他会加一个换行符”\n”再进行哈希。</p>
<p>那么这样就没有问题了，申请20组数据，然后LLL得到k0后就可以算出d，然后伪造签名并发送过去就拿到flag了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Pwn4Sage.pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">p = <span class="number">114863632180633827211184132915225798242263961691870412740605315763112513729991</span></span><br><span class="line">A = -<span class="number">3</span></span><br><span class="line">B = <span class="number">105675527217961035404524512435875047840495516468907806313576241823653895562912</span></span><br><span class="line">E = EllipticCurve(GF(p), [A, B])</span><br><span class="line">_o = E.order()</span><br><span class="line">original_msg = <span class="string">&#x27;I love all cryptographers!!!&#x27;</span></span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28406</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get pubkey</span></span><br><span class="line">sh.recvuntil(<span class="string">b&quot;[Q]uit&quot;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;p&quot;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;pkey = &quot;</span>)</span><br><span class="line">temp = sh.recvline().strip().decode().split(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">pkey = E(<span class="built_in">int</span>(temp[<span class="number">0</span>][<span class="number">1</span>:-<span class="number">1</span>]),<span class="built_in">int</span>(temp[<span class="number">1</span>][<span class="number">1</span>:-<span class="number">1</span>]))</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;G = &quot;</span>)</span><br><span class="line">temp = sh.recvline().strip().decode().split(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">G = E(<span class="built_in">int</span>(temp[<span class="number">0</span>][<span class="number">1</span>:-<span class="number">1</span>]),<span class="built_in">int</span>(temp[<span class="number">1</span>][<span class="number">1</span>:-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get groups of sign to construct matrix</span></span><br><span class="line">groups = <span class="number">20</span></span><br><span class="line">A = []</span><br><span class="line">B = []</span><br><span class="line">C = []</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&quot;[Q]uit&quot;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;s&quot;</span>)</span><br><span class="line">msg = long_to_bytes(<span class="number">0</span>)</span><br><span class="line">sh.sendline(msg)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;sgn = &quot;</span>)</span><br><span class="line">r0,s0,t0 = <span class="built_in">eval</span>(sh.recvline().strip().decode())</span><br><span class="line">h0 = bytes_to_long(sha256(msg+<span class="string">b&quot;\n&quot;</span>).digest())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">1</span>,groups):</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;[Q]uit&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="string">b&quot;s&quot;</span>)</span><br><span class="line">    msg = os.urandom(<span class="number">8</span>)</span><br><span class="line">    sh.sendline(msg)</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;sgn = &quot;</span>)</span><br><span class="line">    ri,si,ti = <span class="built_in">eval</span>(sh.recvline().strip().decode())</span><br><span class="line">    hi = bytes_to_long(sha256(msg+<span class="string">b&quot;\n&quot;</span>).digest())</span><br><span class="line">    A.append(t0*si)</span><br><span class="line">    B.append(-ti*s0)</span><br><span class="line">    C.append(hi*ri*s0-h0*r0*si)</span><br><span class="line"></span><br><span class="line">T = <span class="number">2</span>^<span class="number">300</span></span><br><span class="line">L = Matrix(ZZ,<span class="number">2</span>*groups,<span class="number">2</span>*groups)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(groups):</span><br><span class="line">    L[i,i] = <span class="number">1</span></span><br><span class="line">L[groups,groups] = <span class="number">2</span>^<span class="number">231</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(groups-<span class="number">1</span>):</span><br><span class="line">    L[<span class="number">0</span>,groups+<span class="number">1</span>+i] = A[i]*T</span><br><span class="line">    L[<span class="number">1</span>+i,groups+<span class="number">1</span>+i] = B[i]*T</span><br><span class="line">    L[groups,groups+<span class="number">1</span>+i] = C[i]*T</span><br><span class="line">    L[groups+<span class="number">1</span>+i,groups+<span class="number">1</span>+i] = _o*T</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 LLL to get k</span></span><br><span class="line">res = L.LLL()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">abs</span>(i[groups])==<span class="number">2</span>^<span class="number">231</span>):</span><br><span class="line">        k0 = <span class="built_in">abs</span>(i[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part4 get skey and get signature of original message</span></span><br><span class="line">skey = (h0*r0-t0*k0)*inverse(s0,_o) % _o</span><br><span class="line"><span class="built_in">print</span>(skey*G == pkey)</span><br><span class="line">_tail = bytes_to_long(sha256(<span class="built_in">str</span>(skey).encode(<span class="string">&#x27;utf-8&#x27;</span>)).digest()) % (<span class="number">1</span> &lt;&lt; <span class="number">24</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    K = [randint(<span class="number">1</span>, <span class="number">2</span>**<span class="number">255</span>) // (<span class="number">1</span> &lt;&lt; <span class="number">24</span>) + _tail <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;__&#x27;</span>]</span><br><span class="line">    r, s = <span class="built_in">int</span>((K[<span class="number">0</span>] * G).xy()[<span class="number">0</span>]), <span class="built_in">int</span>((K[<span class="number">1</span>] * G).xy()[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> r * s != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">h = bytes_to_long(sha256(original_msg.encode()).digest())</span><br><span class="line">t = inverse(K[<span class="number">0</span>], _o) * (h * r - s * skey) % _o</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&quot;[Q]uit&quot;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;g&quot;</span>)</span><br><span class="line">sh.sendline((<span class="built_in">str</span>(r)+<span class="string">&quot;,&quot;</span>+<span class="built_in">str</span>(s)+<span class="string">&quot;,&quot;</span>+<span class="built_in">str</span>(t)).encode())</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;You got the flag: &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(sh.recvline())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;7255af4f-390f-47c4-9c0c-e0dd2afbc944&#125;</span></span><br></pre></td></tr></table></figure>
<p>做完题目后看春哥wp里还写了一种非预期，就是发送：</p>
<script type="math/tex; mode=display">
(r,0,hr)</script><p>就可以拿到flag。而之所以会产生这种非预期，是因为验签操作中没有检查s是否为0，而s为0时验签操作就和私钥d没啥关系了，就可以构造t使得R=G。</p>
<p><br></p>
<p><br></p>
<h3 id="Byeween"><a href="#Byeween" class="headerlink" title="* Byeween"></a>* Byeween</h3><p>这题NSSCTF上也没有，不过这个原因我倒是知道。因为这个题目本身只有交互，没有题目的完整源码。而题目的内容是定义了一条有理数域上的椭圆曲线：</p>
<script type="math/tex; mode=display">
y^2 = x^3 -ax</script><p>并给出上面的一个点P，要求计算出所有满足2Q=P的Q点。</p>
<p>这个题目本身没什么可说的，如果知道sage中的division_points方法的话就可以直接调用就能搞定。但是问题在于，既然没有这个题目的源码，那么要搞出这个靶机的话，就要自己实现一下题目逻辑。看上去并不难，然而怎么生成一条曲线上的一个随机点却是个问题。因为有理数域上的ECC好像是不能直接random_points得到某个点的，所以似乎要人为的去构造出点。</p>
<p>那天在工坊群里也和一些师傅讨论了好一会儿，但是想了很久也没想出什么好方法。一些纵坐标为0的点固然可以构造，但是由这些点根本得不到纵坐标不为0的点，所以肯定不是这个思路。</p>
<p><br></p>
<p><br></p>
<h3 id="Vinefruit"><a href="#Vinefruit" class="headerlink" title="Vinefruit"></a>Vinefruit</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>():</span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vinefruit</span>(<span class="params">msg, mod, flag = <span class="number">0</span></span>):</span><br><span class="line">	P = [<span class="number">16777619</span>, <span class="number">1099511628211</span>, <span class="number">309485009821345068724781371</span>]</span><br><span class="line">	O = [<span class="number">2166136261</span>, <span class="number">14695981039346656037</span>, <span class="number">144066263297769815596495629667062367629</span>]</span><br><span class="line">	<span class="keyword">assert</span> mod <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">	p, o, m = P[mod], O[mod], <span class="number">2</span> ** (<span class="number">2</span> &lt;&lt; (<span class="number">4</span> + mod))</span><br><span class="line">	vine = o</span><br><span class="line">	<span class="keyword">for</span> b <span class="keyword">in</span> msg:</span><br><span class="line">		<span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">			vine = (vine + b) % (<span class="number">2</span> ** <span class="number">128</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			vine = vine ^ b</span><br><span class="line">		vine = (vine * p) % m</span><br><span class="line">	<span class="keyword">return</span> vine</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;|&quot;</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">&quot; Hi all, I have designed a gorgeous cryptography hash function in   &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot; order to secure the world! Your mission is to find collision for   &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot; this function with specific conditions.                            &quot;</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	</span><br><span class="line">	step = <span class="number">19</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		pr(<span class="string">&quot;| Options: \n|\t[S]ubmit collision \n|\t[Q]uit&quot;</span>)</span><br><span class="line">		ans = sc().decode().lower().strip()</span><br><span class="line">		<span class="keyword">if</span> ans == <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">			S = []</span><br><span class="line">			<span class="keyword">for</span> level <span class="keyword">in</span> <span class="built_in">range</span>(step):</span><br><span class="line">				mod = random.randint(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">				pr(border, <span class="string">f&#x27;Submit two different string such that vinefruit(m1, <span class="subst">&#123;mod&#125;</span>, 1) = vinefruit(m2, <span class="subst">&#123;mod&#125;</span>, 1)&#x27;</span>)</span><br><span class="line">				pr(border, <span class="string">f&#x27;You are at level: <span class="subst">&#123;level + <span class="number">1</span>&#125;</span>&#x27;</span>)</span><br><span class="line">				<span class="keyword">if</span> level == step - <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">len</span>(S) == step - <span class="number">1</span>:</span><br><span class="line">					die(border, <span class="string">f&#x27;Congrats, you got the flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">				<span class="keyword">try</span>:</span><br><span class="line">					pr(border, <span class="string">f&#x27;Please send first byte string: &#x27;</span>)</span><br><span class="line">					s1 = sc()[:-<span class="number">1</span>]</span><br><span class="line">					pr(border, <span class="string">f&#x27;Please send second byte string: &#x27;</span>)</span><br><span class="line">					s2 = sc()[:-<span class="number">1</span>]</span><br><span class="line">					s1, s2 = binascii.unhexlify(s1), binascii.unhexlify(s2)</span><br><span class="line">				<span class="keyword">except</span>:</span><br><span class="line">					pr(border, <span class="string">&#x27;You should send valid hex strings.&#x27;</span>)</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">				<span class="keyword">if</span> <span class="built_in">len</span>(s1) == <span class="built_in">len</span>(s2) == <span class="number">35</span> - level <span class="keyword">and</span> s1 != s2:</span><br><span class="line">					<span class="keyword">if</span> vinefruit(s1, mod, <span class="number">1</span>) == vinefruit(s2, mod, <span class="number">1</span>):</span><br><span class="line">						<span class="keyword">if</span> vinefruit(s1, mod, <span class="number">1</span>) <span class="keyword">not</span> <span class="keyword">in</span> S:</span><br><span class="line">							S.append(vinefruit(s1, mod, <span class="number">1</span>))</span><br><span class="line">							pr(border, <span class="string">&#x27;gj, try the next level :)&#x27;</span>)</span><br><span class="line">						<span class="keyword">else</span>:</span><br><span class="line">							<span class="keyword">break</span></span><br><span class="line">					<span class="keyword">else</span>:</span><br><span class="line">						<span class="keyword">break</span></span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					die(border, <span class="string">&#x27;Kidding me?! Try again and be smart!! Bye!!!&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;Quitting...&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;You should select valid choice!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>题目完成18轮挑战后就得到flag。每轮挑战的内容是：</p>
<ul>
<li>给出两个指定长度(35-level)的不同字节串的十六进制表示，要求他们经过特定函数vinefruit的输出值相同，且没有出现过</li>
</ul>
<p>而vinefruit的处理过程是，对输入串的每一个字节m1、m2、…mn进行如下迭代得到输出：</p>
<script type="math/tex; mode=display">
vine = ((((o+m_1)p+m_2)p + ...+m_{n-1})p + m_n)p  \quad(mod\;m)</script><p>其中，o、p、m由一个0-2的随机数mod决定。式中其实还有模2^128的操作，但由于只是加一个字节而已，所以实际上基本等于没用，就不写在上面了。</p>
<p>那现在的问题就是找到两个串，使他们得到的vine值相同。而这并不难，观察到上面的迭代过程完全可以写作一个关于p的多项式形式：</p>
<script type="math/tex; mode=display">
vine = (o+m_1)p^n + m_2p^{n-1} + ... + m_{n-1}p^2 + m_np  \quad(mod\;m)</script><p>那么设s1的字节分别是a1、a2、…、an，s2是b1、b2、…、bn，那么就有：</p>
<script type="math/tex; mode=display">
vine = (o+a_1)p^n + a_2p^{n-1} + ... + a_{n-1}p^2 + a_np  \quad(mod\;m)</script><script type="math/tex; mode=display">
vine = (o+b_1)p^n + b_2p^{n-1} + ... + b_{n-1}p^2 + b_np  \quad(mod\;m)</script><p>作差就得到：</p>
<script type="math/tex; mode=display">
(a_1-b_1)p^n + (a_2-b_2)p^{n-1} + ... + (a_{n-1}-b_{n-1})p^2 + (a_n-b_n)p + km = 0</script><p>那么我们构造如下格：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}
1&&&&p^n\\
&1&&&p^{n-1}\\
&&\ddots&&\cdots\\
&&&1&p\\
&&&&m
\end{matrix}
\right)</script><p>这个格具有的线性关系是：</p>
<script type="math/tex; mode=display">
(a_1-b_1,a_2-b_2,...,a_{n-1}-b_{n-1},a_n-b_n,k)
\left(\begin{matrix}
1&&&&p^n\\
&1&&&p^{n-1}\\
&&\ddots&&\cdots\\
&&&1&p\\
&&&&m
\end{matrix}
\right)
=
(a_1-b_1,a_2-b_2,...,a_{n-1}-b_{n-1},a_n-b_n,0)</script><p>所以给最后一列配上大系数保证规约出0，就可以LLL得到符合要求的字节差值构成的短向量。随便取其中一组拿来用就可以。为了保证s1、s2的每个字节均落在0-255中，就取s1全为128就可以满足要求了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Pwn4Sage.pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_s1_s2</span>(<span class="params">level,mod</span>):</span><br><span class="line">    length = <span class="number">35</span>-level</span><br><span class="line">    P = [<span class="number">16777619</span>, <span class="number">1099511628211</span>, <span class="number">309485009821345068724781371</span>]</span><br><span class="line">    O = [<span class="number">2166136261</span>, <span class="number">14695981039346656037</span>, <span class="number">144066263297769815596495629667062367629</span>]</span><br><span class="line">    p, o, m = P[mod], O[mod], <span class="number">2</span> ** (<span class="number">2</span> &lt;&lt; (<span class="number">4</span> + mod))</span><br><span class="line"></span><br><span class="line">    T = <span class="number">2</span>^<span class="number">1000</span></span><br><span class="line">    L = Matrix(ZZ,length+<span class="number">2</span>,length+<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        L[i,i] = <span class="number">1</span></span><br><span class="line">        L[i,-<span class="number">1</span>] = p^(length-i)*T</span><br><span class="line">    L[-<span class="number">2</span>,-<span class="number">2</span>] = T</span><br><span class="line">    L[-<span class="number">2</span>,-<span class="number">1</span>] = (p^length)*T</span><br><span class="line">    L[-<span class="number">1</span>,-<span class="number">1</span>] = m*T</span><br><span class="line"></span><br><span class="line">    res = L.LLL()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">if</span>(i[-<span class="number">2</span>] == <span class="number">0</span>):</span><br><span class="line">            S = i[:-<span class="number">2</span>]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    s1 = [<span class="number">128</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length)]</span><br><span class="line">    s2 = [s1[i] + S[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length)]</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">all</span> (i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>) <span class="keyword">for</span> i <span class="keyword">in</span> s2)</span><br><span class="line"></span><br><span class="line">    s1 = <span class="built_in">hex</span>(bytes_to_long(<span class="built_in">bytes</span>(s1)))[<span class="number">2</span>:]</span><br><span class="line">    s2 = <span class="built_in">hex</span>(bytes_to_long(<span class="built_in">bytes</span>(s2)))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> s1,s2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28829</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> level <span class="keyword">in</span> trange(<span class="number">18</span>):</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;Submit two different string such that vinefruit(m1, &quot;</span>)</span><br><span class="line">    mod = <span class="built_in">int</span>(sh.recvline().strip().decode()[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    s1,s2 = gen_s1_s2(level,mod)</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;Please send first byte string: &quot;</span>)</span><br><span class="line">    sh.sendline(s1.encode())</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;Please send second byte string: &quot;</span>)</span><br><span class="line">    sh.sendline(s2.encode())</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&quot;Congrats, you got the flag:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(sh.recvline())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;c926d409-bcc9-4595-93dc-329dad0f30f0&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Shevid"><a href="#Shevid" class="headerlink" title="$ Shevid"></a>$ Shevid</h3><p>看了wp知道找个轮子就可以解，但是我实在是一点都不懂isogeny。这些天断断续续读了很久hashhash师傅给我的isogeny的入门论文，发现抽代水平实在是差的有点太多，很多地方想求个一知半解都不行，就回头又去补抽代了。</p>
<p>希望有朝一日能至少大致弄懂isogeny，感觉入门门槛前所未有的高。</p>
<p><br></p>
<p><br></p>
<h2 id="tough"><a href="#tough" class="headerlink" title="tough"></a>tough</h2><h3 id="Slowsum"><a href="#Slowsum" class="headerlink" title="* Slowsum"></a>* Slowsum</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>():</span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">slowsum</span>(<span class="params">p, n</span>):</span><br><span class="line">	g = <span class="number">0</span></span><br><span class="line">	perms = <span class="built_in">list</span>(product([<span class="number">0</span>, <span class="number">1</span>], repeat = n))</span><br><span class="line">	<span class="keyword">for</span> _prm <span class="keyword">in</span> perms:</span><br><span class="line">		g += p(_prm)</span><br><span class="line">	<span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">h4sh</span>(<span class="params">p, q</span>):</span><br><span class="line">	coeffs = p.coefficients()</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">pow</span>(<span class="built_in">sum</span>(coeffs), (q - <span class="number">1</span>) // <span class="number">2</span> - <span class="built_in">sum</span>(coeffs), q) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;|&quot;</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;Hi all, I have created a basic and rudimentary version of a sumcheck&quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;protocol. Your task is to generate a false statement and persuade   &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;verifier of its validity.                                           &quot;</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	</span><br><span class="line">	q = <span class="number">2</span>**<span class="number">61</span> - <span class="number">1</span>  <span class="comment"># Mersenne prime</span></span><br><span class="line">	F = GF(q)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		pr(<span class="string">&quot;| Options: \n|\t[C]laim the statement \n|\t[D]etermine parameters and polynomial \n|\t[Q]uit&quot;</span>)</span><br><span class="line">		ans = sc().decode().lower().strip()</span><br><span class="line">		<span class="keyword">if</span> ans == <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">f&#x27;Please first send the number of variable and the degree of your desired polynomial:&#x27;</span>)</span><br><span class="line">			_ans = sc()</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				_n, _d = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> _ans.split(<span class="string">b&#x27;,&#x27;</span>)]</span><br><span class="line">				<span class="keyword">if</span> (_n * _d) // q &lt; <span class="number">5e-17</span> <span class="keyword">and</span> _n &gt;= <span class="number">5</span> <span class="keyword">and</span> _d &gt;= <span class="number">3</span>:</span><br><span class="line">					R = PolynomialRing(F, _n, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">					x = R.gens()</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					<span class="keyword">raise</span> Exception()</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				die(border, <span class="string">&#x27;The parameters are not consistent! Try again!!&#x27;</span>)</span><br><span class="line">			pr(border, <span class="string">f&#x27;Now, please send the <span class="subst">&#123;_n&#125;</span>-variable polynomial as p: &#x27;</span>)</span><br><span class="line">			_p = sc().strip().decode()</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				_p = R(_p)</span><br><span class="line">				p = _p</span><br><span class="line">				_deg = _p.degree(std_grading=<span class="literal">True</span>)</span><br><span class="line">				<span class="keyword">if</span> _deg != _d:</span><br><span class="line">					<span class="keyword">raise</span> Exception()</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				die(border, <span class="string">&#x27;The polynomial is not valid or does not hold true in the given situations!&#x27;</span>)</span><br><span class="line">			g = slowsum(_p, _n)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">			pr(border, <span class="string">&#x27;Please send the g: &#x27;</span>)</span><br><span class="line">			_g = sc()</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				_g = <span class="built_in">int</span>(_g)</span><br><span class="line">				<span class="keyword">if</span> _g == g:</span><br><span class="line">					die(border, <span class="string">&#x27;Kidding me?! Bye :P&#x27;</span>)</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				die(border, <span class="string">&#x27;Some exception occurred! Bye!!&#x27;</span>)</span><br><span class="line">			_P, _H = [], []</span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(_n):</span><br><span class="line">				pr(border, <span class="string">f&#x27;Please send the (p_<span class="subst">&#123;i&#125;</span>, h4sh(p_<span class="subst">&#123;i&#125;</span>, q)): &#x27;</span>)</span><br><span class="line">				pr(border, <span class="string">f&#x27;Note that the variable of p_<span class="subst">&#123;i&#125;</span> should be x. &#x27;</span>)</span><br><span class="line">				_ph = sc().strip()</span><br><span class="line">				<span class="keyword">try</span>:</span><br><span class="line">					_p, _h = [_.decode() <span class="keyword">for</span> _  <span class="keyword">in</span> _ph.split(<span class="string">b&#x27;,&#x27;</span>)]</span><br><span class="line">					_R = PolynomialRing(F, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">					_p, _h = _R(_p), F(_h)</span><br><span class="line">					<span class="keyword">if</span> _p.degree() &gt; _d:</span><br><span class="line">						<span class="keyword">raise</span> Exception()</span><br><span class="line">					_P.append(_p)</span><br><span class="line">					_H.append(_h)</span><br><span class="line">				<span class="keyword">except</span>:</span><br><span class="line">					die(border, <span class="string">&#x27;Some exception occurred! Bye!!&#x27;</span>)</span><br><span class="line">			j = <span class="number">0</span></span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(_n):</span><br><span class="line">				<span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">					<span class="keyword">if</span> _P[i](<span class="number">0</span>) + _P[i](<span class="number">1</span>) != _g <span class="keyword">or</span> h4sh(_P[i], q) != _H[i]:</span><br><span class="line">						<span class="keyword">break</span></span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					<span class="keyword">if</span> _P[i](<span class="number">0</span>) + _P[i](<span class="number">1</span>) != _P[i-<span class="number">1</span>](_H[i-<span class="number">1</span>]) <span class="keyword">or</span> h4sh(_P[i], q) != _H[i]:</span><br><span class="line">						<span class="keyword">break</span></span><br><span class="line">				j += <span class="number">1</span></span><br><span class="line">			<span class="keyword">if</span> j &lt; _n <span class="keyword">or</span> p(_H) != _P[_n-<span class="number">1</span>](_H[_n-<span class="number">1</span>]):</span><br><span class="line">				die(border, <span class="string">&#x27;Oops, verifier believes that the polynomial is not valid! Bye!!&#x27;</span>)</span><br><span class="line">			die(border, <span class="string">f&#x27;Congrats, here the flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;Quitting...&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;You should select valid choice!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>看了半天题目，人都看晕了也没把过程理明白。最终也失去了耐心选择直接看春哥的wp。</p>
<p>然后就发现，如果把题目条件一条条理清楚，并且发现他并不对0做检查，就可以把题目简化到一种极其简单的所有项均为0的情况，然后此时随便取f为常数项为0的多项式并计算slowsum的g就可以通过核验了。</p>
<p>不过我的确是没有耐心读题、找出这种解法的能力，虽然说如果是真的在比赛的话心态或许会不太一样，但是我觉得我还是暂时做不出来这种代码比较复杂的题目的，希望之后能耐着性子去理解题目内容。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Pwn4Sage.pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">slowsum</span>(<span class="params">p, n</span>):</span><br><span class="line">	g = <span class="number">0</span></span><br><span class="line">	perms = <span class="built_in">list</span>(product([<span class="number">0</span>, <span class="number">1</span>], repeat = n))</span><br><span class="line">	<span class="keyword">for</span> _prm <span class="keyword">in</span> perms:</span><br><span class="line">		g += p(_prm)</span><br><span class="line">	<span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line">q = <span class="number">2</span>**<span class="number">61</span> - <span class="number">1</span>  <span class="comment"># Mersenne prime</span></span><br><span class="line">F = GF(q)</span><br><span class="line">n = <span class="number">5</span></span><br><span class="line">d = <span class="number">3</span></span><br><span class="line">R = PolynomialRing(F, n, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">x = R.gens()</span><br><span class="line">p = <span class="string">&quot;x0^3&quot;</span></span><br><span class="line">_p = R(p)</span><br><span class="line">g = slowsum(_p, n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28301</span>)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&quot;[Q]uit&quot;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;d&quot;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;desired polynomial:&quot;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;5,3&quot;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;polynomial as p: &quot;</span>)</span><br><span class="line">sh.sendline(p.encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&quot;[Q]uit&quot;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;c&quot;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;Please send the g: &quot;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;0&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">	sh.recvuntil(<span class="string">b&quot;should be x. &quot;</span>)</span><br><span class="line">	sh.sendline(<span class="string">b&quot;0,0&quot;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;here the flag:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(sh.recvline())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;6110e36c-8e21-4ffc-9e31-4329dba63f65&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="ASIv2"><a href="#ASIv2" class="headerlink" title="* ASIv2"></a>* ASIv2</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base</span>(<span class="params">n, l</span>):</span><br><span class="line">    D = []</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        n, r = <span class="built_in">divmod</span>(n, l)</span><br><span class="line">        D.append(r)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(d) <span class="keyword">for</span> d <span class="keyword">in</span> <span class="built_in">reversed</span>(D)) <span class="keyword">or</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asiv_prng</span>(<span class="params">seed</span>):</span><br><span class="line">	l = <span class="built_in">len</span>(seed)</span><br><span class="line">	_seed = base(bytes_to_long(seed), <span class="number">3</span>)</span><br><span class="line">	_l = <span class="built_in">len</span>(_seed)</span><br><span class="line">	R = [[getRandomRange(<span class="number">0</span>, <span class="number">3</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(_l)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(_l**<span class="number">2</span>)]</span><br><span class="line">	S = []</span><br><span class="line">	<span class="keyword">for</span> r <span class="keyword">in</span> R:</span><br><span class="line">		s = <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(_l):</span><br><span class="line">			b = ((<span class="built_in">int</span>(r[_]) + <span class="built_in">int</span>(_seed[_])) % <span class="number">3</span>) % <span class="number">2</span></span><br><span class="line">			s = s ^ b</span><br><span class="line">		S.append(s)</span><br><span class="line">	<span class="built_in">print</span>(<span class="built_in">len</span>(S))</span><br><span class="line">	<span class="keyword">return</span> R, S</span><br><span class="line"></span><br><span class="line">seed = flag.lstrip(<span class="string">b&#x27;CCTF&#123;&#x27;</span>).rstrip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">R, S = asiv_prng(seed)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(<span class="string">f&#x27;R = <span class="subst">&#123;R&#125;</span>\nS = <span class="subst">&#123;S&#125;</span>&#x27;</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>这个之前做另一道类似题目的时候已经学习过解法了。wp见：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/97bbcbc9.html">Crypto趣题-其他 | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;E:\vscode\output.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">exec</span>(f.read())</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(R[<span class="number">0</span>])</span><br><span class="line">A = []</span><br><span class="line">b = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span> * n):</span><br><span class="line">    Aline = []</span><br><span class="line">    bline = S[i]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">if</span> (R[i][j] == <span class="number">0</span>):</span><br><span class="line">            Aline.extend([<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line">        <span class="keyword">elif</span> (R[i][j] == <span class="number">1</span>):</span><br><span class="line">            Aline.extend([<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">        <span class="keyword">elif</span> (R[i][j] == <span class="number">2</span>):</span><br><span class="line">            Aline.extend([<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line">    A.append(Aline)</span><br><span class="line">    b.append(bline)</span><br><span class="line"></span><br><span class="line">A = matrix(GF(<span class="number">2</span>), A)</span><br><span class="line">b = vector(GF(<span class="number">2</span>), b)</span><br><span class="line">x = A.solve_right(b)</span><br><span class="line"><span class="comment">#print(x)</span></span><br><span class="line"></span><br><span class="line">ans = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    <span class="keyword">if</span> (x[<span class="number">3</span>*i] == <span class="number">1</span>) <span class="keyword">and</span> (x[<span class="number">3</span>*i+<span class="number">1</span>] == <span class="number">0</span>) <span class="keyword">and</span> (x[<span class="number">3</span>*i+<span class="number">2</span>] == <span class="number">0</span>):</span><br><span class="line">        ans.append(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">elif</span> (x[<span class="number">3</span>*i] == <span class="number">0</span>) <span class="keyword">and</span> (x[<span class="number">3</span>*i+<span class="number">1</span>] == <span class="number">1</span>) <span class="keyword">and</span> (x[<span class="number">3</span>*i+<span class="number">2</span>] == <span class="number">0</span>):</span><br><span class="line">        ans.append(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">elif</span> (x[<span class="number">3</span>*i] == <span class="number">0</span>) <span class="keyword">and</span> (x[<span class="number">3</span>*i+<span class="number">1</span>] == <span class="number">0</span>) <span class="keyword">and</span> (x[<span class="number">3</span>*i+<span class="number">2</span>] == <span class="number">1</span>):</span><br><span class="line">        ans.append(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">elif</span> (x[<span class="number">3</span>*i] == <span class="number">1</span>) <span class="keyword">and</span> (x[<span class="number">3</span>*i+<span class="number">1</span>] == <span class="number">1</span>) <span class="keyword">and</span> (x[<span class="number">3</span>*i+<span class="number">2</span>] == <span class="number">0</span>):</span><br><span class="line">        ans.append(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">ans = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> ans)</span><br><span class="line">ans = long_to_bytes(<span class="built_in">int</span>(ans, <span class="number">3</span>))</span><br><span class="line"><span class="built_in">print</span>(ans)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/a6ee3e0e.html" title="2023-CryptoCTF-wp-crypto">https://tangcuxiaojikuai.xyz/post/a6ee3e0e.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/5b8f1174.html" rel="prev" title="2024-BeginCTF-wp-crypto">
      <i class="fa fa-chevron-left"></i> 2024-BeginCTF-wp-crypto
    </a></div>
      <div class="post-nav-item">
    <a href="/post/7a9f0ad2.html" rel="next" title="2024-NSSCTF-Round-18-Basic-wp-crypto">
      2024-NSSCTF-Round-18-Basic-wp-crypto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#easy"><span class="nav-number">1.</span> <span class="nav-text">easy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Did-it"><span class="nav-number">1.1.</span> <span class="nav-text">Did it!</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Suction"><span class="nav-number">1.2.</span> <span class="nav-text">Suction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Blue-Office"><span class="nav-number">1.3.</span> <span class="nav-text">Blue Office</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#medium"><span class="nav-number">2.</span> <span class="nav-text">medium</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Derik"><span class="nav-number">2.1.</span> <span class="nav-text">Derik</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Barak"><span class="nav-number">2.2.</span> <span class="nav-text">Barak</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Risk"><span class="nav-number">2.3.</span> <span class="nav-text">Risk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Roldy"><span class="nav-number">2.4.</span> <span class="nav-text">Roldy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bertrand"><span class="nav-number">2.5.</span> <span class="nav-text">* Bertrand</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Insights"><span class="nav-number">2.6.</span> <span class="nav-text">Insights</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Resuction"><span class="nav-number">2.7.</span> <span class="nav-text">Resuction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Blobfish"><span class="nav-number">2.8.</span> <span class="nav-text">* Blobfish</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ASIv1"><span class="nav-number">2.9.</span> <span class="nav-text">ASIv1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TPSD"><span class="nav-number">2.10.</span> <span class="nav-text">* TPSD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Trex"><span class="nav-number">2.11.</span> <span class="nav-text">* Trex</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Keymoted"><span class="nav-number">2.12.</span> <span class="nav-text">Keymoted</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hard"><span class="nav-number">3.</span> <span class="nav-text">hard</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Big"><span class="nav-number">3.1.</span> <span class="nav-text">Big</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Marjan"><span class="nav-number">3.2.</span> <span class="nav-text">Marjan</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Byeween"><span class="nav-number">3.3.</span> <span class="nav-text">* Byeween</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vinefruit"><span class="nav-number">3.4.</span> <span class="nav-text">Vinefruit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shevid"><span class="nav-number">3.5.</span> <span class="nav-text">$ Shevid</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tough"><span class="nav-number">4.</span> <span class="nav-text">tough</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Slowsum"><span class="nav-number">4.1.</span> <span class="nav-text">* Slowsum</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ASIv2"><span class="nav-number">4.2.</span> <span class="nav-text">* ASIv2</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">63</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
