<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="和rec鏖战到半夜终于做出了ckks，算是锦上添花，恭喜NK拿到冠军！">
<meta property="og:type" content="article">
<meta property="og:title" content="2025-ACTF-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/d21bb624.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="和rec鏖战到半夜终于做出了ckks，算是锦上添花，恭喜NK拿到冠军！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/d21bb624/image-20250427221056551.png">
<meta property="article:published_time" content="2025-04-27T08:09:27.000Z">
<meta property="article:modified_time" content="2025-04-28T04:11:06.963Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tangcuxiaojikuai.xyz/post/d21bb624/image-20250427221056551.png">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/d21bb624.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2025-ACTF-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/d21bb624.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2025-ACTF-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-27 16:09:27" itemprop="dateCreated datePublished" datetime="2025-04-27T16:09:27+08:00">2025-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-28 12:11:06" itemprop="dateModified" datetime="2025-04-28T12:11:06+08:00">2025-04-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/d21bb624.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/d21bb624.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>和rec鏖战到半夜终于做出了ckks，算是锦上添花，恭喜NK拿到冠军！</p>
<p><img src="/post/d21bb624/image-20250427221056551.png" alt="image-20250427221056551"></p>
<span id="more"></span>
<h3 id="easy-log"><a href="#easy-log" class="headerlink" title="easy_log"></a>easy_log</h3><h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E@sy L0g</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long, isPrime</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">from</span> signal <span class="keyword">import</span> alarm</span><br><span class="line"></span><br><span class="line">Point = namedtuple(<span class="string">&quot;Point&quot;</span>, <span class="string">&quot;x y&quot;</span>)</span><br><span class="line">O = <span class="string">&quot;Origin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">point_addition</span>(<span class="params">P, Q, n</span>):</span><br><span class="line">	<span class="keyword">if</span> P == O:</span><br><span class="line">		<span class="keyword">return</span> Q</span><br><span class="line">	<span class="keyword">if</span> Q == O:</span><br><span class="line">		<span class="keyword">return</span> P</span><br><span class="line">	x = (P.x * Q.y + P.y * Q.x - P.x * Q.x) % n</span><br><span class="line">	y = (P.x * Q.x + P.y * Q.y) % n</span><br><span class="line">	<span class="keyword">return</span> Point(x, y)</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">double_and_add</span>(<span class="params">k, P, n</span>):</span><br><span class="line">	Q = P</span><br><span class="line">	R = O</span><br><span class="line">	<span class="keyword">while</span>(k &gt; <span class="number">0</span>):</span><br><span class="line">		<span class="keyword">if</span> k &amp; <span class="number">1</span>:</span><br><span class="line">			R = point_addition(R, Q, n)</span><br><span class="line">		k &gt;&gt;= <span class="number">1</span></span><br><span class="line">		Q = point_addition(Q, Q, n)</span><br><span class="line">	<span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	flag = f.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">50</span></span><br><span class="line">flag = urandom(randint(<span class="number">38</span>, <span class="number">48</span>)) + flag</span><br><span class="line">flag = flag + urandom(<span class="number">118</span> - <span class="built_in">len</span>(flag))</span><br><span class="line"></span><br><span class="line">flag1, flag2 = bytes_to_long(flag[:<span class="number">68</span>]), bytes_to_long(flag[<span class="number">68</span>:])</span><br><span class="line"></span><br><span class="line">n = <span class="number">0x231d5fa471913e79facfd95e9b874e2d499def420e0914fab5c9f87e71c2418d1194066bd8376aa8f02ef35c1926f73a46477cd4a88beae89ba575bb3e1b04271426c6706356dd8cd9aa742d7ad0343f8939bfd2110d45122929d29dc022da26551e1ed7000</span></span><br><span class="line">G1 = Point(<span class="number">0xf22b9343408c5857048a19150c8fb9fd44c25d7f6decabc10bf46a2250a128f0df15adc7b82c70c0acaf855c0e898b141c9c94ba8aef8b67ea298c6d9fd870ea70e1c4f8a1b595d15373dc6db25a4ecddf626a64f47beba5538b7f733e4aa0c4f1fd4c291d</span>, <span class="number">0x8d3264514b7fdbce97fbaedb33120c7889a1af59691a1947c2c7061347c091b0950ca36efaa704514004a988b9b87b24f5cebf2d1c7bef44ff172519e1a62eb62cde234c94bd0ab39375d7ddb42e044090c8db46d3f965ef7e4753bc41dac3b8b3ae0cdb57</span>)</span><br><span class="line">G2 = Point(<span class="number">0x81919777837d3e5065c6f7f6801fe29544180be9db2137f075f53ebb3307f917183c6fc9cdfc5d75977f7</span>, <span class="number">0xd1a586d6848caa3a5436a86d903516d83808ce2fa49c5fb3f183ecb855e961c7e816a7ba8f588ef947f19</span>)</span><br><span class="line"></span><br><span class="line">f1 = double_and_add(flag1, G1, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f1)</span><br><span class="line"></span><br><span class="line">alarm(<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag1 != <span class="built_in">int</span>(<span class="built_in">input</span>()):</span><br><span class="line">	exit()</span><br><span class="line"></span><br><span class="line">p = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> isPrime(p) <span class="keyword">and</span> p.bit_length() == <span class="number">400</span></span><br><span class="line"></span><br><span class="line">f2 = double_and_add(flag2, G2, p)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f2)</span><br></pre></td></tr></table></figure>
<p>题目给出了一套曲线点加和倍乘运算法则，在此基础上给出：</p>
<ul>
<li>一个作为模数的合数$n$</li>
<li>两个起始点$G_1, G_2$</li>
</ul>
<p>之后题目大概可以分为两个任务：</p>
<ol>
<li>靶机在$Z_n$下计算$f_1 \cdot G_1$并给出，要求30s内计算出$f_1$并发回给靶机</li>
<li>输入一个400bit的素数$p$，靶机在$Z_p$下计算$f_2 \cdot G_2$并给出</li>
</ol>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>可以看出这题就是要解决题目给定曲线上的ECDLP，而一般要根据点加和倍乘运算法则，先找出对应的曲线方程，然后找对应映射，题目才会更清晰一点。</p>
<p>然而实际上这题并不需要这样，首先上factordb可以查到$n$的分解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">0x231d5fa471913e79facfd95e9b874e2d499def420e0914fab5c9f87e71c2418d1194066bd8376aa8f02ef35c1926f73a46477cd4a88beae89ba575bb3e1b04271426c6706356dd8cd9aa742d7ad0343f8939bfd2110d45122929d29dc022da26551e1ed7000</span></span><br><span class="line">primes = [(<span class="number">2</span>, <span class="number">12</span>), (<span class="number">5</span>, <span class="number">4</span>), (<span class="number">15271784978279</span>, <span class="number">1</span>), (<span class="number">10714146599832792643</span>, <span class="number">1</span>), (<span class="number">222696442740376752383</span>, <span class="number">3</span>), (<span class="number">899889935029682511225429150065010811552017719005924136271659166808024139</span>, <span class="number">1</span>), (<span class="number">899889935029682511225429150065010811552017719005924136271659168643090431</span>, <span class="number">1</span>)]</span><br><span class="line"><span class="keyword">assert</span> n == prod([i[<span class="number">0</span>]^i[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> primes])</span><br></pre></td></tr></table></figure>
<p>由于题目提供了点加和倍乘运算，这使得我们可以在$n$的任意一个素因子$p$下自行计算点乘，而这个操作的意义在于我们可以手动试一下题目点群的阶，测试出点群的阶基本是$p-1$或$p^2-1$。</p>
<p>进一步检查所有$p-1$的因子，会发现光滑的因子很多，这说明可以直接利用题目的点加和倍乘手写一个pohlig hellman+bsgs的ECDLP求解即可。由于第一部分求解的$f_1$是544bit的数量级，而光滑因子乘积就有520bit出头，并且由于有一个$p^3$因子的存在，还可以用p-adic求出$p$下的dlp，所以比特数完全够了。</p>
<p>第二部分就更简单，构造一个$p-1$光滑的不行的$p$发过去，再本地再运行一次pohlig hellman+bsgs就能得到$f_2$。</p>
<h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><p>(最后交给rec手动交互去了，还有个<code>hashcash</code>的pow要过)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long, isPrime</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Point = namedtuple(<span class="string">&quot;Point&quot;</span>, <span class="string">&quot;x y&quot;</span>)</span><br><span class="line">O = <span class="string">&quot;Origin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">point_addition_Qp</span>(<span class="params">P, Q</span>):</span><br><span class="line">	<span class="keyword">if</span> P == O:</span><br><span class="line">		<span class="keyword">return</span> Q</span><br><span class="line">	<span class="keyword">if</span> Q == O:</span><br><span class="line">		<span class="keyword">return</span> P</span><br><span class="line">	x = (P.x * Q.y + P.y * Q.x - P.x * Q.x)</span><br><span class="line">	y = (P.x * Q.x + P.y * Q.y)</span><br><span class="line">	<span class="keyword">return</span> Point(x, y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">double_and_add_Qp</span>(<span class="params">k, P</span>):</span><br><span class="line">	Q = P</span><br><span class="line">	R = O</span><br><span class="line">	<span class="keyword">while</span>(k &gt; <span class="number">0</span>):</span><br><span class="line">		<span class="keyword">if</span> k &amp; <span class="number">1</span>:</span><br><span class="line">			R = point_addition_Qp(R, Q)</span><br><span class="line">		k &gt;&gt;= <span class="number">1</span></span><br><span class="line">		Q = point_addition_Qp(Q, Q,)</span><br><span class="line">	<span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">point_addition</span>(<span class="params">P, Q, n</span>):</span><br><span class="line">	<span class="keyword">if</span> P == O:</span><br><span class="line">		<span class="keyword">return</span> Q</span><br><span class="line">	<span class="keyword">if</span> Q == O:</span><br><span class="line">		<span class="keyword">return</span> P</span><br><span class="line">	x = (P.x * Q.y + P.y * Q.x - P.x * Q.x) % n</span><br><span class="line">	y = (P.x * Q.x + P.y * Q.y) % n</span><br><span class="line">	<span class="keyword">return</span> Point(x, y)</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">double_and_add</span>(<span class="params">k, P, n</span>):</span><br><span class="line">	Q = P</span><br><span class="line">	R = O</span><br><span class="line">	<span class="keyword">while</span>(k &gt; <span class="number">0</span>):</span><br><span class="line">		<span class="keyword">if</span> k &amp; <span class="number">1</span>:</span><br><span class="line">			R = point_addition(R, Q, n)</span><br><span class="line">		k &gt;&gt;= <span class="number">1</span></span><br><span class="line">		Q = point_addition(Q, Q, n)</span><br><span class="line">	<span class="keyword">return</span> R</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">0x231d5fa471913e79facfd95e9b874e2d499def420e0914fab5c9f87e71c2418d1194066bd8376aa8f02ef35c1926f73a46477cd4a88beae89ba575bb3e1b04271426c6706356dd8cd9aa742d7ad0343f8939bfd2110d45122929d29dc022da26551e1ed7000</span></span><br><span class="line">primes = [(<span class="number">2</span>, <span class="number">12</span>), (<span class="number">5</span>, <span class="number">4</span>), (<span class="number">15271784978279</span>, <span class="number">1</span>), (<span class="number">10714146599832792643</span>, <span class="number">1</span>), (<span class="number">222696442740376752383</span>, <span class="number">3</span>), (<span class="number">899889935029682511225429150065010811552017719005924136271659166808024139</span>, <span class="number">1</span>), (<span class="number">899889935029682511225429150065010811552017719005924136271659168643090431</span>, <span class="number">1</span>)]</span><br><span class="line"><span class="keyword">assert</span> n == prod([i[<span class="number">0</span>]^i[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> primes])</span><br><span class="line"></span><br><span class="line">G1 = Point(<span class="number">0xf22b9343408c5857048a19150c8fb9fd44c25d7f6decabc10bf46a2250a128f0df15adc7b82c70c0acaf855c0e898b141c9c94ba8aef8b67ea298c6d9fd870ea70e1c4f8a1b595d15373dc6db25a4ecddf626a64f47beba5538b7f733e4aa0c4f1fd4c291d</span>, <span class="number">0x8d3264514b7fdbce97fbaedb33120c7889a1af59691a1947c2c7061347c091b0950ca36efaa704514004a988b9b87b24f5cebf2d1c7bef44ff172519e1a62eb62cde234c94bd0ab39375d7ddb42e044090c8db46d3f965ef7e4753bc41dac3b8b3ae0cdb57</span>)</span><br><span class="line">G2 = Point(<span class="number">0x81919777837d3e5065c6f7f6801fe29544180be9db2137f075f53ebb3307f917183c6fc9cdfc5d75977f7</span>, <span class="number">0xd1a586d6848caa3a5436a86d903516d83808ce2fa49c5fb3f183ecb855e961c7e816a7ba8f588ef947f19</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">lift_to_pk</span>(<span class="params">p, G, kG</span>):</span><br><span class="line">    order_p = p^<span class="number">2</span> - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    QPP = Qp(p)</span><br><span class="line">    P_Qp = Point(QPP(G[<span class="number">0</span>] % p^<span class="number">2</span>), QPP(G[<span class="number">1</span>] % p^<span class="number">2</span>))</span><br><span class="line">    Q_Qp = Point(QPP(kG[<span class="number">0</span>] % p^<span class="number">2</span>), QPP(kG[<span class="number">1</span>] % p^<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    nP_Qp = double_and_add_Qp(order_p, P_Qp)</span><br><span class="line">    nQ_Qp = double_and_add_Qp(order_p, Q_Qp)</span><br><span class="line"></span><br><span class="line">    secret_p =  ZZ((-nQ_Qp[<span class="number">0</span>]/nQ_Qp[<span class="number">1</span>]) / (-nP_Qp[<span class="number">0</span>]/nP_Qp[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">return</span> secret_p % p</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bsgs</span>(<span class="params">G, kG, p, order</span>):</span><br><span class="line">    t = <span class="built_in">int</span>(sqrt(order))+<span class="number">2</span></span><br><span class="line">    dic = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    tG = double_and_add(t, G, p)</span><br><span class="line">    atG = Point(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">        dic[atG] = a</span><br><span class="line">        atG = point_addition(atG, tG, p)</span><br><span class="line">    </span><br><span class="line">    bG = kG</span><br><span class="line">    _G = double_and_add((-<span class="number">1</span>) % order, G, p)</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">        <span class="keyword">if</span>(bG <span class="keyword">in</span> dic.keys()):</span><br><span class="line">            <span class="keyword">return</span> t*dic[bG] + b</span><br><span class="line">        bG = point_addition(bG, _G, p)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pohlig_hellman</span>(<span class="params">G, kG, p, order</span>):</span><br><span class="line">    facs = <span class="built_in">list</span>(factor(order))</span><br><span class="line">    qs = []</span><br><span class="line">    ord_q = []</span><br><span class="line">    <span class="keyword">for</span> q, exp <span class="keyword">in</span> facs:</span><br><span class="line">        qs.append(q^exp)</span><br><span class="line">        ord_q.append(bsgs(double_and_add(order//(q^exp), G, p), double_and_add(order//(q^exp), kG, p), p, q^exp))</span><br><span class="line">    <span class="keyword">return</span> crt(ord_q, qs)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dlp</span>(<span class="params">G, kG</span>):</span><br><span class="line">    ps = []</span><br><span class="line">    ord_p = []</span><br><span class="line">    <span class="keyword">for</span> p, exp <span class="keyword">in</span> primes[<span class="number">2</span>:<span class="number">3</span>]:</span><br><span class="line">        ps.append(p-<span class="number">1</span>)</span><br><span class="line">        ord_p.append(pohlig_hellman(G, kG, p, p-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> p, exp <span class="keyword">in</span> primes[<span class="number">3</span>:<span class="number">4</span>]:</span><br><span class="line">        ps.append(p^<span class="number">2</span>-<span class="number">1</span>)</span><br><span class="line">        ord_p.append(pohlig_hellman(G, kG, p, p^<span class="number">2</span>-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> p, exp <span class="keyword">in</span> primes[<span class="number">4</span>:<span class="number">5</span>]:</span><br><span class="line">        ps.append(p^<span class="number">2</span>-<span class="number">1</span>)</span><br><span class="line">        ord_p.append(pohlig_hellman(G, kG, p, p^<span class="number">2</span>-<span class="number">1</span>))</span><br><span class="line">        ps.append(p)</span><br><span class="line">        ord_p.append(lift_to_pk(p, G, kG))</span><br><span class="line">    <span class="keyword">for</span> p, exp <span class="keyword">in</span> primes[<span class="number">6</span>:]:</span><br><span class="line">        ps.append(p-<span class="number">1</span>)</span><br><span class="line">        ord_p.append(pohlig_hellman(G, kG, p, p-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> crt(ord_p, ps), ps</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">k = getrandbits(<span class="number">540</span>)</span><br><span class="line">kG1 = double_and_add(k, G1, n)</span><br><span class="line">kk, ps = dlp(G1, kG1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(k % prod(ps) == kk)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ACTF&#123;OL#m9Lpg8D1$&lt;R3&amp;e=10g@1N%F^nQ02pKjgZo0Oo!$Mp&#125;</span><br></pre></td></tr></table></figure>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>虽然题目用不上曲线方程，但比赛中当然还是要靠方程清晰一下思路，这里正好分享一个比较通用的曲线方程插值法。</p>
<p>假设我们拥有足够多的曲线上点(这可以通过题目给的点加和倍乘做到)，那么可以假设曲线方程为下列向量的内积：</p>
<script type="math/tex; mode=display">
\mathbf{a} \cdot (x^d\;,\; x^{d-1}y\;,\; x^{d-2}y^2\;,\; \cdots\;,\; xy^{d-1}, y^d) = 0</script><p>其中$\mathbf{a}$就是曲线方程每个单项的未知系数组成的向量，因此实际上一个点对就可以提供一个向量方程，搜集足够的单项式向量之后解方程解出$\mathbf{a}$即可。</p>
<p>对于题目来说，可以对$G_2$的倍点应用插值，就可以发现他所在的方程是在$\mathbb{Z}$上成立的$x^2+xy-y^2+1 = 0$，这是一个圆锥曲线，所以不手写ECDLP的话可以去搜下这个圆锥曲线对应点群的映射。</p>
<p><br></p>
<p><br></p>
<h3 id="OhMyTetration"><a href="#OhMyTetration" class="headerlink" title="OhMyTetration"></a>OhMyTetration</h3><h4 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h4><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Welcome to my Lottery Center!</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> LotteryCenter, FLAG</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handler1</span>(<span class="params">signum, frame</span>):</span><br><span class="line">    <span class="keyword">raise</span> TimeoutError(<span class="string">&quot;You took too long to make a decision. The boss is not patient.&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handler2</span>(<span class="params">signum, frame</span>):</span><br><span class="line">    e = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Before I can react, a heavy hand clamps onto my shoulder. The boss&#x27;s face is dark with rage. &quot;What the hell did you do?!&quot;</span></span><br><span class="line"><span class="string">I stammer, &quot;I just thought the numbers could be luckier...&quot;</span></span><br><span class="line"><span class="string">&quot;OUT!&quot; he roars, dragging me toward the door. &quot;And don&#x27;t come back unless you&#x27;ve got the money to replace this thing!&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">raise</span> TimeoutError(e)</span><br><span class="line"></span><br><span class="line">x = bytes_to_long(FLAG)</span><br><span class="line"><span class="keyword">assert</span> x.bit_length() &lt;= <span class="number">512</span></span><br><span class="line"></span><br><span class="line">descrption = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">You step into the Lottery Center, the bell above the door rings softly as you enter. The air is stale, with an old fan humming above. The walls are lined with lottery posters and flashing numbers. At the counter, a middle-aged man in a dark suit is busy sorting through some papers, unaware of your presence.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The atmosphere is quiet and slightly unsettling. You glance around the room — a corner has an old lottery machine, still occasionally making a &quot;clicking&quot; noise. There&#x27;s a poster on the wall showing today&#x27;s lucky numbers, but they seem somewhat blurry.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(descrption)</span><br><span class="line"></span><br><span class="line">lotteryCenter = LotteryCenter()</span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">You&#x27;re left with a few choices:</span></span><br><span class="line"><span class="string">1. Talk to the Boss.</span></span><br><span class="line"><span class="string">2. Pick Your Lucky Number.</span></span><br><span class="line"><span class="string">3. Choose Your Bet Size.</span></span><br><span class="line"><span class="string">4. Look Around.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">signal.signal(signal.SIGALRM, handler1)</span><br><span class="line">signal.alarm(<span class="number">600</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(menu)</span><br><span class="line">    choice = <span class="built_in">input</span>(<span class="string">&quot;What do you do? &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> choice == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">        <span class="comment"># Choose my favourite number.</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;You approach the counter. The boss looks up briefly, then says in a low voice, \&quot;Today&#x27;s lucky number is <span class="subst">&#123;lotteryCenter.P&#125;</span>. Trust it, it will bring good luck.\&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">&quot;2&quot;</span>:</span><br><span class="line">        g = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;You decide to pick your own lucky number: &quot;</span>))</span><br><span class="line">        <span class="keyword">if</span> lotteryCenter.defineG(g):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;You successfully pick your lucky number.&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;You can&#x27;t pick that number.&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">&quot;3&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> lotteryCenter.g==<span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;You should pick your lucky number first.&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            times = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;You decide to pick your bet size: &quot;</span>))</span><br><span class="line">            <span class="keyword">assert</span> times&gt;<span class="number">0</span></span><br><span class="line">            ticket = lotteryCenter.tetration(times, x)</span><br><span class="line">            <span class="comment"># Calculate the tetration g^g^...^g(times)^x.</span></span><br><span class="line">            <span class="comment"># For example, P=23, g=3, tetration(3, 2) = 3^(3^(3^2)) % 23 = 12.</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;You take the ticket with the number <span class="subst">&#123;ticket&#125;</span> from the machine, feeling a slight chill in the air. The boss looks at you for a moment longer, his expression unreadable. Then, with a slow smile, he finally speaks, his voice low but clear:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\&quot;Good luck... I hope today is your lucky day.\&quot;&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">&quot;4&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The boss seems distracted — perhaps counting cash or sorting through stacks of old receipts, his back turned just enough. Seizing the moment, I slip around to the back of the lottery machine, my fingers hovering over the controls. A quiet smirk tugs at my lips as I mutter under my breath ...&quot;</span>)</span><br><span class="line">        lotteryCenter.P = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;I don&#x27;t think the boss&#x27;s lucky number is lucky enough: &quot;</span>))</span><br><span class="line">        <span class="keyword">assert</span> lotteryCenter.P&gt;<span class="number">1</span></span><br><span class="line">        x = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;\&quot;Yes!\&quot; I whisper, overriding the preset algorithm with my own: &quot;</span>))</span><br><span class="line">        g = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;You decide to pick your own lucky number: &quot;</span>))</span><br><span class="line">        times = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;You decide to pick your bet size: &quot;</span>))</span><br><span class="line">        <span class="keyword">assert</span> times&gt;<span class="number">0</span></span><br><span class="line">        signal.signal(signal.SIGALRM, handler2)</span><br><span class="line">        signal.alarm(<span class="number">10</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> lotteryCenter.defineG(g):</span><br><span class="line">                ticket = lotteryCenter.tetration(times, x)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;You take the ticket with the number <span class="subst">&#123;ticket&#125;</span> from the machine secretly.&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Oops! The lottery machine whirs weakly as I finish tampering with its settings — then suddenly, the screen flickers violently before dying with a pathetic click. A thin wisp of smoke curls from the vents.&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> TimeoutError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            signal.alarm(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Nothing here.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nYou exit the Lottery Center, the door closing softly behind you. The bell rings once more, leaving you standing outside, holding the ticket — unsure if you&#x27;ve just stepped into a stroke of luck... or something else entirely.&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>简单来说，题目将flag转化为小于等于512bit的大整数$x$，之后随机发送给你一个素数$p$，可以选择一个数字$g$和一个次数$t$发回给靶机，然后靶机计算：</p>
<script type="math/tex; mode=display">
f(t, g) = g^{g^{g^{\cdots(共t个g)^{x}}}} \quad (mod\;p)</script><p>要求从这个值计算出$x$得到flag，并且有一些没有明确说的额外条件：</p>
<ul>
<li>$p$并不是完全随机的素数，而是从给定的八个值里随便选的(反复重连测试了一下)</li>
<li>发送的$g$需要通过$defineG$函数的check，具体要求不详，但是极慢</li>
</ul>
<h4 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h4><p>首先，多次测试可以得出以下几个额外结论：</p>
<ul>
<li>有几个$p$满足$p-1=2q$，且$q-1$很光滑，基本是32bit的因子</li>
<li>$g$是素数似乎基本能通过$defineG$函数的check</li>
</ul>
<p>所以可以类似<a href="https://tangcuxiaojikuai.xyz/post/860541dc.html">数信杯的这道DDLLPP</a>，发送$t=2$以及$Z_q$乘法群中的低阶因子作为$g$，然后在已知$f(t, g)$和$g$的情况下bsgs求解$f(t, g) = g^{g^x}$中的子群意义下的$x$并crt起来即可。</p>
<h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><p>$defineG$函数的check实在太慢，接近十分钟才能check一次，有时候直接超时断掉，所以我和rec只能手动开好几个窗口来一个个接下来数据再bsgs，最后手动crt，所以我最后写的相当乱，就贴个rec的exp好了TT：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm, trange</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt, prod</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fuzz</span>():</span><br><span class="line">    p = <span class="number">7</span></span><br><span class="line">    x = <span class="number">233</span></span><br><span class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        io = remote(*<span class="string">&quot;1.95.137.123 9999&quot;</span>.split())</span><br><span class="line">        io.sendlineafter(<span class="string">b&#x27;What do you do? &#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">        io.sendlineafter(<span class="string">b&quot;I don&#x27;t think the boss&#x27;s lucky number is lucky enough: &quot;</span>, <span class="built_in">str</span>(p).encode())</span><br><span class="line">        io.sendlineafter(<span class="string">b&quot;with my own: &quot;</span>, <span class="built_in">str</span>(x).encode())</span><br><span class="line">        io.sendlineafter(<span class="string">b&quot;own lucky number: &quot;</span>, <span class="built_in">str</span>(g).encode())</span><br><span class="line">        io.sendlineafter(<span class="string">b&#x27;your bet size: &#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(g, <span class="string">&#x27;Oops&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> io.recvline().decode())</span><br><span class="line">        io.close()</span><br><span class="line">    exit()</span><br><span class="line"><span class="comment"># fuzz()</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">1502305675703953507826564356364207463785905265358954425050832597353379827611347779894929874274487297076504174110953417469304402049079223143080164648064147459</span></span><br><span class="line">q = (p - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">qs = [(<span class="number">2</span>, <span class="number">12</span>), (<span class="number">2449952539</span>, <span class="number">1</span>), (<span class="number">2580715139</span>, <span class="number">1</span>), (<span class="number">2792523953</span>, <span class="number">1</span>), (<span class="number">2945474351</span>, <span class="number">1</span>), (<span class="number">2996317717</span>, <span class="number">1</span>), (<span class="number">3172879987</span>, <span class="number">1</span>), (<span class="number">3229817321</span>, <span class="number">1</span>), (<span class="number">3272969519</span>, <span class="number">1</span>), (<span class="number">3435471803</span>, <span class="number">1</span>), (<span class="number">3606091481</span>, <span class="number">1</span>), (<span class="number">3613773421</span>, <span class="number">1</span>), (<span class="number">3696075863</span>, <span class="number">1</span>), (<span class="number">3706535681</span>, <span class="number">1</span>), (<span class="number">3729911617</span>, <span class="number">1</span>), (<span class="number">3912962413</span>, <span class="number">1</span>), (<span class="number">3919762169</span>, <span class="number">1</span>)]</span><br><span class="line"><span class="keyword">assert</span> q == prod(qi**i <span class="keyword">for</span> qi, i <span class="keyword">in</span> qs) + <span class="number">1</span></span><br><span class="line">qs = qs[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bsgs</span>(<span class="params">g, h, p, q, qi</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    y = g^(g^x mod q) mod p</span></span><br><span class="line"><span class="string">    let: x = a*m + b</span></span><br><span class="line"><span class="string">    g^(g^(a*m)) = g^(g^(x-b)) = g^(g^x*g^(-b)) = (g^(g^x))^(g^(-b))</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    m = <span class="built_in">int</span>(sqrt(qi)) + <span class="number">3</span></span><br><span class="line">    dic = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> trange(m + <span class="number">1</span>):</span><br><span class="line">        dic[<span class="built_in">pow</span>(g, <span class="number">2</span>*<span class="built_in">pow</span>(g, a*m, q), p)] = a</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> trange(m + <span class="number">1</span>):</span><br><span class="line">        t = <span class="built_in">pow</span>(h, <span class="number">2</span>*<span class="built_in">pow</span>(g, -b, q), p)</span><br><span class="line">        <span class="keyword">if</span> t <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">return</span> dic[t]*m + b</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># qi = qs[1][0]</span></span><br><span class="line"><span class="comment"># g = pow(2, (q-1)//qi, q)</span></span><br><span class="line"><span class="comment"># x = randint(0, qi-1)</span></span><br><span class="line"><span class="comment"># print(x)</span></span><br><span class="line"><span class="comment"># h = pow(g, pow(g, x, q), p)</span></span><br><span class="line"><span class="comment"># x = bsgs(g, h, p, q, qi)</span></span><br><span class="line"><span class="comment"># print(x)</span></span><br><span class="line"></span><br><span class="line">nums = <span class="built_in">list</span>()</span><br><span class="line">g = <span class="number">2</span></span><br><span class="line"><span class="comment"># for qi, _ in tqdm(qs[0:4]):</span></span><br><span class="line"><span class="comment"># for qi, _ in tqdm(qs[4:8]):</span></span><br><span class="line"><span class="comment"># for qi, _ in tqdm(qs[8:12]):</span></span><br><span class="line"><span class="keyword">for</span> qi, _ <span class="keyword">in</span> tqdm(qs[<span class="number">4</span>:<span class="number">8</span>][::-<span class="number">1</span>]):</span><br><span class="line">    times = <span class="number">2</span></span><br><span class="line">    gi = <span class="built_in">pow</span>(g, (q-<span class="number">1</span>)//qi, q)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        io = remote(*<span class="string">&quot;1.95.137.123 9999&quot;</span>.split())</span><br><span class="line">        <span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">        io.sendlineafter(<span class="string">b&#x27;What do you do? &#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">        io.recvuntil(<span class="string">b&quot;Today&#x27;s lucky number is &quot;</span>)</span><br><span class="line">        P = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;.&#x27;</span>)[:-<span class="number">1</span>].decode())</span><br><span class="line">        <span class="keyword">if</span> P == p:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        io.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        gi = <span class="built_in">pow</span>(gi, randint(<span class="number">1</span>, qi-<span class="number">1</span>), q)</span><br><span class="line">        <span class="keyword">if</span> isPrime(gi):</span><br><span class="line">            io.sendlineafter(<span class="string">b&#x27;What do you do? &#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">            io.sendlineafter(<span class="string">b&quot;You decide to pick your own lucky number: &quot;</span>, <span class="built_in">str</span>(gi).encode())</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;successfully&#x27;</span> <span class="keyword">in</span> io.recvline().decode():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;What do you do? &#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;You decide to pick your bet size: &quot;</span>, <span class="built_in">str</span>(times).encode())</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;You take the ticket with the number &#x27;</span>)</span><br><span class="line">    <span class="comment"># number = int(io.recvuntil(b&#x27;.&#x27;)[:-1].decode())</span></span><br><span class="line">    number = <span class="built_in">int</span>((io.recvuntil(<span class="string">b&#x27;.&#x27;</span>)[:-<span class="number">1</span>].split(<span class="string">b&quot; from the machine&quot;</span>)[<span class="number">0</span>]).decode())</span><br><span class="line">    nums.append((gi, number))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;qi = &#125;</span>\n<span class="subst">&#123;gi = &#125;</span>\n<span class="subst">&#123;number = &#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        xi = bsgs(gi, number, p, q, qi)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;xi = &#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    io.close()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;nums = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#Lucky won&#x27;t help you but wisdom can! ACTF&#123;0oooooh_My_T3tr@ti0n!&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="AAALLL"><a href="#AAALLL" class="headerlink" title="AAALLL"></a>AAALLL</h3><h4 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h4><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Let’s welcome AAA’s LLL master!</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice, sample</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_ternery_poly</span>(<span class="params">Q</span>):</span><br><span class="line">    <span class="keyword">return</span> Q([choice([-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(Q.degree())])</span><br><span class="line"></span><br><span class="line">n = <span class="number">450</span></span><br><span class="line">p = <span class="number">3774877201</span></span><br><span class="line">t = n//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">P.&lt;x&gt; = PolynomialRing(GF(p))</span><br><span class="line">g = x^n+<span class="number">1</span></span><br><span class="line">roots = [i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> g.roots()]</span><br><span class="line"></span><br><span class="line">subset = sample(roots, t)</span><br><span class="line"></span><br><span class="line">Q.&lt;x&gt; = P.quotient(x^n+<span class="number">1</span>)</span><br><span class="line">f = sample_ternery_poly(Q)</span><br><span class="line">f_lift = f.lift()</span><br><span class="line">values = [f_lift(i) <span class="keyword">for</span> i <span class="keyword">in</span> subset]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;subset: <span class="subst">&#123;subset&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;values: <span class="subst">&#123;values&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">key = md5(<span class="built_in">str</span>(f.<span class="built_in">list</span>()).encode()).digest()</span><br><span class="line">aes = AES.new(key = key, mode = AES.MODE_ECB)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ct: <span class="subst">&#123;aes.encrypt(pad(flag, <span class="number">16</span>))&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">subset: [1040018022, 3719840057, 2086762603, 3065369513, 3179320758, 891114580, 966265556, 664146925, 1232096603, 1449704729, 2810118429, 2891821810, 698162894, 3070228878, 3114653287, 2793650430, 2941920517, 1811454265, 325024118, 1860481904, 555392385, 2818572232, 3719972491, 981226771, 1777524396, 2717373523, 3694549306, 91210020, 1397236365, 2806262125, 1966653548, 1369610707, 3545263790, 595556443, 1601356313, 2865921937, 2795518764, 1690002428, 3501122295, 2078440315, 1222414863, 1997352805, 271758023, 3348936352, 1800648013, 410072905, 3378691273, 185134810, 1281817316, 821730517, 2855781188, 3353349707, 273754906, 1187616168, 569728457, 401428606, 3671298095, 149603298, 2300569286, 1057503678, 1915386614, 2716934671, 2005635066, 389589525, 2691165686, 586877133, 2874838, 660954102, 3258633701, 1083711515, 1785913794, 3410290851, 1914395297, 2544074509, 3076714307, 2169463229, 2654223166, 3648299978, 3188000068, 1130206965, 875184747, 2549126013, 3602874619, 80327895, 983400559, 2423201604, 3384400899, 654136379, 1835112234, 3302809337, 3388376496, 364586350, 3219484816, 52162306, 3488542302, 2843511894, 638341256, 427235375, 757491483, 3364804296, 172002582, 3112473265, 2746078509, 2118542465, 421527494, 3017385718, 3683667181, 3536621837, 3113923099, 1989065494, 1769242135, 1541932517, 1963422936, 2341204092, 3306256995, 186750428, 1381468653, 1288011784, 229613411, 839241230, 425544589, 2345390466, 2552462338, 286334899, 2984993503, 3741109364, 103579106, 138703348, 2369990075, 2377640836, 1279106009, 2542780598, 1653097443, 3373448595, 2405266494, 3385287676, 289622793, 2376573706, 3096235437, 1971476669, 3449853083, 3565565810, 762810383, 272826480, 516243500, 1710511548, 3233762177, 2013126070, 224313638, 1884110819, 3141861971, 2014729696, 1572103482, 2232944684, 2644670236, 1350302342, 3589742391, 2106163918, 1077036824, 3527373372, 2474464298, 971863088, 1219963894, 3349332612, 1474307915, 905651245, 2666266327, 2192845472, 2748042118, 1489782942, 1300412903, 126577223, 545427793, 360417066, 704648323, 3562938536, 908955264, 1108610874, 247503829, 2379959160, 1059927520, 2869225956, 2202773719, 1498564318, 2032958616, 3485254408, 1091224495, 3287849020, 780873181, 3410363615, 1398303495, 2426564739, 487028181, 1230802692, 139226346, 789883698, 2557862280, 2994004020, 3205148744, 2914199937, 1803400532, 2738281702, 883055391, 1761751131, 1220550272, 1947825121, 3543565567, 1939764967, 2986882625, 798323428, 1120654035, 3722714895, 3679983602, 364513586, 1760147505, 472067864, 2393408548, 2239781327, 799334306, 3497260623, 2769084221, 860677264, 990410164, 3772002363, 2883762621]</span></span><br><span class="line"><span class="string">values: [712538976, 1225537965, 2633482204, 1245652635, 2529155164, 1672980719, 3024410928, 1535384351, 2252244320, 672919726, 2976916118, 3089453551, 2512277279, 2431400831, 1129198075, 3441247454, 610984549, 2043949242, 3306515233, 2759625250, 2459507335, 2885552592, 3226187015, 983312810, 1815610133, 871259259, 3651562935, 570267317, 2548725905, 70380481, 685470168, 1925389996, 2466124957, 1512923993, 2603725653, 409457162, 859041441, 3193931087, 786021320, 2481319115, 2379423262, 1972220678, 251474531, 448830331, 3189297419, 845468707, 3014186402, 1476144624, 1412175603, 464556671, 1251535251, 2252149066, 3501165225, 1173484383, 1168113959, 2547845342, 3132683037, 182880838, 3236782773, 637440805, 1077834200, 910992912, 1281164705, 763525563, 1025793488, 3031918542, 2457090411, 159146268, 3252417067, 1695150089, 1863899429, 2660689081, 647461624, 3736679821, 2034134877, 973654854, 1545264273, 692989149, 769387639, 2024000598, 2916906076, 1996631367, 2889527392, 527082343, 3319918691, 3629378248, 685639382, 2659312228, 472574946, 1237496521, 434512296, 3649895972, 3500730074, 1092276151, 1513927060, 1179642291, 474879861, 1132457849, 3072787035, 1536862618, 3131879287, 1635514910, 2467715064, 2377496874, 2888951190, 3697148067, 1885811970, 1037114846, 2862197847, 2248493059, 829223452, 17390497, 1063920331, 2504310664, 2269937803, 667770896, 1855657371, 323906741, 2972650844, 3620395133, 2613325861, 2508686438, 2143229100, 977352912, 3380653143, 2367018411, 1665354812, 2473914413, 3531805346, 2023595772, 1909192693, 844059686, 2233570033, 1997039839, 3558799006, 2872633369, 1949018254, 3159312415, 3021409934, 2505867881, 2357897866, 3436059930, 1496867815, 594001374, 3433203342, 2396280741, 2696363547, 1775021594, 434891096, 862244228, 1372573410, 3003385341, 3051290794, 493688483, 2143128679, 394087901, 3668481745, 1085467544, 2438896216, 1782052147, 2415529482, 149721114, 1539904401, 1902915995, 1929333694, 1759980967, 2106193398, 3670877657, 2736025727, 3133082490, 182590224, 1099952929, 3522052498, 2206338880, 1925988633, 3440533747, 25471854, 325651518, 72348028, 3178620735, 3335468600, 818634602, 2932340363, 1163855672, 2453716531, 373827915, 2373018915, 2231504345, 2975884007, 3636085022, 2354093635, 2696203979, 799834661, 2412088324, 1446875965, 3299868618, 302142905, 1957341475, 1522953201, 1257060525, 3769499753, 1591149900, 295691418, 3249943297, 1280379656, 1164820140, 115871117, 219831260, 2505969457, 2618672354, 2781617927, 2886486193, 1648555579, 1265576372, 1720183485, 2424145699, 2772052592, 2399827477, 626825210, 2422432913, 322266950, 2157976175, 2208875362, 2216568965, 3223085486]</span></span><br><span class="line"><span class="string">ct: b&#x27;&quot;\xf2Y\xf0\x15\xc5x\x94\xb9E\xbd\xd3\xa7\xb1\xad\x00\xa2D*+\x87BQ_20\x87\xa2\nP\xfc\xce\x0eW\xaf\xd8-.\xb5\xfai\xf1\xf6*\xben^\xd5&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>题目给出一个$Q = \frac{Z_p[x]}{x^{450}+1}$下的-1，0，1三值多项式$f(x)$，并随机抽取$Z_p$下$x^{450}+1=0$的其中225个根$g_i$，给出所有$(g_i,f(g_i))$，要求还原出三值多项式$f(x)$，从而解AES得到flag。</p>
<h4 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h4><p>不妨记$f(x)$的系数向量为$\mathbf{s}$，由拉格朗日插值的矩阵方程，225个点值可列出一个矩阵方程$\mathbf{s}_{1\times 450}A_{450\times 225} = \mathbf{b}_{1\times 225}$，并且可以拆成$\mathbf{s}_1A_1 + \mathbf{s}_2A_2 = \mathbf{b}$，最终可移项化简为$\mathbf{s}_1A_1A_2^{-1} + \mathbf{s}_2 = \mathbf{b}A_2^{-1}$。利用$\mathbf{s}$为短向量的特点，可以构造格：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix} 1 & 0 & -A_1A_2^{-1} \\ 0 & 1 & \mathbf{b}A_2^{-1} \\ 0 & 0 & p \end{matrix}\right) \quad \quad \rightarrow  \quad \quad (\mathbf{s}_1, 1, \mathbf{k}) \left(\begin{matrix} 1 & 0 & -A_1A_2^{-1} \\ 0 & 1 & \mathbf{b}A_2^{-1} \\ 0 & 0 & p \end{matrix}\right) = (\mathbf{s}_1, 1, \mathbf{s}_2)</script><p>如果将约束全部取上，则该格的维数为451维，并且由于模数较大、向量极短，可以少取很多组约束并flatter求解。经测试取140组约束即可在几分钟内可以规约出$\mathbf{s}_1$，代入求解$\mathbf{s}_2$即可拼起来得到$f(x)$。</p>
<h4 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> check_output</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flatter</span>(<span class="params">M</span>):</span><br><span class="line">    <span class="comment"># compile https://github.com/keeganryan/flatter and put it in $PATH</span></span><br><span class="line">    z = <span class="string">&quot;[[&quot;</span> + <span class="string">&quot;]\n[&quot;</span>.join(<span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, row)) <span class="keyword">for</span> row <span class="keyword">in</span> M) + <span class="string">&quot;]]&quot;</span></span><br><span class="line">    ret = check_output([<span class="string">&quot;flatter&quot;</span>], <span class="built_in">input</span>=z.encode())</span><br><span class="line">    <span class="keyword">return</span> matrix(M.nrows(), M.ncols(), <span class="built_in">map</span>(<span class="built_in">int</span>, findall(<span class="string">b&quot;-?\\d+&quot;</span>, ret)))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">n = <span class="number">450</span></span><br><span class="line">p = <span class="number">3774877201</span></span><br><span class="line">subset = [<span class="number">1040018022</span>, <span class="number">3719840057</span>, <span class="number">2086762603</span>, <span class="number">3065369513</span>, <span class="number">3179320758</span>, <span class="number">891114580</span>, <span class="number">966265556</span>, <span class="number">664146925</span>, <span class="number">1232096603</span>, <span class="number">1449704729</span>, <span class="number">2810118429</span>, <span class="number">2891821810</span>, <span class="number">698162894</span>, <span class="number">3070228878</span>, <span class="number">3114653287</span>, <span class="number">2793650430</span>, <span class="number">2941920517</span>, <span class="number">1811454265</span>, <span class="number">325024118</span>, <span class="number">1860481904</span>, <span class="number">555392385</span>, <span class="number">2818572232</span>, <span class="number">3719972491</span>, <span class="number">981226771</span>, <span class="number">1777524396</span>, <span class="number">2717373523</span>, <span class="number">3694549306</span>, <span class="number">91210020</span>, <span class="number">1397236365</span>, <span class="number">2806262125</span>, <span class="number">1966653548</span>, <span class="number">1369610707</span>, <span class="number">3545263790</span>, <span class="number">595556443</span>, <span class="number">1601356313</span>, <span class="number">2865921937</span>, <span class="number">2795518764</span>, <span class="number">1690002428</span>, <span class="number">3501122295</span>, <span class="number">2078440315</span>, <span class="number">1222414863</span>, <span class="number">1997352805</span>, <span class="number">271758023</span>, <span class="number">3348936352</span>, <span class="number">1800648013</span>, <span class="number">410072905</span>, <span class="number">3378691273</span>, <span class="number">185134810</span>, <span class="number">1281817316</span>, <span class="number">821730517</span>, <span class="number">2855781188</span>, <span class="number">3353349707</span>, <span class="number">273754906</span>, <span class="number">1187616168</span>, <span class="number">569728457</span>, <span class="number">401428606</span>, <span class="number">3671298095</span>, <span class="number">149603298</span>, <span class="number">2300569286</span>, <span class="number">1057503678</span>, <span class="number">1915386614</span>, <span class="number">2716934671</span>, <span class="number">2005635066</span>, <span class="number">389589525</span>, <span class="number">2691165686</span>, <span class="number">586877133</span>, <span class="number">2874838</span>, <span class="number">660954102</span>, <span class="number">3258633701</span>, <span class="number">1083711515</span>, <span class="number">1785913794</span>, <span class="number">3410290851</span>, <span class="number">1914395297</span>, <span class="number">2544074509</span>, <span class="number">3076714307</span>, <span class="number">2169463229</span>, <span class="number">2654223166</span>, <span class="number">3648299978</span>, <span class="number">3188000068</span>, <span class="number">1130206965</span>, <span class="number">875184747</span>, <span class="number">2549126013</span>, <span class="number">3602874619</span>, <span class="number">80327895</span>, <span class="number">983400559</span>, <span class="number">2423201604</span>, <span class="number">3384400899</span>, <span class="number">654136379</span>, <span class="number">1835112234</span>, <span class="number">3302809337</span>, <span class="number">3388376496</span>, <span class="number">364586350</span>, <span class="number">3219484816</span>, <span class="number">52162306</span>, <span class="number">3488542302</span>, <span class="number">2843511894</span>, <span class="number">638341256</span>, <span class="number">427235375</span>, <span class="number">757491483</span>, <span class="number">3364804296</span>, <span class="number">172002582</span>, <span class="number">3112473265</span>, <span class="number">2746078509</span>, <span class="number">2118542465</span>, <span class="number">421527494</span>, <span class="number">3017385718</span>, <span class="number">3683667181</span>, <span class="number">3536621837</span>, <span class="number">3113923099</span>, <span class="number">1989065494</span>, <span class="number">1769242135</span>, <span class="number">1541932517</span>, <span class="number">1963422936</span>, <span class="number">2341204092</span>, <span class="number">3306256995</span>, <span class="number">186750428</span>, <span class="number">1381468653</span>, <span class="number">1288011784</span>, <span class="number">229613411</span>, <span class="number">839241230</span>, <span class="number">425544589</span>, <span class="number">2345390466</span>, <span class="number">2552462338</span>, <span class="number">286334899</span>, <span class="number">2984993503</span>, <span class="number">3741109364</span>, <span class="number">103579106</span>, <span class="number">138703348</span>, <span class="number">2369990075</span>, <span class="number">2377640836</span>, <span class="number">1279106009</span>, <span class="number">2542780598</span>, <span class="number">1653097443</span>, <span class="number">3373448595</span>, <span class="number">2405266494</span>, <span class="number">3385287676</span>, <span class="number">289622793</span>, <span class="number">2376573706</span>, <span class="number">3096235437</span>, <span class="number">1971476669</span>, <span class="number">3449853083</span>, <span class="number">3565565810</span>, <span class="number">762810383</span>, <span class="number">272826480</span>, <span class="number">516243500</span>, <span class="number">1710511548</span>, <span class="number">3233762177</span>, <span class="number">2013126070</span>, <span class="number">224313638</span>, <span class="number">1884110819</span>, <span class="number">3141861971</span>, <span class="number">2014729696</span>, <span class="number">1572103482</span>, <span class="number">2232944684</span>, <span class="number">2644670236</span>, <span class="number">1350302342</span>, <span class="number">3589742391</span>, <span class="number">2106163918</span>, <span class="number">1077036824</span>, <span class="number">3527373372</span>, <span class="number">2474464298</span>, <span class="number">971863088</span>, <span class="number">1219963894</span>, <span class="number">3349332612</span>, <span class="number">1474307915</span>, <span class="number">905651245</span>, <span class="number">2666266327</span>, <span class="number">2192845472</span>, <span class="number">2748042118</span>, <span class="number">1489782942</span>, <span class="number">1300412903</span>, <span class="number">126577223</span>, <span class="number">545427793</span>, <span class="number">360417066</span>, <span class="number">704648323</span>, <span class="number">3562938536</span>, <span class="number">908955264</span>, <span class="number">1108610874</span>, <span class="number">247503829</span>, <span class="number">2379959160</span>, <span class="number">1059927520</span>, <span class="number">2869225956</span>, <span class="number">2202773719</span>, <span class="number">1498564318</span>, <span class="number">2032958616</span>, <span class="number">3485254408</span>, <span class="number">1091224495</span>, <span class="number">3287849020</span>, <span class="number">780873181</span>, <span class="number">3410363615</span>, <span class="number">1398303495</span>, <span class="number">2426564739</span>, <span class="number">487028181</span>, <span class="number">1230802692</span>, <span class="number">139226346</span>, <span class="number">789883698</span>, <span class="number">2557862280</span>, <span class="number">2994004020</span>, <span class="number">3205148744</span>, <span class="number">2914199937</span>, <span class="number">1803400532</span>, <span class="number">2738281702</span>, <span class="number">883055391</span>, <span class="number">1761751131</span>, <span class="number">1220550272</span>, <span class="number">1947825121</span>, <span class="number">3543565567</span>, <span class="number">1939764967</span>, <span class="number">2986882625</span>, <span class="number">798323428</span>, <span class="number">1120654035</span>, <span class="number">3722714895</span>, <span class="number">3679983602</span>, <span class="number">364513586</span>, <span class="number">1760147505</span>, <span class="number">472067864</span>, <span class="number">2393408548</span>, <span class="number">2239781327</span>, <span class="number">799334306</span>, <span class="number">3497260623</span>, <span class="number">2769084221</span>, <span class="number">860677264</span>, <span class="number">990410164</span>, <span class="number">3772002363</span>, <span class="number">2883762621</span>]</span><br><span class="line">values = [<span class="number">712538976</span>, <span class="number">1225537965</span>, <span class="number">2633482204</span>, <span class="number">1245652635</span>, <span class="number">2529155164</span>, <span class="number">1672980719</span>, <span class="number">3024410928</span>, <span class="number">1535384351</span>, <span class="number">2252244320</span>, <span class="number">672919726</span>, <span class="number">2976916118</span>, <span class="number">3089453551</span>, <span class="number">2512277279</span>, <span class="number">2431400831</span>, <span class="number">1129198075</span>, <span class="number">3441247454</span>, <span class="number">610984549</span>, <span class="number">2043949242</span>, <span class="number">3306515233</span>, <span class="number">2759625250</span>, <span class="number">2459507335</span>, <span class="number">2885552592</span>, <span class="number">3226187015</span>, <span class="number">983312810</span>, <span class="number">1815610133</span>, <span class="number">871259259</span>, <span class="number">3651562935</span>, <span class="number">570267317</span>, <span class="number">2548725905</span>, <span class="number">70380481</span>, <span class="number">685470168</span>, <span class="number">1925389996</span>, <span class="number">2466124957</span>, <span class="number">1512923993</span>, <span class="number">2603725653</span>, <span class="number">409457162</span>, <span class="number">859041441</span>, <span class="number">3193931087</span>, <span class="number">786021320</span>, <span class="number">2481319115</span>, <span class="number">2379423262</span>, <span class="number">1972220678</span>, <span class="number">251474531</span>, <span class="number">448830331</span>, <span class="number">3189297419</span>, <span class="number">845468707</span>, <span class="number">3014186402</span>, <span class="number">1476144624</span>, <span class="number">1412175603</span>, <span class="number">464556671</span>, <span class="number">1251535251</span>, <span class="number">2252149066</span>, <span class="number">3501165225</span>, <span class="number">1173484383</span>, <span class="number">1168113959</span>, <span class="number">2547845342</span>, <span class="number">3132683037</span>, <span class="number">182880838</span>, <span class="number">3236782773</span>, <span class="number">637440805</span>, <span class="number">1077834200</span>, <span class="number">910992912</span>, <span class="number">1281164705</span>, <span class="number">763525563</span>, <span class="number">1025793488</span>, <span class="number">3031918542</span>, <span class="number">2457090411</span>, <span class="number">159146268</span>, <span class="number">3252417067</span>, <span class="number">1695150089</span>, <span class="number">1863899429</span>, <span class="number">2660689081</span>, <span class="number">647461624</span>, <span class="number">3736679821</span>, <span class="number">2034134877</span>, <span class="number">973654854</span>, <span class="number">1545264273</span>, <span class="number">692989149</span>, <span class="number">769387639</span>, <span class="number">2024000598</span>, <span class="number">2916906076</span>, <span class="number">1996631367</span>, <span class="number">2889527392</span>, <span class="number">527082343</span>, <span class="number">3319918691</span>, <span class="number">3629378248</span>, <span class="number">685639382</span>, <span class="number">2659312228</span>, <span class="number">472574946</span>, <span class="number">1237496521</span>, <span class="number">434512296</span>, <span class="number">3649895972</span>, <span class="number">3500730074</span>, <span class="number">1092276151</span>, <span class="number">1513927060</span>, <span class="number">1179642291</span>, <span class="number">474879861</span>, <span class="number">1132457849</span>, <span class="number">3072787035</span>, <span class="number">1536862618</span>, <span class="number">3131879287</span>, <span class="number">1635514910</span>, <span class="number">2467715064</span>, <span class="number">2377496874</span>, <span class="number">2888951190</span>, <span class="number">3697148067</span>, <span class="number">1885811970</span>, <span class="number">1037114846</span>, <span class="number">2862197847</span>, <span class="number">2248493059</span>, <span class="number">829223452</span>, <span class="number">17390497</span>, <span class="number">1063920331</span>, <span class="number">2504310664</span>, <span class="number">2269937803</span>, <span class="number">667770896</span>, <span class="number">1855657371</span>, <span class="number">323906741</span>, <span class="number">2972650844</span>, <span class="number">3620395133</span>, <span class="number">2613325861</span>, <span class="number">2508686438</span>, <span class="number">2143229100</span>, <span class="number">977352912</span>, <span class="number">3380653143</span>, <span class="number">2367018411</span>, <span class="number">1665354812</span>, <span class="number">2473914413</span>, <span class="number">3531805346</span>, <span class="number">2023595772</span>, <span class="number">1909192693</span>, <span class="number">844059686</span>, <span class="number">2233570033</span>, <span class="number">1997039839</span>, <span class="number">3558799006</span>, <span class="number">2872633369</span>, <span class="number">1949018254</span>, <span class="number">3159312415</span>, <span class="number">3021409934</span>, <span class="number">2505867881</span>, <span class="number">2357897866</span>, <span class="number">3436059930</span>, <span class="number">1496867815</span>, <span class="number">594001374</span>, <span class="number">3433203342</span>, <span class="number">2396280741</span>, <span class="number">2696363547</span>, <span class="number">1775021594</span>, <span class="number">434891096</span>, <span class="number">862244228</span>, <span class="number">1372573410</span>, <span class="number">3003385341</span>, <span class="number">3051290794</span>, <span class="number">493688483</span>, <span class="number">2143128679</span>, <span class="number">394087901</span>, <span class="number">3668481745</span>, <span class="number">1085467544</span>, <span class="number">2438896216</span>, <span class="number">1782052147</span>, <span class="number">2415529482</span>, <span class="number">149721114</span>, <span class="number">1539904401</span>, <span class="number">1902915995</span>, <span class="number">1929333694</span>, <span class="number">1759980967</span>, <span class="number">2106193398</span>, <span class="number">3670877657</span>, <span class="number">2736025727</span>, <span class="number">3133082490</span>, <span class="number">182590224</span>, <span class="number">1099952929</span>, <span class="number">3522052498</span>, <span class="number">2206338880</span>, <span class="number">1925988633</span>, <span class="number">3440533747</span>, <span class="number">25471854</span>, <span class="number">325651518</span>, <span class="number">72348028</span>, <span class="number">3178620735</span>, <span class="number">3335468600</span>, <span class="number">818634602</span>, <span class="number">2932340363</span>, <span class="number">1163855672</span>, <span class="number">2453716531</span>, <span class="number">373827915</span>, <span class="number">2373018915</span>, <span class="number">2231504345</span>, <span class="number">2975884007</span>, <span class="number">3636085022</span>, <span class="number">2354093635</span>, <span class="number">2696203979</span>, <span class="number">799834661</span>, <span class="number">2412088324</span>, <span class="number">1446875965</span>, <span class="number">3299868618</span>, <span class="number">302142905</span>, <span class="number">1957341475</span>, <span class="number">1522953201</span>, <span class="number">1257060525</span>, <span class="number">3769499753</span>, <span class="number">1591149900</span>, <span class="number">295691418</span>, <span class="number">3249943297</span>, <span class="number">1280379656</span>, <span class="number">1164820140</span>, <span class="number">115871117</span>, <span class="number">219831260</span>, <span class="number">2505969457</span>, <span class="number">2618672354</span>, <span class="number">2781617927</span>, <span class="number">2886486193</span>, <span class="number">1648555579</span>, <span class="number">1265576372</span>, <span class="number">1720183485</span>, <span class="number">2424145699</span>, <span class="number">2772052592</span>, <span class="number">2399827477</span>, <span class="number">626825210</span>, <span class="number">2422432913</span>, <span class="number">322266950</span>, <span class="number">2157976175</span>, <span class="number">2208875362</span>, <span class="number">2216568965</span>, <span class="number">3223085486</span>]</span><br><span class="line">ct = <span class="string">b&#x27;&quot;\xf2Y\xf0\x15\xc5x\x94\xb9E\xbd\xd3\xa7\xb1\xad\x00\xa2D*+\x87BQ_20\x87\xa2\nP\xfc\xce\x0eW\xaf\xd8-.\xb5\xfai\xf1\xf6*\xben^\xd5&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">A = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n//<span class="number">2</span>):</span><br><span class="line">    A.append([<span class="built_in">pow</span>(subset[i], j, p) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)])</span><br><span class="line">A = Matrix(Zmod(p), A).T</span><br><span class="line">A1, A2 = A[:n//<span class="number">2</span>], A[n//<span class="number">2</span>:]</span><br><span class="line">A1_inv = A1^(-<span class="number">1</span>)</span><br><span class="line">b = vector(Zmod(p), values)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nums = <span class="number">140</span></span><br><span class="line">L = block_matrix(ZZ, [</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, -(A2*A1_inv)[:, :nums]],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, Matrix(ZZ, (b*A1_inv)[:nums])],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, p]</span><br><span class="line">])</span><br><span class="line"><span class="built_in">print</span>(L.dimensions())</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">L = flatter(L)</span><br><span class="line"><span class="built_in">print</span>(L[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">res = L[<span class="number">0</span>]</span><br><span class="line">s2 = vector(Zmod(p), res[:n//<span class="number">2</span>])</span><br><span class="line">s1 = s2*-(A2*A1_inv) + b*A1_inv</span><br><span class="line">s = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s1:</span><br><span class="line">    <span class="keyword">if</span>(i != <span class="number">0</span> <span class="keyword">and</span> i != <span class="number">1</span>):</span><br><span class="line">        s.append(-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s.append(<span class="built_in">int</span>(i))</span><br><span class="line">s += [i <span class="keyword">for</span> i <span class="keyword">in</span> res[:n//<span class="number">2</span>]]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">P.&lt;x&gt; = PolynomialRing(GF(p))</span><br><span class="line">Q.&lt;x&gt; = P.quotient(x^n+<span class="number">1</span>)</span><br><span class="line">g = x^n+<span class="number">1</span></span><br><span class="line">f = Q(s)</span><br><span class="line"><span class="built_in">print</span>([f.lift()(subset[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n//<span class="number">2</span>)] == values)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">key = md5(<span class="built_in">str</span>(f.<span class="built_in">list</span>()).encode()).digest()</span><br><span class="line">aes = AES.new(key = key, mode = AES.MODE_ECB)</span><br><span class="line"><span class="built_in">print</span>(aes.decrypt(ct))</span><br><span class="line"></span><br><span class="line"><span class="comment">#ACTF&#123;Pat141_V4nd3rrrrrm0000nd333_Pr000bl333m&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="其他-1"><a href="#其他-1" class="headerlink" title="其他"></a>其他</h4><p>但是这很显然是个非预期，原因有以下几个：</p>
<ul>
<li><p>一般来说，flatter似乎不太适用于这种-1、0、1的很小数量级的规约，只是这题模数大了一些，导致flatter比较适用</p>
<blockquote>
<p>要不是题目叫LLL估计真不会往flatter想，这种比较精确的一般都要BKZ</p>
</blockquote>
</li>
<li><p>题目给的不是随随便便的点值，而是$x^{450}+1=0$的根</p>
</li>
</ul>
<p>赛后和@rec、@hashhash、@yolbby讨论了一下，其中第二个条件相当关键，factor一下$x^{450}+1$，可以发现它拥有一些结构较特殊的因式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[x^<span class="number">2</span> + <span class="number">1</span>, x^<span class="number">6</span> + <span class="number">1</span>, x^<span class="number">10</span> + <span class="number">1</span>, x^<span class="number">18</span> + <span class="number">1</span>, x^<span class="number">30</span> + <span class="number">1</span>, x^<span class="number">50</span> + <span class="number">1</span>, x^<span class="number">90</span> + <span class="number">1</span>, x^<span class="number">150</span> + <span class="number">1</span>, x^<span class="number">450</span> + <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>由于在$Z_p$下，$x^{450}+1$拥有全部450个根$g_i$，这代表着他可以在$F_p$下展开成：</p>
<script type="math/tex; mode=display">
x^{450}+1 = (x-g_1)(x-g_2)\cdots(x-g_{450}) \quad(mod\;p)</script><p>而对于上面那些因式，比如$x^{150}+1$，这代表着$x^{150}+1$也可以写成其中某150个$(x-g_i)$的乘积，而对于这150个特殊的$g_i$来说，由于$g^{150}=-1$，因此其对应的范德蒙德矩阵行向量会出现正负号交替的循环，而此时则可以把对应的行向量三折叠，而系数向量$\mathbf{s}$的每个分量也就对应变成了$s_i - s_{i+150} + s_{i+300}$的形式，这就实现了降维。</p>
<p>而降维的意义在于，$s_i - s_{i+150} + s_{i+300}$这样的分量依然在$Z_p$下显得很小，所以可以规约出这样的所有三项和，这相当于在原来的$\mathbf{s}_{1\times 450}A_{450\times 225} = \mathbf{b}_{1\times 225}$这225个方程基础上，多出了150个新的方程，虽然一部分会是线性相关的，但是依然会有一部分多出来的线性无关的，这就可以让最后的格维数有所降低。</p>
<p>同理，对于$x^{90} + 1$，可以规约出所有五项和，这也可以多出一些方程，在有这些方程的基础上，$\mathbf{s}$的解空间维数就会下降很多，最后规约一个一百三四十维的矩阵即可。</p>
<p><br></p>
<p><br></p>
<h3 id="tinyCKKS"><a href="#tinyCKKS" class="headerlink" title="tinyCKKS"></a>tinyCKKS</h3><h4 id="题目-3"><a href="#题目-3" class="headerlink" title="题目"></a>题目</h4><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EE and ZZ. Isn’t it easy?</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">load(<span class="string">&quot;ckks.sage&quot;</span>)</span><br><span class="line"></span><br><span class="line">flag = os.getenv(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_poly</span>():</span><br><span class="line">    pattern = <span class="string">r&quot;^(.*?) over Z\[X\]/\(X\^(\d+)\+1\) modulo (\d+)$&quot;</span></span><br><span class="line"></span><br><span class="line">    poly = <span class="built_in">input</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">match</span> = re.<span class="keyword">match</span>(pattern, poly)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        poly_str, N_str, q_str = <span class="keyword">match</span>.groups()</span><br><span class="line">        N = <span class="built_in">int</span>(N_str)</span><br><span class="line">        q = <span class="built_in">int</span>(q_str)</span><br><span class="line">        <span class="keyword">return</span> polynomial(q, N, poly_str)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&quot;Input is not a valid polynomial&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_ct</span>(<span class="params">ct</span>):</span><br><span class="line">    <span class="built_in">print</span>(ct)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_ct</span>():</span><br><span class="line">    a = recv_poly()</span><br><span class="line">    b = recv_poly()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Ciphertext(a, b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_key</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">        send_ct(key[i])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Welcome to ACTF 2025!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Here is a tiny implementation of CKKS scheme.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;You can test by running module_test.sage.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Now let&#x27;s start the challenge.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    N = <span class="number">1024</span></span><br><span class="line">    p = <span class="number">947819</span></span><br><span class="line">    B = <span class="number">2</span></span><br><span class="line">    L = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    r = <span class="number">10</span></span><br><span class="line">    precision = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    debug = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    ckks = tinyCKKS(N, p, B, L, debug)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        plain = [<span class="built_in">round</span>(np.random.uniform(<span class="number">0</span>, r), precision) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N)]</span><br><span class="line">        pt = ckks.encode(plain)</span><br><span class="line">        ct = ckks.encrypt(pt)</span><br><span class="line">        target_pt = pt</span><br><span class="line"></span><br><span class="line">        send_ct(ct)</span><br><span class="line"></span><br><span class="line">        c = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;Please give me c: &quot;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> c == <span class="number">1</span>:</span><br><span class="line">            ccc = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;Please choose operations you want to perform: &quot;</span>))</span><br><span class="line">            <span class="keyword">assert</span> <span class="number">0</span> &lt;= ccc &lt;= <span class="number">4</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ccc == <span class="number">1</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Addition&quot;</span>)</span><br><span class="line">                plain1 = [<span class="built_in">round</span>(np.random.uniform(<span class="number">0</span>, r), precision) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N)]</span><br><span class="line">                pt1 = ckks.encode(plain1)</span><br><span class="line">                ct1 = ckks.encrypt(pt1)</span><br><span class="line">                send_ct(ct1)</span><br><span class="line">                target_pt += pt1</span><br><span class="line">            <span class="keyword">if</span> ccc == <span class="number">2</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Multiplication&quot;</span>)</span><br><span class="line">                plain1 = [<span class="built_in">round</span>(np.random.uniform(<span class="number">0</span>, r), precision) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N)]</span><br><span class="line">                pt1 = ckks.encode(plain1)</span><br><span class="line">                ct1 = ckks.encrypt(pt1)</span><br><span class="line">                send_ct(ct1)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;relin_key: &quot;</span>)</span><br><span class="line">                send_key(ckks.relin_key)</span><br><span class="line">                target_pt *= pt1</span><br><span class="line">                target_pt //= ckks.delta</span><br><span class="line">            <span class="keyword">if</span> ccc == <span class="number">3</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Key Switching&quot;</span>)</span><br><span class="line">                new_sk = sample_ternery_poly(ckks.Q)</span><br><span class="line">                ksk = ckks.gen_ksk(new_sk)</span><br><span class="line">                send_key(ksk)</span><br><span class="line">                target_pt = pt</span><br><span class="line">            <span class="keyword">if</span> ccc == <span class="number">4</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Galois&quot;</span>)</span><br><span class="line">                t = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;Please choose galois parameter:&quot;</span>)) % (<span class="number">2</span> * ckks.N)</span><br><span class="line">                <span class="keyword">assert</span> t % <span class="number">2</span> == <span class="number">1</span></span><br><span class="line">                galois_key = ckks.gen_galois_key(t)</span><br><span class="line">                send_key(galois_key)</span><br><span class="line">                target_pt = target_pt.mapping(t)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Please give me ct: &quot;</span>)</span><br><span class="line">            ct = recv_ct()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ccc == <span class="number">3</span>:</span><br><span class="line">                pt_decrypt = ckks.decrypt(ct, new_sk)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pt_decrypt = ckks.decrypt(ct)</span><br><span class="line"></span><br><span class="line">            new_plain = ckks.decode(pt_decrypt)</span><br><span class="line">            target_plain = ckks.decode(target_pt)</span><br><span class="line">            <span class="keyword">assert</span> <span class="built_in">all</span>([<span class="built_in">abs</span>(target_plain[i] - new_plain[i]) &lt;= <span class="number">0.5</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ckks.N)])</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;new_plain: &quot;</span>, new_plain)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ccc == <span class="number">2</span>:</span><br><span class="line">                ckks.reset()</span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Here you are: &quot;</span>)</span><br><span class="line">            origin_plain = ckks.decode(target_pt)</span><br><span class="line">            <span class="built_in">print</span>(origin_plain)</span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Do you know?&quot;</span>)</span><br><span class="line">            your_plain = recv_poly()</span><br><span class="line">            <span class="keyword">if</span> your_plain == target_pt:</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Bye...&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>这个题目本身文件比较多，所以我也不太能很简洁的描述清楚题目内容，还是要仔细读下他的所有内容才行。这里就直接进做法。</p>
<h4 id="思路-3"><a href="#思路-3" class="headerlink" title="思路"></a>思路</h4><p>审计代码，发现源码的distribution.sage部分存在一定漏洞：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> randbelow</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">load(<span class="string">&quot;poly.sage&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_gaussian_poly</span>(<span class="params">Q</span>):</span><br><span class="line">    q = Q.base_ring().cardinality()</span><br><span class="line">    N = Q.degree()</span><br><span class="line">    <span class="keyword">return</span> polynomial(q, N, Q([getrandbits(<span class="number">4</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(Q.degree()//<span class="number">2</span>)] + [-getrandbits(<span class="number">4</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(Q.degree()//<span class="number">2</span>)]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_uniform_poly</span>(<span class="params">Q</span>):</span><br><span class="line">    q = Q.base_ring().cardinality()</span><br><span class="line">    N = Q.degree()</span><br><span class="line">    <span class="keyword">return</span> polynomial(q, N, Q([np.random.choice([-<span class="number">1</span>, <span class="number">1</span>]) * randbelow(<span class="built_in">int</span>(q//<span class="number">2</span>)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(Q.degree())]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_ternery_poly</span>(<span class="params">Q</span>):</span><br><span class="line">    q = Q.base_ring().cardinality()</span><br><span class="line">    N = Q.degree()</span><br><span class="line">    <span class="keyword">return</span> polynomial(q, N, Q([np.random.choice([-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(Q.degree())]))</span><br></pre></td></tr></table></figure>
<p>这里比较突兀的地方在于高斯采样多项式的系数分布：</p>
<ul>
<li>用了<code>random</code>库的<code>getrandbits</code></li>
<li>前一半低次项系数为正，后一半高次项系数为负，并且没有shuffle</li>
<li>无论是后面的均匀分布多项式系数采样，还是-1,0,1三值多项式系数采样，都没有再使用<code>random</code>库的其他任何函数</li>
</ul>
<p>那么合理猜测这里的高斯采样是用来进行MT预测的，而主要是生成噪声e的时候会使用高斯采样，因此题目应该是想要想出办法泄露e并解出私钥，并向后继续预测e，从而得到我们需要发回的明文多项式。</p>
<p>但是赛中并没有看出哪里能泄露出e，甚至看不出哪里可以泄露e的任何分量的任何bit(因为不管怎么泄露，够19937bit就有机会)，所以没有在这方面继续下去。</p>
<p>而突破点依然在于MT，经过本地测试发现均匀分布的采样里有1024次<code>np.random.choice([-1, 1])</code>的采样，而经测试，这个采样实际上可以等价于MT意义下的<code>getrandbits(1)</code>，由此可以构建出一个解题思路：</p>
<ol>
<li>第一次交互，输入<code>c=1</code>，之后输入<code>ccc=3</code>或<code>ccc=4</code>，在生成<code>ksk</code>或<code>galois_key</code>时，会连续生成100个<code>sample_uniform_poly</code>采样的多项式<code>a</code></li>
<li>从<code>a</code>的各项系数是否小于<code>int(q//2)</code>，可以判断出<code>choice</code>究竟选了-1还是1，这等价于获得了1bit的MT的信息。100个<code>a</code>相当于提供了<code>102400=100*1024</code>bit的信息，远大于19937，所以完全足够</li>
<li>凑够19937个bit，从而获取<code>numpy.random</code>的初始624个state，从而可以向后预测。这一步可用102400bit中剩余的bit验证是否求解正确</li>
<li>第二次交互产生plain时，采用的依然是<code>numpy</code>内的函数<code>plain = [round(np.random.uniform(0, r), precision) for _ in range(N)]</code>，因此可以直接预测该明文对应的编码多项式，发送给靶机即获得flag。</li>
</ol>
<h4 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">load(<span class="string">&quot;ckks.sage&quot;</span>)</span><br><span class="line">load(<span class="string">&quot;poly.sage&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">strpoly_to_poly</span>(<span class="params">poly</span>):</span><br><span class="line">    pattern = <span class="string">r&quot;^(.*?) over Z\[X\]/\(X\^(\d+)\+1\) modulo (\d+)$&quot;</span></span><br><span class="line">    <span class="keyword">match</span> = re.<span class="keyword">match</span>(pattern, poly)</span><br><span class="line">    poly_str, N_str, q_str = <span class="keyword">match</span>.groups()</span><br><span class="line">    N = <span class="built_in">int</span>(N_str)</span><br><span class="line">    q = <span class="built_in">int</span>(q_str)</span><br><span class="line">    <span class="keyword">return</span> polynomial(q, N, poly_str)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_ct_to_strpoly</span>(<span class="params">line</span>):</span><br><span class="line">    ct = (line.strip().decode()[<span class="number">4</span>:]).split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">    a, b = ct[<span class="number">0</span>][<span class="number">1</span>:], ct[<span class="number">1</span>][:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> a, b</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poly_str_to_coeffs</span>(<span class="params">poly_str</span>):</span><br><span class="line">    poly_str = poly_str.split(<span class="string">&#x27; over &#x27;</span>)[<span class="number">0</span>]  <span class="comment"># 去掉 over 后面</span></span><br><span class="line">    poly_str = poly_str.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>)    <span class="comment"># 去掉空格</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 切出所有项</span></span><br><span class="line">    terms = re.findall(<span class="string">r&#x27;[+-]?\d+\*X\^\d+|[+-]?\d+\*X|[+-]?\d+&#x27;</span>, poly_str)</span><br><span class="line"></span><br><span class="line">    max_degree = <span class="number">1023</span></span><br><span class="line">    coeffs = [<span class="number">0</span>] * (max_degree + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> term <span class="keyword">in</span> terms:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;*X^&#x27;</span> <span class="keyword">in</span> term:  <span class="comment"># a*X^b</span></span><br><span class="line">            coef_str, exp_str = term.split(<span class="string">&#x27;*X^&#x27;</span>)</span><br><span class="line">            coef = <span class="built_in">int</span>(coef_str)</span><br><span class="line">            exp = <span class="built_in">int</span>(exp_str)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;*X&#x27;</span> <span class="keyword">in</span> term:  <span class="comment"># a*X</span></span><br><span class="line">            coef_str = term.replace(<span class="string">&#x27;*X&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            coef = <span class="built_in">int</span>(coef_str)</span><br><span class="line">            exp = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 常数</span></span><br><span class="line">            coef = <span class="built_in">int</span>(term)</span><br><span class="line">            exp = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        coeffs[exp] = coef</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> coeffs</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(L.rank())</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decision</span>(<span class="params">coeffs, q</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1</span> <span class="keyword">if</span> i &lt; q // <span class="number">2</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> coeffs]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&quot;critical&quot;</span></span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;118.178.193.68&quot;</span>, <span class="number">9999</span>)</span><br><span class="line"><span class="comment">#sh = process([&quot;sage&quot;, &quot;main.sage&quot;])</span></span><br><span class="line">sh.recvuntil(<span class="string">b&quot;Now let&#x27;s start the challenge.\n&quot;</span>)</span><br><span class="line">a, b = convert_ct_to_strpoly(sh.recvline())</span><br><span class="line"></span><br><span class="line">p = <span class="number">947819</span></span><br><span class="line">q = p^<span class="number">5</span></span><br><span class="line">t = <span class="number">100</span></span><br><span class="line">lines = []</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>):</span><br><span class="line">    sh.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;Please choose operations you want to perform: &quot;</span>)</span><br><span class="line">    sh.sendline(<span class="string">b&quot;4&quot;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;Please choose galois parameter:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">        lines.append(sh.recvline())</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> lines:</span><br><span class="line">        c.append(convert_ct_to_strpoly(l))</span><br><span class="line">    lines = []</span><br><span class="line"></span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;Please give me ct: &quot;</span>)</span><br><span class="line">    sh.sendline(a.encode())</span><br><span class="line">    sh.sendline(b.encode())</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">a_bit = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    a_bit += decision(poly_str_to_coeffs(i[<span class="number">0</span>]), q)</span><br><span class="line">R = vector(GF(<span class="number">2</span>), a_bit[:<span class="number">19937</span>])</span><br><span class="line">res = (KK_inv * R).<span class="built_in">list</span>()</span><br><span class="line">res = [res[<span class="number">0</span>]] + [<span class="number">0</span>]*<span class="number">31</span> + res[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">init = <span class="string">&quot;&quot;</span>.join(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">str</span>, res)))</span><br><span class="line">state = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">    state.append(<span class="built_in">int</span>(init[<span class="number">32</span>*i:<span class="number">32</span>*i+<span class="number">32</span>],<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">RNG1 = np.random</span><br><span class="line">RNG1.set_state((<span class="string">&#x27;MT19937&#x27;</span>, np.array(state), <span class="number">623</span>, <span class="number">0</span>, <span class="number">0.0</span>))</span><br><span class="line"></span><br><span class="line">aa_bit = [RNG1.choice([<span class="number">0</span>, <span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1024</span>*<span class="number">100</span>)]</span><br><span class="line"><span class="built_in">print</span>(aa_bit == a_bit)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">plain = [<span class="built_in">round</span>(np.random.uniform(<span class="number">0</span>, <span class="number">10</span>), <span class="number">4</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1024</span>)]</span><br><span class="line">plain_poly = [<span class="built_in">round</span>(plain[i] * p) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain))]</span><br><span class="line">poly = polynomial(q, <span class="number">1024</span>, plain_poly)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&quot;Please give me c: &quot;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;3&quot;</span>)</span><br><span class="line">sh.sendline(<span class="built_in">str</span>(poly).encode())</span><br><span class="line"><span class="built_in">print</span>(sh.recvline())</span><br><span class="line"><span class="built_in">print</span>(sh.recvline())</span><br><span class="line"><span class="built_in">print</span>(sh.recvline())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ACTF&#123;CcccckKkKkKkkKKsSSsS_CP4_s3cur1ty_14_1mp0rt4nt&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="其他-2"><a href="#其他-2" class="headerlink" title="其他"></a>其他</h4><p>但很显然这是个非预期，因为numpy之前是真没想过也能打MT，上一次这么震惊还是在@hashhash出的N1CTF的Matrix被sagemath的MT非预期掉XD。</p>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/d21bb624.html" title="2025-ACTF-wp-crypto">https://tangcuxiaojikuai.xyz/post/d21bb624.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/961bf02b.html" rel="prev" title="杭州-上海游记">
      <i class="fa fa-chevron-left"></i> 杭州-上海游记
    </a></div>
      <div class="post-nav-item">
    <a href="/post/14c043f8.html" rel="next" title="2025-R3CTF-r3tauq-wp-crypto">
      2025-R3CTF-r3tauq-wp-crypto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-log"><span class="nav-number">1.</span> <span class="nav-text">easy_log</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE"><span class="nav-number">1.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF"><span class="nav-number">1.2.</span> <span class="nav-text">思路</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exp"><span class="nav-number">1.3.</span> <span class="nav-text">exp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">1.4.</span> <span class="nav-text">其他</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OhMyTetration"><span class="nav-number">2.</span> <span class="nav-text">OhMyTetration</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-1"><span class="nav-number">2.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF-1"><span class="nav-number">2.2.</span> <span class="nav-text">思路</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exp-1"><span class="nav-number">2.3.</span> <span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AAALLL"><span class="nav-number">3.</span> <span class="nav-text">AAALLL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-2"><span class="nav-number">3.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF-2"><span class="nav-number">3.2.</span> <span class="nav-text">思路</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exp-2"><span class="nav-number">3.3.</span> <span class="nav-text">exp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96-1"><span class="nav-number">3.4.</span> <span class="nav-text">其他</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tinyCKKS"><span class="nav-number">4.</span> <span class="nav-text">tinyCKKS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-3"><span class="nav-number">4.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF-3"><span class="nav-number">4.2.</span> <span class="nav-text">思路</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exp-3"><span class="nav-number">4.3.</span> <span class="nav-text">exp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96-2"><span class="nav-number">4.4.</span> <span class="nav-text">其他</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">119</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tangcuxiaojikuai" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tangcuxiaojikuai" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
