<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="参与了Round18的出题工作，出了三道Ring，在这里记录一下这三个题目的做法。 出题的本意也是想详细介绍一下RLWE的攻击原理。">
<meta property="og:type" content="article">
<meta property="og:title" content="2024-NSSCTF-Round-18-Basic-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/7a9f0ad2.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="参与了Round18的出题工作，出了三道Ring，在这里记录一下这三个题目的做法。 出题的本意也是想详细介绍一下RLWE的攻击原理。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-02-14T09:51:49.000Z">
<meta property="article:modified_time" content="2024-12-23T15:36:36.849Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/7a9f0ad2.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2024-NSSCTF-Round-18-Basic-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/7a9f0ad2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2024-NSSCTF-Round-18-Basic-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-02-14 17:51:49" itemprop="dateCreated datePublished" datetime="2024-02-14T17:51:49+08:00">2024-02-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-12-23 23:36:36" itemprop="dateModified" datetime="2024-12-23T23:36:36+08:00">2024-12-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/7a9f0ad2.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/7a9f0ad2.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>参与了Round18的出题工作，出了三道Ring，在这里记录一下这三个题目的做法。</p>
<p>出题的本意也是想详细介绍一下RLWE的攻击原理。</p>
<span id="more"></span>
<h3 id="New-Year-Ring1"><a href="#New-Year-Ring1" class="headerlink" title="New Year Ring1"></a>New Year Ring1</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">新年用个新环！</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line">n = <span class="number">64</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) &lt; n</span><br><span class="line"></span><br><span class="line">PRp.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f = x^n+<span class="number">2024</span></span><br><span class="line">PR = PRp.quo(f)</span><br><span class="line"><span class="keyword">assert</span> f.is_irreducible()</span><br><span class="line"></span><br><span class="line">A = [randint(<span class="number">0</span>, p) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">E = [randint(-<span class="number">4</span>, <span class="number">4</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">S = [<span class="built_in">ord</span>(flag[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag))]</span><br><span class="line"></span><br><span class="line">B = PR(A)*PR(S)+PR(E)</span><br><span class="line"><span class="built_in">print</span>(A)</span><br><span class="line"><span class="built_in">print</span>(B.<span class="built_in">list</span>())</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line"><span class="comment">#[203211966212120647994404162543901058385, 113998159211311856163959557092243561040, 300945935078651395200612763362025786190, 289539358962072307485802285781112184506, 266860644401078099268835882620812059236, 109469988130078797414202659254940150397, 142193430695353860553837582452159920561, 163603443131512016589524436620766900399, 125570052004030843134707673404921516235, 289517595415670285587801685152176297797, 260336477592153246815046507549532230446, 89128330175853905837766718032373473126, 187717315035064338496744033397006646838, 47398231438108384695170959715078016751, 320133498675264306580441374518511607677, 289224545427213583554005441616103706530, 48124450498844786580485017131751952117, 139700877104641187048620578708689412417, 71574579434689200165233820726593943746, 138252394765364749010226318178055019086, 261521192680609185598298661488532314373, 226827408720691280529315243806063440819, 312302166514031202715929873278517388968, 41543713499646037109947736777306720313, 265649922622063773566846630839697709881, 243184423040946982395304999253912592156, 206198258022435934039803402480943364253, 26031203447491686152181680360833340987, 267200487804167757054737887061948559784, 301825292179107181769802726785989059100, 245678367957552191949253880949910260990, 171086126608355874606827637031412493750, 238890683861901290139689496391030872360, 22845910272546674819720769022817968767, 28421978727921425902205492605476665131, 171865962533483544755013698922220144571, 133361830829435140268114465077140337526, 86265129464226210912927536339928098681, 68669331909862762270788724935161403154, 201866646039120111937128925580825280486, 13363589230429215865126757180274178298, 17909430443917365585897023486940736171, 91757667623716596753047172893731203404, 46825614193892927425213536328954419018, 131552079476235333764480742173849445520, 235812708672214623030453261917981487844, 128419026868422646823814506658958018620, 165071194644940049087362229894395125949, 119007848732714973887391773573107966930, 142175857554093924103634649494868118501, 324116975329566500720942384202511507819, 145202961579339260969095793970625895397, 302068925092915352636494174062039213344, 204865812301701145536309778960425467197, 73204183646529021271666811846606597696, 305266620775559116657495389805588046145, 38573243820497560644612322159835262762, 204132117511623685134894865125985283485, 152661573492853637425833316355962196973, 234147606390346795925961511757446390699, 101214795511329059676976012743816028858, 45259554101612024332508390665659000501, 69808091348685800959727855379331581323, 96236770545429224235813571394198156104]</span></span><br><span class="line"><span class="comment">#[122276244512812151700561410687880152355, 288902265068638112029210922418017307765, 227157280930411828282688954386270375417, 51392889392439935890454046852827718770, 107818090106926819686128970258855341987, 39797693303511873260100821082668360148, 165165311283389310714977999739406590465, 145742713856100761940986808065029032102, 85681122792038178595571398323505588215, 161750232371529874705027252096297284499, 65492947650590100527727115268504178500, 158980937836523416847183159463389719119, 217622237154991741032187619647917235486, 214403448117831129512734472087177528755, 7203970244866082501778704003244517036, 209327947737263058848347484690330837593, 261471938052725575109694161428073566879, 290548445194039386389333379248698464710, 786777047021934678707520080022646500, 181116047323074255804762916647191259040, 321394759425138484862188864303222149962, 172828377940330639355360387538637264455, 66514389687485973164456706712404934406, 123351805496712587796702291879739918777, 52527849016391552904401277415521541344, 269082045250550515743652451127140175208, 46611178931314336386280465499464556662, 306738233577541073584072095728624359658, 27700046031756446145225137030746217892, 90225963569273234686624144350335934112, 67692467833088163585206113599832005433, 323500338166210082579512376483956531150, 268393735497552347113220159171930201434, 303137349721700995847836323480358301717, 37409490969034515063902941681541879806, 89987553043378360059649171549894177100, 177195833588614025644477178454034861283, 186453862621405866128018280976135392700, 134539827243365382868881776050914249090, 174423939567752183215031097600196039560, 141295420547653230540490506885038874517, 71077155156144579112947495766255667953, 219294250229364145810766028169964010349, 32511078113518753980651829431342417337, 303329577727497287329206502612155346064, 90557253357868638265309134765551619996, 274174517174776162629592599514881337711, 49932861529770838835799830915660452043, 12677314962488846037929508134986771433, 234965385179859810854399287906068885976, 11962701379314564572722140202812617562, 315105728460289255044517314167781474357, 92397698128764550243762952707724608359, 79161472796010129344236399474925315198, 8230717415162461432383488082982662910, 187550346095617606538292501947907284159, 111838535125019998906719357578490542024, 127632981408215865540832181515313916183, 77787230784265032836219137545199240126, 209675082880646980235572000733260128373, 318088800052782828672155510824979199450, 197936332876846440605381880211398578620, 163607618093826671398256369217224613243, 325974106851521509536970685901401508674]</span></span><br><span class="line"><span class="comment">#330464659390823375471800230370495966901</span></span><br></pre></td></tr></table></figure>
<p>题目就是一个RLWE，只是改变了其环R为：</p>
<script type="math/tex; mode=display">
\frac{Z_p[x]}{x^{64}+2024}</script><p>具体来说，题目将长度不到64的flag串编码成R上的多项式S，然后生成随机多项式A，并且随机生成一个小噪声多项式E，计算出：</p>
<script type="math/tex; mode=display">
B = AS + E</script><p>给出A、B，要求还原S。</p>
<p>实际上攻击的点就在于多项式S的系数都是ASCII码值，所以在模p下显得很小，从而可以用格攻击。</p>
<p>如果本身就了解RLWE造格的具体原理的话这题目就很简单，只需要略微改一改格就很快能做出。但如果一直以来造RLWE的格都是直接找别人的脚本跑、而不知道具体原理的话，可能就不太清楚如何改起。这里简单阐述一下其造格的思路，先从多项式乘法的矩阵表示讲起。</p>
<h4 id="多项式乘法的矩阵表示"><a href="#多项式乘法的矩阵表示" class="headerlink" title="多项式乘法的矩阵表示"></a>多项式乘法的矩阵表示</h4><p>首先，对于一个多项式，我们可以用一个由其系数组成的向量来表示这个多项式，而不同幂次就仅仅代表着系数在多项式中的位置。那么现在把眼光放回这个题目里，由于环R的模多项式度是64，所以其中的多项式次数最高为63，因此对于这题目中的多项式S，我们可以把它写作如下向量：</p>
<script type="math/tex; mode=display">
(s_0,s_1,s_2,...s_{63})</script><p>它对应的多项式就是：</p>
<script type="math/tex; mode=display">
S = s_0 + s_1x + s_2x^2 + ... + s_{63}x^{63}</script><p>同理多项式B、E也就可以写成是：</p>
<script type="math/tex; mode=display">
(b_0,b_1,b_2,...b_{63})</script><script type="math/tex; mode=display">
(e_0,e_1,e_2,...e_{63})</script><p>接下来的问题是，我们如何把多项式的乘法，也就是AS这个计算过程写成矩阵表示。这一部分详细一点可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://tover.xyz/p/NTRU/#多项式卷积乘法">NTRU学习笔记 | Tover’ Blog</a></p>
<p>其实核心思路并不复杂，比如对于上文中的环R，其模多项式是：</p>
<script type="math/tex; mode=display">
x^n - 1</script><p>这其实也就说明一个事情，在环R中总有：</p>
<script type="math/tex; mode=display">
x^n = 1 \quad(mod \; x^n-1)</script><p>这也就是说：</p>
<script type="math/tex; mode=display">
x^{n+i} = x^i \quad(mod \; x^n-1)</script><p>那么我们假设对于两个环R中的多项式a、b相乘，其得到的结果是c。我们知道a、b、c的最高次项的次数都小于n。所以如果我们仅仅计算ab乘积而不模x^n-1的话，他最多就有0到2n-2次项。又由上面的x^(n+i)=x^i，我们就可以推得下面这个重要性质：</p>
<ul>
<li>乘积c中的i次项系数，其实就是ab乘积中的i次项系数与n+i次项系数之和</li>
</ul>
<p>那么我们就可以根据这个性质写出多项式乘法的矩阵表示了。我们设a、b、c分别为：</p>
<script type="math/tex; mode=display">
(a_0,a_1,a_2,...a_{n-1})</script><script type="math/tex; mode=display">
(b_0,b_1,b_2,...b_{n-1})</script><script type="math/tex; mode=display">
(c_0,c_1,c_2,...c_{n-1})</script><p>比如对于c0，其代表的含义是ab乘积的0次项的系数，对应的我们就需要找ab乘积中的所有<strong>0次项以及n次项</strong>的系数并求和就得到c0；同理c1就找ab中的1次项以及n+1次项系数求和，以此类推。</p>
<p>这就得到了多项式乘法的矩阵表示形式：</p>
<script type="math/tex; mode=display">
(a_0,a_1,a_2,...a_{n-1})
\left(
 \begin{matrix}
   b_0    &b_1    &b_2   &\cdots &b_{n-1}\\
   b_{n-1}&b_0    &b_1   &\cdots &b_{n-2}\\
   b_{n-2}&b_{n-1}&b_0   &\cdots &b_{n-3}\\
   \vdots &\vdots &\vdots&\ddots &\vdots\\
   b_1    &b_2    &b_3   &\cdots &b_0\\
  \end{matrix}
  \right)
  =
  (c_0,c_1,c_2,...c_{n-1})</script><p>需要注意的是，刚才我们讨论的环是模x^n-1下的，所以才会有x^(n+i)=x^i这一事实。而在本题目中环R是在模x^64+2024下的，上面的式子不成立，那么又该怎么办？</p>
<p>做法也很简单，相似的道理有：</p>
<script type="math/tex; mode=display">
x^{64} = -2024 \quad(mod \; x^{64}+2024)</script><p>所以其实也就略微变了点样子，这个环中具有的性质是：</p>
<script type="math/tex; mode=display">
x^{64+i} = -2024x^{i} \quad(mod \; x^{64}+2024)</script><p>所以对于该环中的多项式ab相乘得到c的过程，可以写作如下矩阵：</p>
<script type="math/tex; mode=display">
(a_0,a_1,a_2,...a_{n-1})
\left(
 \begin{matrix}
   b_0    &b_1    &b_2   &\cdots &b_{n-1}\\
   -2024b_{n-1}&b_0    &b_1   &\cdots &b_{n-2}\\
   -2024b_{n-2}&-2024b_{n-1}&b_0   &\cdots &b_{n-3}\\
   \vdots &\vdots &\vdots&\ddots &\vdots\\
   -2024b_1    &-2024b_2    &-2024b_3   &\cdots &b_0\\
  \end{matrix}
  \right)
  =
  (c_0,c_1,c_2,...c_{n-1})</script><p>到这里我们就完成了该环下多项式的矩阵构建。</p>
<h4 id="格攻击"><a href="#格攻击" class="headerlink" title="格攻击"></a>格攻击</h4><p>其实只要能把矩阵造出来，那么在网上找一个RLWE的脚本并把矩阵换成上面这个，那么已经可以做出题目了。不过为了wp完整性还是简单说一下构造格的思路。我们知道对于题目中128bit的模素数p而言，E和S都是系数相当小的多项式，因此我们构造格的目的是在目标向量中找到他们。</p>
<p>为此我们可以把多项式乘法写成下面这样：</p>
<script type="math/tex; mode=display">
E = AS - B</script><p>然后就是用刚才的矩阵来造格：</p>
<script type="math/tex; mode=display">
\left(
\begin{matrix}
   p\\
   &p\\
   &&p\\
   &&&\cdots\\
   &&&&p\\

   a_0    &a_1    &a_2   &\cdots &a_{n-1}            &1\\
   -2024a_{n-1}&a_0    &a_1   &\cdots &a_{n-2}       &&1\\
   -2024a_{n-2}&-2024a_{n-1}&a_0   &\cdots &a_{n-3}  &&&1\\
   \vdots &\vdots &\vdots&\ddots &\vdots             &&&&\cdots\\
   -2024a_1    &-2024a_2    &-2024a_3   &\cdots &a_0 &&&&&1\\

   b_0    &b_1    &b_2   &\cdots &b_{n-1}&&&&&&1\\
  \end{matrix}
  \right)</script><p>这个格具有的线性关系是：</p>
<script type="math/tex; mode=display">
(k_0,k_1,k_2,...k_{63},s_0,s_1,s_2,...s_{63},1)
\left(
\begin{matrix}
   p\\
   &p\\
   &&p\\
   &&&\cdots\\
   &&&&p\\

   a_0    &a_1    &a_2   &\cdots &a_{n-1}            &1\\
   -2024a_{n-1}&a_0    &a_1   &\cdots &a_{n-2}       &&1\\
   -2024a_{n-2}&-2024a_{n-1}&a_0   &\cdots &a_{n-3}  &&&1\\
   \vdots &\vdots &\vdots&\ddots &\vdots             &&&&\cdots\\
   -2024a_1    &-2024a_2    &-2024a_3   &\cdots &a_0 &&&&&1\\

   b_0    &b_1    &b_2   &\cdots &b_{n-1}&&&&&&1\\
  \end{matrix}
  \right)
  =
  (e_0,e_1,e_2,...e_{63},s_0,s_1,s_2,...s_{63},1)</script><p>前面的ki是因为我们的环还需要对多项式的所有系数模p，所以所有系数求和模p后展开的等式中都含有一个kip。</p>
<p>然后对这个格做LLL就能在第一行找到我们的目标向量了，取中间的64个数字，也就得到flag的全部字符。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">64</span></span><br><span class="line">A = [<span class="number">203211966212120647994404162543901058385</span>, <span class="number">113998159211311856163959557092243561040</span>, <span class="number">300945935078651395200612763362025786190</span>, <span class="number">289539358962072307485802285781112184506</span>, <span class="number">266860644401078099268835882620812059236</span>, <span class="number">109469988130078797414202659254940150397</span>, <span class="number">142193430695353860553837582452159920561</span>, <span class="number">163603443131512016589524436620766900399</span>, <span class="number">125570052004030843134707673404921516235</span>, <span class="number">289517595415670285587801685152176297797</span>, <span class="number">260336477592153246815046507549532230446</span>, <span class="number">89128330175853905837766718032373473126</span>, <span class="number">187717315035064338496744033397006646838</span>, <span class="number">47398231438108384695170959715078016751</span>, <span class="number">320133498675264306580441374518511607677</span>, <span class="number">289224545427213583554005441616103706530</span>, <span class="number">48124450498844786580485017131751952117</span>, <span class="number">139700877104641187048620578708689412417</span>, <span class="number">71574579434689200165233820726593943746</span>, <span class="number">138252394765364749010226318178055019086</span>, <span class="number">261521192680609185598298661488532314373</span>, <span class="number">226827408720691280529315243806063440819</span>, <span class="number">312302166514031202715929873278517388968</span>, <span class="number">41543713499646037109947736777306720313</span>, <span class="number">265649922622063773566846630839697709881</span>, <span class="number">243184423040946982395304999253912592156</span>, <span class="number">206198258022435934039803402480943364253</span>, <span class="number">26031203447491686152181680360833340987</span>, <span class="number">267200487804167757054737887061948559784</span>, <span class="number">301825292179107181769802726785989059100</span>, <span class="number">245678367957552191949253880949910260990</span>, <span class="number">171086126608355874606827637031412493750</span>, <span class="number">238890683861901290139689496391030872360</span>, <span class="number">22845910272546674819720769022817968767</span>, <span class="number">28421978727921425902205492605476665131</span>, <span class="number">171865962533483544755013698922220144571</span>, <span class="number">133361830829435140268114465077140337526</span>, <span class="number">86265129464226210912927536339928098681</span>, <span class="number">68669331909862762270788724935161403154</span>, <span class="number">201866646039120111937128925580825280486</span>, <span class="number">13363589230429215865126757180274178298</span>, <span class="number">17909430443917365585897023486940736171</span>, <span class="number">91757667623716596753047172893731203404</span>, <span class="number">46825614193892927425213536328954419018</span>, <span class="number">131552079476235333764480742173849445520</span>, <span class="number">235812708672214623030453261917981487844</span>, <span class="number">128419026868422646823814506658958018620</span>, <span class="number">165071194644940049087362229894395125949</span>, <span class="number">119007848732714973887391773573107966930</span>, <span class="number">142175857554093924103634649494868118501</span>, <span class="number">324116975329566500720942384202511507819</span>, <span class="number">145202961579339260969095793970625895397</span>, <span class="number">302068925092915352636494174062039213344</span>, <span class="number">204865812301701145536309778960425467197</span>, <span class="number">73204183646529021271666811846606597696</span>, <span class="number">305266620775559116657495389805588046145</span>, <span class="number">38573243820497560644612322159835262762</span>, <span class="number">204132117511623685134894865125985283485</span>, <span class="number">152661573492853637425833316355962196973</span>, <span class="number">234147606390346795925961511757446390699</span>, <span class="number">101214795511329059676976012743816028858</span>, <span class="number">45259554101612024332508390665659000501</span>, <span class="number">69808091348685800959727855379331581323</span>, <span class="number">96236770545429224235813571394198156104</span>]</span><br><span class="line">B = [<span class="number">122276244512812151700561410687880152355</span>, <span class="number">288902265068638112029210922418017307765</span>, <span class="number">227157280930411828282688954386270375417</span>, <span class="number">51392889392439935890454046852827718770</span>, <span class="number">107818090106926819686128970258855341987</span>, <span class="number">39797693303511873260100821082668360148</span>, <span class="number">165165311283389310714977999739406590465</span>, <span class="number">145742713856100761940986808065029032102</span>, <span class="number">85681122792038178595571398323505588215</span>, <span class="number">161750232371529874705027252096297284499</span>, <span class="number">65492947650590100527727115268504178500</span>, <span class="number">158980937836523416847183159463389719119</span>, <span class="number">217622237154991741032187619647917235486</span>, <span class="number">214403448117831129512734472087177528755</span>, <span class="number">7203970244866082501778704003244517036</span>, <span class="number">209327947737263058848347484690330837593</span>, <span class="number">261471938052725575109694161428073566879</span>, <span class="number">290548445194039386389333379248698464710</span>, <span class="number">786777047021934678707520080022646500</span>, <span class="number">181116047323074255804762916647191259040</span>, <span class="number">321394759425138484862188864303222149962</span>, <span class="number">172828377940330639355360387538637264455</span>, <span class="number">66514389687485973164456706712404934406</span>, <span class="number">123351805496712587796702291879739918777</span>, <span class="number">52527849016391552904401277415521541344</span>, <span class="number">269082045250550515743652451127140175208</span>, <span class="number">46611178931314336386280465499464556662</span>, <span class="number">306738233577541073584072095728624359658</span>, <span class="number">27700046031756446145225137030746217892</span>, <span class="number">90225963569273234686624144350335934112</span>, <span class="number">67692467833088163585206113599832005433</span>, <span class="number">323500338166210082579512376483956531150</span>, <span class="number">268393735497552347113220159171930201434</span>, <span class="number">303137349721700995847836323480358301717</span>, <span class="number">37409490969034515063902941681541879806</span>, <span class="number">89987553043378360059649171549894177100</span>, <span class="number">177195833588614025644477178454034861283</span>, <span class="number">186453862621405866128018280976135392700</span>, <span class="number">134539827243365382868881776050914249090</span>, <span class="number">174423939567752183215031097600196039560</span>, <span class="number">141295420547653230540490506885038874517</span>, <span class="number">71077155156144579112947495766255667953</span>, <span class="number">219294250229364145810766028169964010349</span>, <span class="number">32511078113518753980651829431342417337</span>, <span class="number">303329577727497287329206502612155346064</span>, <span class="number">90557253357868638265309134765551619996</span>, <span class="number">274174517174776162629592599514881337711</span>, <span class="number">49932861529770838835799830915660452043</span>, <span class="number">12677314962488846037929508134986771433</span>, <span class="number">234965385179859810854399287906068885976</span>, <span class="number">11962701379314564572722140202812617562</span>, <span class="number">315105728460289255044517314167781474357</span>, <span class="number">92397698128764550243762952707724608359</span>, <span class="number">79161472796010129344236399474925315198</span>, <span class="number">8230717415162461432383488082982662910</span>, <span class="number">187550346095617606538292501947907284159</span>, <span class="number">111838535125019998906719357578490542024</span>, <span class="number">127632981408215865540832181515313916183</span>, <span class="number">77787230784265032836219137545199240126</span>, <span class="number">209675082880646980235572000733260128373</span>, <span class="number">318088800052782828672155510824979199450</span>, <span class="number">197936332876846440605381880211398578620</span>, <span class="number">163607618093826671398256369217224613243</span>, <span class="number">325974106851521509536970685901401508674</span>]</span><br><span class="line">p = <span class="number">330464659390823375471800230370495966901</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 construct matrix of poly_mul</span></span><br><span class="line">poly_mul_mat = Matrix(ZZ,n,n)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>):</span><br><span class="line">        poly_mul_mat[j,i] = A[i-j]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n-i-<span class="number">1</span>):</span><br><span class="line">        poly_mul_mat[j+i+<span class="number">1</span>,i] = A[-(j+<span class="number">1</span>)]*(-<span class="number">2024</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 construct Lattice of RLWE</span></span><br><span class="line">I = identity_matrix(n)</span><br><span class="line">B_mat = Matrix(ZZ,B)</span><br><span class="line">O = diagonal_matrix([<span class="number">0</span>]*n)</span><br><span class="line">O_vec = Matrix(ZZ,<span class="number">1</span>,n)</span><br><span class="line">O_vec_T = Matrix(ZZ,n,<span class="number">1</span>)</span><br><span class="line">L = block_matrix(ZZ,[[p*I,O,<span class="number">0</span>],[poly_mul_mat,I,O_vec_T],[B_mat,O_vec,<span class="number">1</span>]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 LLL to get s and get flag</span></span><br><span class="line">res = L.LLL()[<span class="number">0</span>]</span><br><span class="line">s = res[n:<span class="number">2</span>*n]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">abs</span>(i)),end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;U_c4n_5olv3_th1s_pr0b!em_0nce_u_kn0W_M4trix_0f_Polymu1&#125;</span></span><br></pre></td></tr></table></figure>
<p>题目本身如果了解RLWE的话就很基础，主要是想通过wp帮助一些不太了解多项式乘法的cryptoer找找构建成矩阵的思路，从而不再只是调脚本跑。</p>
<p><br></p>
<p><br></p>
<h3 id="New-Year-Ring2"><a href="#New-Year-Ring2" class="headerlink" title="New Year Ring2"></a>New Year Ring2</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">新年换个新新环！</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line">n = <span class="number">64</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) &lt; n</span><br><span class="line"></span><br><span class="line">PRp.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f = x^n+<span class="number">2</span>*x^<span class="number">3</span>+<span class="number">0</span>*x^<span class="number">2</span>+<span class="number">2</span>*x+<span class="number">4</span>  <span class="comment">#welcome to 2024!</span></span><br><span class="line">PR = PRp.quo(f)</span><br><span class="line"><span class="keyword">assert</span> f.is_irreducible()</span><br><span class="line"></span><br><span class="line">A = [randint(<span class="number">0</span>, p) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">E = [randint(-<span class="number">4</span>, <span class="number">4</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">S = [<span class="built_in">ord</span>(flag[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag))]</span><br><span class="line"></span><br><span class="line">B = PR(A)*PR(S)+PR(E)</span><br><span class="line"><span class="built_in">print</span>(A)</span><br><span class="line"><span class="built_in">print</span>(B.<span class="built_in">list</span>())</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line"><span class="comment">#[25628433222756085994492259068849402115, 108192689210265022288173745176216677895, 85974352459523213168503152436203993854, 41828313114844948099739205193013146660, 15961445864161535368425735570577871568, 59860624089211511801244965491114405123, 72238114736535717286419734164194491146, 1731419769773538054984020741260144321, 110926179088722293171658261432626666958, 4729059639835826882559436203284470206, 168495809056757598731123948067040373565, 3338360642630078653320363127167526308, 19389936220034072874232261675901806153, 10438117635879553768611012406691341169, 153667038046207304584441437937384897775, 72166665774655568880543097047667804863, 95319528381704092095798376951073542165, 62898039808274250589921375492358418705, 38256076367009076141369526506747299307, 116682168147974451260364221046574659055, 26917522774848180141649752130328445540, 155767907175579627310170473659502971153, 77475859845928815191730640478115081925, 70014064310214050035280946814599808820, 85993451838284022745989979544017241858, 1559588202521630621698182776746048258, 52424771201426327411234245307354332594, 92380990205273211168316314938871853614, 55868954214861940284812204603983552046, 86766496415006406161245997036503548760, 65631024912623216715877274133399692328, 165552413066518454864366169079315182837, 27090806019996818214310558040178209015, 24884235560487406082425405304334927881, 167131388381252997695719535111304864318, 84309157064049564271714180786273613498, 53226032826639984552629376026393806036, 10043888404273006035387494091731007691, 12579929759225042382751229048796566699, 166363316914893642035801926729741157934, 37839073681950914796852925854557791313, 59823734019834883911363191453005985507, 72713054697995652053446065501322532087, 7355549923971285393506940087861413681, 21734747677920938504945342916533076569, 93933129166049277428941778125233010374, 58955842096425290408052247755008181893, 35959399375270454336325579486716264076, 134512300913738209016228764504703580317, 156877088942396466398635185398252103142, 104513294126348280186621088034948750337, 58139022317938952038809444482141783106, 98565612260156356115401166878515345986, 114416081175175578305854221578018095237, 22901750234260702478992290068664968479, 156611313609023033314989985233189973832, 125083132555321363078288077242345281728, 41404163164349704408020008746598776378, 148785934103979787297708145558354509586, 60576000474984112015781658795707443603, 157378782433123699827402744836263199181, 115808625117495689666174307128964343007, 55532885470248050887252206269085843644, 167226824329071601899518640284153209079]</span></span><br><span class="line"><span class="comment">#[125436276837023032466255967451858640606, 144448119937248956307846718982491347769, 162306129951573761575068204811168998078, 83181011846487027653033036479190112408, 40957533970438134530667298492545012058, 39781894692503876914564462045404705807, 164051006333092368306831348749408921012, 111012742481005666423330275146981180733, 7715720858029882578293974044643808669, 157677217515339873901600902409190036650, 47743593975916243882559558507891093023, 157986164305142738632123943371346719550, 127635891927296917312348404019956617317, 29559276398124624593609203169860820474, 65960871111768788316941346555260753893, 168042316135611110131429808009369471733, 1212659292467585393525194729053590464, 131142075720852427381782478157244639696, 102842995705164719704337121568124710266, 34358829636338044181518280022135929086, 46061675284276849395800943167734760351, 135977825342856793359560567810384022667, 79194609568617048147045548433187673199, 3676419995870098657902754244090307337, 129102404404523795672123957629514020212, 132931883751740337774987369503377603250, 157631873978881249131112881234813720862, 25064634967243118171242164160769943822, 90201135758213533081777343764941590513, 28708219563163506588485189820706388938, 56568253458138625936076514562071708932, 6347413009696777418004642228340087455, 142708918733729617152197380466325161544, 90675635242552386205397936839615479057, 92501808867676816791538575898905495372, 119574898086174634261072854178847743198, 109965735435324316785759245560872940757, 88027969746581556885954470651939385855, 134321591115155640446804238393795645472, 138737181251155600814378949277591209336, 99644145229459444132485749993357552167, 72102411291892187794699247448258325603, 83762370748394317206974170435605895442, 50088402451174667055894866569295371337, 151985189458457003469569692195947019009, 94074842589490698882361618773816024181, 73064286019059695311967281427732071049, 15926695040044471692620032927734856548, 92040182094543438421700664648795356800, 72067816134410856572981520568082148623, 51543145349488111975169803932104264498, 133476358234399233123899184886685568681, 138871089323661273034769987507240180967, 135182088478518211398715618356312799892, 142132493504501637417871042380487888261, 152821195684002682180600788766787854997, 108605984719600234041614912160255546443, 107009285527858918462712915168386920973, 142315287684855833566016316758770217595, 120564701831156855156008640956601967150, 76342952544707200039421682949094541165, 1616883292120605398623492917180224681, 114803483209077151333130433872010751344, 59602734024539592667147877839382863851]</span></span><br><span class="line"><span class="comment">#p = 171384865635734387982308861436753436427</span></span><br></pre></td></tr></table></figure>
<p>这一题是上一题的加强，相对于上一题来说，本题又把商环更换为了：</p>
<script type="math/tex; mode=display">
\frac{Z_p[x]}{x^{64}+2x^3+2x+4}</script><p>但是目标是不变的，仍然是要利用s和e系数较小这一点，去设法构造格进行规约。</p>
<p>要构造出格就要先构造出商环中多项式乘积的矩阵表示。本题的难点也就在于，商环中现在不仅存在64次项和常数项，还存在一次项和三次项，那么该怎么去构造这个矩阵呢？</p>
<p>我们仍然是利用如下一点：</p>
<script type="math/tex; mode=display">
x^{64} = -(2x^3+2x+4) \quad(mod\;x^{64}+2x^3+2x+4)</script><p>所以有：</p>
<script type="math/tex; mode=display">
x^{64+i} = -(2x^{3+i}+2x^{1+i}+4x^{i}) \quad(mod\;x^{64}+2x^3+2x+4)</script><p>那么对于之前举的多项式a乘b得到c的例子，我们假设ab乘完后先不模x^64+2x^3+2x+4，记这个乘积为d，那么d就有0到2x63次项。而由于上面推得的这个商环下多项式的同余关系，对于c中的各项系数来说，其0次项的系数应该有d中的0次项以及64次项的参与，其1次项应该有d中的1次项、64次项以及65次项参与，其2次项应该有d中的2次项、65次项以及66次项参与，其3次项应该有d中的3次项、64次项、66次项、67次项参与，……以此类推。</p>
<p>但是有一个需要注意的问题是，右边由于存在3+i和1+i项，所以有些项可能需要多次模，比如对于i=61就有：</p>
<script type="math/tex; mode=display">
x^{64+61} = -(2x^{64}+2x^{62}+4x^{61}) \quad(mod\;x^{64}+2x^3+2x+4)</script><p>右边的x^64就又需要展开，得到的最终式子是：</p>
<script type="math/tex; mode=display">
x^{64+61} = -(2(-(2x^3+2x+4))+2x^{62}+4x^{61}) = -2x^{62}-4x^{61}+4x^3+4x+8</script><p>可以注意到，因为最高次项也只会有126次，所以只有i=61、62的时候需要进行二次模运算，不妨把i=61、62的情况一并列出：</p>
<script type="math/tex; mode=display">
x^{64+61} = -2x^{62}-4x^{61}+4x^3+4x+8</script><script type="math/tex; mode=display">
x^{64+62} = -2x^{63}-4x^{62}+4x^4+4x^2+8x</script><p>所以次数为0到4的项的系数还需要额外调整一下。那么对于这道题中的S乘A的过程，就可以构造出这一次的多项式乘积矩阵如下：</p>
<script type="math/tex; mode=display">
(s_0,s_1,s_2,s_3,...s_{63})
\left(
 \begin{matrix}
   a_0     &a_1              &a_2                &a_3&\cdots &a_{63}\\
   -4a_{63}&a_0-2a_{63}      &a_1                &a_2-2a_{63}&\cdots &a_{62}\\
   -4a_{62}&-4a_{63}-2a_{62} &a_0-2a_{63}        &a_1-2a_{62}&\cdots &a_{61}\\
   -4a_{61}&-4a_{62}-2a_{61} &-4a_{63}-2a_{62}   &a_0-2a_{63}-2a_{61}&\cdots &a_{60}\\
   \vdots &\vdots &\vdots&\vdots&\ddots &\vdots\\
   -4a_1+8a_{62}    &-4a_2-2a_1+4a_{62} +8a_{63}      &-4a_3-2a_2+4a_{63}          &-4a_4-2a_3-2a_1+4a_{62}&\cdots &a_0-2a_{63}-2a_{61}\\
  \end{matrix}
  \right)</script><p>造的格子就和上一道题目是一样的了，把矩阵换成上面这个就行。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">64</span></span><br><span class="line">A = [<span class="number">25628433222756085994492259068849402115</span>, <span class="number">108192689210265022288173745176216677895</span>, <span class="number">85974352459523213168503152436203993854</span>, <span class="number">41828313114844948099739205193013146660</span>, <span class="number">15961445864161535368425735570577871568</span>, <span class="number">59860624089211511801244965491114405123</span>, <span class="number">72238114736535717286419734164194491146</span>, <span class="number">1731419769773538054984020741260144321</span>, <span class="number">110926179088722293171658261432626666958</span>, <span class="number">4729059639835826882559436203284470206</span>, <span class="number">168495809056757598731123948067040373565</span>, <span class="number">3338360642630078653320363127167526308</span>, <span class="number">19389936220034072874232261675901806153</span>, <span class="number">10438117635879553768611012406691341169</span>, <span class="number">153667038046207304584441437937384897775</span>, <span class="number">72166665774655568880543097047667804863</span>, <span class="number">95319528381704092095798376951073542165</span>, <span class="number">62898039808274250589921375492358418705</span>, <span class="number">38256076367009076141369526506747299307</span>, <span class="number">116682168147974451260364221046574659055</span>, <span class="number">26917522774848180141649752130328445540</span>, <span class="number">155767907175579627310170473659502971153</span>, <span class="number">77475859845928815191730640478115081925</span>, <span class="number">70014064310214050035280946814599808820</span>, <span class="number">85993451838284022745989979544017241858</span>, <span class="number">1559588202521630621698182776746048258</span>, <span class="number">52424771201426327411234245307354332594</span>, <span class="number">92380990205273211168316314938871853614</span>, <span class="number">55868954214861940284812204603983552046</span>, <span class="number">86766496415006406161245997036503548760</span>, <span class="number">65631024912623216715877274133399692328</span>, <span class="number">165552413066518454864366169079315182837</span>, <span class="number">27090806019996818214310558040178209015</span>, <span class="number">24884235560487406082425405304334927881</span>, <span class="number">167131388381252997695719535111304864318</span>, <span class="number">84309157064049564271714180786273613498</span>, <span class="number">53226032826639984552629376026393806036</span>, <span class="number">10043888404273006035387494091731007691</span>, <span class="number">12579929759225042382751229048796566699</span>, <span class="number">166363316914893642035801926729741157934</span>, <span class="number">37839073681950914796852925854557791313</span>, <span class="number">59823734019834883911363191453005985507</span>, <span class="number">72713054697995652053446065501322532087</span>, <span class="number">7355549923971285393506940087861413681</span>, <span class="number">21734747677920938504945342916533076569</span>, <span class="number">93933129166049277428941778125233010374</span>, <span class="number">58955842096425290408052247755008181893</span>, <span class="number">35959399375270454336325579486716264076</span>, <span class="number">134512300913738209016228764504703580317</span>, <span class="number">156877088942396466398635185398252103142</span>, <span class="number">104513294126348280186621088034948750337</span>, <span class="number">58139022317938952038809444482141783106</span>, <span class="number">98565612260156356115401166878515345986</span>, <span class="number">114416081175175578305854221578018095237</span>, <span class="number">22901750234260702478992290068664968479</span>, <span class="number">156611313609023033314989985233189973832</span>, <span class="number">125083132555321363078288077242345281728</span>, <span class="number">41404163164349704408020008746598776378</span>, <span class="number">148785934103979787297708145558354509586</span>, <span class="number">60576000474984112015781658795707443603</span>, <span class="number">157378782433123699827402744836263199181</span>, <span class="number">115808625117495689666174307128964343007</span>, <span class="number">55532885470248050887252206269085843644</span>, <span class="number">167226824329071601899518640284153209079</span>]</span><br><span class="line">B = [<span class="number">125436276837023032466255967451858640606</span>, <span class="number">144448119937248956307846718982491347769</span>, <span class="number">162306129951573761575068204811168998078</span>, <span class="number">83181011846487027653033036479190112408</span>, <span class="number">40957533970438134530667298492545012058</span>, <span class="number">39781894692503876914564462045404705807</span>, <span class="number">164051006333092368306831348749408921012</span>, <span class="number">111012742481005666423330275146981180733</span>, <span class="number">7715720858029882578293974044643808669</span>, <span class="number">157677217515339873901600902409190036650</span>, <span class="number">47743593975916243882559558507891093023</span>, <span class="number">157986164305142738632123943371346719550</span>, <span class="number">127635891927296917312348404019956617317</span>, <span class="number">29559276398124624593609203169860820474</span>, <span class="number">65960871111768788316941346555260753893</span>, <span class="number">168042316135611110131429808009369471733</span>, <span class="number">1212659292467585393525194729053590464</span>, <span class="number">131142075720852427381782478157244639696</span>, <span class="number">102842995705164719704337121568124710266</span>, <span class="number">34358829636338044181518280022135929086</span>, <span class="number">46061675284276849395800943167734760351</span>, <span class="number">135977825342856793359560567810384022667</span>, <span class="number">79194609568617048147045548433187673199</span>, <span class="number">3676419995870098657902754244090307337</span>, <span class="number">129102404404523795672123957629514020212</span>, <span class="number">132931883751740337774987369503377603250</span>, <span class="number">157631873978881249131112881234813720862</span>, <span class="number">25064634967243118171242164160769943822</span>, <span class="number">90201135758213533081777343764941590513</span>, <span class="number">28708219563163506588485189820706388938</span>, <span class="number">56568253458138625936076514562071708932</span>, <span class="number">6347413009696777418004642228340087455</span>, <span class="number">142708918733729617152197380466325161544</span>, <span class="number">90675635242552386205397936839615479057</span>, <span class="number">92501808867676816791538575898905495372</span>, <span class="number">119574898086174634261072854178847743198</span>, <span class="number">109965735435324316785759245560872940757</span>, <span class="number">88027969746581556885954470651939385855</span>, <span class="number">134321591115155640446804238393795645472</span>, <span class="number">138737181251155600814378949277591209336</span>, <span class="number">99644145229459444132485749993357552167</span>, <span class="number">72102411291892187794699247448258325603</span>, <span class="number">83762370748394317206974170435605895442</span>, <span class="number">50088402451174667055894866569295371337</span>, <span class="number">151985189458457003469569692195947019009</span>, <span class="number">94074842589490698882361618773816024181</span>, <span class="number">73064286019059695311967281427732071049</span>, <span class="number">15926695040044471692620032927734856548</span>, <span class="number">92040182094543438421700664648795356800</span>, <span class="number">72067816134410856572981520568082148623</span>, <span class="number">51543145349488111975169803932104264498</span>, <span class="number">133476358234399233123899184886685568681</span>, <span class="number">138871089323661273034769987507240180967</span>, <span class="number">135182088478518211398715618356312799892</span>, <span class="number">142132493504501637417871042380487888261</span>, <span class="number">152821195684002682180600788766787854997</span>, <span class="number">108605984719600234041614912160255546443</span>, <span class="number">107009285527858918462712915168386920973</span>, <span class="number">142315287684855833566016316758770217595</span>, <span class="number">120564701831156855156008640956601967150</span>, <span class="number">76342952544707200039421682949094541165</span>, <span class="number">1616883292120605398623492917180224681</span>, <span class="number">114803483209077151333130433872010751344</span>, <span class="number">59602734024539592667147877839382863851</span>]</span><br><span class="line">p = <span class="number">171384865635734387982308861436753436427</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 construct matrix of poly_mul</span></span><br><span class="line">poly_mul_mat = Matrix(ZZ,n,n)</span><br><span class="line"></span><br><span class="line"><span class="comment">#first column</span></span><br><span class="line">poly_mul_mat[<span class="number">0</span>,<span class="number">0</span>] = A[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,n):</span><br><span class="line">    poly_mul_mat[i,<span class="number">0</span>] = -<span class="number">4</span>*A[n-i]</span><br><span class="line"><span class="comment">#handle special twice mod </span></span><br><span class="line">poly_mul_mat[-<span class="number">1</span>,<span class="number">0</span>] += <span class="number">8</span>*A[-<span class="number">2</span>]</span><br><span class="line">poly_mul_mat[-<span class="number">2</span>,<span class="number">0</span>] += <span class="number">8</span>*A[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#2-3 column</span></span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">2</span>]:</span><br><span class="line">    poly_mul_mat[col,col] = A[<span class="number">0</span>] - <span class="number">2</span>*A[n-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(col):</span><br><span class="line">        poly_mul_mat[i,col] = A[col-i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>-col):</span><br><span class="line">        poly_mul_mat[col+i+<span class="number">1</span>,col] = -<span class="number">4</span>*A[n-<span class="number">1</span>-i]-<span class="number">2</span>*A[n-<span class="number">1</span>-i-<span class="number">1</span>]</span><br><span class="line"><span class="comment">#handle special twice mod </span></span><br><span class="line">poly_mul_mat[-<span class="number">1</span>,<span class="number">1</span>] += <span class="number">4</span>*A[-<span class="number">2</span>] + <span class="number">8</span>*A[-<span class="number">1</span>]</span><br><span class="line">poly_mul_mat[-<span class="number">2</span>,<span class="number">1</span>] += <span class="number">4</span>*A[-<span class="number">1</span>]</span><br><span class="line">poly_mul_mat[-<span class="number">1</span>,<span class="number">2</span>] += <span class="number">4</span>*A[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#rest column</span></span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,n):</span><br><span class="line">    poly_mul_mat[col-<span class="number">2</span>,col] = A[<span class="number">2</span>] - <span class="number">2</span>*A[n-<span class="number">1</span>]</span><br><span class="line">    poly_mul_mat[col-<span class="number">1</span>,col] = A[<span class="number">1</span>] - <span class="number">2</span>*A[n-<span class="number">2</span>]</span><br><span class="line">    poly_mul_mat[col,col] = A[<span class="number">0</span>] - <span class="number">2</span>*A[n-<span class="number">1</span>] - <span class="number">2</span>*A[n-<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(col-<span class="number">2</span>):</span><br><span class="line">        poly_mul_mat[i,col] = A[col-i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>-col):</span><br><span class="line">        poly_mul_mat[col+i+<span class="number">1</span>,col] = -<span class="number">4</span>*A[n-<span class="number">1</span>-i]-<span class="number">2</span>*A[n-<span class="number">1</span>-i-<span class="number">1</span>]-<span class="number">2</span>*A[n-<span class="number">1</span>-i-<span class="number">3</span>]</span><br><span class="line"><span class="comment">#handle special twice mod </span></span><br><span class="line">poly_mul_mat[-<span class="number">1</span>,<span class="number">3</span>] += <span class="number">4</span>*A[-<span class="number">2</span>]</span><br><span class="line">poly_mul_mat[-<span class="number">2</span>,<span class="number">3</span>] += <span class="number">4</span>*A[-<span class="number">1</span>]</span><br><span class="line">poly_mul_mat[-<span class="number">1</span>,<span class="number">4</span>] += <span class="number">4</span>*A[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 construct Lattice of RLWE</span></span><br><span class="line">I = identity_matrix(n)</span><br><span class="line">B_mat = Matrix(ZZ,B)</span><br><span class="line">O = diagonal_matrix([<span class="number">0</span>]*n)</span><br><span class="line">O_vec = Matrix(ZZ,<span class="number">1</span>,n)</span><br><span class="line">O_vec_T = Matrix(ZZ,n,<span class="number">1</span>)</span><br><span class="line">L = block_matrix(ZZ,[[p*I,O,<span class="number">0</span>],[poly_mul_mat,I,O_vec_T],[B_mat,O_vec,<span class="number">1</span>]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 LLL to get s and get flag</span></span><br><span class="line">res = L.LLL()[<span class="number">0</span>]</span><br><span class="line">s = res[n:<span class="number">2</span>*n]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">abs</span>(i)),end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;M4st3r_0F_RLWE_h3r3_15_ur_flag_4nD_HHHHappy_niu_Ye4r!!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="New-Year-Ring3"><a href="#New-Year-Ring3" class="headerlink" title="New Year Ring3"></a>New Year Ring3</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">新年用个新新新新环！</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line">n = <span class="number">64</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) &lt; n</span><br><span class="line"></span><br><span class="line">PRp.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">newyear = [<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>]</span><br><span class="line">f = x^n</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    f += newyear[i%<span class="number">4</span>]*x^(n-<span class="number">1</span>-i)   <span class="comment">#welcome to 2024!</span></span><br><span class="line">PR = PRp.quo(f)</span><br><span class="line"><span class="keyword">assert</span> f.is_irreducible()</span><br><span class="line"></span><br><span class="line">A = [randint(<span class="number">0</span>, p) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">E = [randint(-<span class="number">4</span>, <span class="number">4</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">S = [<span class="built_in">ord</span>(flag[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag))]</span><br><span class="line"></span><br><span class="line">B = PR(A)*PR(S)+PR(E)</span><br><span class="line"><span class="built_in">print</span>(A)</span><br><span class="line"><span class="built_in">print</span>(B.<span class="built_in">list</span>())</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line"><span class="comment">#[143895536039223361852265879930678271849, 49941095619845369403633015749131244252, 192366807276439803341529420280624695341, 41863179329950350668896955448215016801, 161730900763954941459384930538350726304, 69486722690005239063204459423772119076, 150044605995739190031133614780160002164, 53617544566841857383903597080623109339, 74625820568619243297350181792710531670, 16380616502578067837931320551193635969, 161905270710745874415457791187229895491, 60615195134615631027916010677640865675, 160490605829184543601552626825699212302, 67566984475203250552779752218068594160, 213285653211278131505736720165333128065, 64852378214458505102852766762259296220, 127863063181868054387649888847647635563, 173388212610482051840613449798996257379, 107853129453974811439304180468226801619, 47026991726695830686352132714620786077, 54537407094343620242102574881749270054, 213117990243770129927508589374671252215, 188551573436848023902527678127834115095, 184904756222053551643771035280489901913, 130154717708566694574065576508622379407, 169935928816833755787895658897579592244, 25127997681478110567876718932464424139, 66241086523494222064942298262635441275, 128384348198631966247204855175670185827, 186534789734452323940160584274797242101, 44113757786219743282268996106377142498, 161464089943212437590741012855856579087, 152978274982120638112396394811148002893, 127858672640521604574047701048286112335, 24811959746896810879635351294335540800, 139884017165706571446169150175115903276, 162069295856137595644855638161429085830, 103852979898094376585707063387003994190, 209853862047034349714977775246731397993, 83875540721706520814802129116239183141, 229717680288888669127660062951596981300, 142905448436402318840598200380283379791, 97701946983539136207969604175005004177, 132882918810599573425074347748636321411, 30946979906897798248175975370883897061, 227445609344085479411697428271056340360, 226861499760726945354933277553812121082, 34610454530275079356327169999644151033, 86543487884993671802260662621113434518, 193748181739943346975874601639150010426, 34955296746796322689176100212054938608, 78982586205793555689802056285642735691, 3417188406740628320649576312400181913, 165141388407797054166867506278447838336, 12695265941766745754277957144871301850, 89458008041873757788350494973818918496, 17544328835809254417440184162473311528, 17809092337865928270441021151091911120, 190539046594231331045902135957952644092, 54013202950149354717829653296038417693, 182140149560821210676566057705914354798, 182590162902622112992977612842205026523, 226186981126958513892204825722664037031, 96763448317215723992226901770790799160]</span></span><br><span class="line"><span class="comment">#[146131953632371057251386640770029761962, 155126848145561802955686124994407020596, 215548579819339372855889610814620506576, 215378077144333849353671692326217769974, 211651696346814349480371028078398365850, 56211588439881618182356345926007014351, 35792916285189253601060073066755768657, 193834084101163540069238791365615525212, 64185605303590514314207911465024315433, 74011476974910970618385371699236712496, 144080173424901828501825948809304329878, 50478515840382641218068722055014699097, 61424373096897526822902957616641049161, 228135094283701120116040034916450645966, 173676278129085855942014338366292660640, 4958486587405211188374567586180119556, 107653280004443417845206647750419894242, 227948848364624440330554299487592496262, 103344313582462128597769184556262118266, 179090340541635393147453223953633783366, 91157025540035569434535505051126504071, 218301646561306199078249711983197566905, 207984369886452772406666980534904709935, 84848453635637121750244379243550315275, 70455676155616420940430093468129934421, 112082679346753821742720835769195197209, 100096437088582331947465760446007491622, 23148318752965414660522976895342715316, 175024877143863308838121164427112023613, 65455761812920253083377790817920776573, 80719540338474829645398437070034720831, 30265965699771257065456865006701716765, 65059939935789446486144438246062876092, 73412866905686210879034022846184532326, 15496701729614207294798217895713334887, 187927627267834618400725936475600101114, 51596647781094949272750319452641626273, 34936140628305933632043160171328035222, 227636764157434931002269545814362460674, 40310006070105509297521946935690917605, 158199753843142436703851148792841271128, 62042757128547429572711130709028563495, 4994577444829057554913018889328955170, 212120189443587994433256482180523602261, 217895194863190305322702282626368171628, 14347476896110839167629995111874858945, 92969919157086783529099464146480743366, 98421412347381684974090776331896675353, 7670925013164447091797082877392123056, 92948133844692458289793766569490521009, 37843417064278243200690200946062028300, 73246898716604229152337274167003969610, 48576361100747286180365305580004800549, 226777738621945748117749363525255463543, 202653365491161565340111352416610858743, 81343653066789166205981715378171248137, 43128791749740623981661146675626160300, 51978531727836859802588862475571492852, 158673579466427370117557321982403789903, 154526278040551924441198621574328917110, 23520842615720508371775640194790884675, 76597771060168857457987619277375824543, 229138699410621489832761240581614631878, 62849396773221525801893336014307910648]</span></span><br><span class="line"><span class="comment">#229934842599910967421870245339955481121</span></span><br></pre></td></tr></table></figure>
<p>本题仍然基于RLWE，只是又将商环变换成：</p>
<script type="math/tex; mode=display">
\frac{Z_p[x]}{x^{64}+2x^{63}+2x^{61}+4x^{60}+...++2x^3+2x+4}</script><p>似乎还是可以用刚才构造矩阵的思路去解，但是想一想就会发现，这里由于模多项式又多了非常多项，所以会变得极其麻烦。</p>
<p>因此，这一个题是想将商环下多项式乘法的矩阵表示推广到一个更一般的形式，也就是说，如果能找到一个方法，使得对任何商环中的多项式乘法都可以用一个统一的算法来表示矩阵的话，那么其实三个题目都能一步到位。</p>
<p>所以接下来就是阐述怎么构造出这样的矩阵。</p>
<p>首先，仍然接续前文的思路。对于一个商环的模多项式，设其最高次项次数为n，那么商环中的所有多项式就都可以用一个长度为n的向量表示，向量中的每一个值分别表示多项式0到n-1次项的系数。由于我们想得到的是一般形式的商环下的多项式乘法矩阵，因此我们下面将都用一个抽象出的例子来说明。我们就假设，我们要计算的是多项式a和多项式b在模多项式v下的乘积c，其中v是n次，那么就可以把这四个多项式记为：</p>
<script type="math/tex; mode=display">
a = (a_0,a_1,a_2,a_3,...a_{n-1})</script><script type="math/tex; mode=display">
b = (b_0,b_1,b_2,b_3,...b_{n-1})</script><script type="math/tex; mode=display">
v = (v_0,v_1,v_2,v_3,...v_{n-1},1) \quad (默认模多项式为首一多项式)</script><script type="math/tex; mode=display">
c = (c_0,c_1,c_2,c_3,...c_{n-1})</script><p>而接下来的核心思路是，将商环下的多项式乘法拆分成两步，并分别用矩阵乘法表示：</p>
<ul>
<li>a和b相乘，得到多项式d</li>
<li>d模v，得到c</li>
</ul>
<p>然后将两步矩阵相乘，就得到我们需要的最终矩阵——商环下多项式乘法的表示矩阵。其中d是一个最高次项可以达到2n-2次的一个多项式，因此可以用向量写作：</p>
<script type="math/tex; mode=display">
d = (d_0,d_1,d_2,d_3,...d_{n-1},d_n,...,d_{2n-2})</script><p>那么接下来就分步阐述怎么构造矩阵。</p>
<h4 id="a和b相乘，得到多项式d"><a href="#a和b相乘，得到多项式d" class="headerlink" title="a和b相乘，得到多项式d"></a>a和b相乘，得到多项式d</h4><p>由于不需要进行模多项式运算，所以这一步其实非常简单，对于目标向量d中每个值对应的次数，我们只需要将所有能得到这个次数的系数乘积求和即可。也就是说矩阵乘法可以表示成：</p>
<script type="math/tex; mode=display">
(a_0,a_1,a_2,...a_{n-1})
\left(
 \begin{matrix}
   b_0    &b_1    &b_2   &\cdots &b_{n-1}&&\\
   &b_0    &b_1   &\cdots &b_{n-2}&b_{n-1}&\\
   &&b_0   &\cdots &b_{n-3}&b_{n-2}&b_{n-1}\\
   &&&\ddots &\vdots&\vdots&\vdots&\ddots\\
   &&&&b_0&b_1&b_2&\cdots&b_{n-1}\\
  \end{matrix}
  \right)
  =
  (d_0,d_1,d_2,d_3,...d_{n-1},d_n,...,d_{2n-2})</script><p>为了更方便说明，把向量和矩阵的大小都标识出来会更好：</p>
<script type="math/tex; mode=display">
(a_0,a_1,a_2,...a_{n-1})_{1\times n}
\left(
 \begin{matrix}
   b_0    &b_1    &b_2   &\cdots &b_{n-1}&&\\
   &b_0    &b_1   &\cdots &b_{n-2}&b_{n-1}&\\
   &&b_0   &\cdots &b_{n-3}&b_{n-2}&b_{n-1}\\
   &&&\ddots &\vdots&\vdots&\vdots&\ddots\\
   &&&&b_0&b_1&b_2&\cdots&b_{n-1}\\
  \end{matrix}
  \right)
  _{n\times (2n-1)}
  =
  (d_0,d_1,d_2,d_3,...d_{n-1},d_n,...,d_{2n-2})_{1\times (2n-1)}</script><p>那么接下来我们的目标是，将得到的d向量：</p>
<script type="math/tex; mode=display">
(d_0,d_1,d_2,d_3,...d_{n-1},d_n,...,d_{2n-2})_{1\times (2n-1)}</script><p>进行模v，从而得到最终的多项式c，将这个过程也表示成矩阵乘法。</p>
<h4 id="d模v，得到c"><a href="#d模v，得到c" class="headerlink" title="d模v，得到c"></a>d模v，得到c</h4><p>首先对于d中前n项来说(也就是0到n-1次项)，表示到最终的向量c是很轻松的，由于次数低，不需要模多项式，所以只需要将对应数值加到c中对应项中就可以，也就是造一个单位矩阵即可。</p>
<p>而较难处理的是d中超过了n-1次的项，因为他们要进行模v的操作。而对于这里我们处理的手段仍然是构造模多项式中的同余方程：</p>
<script type="math/tex; mode=display">
x^{n} = -(v_{n-1}x^{n-1}+v_{n-2}x^{n-2}+...+v_{2}x^{2}+v_{1}x^{1}+v_0) \quad(mod\;v)</script><p>也就有：</p>
<script type="math/tex; mode=display">
x^{n+i} = -(v_{n-1}x^{n-1+i}+v_{n-2}x^{n-2+i}+...+v_{2}x^{2+i}+v_{1}x^{1+i}+v_0x^i) \quad(mod\;v)</script><p>而又因为d中最高也就只有2n-2次项，所以其中i的范围是：</p>
<script type="math/tex; mode=display">
0,1,2,...,n-3,n-2</script><p>可以预见的是，由于高次项会存在多次使用同余方程降次，因此我们需要从i=0开始，逐步将x^(n+i)均转化成一个次数在0到n-1的多项式并求出系数，加到最终多项式c的对应项的系数中。</p>
<p>i=0时，显然直接利用刚才的同余方程就可以得到每个次数的项前需要加的系数：</p>
<script type="math/tex; mode=display">
x^{n} = -(v_{n-1}x^{n-1}+v_{n-2}x^{n-2}+...+v_{2}x^{2}+v_{1}x^{1}+v_0) \quad(mod\;v)</script><p>而i=1时，右侧的同余方程又会出现需要降次的x^n次方项，如下：</p>
<script type="math/tex; mode=display">
x^{n+1} = -(v_{n-1}{\color{red}x^{n}}+v_{n-2}x^{n-1}+...+v_{2}x^{3}+v_{1}x^{2}+v_0x) \quad(mod\;v)</script><p>好像不太好处理，但其实想一想，不就是把刚才求过的n次项降次后得到的系数代入这里不就好了吗？也就是：</p>
<script type="math/tex; mode=display">
x^{n+1} = -(v_{n-1}{\color{red}(-(v_{n-1}x^{n-1}+v_{n-2}x^{n-2}+...+v_{2}x^{2}+v_{1}x^{1}+v_0)}+v_{n-2}x^{n-1}+...+v_{2}x^{3}+v_{1}x^{2}+v_0x) \quad(mod\;v)</script><p>然后展开运算出各项系数即可。</p>
<p>而继续看i=2的形式，右侧会得到：</p>
<script type="math/tex; mode=display">
x^{n+2} = -(v_{n-1}{\color{red}x^{n+1}}+v_{n-2}{\color{red}x^{n}}+...+v_{2}x^{4}+v_{1}x^{3}+v_0x^2) \quad(mod\;v)</script><p>可以发现红色项我们均计算过了，我们只需要继续刚才的过程：代入已经算出的式子并展开计算。这也就是一个迭代的过程，一直到：</p>
<script type="math/tex; mode=display">
x^{n+n-2} = -(v_{n-1}{\color{red}x^{n+n-3}}+v_{n-2}{\color{red}x^{n+n-4}}+...+v_{2}{\color{red}x^{n}}+v_{1}x^{n-1}+v_0x^{n-2}) \quad(mod\;v)</script><p>计算就彻底结束了。</p>
<p>而要构造矩阵，只需要将d中的大于等于n次方的每一项系数乘以刚才对应展开形式中的对应项系数，就可以得到矩阵中对应的行，然后接在刚才的单位矩阵下即可。也就是说这一步的矩阵应该长下面这个样子：</p>
<script type="math/tex; mode=display">
\left(
 \begin{matrix}
   1\\
   &1\\
   &&1\\
   &&&\ddots\\
   &&&&1\\
   r_0&r_1&r_2&\cdots&r_{n-1}\\
   s_0&s_1&s_2&\cdots&s_{n-1}\\
  \vdots&\vdots&\vdots&\vdots&\vdots\\
   t_0&t_1&t_2&\cdots&t_{n-1}\\
  \end{matrix}
  \right)
  _{(2n-1)\times n}</script><p>其中r、s、t几行是我们计算出的值，这里只是随便用个符号记录，没有特别的意义。</p>
<p>这一步的矩阵也表示完了，然后对这一步的矩阵有：</p>
<script type="math/tex; mode=display">
(d_0,d_1,d_2,d_3,...d_{n-1},d_n,...,d_{2n-2})_{1\times (2n-1)}
\left(
 \begin{matrix}
   1\\
   &1\\
   &&1\\
   &&&\ddots\\
   &&&&1\\
   r_0&r_1&r_2&\cdots&r_{n-1}\\
   s_0&s_1&s_2&\cdots&s_{n-1}\\
  \vdots&\vdots&\vdots&\vdots&\vdots\\
   t_0&t_1&t_2&\cdots&t_{n-1}\\
  \end{matrix}
  \right)
  _{(2n-1)\times n}
  =
(c_0,c_1,c_2,c_3,...c_{n-1})_{1\times n}</script><h4 id="综合表示"><a href="#综合表示" class="headerlink" title="综合表示"></a>综合表示</h4><p>我们只需要将两个矩阵乘起来就得到我们需要的一般意义下的多项式乘法卷积矩阵了：</p>
<script type="math/tex; mode=display">
L
=
\left(
 \begin{matrix}
   b_0    &b_1    &b_2   &\cdots &b_{n-1}&&\\
   &b_0    &b_1   &\cdots &b_{n-2}&b_{n-1}&\\
   &&b_0   &\cdots &b_{n-3}&b_{n-2}&b_{n-1}\\
   &&&\ddots &\vdots&\vdots&\vdots&\ddots\\
   &&&&b_0&b_1&b_2&\cdots&b_{n-1}\\
  \end{matrix}
  \right)
  _{n\times (2n-1)}

  \left(
 \begin{matrix}
   1\\
   &1\\
   &&1\\
   &&&\ddots\\
   &&&&1\\
   r_0&r_1&r_2&\cdots&r_{n-1}\\
   s_0&s_1&s_2&\cdots&s_{n-1}\\
  \vdots&\vdots&\vdots&\vdots&\vdots\\
   t_0&t_1&t_2&\cdots&t_{n-1}\\
  \end{matrix}
  \right)
  _{(2n-1)\times n}</script><p>此时就有：</p>
<script type="math/tex; mode=display">
(a_0,a_1,a_2,...a_{n-1})L= (c_0,c_1,c_2,c_3,...c_{n-1})</script><p>对于这个题目来说，之后就只需要将矩阵代入到RLWE的攻击格中，就可以规约得到需要的向量了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">A = [<span class="number">143895536039223361852265879930678271849</span>, <span class="number">49941095619845369403633015749131244252</span>, <span class="number">192366807276439803341529420280624695341</span>, <span class="number">41863179329950350668896955448215016801</span>, <span class="number">161730900763954941459384930538350726304</span>, <span class="number">69486722690005239063204459423772119076</span>, <span class="number">150044605995739190031133614780160002164</span>, <span class="number">53617544566841857383903597080623109339</span>, <span class="number">74625820568619243297350181792710531670</span>, <span class="number">16380616502578067837931320551193635969</span>, <span class="number">161905270710745874415457791187229895491</span>, <span class="number">60615195134615631027916010677640865675</span>, <span class="number">160490605829184543601552626825699212302</span>, <span class="number">67566984475203250552779752218068594160</span>, <span class="number">213285653211278131505736720165333128065</span>, <span class="number">64852378214458505102852766762259296220</span>, <span class="number">127863063181868054387649888847647635563</span>, <span class="number">173388212610482051840613449798996257379</span>, <span class="number">107853129453974811439304180468226801619</span>, <span class="number">47026991726695830686352132714620786077</span>, <span class="number">54537407094343620242102574881749270054</span>, <span class="number">213117990243770129927508589374671252215</span>, <span class="number">188551573436848023902527678127834115095</span>, <span class="number">184904756222053551643771035280489901913</span>, <span class="number">130154717708566694574065576508622379407</span>, <span class="number">169935928816833755787895658897579592244</span>, <span class="number">25127997681478110567876718932464424139</span>, <span class="number">66241086523494222064942298262635441275</span>, <span class="number">128384348198631966247204855175670185827</span>, <span class="number">186534789734452323940160584274797242101</span>, <span class="number">44113757786219743282268996106377142498</span>, <span class="number">161464089943212437590741012855856579087</span>, <span class="number">152978274982120638112396394811148002893</span>, <span class="number">127858672640521604574047701048286112335</span>, <span class="number">24811959746896810879635351294335540800</span>, <span class="number">139884017165706571446169150175115903276</span>, <span class="number">162069295856137595644855638161429085830</span>, <span class="number">103852979898094376585707063387003994190</span>, <span class="number">209853862047034349714977775246731397993</span>, <span class="number">83875540721706520814802129116239183141</span>, <span class="number">229717680288888669127660062951596981300</span>, <span class="number">142905448436402318840598200380283379791</span>, <span class="number">97701946983539136207969604175005004177</span>, <span class="number">132882918810599573425074347748636321411</span>, <span class="number">30946979906897798248175975370883897061</span>, <span class="number">227445609344085479411697428271056340360</span>, <span class="number">226861499760726945354933277553812121082</span>, <span class="number">34610454530275079356327169999644151033</span>, <span class="number">86543487884993671802260662621113434518</span>, <span class="number">193748181739943346975874601639150010426</span>, <span class="number">34955296746796322689176100212054938608</span>, <span class="number">78982586205793555689802056285642735691</span>, <span class="number">3417188406740628320649576312400181913</span>, <span class="number">165141388407797054166867506278447838336</span>, <span class="number">12695265941766745754277957144871301850</span>, <span class="number">89458008041873757788350494973818918496</span>, <span class="number">17544328835809254417440184162473311528</span>, <span class="number">17809092337865928270441021151091911120</span>, <span class="number">190539046594231331045902135957952644092</span>, <span class="number">54013202950149354717829653296038417693</span>, <span class="number">182140149560821210676566057705914354798</span>, <span class="number">182590162902622112992977612842205026523</span>, <span class="number">226186981126958513892204825722664037031</span>, <span class="number">96763448317215723992226901770790799160</span>]</span><br><span class="line">B = [<span class="number">146131953632371057251386640770029761962</span>, <span class="number">155126848145561802955686124994407020596</span>, <span class="number">215548579819339372855889610814620506576</span>, <span class="number">215378077144333849353671692326217769974</span>, <span class="number">211651696346814349480371028078398365850</span>, <span class="number">56211588439881618182356345926007014351</span>, <span class="number">35792916285189253601060073066755768657</span>, <span class="number">193834084101163540069238791365615525212</span>, <span class="number">64185605303590514314207911465024315433</span>, <span class="number">74011476974910970618385371699236712496</span>, <span class="number">144080173424901828501825948809304329878</span>, <span class="number">50478515840382641218068722055014699097</span>, <span class="number">61424373096897526822902957616641049161</span>, <span class="number">228135094283701120116040034916450645966</span>, <span class="number">173676278129085855942014338366292660640</span>, <span class="number">4958486587405211188374567586180119556</span>, <span class="number">107653280004443417845206647750419894242</span>, <span class="number">227948848364624440330554299487592496262</span>, <span class="number">103344313582462128597769184556262118266</span>, <span class="number">179090340541635393147453223953633783366</span>, <span class="number">91157025540035569434535505051126504071</span>, <span class="number">218301646561306199078249711983197566905</span>, <span class="number">207984369886452772406666980534904709935</span>, <span class="number">84848453635637121750244379243550315275</span>, <span class="number">70455676155616420940430093468129934421</span>, <span class="number">112082679346753821742720835769195197209</span>, <span class="number">100096437088582331947465760446007491622</span>, <span class="number">23148318752965414660522976895342715316</span>, <span class="number">175024877143863308838121164427112023613</span>, <span class="number">65455761812920253083377790817920776573</span>, <span class="number">80719540338474829645398437070034720831</span>, <span class="number">30265965699771257065456865006701716765</span>, <span class="number">65059939935789446486144438246062876092</span>, <span class="number">73412866905686210879034022846184532326</span>, <span class="number">15496701729614207294798217895713334887</span>, <span class="number">187927627267834618400725936475600101114</span>, <span class="number">51596647781094949272750319452641626273</span>, <span class="number">34936140628305933632043160171328035222</span>, <span class="number">227636764157434931002269545814362460674</span>, <span class="number">40310006070105509297521946935690917605</span>, <span class="number">158199753843142436703851148792841271128</span>, <span class="number">62042757128547429572711130709028563495</span>, <span class="number">4994577444829057554913018889328955170</span>, <span class="number">212120189443587994433256482180523602261</span>, <span class="number">217895194863190305322702282626368171628</span>, <span class="number">14347476896110839167629995111874858945</span>, <span class="number">92969919157086783529099464146480743366</span>, <span class="number">98421412347381684974090776331896675353</span>, <span class="number">7670925013164447091797082877392123056</span>, <span class="number">92948133844692458289793766569490521009</span>, <span class="number">37843417064278243200690200946062028300</span>, <span class="number">73246898716604229152337274167003969610</span>, <span class="number">48576361100747286180365305580004800549</span>, <span class="number">226777738621945748117749363525255463543</span>, <span class="number">202653365491161565340111352416610858743</span>, <span class="number">81343653066789166205981715378171248137</span>, <span class="number">43128791749740623981661146675626160300</span>, <span class="number">51978531727836859802588862475571492852</span>, <span class="number">158673579466427370117557321982403789903</span>, <span class="number">154526278040551924441198621574328917110</span>, <span class="number">23520842615720508371775640194790884675</span>, <span class="number">76597771060168857457987619277375824543</span>, <span class="number">229138699410621489832761240581614631878</span>, <span class="number">62849396773221525801893336014307910648</span>]</span><br><span class="line">p = <span class="number">229934842599910967421870245339955481121</span></span><br><span class="line">n = <span class="number">64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 construct matrix of poly_mul</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#n:The highest degree of a modular polynomial</span></span><br><span class="line"><span class="comment">#v:vector of modular polynomial</span></span><br><span class="line"><span class="comment">#a:vector of a polynomial multiplier</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#aim to construct a matrix of c=a*b%v</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">construct_poly_mul_mat</span>(<span class="params">n,v,b</span>):</span><br><span class="line">    <span class="keyword">assert</span> v[-<span class="number">1</span>] == <span class="number">1</span> <span class="comment">#use this after monic</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#step1 construct a matrix of d=a*b</span></span><br><span class="line">    mat1 = Matrix(ZZ,n,<span class="number">2</span>*n-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            mat1[i,j+i] = b[j] </span><br><span class="line"></span><br><span class="line">    <span class="comment">#step2 construct a matrix of c=d%v</span></span><br><span class="line">    mat2 = Matrix(ZZ,<span class="number">2</span>*n-<span class="number">1</span>,n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        mat2[i,i] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n,<span class="number">2</span>*n-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i-n,n):</span><br><span class="line">            mat2[i,j] = -v[j-(i-n)]</span><br><span class="line">        </span><br><span class="line">        init_row = vector(ZZ,n*[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i-n):</span><br><span class="line">            temp = -v[n-<span class="number">1</span>-j]*vector(ZZ,mat2[i-j-<span class="number">1</span>])</span><br><span class="line">            init_row += temp</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            mat2[i,j] += init_row[j]   </span><br><span class="line">             </span><br><span class="line">    <span class="comment">#step3 multiply them and return</span></span><br><span class="line">    <span class="keyword">return</span>(mat1*mat2)</span><br><span class="line"></span><br><span class="line">PRp.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">newyear = [<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>]</span><br><span class="line">f = x^n</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    f += newyear[i%<span class="number">4</span>]*x^(n-<span class="number">1</span>-i)</span><br><span class="line">v = f.<span class="built_in">list</span>()</span><br><span class="line">poly_mul_mat = construct_poly_mul_mat(n,v,A)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 construct Lattice of RLWE</span></span><br><span class="line">I = identity_matrix(n)</span><br><span class="line">B_mat = Matrix(ZZ,B)</span><br><span class="line">O = diagonal_matrix([<span class="number">0</span>]*n)</span><br><span class="line">O_vec = Matrix(ZZ,<span class="number">1</span>,n)</span><br><span class="line">O_vec_T = Matrix(ZZ,n,<span class="number">1</span>)</span><br><span class="line">L = block_matrix(ZZ,[[p*I,O,<span class="number">0</span>],[poly_mul_mat,I,O_vec_T],[B_mat,O_vec,<span class="number">1</span>]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 LLL to get s and get flag</span></span><br><span class="line">res = L.LLL()[<span class="number">0</span>]</span><br><span class="line">s = res[n:<span class="number">2</span>*n]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">abs</span>(i)),end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;!!!Hah4H@,H0p3_Y0U_h@ve_fang_In_y0ur_po1Ynomial_5tudY!!&#125;</span></span><br></pre></td></tr></table></figure>
<p>而这样的通解自然对前面的两题也适用。</p>
<p><br></p>
<p><br></p>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>(ﾟ∀。)你居然发现这里更新了！</p>
<p>实际上，就在比赛之后不久，我理解了一下maple博客里对商环转矩阵的处理，发现其实很简单。上述的推导虽然正确，但是略显麻烦了。然而因为懒，当时没有记录，今天总算想起来就来更新一下。（2024.12.23）</p>
<p>先说结论，实际上商环上的多项式乘法转矩阵一行代码就可以搞定：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mat = Matrix(ZZ, [(mult*x^i % mod).<span class="built_in">list</span>() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(mod.degree())])</span><br></pre></td></tr></table></figure>
<p>为什么呢？我们记一个一般的商环$R_q = \frac{Z_p[x]}{f}$，这里的模多项式$f$可以是任何度为$d$的多项式，我们依然假设我们要把$R_q$下的多项式乘法$t = a \cdot s$转化成向量-矩阵乘法的形式：</p>
<script type="math/tex; mode=display">
\textbf{t}_{1\times n} = \textbf{s}_{1\times n} \cdot A_{n\times n}</script><p>首先，多项式$s$到向量的转换依然是很简单的，就是将他的所有系数当作向量即可，比如向量$\textbf{s} = (s_0,s_1,s_2,…s_{d-1})$对应的多项式就是$s = s_0 + s_1x + s_2x^2 + … + s_{d-1}x^{d-1}$，这个上面也有提到。</p>
<p>关键就在这里，$t = a \cdot s$这个多项式乘法本质上来说是什么呢？他可以按$x$的不同次数拆成：</p>
<script type="math/tex; mode=display">
t = a \cdot(s_0 + s_1x + s_2x^2 + ... + s_{d-1}x^{d-1})</script><p>这等价于：</p>
<script type="math/tex; mode=display">
t = s_0a + s_1(ax) + s_2(ax^2) + ... + s_{d-1}(ax^{d-1})</script><p>很自然的，这对应到了一个向量-矩阵乘法：</p>
<script type="math/tex; mode=display">
\textbf{t} = 
(s_0,s_1,s_2,\cdots, s_{d-1})
\left(\begin{matrix}
a \\
ax \\
ax^2 \\ 
\vdots \\
ax^{d-1}\\
\end{matrix}\right)</script><p>而右边的矩阵就是我们需要的$A$，只需要在$R_q$下计算他并展开成向量就好了，这也就是上面那一行代码的含义。这样的推导显然会好理解很多。</p>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/7a9f0ad2.html" title="2024-NSSCTF-Round-18-Basic-wp-crypto">https://tangcuxiaojikuai.xyz/post/7a9f0ad2.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/a6ee3e0e.html" rel="prev" title="2023-CryptoCTF-wp-crypto">
      <i class="fa fa-chevron-left"></i> 2023-CryptoCTF-wp-crypto
    </a></div>
      <div class="post-nav-item">
    <a href="/post/fa6eda6b.html" rel="next" title="2024-VNCTF-wp-crypto">
      2024-VNCTF-wp-crypto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#New-Year-Ring1"><span class="nav-number">1.</span> <span class="nav-text">New Year Ring1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F%E4%B9%98%E6%B3%95%E7%9A%84%E7%9F%A9%E9%98%B5%E8%A1%A8%E7%A4%BA"><span class="nav-number">1.1.</span> <span class="nav-text">多项式乘法的矩阵表示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%BC%E6%94%BB%E5%87%BB"><span class="nav-number">1.2.</span> <span class="nav-text">格攻击</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#New-Year-Ring2"><span class="nav-number">2.</span> <span class="nav-text">New Year Ring2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#New-Year-Ring3"><span class="nav-number">3.</span> <span class="nav-text">New Year Ring3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a%E5%92%8Cb%E7%9B%B8%E4%B9%98%EF%BC%8C%E5%BE%97%E5%88%B0%E5%A4%9A%E9%A1%B9%E5%BC%8Fd"><span class="nav-number">3.1.</span> <span class="nav-text">a和b相乘，得到多项式d</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#d%E6%A8%A1v%EF%BC%8C%E5%BE%97%E5%88%B0c"><span class="nav-number">3.2.</span> <span class="nav-text">d模v，得到c</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%BC%E5%90%88%E8%A1%A8%E7%A4%BA"><span class="nav-number">3.3.</span> <span class="nav-text">综合表示</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">4.</span> <span class="nav-text">后记</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">111</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tangcuxiaojikuai" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tangcuxiaojikuai" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
