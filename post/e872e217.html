<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="包含全四道赛题的题解">
<meta property="og:type" content="article">
<meta property="og:title" content="2023-鹏城杯-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/e872e217.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="包含全四道赛题的题解">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-11-04T09:39:23.000Z">
<meta property="article:modified_time" content="2023-11-05T00:27:34.000Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/e872e217.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2023-鹏城杯-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/e872e217.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2023-鹏城杯-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-04 17:39:23" itemprop="dateCreated datePublished" datetime="2023-11-04T17:39:23+08:00">2023-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-11-05 08:27:34" itemprop="dateModified" datetime="2023-11-05T08:27:34+08:00">2023-11-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/e872e217.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/e872e217.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>包含全四道赛题的题解</p>
<span id="more"></span>
<h3 id="LeakyRSA"><a href="#LeakyRSA" class="headerlink" title="LeakyRSA"></a>LeakyRSA</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这个RSA好像泄露了什么？</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">nbits=<span class="number">512</span></span><br><span class="line">p=getPrime(nbits)</span><br><span class="line">q=getPrime(nbits)</span><br><span class="line"></span><br><span class="line">leakBits = <span class="number">262</span></span><br><span class="line">leak = (p ^ q)  &gt;&gt; (nbits - leakBits)</span><br><span class="line"></span><br><span class="line">n=p*q</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=%d&quot;</span> %n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=%d&quot;</span> %c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;leak=%d&quot;</span> %leak)</span><br><span class="line"><span class="comment"># n=73822410148110759760164946405270228269255384237831275745269402590230495569279769799226813942899942423718229747478982630879557319063920515141217164980012063064986634632452289290326704640527699568662492105204165609614169349755365956569362139057327962393611139347462018186440108621311077722819578905265976612923      </span></span><br><span class="line"><span class="comment"># c=71808322808599218331233291542779486534747913572475630198802984648982830332628443972652322590637382696027943799004331488098592525306523343649935216419522329722152742610560398216737030893090641493326477786720839849938277402743820773957184083430369443325368720115515840174745825798187125454448297155036065857691      </span></span><br><span class="line"><span class="comment"># leak=2223117424030234543005449667053988296724455736030907136592525175314696509716321</span></span><br></pre></td></tr></table></figure>
<p>题目给了一个泄漏了高262位的leak，满足：</p>
<script type="math/tex; mode=display">
leak = p \oplus q</script><p>那么运用深搜，可以找到多组满足条件的p、q高位，不明白深搜思路的师傅可以看我之前写的这篇，第二题第一小问：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/342113ee.html">Crypto趣题-剪枝 | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>那么接下来的自然想法，就是对找到的这些可能的p、q高位依次进行copper恢复低位。但是有一点小问题：</p>
<ul>
<li>未知的低位有250比特，对于copper来说比较紧</li>
</ul>
<p>所以我们要想办法提高可解根的上界，而我们知道，copper的可解根上界如下：</p>
<script type="math/tex; mode=display">
n^{\frac{\beta^2}{d}-\epsilon}</script><p>其中，d是构造的待求解多项式的度，这里也就是1；beta是指多项式建立在有限域Z(p)上，p是n的因子且满足b&gt;n^beta；epsilon就是small_roots的一个参数。</p>
<p>那么可以运用下面三个思路更好的利用copper：</p>
<ul>
<li>每一组比较p、q高位的大小，取较大的那一个值来恢复低位，这样可以将beta取为0.5，提高能求解的理论上界</li>
<li>epsilon取0.01，这样会变慢，但同样可以提高能求解的理论上界</li>
<li>由于p为素数，将待求的p最低位赋为1，可以缩小根的上界(同理，可以爆破几位进一步缩小上界，但这里不需要了)</li>
</ul>
<p>然后就可以恢复p，进而求解明文。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.setrecursionlimit(<span class="number">1500</span>)</span><br><span class="line"></span><br><span class="line">nbits=<span class="number">512</span></span><br><span class="line">leakBits = <span class="number">262</span></span><br><span class="line">leakbits = nbits - leakBits</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">n=<span class="number">73822410148110759760164946405270228269255384237831275745269402590230495569279769799226813942899942423718229747478982630879557319063920515141217164980012063064986634632452289290326704640527699568662492105204165609614169349755365956569362139057327962393611139347462018186440108621311077722819578905265976612923</span>      </span><br><span class="line">c=<span class="number">71808322808599218331233291542779486534747913572475630198802984648982830332628443972652322590637382696027943799004331488098592525306523343649935216419522329722152742610560398216737030893090641493326477786720839849938277402743820773957184083430369443325368720115515840174745825798187125454448297155036065857691</span>      </span><br><span class="line">leak=<span class="number">2223117424030234543005449667053988296724455736030907136592525175314696509716321</span></span><br><span class="line"></span><br><span class="line">leak = leak &lt;&lt; leakbits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a1 = <span class="string">&quot;0&quot;</span> + <span class="built_in">str</span>(<span class="built_in">bin</span>(leak)[<span class="number">2</span>:])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">p,q</span>):</span><br><span class="line">    l = <span class="built_in">len</span>(p)</span><br><span class="line">    tmp0 = p + (<span class="number">512</span>-l)*<span class="string">&quot;0&quot;</span></span><br><span class="line">    tmp1 = p + (<span class="number">512</span>-l)*<span class="string">&quot;1&quot;</span></span><br><span class="line">    tmq0 = q + (<span class="number">512</span>-l)*<span class="string">&quot;0&quot;</span></span><br><span class="line">    tmq1 = q + (<span class="number">512</span>-l)*<span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">int</span>(tmp0,<span class="number">2</span>) &lt; <span class="built_in">int</span>(tmq0,<span class="number">2</span>)):</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">int</span>(tmp0,<span class="number">2</span>)*<span class="built_in">int</span>(tmq0,<span class="number">2</span>) &gt; n):</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    <span class="keyword">elif</span>(<span class="built_in">int</span>(tmp1,<span class="number">2</span>)*<span class="built_in">int</span>(tmq1,<span class="number">2</span>) &lt; n):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(l == <span class="number">512</span> - leakbits):</span><br><span class="line">        pp = <span class="built_in">int</span>(tmp0,<span class="number">2</span>)</span><br><span class="line">        PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">        f = pp + x*<span class="number">2</span> + <span class="number">1</span></span><br><span class="line">        f = f.monic()</span><br><span class="line">        res = f.small_roots(X=<span class="number">2</span>^leakbits-<span class="number">1</span>, beta=<span class="number">0.5</span>, epsilon=<span class="number">0.01</span>)</span><br><span class="line">        <span class="keyword">if</span>(res):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                plow = <span class="built_in">int</span>(res[<span class="number">0</span>])</span><br><span class="line">                p = pp + plow * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">                q = n // p</span><br><span class="line">                d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">                <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n))))</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">                    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span>(a1[l] == <span class="string">&quot;1&quot;</span>):</span><br><span class="line">            find(p+<span class="string">&quot;1&quot;</span>,q+<span class="string">&quot;0&quot;</span>)</span><br><span class="line">            find(p+<span class="string">&quot;0&quot;</span>,q+<span class="string">&quot;1&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            find(p+<span class="string">&quot;0&quot;</span>,q+<span class="string">&quot;0&quot;</span>)</span><br><span class="line">            find(p+<span class="string">&quot;1&quot;</span>,q+<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line">tempp = <span class="string">&quot;&quot;</span></span><br><span class="line">tempq = <span class="string">&quot;&quot;</span></span><br><span class="line">find(tempp,tempq)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;6eb67115-38b1-4e75-b3fc-de3a9697e565&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="SecretShare"><a href="#SecretShare" class="headerlink" title="SecretShare"></a>SecretShare</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Alice把flag分享了给你，快把他恢复吧。flag格式：flag&#123;可见字符串&#125;</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, secret</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">21</span></span><br><span class="line">t = <span class="number">21</span></span><br><span class="line"></span><br><span class="line">A = [secret]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">    A.append(random.getrandbits(<span class="number">1024</span>))</span><br><span class="line"></span><br><span class="line">X = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    X.append(random.getrandbits(<span class="number">1024</span>))</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1026</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    tmp = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        res = (res + tmp * A[i]) % p </span><br><span class="line">        tmp = tmp * x % p</span><br><span class="line">    <span class="keyword">return</span> res % p</span><br><span class="line"></span><br><span class="line">R = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    R.append(f(X[i]))</span><br><span class="line"></span><br><span class="line">P = secret</span><br><span class="line">Q = getPrime(<span class="number">1024</span>)</span><br><span class="line">N = P * Q</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line">phi=(P - <span class="number">1</span>) * (Q - <span class="number">1</span>)</span><br><span class="line">d = <span class="built_in">pow</span>(e,-<span class="number">1</span>,phi)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,N)))</span><br><span class="line"></span><br><span class="line">fi = <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t-<span class="number">1</span>):</span><br><span class="line">    fi.write(<span class="built_in">str</span>(X[i])+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(R[i])+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;leak = %d&quot;</span>%R[-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p = %d&quot;</span>%p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c = %d&quot;</span>%c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;N = %d&quot;</span>%N)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak = 158171468736013100218170873274656605219228738469715092751861925345310881653082508445746109167302799236685145510095499361526242392251594397820661050281094210672424887670015189702781308615421102937559185479455827148241690888934661637911906309379701856488858180027365752169466863585611322838180758159364570481257</span></span><br><span class="line"><span class="comment"># p = 667548632459029899397299221540978856425474915828934339291333387574324630349258515018972045406265448494845331262999241448002076917383740651362641947814545076390796789402373579283727117618532504865966299599663825771187433223531022829811594806917984414530614469374596457149431218829297339079019894262229453357029   </span></span><br><span class="line"><span class="comment"># c = 9658009093151541277762773618550582280013680172161026781649630205505443184765264518709081169475689440555639354980432557616120809346519461077355134139495745998317849357705381020225760061125236265304057301286196004542729553944161451832173970613915423841610378207266606500956362098150141825329354727367056070349148059780287916811442861961254066733726576151134458892613951223277692935141880749737598416235307087782001086096114978527447987308876878393763055893556123029990282534497668077854186604106027698257663251502775547705641708624619340185646943640576690633662704397191379303254341343433077302686466850600522990402912</span></span><br><span class="line"><span class="comment"># N = 11790604055677230214731474049594783873473779547159534481643303694816346271798870343160061559787963631020684982858033776446193418629055210874285696446209220404060653230407249409973790191858423402504530660556839353260629987853933304089439885784684686555554108157760445567974629355878575105480273451284714281430590737346099023372211403461861104391534461524711472734572409128196536805998116015230502045333769525693468193385557827209520108839913096017750428926467123493650506193757937746017474062985480713594474378324234033232933140389879312722642144536418253323908290256009510135710208223393009237664704631175216240376891</span></span><br></pre></td></tr></table></figure>
<p>这个题目将最终RSA的一个私钥P当作secret，藏在A数组的第一个，然后分别按如下方式生成各个数组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">A = [secret]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">    A.append(random.getrandbits(<span class="number">1024</span>))</span><br><span class="line"></span><br><span class="line">X = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    X.append(random.getrandbits(<span class="number">1024</span>))</span><br></pre></td></tr></table></figure>
<p>并以A、X数组为基础，计算R数组，R数组的每个值如下：</p>
<script type="math/tex; mode=display">
R_i = \sum_{j=0}^{20}{A_jX_i^j}  \quad(mod\;p)</script><p>直观一点举个例子就是：</p>
<script type="math/tex; mode=display">
R_0 = A_0 + A_1X_0^1 + A_2X_0^2 + ... A_{20}X_0^{20} \quad(mod\;p)</script><p>然后，题目给了模数p和完整的R数组，以及缺了最后一个的X数组。可以想到，目的是用这些值还原出A数组，从而用上面的等式解出A0，然后得到最终RSA的分解进而求解明文。</p>
<p>很显眼的一点是，他随机数采用了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">random.getrandbits(<span class="number">1024</span>)</span><br></pre></td></tr></table></figure>
<p>然后又知道X数组的20个值，20个1024大于32*624，因此有足够的state来逆向twist，就可以得到全部A，然后随便挑一个Ri的计算等式就能解出A0，就有n的分解了。</p>
<p>对MT19937逆向过程不太明白的可以看这两篇文章，前段时间尝试完成西湖论剑的Oracle时才研究过，所以还有印象：</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/205861#h3-9">浅析MT19937伪随机数生成算法-安全客 - 安全资讯平台 (anquanke.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://cryptography-wiki.github.io/stream/prng/MT19937/?h=mt#_7">MT19937 - Cryptography-Wiki</a></p>
<p>我的exp也基本是用的这里面的脚本。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#twist</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse_right_mask</span>(<span class="params">res, shift, mask=<span class="number">0xffffffff</span>, bits=<span class="number">32</span></span>):</span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits // shift):</span><br><span class="line">        tmp = res ^ tmp &gt;&gt; shift &amp; mask</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse_left_mask</span>(<span class="params">res, shift, mask=<span class="number">0xffffffff</span>, bits=<span class="number">32</span></span>):</span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits // shift):</span><br><span class="line">        tmp = res ^ tmp &lt;&lt; shift &amp; mask</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover</span>(<span class="params">y</span>):</span><br><span class="line">    y = inverse_right_mask(y,<span class="number">18</span>)</span><br><span class="line">    y = inverse_left_mask(y,<span class="number">15</span>,<span class="number">4022730752</span>)</span><br><span class="line">    y = inverse_left_mask(y,<span class="number">7</span>,<span class="number">2636928640</span>)</span><br><span class="line">    y = inverse_right_mask(y,<span class="number">11</span>)</span><br><span class="line">    <span class="keyword">return</span> y&amp;<span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_twist</span>(<span class="params">state</span>):</span><br><span class="line">    high = <span class="number">0x80000000</span></span><br><span class="line">    low = <span class="number">0x7fffffff</span></span><br><span class="line">    mask = <span class="number">0x9908b0df</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recover</span>(<span class="params">i</span>):</span><br><span class="line">        y = state[i + <span class="number">624</span>] ^ state[i + <span class="number">397</span>]</span><br><span class="line">        <span class="keyword">if</span> y &amp; high == high: <span class="comment"># 异或了常数</span></span><br><span class="line">            y ^= mask</span><br><span class="line">            y &lt;&lt;= <span class="number">1</span></span><br><span class="line">            y |= <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># 没有异或常数</span></span><br><span class="line">            y &lt;&lt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(state)-<span class="number">625</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment"># 得到s_i的最高位</span></span><br><span class="line">        state[i] = recover(i) &amp; high</span><br><span class="line">        <span class="comment"># 对s_&#123;i-1&#125;做同样操作得到2-32位</span></span><br><span class="line">        state[i] |= recover(i-<span class="number">1</span>) &amp; low</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#recover state</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse_right</span>(<span class="params">res,shift,bits=<span class="number">32</span></span>):</span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits//shift):</span><br><span class="line">        tmp = res ^ tmp &gt;&gt; shift</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"><span class="comment"># right shift with mask inverse</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse_right_values</span>(<span class="params">res,shift,mask,bits=<span class="number">32</span></span>):</span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits//shift):</span><br><span class="line">        tmp = res ^ tmp&gt;&gt;shift &amp; mask</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"><span class="comment"># left shift inverse</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse_left</span>(<span class="params">res,shift,bits=<span class="number">32</span></span>):</span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits//shift):</span><br><span class="line">        tmp = res ^ tmp &lt;&lt; shift</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"><span class="comment"># left shift with mask inverse</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse_left_values</span>(<span class="params">res,shift,mask,bits=<span class="number">32</span></span>):</span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits//shift):</span><br><span class="line">        tmp = res ^ tmp &lt;&lt; shift &amp; mask</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover_state</span>(<span class="params">out</span>):</span><br><span class="line">    state = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> out:</span><br><span class="line">        i = inverse_right(i,<span class="number">18</span>)</span><br><span class="line">        i = inverse_left_values(i,<span class="number">15</span>,<span class="number">0xefc60000</span>)</span><br><span class="line">        i = inverse_left_values(i,<span class="number">7</span>,<span class="number">0x9d2c5680</span>)</span><br><span class="line">        i = inverse_right(i,<span class="number">11</span>)</span><br><span class="line">        state.append(i)</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line">X = []</span><br><span class="line">R = []</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;E:\题\鹏城杯 2023\secretshare\output.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        temp = f.readline().split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        X.append(<span class="built_in">int</span>(temp[<span class="number">0</span>]))</span><br><span class="line">        R.append(<span class="built_in">int</span>(temp[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">state = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    temp = X[i]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        state.append(temp&amp;<span class="number">0xffffffff</span>)</span><br><span class="line">        temp &gt;&gt;= <span class="number">32</span></span><br><span class="line"></span><br><span class="line">state = inv_twist([<span class="number">0</span>]*<span class="number">640</span> + recover_state(state[:<span class="number">624</span>]))</span><br><span class="line">state = state[:<span class="number">624</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</span><br><span class="line">prng = Random()</span><br><span class="line">prng.setstate((<span class="number">3</span>,<span class="built_in">tuple</span>(state+[<span class="number">0</span>]),<span class="literal">None</span>))</span><br><span class="line">A = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    A.append(prng.getrandbits(<span class="number">1024</span>))</span><br><span class="line"></span><br><span class="line">tX = [] </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">21</span>):</span><br><span class="line">    tX.append(prng.getrandbits(<span class="number">1024</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(tX[:20] == X)</span></span><br><span class="line"></span><br><span class="line">leak = <span class="number">158171468736013100218170873274656605219228738469715092751861925345310881653082508445746109167302799236685145510095499361526242392251594397820661050281094210672424887670015189702781308615421102937559185479455827148241690888934661637911906309379701856488858180027365752169466863585611322838180758159364570481257</span></span><br><span class="line">p = <span class="number">667548632459029899397299221540978856425474915828934339291333387574324630349258515018972045406265448494845331262999241448002076917383740651362641947814545076390796789402373579283727117618532504865966299599663825771187433223531022829811594806917984414530614469374596457149431218829297339079019894262229453357029</span>   </span><br><span class="line">c = <span class="number">9658009093151541277762773618550582280013680172161026781649630205505443184765264518709081169475689440555639354980432557616120809346519461077355134139495745998317849357705381020225760061125236265304057301286196004542729553944161451832173970613915423841610378207266606500956362098150141825329354727367056070349148059780287916811442861961254066733726576151134458892613951223277692935141880749737598416235307087782001086096114978527447987308876878393763055893556123029990282534497668077854186604106027698257663251502775547705641708624619340185646943640576690633662704397191379303254341343433077302686466850600522990402912</span></span><br><span class="line">N = <span class="number">11790604055677230214731474049594783873473779547159534481643303694816346271798870343160061559787963631020684982858033776446193418629055210874285696446209220404060653230407249409973790191858423402504530660556839353260629987853933304089439885784684686555554108157760445567974629355878575105480273451284714281430590737346099023372211403461861104391534461524711472734572409128196536805998116015230502045333769525693468193385557827209520108839913096017750428926467123493650506193757937746017474062985480713594474378324234033232933140389879312722642144536418253323908290256009510135710208223393009237664704631175216240376891</span></span><br><span class="line"></span><br><span class="line">R.append(leak)</span><br><span class="line"></span><br><span class="line">secret = R[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">21</span>):</span><br><span class="line">    secret = (secret - <span class="built_in">pow</span>(tX[<span class="number">0</span>],i)*A[i-<span class="number">1</span>]) %p</span><br><span class="line"></span><br><span class="line">P = secret</span><br><span class="line">Q = N//P</span><br><span class="line">d = inverse(<span class="number">65537</span>,(P-<span class="number">1</span>)*(Q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,N)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;2f43430b-3c31-03ee-0a92-5b24826c015c&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Neltharion-and-Arthas"><a href="#Neltharion-and-Arthas" class="headerlink" title="Neltharion and Arthas"></a>Neltharion and Arthas</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Neltharion and Arthas</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">key1 = os.urandom(<span class="number">32</span>)</span><br><span class="line">key2 = <span class="string">b&#x27;tn*-ix6L*tCa*&#125;i*&#x27;</span></span><br><span class="line">key_len = <span class="built_in">len</span>(key2)</span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;flag&#123;&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> (flag[<span class="number">13</span>] == <span class="number">45</span> <span class="keyword">and</span> flag[<span class="number">18</span>] == <span class="number">45</span> <span class="keyword">and</span> flag[<span class="number">23</span>] == <span class="number">45</span> <span class="keyword">and</span> flag[<span class="number">28</span>] == <span class="number">45</span>)</span><br><span class="line">flag1 = <span class="string">b&quot;2023: &quot;</span>+flag[:<span class="number">13</span>]+flag[<span class="number">14</span>:<span class="number">18</span>]+flag[<span class="number">19</span>:<span class="number">23</span>]</span><br><span class="line">flag2 = </span><br><span class="line"></span><br><span class="line">h = binascii.unhexlify(hashlib.sha256(key2).hexdigest())[:<span class="number">11</span>]</span><br><span class="line">gift1 = <span class="string">b&#x27;***********************************************************************************************&#x27;</span></span><br><span class="line">gift2 = <span class="string">b&#x27;I tell you this, for when my days have come to an end , you, shall be King.&#x27;</span>+h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt1</span>(<span class="params">message, key</span>):</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CTR, counter=Counter.new(<span class="number">128</span>))</span><br><span class="line">    ciphertext = cipher.encrypt(message)</span><br><span class="line">    <span class="keyword">return</span> ciphertext.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt2</span>(<span class="params">message, key, iv</span>):</span><br><span class="line">    padding = <span class="built_in">bytes</span>((key_len - <span class="built_in">len</span>(message) % key_len) * <span class="string">&#x27;&amp;&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    message += padding</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    ciphertext = cipher.encrypt(message)</span><br><span class="line">    <span class="keyword">return</span> ciphertext.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;enc_gift1 = &quot;</span>+encrypt1(gift1, key1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;enc_flag = &quot;</span>+encrypt1(flag1, key1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;enc_gift2 = &quot;</span>+encrypt2(gift2, key2, flag2))</span><br></pre></td></tr></table></figure>
<p>output：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enc_gift1 = bad7dbcff968d7cdbf51da011fe94e176fc8e7528e4dd85d2d5fc20ba69cefb7bfd03152a2874705bd2d857ea75b3216a830215db74772d9b9e9c218271d562694d3642d2917972fdb8c7363d8125730a50824cd8dc7e34cd4fa54be427cca</span><br><span class="line">enc_flag = c1c78891e30cd4c0aa5ed65c17e8550429c4e640881f9f1d6a56df</span><br><span class="line">enc_gift2 = ********c********b**************<span class="number">4</span>***<span class="number">5</span>********<span class="number">3</span>****6a*****a**<span class="number">2</span>********c*<span class="number">8</span>******<span class="number">7</span>***********<span class="number">3</span>***<span class="number">5</span>***<span class="number">2</span>********e*<span class="number">5</span>*************a******<span class="number">5</span>**c***<span class="number">74</span>***********fee046b4d2918096cfa3b76d6622914395c7e28eef</span><br></pre></td></tr></table></figure>
<p>我个人觉得这个题复杂度设置的有点高了，导致debug有点不是很方便，中途发现写错了，幸好及时修改，差点就没出。</p>
<p>回到题目，他将题目分为了两部分，对应flag的两半：</p>
<ul>
<li>第一部分，将flag1用AES_CTR加密，并对gift1同样进行AES_CTR加密，并给出两个密文。同时，隐去gift1，并且密钥key是未知的随机字节</li>
<li>第二部分，将flag2当作AES_CBC模式的iv，对gift2加上一段哈希并padding的明文进行加密，并给出部分密文</li>
</ul>
<p>接下来分两个部分分别阐述：</p>
<h4 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h4><p>首先能注意到，对flag1和gift1的加密共用了一个counter以及密钥，因此由CTR的加密方式我们知道：</p>
<script type="math/tex; mode=display">
flag1 = encflag1 \oplus encgift1 \oplus gift1</script><p>对CTR加密不太清楚的可以看我写的另一篇文章的第三题：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/a5bd8c0d.html">Crypto趣题-分组密码 | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>那么也就是说，如果我们能有gift1，就可以还原出flag1.但是问题就是：gift1被隐去了。</p>
<p>但是我们有flag的前六个字节”2023: “，同样运用异或就可以得到gift1的前六个字节，是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;I am D&quot;</span></span><br></pre></td></tr></table></figure>
<p>接下来略脑洞(不过其实也还好，提示很明显)，由题目标题Neltharion and Arthas可以搜到这是两个魔兽世界的人物，而gift2是第二个人物的台词。那么结合这个前缀，合理推测gift1也是一句台词，果然就搜到：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I am Deathwing, the destroyer, the end of <span class="built_in">all</span> things. Inevitable. Indomitable. I. am. the Cataclysm...!</span><br></pre></td></tr></table></figure>
<p>对其中一些大小写以及空格略作修改后，上面这一行gift1就可以解密出正确flag1了。</p>
<h4 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h4><p>有一个地方我看了很久才反应过来，就是这个key2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key2 = <span class="string">b&#x27;tn*-ix6L*tCa*&#125;i*&#x27;</span></span><br></pre></td></tr></table></figure>
<p>由于它本身也有一些不是字母数字的字符，这导致我开始没有意识到这个*符号是对key2的涂抹，还以为他本来就是key2的字符。</p>
<p>弄清楚这一点就好办了，爆破四个可见字符，并以enc_gift2的最后一个完整密文分组为基础，依次解每个密文分组，就能得到正确的iv也就是flag2。</p>
<p>只是4个可见字符确实要的时间也比较久，再晚一点发现程序写错了的话，比赛时间内还真出不了了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 CTR</span></span><br><span class="line">gift1 = <span class="string">b&quot;I am Deathwing, the destroyer, the end of all things. Inevitable. Indomitable. I. am. the Cataclysm...!&quot;</span></span><br><span class="line">enc_gift1 = <span class="string">&quot;bad7dbcff968d7cdbf51da011fe94e176fc8e7528e4dd85d2d5fc20ba69cefb7bfd03152a2874705bd2d857ea75b3216a830215db74772d9b9e9c218271d562694d3642d2917972fdb8c7363d8125730a50824cd8dc7e34cd4fa54be427cca&quot;</span></span><br><span class="line">enc_flag =  <span class="string">&quot;c1c78891e30cd4c0aa5ed65c17e8550429c4e640881f9f1d6a56df&quot;</span></span><br><span class="line">enc_gift1 = long_to_bytes(<span class="built_in">int</span>(enc_gift1,<span class="number">16</span>))</span><br><span class="line">enc_flag = long_to_bytes(<span class="built_in">int</span>(enc_flag,<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(xor(xor(enc_gift1,enc_flag),gift1)[:<span class="number">27</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 CBC</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt2</span>(<span class="params">c, kkey, m</span>):</span><br><span class="line">    temp = long_to_bytes(<span class="built_in">int</span>(c,<span class="number">16</span>))</span><br><span class="line">    cipher = AES.new(kkey, AES.MODE_ECB)</span><br><span class="line">    ciphertext = cipher.decrypt(temp)</span><br><span class="line">    <span class="keyword">return</span> xor(ciphertext,m).<span class="built_in">hex</span>().zfill(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">key2 = <span class="string">b&#x27;tn*-ix6L*tCa*&#125;i*&#x27;</span></span><br><span class="line">key_len = <span class="number">16</span></span><br><span class="line">gift2 = <span class="string">b&#x27;I tell you this, for when my days have come to an end , you, shall be King.&#x27;</span></span><br><span class="line">padding = <span class="number">10</span>*<span class="string">b&quot;&amp;&quot;</span></span><br><span class="line"></span><br><span class="line">enc_gift2 = <span class="string">&quot;********c********b**************4***5********3****6a*****a**2********c*8******7***********3***5***2********e*5*************a******5**c***74***********fee046b4d2918096cfa3b76d6622914395c7e28eef&quot;</span></span><br><span class="line">suffix = enc_gift2[-<span class="number">32</span>:]</span><br><span class="line">table = [<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment">#21</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> table[<span class="number">21</span>:]:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> tqdm(table):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> table:</span><br><span class="line">            <span class="keyword">for</span> oo <span class="keyword">in</span> table:</span><br><span class="line">                kkey = <span class="string">b&#x27;tn&#x27;</span>+ i.encode() + <span class="string">b&quot;-ix6L&quot;</span> + j.encode() + <span class="string">b&quot;tCa&quot;</span> + k.encode() + <span class="string">b&quot;&#125;i&quot;</span> + oo.encode()</span><br><span class="line">                h = binascii.unhexlify(hashlib.sha256(kkey).hexdigest())[:<span class="number">11</span>]</span><br><span class="line">                C = [suffix]</span><br><span class="line"></span><br><span class="line">                temp11 = gift2 + h + padding</span><br><span class="line">                M = [temp11[<span class="number">16</span>*tt:<span class="number">16</span>*tt+<span class="number">16</span>] <span class="keyword">for</span> tt <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>)]</span><br><span class="line">                temp = decrypt2(C[<span class="number">0</span>], kkey, M[<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(temp.endswith(<span class="string">&quot;fee046b4d2&quot;</span>)):</span><br><span class="line">                    <span class="keyword">for</span> tt <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">                        C.append(decrypt2(C[tt], kkey, M[<span class="number">5</span>-tt]))</span><br><span class="line">                    flag2 = long_to_bytes(<span class="built_in">int</span>(C[-<span class="number">1</span>],<span class="number">16</span>))</span><br><span class="line">                    <span class="keyword">for</span> nn <span class="keyword">in</span> C[::-<span class="number">1</span>]:</span><br><span class="line">                        <span class="built_in">print</span>(nn,end = <span class="string">&quot;&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(flag2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2023: flag&#123;4ff732dd-2b74-45fd-a3ea-e82b4c491e0e&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="colorful-matrix"><a href="#colorful-matrix" class="headerlink" title="colorful_matrix"></a>colorful_matrix</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colorful_matrix</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([a[i%<span class="built_in">len</span>(a)] ^ b[i%<span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line">flag = <span class="string">b&#x27;flag&#123;xxxxxx&#125;&#x27;</span></span><br><span class="line">key1 = hashlib.md5(os.urandom(<span class="number">16</span>)).hexdigest().encode()</span><br><span class="line">key2 = hashlib.md5(os.urandom(<span class="number">16</span>)).hexdigest().encode()</span><br><span class="line">num1 = <span class="number">5</span></span><br><span class="line">p = <span class="built_in">int</span>(gmpy2.next_prime(bytes_to_long(key1 + os.urandom(<span class="number">64</span>))))</span><br><span class="line">ms = [random.getrandbits(<span class="number">256</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num1)]</span><br><span class="line">qs = [getPrime(<span class="number">1024</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num1)]</span><br><span class="line">ns = [p * qs[_] + ms[_] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num1)]</span><br><span class="line"></span><br><span class="line">num2 = <span class="number">37</span></span><br><span class="line">x = bytes_to_long(key2 + os.urandom(<span class="number">32</span>))</span><br><span class="line">A = []</span><br><span class="line">B = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num2):</span><br><span class="line">    a = random.getrandbits(<span class="number">512</span>)</span><br><span class="line">    b = a * x % p</span><br><span class="line">    gift = (<span class="number">2</span> ** <span class="number">128</span> - <span class="number">1</span>) * <span class="number">2</span> ** <span class="number">400</span></span><br><span class="line">    A.append(a)</span><br><span class="line">    B.append((b &amp; gift) &gt;&gt; <span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">iv = long_to_bytes(random.getrandbits(<span class="number">128</span>))</span><br><span class="line">key = xor(key1,key2)</span><br><span class="line">aes = AES.new(key1,AES.MODE_CBC,iv)</span><br><span class="line">enc = aes.encrypt(pad(flag,<span class="number">48</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;ns = <span class="subst">&#123;ns&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;A = <span class="subst">&#123;A&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;B = <span class="subst">&#123;B&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment"># ns = [38630062416586710341458654419912504176237737247477839749085033080367529539859992076587411537805430366799412095876782912512744262957062106155418341531142309858429218208463637096843365217114990765965110566415965985105403996944993619708417839598461935470469097206342256014086162845948208599334925650727933097059538199199685364793545286980392966271769914201657672004082101110775504946586957241075964270454872257405872181588544468173017149763827540561921126826597515171761064800381983526515300315517818122598179574900255685121991744205071544970, 41522753602903133841910260331594875922287719226997542592715810409935551768308104573333760854332533376702631593490915962706512143045107096658851885513727202513616813054397657610854303071682604806070009002234312854968365250748142324994926715544722158698813288131533399544263105858513134170084625526223987620550110255872688155827773099232631041345207194483609514502522566888883736218471849075697433311580004701384847571029783514418685068903758509270527252444771313048094566344002411364378658592832008194309873599342916391769027015343562030852, 41542983120532762175372001624404625565366126179958909731196555044290633581761361918706298428954501507557598076910710787422049443564800530253137695341299743714514361560156305534490483794181933110893966453220306980682146624294992100948497284459992930850081254114996830645068636306625330524465991656430799359422407117440063911943625477783216502523414967017151717597372146324488526509879620785458016456593044828784565522423332830549325397893426472247197776412026158371655860380929692662547882654137064941217130915364306358205055760044763651406, 42853015443318352230776688785915441259875645365236808434164117288657978345098324019250085686482568413223085548506789311679316323466083886556772338612177680666217592255234589446979456714341877135596118517098603502394776049958587301113539552072352462301070489369653155854389890761241450743607560719433910573462283304103064437843063566946231984094581307498714742271881862348689297267558023093643893310002803310596286441071314219020032740336515363830250477649030557311461077069407775907176409762823453607196260454965048316567154365877848652918, 31152961872836435078296602982779340735140569916125711058616435902653202922218293684857125091648631460215120167354825278469413413558325850576700866199515219603448136082693185200558425103833947831228064760642508443585470729998592994719564254894176473779555436230174300038353978808432410463449170865897259181312953584408177790825688497584119467820716449210429423337019604137134889051973100340798405991782200038835066294194815913887924272593864934325496116821854183293510325217934617021428710898873475027666892706022106386340733691632884942848]</span></span><br><span class="line"><span class="comment"># A = [12789809461864875489953273982997537541385904671489556544122095227619591140533414669794423644619127980362623481580128258914287474542792728686579090501397390, 10463950513938701625808784986819665844287315724639315128677227520960105897990256530542006653611594269012930935073966767351788182657861624733138283749460454, 5253244650607533810967862436125419800679723144526973463211784033045021824966560017919956773745212139142517766154626849426827164032731516615725539069585525, 5644589184984504085855423002268477365020278981591337230721358313393863912025011466727192648804002734561676112555123877764178690726130713927642577324443238, 4231732567865883627242742552738439372803539125622706171540910152922080004603138662537022248675968288205781990968838888633816697065257733344028576518431020, 2483388920404524165854675814798022834892112957478917588986471421083048888193527751575039626887367465858751417977246719312923814782809309525841102293919541, 3252353812256192711411255830105475125944842449239880454539397067913664088094160819193268643401968970009466652179043139341471403913410402646923633696154454, 11575010486066232687430367040977113580882826853104996856464797182632266635060724100357205810604915010810884387573114266349621457564659060272935537811111850, 116107444921917032985259963199427176510900273385517435613848456370557161312731449337837406563733552524777525870560544042690403987311424820755256727586807, 5859050133610438843641532306693688255014116940390205022708310454673159702673207152462501010791971695002865650407033762568636006764435795015869726867643634, 5954075553161305677556950650395792531753502207483036473422070018485916621872566706504374038792527687442272405589975343003802956899043321092006127828986114, 4571747544457157571652286537158051402285727327066029382085461714597609990601683125994983291866807816649968826930652068427193317966970789937746419206862747, 7166507561570980603812241332170524724051295937096000768984168029904561160020043035660087151672164814332446644696618077835020463308343415953131944864257266, 4852042788460566411381271873349329096978244586097817622748766708426751073559942708861852208085367014057217116211249133109246735634468823924185525972777655, 11962941918999276757181090570698839032103646409734781047194175833198626142790676141060052011581957980660140931408560130449153056874213033784715711461403345, 10324508881746579337486319574059121005227580732153432145860775835052420139026016902518605634385512021513380467928195663920843022679549517463264144660593354, 13276257094435850052122403884510025189232513948002582716865201271569293297601525601586036713056700716929820641888489806178376555435219630186396004003438962, 6525051273399089095687950615197786094425890004112675057642687348101531212837185750558500720306108976630502328600886080197626115513445112562084719104488315, 12922888505610354933000354792496863801007995464403098763485264334670452387681468617068312646367483171083114539083453125614861357751571161533921864394641576, 9489726784141062031514945333087338495823600723655465328127755755022980083351477888038160719541864899912899592065620071698977397662002448273876711116012763, 10630316198843195148937849513165933809121991192035364160395429088101265852052098101114542104327663563661384303617672183366879116750889320604308038959012109, 12675564142993964272844760955973914547747654087592111324261755301551267959231076883765863344473167582531968290671984039948163579495803204811731286282708940, 11847724105274460405216443356582445218232627275228120716891711887600046501095390733716854871561352002320819466803698088448952127166615410820121973485089326, 5131676593756685549522564504727003861447389891839469018437277330988047271086971907217360711863971849879439418231726349935396008040776952541710218842744018, 8049060452950901277510497437779182190254362319091882684392717180429468875432078713802857488901441344429723298843967365750616860588029426099852763482179470, 2365060249260571713545479629411006471094806409182638354076861269679377537605360223984548798658469783472746989448405310909017645138161178501458084966625559, 7467521246204465304438401242342633361751371318557249418344587207503257890765643838557008735305668588521988487342275527781708126255070883848829062790678347, 5841608816993144092409175658260479687582056537041472535819914412630519543198558564258699185557903902095773598614097026740427138629173672250387442834578787, 3935779917509948624841228665498558015416911059417306651751360048412619176423173794541812556512582747588138532941031730797102738268660078594473168666677171, 1459083415233950534805962555425717865938763752937036513111696179351002303817986848490146888626704327653287774806488952733813718461674376764427084478395399, 6426876689549337938550615491086475536072547585103523407263007393570982327518298678278232288342601754164640081474537962710401178482959474762541185760732929, 5241364650650467046722868257809607948071188801137204831449976666385482519613365369974704486723941517654753205012497273820309153659423928739972270634209996, 6387483223002092292686097811446217867743566298067033295601210265979889577756648605354064672061975949925472022416479935990178719227937307079186916383092053, 170562164015232424518655058158727202269056868720093972639058422975773575660534168774299548952867348396798580779605954510297102765330549642318362861226163, 10004133230245713370426176448219282796530473722412487408402635996842671302539458739305597027107498342509248085998067976408732789438099488867425813748783724, 12325342879747412722323355648741345730921040452129462974449188258885453690169624888480720109964630270938743431623479816739889661554987977051169401841580388, 641543989928732942291347866597230552820621633110802944556141221591498546555080480758772801043509130524233886009444044150447511986129019395067102094826363]</span></span><br><span class="line"><span class="comment"># B = [108715652691370707411987210267535348806, 131676833696101475747102644851662113271, 122436706338521558335484593966234623745, 255864866572301552398412638474857375629, 81098761191414480003681301866161112100, 322322463176364397336266169283851913620, 198167679309202772183020662350938553923, 326360662842236388778385468938922853242, 241812832858991643670485138860832357660, 69768236619183466076110136290750715548, 32383134960394164339076842474280712870, 147747232748027508904245311745435517130, 25327826075608705748116808975774398964, 65295332681674581261444632606267440749, 236756211690281667988216748814564193312, 106435149910135092172124474857722935730, 270727089812520941022075406571244846193, 206881193220261276126028739930244917728, 131961838897694897398340205404861333362, 219211823942216355573832791993673934321, 150960424777134558142309786444952807101, 51112048255939343109218372373173385772, 182065623911902509203036774197184164110, 168420344895532090057957641972492853410, 301808673225362418769168353084541667053, 132272458662433671393247350648662880688, 495672626901999558635736361346563007, 182444159345379042372018248514964944782, 144584137563407779776361378564517880036, 338518705859818740467225748906995999694, 205885429741815676881969528495365151019, 233897982464483450790005953366237992668, 279307677123402840425362992920185630901, 133493426228159673166382443820069696429, 316624110847744871475435405969944304329, 187931604382397525131117897387179435812, 220019728924915067987393012581921164417]</span></span><br><span class="line"><span class="comment"># enc = b&#x27;cTmkMb\xfc\x05|\x1d\xc7\x13\xbaSe\xe0\xbd\xc0\xd9\xa3\x8cwo\x82yN[B&amp;\x80\xd7KPwQ`\x9c\xbf&lt;y\x8e\x8a\x97e\xa074\xb2&#x27;</span></span><br></pre></td></tr></table></figure>
<p>这个题目弄的心情有点烦躁，因为求解key1很容易，难度主要在求解key2。但是出题人失误了，最后AES用的仍然是key1，而不是key1和key2异或得到的key，这样难度就一点都没有了。</p>
<p>不过我还是会把两个部分都讲一下。</p>
<p>首先，第一部分很显然是个AGCD问题，不清楚的指路la佬博客：</p>
<p><a target="_blank" rel="noopener" href="https://lazzzaro.github.io/2020/11/07/crypto-格密码/">格密码 | Lazzaro (lazzzaro.github.io)</a></p>
<p>那么就可以求解出ms数组和p以及key1。</p>
<p>其实这道题问题到这里就已经结束了，由于A数组已经给定，并且A和ms生成的方式都是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getrandbits()</span><br></pre></td></tr></table></figure>
<p>那么又可以利用MT19937，只是这一次我们是向后预测iv。预测完iv后直接解AES就得到flag。</p>
<p>然后接下来就说一下我做出来了发现没用的第二部分，第二部分难度我觉得相对来说大很多。</p>
<p>第二部分里，我们有多组如下式子：</p>
<script type="math/tex; mode=display">
b_i = a_ix \quad(mod\;p)</script><p>但是bi只泄漏了中间一些位，高位和低位是没有的，因此我们需要构造HNP，构造思路如下：</p>
<p>首先，x是一个512比特的数，肯定不能出现在我们要规约的短向量中，因此要消元，消元方式就是两两作差，在这里我们选择将所有项与第0项作差，如下：</p>
<p>由于：</p>
<script type="math/tex; mode=display">
b_0 = a_0x \quad(mod\;p)</script><script type="math/tex; mode=display">
b_i = a_ix \quad(mod\;p)</script><p>所以有：</p>
<script type="math/tex; mode=display">
b_0a_i = a_ia_0x \quad(mod\;p)</script><script type="math/tex; mode=display">
b_ia_0 = a_ia_0x \quad(mod\;p)</script><p>作差即可得到：</p>
<script type="math/tex; mode=display">
b_ia_0 = b_0a_i \quad(mod\;p)</script><p>然后把a0乘过去：</p>
<script type="math/tex; mode=display">
b_i = a_0^{-1}a_ib_0 \quad(mod\;p)</script><p>由于已知bi的中间128位，所以我们可以把bi和b0拆为三部分：</p>
<script type="math/tex; mode=display">
2^{528}b_{hi} + 2^{400}b_{leaki} + b_{li}  = a_0^{-1}a_i(2^{528}b_{h0} + 2^{400}b_{leak0} + b_{l0}) \quad(mod\;p)</script><p>两边均出现了已知的bleak项，提取到一边去：</p>
<script type="math/tex; mode=display">
2^{528}b_{hi} + b_{li}  = a_0^{-1}a_i(2^{528}b_{h0} + 2^{400}b_{leak0} + b_{l0}) - 2^{400}b_{leaki}\quad(mod\;p)</script><p>把常数项凑起来：</p>
<script type="math/tex; mode=display">
2^{528}b_{hi} + b_{li}  = a_0^{-1}a_i(2^{528}b_{h0} + b_{l0}) - 2^{400}b_{leaki} + a_0^{-1}a_i2^{400}b_{leak0}\quad(mod\;p)</script><p>然后，令：</p>
<script type="math/tex; mode=display">
A_i = a_0^{-1}a_i</script><script type="math/tex; mode=display">
B_i =  - 2^{400}b_{leaki} + a_0^{-1}a_i2^{400}b_{leak0}</script><p>就有形式：</p>
<script type="math/tex; mode=display">
2^{528}b_{hi} + b_{li}  = A_i(2^{528}b_{h0} + b_{l0})+B_i \quad(mod\;p)</script><p>然后把模p去掉化成等式：</p>
<script type="math/tex; mode=display">
2^{528}b_{hi} + b_{li}  = A_i(2^{528}b_{h0} + b_{l0})+B_i +t_ip</script><p>就是个HNP问题了，只不过是二元的。而这个形式正好前段时间有师傅问过我，是这篇的SSSMMM一题：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/9b40da15.html">Crypto趣题-Lattice | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>构造形式完全一样，不明白的师傅可以去看看。</p>
<p>然后这题目里，LLL后的第一行就是目标向量，因此我们就可以求解出所有完整的b，从中随便选一组等式也就有key2。但是求完了key2惊奇地发现，<strong>居然没用</strong>！最后也没上这题的revenge，心痛。</p>
<p>exp(完整的两部分，包含两个key的求解)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 AGCD</span></span><br><span class="line">kbits = <span class="number">256</span></span><br><span class="line"></span><br><span class="line">Q = [<span class="number">38630062416586710341458654419912504176237737247477839749085033080367529539859992076587411537805430366799412095876782912512744262957062106155418341531142309858429218208463637096843365217114990765965110566415965985105403996944993619708417839598461935470469097206342256014086162845948208599334925650727933097059538199199685364793545286980392966271769914201657672004082101110775504946586957241075964270454872257405872181588544468173017149763827540561921126826597515171761064800381983526515300315517818122598179574900255685121991744205071544970</span>, <span class="number">41522753602903133841910260331594875922287719226997542592715810409935551768308104573333760854332533376702631593490915962706512143045107096658851885513727202513616813054397657610854303071682604806070009002234312854968365250748142324994926715544722158698813288131533399544263105858513134170084625526223987620550110255872688155827773099232631041345207194483609514502522566888883736218471849075697433311580004701384847571029783514418685068903758509270527252444771313048094566344002411364378658592832008194309873599342916391769027015343562030852</span>, <span class="number">41542983120532762175372001624404625565366126179958909731196555044290633581761361918706298428954501507557598076910710787422049443564800530253137695341299743714514361560156305534490483794181933110893966453220306980682146624294992100948497284459992930850081254114996830645068636306625330524465991656430799359422407117440063911943625477783216502523414967017151717597372146324488526509879620785458016456593044828784565522423332830549325397893426472247197776412026158371655860380929692662547882654137064941217130915364306358205055760044763651406</span>, <span class="number">42853015443318352230776688785915441259875645365236808434164117288657978345098324019250085686482568413223085548506789311679316323466083886556772338612177680666217592255234589446979456714341877135596118517098603502394776049958587301113539552072352462301070489369653155854389890761241450743607560719433910573462283304103064437843063566946231984094581307498714742271881862348689297267558023093643893310002803310596286441071314219020032740336515363830250477649030557311461077069407775907176409762823453607196260454965048316567154365877848652918</span>, <span class="number">31152961872836435078296602982779340735140569916125711058616435902653202922218293684857125091648631460215120167354825278469413413558325850576700866199515219603448136082693185200558425103833947831228064760642508443585470729998592994719564254894176473779555436230174300038353978808432410463449170865897259181312953584408177790825688497584119467820716449210429423337019604137134889051973100340798405991782200038835066294194815913887924272593864934325496116821854183293510325217934617021428710898873475027666892706022106386340733691632884942848</span>]</span><br><span class="line"></span><br><span class="line">L = Matrix(ZZ,<span class="number">5</span>,<span class="number">5</span>)</span><br><span class="line">L[<span class="number">0</span>,<span class="number">0</span>] = <span class="number">2</span>^(kbits)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">    L[<span class="number">0</span>,i] = Q[i]</span><br><span class="line">    L[i,i] = -Q[<span class="number">0</span>]</span><br><span class="line">res = L.LLL()[<span class="number">0</span>]</span><br><span class="line">q0 = <span class="built_in">int</span>(<span class="built_in">abs</span>(res[<span class="number">0</span>]) // L[<span class="number">0</span>,<span class="number">0</span>])</span><br><span class="line">p = <span class="built_in">int</span>(<span class="built_in">abs</span>(Q[<span class="number">0</span>]) // q0)</span><br><span class="line"></span><br><span class="line">key1 = long_to_bytes(p)[:<span class="number">32</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#recover ms</span></span><br><span class="line">q1 = <span class="built_in">int</span>((q0*Q[<span class="number">1</span>]+res[<span class="number">1</span>]) // Q[<span class="number">0</span>])</span><br><span class="line">q2 = <span class="built_in">int</span>((q0*Q[<span class="number">2</span>]+res[<span class="number">2</span>]) // Q[<span class="number">0</span>])</span><br><span class="line">q3 = <span class="built_in">int</span>((q0*Q[<span class="number">3</span>]+res[<span class="number">3</span>]) // Q[<span class="number">0</span>])</span><br><span class="line">q4 = <span class="built_in">int</span>((q0*Q[<span class="number">4</span>]+res[<span class="number">4</span>]) // Q[<span class="number">0</span>])</span><br><span class="line">m0 = Q[<span class="number">0</span>] - p*q0</span><br><span class="line">m1 = Q[<span class="number">1</span>] - p*q1</span><br><span class="line">m2 = Q[<span class="number">2</span>] - p*q2</span><br><span class="line">m3 = Q[<span class="number">3</span>] - p*q3</span><br><span class="line">m4 = Q[<span class="number">4</span>] - p*q4</span><br><span class="line">ms = [m0,m1,m2,m3,m4]</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 HNP</span></span><br><span class="line">length = <span class="number">36</span></span><br><span class="line">a = [<span class="number">12789809461864875489953273982997537541385904671489556544122095227619591140533414669794423644619127980362623481580128258914287474542792728686579090501397390</span>, <span class="number">10463950513938701625808784986819665844287315724639315128677227520960105897990256530542006653611594269012930935073966767351788182657861624733138283749460454</span>, <span class="number">5253244650607533810967862436125419800679723144526973463211784033045021824966560017919956773745212139142517766154626849426827164032731516615725539069585525</span>, <span class="number">5644589184984504085855423002268477365020278981591337230721358313393863912025011466727192648804002734561676112555123877764178690726130713927642577324443238</span>, <span class="number">4231732567865883627242742552738439372803539125622706171540910152922080004603138662537022248675968288205781990968838888633816697065257733344028576518431020</span>, <span class="number">2483388920404524165854675814798022834892112957478917588986471421083048888193527751575039626887367465858751417977246719312923814782809309525841102293919541</span>, <span class="number">3252353812256192711411255830105475125944842449239880454539397067913664088094160819193268643401968970009466652179043139341471403913410402646923633696154454</span>, <span class="number">11575010486066232687430367040977113580882826853104996856464797182632266635060724100357205810604915010810884387573114266349621457564659060272935537811111850</span>, <span class="number">116107444921917032985259963199427176510900273385517435613848456370557161312731449337837406563733552524777525870560544042690403987311424820755256727586807</span>, <span class="number">5859050133610438843641532306693688255014116940390205022708310454673159702673207152462501010791971695002865650407033762568636006764435795015869726867643634</span>, <span class="number">5954075553161305677556950650395792531753502207483036473422070018485916621872566706504374038792527687442272405589975343003802956899043321092006127828986114</span>, <span class="number">4571747544457157571652286537158051402285727327066029382085461714597609990601683125994983291866807816649968826930652068427193317966970789937746419206862747</span>, <span class="number">7166507561570980603812241332170524724051295937096000768984168029904561160020043035660087151672164814332446644696618077835020463308343415953131944864257266</span>, <span class="number">4852042788460566411381271873349329096978244586097817622748766708426751073559942708861852208085367014057217116211249133109246735634468823924185525972777655</span>, <span class="number">11962941918999276757181090570698839032103646409734781047194175833198626142790676141060052011581957980660140931408560130449153056874213033784715711461403345</span>, <span class="number">10324508881746579337486319574059121005227580732153432145860775835052420139026016902518605634385512021513380467928195663920843022679549517463264144660593354</span>, <span class="number">13276257094435850052122403884510025189232513948002582716865201271569293297601525601586036713056700716929820641888489806178376555435219630186396004003438962</span>, <span class="number">6525051273399089095687950615197786094425890004112675057642687348101531212837185750558500720306108976630502328600886080197626115513445112562084719104488315</span>, <span class="number">12922888505610354933000354792496863801007995464403098763485264334670452387681468617068312646367483171083114539083453125614861357751571161533921864394641576</span>, <span class="number">9489726784141062031514945333087338495823600723655465328127755755022980083351477888038160719541864899912899592065620071698977397662002448273876711116012763</span>, <span class="number">10630316198843195148937849513165933809121991192035364160395429088101265852052098101114542104327663563661384303617672183366879116750889320604308038959012109</span>, <span class="number">12675564142993964272844760955973914547747654087592111324261755301551267959231076883765863344473167582531968290671984039948163579495803204811731286282708940</span>, <span class="number">11847724105274460405216443356582445218232627275228120716891711887600046501095390733716854871561352002320819466803698088448952127166615410820121973485089326</span>, <span class="number">5131676593756685549522564504727003861447389891839469018437277330988047271086971907217360711863971849879439418231726349935396008040776952541710218842744018</span>, <span class="number">8049060452950901277510497437779182190254362319091882684392717180429468875432078713802857488901441344429723298843967365750616860588029426099852763482179470</span>, <span class="number">2365060249260571713545479629411006471094806409182638354076861269679377537605360223984548798658469783472746989448405310909017645138161178501458084966625559</span>, <span class="number">7467521246204465304438401242342633361751371318557249418344587207503257890765643838557008735305668588521988487342275527781708126255070883848829062790678347</span>, <span class="number">5841608816993144092409175658260479687582056537041472535819914412630519543198558564258699185557903902095773598614097026740427138629173672250387442834578787</span>, <span class="number">3935779917509948624841228665498558015416911059417306651751360048412619176423173794541812556512582747588138532941031730797102738268660078594473168666677171</span>, <span class="number">1459083415233950534805962555425717865938763752937036513111696179351002303817986848490146888626704327653287774806488952733813718461674376764427084478395399</span>, <span class="number">6426876689549337938550615491086475536072547585103523407263007393570982327518298678278232288342601754164640081474537962710401178482959474762541185760732929</span>, <span class="number">5241364650650467046722868257809607948071188801137204831449976666385482519613365369974704486723941517654753205012497273820309153659423928739972270634209996</span>, <span class="number">6387483223002092292686097811446217867743566298067033295601210265979889577756648605354064672061975949925472022416479935990178719227937307079186916383092053</span>, <span class="number">170562164015232424518655058158727202269056868720093972639058422975773575660534168774299548952867348396798580779605954510297102765330549642318362861226163</span>, <span class="number">10004133230245713370426176448219282796530473722412487408402635996842671302539458739305597027107498342509248085998067976408732789438099488867425813748783724</span>, <span class="number">12325342879747412722323355648741345730921040452129462974449188258885453690169624888480720109964630270938743431623479816739889661554987977051169401841580388</span>, <span class="number">641543989928732942291347866597230552820621633110802944556141221591498546555080480758772801043509130524233886009444044150447511986129019395067102094826363</span>]</span><br><span class="line">b = [<span class="number">108715652691370707411987210267535348806</span>, <span class="number">131676833696101475747102644851662113271</span>, <span class="number">122436706338521558335484593966234623745</span>, <span class="number">255864866572301552398412638474857375629</span>, <span class="number">81098761191414480003681301866161112100</span>, <span class="number">322322463176364397336266169283851913620</span>, <span class="number">198167679309202772183020662350938553923</span>, <span class="number">326360662842236388778385468938922853242</span>, <span class="number">241812832858991643670485138860832357660</span>, <span class="number">69768236619183466076110136290750715548</span>, <span class="number">32383134960394164339076842474280712870</span>, <span class="number">147747232748027508904245311745435517130</span>, <span class="number">25327826075608705748116808975774398964</span>, <span class="number">65295332681674581261444632606267440749</span>, <span class="number">236756211690281667988216748814564193312</span>, <span class="number">106435149910135092172124474857722935730</span>, <span class="number">270727089812520941022075406571244846193</span>, <span class="number">206881193220261276126028739930244917728</span>, <span class="number">131961838897694897398340205404861333362</span>, <span class="number">219211823942216355573832791993673934321</span>, <span class="number">150960424777134558142309786444952807101</span>, <span class="number">51112048255939343109218372373173385772</span>, <span class="number">182065623911902509203036774197184164110</span>, <span class="number">168420344895532090057957641972492853410</span>, <span class="number">301808673225362418769168353084541667053</span>, <span class="number">132272458662433671393247350648662880688</span>, <span class="number">495672626901999558635736361346563007</span>, <span class="number">182444159345379042372018248514964944782</span>, <span class="number">144584137563407779776361378564517880036</span>, <span class="number">338518705859818740467225748906995999694</span>, <span class="number">205885429741815676881969528495365151019</span>, <span class="number">233897982464483450790005953366237992668</span>, <span class="number">279307677123402840425362992920185630901</span>, <span class="number">133493426228159673166382443820069696429</span>, <span class="number">316624110847744871475435405969944304329</span>, <span class="number">187931604382397525131117897387179435812</span>, <span class="number">220019728924915067987393012581921164417</span>]</span><br><span class="line"></span><br><span class="line">A = []</span><br><span class="line">B = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,length):</span><br><span class="line">    temp = inverse(a[<span class="number">0</span>],p)*a[i] % p</span><br><span class="line">    A.append(temp)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,length):</span><br><span class="line">    temp = inverse(a[<span class="number">0</span>],p)*a[i] % p</span><br><span class="line">    temp = temp * b[<span class="number">0</span>]*(<span class="number">2</span>^<span class="number">400</span>) - b[i]*(<span class="number">2</span>^<span class="number">400</span>)</span><br><span class="line">    temp = temp % p</span><br><span class="line">    B.append(temp)</span><br><span class="line"></span><br><span class="line">O = matrix(ZZ,(length-<span class="number">1</span>),(length-<span class="number">1</span>)+<span class="number">3</span>)</span><br><span class="line">E = diagonal_matrix([<span class="number">2</span>^<span class="number">160</span>]*((length-<span class="number">1</span>)+<span class="number">3</span>))</span><br><span class="line">T1 = diagonal_matrix([p]*((length-<span class="number">1</span>)))</span><br><span class="line">T2 = matrix(ZZ,(length-<span class="number">1</span>)+<span class="number">3</span>,length-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length-<span class="number">1</span>):</span><br><span class="line">    T2[i,i] = <span class="number">2</span>^<span class="number">528</span></span><br><span class="line">    T2[-<span class="number">1</span>,i] = -B[i]</span><br><span class="line">    T2[-<span class="number">2</span>,i] = -A[i]</span><br><span class="line">    T2[-<span class="number">3</span>,i] = -A[i] * <span class="number">2</span>^<span class="number">528</span></span><br><span class="line"></span><br><span class="line">L = block_matrix(ZZ,[[T1,O],[T2,E]])</span><br><span class="line"></span><br><span class="line">K = <span class="number">2</span>^<span class="number">400</span></span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = K</span><br><span class="line">L[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">L[-<span class="number">3</span>,-<span class="number">3</span>] = <span class="number">2</span>^<span class="number">160</span></span><br><span class="line"></span><br><span class="line">temp = L.LLL()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">bh0 = <span class="built_in">abs</span>(temp[-<span class="number">3</span>] // (<span class="number">2</span>^<span class="number">160</span>))</span><br><span class="line">bl0 = <span class="built_in">abs</span>(temp[-<span class="number">2</span>])</span><br><span class="line">b0 = bh0*<span class="number">2</span>^<span class="number">528</span> + b[<span class="number">0</span>]*<span class="number">2</span>^<span class="number">400</span> + bl0</span><br><span class="line">x = inverse(a[<span class="number">0</span>],p) * b0 % p</span><br><span class="line">key2 = long_to_bytes(<span class="built_in">int</span>(x))[:<span class="number">32</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 decrypt</span></span><br><span class="line">enc = <span class="string">b&#x27;cTmkMb\xfc\x05|\x1d\xc7\x13\xbaSe\xe0\xbd\xc0\xd9\xa3\x8cwo\x82yN[B&amp;\x80\xd7KPwQ`\x9c\xbf&lt;y\x8e\x8a\x97e\xa074\xb2&#x27;</span></span><br><span class="line"></span><br><span class="line">iv = <span class="string">b&#x27;\xe9\x19\xbcU?\xd5\x1a&gt;\xaa\x9c\xb2\xe6@\xbd\xbd9&#x27;</span></span><br><span class="line">aes = AES.new(key1,AES.MODE_CBC,iv)</span><br><span class="line"></span><br><span class="line">flag = aes.decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;86baa4ed-5ec7-11ee-ae14-ac1203ab14da&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/e872e217.html" title="2023-鹏城杯-wp-crypto">https://tangcuxiaojikuai.xyz/post/e872e217.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/4311e802.html" rel="prev" title="2023-0xGame-week4-wp-crypto">
      <i class="fa fa-chevron-left"></i> 2023-0xGame-week4-wp-crypto
    </a></div>
      <div class="post-nav-item">
    <a href="/post/9e0dbdd4.html" rel="next" title="2023-NewStarCTF-wp-crypto">
      2023-NewStarCTF-wp-crypto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#LeakyRSA"><span class="nav-number">1.</span> <span class="nav-text">LeakyRSA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SecretShare"><span class="nav-number">2.</span> <span class="nav-text">SecretShare</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Neltharion-and-Arthas"><span class="nav-number">3.</span> <span class="nav-text">Neltharion and Arthas</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86"><span class="nav-number">3.1.</span> <span class="nav-text">第一部分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86"><span class="nav-number">3.2.</span> <span class="nav-text">第二部分</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#colorful-matrix"><span class="nav-number">4.</span> <span class="nav-text">colorful_matrix</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
