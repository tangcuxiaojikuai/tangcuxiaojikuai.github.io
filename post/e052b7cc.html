<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="很硬的题目，尝试复现一下。">
<meta property="og:type" content="article">
<meta property="og:title" content="2023-N1CTF-junior-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/e052b7cc.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="很硬的题目，尝试复现一下。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-01-31T01:02:18.000Z">
<meta property="article:modified_time" content="2024-02-01T16:08:08.808Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/e052b7cc.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2023-N1CTF-junior-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/e052b7cc.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2023-N1CTF-junior-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-31 09:02:18" itemprop="dateCreated datePublished" datetime="2024-01-31T09:02:18+08:00">2024-01-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-02 00:08:08" itemprop="dateModified" datetime="2024-02-02T00:08:08+08:00">2024-02-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/e052b7cc.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/e052b7cc.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>很硬的题目，尝试复现一下。</p>
<span id="more"></span>
<h3 id="ezezez"><a href="#ezezez" class="headerlink" title="ezezez"></a>ezezez</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">flag = flag + os.urandom(<span class="number">512</span> // <span class="number">8</span> - <span class="built_in">len</span>(flag) - <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">magic = bytes_to_long(<span class="string">b&#x27;N1Junior_CheckIn&#x27;</span>)</span><br><span class="line">e = <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p = getPrime(<span class="number">256</span>)</span><br><span class="line">    <span class="keyword">if</span> (p-<span class="number">1</span>) % e == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">q = getPrime(<span class="number">256</span>)</span><br><span class="line">n=p*q</span><br><span class="line"></span><br><span class="line">gx = [Zmod(n)(m)^e, Zmod(n)(magic), Zmod(n)(m+magic)^e]</span><br><span class="line"></span><br><span class="line">a = getPrime(<span class="number">128</span>)</span><br><span class="line">b = getPrime(<span class="number">128</span>)</span><br><span class="line">Ep = EllipticCurve(GF(p),[a,b])</span><br><span class="line">Eq = EllipticCurve(GF(q),[a,b])</span><br><span class="line"></span><br><span class="line">gy = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> gx:</span><br><span class="line">    Gp = Ep.lift_x(x)</span><br><span class="line">    Gq = Eq.lift_x(x)</span><br><span class="line">    y = crt([<span class="built_in">int</span>(Gp[<span class="number">1</span>]),<span class="built_in">int</span>(Gq[<span class="number">1</span>])],[p,q])</span><br><span class="line">    gy.append(y)</span><br><span class="line">        </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;a = <span class="subst">&#123;a&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;gy = <span class="subst">&#123;gy&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">a = 259416965926853287275013962386631097709</span></span><br><span class="line"><span class="string">n = 8963244108103857378610478915798540027754205184635651624801332901515870452435977078824267979279218575027152343028911705254378598817260939339516835322386427</span></span><br><span class="line"><span class="string">gy = [1896722249337161391193797083807118705857637064141055866260977430130447249097804719101078827699386498665026965515554644281163046869672493999194358926022865, 1971472878970365404484102034878792535366624572891039926216530789642810299559238977732710681752685090332485586910206690093655977703795335533365202958013518, 4074555112002157403114317690671003025383051142150876016519408756236925988856478235258960189636836867363451314784889114354880607055705753428890566240606935]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>题目流程如下：</p>
<ul>
<li>生成素数p、q，取其乘积为n</li>
<li>生成素数a、b，并用a、b生成两条曲线如下：</li>
</ul>
<script type="math/tex; mode=display">
y^2 = x^3 + ax + b \quad(mod\;p)</script><script type="math/tex; mode=display">
y^2 = x^3 + ax + b \quad(mod\;q)</script><ul>
<li>在这两个曲线上分别取三个点，并crt得到在如下曲线上的三个点的坐标：</li>
</ul>
<script type="math/tex; mode=display">
y^2 = x^3 + ax + b \quad(mod\;n)</script><ul>
<li>其中三个点的横坐标分别是：</li>
</ul>
<script type="math/tex; mode=display">
m^e , magic,(m+magic)^e</script><ul>
<li>给出a、n以及三个点在模n曲线下的纵坐标，要求求出m</li>
</ul>
<p>首先要明白的一点是为什么一定要在模p、q下的曲线先求出纵坐标再crt起来，这是因为n是两个大素数组成的难以分解的合数，因此在模n下的二次剩余是难以求解的，所以才必须在模p、q下分别求出后再crt。</p>
<p>但是对于解出m来说很容易，因为椭圆曲线本质上来说就是关于x、y的多项式，并且所有y值都给了的情况下，就只剩下关于三个横坐标的方程。而虽然本题没有给b，但是由于magic为已知量，所以求出b不是问题。</p>
<p>但是实际上不求b也完全可行，因为两两作差就能消去b。我们将点一、二作差，点二、三作差，就得到如下两个方程：</p>
<script type="math/tex; mode=display">
(m^e)^3 + a(m^e) - (magic)^3 - a(magic) - y_0 + y_1 = 0 \quad(mod\;n)</script><script type="math/tex; mode=display">
((m+magic)^e)^3 + a((m+magic)^e) - (magic)^3 - a(magic) - y_2 + y_1 = 0 \quad(mod\;n)</script><p>而这两个方程有公共根m，因此求gcd或者用groebner应该都行，我这里直接用groebner。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">a = <span class="number">259416965926853287275013962386631097709</span></span><br><span class="line">n = <span class="number">8963244108103857378610478915798540027754205184635651624801332901515870452435977078824267979279218575027152343028911705254378598817260939339516835322386427</span></span><br><span class="line">gy = [<span class="number">1896722249337161391193797083807118705857637064141055866260977430130447249097804719101078827699386498665026965515554644281163046869672493999194358926022865</span>, <span class="number">1971472878970365404484102034878792535366624572891039926216530789642810299559238977732710681752685090332485586910206690093655977703795335533365202958013518</span>, <span class="number">4074555112002157403114317690671003025383051142150876016519408756236925988856478235258960189636836867363451314784889114354880607055705753428890566240606935</span>]</span><br><span class="line">e = <span class="number">24</span></span><br><span class="line">t = bytes_to_long(<span class="string">b&#x27;N1Junior_CheckIn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">PR.&lt;m,magic&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f1 = (m^e)^<span class="number">3</span> + a*(m^e) - magic^<span class="number">3</span> - a*magic - gy[<span class="number">0</span>]^<span class="number">2</span> + gy[<span class="number">1</span>]^<span class="number">2</span></span><br><span class="line">f2 = ((m+magic)^e)^<span class="number">3</span> + a*(m+magic)^e - magic^<span class="number">3</span> - a*magic - gy[<span class="number">2</span>]^<span class="number">2</span> + gy[<span class="number">1</span>]^<span class="number">2</span></span><br><span class="line">f3 = magic - t</span><br><span class="line">res = Ideal([f1,f2,f3]).groebner_basis()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">flag = n - <span class="number">8963244108103857378610473916499685337958102994866002007958751917348709988813159260063838668865808163331396353132849773965877550546775678652844675901977223</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment">#secpunk&#123;baby_crypt000_checkin&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="fastmix"><a href="#fastmix" class="headerlink" title="fastmix"></a>fastmix</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">48</span></span><br><span class="line">gift = <span class="string">b&#x27;yX~\xe1\xd3\xe7\xcdw_)/G\xdc\x0er\x18\xc0\xb2\xc1sKv\xd4\x857\x94D\xf91\xc2\x98\x873\x8bG\xc3hG\xbbC\x98\x16e\xe8\x11C\n\x04&#x27;</span></span><br><span class="line">block_size = <span class="number">16</span></span><br><span class="line">date = bytes_to_long(<span class="string">b&#x27;2023-1-31 10:00&#x27;</span>)</span><br><span class="line">f1 = <span class="keyword">lambda</span> x: (x &lt;&lt; <span class="number">1</span>) ^ <span class="number">0b110100011</span> <span class="keyword">if</span> x &amp; <span class="number">0x80</span> <span class="keyword">else</span> x &lt;&lt; <span class="number">1</span></span><br><span class="line">f2 = <span class="keyword">lambda</span> x: x ^ f1(f1(x))</span><br><span class="line">f3 = <span class="keyword">lambda</span> x: f1(f1(f1(x))) ^ f1(f1(x))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">slow_func</span>(<span class="params">init, time</span>):</span><br><span class="line">    tmp = init</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(time):</span><br><span class="line">        tmp = <span class="built_in">sum</span>([[</span><br><span class="line">            f3(tmp[j]) ^ f2(tmp[j+<span class="number">1</span>]) ^ f2(tmp[j+<span class="number">2</span>]) ^ f1(tmp[j+<span class="number">3</span>]),</span><br><span class="line">            f1(tmp[j]) ^ f3(tmp[j+<span class="number">1</span>]) ^ f1(tmp[j+<span class="number">2</span>]) ^ f2(tmp[j+<span class="number">3</span>]),</span><br><span class="line">            f3(tmp[j]) ^ f2(tmp[j+<span class="number">1</span>]) ^ f3(tmp[j+<span class="number">2</span>]) ^ f2(tmp[j+<span class="number">3</span>]),</span><br><span class="line">            f2(tmp[j]) ^ f1(tmp[j+<span class="number">1</span>]) ^ f2(tmp[j+<span class="number">2</span>]) ^ f3(tmp[j+<span class="number">3</span>])</span><br><span class="line">        ] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)], [])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(tmp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">v = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag), block_size):</span><br><span class="line">    block = gift[i:i+block_size]</span><br><span class="line">    v += slow_func(block, date)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag == v</span><br></pre></td></tr></table></figure>
<p>speedup类型的题目，只要跑完这个程序就能拿到flag。但是由于有：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(time):</span><br></pre></td></tr></table></figure>
<p>这个语句，而time是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date = bytes_to_long(<span class="string">b&#x27;2023-1-31 10:00&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>所以直接跑是没办法的，需要加速。而加速主要需要关注的就是如下部分：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">f1 = <span class="keyword">lambda</span> x: (x &lt;&lt; <span class="number">1</span>) ^ <span class="number">0b110100011</span> <span class="keyword">if</span> x &amp; <span class="number">0x80</span> <span class="keyword">else</span> x &lt;&lt; <span class="number">1</span></span><br><span class="line">f2 = <span class="keyword">lambda</span> x: x ^ f1(f1(x))</span><br><span class="line">f3 = <span class="keyword">lambda</span> x: f1(f1(f1(x))) ^ f1(f1(x))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">slow_func</span>(<span class="params">init, time</span>):</span><br><span class="line">    tmp = init</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(time):</span><br><span class="line">        tmp = <span class="built_in">sum</span>([[</span><br><span class="line">            f3(tmp[j]) ^ f2(tmp[j+<span class="number">1</span>]) ^ f2(tmp[j+<span class="number">2</span>]) ^ f1(tmp[j+<span class="number">3</span>]),</span><br><span class="line">            f1(tmp[j]) ^ f3(tmp[j+<span class="number">1</span>]) ^ f1(tmp[j+<span class="number">2</span>]) ^ f2(tmp[j+<span class="number">3</span>]),</span><br><span class="line">            f3(tmp[j]) ^ f2(tmp[j+<span class="number">1</span>]) ^ f3(tmp[j+<span class="number">2</span>]) ^ f2(tmp[j+<span class="number">3</span>]),</span><br><span class="line">            f2(tmp[j]) ^ f1(tmp[j+<span class="number">1</span>]) ^ f2(tmp[j+<span class="number">2</span>]) ^ f3(tmp[j+<span class="number">3</span>])</span><br><span class="line">        ] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)], [])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(tmp)</span><br></pre></td></tr></table></figure>
<p>先看这三个lambda函数，其实对AES比较熟悉的话，会看出来这个与列混合那一步的有限域乘法很相似。而这题也就是换了个模多项式。具体来说，如果把x的8bit看作是模2下的多项式系数，那么x本身就可以看作是一个多项式，记为g(x)。那么f1、f2、f3就分别等价于：</p>
<script type="math/tex; mode=display">
xg(x)</script><script type="math/tex; mode=display">
(x^2 + 1)g(x)</script><script type="math/tex; mode=display">
(x^3+x^2)g(x)</script><p>f1是乘x很好想通，因为在这个GF(2^8)的域中，2就代表的是x。而f2、f3其实也就分别代表5和12对应的元素，也就是x^2 + 1和x^3+x^2。同时，所有运算都在下面的商环下进行：</p>
<script type="math/tex; mode=display">
F_2[x]/(x^8+x^7+x^5+x+1)</script><p>那么之后的事也很简单，因为异或就是这个有限域中的加法，所以slow_func中的主要运算就可以看作是元素为多项式的矩阵乘法，比如对于第一次运算，就是如下过程：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}
t_0\\
t_1\\
t_2\\
t_3\\
\end{matrix}
\right)
=
\left(\begin{matrix}
x^3+x^2&x^2 + 1&x^2 + 1&x\\
x&x^3+x^2&x&x^2 + 1\\
x^3+x^2&x^2 + 1&x^3+x^2&x^2 + 1\\
x^2 + 1&x&x^2 + 1&x^3+x^2\\
\end{matrix}
\right)
\left(\begin{matrix}
s_0\\
s_1\\
s_2\\
s_3\\
\end{matrix}
\right)
\quad</script><p>其中si就是初始状态构成的向量，那么最终flag的运算结果就是：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}
v_0\\
v_1\\
v_2\\
v_3\\
\end{matrix}
\right)
=
\left(\begin{matrix}
x^3+x^2&x^2 + 1&x^2 + 1&x\\
x&x^3+x^2&x&x^2 + 1\\
x^3+x^2&x^2 + 1&x^3+x^2&x^2 + 1\\
x^2 + 1&x&x^2 + 1&x^3+x^2\\
\end{matrix}
\right)^{time}
\left(\begin{matrix}
s_0\\
s_1\\
s_2\\
s_3\\
\end{matrix}
\right)
\quad</script><p>而由于可以进行矩阵快速幂，所以就可以加速得到结果了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">gift = <span class="string">b&#x27;yX~\xe1\xd3\xe7\xcdw_)/G\xdc\x0er\x18\xc0\xb2\xc1sKv\xd4\x857\x94D\xf91\xc2\x98\x873\x8bG\xc3hG\xbbC\x98\x16e\xe8\x11C\n\x04&#x27;</span></span><br><span class="line">block_size = <span class="number">16</span></span><br><span class="line">date = bytes_to_long(<span class="string">b&#x27;2023-1-31 10:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">PR2.&lt;a&gt; = PolynomialRing(Zmod(<span class="number">2</span>))</span><br><span class="line">R2 = PR2.quotient(<span class="number">1</span>+a+a^<span class="number">5</span>+a^<span class="number">7</span>+a^<span class="number">8</span>,<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"></span><br><span class="line">x_1 = R2([<span class="number">0</span>,<span class="number">1</span>]) <span class="comment">#f1:*x</span></span><br><span class="line">x_2 = R2([<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>]) <span class="comment">#f2:*(x^2+1)</span></span><br><span class="line">x_3 = R2([<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>]) <span class="comment">#f3:*(x^3+x^2)</span></span><br><span class="line"></span><br><span class="line">poly_matrix = Matrix(R2,[[x_3,x_2,x_2,x_1],</span><br><span class="line">                         [x_1,x_3,x_1,x_2],</span><br><span class="line">                         [x_3,x_2,x_3,x_2],</span><br><span class="line">                         [x_2,x_1,x_2,x_3]])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_to_vec</span>(<span class="params">num</span>):</span><br><span class="line">    temp = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,<span class="built_in">bin</span>(num)[<span class="number">2</span>:].zfill(<span class="number">8</span>)[::-<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">return</span> R2(temp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fast_func</span>(<span class="params">init,time</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>):</span><br><span class="line">        tmp = vector(R2,<span class="built_in">list</span>(<span class="built_in">map</span>(convert_to_vec,[init[i],init[i+<span class="number">1</span>],init[i+<span class="number">2</span>],init[i+<span class="number">3</span>]])))</span><br><span class="line">        final = (poly_matrix^(time))*tmp</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> final:</span><br><span class="line">            temp = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">str</span>,<span class="built_in">list</span>(j)[::-<span class="number">1</span>]))</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join(temp),<span class="number">2</span>)),end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(gift), block_size):</span><br><span class="line">    block = gift[i:i+block_size]</span><br><span class="line">    fast_func(block, date)</span><br><span class="line"></span><br><span class="line"><span class="comment">#secpunk&#123;checkin_but_@maz1ng_4lg3bra1c_5tructure&#125;  </span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="n1lucky"><a href="#n1lucky" class="headerlink" title="n1lucky"></a>n1lucky</h3><p>这个题目Van1sh在公众号上写过好题分享，写的非常详细清楚，看那一篇就好了。</p>
<p><br></p>
<p><br></p>
<h3 id="RealSignin"><a href="#RealSignin" class="headerlink" title="RealSignin"></a>RealSignin</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_params</span>(<span class="params">nbits</span>):</span><br><span class="line">    p = getPrime(nbits)</span><br><span class="line">    q = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">    r = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> q &lt; r:</span><br><span class="line">        q, r = r, q</span><br><span class="line">    e = <span class="number">2023</span> + <span class="number">666</span></span><br><span class="line">    n = p * q * r</span><br><span class="line">    phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>) * (r-<span class="number">1</span>)</span><br><span class="line">    d = inverse(e, phi)</span><br><span class="line">    <span class="keyword">return</span> e, n, d, p, q, r</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">magic_process</span>(<span class="params">dqr_</span>):</span><br><span class="line">    <span class="comment"># only the correct data can pass this magic process!</span></span><br><span class="line">    w = <span class="number">11805048190103811318745740902058585490581588391715507077469771342521346595744141604699124341571677599846725074544467374849004088341619160922679491419964725</span></span><br><span class="line">    x = dqr_ + <span class="number">666</span></span><br><span class="line">    y = dqr_ + <span class="number">667</span></span><br><span class="line">    PR.&lt;z&gt; = PolynomialRing(ZZ)</span><br><span class="line">    f = w*(x*z+y*z-x*y) - <span class="number">4</span>*x*y*z</span><br><span class="line">    z = f.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> w*(x*z+y*z-x*y) - <span class="number">4</span>*x*y*z == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">e, n, d, p, q, r = get_params(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">dqr = d % ((q-<span class="number">1</span>) * (r-<span class="number">1</span>))</span><br><span class="line">dqr_ = (dqr &gt;&gt; <span class="number">55</span>) &lt;&lt; <span class="number">55</span></span><br><span class="line">magic_process(dqr_)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e = <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;qr = <span class="subst">&#123;q % r&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;<span class="built_in">pow</span>(m, e, n)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">e = 2689</span></span><br><span class="line"><span class="string">qr = 47039394845246457267451844933135300719863788804596821520575305333413876649846</span></span><br><span class="line"><span class="string">n = 102275105641047314957681561255971730180031931453885390971560104545784846810054168298038033889926837832908913447331571300831232278972182034546312860462560455575699889259884894407503661740178853200384106267596198200388045685183747251883536380886761864997738495990864526497955511125021398766971363828732464588761</span></span><br><span class="line"><span class="string">c = 30057873321817268990724095993213394773233077509126537130493293224220768053789109305889627009912877888765075963369699610910695123551381348483962929764830148523075698671087735427795008522625385598116705013490990766089416767372146754468746664865469005120853463146265400060202176870467493380590559736303051981581</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>题目先生成RSA的几个密钥相关量，n由三个素数p、q、r组成，其中p是512bit的素数，q、r分别为256bit且q&gt;r，e为2689。</p>
<p>然后题目先计算出一个量：</p>
<script type="math/tex; mode=display">
dqr = d \quad(mod\;(q-1)(r-1))</script><p>然后抹去他的低55位，得到dqr’，然后用这个值构造x、y如下：</p>
<script type="math/tex; mode=display">
x = dqr' + 666</script><script type="math/tex; mode=display">
y = dqr' + 667</script><p>然后给出一个方程：</p>
<script type="math/tex; mode=display">
w(xz+yz-xy) - 4xyz = 0</script><p>并且仅给出w的值。此外，题目还给了我们q%r的值qr，以及公钥n和flag密文c，要求还原明文。</p>
<p>理一下解题思路，首先肯定要知道dqr’的值，才有后续利用copper解出dqr、进而求出n的完整分解的机会。所以当务之急就是解决下面这个不定方程：</p>
<script type="math/tex; mode=display">
w(xz+yz-xy) - 4xyz = 0</script><p>并且还知道一个信息是：</p>
<script type="math/tex; mode=display">
y = x+1</script><p>然后我这里的第一个思路是，注意到magic中有一句注释是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># only the correct data can pass this magic process!</span></span><br></pre></td></tr></table></figure>
<p>所以我在想，这是不是说方程有且仅有一个解的意思，也就是说dqr’的唯一整数解刚好就在对称轴上。于是我把这个不定方程的y消去，变成如下的形式：</p>
<script type="math/tex; mode=display">
(4z+w)x^2 + (4z+w-2zw)x - wz = 0</script><p>把x视作主元，得到的就是一个关于x的一元二次方程，而如果符合我们猜想的话，这个二次方程的判别式就该等于0，也就是：</p>
<script type="math/tex; mode=display">
(4z+w-2zw)^2 + 4wz(4z+w) = 0</script><p>但是这个方程没有整数解，所以并不是我们猜想的那样，因此需要另谋他法。我的第二个思路是把方程化成下面这个形式：</p>
<script type="math/tex; mode=display">
\frac{4}{w} = \frac{2x+1}{x(x+1)}- \frac{1}{z}</script><p>z应该是个很大的数，所以是不是代表着4/w的连分数展开可能会覆盖到x组成的这个分数？但是遗憾的是也没有成功，应该是不满足勒让德理论。</p>
<p>之后我问了zima师傅，知道有原题目可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.cryptohack.org/cyber-apocalypse-2021">Cyber Apocalypse CTF 2021 Part 1 | CryptoHack Blog</a></p>
<p>大致思路就是说，首先把原不定方程化成如下形式(其实就是第二种思路中，不代入y=x+1)：</p>
<script type="math/tex; mode=display">
\frac{4}{w} = \frac{1}{x} + \frac{1}{y} - \frac{1}{z}</script><p>接下来的步骤就有点想象力了，因为w是奇数，所以左边可以拆成：</p>
<script type="math/tex; mode=display">
\frac{4}{w} = \frac{2}{w-1} + \frac{2}{w+1} - \frac{4}{w(w-1)(w+1)}</script><p>所以就得到了符合要求的解。</p>
<p>然后这里我也有问yolbby师傅，他说他是类比成埃及分数做，我之前并不知道这个东西就去查了一下。埃及分数其实也就是分子为1的分数，那么之所以能类比，应该也是上面那个化简形式的存在：</p>
<script type="math/tex; mode=display">
\frac{4}{w} = \frac{1}{x} + \frac{1}{y} - \frac{1}{z}</script><p>然后对应的办法就是深搜迭代，但是由于数字很大，所以我自己瞎搜索了一下，没有实现出来这种办法。有兴趣的师傅可以自己试一试。</p>
<p>解出这个不定方程的之后就有dqr’，而为了得到完整的dqr，很显然需要copper解出其低55位。为此我们记这低55位为delta，构造下面这个方程：</p>
<script type="math/tex; mode=display">
e(dqr' + \delta) = 1 \quad(mod\;(q-1)(r-1))</script><p>展开成等式就有：</p>
<script type="math/tex; mode=display">
e(dqr' + \delta) = 1 + k(q-1)(r-1)</script><p>这里就和dq泄漏的思路类似(其实本质上来说没区别)，注意到k肯定小于e，而e又仅有2689，因此遍历1到e一定存在一个正确的k。而我们又有q模r的值，并且知道q和r都是256bit，所以一定有：</p>
<script type="math/tex; mode=display">
q = r + qr</script><p>那么代入上面那个式子：</p>
<script type="math/tex; mode=display">
e(dqr' + \delta) = 1 +k(r + qr-1)(r-1)</script><p>展开：</p>
<script type="math/tex; mode=display">
e(dqr' + \delta) = 1 +k(r^2+r(qr-2)+1-qr)</script><p>那么在模r下就有：</p>
<script type="math/tex; mode=display">
e(dqr' + \delta) = 1 +k(1-qr) \quad(mod\;r)</script><p>然后理论上来说就可以在模n下用copper求解出delta的值了。不过有一些小问题：</p>
<ul>
<li>r是256bit的因子并且比q小，因此beta最多就取到0.25</li>
<li>beta取0.25的话，epsilon即使取到0.01，根的上界也就只有50出头，达不到要求，可能还要爆破几位</li>
</ul>
<p>但是首先epsilon取0.01就很慢了，再爆破几位更慢，而且最外层还要爆破k，更更慢。最主要的是，我电脑还没换，这破电脑没有装flatter啊！</p>
<p>然后想到了一点点优化，就是刚才这个式子里：</p>
<script type="math/tex; mode=display">
e(dqr' + \delta) = 1 + k(q-1)(r-1)</script><p>应该是转化到模q下求解小根的话，由于有q&gt;r，所以beta能稍微大一点，也许根的上界可以略有提升？因此我构造出如下的多项式：</p>
<script type="math/tex; mode=display">
e(dqr' + \delta) = 1 +k(1+qr) \quad(mod\;q)</script><p>然后还有一点就是，由于d肯定是奇数，模一个偶数也不改变奇偶性，所以LSB肯定是1，所以还能减小1bit。不过除此之外确实没想到其他优化了，就硬来吧。要是有flatter就好了，换了电脑一定马上装。</p>
<p>爆了差不多一个半小时出了结果(也算是运气不错，完整的爆估计要8个小时，装flatter还是很必要)。有了完整的dqr过后就可以用刚才的方程求根得到q、r，就有了n的完整分解，然后解密就好了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">2689</span></span><br><span class="line">qr = <span class="number">47039394845246457267451844933135300719863788804596821520575305333413876649846</span></span><br><span class="line">n = <span class="number">102275105641047314957681561255971730180031931453885390971560104545784846810054168298038033889926837832908913447331571300831232278972182034546312860462560455575699889259884894407503661740178853200384106267596198200388045685183747251883536380886761864997738495990864526497955511125021398766971363828732464588761</span></span><br><span class="line">c = <span class="number">30057873321817268990724095993213394773233077509126537130493293224220768053789109305889627009912877888765075963369699610910695123551381348483962929764830148523075698671087735427795008522625385598116705013490990766089416767372146754468746664865469005120853463146265400060202176870467493380590559736303051981581</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get dqr_</span></span><br><span class="line">w = <span class="number">11805048190103811318745740902058585490581588391715507077469771342521346595744141604699124341571677599846725074544467374849004088341619160922679491419964725</span></span><br><span class="line">k = (w-<span class="number">1</span>)//<span class="number">2</span></span><br><span class="line">x = k</span><br><span class="line">y = k+<span class="number">1</span></span><br><span class="line">z = k*(k+<span class="number">1</span>)*(<span class="number">2</span>*k+<span class="number">1</span>)</span><br><span class="line"><span class="keyword">assert</span> w*(x*z+y*z-x*y) - <span class="number">4</span>*x*y*z == <span class="number">0</span></span><br><span class="line">dqr_ = x-<span class="number">666</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get dqr(use copper)</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    <span class="keyword">for</span> tt <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> trange(<span class="number">1</span>,e):</span><br><span class="line">            PR.&lt;delta&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">            f = e*(dqr_+<span class="number">2</span>^<span class="number">3</span>*delta+<span class="number">2</span>*tt+<span class="number">1</span>) - <span class="number">1</span> - k*(<span class="number">1</span>+qr)</span><br><span class="line">            f = f.monic()</span><br><span class="line">            res = f.small_roots(X=<span class="number">2</span>^<span class="number">52</span>,beta=<span class="number">0.25</span>,epsilon=<span class="number">0.01</span>)</span><br><span class="line">            <span class="keyword">if</span>(res != []):</span><br><span class="line">                <span class="built_in">print</span>(tt,k,res)  <span class="comment">#0 2046 [2593202029823482]</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">dqr = dqr_ + <span class="number">2</span>^<span class="number">3</span>*<span class="number">2593202029823482</span> + <span class="number">2</span>*<span class="number">0</span> + <span class="number">1</span></span><br><span class="line">k = <span class="number">2046</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 factor n</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    PR.&lt;r&gt; = PolynomialRing(ZZ)</span><br><span class="line">    f = e*dqr - <span class="number">1</span> - k*(r+qr-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">    res = f.roots()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">r = <span class="number">67643325987256775010724943844390543569531594444330008512848332012702093716653</span></span><br><span class="line">q = r + qr</span><br><span class="line">p = n // q // r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part4 get flag</span></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,phi)</span><br><span class="line">flag = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#secpunk&#123;reallyreallyreallyreally_ez_signin..&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="errorcc"><a href="#errorcc" class="headerlink" title="errorcc"></a>errorcc</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">8</span>]==<span class="string">b&#x27;secpunk&#123;&#x27;</span> <span class="keyword">and</span> flag[-<span class="number">1</span>:]==<span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line">flag = flag[<span class="number">8</span>:-<span class="number">1</span>]</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">200</span>)</span><br><span class="line">a = random.randint(<span class="number">0</span>, p-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    b = random.randint(<span class="number">0</span>, p-<span class="number">1</span>)</span><br><span class="line">    E = EllipticCurve(Zmod(p), [a, b])</span><br><span class="line">    <span class="keyword">if</span> isPrime(E.order()):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">Ga = E.gens()[<span class="number">0</span>]</span><br><span class="line">gift = bytes_to_long(<span class="string">b&#x27;N1CTF Junior&#x27;</span>)</span><br><span class="line">random.seed(gift)</span><br><span class="line"></span><br><span class="line">G = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">80</span>):</span><br><span class="line">    r = random.randint(<span class="number">0</span>,p-<span class="number">1</span>)</span><br><span class="line">    G.append(<span class="built_in">tuple</span>((r ^^ m)*Ga)[:-<span class="number">1</span>])</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">60</span>):</span><br><span class="line">    r = random.randint(<span class="number">0</span>,p-<span class="number">1</span>)</span><br><span class="line">    G.append(<span class="built_in">tuple</span>((r &amp; m)*Ga)[:-<span class="number">1</span>])</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">60</span>):</span><br><span class="line">    r = random.randint(<span class="number">0</span>,p-<span class="number">1</span>)</span><br><span class="line">    G.append(<span class="built_in">tuple</span>((r | m)*Ga)[:-<span class="number">1</span>])</span><br><span class="line">    </span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(<span class="string">&quot;Ga = &quot;</span>+<span class="built_in">str</span>(<span class="built_in">tuple</span>(Ga)[:-<span class="number">1</span>])+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">&quot;G = &quot;</span>+<span class="built_in">str</span>(G))</span><br></pre></td></tr></table></figure>
<p>output有点长，就不放在这里，需要的师傅可以找我要。</p>
<p>题目流程也很清晰：</p>
<ul>
<li>首先把flag的头尾去了，然后转成大整数m</li>
<li>生成随机的200bit素数p，以及小于p的随机数a</li>
<li>然后爆破出一个b，使其生成的如下曲线的阶是素数：</li>
</ul>
<script type="math/tex; mode=display">
y^2 = x^3 + ax + b \quad(mod\;p)</script><ul>
<li>然后取曲线上的生成元Ga，并以一个已知的gift作为随机数的种子，之后分别给出：</li>
</ul>
<p>80个：</p>
<script type="math/tex; mode=display">
G_i = (m\oplus r_i)G_a</script><p>60个：</p>
<script type="math/tex; mode=display">
G_i = (m \;and\; r_i)G_a</script><p>60个：</p>
<script type="math/tex; mode=display">
G_i = (m \;|\; r_i)G_a</script><p>以及Ga，要求还原m。</p>
<p>首先肯定是要还原出曲线参数，这一部分很容易，因为所有给出的点都是曲线上的点，所以不论是手写一个消元或者是直接取groebner都能获得全部参数。然后需要注意的一点是，由于随机数种子给了我们，所以所有ri都已知。</p>
<p>有了参数a、b、p后就能计算其order。看到题目里保证其阶为素数，确实幻想过阶恰好为p然后直接smart attack，或者阶满足mov attack之类，但是的确都不行。也就是说这个ECC上的DLP是没办法求的，只能想办法利用给出的这些点来恢复m。</p>
<p>这里我首先就想到N1CTF的e2D1p一题，因为实在是非常类似：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/9b40da15.html">Crypto趣题-Lattice | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>类似在哪里呢？在那个题目中，有多组如下形式的等式：</p>
<script type="math/tex; mode=display">
c_i = e^{flag \oplus m_i} \quad(mod\;p)</script><p>并且给出每个等式的ci、ri。我们忽略掉那个题目恢复p的步骤，直接进入其恢复flag的第二步，也就是把p当作已知，那么对应于这个题目中的给了多组如下的点来说：</p>
<script type="math/tex; mode=display">
G_i = (m\oplus r_i)G_a</script><p>ci对应Gi，e对应Ga，mi对应ri，flag对应m，p对应order，完全可以一一对应。也就是说，似乎除了把离散对数形式从数构成的乘法群移到点构成的加法群，别的都没什么区别。</p>
<p>所以我就想到用一模一样的思路逐bit还原m，具体的就看那篇文章就好了。不过我就这么做没有做出来，因为所有那个形式的矩阵方程都无解。思考了一下，确实不应该直接这样就能出，毕竟后面的&amp;和|给的足足120个点都还没有用到。</p>
<p>这题之后更新吧，暂时没什么思路了。</p>
<h4 id="2-1更新"><a href="#2-1更新" class="headerlink" title="(2.1更新)"></a>(2.1更新)</h4><p>从zima师傅那里要到了一份这个题目的exp，然后看着代码理解了一下出题人的思路，豁然开朗。</p>
<p>先放他的exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">f.read(<span class="number">5</span>)</span><br><span class="line">Ga = <span class="built_in">eval</span>(f.readline())</span><br><span class="line">f.read(<span class="number">4</span>)</span><br><span class="line">G = <span class="built_in">eval</span>(f.readline())</span><br><span class="line"></span><br><span class="line">PR.&lt;a,b&gt; = PolynomialRing(ZZ)</span><br><span class="line">polys = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    x, y = G[i]</span><br><span class="line">    polys.append(x*a+b+(x^<span class="number">3</span>-y^<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">gb = Ideal(polys).groebner_basis()</span><br><span class="line">p = gb[-<span class="number">1</span>]</span><br><span class="line">a = -gb[<span class="number">0</span>].coefficients()[-<span class="number">1</span>]%p</span><br><span class="line">b = -gb[<span class="number">1</span>].coefficients()[-<span class="number">1</span>]%p</span><br><span class="line"></span><br><span class="line">E=EllipticCurve(Zmod(p),[a, b])</span><br><span class="line">Ga=E(Ga)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xormat</span>(<span class="params">r, P</span>):</span><br><span class="line">    mask = <span class="number">1</span></span><br><span class="line">    v = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        <span class="keyword">if</span> r &amp; mask == <span class="number">0</span>:</span><br><span class="line">            v.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v.append(-<span class="number">1</span>)</span><br><span class="line">            P = P-mask*Ga</span><br><span class="line">        mask = mask &lt;&lt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> v, P</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">andmat</span>(<span class="params">r, P</span>):</span><br><span class="line">    mask = <span class="number">1</span></span><br><span class="line">    v = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        <span class="keyword">if</span> r &amp; mask == <span class="number">0</span>:</span><br><span class="line">            v.append(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v.append(<span class="number">1</span>)</span><br><span class="line">        mask = mask &lt;&lt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> v, P</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ormat</span>(<span class="params">r, P</span>):</span><br><span class="line">    mask = <span class="number">1</span></span><br><span class="line">    v = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        <span class="keyword">if</span> r &amp; mask == <span class="number">0</span>:</span><br><span class="line">            v.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v.append(<span class="number">0</span>)</span><br><span class="line">            P = P-mask*Ga</span><br><span class="line">        mask = mask &lt;&lt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> v, P</span><br><span class="line">    </span><br><span class="line">L = []</span><br><span class="line">R = []</span><br><span class="line">random.seed(<span class="built_in">int</span>.from_bytes(<span class="string">b&#x27;N1CTF Junior&#x27;</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;===construct matrix begin===&quot;</span>)</span><br><span class="line">start = time.time()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">80</span>):</span><br><span class="line">    rn = random.randint(<span class="number">0</span>,p-<span class="number">1</span>)</span><br><span class="line">    Q = E(G[i])</span><br><span class="line">    v, P = xormat(rn, Q)</span><br><span class="line">    L.append(v)</span><br><span class="line">    R.append(P)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">80</span>,<span class="number">140</span>):</span><br><span class="line">    rn = random.randint(<span class="number">0</span>,p-<span class="number">1</span>)</span><br><span class="line">    Q = E(G[i])</span><br><span class="line">    v, P = andmat(rn, Q)</span><br><span class="line">    L.append(v)</span><br><span class="line">    R.append(P)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">140</span>,<span class="number">200</span>):</span><br><span class="line">    rn = random.randint(<span class="number">0</span>,p-<span class="number">1</span>)</span><br><span class="line">    Q = E(G[i])</span><br><span class="line">    v, P = ormat(rn, Q)</span><br><span class="line">    L.append(v)</span><br><span class="line">    R.append(P)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;===construct matrix end===&quot;</span>)</span><br><span class="line">end = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;cost &#123;&#125;s&quot;</span>.<span class="built_in">format</span>(end-start))</span><br><span class="line"></span><br><span class="line">q = E.order()</span><br><span class="line">L = Matrix(Zmod(q), L)</span><br><span class="line">m = <span class="string">&#x27;&#x27;</span></span><br><span class="line">O = <span class="number">0</span>*Ga</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    u = vector(Zmod(q),[<span class="number">0</span>]*i+[<span class="number">1</span>]+[<span class="number">0</span>]*(<span class="number">199</span>-i))</span><br><span class="line">    coeff = L.solve_left(u).change_ring(ZZ)</span><br><span class="line">    S = <span class="number">0</span>*Ga</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        S += coeff[i]*R[i]</span><br><span class="line">    <span class="keyword">if</span> S == O:</span><br><span class="line">        m = <span class="string">&#x27;0&#x27;</span>+m</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        m = <span class="string">&#x27;1&#x27;</span>+m</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="built_in">int</span>(m, <span class="number">2</span>))[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure>
<p>接下来就是讲这样做的道理是什么。</p>
<h5 id="xor"><a href="#xor" class="headerlink" title="xor"></a>xor</h5><p>首先，由于给出的都是位运算，因此所有式子都可以写成对于各bit的操作形式，我们就以xor举例，对于其中的某个式子，他本来是写成：</p>
<script type="math/tex; mode=display">
G = (m\oplus r)G_a</script><p>我们把m看作是200个未知bit组成的量(也就是按位，把它看作是200个变量)，那么这个式子可以写成：</p>
<script type="math/tex; mode=display">
G = (\sum_{j=0}^{199}{2^j(m_j \oplus r_{j})})G_a</script><p>这对于后面的&amp;和|也是同理的，但是又为什么要这样写呢？我们用如下写法，让表达式更清晰一点：</p>
<script type="math/tex; mode=display">
G = 2^0(m_0 \oplus r_{0})G_a + 2^1(m_1 \oplus r_{1})G_a + ... + 2^{199}(m_{199} \oplus r_{199})G_a</script><p>这样写出来之后，式子由原来的一个普通点乘计算，变成了两百个<strong>独立的</strong>点乘计算，并在最后相加。注意这里刻意强调的每个点乘计算的独立性，因为每个bit之间是完全不会相互影响的。</p>
<p>而对于我们来说，我们有r的200个bit的值，这就又给这个式子增加了一些额外信息。由于r的每个bit只有0、1两个取值，所以我们分开讨论：</p>
<ul>
<li>r的当前bit(rj)为0，那么：</li>
</ul>
<script type="math/tex; mode=display">
m_j \oplus r_{j} = m_j \oplus 0 = m_j</script><ul>
<li>r的当前bit(rj)为1，那么：</li>
</ul>
<script type="math/tex; mode=display">
m_j \oplus r_{j} = m_j \oplus 1</script><p>明白了这两点后，仍然是注意到200个bit彼此独立，我们就随便取其中一bit来分析一下</p>
<script type="math/tex; mode=display">
2^j(m_j \oplus r_{j})G_a</script><p>我们需要关注的是，m的这一bit的取值，对于最终得到G的贡献是什么。如果rj为0，那么由刚才的式子知道，这个点乘就是：</p>
<script type="math/tex; mode=display">
2^j(m_j)G_a</script><p>而重点在于rj=1的时候，这个点会变成：</p>
<script type="math/tex; mode=display">
2^j(m_j \oplus 1)G_a</script><p>这个怎么处理呢？其实因为mj也只有两个取值，所以也可以先分别写出mj的两种情况对应的点乘：</p>
<ul>
<li>mj为0，则为：</li>
</ul>
<script type="math/tex; mode=display">
2^j(0 \oplus 1)G_a = 2^j(0)G_a + 2^jG_a</script><ul>
<li>mj为1，则为：</li>
</ul>
<script type="math/tex; mode=display">
2^j(1 \oplus 1)G_a = 2^j(-1)G_a + 2^jG_a</script><p><strong>重要的一步来了</strong>，我们只需要配凑一个-1，就能把式子变成一个统一的含mj变量的形式：</p>
<script type="math/tex; mode=display">
2^j(m_j \oplus 1)G_a = -2^jm_jG_a + 2^jG_a</script><p>如此一来，把rj为0和1分别对应的mj形成的表达式分别代入最初那个式子中，就可以将m的200bit写在一个更清晰的表达式里了：</p>
<script type="math/tex; mode=display">
G = 2^0(m_0 \oplus r_{0})G_a + 2^1(m_1 \oplus r_{1})G_a + ... + 2^{199}(m_{199} \oplus r_{199})G_a</script><p>这里举个简单的例子帮助理解，比如r的bit序列为(由低到高)：</p>
<script type="math/tex; mode=display">
(0,1,...,0,1)</script><p>结合刚才的表达式代入这个式子里，就得到：</p>
<script type="math/tex; mode=display">
G = 2^0m_0G_a -2^1m_1G_a + 2^1G_a + ... + 2^{198}m_{198}G_a -2^{199}m_{199}G_a + 2^{199}G_a</script><p>移项就得到：</p>
<script type="math/tex; mode=display">
G - 2^1G_a - ... -2^{199}G_a = 2^0m_0G_a -2^1m_1G_a+ ... + 2^{198}m_{198}G_a-2^{199}m_{199}G_a</script><p>此时，等式左边是一个已知的点，等式右边是仅有m的200bit组成的算式。<strong>这其实就是一个涉及m的200个bit的方程了</strong>。那么由xor，我们可以得到80组这样的方程。</p>
<h5 id="and-or"><a href="#and-or" class="headerlink" title="and ,or"></a>and ,or</h5><p>其实xor想明白了，这两个异曲同工。因为我们要做的事情，仍然是根据r的200个bit的值，列出仅含m的200个bit的方程。那么对于&amp;来说：</p>
<script type="math/tex; mode=display">
G = 2^0(m_0 \;and\; r_{0})G_a + 2^1(m_1 \;and\; r_{1})G_a + ... + 2^{199}(m_{199} \;and\;r_{199})G_a</script><p>这个就很简单，因为讨论rj的两种取值的话，显然rj为0整个式子乘数就取0，rj为1整个式子乘数就取mj，仍然是用刚才的(0,1,…,0,1)的r的bit序列举个例子，G就等于：</p>
<script type="math/tex; mode=display">
G = 0 + 2^1m_1G_a  + ... + 0 + 2^{199}m_{199}G_a</script><p>对于|来说，分别讨论rj的两种取值，rj为1时，整个式子乘数取1，为0时取mj，因此对于作为例子的(0,1,…,0,1)的r的bit序列，G为：</p>
<script type="math/tex; mode=display">
G = 2^0m_0G_a + 2^1G_a  + ... + 2^{198}m_{198}G_a + 2^{199}G_a</script><p>移一下项就变成需要的方程形式：</p>
<script type="math/tex; mode=display">
G-2^1G_a- 2^{199}G_a = 2^0m_0G_a  + ... + 2^{198}m_{198}G_a</script><p>如此一来，and和or又各提供60个方程，我们就拥有了关于m的200个bit变量的200个方程。</p>
<h5 id="利用上述方程"><a href="#利用上述方程" class="headerlink" title="利用上述方程"></a>利用上述方程</h5><p>接下来的问题就变成，已知关于m的200个bit的200个方程，如何求解m。很自然地会想到先用矩阵方程把这个式子表示出来，就像下面这样：</p>
<script type="math/tex; mode=display">
L_{200\times 200}
\left(\begin{matrix}
m_0\\
m_1\\
...\\
m_{199}\\
\end{matrix}
\right)
G_a
=
P_{200\times 1}</script><p>其中，L矩阵中的每一行，就是我们刚才每一个方程中Ga前的系数构成的向量，因为有200个方程所以是200x200的矩阵；而P向量中的每个元素就是列出的方程左边的点。</p>
<p>注意到，虽然矩阵L、点Ga以及向量P都是已知的，但是可以看出，这并不是一个普通的矩阵方程，因为它涉及到椭圆曲线的点乘，并且曲线难以求解dlp，所以不好统一转化到生成元上，从而变成纯数域的计算。所以是没有办法直接解矩阵方程得到解向量m的。</p>
<p>不过bit by bit的思路依然可以用，我们第一次求解如下矩阵方程：</p>
<script type="math/tex; mode=display">
(x_0,x_1,...,x_{199})
L
=
(1,0,...,0)</script><p>求出这个X向量的意义在于，我们把x代回刚才的式子里：</p>
<script type="math/tex; mode=display">
(x_0,x_1,...,x_{199})
L
\left(\begin{matrix}
m_0\\
m_1\\
...\\
m_{199}\\
\end{matrix}
\right)
G_a
=
(x_0,x_1,...,x_{199})
P</script><p>那么也就是：</p>
<script type="math/tex; mode=display">
(1,0,...,0)
\left(\begin{matrix}
m_0\\
m_1\\
...\\
m_{199}\\
\end{matrix}
\right)
G_a
=
(x_0,x_1,...,x_{199})
P</script><p>也就是：</p>
<script type="math/tex; mode=display">
m_0
G_a
=
(x_0,x_1,...,x_{199})
P</script><p>所以只需要等式右边的点是不是0*Ga就能判断m的当前bit是不是0.如此就可以逐bit还原m了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> errorcc_output <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 groebner to get a,b,p</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    PR.&lt;a,b&gt; = PolynomialRing(ZZ)</span><br><span class="line">    F = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        f = G[i][<span class="number">1</span>]^<span class="number">2</span>-G[i][<span class="number">0</span>]^<span class="number">3</span>-a*G[i][<span class="number">0</span>]-b</span><br><span class="line">        F.append(f)</span><br><span class="line">    res = Ideal(F).groebner_basis()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">p = <span class="number">1287829304049714244524067710692915105281415000125398093331471</span></span><br><span class="line">a = p-<span class="number">225347669189365890161624438870935953357140181565885210886229</span></span><br><span class="line">b = p-<span class="number">270712467434746420425713635322490969521436540014940033725570</span></span><br><span class="line">E = EllipticCurve(Zmod(p),[a,b])</span><br><span class="line"><span class="built_in">ord</span> = E.order()</span><br><span class="line">Ga = E(Ga)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(G)):</span><br><span class="line">    G[i] = E(G[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 construct L</span></span><br><span class="line">gift = bytes_to_long(<span class="string">b&#x27;N1CTF Junior&#x27;</span>)</span><br><span class="line">random.seed(gift)</span><br><span class="line">L = Matrix(Zmod(<span class="built_in">ord</span>),<span class="number">200</span>,<span class="number">200</span>)</span><br><span class="line">P = []</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.1 xor</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">80</span>):</span><br><span class="line">    ri = random.randint(<span class="number">0</span>,p-<span class="number">1</span>)</span><br><span class="line">    temp = <span class="built_in">bin</span>(ri)[<span class="number">2</span>:].zfill(<span class="number">200</span>)[::-<span class="number">1</span>]</span><br><span class="line">    tempG = G[i]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(temp)):</span><br><span class="line">        <span class="keyword">if</span>(temp[j] == <span class="string">&quot;0&quot;</span>):</span><br><span class="line">            L[i,j] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            L[i,j] = -<span class="number">1</span></span><br><span class="line">            tempG -= <span class="number">2</span>^j*Ga</span><br><span class="line">    P.append(tempG)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.2 and</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">80</span>,<span class="number">140</span>):</span><br><span class="line">    ri = random.randint(<span class="number">0</span>,p-<span class="number">1</span>)</span><br><span class="line">    temp = <span class="built_in">bin</span>(ri)[<span class="number">2</span>:].zfill(<span class="number">200</span>)[::-<span class="number">1</span>]</span><br><span class="line">    tempG = G[i]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(temp)):</span><br><span class="line">        <span class="keyword">if</span>(temp[j] == <span class="string">&quot;0&quot;</span>):</span><br><span class="line">            L[i,j] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            L[i,j] = <span class="number">1</span></span><br><span class="line">    P.append(tempG)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.3 or</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">140</span>,<span class="number">200</span>):</span><br><span class="line">    ri = random.randint(<span class="number">0</span>,p-<span class="number">1</span>)</span><br><span class="line">    temp = <span class="built_in">bin</span>(ri)[<span class="number">2</span>:].zfill(<span class="number">200</span>)[::-<span class="number">1</span>]</span><br><span class="line">    tempG = G[i]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(temp)):</span><br><span class="line">        <span class="keyword">if</span>(temp[j] == <span class="string">&quot;0&quot;</span>):</span><br><span class="line">            L[i,j] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            L[i,j] = <span class="number">0</span></span><br><span class="line">            tempG -= <span class="number">2</span>^j*Ga</span><br><span class="line">    P.append(tempG)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 bit by bit to recover flag</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">O = <span class="number">0</span>*Ga</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">200</span>):</span><br><span class="line">    u = vector(Zmod(<span class="built_in">ord</span>),[<span class="number">0</span>]*i + [<span class="number">1</span>] + [<span class="number">0</span>]*(<span class="number">199</span>-i))</span><br><span class="line">    temp = L.solve_left(u)</span><br><span class="line">    S = O</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(temp)):</span><br><span class="line">        S += <span class="built_in">int</span>(temp[j])*P[j]</span><br><span class="line">    <span class="keyword">if</span>(S == O):</span><br><span class="line">        flag += <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag[::-<span class="number">1</span>],<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#secpunk&#123;f4ult_1nj3cti0n~p0werfu1!&#125;</span></span><br></pre></td></tr></table></figure>
<p>很巧妙的思路，类似的就可以把这个解法也拓展到N1CTF的e2dlp上，虽然都是bit by bit求但是还是有细微差别。</p>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/e052b7cc.html" title="2023-N1CTF-junior-wp-crypto">https://tangcuxiaojikuai.xyz/post/e052b7cc.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/549b2003.html" rel="prev" title="第七届西湖论剑·中国杭州网络安全技能大赛-wp-crypto">
      <i class="fa fa-chevron-left"></i> 第七届西湖论剑·中国杭州网络安全技能大赛-wp-crypto
    </a></div>
      <div class="post-nav-item">
    <a href="/post/d14a80bb.html" rel="next" title="2024-N1CTF-junior-wp-crypto">
      2024-N1CTF-junior-wp-crypto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#ezezez"><span class="nav-number">1.</span> <span class="nav-text">ezezez</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fastmix"><span class="nav-number">2.</span> <span class="nav-text">fastmix</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#n1lucky"><span class="nav-number">3.</span> <span class="nav-text">n1lucky</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RealSignin"><span class="nav-number">4.</span> <span class="nav-text">RealSignin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#errorcc"><span class="nav-number">5.</span> <span class="nav-text">errorcc</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1%E6%9B%B4%E6%96%B0"><span class="nav-number">5.1.</span> <span class="nav-text">(2.1更新)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#xor"><span class="nav-number">5.1.1.</span> <span class="nav-text">xor</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#and-or"><span class="nav-number">5.1.2.</span> <span class="nav-text">and ,or</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E4%B8%8A%E8%BF%B0%E6%96%B9%E7%A8%8B"><span class="nav-number">5.1.3.</span> <span class="nav-text">利用上述方程</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">112</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tangcuxiaojikuai" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tangcuxiaojikuai" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
