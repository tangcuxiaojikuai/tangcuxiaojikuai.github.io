<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="这个新生赛战线拉得很长，难度也不算特别新生，wp的题目顺序就按网站上显示的来。">
<meta property="og:type" content="article">
<meta property="og:title" content="2024-XYCTF-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/146254b2.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="这个新生赛战线拉得很长，难度也不算特别新生，wp的题目顺序就按网站上显示的来。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-04-28T01:22:21.000Z">
<meta property="article:modified_time" content="2024-04-28T01:57:25.798Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/146254b2.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2024-XYCTF-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/146254b2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2024-XYCTF-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-04-28 09:22:21 / 修改时间：09:57:25" itemprop="dateCreated datePublished" datetime="2024-04-28T09:22:21+08:00">2024-04-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/146254b2.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/146254b2.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>这个新生赛战线拉得很长，难度也不算特别新生，wp的题目顺序就按网站上显示的来。</p>
<span id="more"></span>
<h3 id="x0r"><a href="#x0r" class="headerlink" title="x0r"></a>x0r</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc版签到</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">flag = pad(flag, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt</span>(<span class="params">key, plaintext</span>):</span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">return</span> cipher.encrypt(plaintext)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">key, plaintext, iv</span>):</span><br><span class="line">    ciphertext = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(plaintext), AES.block_size):</span><br><span class="line">        key_block = aes_encrypt(key, iv)</span><br><span class="line">        ciphertext_block = <span class="built_in">bytes</span>(</span><br><span class="line">            [plaintext[i + j] ^ key_block[j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(AES.block_size)]</span><br><span class="line">        )</span><br><span class="line">        ciphertext += ciphertext_block</span><br><span class="line">        iv = key_block</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;1.print\n2.input\n3.exit&quot;</span>)</span><br><span class="line">        a = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> a == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>((iv + encrypt(key, flag, iv)).<span class="built_in">hex</span>())</span><br><span class="line">        <span class="keyword">elif</span> a == <span class="string">&quot;2&quot;</span>:</span><br><span class="line">            ivs = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;iv: &quot;</span>))</span><br><span class="line">            inputs = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;message: &quot;</span>))</span><br><span class="line">            <span class="built_in">print</span>(encrypt(key, inputs, ivs).<span class="built_in">hex</span>())</span><br><span class="line">        <span class="keyword">elif</span> a == <span class="string">&quot;3&quot;</span>:</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;You need input 1,2,3&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>一个交互题，连接上靶机后，靶机会生成完全随机的key和iv，然后给出以下几种选择：</p>
<ul>
<li>输入1，可以得到本次的iv和flag的加密值</li>
<li>输入2，可以自定义输入一个iv以及消息，得到这个消息的加密值</li>
</ul>
<p>这个题的突破点在于他的加密方式，仔细看encrypt函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">key, plaintext, iv</span>):</span><br><span class="line">    ciphertext = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(plaintext), AES.block_size):</span><br><span class="line">        key_block = aes_encrypt(key, iv)</span><br><span class="line">        ciphertext_block = <span class="built_in">bytes</span>(</span><br><span class="line">            [plaintext[i + j] ^ key_block[j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(AES.block_size)]</span><br><span class="line">        )</span><br><span class="line">        ciphertext += ciphertext_block</span><br><span class="line">        iv = key_block</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br></pre></td></tr></table></figure>
<p>可以看到，他其实是将iv进行AES加密，然后将加密块与明文逐块进行异或，并更新iv。因此我们只需要先输入1得到iv和flag的密文，然后输入全0的消息去得到每次加密的iv块，然后再与密文做异或就得到flag了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;xyctf.top&quot;</span>,<span class="number">39233</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get data</span></span><br><span class="line">sh.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">temp = sh.recvline().strip().decode()</span><br><span class="line">iv = long_to_bytes(<span class="built_in">int</span>(temp[:<span class="number">32</span>],<span class="number">16</span>))</span><br><span class="line">enc = long_to_bytes(<span class="built_in">int</span>(temp[<span class="number">32</span>:],<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 send msg</span></span><br><span class="line">msg = <span class="number">48</span>*<span class="string">b&quot;\x00&quot;</span></span><br><span class="line">sh.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;iv: &quot;</span>)</span><br><span class="line">sh.sendline(iv.<span class="built_in">hex</span>().encode())</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;message: &quot;</span>)</span><br><span class="line">sh.sendline(msg.<span class="built_in">hex</span>().encode())</span><br><span class="line">enc_msg = long_to_bytes(<span class="built_in">int</span>(sh.recvline().strip().decode(),<span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(xor(enc_msg,enc))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;5647687b-6c8e-4e13-b73d-a54c39d95511&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Complex-rsa"><a href="#Complex-rsa" class="headerlink" title="Complex_rsa"></a>Complex_rsa</h3><p>题目描述：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, re, im</span>):</span><br><span class="line">        self.re = re</span><br><span class="line">        self.im = im</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, c</span>):</span><br><span class="line">        re_ = self.re * c.re - self.im * c.im</span><br><span class="line">        im_ = self.re * c.im + self.im * c.re</span><br><span class="line">        <span class="keyword">return</span> Complex(re_, im_)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.im == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(self.re)</span><br><span class="line">        <span class="keyword">elif</span> self.re == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(self.im) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;-&#x27;</span> <span class="keyword">if</span> self.im &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>i&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.im&#125;</span>i&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.re&#125;</span> <span class="subst">&#123;<span class="string">&#x27;+&#x27;</span> <span class="keyword">if</span> self.im &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;-&#x27;</span>&#125;</span> <span class="subst">&#123;<span class="built_in">abs</span>(self.im)&#125;</span>i&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complex_pow</span>(<span class="params">c, exp, n</span>):</span><br><span class="line">    result = Complex(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = result * c</span><br><span class="line">            result.re = result.re % n</span><br><span class="line">            result.im = result.im % n</span><br><span class="line">        c = c * c</span><br><span class="line">        c.re = c.re % n</span><br><span class="line">        c.im = c.im % n</span><br><span class="line">        exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">key = getRandomNBitInteger(m.bit_length())</span><br><span class="line">c = m ^ key</span><br><span class="line">com = Complex(key, c)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">e = <span class="number">9</span></span><br><span class="line">enc = complex_pow(com, e, p * q)</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br><span class="line"><span class="built_in">print</span>(Complex(p, q) * Complex(p, q))</span><br><span class="line"><span class="comment"># 66350931528185981323649477263900844564494528747802437244889229343520648562164950914433406604580038018765783183569276743239888668912948977370163046257917321742455772852779551569446155827368453262479370103326286297164105599131090881306108546341785251895116423206455175290083968296281375908109039893280371271943 + 65266730684129269806656018828265187384002656633231286337130178390517924611751697965395744944541329793503617856896706439809241745206839328124348693486741656130890593895436661857688522977866438805549144904296596887218275440542852887148071837153436265722614658566275517205322945316112048487893204059562830581004i</span></span><br><span class="line"><span class="comment"># -28814875173103880290298835537218644402443395484370652510062722255203946330565951328874411874019897676900075613671629765922970689802650462822117767927082712245512492082864958877932682404829188622269636302484189627580600076246836248427780151681898051243380477561480415972565859837597822263289141887833338111120 + 235362412848885579543400940934854106052672292040465052424316433330114813432317923674803623227280862945857543620663672974955235166884830751834386990766053503640556408758413592161122945636548462064584183165189050320898315823173824074873376450569212651128285746330837777597290934043912373820690250920839961482862i</span></span><br></pre></td></tr></table></figure>
<p>题目是复数域上的一个RSA，他先将m与随机的key异或得到c，然后定义如下复数：</p>
<script type="math/tex; mode=display">
com = k + ci</script><p>之后题目给出如下两个值，要求还原m：</p>
<script type="math/tex; mode=display">
enc = com^9 \quad(mod\;pq)</script><script type="math/tex; mode=display">
(p+qi)(p+qi)</script><p>首先想到的肯定是利用第二个值先得到p、q，由于其展开式为：</p>
<script type="math/tex; mode=display">
(p^2-q^2) + 2pqi</script><p>所以实部和虚部分别对应p、q的一个二元方程，因此可以解出p、q来。</p>
<p>有了p、q之后就要想办法解决前面复数域上的RSA，由于复数域上有：</p>
<script type="math/tex; mode=display">
\phi = (p^2-1)(q^2-1)</script><p>至于为什么是这样可以看我另一篇文章：<a href="https://tangcuxiaojikuai.xyz/post/ea445335.html">Crypto趣题-RSA(一) | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>所以预期是求e关于phi的逆元就可以直接解密，然而对于这个题却有些特殊，这是因为：</p>
<script type="math/tex; mode=display">
GCD(e,p^2-1) = GCD(e,q^2-1) = 3</script><p>所以逆元是不存在的，然而逆元不存在有不存在的办法，我们把加密的式子分别放到模p和模q下观察，这里以模p为例：</p>
<script type="math/tex; mode=display">
enc = com^9 \quad(mod\;p)</script><p>虽然不能直接求e关于p^2-1的逆元，但我们可以求出一个t使得它满足：</p>
<script type="math/tex; mode=display">
9t = 3 \quad(mod\;p^2-1)</script><p>也就是说我们可以拥有：</p>
<script type="math/tex; mode=display">
com^3 = enc^t \quad(mod\;p)</script><p>把com的实部虚部展开得到：</p>
<script type="math/tex; mode=display">
com^3 = (k+ci)^3 = (k^3 - 3kc^2) + (3k^2c - c^3)i \quad(mod\;p)</script><p>而这个实部与虚部其实也就提供了关于k、c模p下的两个等式，也就是：</p>
<script type="math/tex; mode=display">
f_1 = k^3 - 3kc^2 - re</script><script type="math/tex; mode=display">
f_2 = 3k^2c - c^3 - im</script><p>所以可以resultant消去其中一个变量，然后再在模p下求根，就得到了k、c的候选值；对于模q下同理 ，然后将所有可能值crt起来并进行异或，检查是否含flag头即可。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">9</span></span><br><span class="line">pq2 = <span class="number">235362412848885579543400940934854106052672292040465052424316433330114813432317923674803623227280862945857543620663672974955235166884830751834386990766053503640556408758413592161122945636548462064584183165189050320898315823173824074873376450569212651128285746330837777597290934043912373820690250920839961482862</span></span><br><span class="line">p2_q2 = -<span class="number">28814875173103880290298835537218644402443395484370652510062722255203946330565951328874411874019897676900075613671629765922970689802650462822117767927082712245512492082864958877932682404829188622269636302484189627580600076246836248427780151681898051243380477561480415972565859837597822263289141887833338111120</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, re, im</span>):</span><br><span class="line">        self.re = re</span><br><span class="line">        self.im = im</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, c</span>):</span><br><span class="line">        re_ = self.re * c.re - self.im * c.im</span><br><span class="line">        im_ = self.re * c.im + self.im * c.re</span><br><span class="line">        <span class="keyword">return</span> Complex(re_, im_)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.im == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(self.re)</span><br><span class="line">        <span class="keyword">elif</span> self.re == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(self.im) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;-&#x27;</span> <span class="keyword">if</span> self.im &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>i&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.im&#125;</span>i&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.re&#125;</span> <span class="subst">&#123;<span class="string">&#x27;+&#x27;</span> <span class="keyword">if</span> self.im &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;-&#x27;</span>&#125;</span> <span class="subst">&#123;<span class="built_in">abs</span>(self.im)&#125;</span>i&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complex_pow</span>(<span class="params">c, exp, n</span>):</span><br><span class="line">    result = Complex(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = result * c</span><br><span class="line">            result.re = result.re % n</span><br><span class="line">            result.im = result.im % n</span><br><span class="line">        c = c * c</span><br><span class="line">        c.re = c.re % n</span><br><span class="line">        c.im = c.im % n</span><br><span class="line">        exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">p = <span class="number">10205509456040823453782883291824829705816298450992336115902525676510986341532486274067943978039013674207011185602314114359146043975207543018267242312660911</span></span><br><span class="line">q = pq2 // <span class="number">2</span> // p</span><br><span class="line"></span><br><span class="line">com = Complex(<span class="number">66350931528185981323649477263900844564494528747802437244889229343520648562164950914433406604580038018765783183569276743239888668912948977370163046257917321742455772852779551569446155827368453262479370103326286297164105599131090881306108546341785251895116423206455175290083968296281375908109039893280371271943</span> , <span class="number">65266730684129269806656018828265187384002656633231286337130178390517924611751697965395744944541329793503617856896706439809241745206839328124348693486741656130890593895436661857688522977866438805549144904296596887218275440542852887148071837153436265722614658566275517205322945316112048487893204059562830581004</span>)</span><br><span class="line">re = <span class="built_in">int</span>(complex_pow(com, inverse(<span class="number">3</span>,(p^<span class="number">2</span>-<span class="number">1</span>)//<span class="number">3</span>), p).re)</span><br><span class="line">im = <span class="built_in">int</span>(complex_pow(com, inverse(<span class="number">3</span>,(p^<span class="number">2</span>-<span class="number">1</span>)//<span class="number">3</span>), p).im)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PR.&lt;a,b&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f1 = a^<span class="number">3</span> - <span class="number">3</span>*a*b^<span class="number">2</span> - re</span><br><span class="line">f2 = <span class="number">3</span>*a^<span class="number">2</span>*b - b^<span class="number">3</span> - im</span><br><span class="line">h = f1.sylvester_matrix(f2, a).det()</span><br><span class="line">res1 = h.univariate_polynomial().monic().roots()</span><br><span class="line"><span class="built_in">print</span>(res1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">re = <span class="built_in">int</span>(complex_pow(com, inverse(<span class="number">3</span>,(q^<span class="number">2</span>-<span class="number">1</span>)//<span class="number">3</span>), q).re)</span><br><span class="line">im = <span class="built_in">int</span>(complex_pow(com, inverse(<span class="number">3</span>,(q^<span class="number">2</span>-<span class="number">1</span>)//<span class="number">3</span>), q).im)</span><br><span class="line">PR.&lt;a,b&gt; = PolynomialRing(Zmod(q))</span><br><span class="line">f1 = a^<span class="number">3</span> - <span class="number">3</span>*a*b^<span class="number">2</span> - re</span><br><span class="line">f2 = <span class="number">3</span>*a^<span class="number">2</span>*b - b^<span class="number">3</span> - im</span><br><span class="line">h = f1.sylvester_matrix(f2, a).det()</span><br><span class="line">res1 = h.univariate_polynomial().monic().roots()</span><br><span class="line"><span class="built_in">print</span>(res1)</span><br></pre></td></tr></table></figure>
<p>crt：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"><span class="comment">#M = crt(n,c)[0]</span></span><br><span class="line"></span><br><span class="line">pq2 = <span class="number">235362412848885579543400940934854106052672292040465052424316433330114813432317923674803623227280862945857543620663672974955235166884830751834386990766053503640556408758413592161122945636548462064584183165189050320898315823173824074873376450569212651128285746330837777597290934043912373820690250920839961482862</span></span><br><span class="line">p2_q2 = -<span class="number">28814875173103880290298835537218644402443395484370652510062722255203946330565951328874411874019897676900075613671629765922970689802650462822117767927082712245512492082864958877932682404829188622269636302484189627580600076246836248427780151681898051243380477561480415972565859837597822263289141887833338111120</span></span><br><span class="line">p = <span class="number">10205509456040823453782883291824829705816298450992336115902525676510986341532486274067943978039013674207011185602314114359146043975207543018267242312660911</span></span><br><span class="line">q = pq2 // <span class="number">2</span> // p</span><br><span class="line"></span><br><span class="line">resp = [(<span class="number">5741279734159523094711430662094390392066954482529914882030709450295074947781529110509321968864008611691202383770840412010325910906148313511187473860891035</span>, <span class="number">1</span>), (<span class="number">4429927739780647098163182245695850111737474361073472216489514077452142827783532166774438977867801037416377640995299677179237078298139871084989841206362410</span>, <span class="number">1</span>), (<span class="number">34301982100653260908270384034589202011869607388949017382302148763768565967424996784183031307204025099431160836174025169583054770919358422089927245407466</span>, <span class="number">1</span>)]</span><br><span class="line">resq = [(<span class="number">10739940731745824081418381715901342901309159762856543362640396906171107996295925365437945464907432967788383551341616951552057327658847904490010061152434332</span>, <span class="number">1</span>), (<span class="number">8586549363626610854952590733794044071899545915261216635206863621255915665043556027382073545902963458915586846862230166123268280750109862724278599667847493</span>, <span class="number">1</span>), (<span class="number">7045447028567292693464036821896048537001778022349939312880599967825498301190014724113928977446846014453607030578761699581827447107524459504793000974080961</span>, <span class="number">1</span>), (<span class="number">5276901669007862459606429311418416791067007412160397323233728060764482838272522831695179159225558247215591099096136610833622276098301992005638773878483349</span>, <span class="number">1</span>), (<span class="number">4073305908343434001432234700505703739500538013701467077531217640906529193773037971902079461771703238283853345951042314327641038705737553746426200870882295</span>, <span class="number">1</span>), (<span class="number">3735799333948544298117875399520421256169239519249120000907464407334065474418981528427034590769440802753611282812668144292181442455716588786153175184716817</span>, <span class="number">1</span>), (<span class="number">3722039472368511317694313824581779119019195065732852920938680419139949899687211960294412748248774573691326211744547172363931044270883035467641541946900209</span>, <span class="number">1</span>), (<span class="number">2532203573284115839943680788607708204602770120790189755204953987476111829919496668633934893315585793821873529667573847786200205063152150526940602177115763</span>, <span class="number">1</span>), (<span class="number">412391777749762922348152402206151838186656562632033608965544858648517072916178764607518361571369361991330463978453617074285039619075164749001716157536065</span>, <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">cp = []</span><br><span class="line">cq = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> resp:</span><br><span class="line">    cp.append(i[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> resq:</span><br><span class="line">    cq.append(i[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">KEY = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cp:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> cq:</span><br><span class="line">        n = [p,q]</span><br><span class="line">        c = [i,j]</span><br><span class="line">        key = crt(n,c)[<span class="number">0</span>]</span><br><span class="line">        KEY.append(key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">resp = [(<span class="number">8001885192071749859699066040025029961395167917875583646644249565155819105797467000967544636712092306411149367493633723366623965498649673837196063800580404</span>, <span class="number">1</span>), (<span class="number">1662435559780994004386842122204566836802794060667449753807174598739830437128828179292947062605594949711892539092095892832053999186054026591407366803020136</span>, <span class="number">1</span>), (<span class="number">541188704188079589696975129595232907618336472449302715451101512615336798606191093807452278721326418083969279016584498160468079290503842589663811709060371</span>, <span class="number">1</span>)]</span><br><span class="line">resq = [(<span class="number">8503432605028099223082740882529347146997316989367545950492333769305549393260049047195629451308480848275471020811688622917531588079409913760096873405190234</span>, <span class="number">1</span>), (<span class="number">8366627759634051290333268012004602352405002740363136177900446298441200900164136168489014946546974693508397220434695162939560760156985163750847606373150919</span>, <span class="number">1</span>), (<span class="number">7838336389145961788946008207588532360344213223957590603935032631402061939530140801549439038388256401440065798242555755132126684810445868962728928464941121</span>, <span class="number">1</span>), (<span class="number">6857325280540966155209571629622673516628729233046153216919246004917826296064185951208599616644606134509118662339264343895819605897243323286865301166906602</span>, <span class="number">1</span>), (<span class="number">6192229064658828721072838954681858729975625467636197870361944867014338842334277705562409203724381687673713439770131476110414702628279278489497356226657489</span>, <span class="number">1</span>), (<span class="number">4121694029664041978927797165221546618939268589175297893513650941901521328887423207726634825943843128912526687991267349501555811582062174969259522939168771</span>, <span class="number">1</span>), (<span class="number">2475586705176908911054627912314872988570680832853905159940563177513798231691560111739604991279968415146174329518843070479843829399895584496027950700885139</span>, <span class="number">1</span>), (<span class="number">1217221620337618917243787804704498765774078541871944235501766658464684396657530547334482771121693798142550712746858805371783011221995724541464038836673061</span>, <span class="number">1</span>), (<span class="number">552125404455481483107055129763683979120974776461988888944465520561196942927622301688292358201469351307145490177725937586378107953031679744096093896423948</span>, <span class="number">1</span>)]</span><br><span class="line">cp = []</span><br><span class="line">cq = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> resp:</span><br><span class="line">    cp.append(i[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> resq:</span><br><span class="line">    cq.append(i[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">CC = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cp:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> cq:</span><br><span class="line">        n = [p,q]</span><br><span class="line">        c = [i,j]</span><br><span class="line">        cc = crt(n,c)[<span class="number">0</span>]</span><br><span class="line">        CC.append(cc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> CC:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> KEY:</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> long_to_bytes(i ^ j)):</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(i ^ j))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(CC))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;Complex_is_so_fun_and_I_think_you_know_Sylvester!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="factor1"><a href="#factor1" class="headerlink" title="factor1"></a>factor1</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这个e咋比n还大啊</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">d = getPrime(<span class="number">512</span>)</span><br><span class="line">e = gmpy2.invert(d, (p**<span class="number">3</span> - <span class="number">1</span>) * (q**<span class="number">3</span> - <span class="number">1</span>))</span><br><span class="line">flag = <span class="string">&quot;XYCTF&#123;&quot;</span> + hashlib.md5(<span class="built_in">str</span>(p + q).encode()).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(p * q)</span><br><span class="line"><span class="comment"># 172005065945326769176157335849432320425605083524943730546805772515111751580759726759492349719668775270727323745284785341119685198468883978645793770975366048506237371435027612758232099414404389043740306443065413069994232238075194102578269859784981454218948784071599231415554297361219709787507633404217550013282713899284609273532223781487419770338416653260109238572639243087280632577902857385265070736208291583497988891353312351322545840742380550393294960815728021248513046077985900158814037534487146730483099151396746751774427787635287611736111679074330407715700153025952858666841328055071403960165321273972935204988906850585454805923440635864200149694398767776539993952528995717480620593326867245714074205285828967234591508039849777840636255379730281105670496110061909219669860172557450779495125345533232776767292561378244884362014224844319802810586344516400297830227894063759083198761120293919537342405893653545157892446163</span></span><br><span class="line"><span class="comment"># 99075185389443078008327214328328747792385153883836599753096971412377366865826254033534293886034828804219037466246175526347014045811852531994537520303063113985486063022444972761276531422538694915030159420989401280012025249129111871649831185047820236417385693285461420040134313833571949090757635806658958193793</span></span><br></pre></td></tr></table></figure>
<p>题目很明显的一点是d较小，仅有512bit，所以应该是想办法构造copper，而构造copper的依据就是以下等式：</p>
<script type="math/tex; mode=display">
ed = 1 + k(p^3-1)(q^3-1)</script><p>稍加变形后放到模e下就有：</p>
<script type="math/tex; mode=display">
f = 1 + k(n^3 - (p^3 + q^3) + 1) \quad(mod\;e)</script><p>k应该是和d相近的小量，p^3+q^3在模e下也较小，因此造出下面的二元copper：</p>
<script type="math/tex; mode=display">
f = 1 + x(n^3 - y + 1) \quad(mod\;e)</script><p>之后大力调一下二元copper的参数就好了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get k,p3q3</span></span><br><span class="line">e = <span class="number">172005065945326769176157335849432320425605083524943730546805772515111751580759726759492349719668775270727323745284785341119685198468883978645793770975366048506237371435027612758232099414404389043740306443065413069994232238075194102578269859784981454218948784071599231415554297361219709787507633404217550013282713899284609273532223781487419770338416653260109238572639243087280632577902857385265070736208291583497988891353312351322545840742380550393294960815728021248513046077985900158814037534487146730483099151396746751774427787635287611736111679074330407715700153025952858666841328055071403960165321273972935204988906850585454805923440635864200149694398767776539993952528995717480620593326867245714074205285828967234591508039849777840636255379730281105670496110061909219669860172557450779495125345533232776767292561378244884362014224844319802810586344516400297830227894063759083198761120293919537342405893653545157892446163</span></span><br><span class="line">n = <span class="number">99075185389443078008327214328328747792385153883836599753096971412377366865826254033534293886034828804219037466246175526347014045811852531994537520303063113985486063022444972761276531422538694915030159420989401280012025249129111871649831185047820236417385693285461420040134313833571949090757635806658958193793</span></span><br><span class="line"></span><br><span class="line">PR.&lt;x,y&gt; = PolynomialRing(Zmod(e))</span><br><span class="line">f = <span class="number">1</span> + x * (n^<span class="number">3</span> - y + <span class="number">1</span>)</span><br><span class="line">res = small_roots(f , bounds = (<span class="number">2</span>^<span class="number">512</span>,(<span class="number">2</span>^<span class="number">512</span>)^<span class="number">3</span>) , m=<span class="number">7</span> , d=<span class="number">3</span>)</span><br><span class="line">k = <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">p3q3 = <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 factor n</span></span><br><span class="line">p, q = var(<span class="string">&#x27;p, q&#x27;</span>)</span><br><span class="line">res = solve([p*q == n, p^<span class="number">3</span> + q^<span class="number">3</span> == p3q3], p, q)</span><br><span class="line"><span class="comment">#print(res)</span></span><br><span class="line">p = <span class="number">9212046353930376594996890089494718736894378991991381248242532319628627449681664076081705664941905594411935750003102856235503684466394327681725704255564467</span></span><br><span class="line">q = n // p</span><br><span class="line"><span class="keyword">assert</span> p*q == n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 get flag</span></span><br><span class="line">flag = <span class="string">&quot;XYCTF&#123;&quot;</span> + hashlib.md5(<span class="built_in">str</span>(p + q).encode()).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;a83211a70e18145a59671c08ddc67ba4&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="new-LCG"><a href="#new-LCG" class="headerlink" title="new_LCG"></a>new_LCG</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lcg练习</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">r = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q * r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG1</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed, a, b, m</span>):</span><br><span class="line">        self.seed = seed</span><br><span class="line">        self.a = a</span><br><span class="line">        self.b = b</span><br><span class="line">        self.m = m</span><br><span class="line">        self.<span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        old_seed = self.seed</span><br><span class="line">        self.seed = (self.a * self.seed + self.b * self.<span class="built_in">sum</span>) % self.m</span><br><span class="line">        self.<span class="built_in">sum</span> += old_seed</span><br><span class="line">        <span class="keyword">return</span> self.seed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG2</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed, q, A, B</span>):</span><br><span class="line">        self.E = EllipticCurve(GF(q), [A, B])</span><br><span class="line">        self.P = self.E.lift_x(seed)</span><br><span class="line">        self.b = self.E.random_point()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.P = self.P + self.b</span><br><span class="line">        <span class="keyword">return</span> self.P[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a1 = random.randint(<span class="number">1</span>, p)</span><br><span class="line">b1 = random.randint(<span class="number">1</span>, p)</span><br><span class="line">seed1 = random.randint(<span class="number">1</span>, p)</span><br><span class="line">lcg1 = LCG1(seed1, a1, b1, p)</span><br><span class="line">c1 = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    c1.append(lcg1.<span class="built_in">next</span>())</span><br><span class="line"></span><br><span class="line">a2 = random.randint(<span class="number">1</span>, q)</span><br><span class="line">b2 = random.randint(<span class="number">1</span>, q)</span><br><span class="line">seed2 = random.randint(<span class="number">1</span>, q)</span><br><span class="line">lcg2 = LCG2(seed2, q, a2, b2)</span><br><span class="line">c2 = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    c2.append(lcg2.<span class="built_in">next</span>())</span><br><span class="line"></span><br><span class="line">c = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(c, e, n))</span><br><span class="line"><span class="built_in">print</span>(c1)</span><br><span class="line"><span class="built_in">print</span>(c2)</span><br><span class="line"><span class="comment"># 942554394956393500634473023924044851150783066435925660508624376974971108656861080872622432250172571195245180102507380675343264066303507696268870722959770362631674931170602993210221083436437860191861911457384526742569208842886612504579678703976889217504241741044075116270718940025586448491942058697669033418724145042156461740336592337509609124425828725269151627786668070531098444935129266626770404736852607352075247856808563388127774523912002202264558855255067503</span></span><br><span class="line"><span class="comment"># 91351185520045025851535940537599785616890151570421939971146348618267656786110090770321857244701820126026227283965934212135946431643320325513590505155214070540638751565105300361430272638957420276596026161454413739823593506516275224444666187442238624864548263927274591212614561916913851855552516864387460946267629794664216228596534684933791607740725160394841711539767932339281214673649553407414347293480522175832736301571839298158011533849603878482322619858083471</span></span><br><span class="line"><span class="comment"># [6924229081976334180193477951417117275396656434968000032228908231511246053064833236257422745299036986875244562025221130619850904830372215788197314906896784,707045810464337488125013716300756405499020414540801863434513087687914538170573314824134496890600422837133767094273649381435979038909605432188919586751472,561487665739111774897165274560908487232457333748910467998343202097778699925650682704996443560224288857862513676706660506594465853704042586896087391214886,6498834369085375452441121562339384727357898216850540864190840194924515286757125433756518026123451611578553656133012172518080309106483207567929943790044792,5508345401684913940610183958526398635406187349043368834080838153611810896629693027245511688366776749176652858929409374912959736262162942801190344337268446,7604410082265211154108357446507297790451766698177313130672954202813796888988719242951127448112228332967892794819415211618572734294964346056056171483002307,7699815879242527638422887386550759485127768822609011364311314299885418068889791030639324882736871756700299169635780542149704586720216395186814592666988591,829748131720382599696653359722612708514830904084605048590882951300049701148883021283243506081300427041733299385325284399270633917941134488957784480285437,7084115400374950827522650500486495223539292992998875483730758098005030106055310282589342193536381973309924074043955222228738842206417828828756951777504457,7482796067314266426215648326036921955183807741134787613584977300821023398375789725848056657250086288687570875979072368004217788222537115232191230702833854]</span></span><br><span class="line"><span class="comment"># [12573984103581521249597169818949825744876735847170990673204303602848066091917704946653820386665801380026230957120354174481948164514637637956459534723582285, 6441954407109995413858792101472089558106780628459991101662507565699664222341697230094798036088532393057448200220905589679548875702178737462785403325555226, 11684244745641367106386196774447204674089853123966422387024948921795099192025069760680924547214190425118261001002764397184950251157744938735586522727499550, 10396243416373326695473843427139385116708652845789644861965876346553795313454773668473030130335970707089781482749749170266279229263892370064669233541305377, 9090748241360606371310281608818966855338110969397659720953951845805983771894064629343960530245792700858927510839835850767728294266738917884471006979663157, 11489848045104749332790333272128633885019156159805805159750174723808043569789257625027794186359921080743368220606914862583644262009648261345452266067697628, 649349258009900424806913260265314442160901414078390702088746248078789581041616487825633046538335114117254875547413590064940767523651802950986197978665018, 6302136940345077947382276151657194124073457559487274425879887978386901058162385833414602346299055653879087077862824771863209271498552774720708307840705334, 5844526398244645236473089500608731415060125566027525405618000580381149761653744142808567706048834618328671311836990498943019718294135733114642775270792763, 4834548043993868659061606699822957422840040425976833628462093089330507589865407793951971491111695171201542345470702059513427268037868859282999222070054388]</span></span><br></pre></td></tr></table></figure>
<p>题目分为两个不同的LCG，均给出连续十组数据，需要恢复各自的模数从而实现最后的RSA解密。</p>
<h4 id="LCG1"><a href="#LCG1" class="headerlink" title="LCG1"></a>LCG1</h4><p>第一个LCG的递推过程为：</p>
<script type="math/tex; mode=display">
x_{i+1} = ax_{i} + b\sum_{j=0}^{i-1}x_{j} \quad(mod\;p)</script><p>由于初始种子未知，所以实际上一共有a、b、p、x0四个未知数，但是给了连续的数据，相当于提供了十个方程，所以建groebner来解完全够了。</p>
<h4 id="LCG2"><a href="#LCG2" class="headerlink" title="LCG2"></a>LCG2</h4><p>第二个LCG是椭圆曲线上的LCG，其递推过程为：</p>
<script type="math/tex; mode=display">
P_{i+1} = P_i + b</script><p>其中b是椭圆曲线上的一个随机点，生成随机数的步骤就是取当前Pi的横坐标。</p>
<p>而我们并不知道椭圆曲线方程，能拿到的仅有连续十个横坐标而已，也就是说对于这条椭圆曲线来说：</p>
<script type="math/tex; mode=display">
y^2 = x^3 + ax + b \quad(mod\;p)</script><p>参数a、b、p都是未知量。同时，给出的十个点的纵坐标，以及种子的横纵坐标和b的横纵坐标都是未知的，看上去未知的量的个数超过了我们能建立的方程数量。</p>
<p>然而仔细想的话会知道，每个点的纵坐标其实都是可以用横坐标和曲线方程来联系的，所以严格来说纵坐标并不算未知量，只是曲线方程里的纵坐标有平方项，比较难以处理。但这个时候可以使用一个类似于西湖论剑”MyCurveErrorLearn”一题的消元技巧，把连续的三个点看作一组，这个时候其实就有：</p>
<script type="math/tex; mode=display">
P_1 = P_2 - b</script><script type="math/tex; mode=display">
P_3 = P_2 + b</script><p>由椭圆曲线的点加公式知道，如果有：</p>
<script type="math/tex; mode=display">
G_1 + G_2 = G_3</script><p>那么其横坐标满足关系：</p>
<script type="math/tex; mode=display">
x_3 = (\frac{y_2-y_1}{x_2-x_1})^2 - x_1 - x_2</script><p>如果记b=(gx,gy)，则-b=(gx,-gy)，那么对于P2-b和P2+b分别有：</p>
<script type="math/tex; mode=display">
x_1 =  (\frac{gy+y_2}{gx-x_2})^2 - gx - x_2</script><script type="math/tex; mode=display">
x_3 =  (\frac{gy-y_2}{gx-x_2})^2 - gx - x_2</script><p>所以得到：</p>
<script type="math/tex; mode=display">
x_1 + x_3 =  (\frac{gy+y_2}{gx-x_2})^2 + (\frac{gy-y_2}{gx-x_2})^2 - 2gx - 2x_2</script><p>打开括号后合并同类项：</p>
<script type="math/tex; mode=display">
(gx-x_2)^2(x_1 + x_3) = 2(gy^2 + y_2^2) - 2(gx + x_2)(gx-x_2)^2</script><p>此时可以发现，这样做的好处在于消去了所有纵坐标不是二次的项，而纵坐标的二次项都可以用椭圆曲线方程来代换，也就是：</p>
<script type="math/tex; mode=display">
(gx-x_2)^2(x_1 + x_3) = 2(gx^3 + ag_x + b + x_2^3 + ax_3 + b) - 2(gx + x_2)(gx-x_2)^2</script><p>如此一来，所有的未知数就只剩下了b的横坐标gx以及椭圆曲线的参数a、b、p，而我们显然可以用给出的十组横坐标建立多组上面这个形式的方程，然后就可以groebner求解出模数。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">942554394956393500634473023924044851150783066435925660508624376974971108656861080872622432250172571195245180102507380675343264066303507696268870722959770362631674931170602993210221083436437860191861911457384526742569208842886612504579678703976889217504241741044075116270718940025586448491942058697669033418724145042156461740336592337509609124425828725269151627786668070531098444935129266626770404736852607352075247856808563388127774523912002202264558855255067503</span></span><br><span class="line">c = <span class="number">91351185520045025851535940537599785616890151570421939971146348618267656786110090770321857244701820126026227283965934212135946431643320325513590505155214070540638751565105300361430272638957420276596026161454413739823593506516275224444666187442238624864548263927274591212614561916913851855552516864387460946267629794664216228596534684933791607740725160394841711539767932339281214673649553407414347293480522175832736301571839298158011533849603878482322619858083471</span></span><br><span class="line">c1 = [<span class="number">6924229081976334180193477951417117275396656434968000032228908231511246053064833236257422745299036986875244562025221130619850904830372215788197314906896784</span>,<span class="number">707045810464337488125013716300756405499020414540801863434513087687914538170573314824134496890600422837133767094273649381435979038909605432188919586751472</span>,<span class="number">561487665739111774897165274560908487232457333748910467998343202097778699925650682704996443560224288857862513676706660506594465853704042586896087391214886</span>,<span class="number">6498834369085375452441121562339384727357898216850540864190840194924515286757125433756518026123451611578553656133012172518080309106483207567929943790044792</span>,<span class="number">5508345401684913940610183958526398635406187349043368834080838153611810896629693027245511688366776749176652858929409374912959736262162942801190344337268446</span>,<span class="number">7604410082265211154108357446507297790451766698177313130672954202813796888988719242951127448112228332967892794819415211618572734294964346056056171483002307</span>,<span class="number">7699815879242527638422887386550759485127768822609011364311314299885418068889791030639324882736871756700299169635780542149704586720216395186814592666988591</span>,<span class="number">829748131720382599696653359722612708514830904084605048590882951300049701148883021283243506081300427041733299385325284399270633917941134488957784480285437</span>,<span class="number">7084115400374950827522650500486495223539292992998875483730758098005030106055310282589342193536381973309924074043955222228738842206417828828756951777504457</span>,<span class="number">7482796067314266426215648326036921955183807741134787613584977300821023398375789725848056657250086288687570875979072368004217788222537115232191230702833854</span>]</span><br><span class="line">c2 = [<span class="number">12573984103581521249597169818949825744876735847170990673204303602848066091917704946653820386665801380026230957120354174481948164514637637956459534723582285</span>, <span class="number">6441954407109995413858792101472089558106780628459991101662507565699664222341697230094798036088532393057448200220905589679548875702178737462785403325555226</span>, <span class="number">11684244745641367106386196774447204674089853123966422387024948921795099192025069760680924547214190425118261001002764397184950251157744938735586522727499550</span>, <span class="number">10396243416373326695473843427139385116708652845789644861965876346553795313454773668473030130335970707089781482749749170266279229263892370064669233541305377</span>, <span class="number">9090748241360606371310281608818966855338110969397659720953951845805983771894064629343960530245792700858927510839835850767728294266738917884471006979663157</span>, <span class="number">11489848045104749332790333272128633885019156159805805159750174723808043569789257625027794186359921080743368220606914862583644262009648261345452266067697628</span>, <span class="number">649349258009900424806913260265314442160901414078390702088746248078789581041616487825633046538335114117254875547413590064940767523651802950986197978665018</span>, <span class="number">6302136940345077947382276151657194124073457559487274425879887978386901058162385833414602346299055653879087077862824771863209271498552774720708307840705334</span>, <span class="number">5844526398244645236473089500608731415060125566027525405618000580381149761653744142808567706048834618328671311836990498943019718294135733114642775270792763</span>, <span class="number">4834548043993868659061606699822957422840040425976833628462093089330507589865407793951971491111695171201542345470702059513427268037868859282999222070054388</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################# lcg1</span></span><br><span class="line">PR.&lt;a,b,x0&gt; = PolynomialRing(ZZ)</span><br><span class="line">F = [a*x0 - c1[<span class="number">0</span>]]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    f = a*c1[i] + b*(x0+<span class="built_in">sum</span>(c1[:i])) - c1[i+<span class="number">1</span>]</span><br><span class="line">    F.append(f)</span><br><span class="line">res = Ideal(F).groebner_basis()</span><br><span class="line">p = ZZ(res[<span class="number">3</span>].univariate_polynomial()(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################# lcg2</span></span><br><span class="line">PR.&lt;A,B,gx&gt; = PolynomialRing(ZZ)</span><br><span class="line">F = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>-<span class="number">1</span>):</span><br><span class="line">    f = (gx-c2[i])^<span class="number">2</span>*(c2[i-<span class="number">1</span>]+c2[i+<span class="number">1</span>]) - <span class="number">2</span>*(gx^<span class="number">3</span>+A*gx+B+c2[i]^<span class="number">3</span>+A*c2[i]+B) + <span class="number">2</span>*(gx+c2[i])*(gx-c2[i])^<span class="number">2</span></span><br><span class="line">    F.append(f)</span><br><span class="line">res = Ideal(F).groebner_basis()</span><br><span class="line">q = ZZ(res[<span class="number">3</span>].univariate_polynomial()(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################# decrypt</span></span><br><span class="line">r = n // p // q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,phi)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;71fc0bc1-167a-43f0-ab0f-e0df3bea8ed3&#125;</span></span><br></pre></td></tr></table></figure>
<p>不过关于这个问题其实有一篇论文：</p>
<p><a target="_blank" rel="noopener" href="http://compalg.inf.elte.hu/~merai/pub/merai_predictingEC-LCG.pdf">merai_predictingEC-LCG.pdf (elte.hu)</a></p>
<p>而论文中提到最少可以只给七组数据，但是我这个方法实际测试下来必须全部用上才行。而论文的具体实现在Theorem 1中，其构造了一个5x6的矩阵，并且说明其前四列的列向量线性无关后，证明了一个由前四列列向量以及一个u向量构成的矩阵，其行列式是p的倍数，因此可以与n求gcd得到p。</p>
<p><br></p>
<p><br></p>
<h3 id="easy-ecc"><a href="#easy-ecc" class="headerlink" title="easy_ecc"></a>easy_ecc</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">easy!!!</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, secret,SECRET</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag[<span class="number">6</span>:-<span class="number">1</span>] == sha256(long_to_bytes(secret)).hexdigest().encode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECC_easy</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.a = <span class="number">1365855822212045061018261334821659180641576788523935479</span></span><br><span class="line">        self.b = <span class="number">17329427219955161804703200105884322768704934833367341</span></span><br><span class="line">        self.p = <span class="number">1365855822212045061018261334821659180641576788523935481</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, P, Q</span>):</span><br><span class="line">        mul_inv = <span class="keyword">lambda</span> x: <span class="built_in">pow</span>(x, -<span class="number">1</span>, self.p)</span><br><span class="line">        x1, y1 = P</span><br><span class="line">        x2, y2 = Q</span><br><span class="line">        <span class="keyword">if</span> P!=Q:</span><br><span class="line">            l=(y2-y1)*inverse(x2-x1,self.p)%self.p</span><br><span class="line">        <span class="keyword">else</span>:l=(<span class="number">3</span>*x1**<span class="number">2</span>+<span class="number">2</span>*self.a*x1+<span class="number">1</span>)*inverse(<span class="number">2</span>*self.b*y1,self.p)%self.p</span><br><span class="line">        temp1 = (self.b*l**<span class="number">2</span>-self.a-x1-x2)%self.p</span><br><span class="line">        temp2 = ((<span class="number">2</span>*x1+x2+self.a)*l-self.b*l**<span class="number">3</span>-y1)%self.p</span><br><span class="line">        x3 = temp1</span><br><span class="line">        y3 = temp2</span><br><span class="line">        <span class="keyword">return</span> x3, y3</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self, x, P</span>):</span><br><span class="line">        Q = SECRET</span><br><span class="line">        x = x % self.p</span><br><span class="line">        <span class="keyword">while</span> x &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> x &amp; <span class="number">1</span>:</span><br><span class="line">                Q = self.add(Q, P)</span><br><span class="line">            P = self.add(P, P)</span><br><span class="line">            x &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ispoint</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="keyword">return</span> (self.a * x ** <span class="number">2</span> + x ** <span class="number">3</span>+x) % self.p == (self.b * y ** <span class="number">2</span>) % self.p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ecc = ECC_easy()</span><br><span class="line">LLLL = (<span class="number">1060114032187482137663886206406014543797784561116139791</span>,<span class="number">752764811411303365258802649951280929945966659818544966</span>)</span><br><span class="line"><span class="keyword">assert</span> ecc.ispoint(LLLL[<span class="number">0</span>], LLLL[<span class="number">1</span>])</span><br><span class="line">END = ecc.mul(secret, LLLL)</span><br><span class="line"><span class="built_in">print</span>(END)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (695174082657148306737473938393010922439779304870471540,414626357054958506867453055549756701310099524292082869)</span></span><br></pre></td></tr></table></figure>
<p>题目基于一条曲线上的dlp，由ispoint函数可以看出曲线符合下面的方程：</p>
<script type="math/tex; mode=display">
By^2 = x^3 + Ax^2 + x \quad(mod\;p)</script><p>这是一条蒙哥马利曲线，其向Weierstrass形式曲线上的映射方式可以在之前写过的这篇文章里找到：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/187210a7.html">Crypto趣题-曲线 | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>由于参数都给定了，所以很轻松就能得到Weierstrass形式曲线的参数，然而在sage内建立椭圆曲线方程时会产生singular的报错，说明这是一条奇异曲线。简单分解一下曲线方程可以发现它是node形式的singular curve：</p>
<script type="math/tex; mode=display">
y^2 = (x - \alpha)^2(x - \beta)</script><blockquote>
<p>对于singular curve来说，其分两种情况cusp和node，其中cusp指椭圆曲线方程有三重根，而node指有两重根。也就是说他们的方程分别可以写成如下形式：</p>
<script type="math/tex; mode=display">
y^2 = x^3</script><script type="math/tex; mode=display">
y^2 = (x - \alpha)^2(x - \beta)</script></blockquote>
<p>而两种形式的singular curve都存在不同方式的向数域上的映射，对于node而言是：</p>
<script type="math/tex; mode=display">
E \rightarrow F_p :(x,y) \rightarrow \frac{y + \sqrt{\alpha - \beta}(x - \alpha)}{y - \sqrt{\alpha - \beta}(x - \alpha)}</script><p>所以可以映射到Fp下去求数域上的dlp，并且p-1是比较光滑的所以dlp易求。</p>
<blockquote>
<p>其实这里还有一个可能存在的小问题，就是$\alpha - \beta$并不一定是模p下的二次剩余，当他不是二次剩余时，这个映射其实是向Fp2的一个映射，那个时候会多出一个p+1的子群</p>
</blockquote>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line">A = <span class="number">1365855822212045061018261334821659180641576788523935479</span></span><br><span class="line">B = <span class="number">17329427219955161804703200105884322768704934833367341</span></span><br><span class="line">p = <span class="number">1365855822212045061018261334821659180641576788523935481</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 map to ECC</span></span><br><span class="line">F = GF(p)</span><br><span class="line">a = F(<span class="number">3</span>-A^<span class="number">2</span>) / F(<span class="number">3</span>*B^<span class="number">2</span>)</span><br><span class="line">b = F(<span class="number">2</span>*A^<span class="number">3</span>-<span class="number">9</span>*A) / F(<span class="number">27</span>*B^<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edwards_to_ECC</span>(<span class="params">x,y</span>):</span><br><span class="line">    x3 = (F(<span class="number">3</span>*x) + F(A)) / F(<span class="number">3</span>*B)</span><br><span class="line">    y3 = F(y) / F(B)</span><br><span class="line">    <span class="comment">#now curve is y^2 = x^3 + ax + b</span></span><br><span class="line">    <span class="keyword">return</span> (x3,y3)</span><br><span class="line"></span><br><span class="line">G = (<span class="number">1060114032187482137663886206406014543797784561116139791</span>,<span class="number">752764811411303365258802649951280929945966659818544966</span>)</span><br><span class="line">mG = (<span class="number">695174082657148306737473938393010922439779304870471540</span>,<span class="number">414626357054958506867453055549756701310099524292082869</span>)</span><br><span class="line"></span><br><span class="line">G_ecc = edwards_to_ECC(G[<span class="number">0</span>],G[<span class="number">1</span>])</span><br><span class="line">mG_ecc = edwards_to_ECC(mG[<span class="number">0</span>],mG[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 singular curve attack(map point to Fp)</span></span><br><span class="line">P.&lt;x&gt; = GF(p)[]</span><br><span class="line">f = x^<span class="number">3</span> + a*x + b</span><br><span class="line"><span class="built_in">print</span>(f.factor())</span><br><span class="line"></span><br><span class="line">alpha = -<span class="number">544257272453066077953551360625531658485543339865638914</span></span><br><span class="line">beta = -<span class="number">277341277305912905111158613570595863670490108792657653</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">map</span>(<span class="params">x, y</span>):</span><br><span class="line">    r = F(alpha - beta).sqrt()</span><br><span class="line">    t = F(r * (x - alpha))</span><br><span class="line">    <span class="keyword">return</span> F((y + t) / (y - t))</span><br><span class="line"></span><br><span class="line">mg = <span class="built_in">map</span>(mG_ecc[<span class="number">0</span>], mG_ecc[<span class="number">1</span>])</span><br><span class="line">g = <span class="built_in">map</span>(G_ecc[<span class="number">0</span>], G_ecc[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">m = discrete_log(mg,g,<span class="built_in">ord</span> = p-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;XYCTF&#123;&quot;</span> + sha256(long_to_bytes(<span class="built_in">int</span>(m))).hexdigest().encode() + <span class="string">b&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;ec9a6e17537e81b7f593f65f7e2ca5d575e6b34c504c24e4afb40c1e9dc4be0d&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="反方向的密码-相思"><a href="#反方向的密码-相思" class="headerlink" title="反方向的密码 相思"></a>反方向的密码 相思</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">长相思兮长相忆,短相思兮无穷极。你所寻找的flag到底在哪里呢？flag格式为XYCTF&#123;*&#125;</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.sha256(x.encode()).digest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">message</span>):</span><br><span class="line">    <span class="keyword">return</span> message + <span class="built_in">hash</span>(<span class="built_in">str</span>(<span class="built_in">len</span>(message)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(pad(flag))</span><br><span class="line">p = getStrongPrime(<span class="number">512</span>)</span><br><span class="line">q = getStrongPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="comment"># 120440199294949712392334113337541924034371176306546446428347114627162894108760435789068328282135879182130546564535108930827440004987170619301799710272329673259390065147556073101312748104743572369383346039000998822862286001416166288971531241789864076857299162050026949096919395896174243383291126202796610039053</span></span><br><span class="line"><span class="comment"># 143413213355903851638663645270518081058249439863120739973910994223793329606595495141951165221740599158773181585002460087410975579141155680671886930801733174300593785562287068287654547100320094291092508723488470015821072834947151827362715749438612812148855627557719115676595686347541785037035334177162406305243</span></span><br></pre></td></tr></table></figure>
<p>题目基于如下等式：</p>
<script type="math/tex; mode=display">
c = (m \;|| \; h(m_{len}))^3 \quad(mod\;n)</script><p>由于sha256长度是固定的32字节，并且flag长度应该在可以爆破的范围内，所以不妨假设我们爆破到了正确的flag长度，就有下式成立：</p>
<script type="math/tex; mode=display">
c = (256^{32}m + h)^3 \quad(mod\;n)</script><p>由于加密指数并不大，所以可以把整个式子看作是模n下的单元copper去求解m，并且由于有已知的flag头尾其实还可以进一步减小根的大小，不过不做这一步处理也可以直接跑出来，因为上界已经足够了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.sha256(x.encode()).digest()</span><br><span class="line"></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">120440199294949712392334113337541924034371176306546446428347114627162894108760435789068328282135879182130546564535108930827440004987170619301799710272329673259390065147556073101312748104743572369383346039000998822862286001416166288971531241789864076857299162050026949096919395896174243383291126202796610039053</span></span><br><span class="line">n = <span class="number">143413213355903851638663645270518081058249439863120739973910994223793329606595495141951165221740599158773181585002460087410975579141155680671886930801733174300593785562287068287654547100320094291092508723488470015821072834947151827362715749438612812148855627557719115676595686347541785037035334177162406305243</span></span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"><span class="keyword">for</span> length <span class="keyword">in</span> trange(<span class="number">20</span>,<span class="number">50</span>):</span><br><span class="line">    suffix = bytes_to_long(<span class="built_in">hash</span>(<span class="built_in">str</span>(length)))</span><br><span class="line">    f = (<span class="number">256</span>^<span class="number">32</span>*x + suffix)^<span class="number">3</span> - c</span><br><span class="line">    f = f.monic()</span><br><span class="line">    res = f.small_roots(X=<span class="number">256</span>^length,beta=<span class="number">1</span>,epsilon=<span class="number">0.05</span>)</span><br><span class="line">    <span class="keyword">if</span>(res != []):</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(res[<span class="number">0</span>])))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;!__d3ng__hu0__1@n__3h@n__Chu__!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="反方向的密码-情难"><a href="#反方向的密码-情难" class="headerlink" title="反方向的密码 情难"></a>反方向的密码 情难</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">衣带渐宽终不悔,为伊消得人憔悴。你苦苦思念的flag在ta的彼岸也会思念你吗？flag格式为XYCTF&#123;*&#125;</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.sha512(x.encode()).digest() * <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">message</span>):</span><br><span class="line">    <span class="keyword">return</span> (message[: <span class="built_in">len</span>(message) // <span class="number">2</span>] + <span class="built_in">hash</span>(<span class="built_in">str</span>(<span class="built_in">len</span>(message))) + message[<span class="built_in">len</span>(message) // <span class="number">2</span> :])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">q = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">2</span></span><br><span class="line">m = bytes_to_long(pad(flag))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="comment"># 3335299537518434350008670067273514020883265809787658909900831303201069228111667477512288715627313377374377192065531931991830331266940281529429758933125645068623703704431432931062515459304407129764836169638068667723468109909932687335727824459807903558617156661138991973933280805156893120951135488168923425258119689993859896540097318197048436676318334502053269738046279338047497258783747007084564814994803144049365117574904704816542523015746396519693505167963245600047742456478545640334467678554748227823020862550712083249012329745708139070338928730226897923885785783461594034339595106377701306570280371612953393097739</span></span><br><span class="line"><span class="comment"># 26278624299187148406559772770865336226934633734285979741424867540828670397865189685966828527168795621543490979182417570078991930822041468539855006585233692884235331084907340302530060261742100702658312435180527335101284800616106884692498603300926488358017928867672861988448488439356448543527810620591324774111321619391264173779312033252573140028630441135269056099074531502841259940379636699304810677716177080486265721322966814104627525953974143476452058638927511594884002185219080847495835727300670028011001853179659250270200020884333850083063514830095064730932997593930711871108436386821290545084229347398808220810263</span></span><br></pre></td></tr></table></figure>
<p>这是上一个题目的升级，变化如下：</p>
<ul>
<li>p、q提升到1024bit数量级，加密指数e降到2</li>
<li>pad方式变成了：</li>
</ul>
<script type="math/tex; mode=display">
pad(m) = m_1 || h(m_{len}) || h(m_{len}) || m_2</script><ul>
<li>并且其中哈希函数变成了sha512</li>
</ul>
<p>但是思路依然没有变化，把加密那一步的等式写出来：</p>
<script type="math/tex; mode=display">
c = (m_1 || h(m_{len}) || h(m_{len}) || m_2)^{2} \quad(mod\;n)</script><p>两个哈希的长度依然固定，均为64字节，所以爆破flag长度可以同时确定以下几个信息：</p>
<ul>
<li>哈希的具体值</li>
<li>m1以及哈希值的移位数量</li>
</ul>
<p>确定这两个之后就可以将m1，m2视作二元方程的小根来二元copper了。</p>
<p>同时要注意一个细节，那就是flag长度为奇数的时候，m1和m2拆分长度并不一样，这也会影响对应的移位数。此外，这题小根上界比较紧，所以推荐的做法是把已知的flag头尾给去掉，并且调大多元copper的参数。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.sha512(x.encode()).digest() * <span class="number">2</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">3335299537518434350008670067273514020883265809787658909900831303201069228111667477512288715627313377374377192065531931991830331266940281529429758933125645068623703704431432931062515459304407129764836169638068667723468109909932687335727824459807903558617156661138991973933280805156893120951135488168923425258119689993859896540097318197048436676318334502053269738046279338047497258783747007084564814994803144049365117574904704816542523015746396519693505167963245600047742456478545640334467678554748227823020862550712083249012329745708139070338928730226897923885785783461594034339595106377701306570280371612953393097739</span></span><br><span class="line">n = <span class="number">26278624299187148406559772770865336226934633734285979741424867540828670397865189685966828527168795621543490979182417570078991930822041468539855006585233692884235331084907340302530060261742100702658312435180527335101284800616106884692498603300926488358017928867672861988448488439356448543527810620591324774111321619391264173779312033252573140028630441135269056099074531502841259940379636699304810677716177080486265721322966814104627525953974143476452058638927511594884002185219080847495835727300670028011001853179659250270200020884333850083063514830095064730932997593930711871108436386821290545084229347398808220810263</span></span><br><span class="line"></span><br><span class="line">head = bytes_to_long(<span class="string">b&quot;XYCTF&#123;&quot;</span>)</span><br><span class="line">tail = bytes_to_long(<span class="string">b&quot;&#125;&quot;</span>)</span><br><span class="line">PR.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line"><span class="comment">#len = 73</span></span><br><span class="line"><span class="keyword">for</span> length <span class="keyword">in</span> trange(<span class="number">70</span>,<span class="number">100</span>):</span><br><span class="line">    suffix = bytes_to_long(<span class="built_in">hash</span>(<span class="built_in">str</span>(length)))</span><br><span class="line">    <span class="keyword">if</span>(length % <span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">        f = (<span class="number">256</span>^(<span class="number">128</span>+length//<span class="number">2</span>)*(<span class="number">256</span>^(length//<span class="number">2</span>-<span class="number">6</span>)*head + x) + <span class="number">256</span>^(length//<span class="number">2</span>)*suffix + <span class="number">256</span>*y + tail)^<span class="number">2</span> - c</span><br><span class="line">        bounds = (<span class="number">256</span>^(length//<span class="number">2</span>-<span class="number">6</span>),<span class="number">256</span>^(length//<span class="number">2</span>-<span class="number">1</span>))</span><br><span class="line">        res = small_roots(f,bounds,<span class="number">1</span>,<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">if</span>(res != []):</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        f = (<span class="number">256</span>^(<span class="number">128</span>+length//<span class="number">2</span>+<span class="number">1</span>)*(<span class="number">256</span>^(length//<span class="number">2</span>-<span class="number">6</span>)*head + x) + <span class="number">256</span>^(length//<span class="number">2</span>+<span class="number">1</span>)*suffix + <span class="number">256</span>*y + tail)^<span class="number">2</span> - c</span><br><span class="line">        bounds = (<span class="number">256</span>^(length//<span class="number">2</span>-<span class="number">6</span>),<span class="number">256</span>^(length//<span class="number">2</span>))</span><br><span class="line">        res = small_roots(f,bounds,<span class="number">1</span>,<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">if</span>(res != []):</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;jun_mai_quan_xia_ni_xiao_gu___wo_ji_ren_jian_xue_man_tou____114514&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="LCG-and-HNP"><a href="#LCG-and-HNP" class="headerlink" title="LCG_and_HNP"></a>LCG_and_HNP</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HNP练习</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed, a, b, p</span>):</span><br><span class="line">        self.seed = seed</span><br><span class="line">        self.a = a</span><br><span class="line">        self.b = b</span><br><span class="line">        self.p = p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.seed = (self.seed * self.a + self.b) % self.p</span><br><span class="line">        <span class="keyword">return</span> self.seed &gt;&gt; (self.p.bit_length() - <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line">a = random.randint(<span class="number">1</span>, p)</span><br><span class="line">b = random.randint(<span class="number">1</span>, p)</span><br><span class="line">seed = random.randint(<span class="number">1</span>, p)</span><br><span class="line">out = []</span><br><span class="line">lcg = LCG(seed, a, b, p)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    out.append(lcg.<span class="built_in">next</span>())</span><br><span class="line">key = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    key += <span class="built_in">str</span>(lcg.<span class="built_in">next</span>())</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(key) &gt;= m:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">f&quot;p=<span class="subst">&#123;p&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;a=<span class="subst">&#123;a&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;b=<span class="subst">&#123;b&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;out=<span class="subst">&#123;out&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;c=<span class="subst">&#123;<span class="built_in">int</span>(key)^m&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>题目是一个比较经典的LCG高位泄露问题。给出连续三十组LCG的泄露高位，要求还原LCG，从而获得由其后续状态拼接而成的密钥key去解得flag。</p>
<p>这类HNP解法也都比较固定，由于泄露的是高位，所以对于相邻的两组数据可以写成：</p>
<script type="math/tex; mode=display">
2^{120}x_{i+1,m} + x_{i+1,l} = a(2^{120}x_{i,m} + x_{i,l}) + b \quad(mod\;p)</script><p>移项整理一下就得到：</p>
<script type="math/tex; mode=display">
x_{i+1,l} - ax_{i,l} + (2^{120}x_{i+1,m} - a2^{120}x_{i,m}  - b) = 0 \quad(mod\;p)</script><p>展开为等式：</p>
<script type="math/tex; mode=display">
x_{i+1,l} - ax_{i,l} + (2^{120}x_{i+1,m} - a2^{120}x_{i,m}  - b) + k_ip = 0</script><p>其中$x_{i+1,l},x_{i,l}$就是我们想要规约出的两个120bit的小量。将三十组这样的等式结合起来就可以造出如下格：</p>
<script type="math/tex; mode=display">
\left(
 \begin{matrix}
1 & &&&&& -a &&&& \\
&1 &&&&&1  &-a&&& \\
& &1&&&&  &1&-a&& \\
& &&\ddots&&&  &&&\ddots& \\
& &&&1&&&&&&1 \\
& &&&&1&c_1&c_2&c_3&\cdots&c_{30} \\
&&&&&&p \\ 
&&&&&&&p \\ 
&&&&&&&&p \\ 
&&&&&&&&&\ddots \\ 
&&&&&&&&&&p \\ 
  \end{matrix}
  \right)</script><p>这个格具有线性关系：</p>
<script type="math/tex; mode=display">
(x_1,x_2,...,x_{30},1,k_1,k_2,...,k_{29})
\left(
 \begin{matrix}
1 & &&&&& -a &&&& \\
&1 &&&&&1  &-a&&& \\
& &1&&&&  &1&-a&& \\
& &&\ddots&&&  &&&\ddots& \\
& &&&1&&&&&&1 \\
& &&&&1&c_1&c_2&c_3&\cdots&c_{30} \\
&&&&&&p \\ 
&&&&&&&p \\ 
&&&&&&&&p \\ 
&&&&&&&&&\ddots \\ 
&&&&&&&&&&p \\ 
  \end{matrix}
  \right)
 =
(x_1,x_2,...,x_{30},1,0,0,...,0)</script><p>当然还有一些配系数的细节操作，由于我前面不少文章都有提到，这里就不展开了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">183640370379099520304414468793633666661</span></span><br><span class="line">a = <span class="number">36108041497607074474855679331694767924</span></span><br><span class="line">b = <span class="number">65925932211985158779695144876342622462</span></span><br><span class="line">out = [<span class="number">34</span>, <span class="number">95</span>, <span class="number">100</span>, <span class="number">114</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">17</span>, <span class="number">118</span>, <span class="number">115</span>, <span class="number">29</span>, <span class="number">73</span>, <span class="number">47</span>, <span class="number">12</span>, <span class="number">133</span>, <span class="number">78</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">73</span>, <span class="number">87</span>, <span class="number">15</span>, <span class="number">85</span>, <span class="number">47</span>, <span class="number">20</span>, <span class="number">136</span>, <span class="number">6</span>, <span class="number">106</span>, <span class="number">74</span>, <span class="number">27</span>, <span class="number">116</span>, <span class="number">8</span>]</span><br><span class="line">c = <span class="number">6003642257316152022364486167163125577018867662610595926973616937741281227891381713617380</span></span><br><span class="line"></span><br><span class="line">nums = <span class="number">30</span></span><br><span class="line">L = Matrix(ZZ,<span class="number">2</span>*nums,<span class="number">2</span>*nums)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nums-<span class="number">1</span>):</span><br><span class="line">    L[i,i] = <span class="number">1</span></span><br><span class="line">    L[i,nums+<span class="number">1</span>+i] = -a</span><br><span class="line">    L[i+<span class="number">1</span>,nums+<span class="number">1</span>+i] = <span class="number">1</span></span><br><span class="line">    L[nums,nums+<span class="number">1</span>+i] = <span class="number">2</span>^<span class="number">120</span>*out[i+<span class="number">1</span>] - <span class="number">2</span>^<span class="number">120</span>*a*out[i] - b</span><br><span class="line">    L[nums+<span class="number">1</span>+i,nums+<span class="number">1</span>+i] = p</span><br><span class="line">L[nums-<span class="number">1</span>,nums-<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">L[nums,nums] = <span class="number">2</span>^<span class="number">120</span></span><br><span class="line"></span><br><span class="line">L[:,nums+<span class="number">1</span>:] *= p</span><br><span class="line">res = L.LLL()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">x = <span class="number">2</span>^<span class="number">120</span>*out[-<span class="number">1</span>] + <span class="built_in">abs</span>(res[nums-<span class="number">1</span>])</span><br><span class="line">key = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    x = (a*x + b) % p</span><br><span class="line">    key += <span class="built_in">str</span>(x &gt;&gt; <span class="number">120</span>)</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">int</span>(key) ^^ c)</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">b&quot;XYCTF&quot;</span> <span class="keyword">in</span> flag):</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;2h1_21_ZHi_5h0u_yU_zI_xI3_l@0&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="happy-to-solve1"><a href="#happy-to-solve1" class="headerlink" title="happy_to_solve1"></a>happy_to_solve1</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">so happy</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_happy_prime</span>():</span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = sympy.nextprime(p ^ ((<span class="number">1</span> &lt;&lt; <span class="number">512</span>) - <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p, q = get_happy_prime()</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line"><span class="comment"># 24852206647750545040640868093921252282805229864862413863025873203291042799096787789288461426555716785288286492530194901130042940279109598071958012303179823645151637759103558737126271435636657767272703908384802528366090871653024192321398785017073393201385586868836278447340624427705360349350604325533927890879</span></span><br><span class="line"><span class="comment"># 14767985399473111932544176852718061186100743117407141435994374261886396781040934632110608219482140465671269958180849886097491653105939368395716596413352563005027867546585191103214650790884720729601171517615620202183534021987618146862260558624458833387692782722514796407503120297235224234298891794056695442287</span></span><br></pre></td></tr></table></figure>
<p>题目基于RSA分解，其中p、q两个素数的关系是：q是p逐位取反后再取nextprime的值。</p>
<p>这其实就自然产生了两种做法：</p>
<ul>
<li>第一种方法是：由于q可以写成：</li>
</ul>
<script type="math/tex; mode=display">
q = 2^{512} - p + t</script><ul>
<li>其中t是nextprime带来的小偏差，可以爆破得到，因此可以在ZZ上解如下方程得到p、q：</li>
</ul>
<script type="math/tex; mode=display">
p(2^{512} - p + t) = n</script><ul>
<li>第二种方法就是正常剪枝，由于p、q大部分高比特位均只有两种可能，所以从高位向低位剪枝就可以得到p、q，最后由于nextprime导致不能深搜的部分就小爆一下解决</li>
</ul>
<p>exp：</p>
<p>1：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">24852206647750545040640868093921252282805229864862413863025873203291042799096787789288461426555716785288286492530194901130042940279109598071958012303179823645151637759103558737126271435636657767272703908384802528366090871653024192321398785017073393201385586868836278447340624427705360349350604325533927890879</span></span><br><span class="line">c = <span class="number">14767985399473111932544176852718061186100743117407141435994374261886396781040934632110608219482140465671269958180849886097491653105939368395716596413352563005027867546585191103214650790884720729601171517615620202183534021987618146862260558624458833387692782722514796407503120297235224234298891794056695442287</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(ZZ)</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> trange(<span class="number">2000</span>):</span><br><span class="line">    f = x*(<span class="number">2</span>^<span class="number">512</span> - x + t) - n</span><br><span class="line">    res = f.roots()</span><br><span class="line">    <span class="keyword">if</span>(res != []):</span><br><span class="line">        p = <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">        q = n // p</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)),n)))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;3f22f4efe3bbbc71bbcc999a0a622a1a23303cdc&#125;</span></span><br></pre></td></tr></table></figure>
<p>2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">p,q,length</span>):</span><br><span class="line">    pmin = <span class="built_in">int</span>(p + (<span class="number">512</span>-length)*<span class="string">&quot;0&quot;</span> , <span class="number">2</span>)</span><br><span class="line">    pmax = <span class="built_in">int</span>(p + (<span class="number">512</span>-length)*<span class="string">&quot;1&quot;</span> , <span class="number">2</span>)</span><br><span class="line">    qmin = <span class="built_in">int</span>(q + (<span class="number">512</span>-length)*<span class="string">&quot;0&quot;</span> , <span class="number">2</span>)</span><br><span class="line">    qmax = <span class="built_in">int</span>(q + (<span class="number">512</span>-length)*<span class="string">&quot;1&quot;</span> , <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(pmin*qmin &gt; n <span class="keyword">or</span> pmax*qmax &lt; n):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(length == <span class="number">502</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">10</span>):</span><br><span class="line">            pp = <span class="built_in">int</span>(p + <span class="built_in">bin</span>(i)[<span class="number">2</span>:].zfill(<span class="number">10</span>),<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span>(n % pp == <span class="number">0</span>):</span><br><span class="line">                qq = n // pp</span><br><span class="line">                <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,inverse(e,(pp-<span class="number">1</span>)*(qq-<span class="number">1</span>)),n)))</span><br><span class="line">                exit()</span><br><span class="line">    </span><br><span class="line">    find(p+<span class="string">&quot;0&quot;</span> , q+<span class="string">&quot;1&quot;</span> , length+<span class="number">1</span>)</span><br><span class="line">    find(p+<span class="string">&quot;1&quot;</span> , q+<span class="string">&quot;0&quot;</span> , length+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">n = <span class="number">24852206647750545040640868093921252282805229864862413863025873203291042799096787789288461426555716785288286492530194901130042940279109598071958012303179823645151637759103558737126271435636657767272703908384802528366090871653024192321398785017073393201385586868836278447340624427705360349350604325533927890879</span></span><br><span class="line">c = <span class="number">14767985399473111932544176852718061186100743117407141435994374261886396781040934632110608219482140465671269958180849886097491653105939368395716596413352563005027867546585191103214650790884720729601171517615620202183534021987618146862260558624458833387692782722514796407503120297235224234298891794056695442287</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">find(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;0&quot;</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;3f22f4efe3bbbc71bbcc999a0a622a1a23303cdc&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="happy-to-solve2"><a href="#happy-to-solve2" class="headerlink" title="happy_to_solve2"></a>happy_to_solve2</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">so so happy</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_happy_prime</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        p = <span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join([random.choice(<span class="string">&quot;123&quot;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>)]))</span><br><span class="line">        q = <span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join([random.choice(<span class="string">&quot;567&quot;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>)]))</span><br><span class="line">        <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> isPrime(q):</span><br><span class="line">            <span class="keyword">return</span> (p,q)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p ,q= get_happy_prime()</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line"><span class="comment"># 697906506747097082736076931509594586899561519277373830451275402914416296858960649459482027106166486723487162428522597262774248272216088755005277069446993003521270487750989061229071167729138628583207229945902389632065500739730301375338674342457656803764567184544685006193130563116558641331897204457729877920989968662546183628637193220770495938729301979912328865798266631957128761871326655572836258178871966196973138373358029531478246243442559418904559585334351259080578222274926069834941166567112522869638854253933559832822899069320370733424453856240903784235604251466010104012061821038897933884352804297256364409157501116832788696434711523621632436970698827611375698724661553712549209133526623456888111161142213830821361143023186927163314212097199831985368310770663850851571934739809387798422381702174820982531508641022827776262236373967579266271031713520262606203067411268482553539580686495739014567368858613520107678565628269250835478345171330669316220473129104495659093134763261751546990704365966783697780787341963138501</span></span><br><span class="line"><span class="comment"># 153383826085102296581238539677668696644156148059026868813759015106139131297135097831661048493079405226972222492151356105759235749502324303047037349410709021152255315429280760639113724345836532087970918453353723090554450581657930847674930226113840172368662838756446364482977092478979838209396761279326533419699056209983721842484996150025403009644653678928025861445324715419893797015875541525590135843027312322236085581571452084477262582966972702577136904385741443870527205640874446616413917231260133364227248928492574610248881137364204914001412269740461851747883355414968499272944590071623223603501698004227753335552646715567802825755799597955409228004284739743749531270833084850113574712041224896044525292591264637452797151098802604186311724597450780520140413704697374209653369969451501627583467893160412780732575085846467289134920886789952338174193202234175299652687560232593212131693456966318670843605238958724126368185289703563591477049105538528244632434869965333722691837462591128379816582723367039674028619947057144546</span></span><br></pre></td></tr></table></figure>
<p>这个题目就是个更经典的深搜了，只是把情景从二进制移到了十进制，具体深搜策略为：</p>
<ul>
<li>从高位往低位逐位深搜</li>
<li>将p未深搜到的位置全部填1与将q未深搜到的位置全部填5，乘积应不大于n</li>
<li>将p未深搜到的位置全部填3与将q未深搜到的位置全部填7，乘积应不小于n</li>
</ul>
<p>从而找到n的分解。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">697906506747097082736076931509594586899561519277373830451275402914416296858960649459482027106166486723487162428522597262774248272216088755005277069446993003521270487750989061229071167729138628583207229945902389632065500739730301375338674342457656803764567184544685006193130563116558641331897204457729877920989968662546183628637193220770495938729301979912328865798266631957128761871326655572836258178871966196973138373358029531478246243442559418904559585334351259080578222274926069834941166567112522869638854253933559832822899069320370733424453856240903784235604251466010104012061821038897933884352804297256364409157501116832788696434711523621632436970698827611375698724661553712549209133526623456888111161142213830821361143023186927163314212097199831985368310770663850851571934739809387798422381702174820982531508641022827776262236373967579266271031713520262606203067411268482553539580686495739014567368858613520107678565628269250835478345171330669316220473129104495659093134763261751546990704365966783697780787341963138501</span></span><br><span class="line">c = <span class="number">153383826085102296581238539677668696644156148059026868813759015106139131297135097831661048493079405226972222492151356105759235749502324303047037349410709021152255315429280760639113724345836532087970918453353723090554450581657930847674930226113840172368662838756446364482977092478979838209396761279326533419699056209983721842484996150025403009644653678928025861445324715419893797015875541525590135843027312322236085581571452084477262582966972702577136904385741443870527205640874446616413917231260133364227248928492574610248881137364204914001412269740461851747883355414968499272944590071623223603501698004227753335552646715567802825755799597955409228004284739743749531270833084850113574712041224896044525292591264637452797151098802604186311724597450780520140413704697374209653369969451501627583467893160412780732575085846467289134920886789952338174193202234175299652687560232593212131693456966318670843605238958724126368185289703563591477049105538528244632434869965333722691837462591128379816582723367039674028619947057144546</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">ph,qh</span>):</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(ph) == <span class="number">512</span>):</span><br><span class="line">        p = <span class="built_in">int</span>(ph)</span><br><span class="line">        q = n // p</span><br><span class="line">        <span class="keyword">if</span>(p*q == n):</span><br><span class="line">            d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line">            exit()</span><br><span class="line">    </span><br><span class="line">    pmin = <span class="built_in">int</span>(ph + (<span class="number">512</span>-<span class="built_in">len</span>(ph))*<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    qmin = <span class="built_in">int</span>(qh + (<span class="number">512</span>-<span class="built_in">len</span>(qh))*<span class="string">&quot;5&quot;</span>)</span><br><span class="line">    pmax = <span class="built_in">int</span>(ph + (<span class="number">512</span>-<span class="built_in">len</span>(ph))*<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    qmax = <span class="built_in">int</span>(qh + (<span class="number">512</span>-<span class="built_in">len</span>(qh))*<span class="string">&quot;7&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(pmin*qmin &lt;= n <span class="keyword">and</span> pmax*qmax &gt;=n):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> (<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> (<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;7&quot;</span>):</span><br><span class="line">                find(ph+i,qh+j)</span><br><span class="line"></span><br><span class="line">find(<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;7f4b2241951976ce5ef6df44503209059997e5085d1bc21f6bef4d9effb29fd0&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="happy-to-solve3"><a href="#happy-to-solve3" class="headerlink" title="happy_to_solve3"></a>happy_to_solve3</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">so so so happy</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">n = <span class="number">1024</span></span><br><span class="line">rho = <span class="number">2</span></span><br><span class="line">gamma = <span class="number">0.352</span></span><br><span class="line">delta = (<span class="number">1</span> - gamma) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_happy_prime</span>():</span><br><span class="line">    p = getPrime(n // <span class="number">2</span>)</span><br><span class="line">    q = getPrime(n // <span class="number">2</span>)</span><br><span class="line">    N = p * q</span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * q - p &gt; gmpy2.iroot(N, <span class="number">3</span>)[<span class="number">0</span>] <span class="keyword">and</span> <span class="number">2</span> * q - p &lt; <span class="built_in">int</span>(N**gamma / <span class="number">16</span>):</span><br><span class="line">        d = random.randint(<span class="built_in">int</span>(N ** (delta - <span class="number">0.001</span>)), <span class="built_in">int</span>(N**delta))</span><br><span class="line">        e = gmpy2.invert(d, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> N, e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">N, e = get_happy_prime()</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"><span class="built_in">print</span>(N)</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, N))</span><br><span class="line"><span class="comment"># 262520792590557046276663232446026434827811478251833823563978322470880473096166170973396967071440576532100045206129176936699321058518888771220060450723297988984995658582283884954240129867538637146924315603797818982078845855992582229939200744016516540207525916858674450616913948112117516831530578235916528257187</span></span><br><span class="line"><span class="comment"># 202935305174706906986376186864051444100197589482194720650385604617995167023220940138899902073948844285283834058445151666398192104922822110762965750590312021079147170573038600118139119881722125346545331027913695559130179278058419339157557267195396326664433859683010193688491694572425231599139974726246205888139</span></span><br><span class="line"><span class="comment"># 66173406204647583141174847814283540389326401056490970592017577810775087017197392456634167609680060931553017712058528056769618111925816921272571306246667527546366331057781905353553621522209713637253380859235235590286779517552635935384231694255450099095196595516174794966487058693308544109311774074970769293357</span></span><br></pre></td></tr></table></figure>
<p>题目基于RSA分解，其参数特殊性在于：</p>
<ul>
<li>p和2q的差距是个350bit左右的小量</li>
<li>d仅有333bit左右，达到了N^0.324</li>
</ul>
<p>所以应该是要完成诸如boneh and durfee之类的低解密指数攻击，但是d并不在0.292的理论上界之内，因此要想办法利用上第一个条件。</p>
<p>而第一个条件给我们的信息其实是：</p>
<script type="math/tex; mode=display">
2q - p = t</script><p>所以有：</p>
<script type="math/tex; mode=display">
(2q-t)q = n</script><p>由于t是一个350bit左右的小量，所以对n/2开根，得到的高位也就是q的高位，有了q的高位也就有了p的高位，所以就可以把已知的高位信息加入到boneh的攻击中去求根。具体怎么实施可以看下面这篇文章的Insights一题：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/a6ee3e0e.html">2023-CryptoCTF-wp-crypto | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting debug to true will display more informations</span></span><br><span class="line"><span class="string">about the lattice, the bounds, the vectors...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">debug = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting strict to true will stop the algorithm (and</span></span><br><span class="line"><span class="string">return (-1, -1)) if we don&#x27;t have a correct </span></span><br><span class="line"><span class="string">upperbound on the determinant. Note that this </span></span><br><span class="line"><span class="string">doesn&#x27;t necesseraly mean that no solutions </span></span><br><span class="line"><span class="string">will be found since the theoretical upperbound is</span></span><br><span class="line"><span class="string">usualy far away from actual results. That is why</span></span><br><span class="line"><span class="string">you should probably use `strict = False`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">This is experimental, but has provided remarkable results</span></span><br><span class="line"><span class="string">so far. It tries to reduce the lattice as much as it can</span></span><br><span class="line"><span class="string">while keeping its efficiency. I see no reason not to use</span></span><br><span class="line"><span class="string">this option, but if things don&#x27;t work, you should try</span></span><br><span class="line"><span class="string">disabling it</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># stop removing if lattice reaches that dimension</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Functions</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display stats on helpful vectors</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>:</span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="built_in">print</span> (a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tries to remove unhelpful vectors</span></span><br><span class="line"><span class="comment"># we start at current = n-1 (last vector)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line">    <span class="comment"># end of our recursive function</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we start by checking from the end</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment"># if it is unhelpful:</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">            <span class="comment"># let&#x27;s check if it affects other vectors</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># if another vector is affected:</span></span><br><span class="line">                <span class="comment"># we increase the count</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:0</span></span><br><span class="line">            <span class="comment"># if no other vectors end up affected</span></span><br><span class="line">            <span class="comment"># we remove it</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;* removing unhelpful vector&quot;</span>, ii)</span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:1</span></span><br><span class="line">            <span class="comment"># if just one was affected we check</span></span><br><span class="line">            <span class="comment"># if it is affecting someone else</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># if it is affecting even one vector</span></span><br><span class="line">                    <span class="comment"># we give up on this one</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># remove both it if no other vector was affected and</span></span><br><span class="line">                <span class="comment"># this helpful vector is not helpful enough</span></span><br><span class="line">                <span class="comment"># compared to our unhelpful one</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;* removing unhelpful vectors&quot;</span>, ii, <span class="string">&quot;and&quot;</span>, affected_vector_index)</span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1,-1 if `strict=true`, and determinant doesn&#x27;t bound</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string">    * d &lt; N^delta</span></span><br><span class="line"><span class="string">    * |x| &lt; e^delta</span></span><br><span class="line"><span class="string">    * |y| &lt; e^0.5</span></span><br><span class="line"><span class="string">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts list of monomials</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts (selected by Herrman and May)</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts list of monomials</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Prototype to reduce the lattice</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment"># automatically remove</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># reset dimension</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if vectors are helpful</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># check if determinant is correctly bounded</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;looking for independent vectors in the lattice&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line">            <span class="comment"># for i and j, create the two polynomials</span></span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># resultant</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># are these good polynomials?</span></span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nbit = <span class="number">1024</span></span><br><span class="line">n = <span class="number">262520792590557046276663232446026434827811478251833823563978322470880473096166170973396967071440576532100045206129176936699321058518888771220060450723297988984995658582283884954240129867538637146924315603797818982078845855992582229939200744016516540207525916858674450616913948112117516831530578235916528257187</span></span><br><span class="line">e = <span class="number">202935305174706906986376186864051444100197589482194720650385604617995167023220940138899902073948844285283834058445151666398192104922822110762965750590312021079147170573038600118139119881722125346545331027913695559130179278058419339157557267195396326664433859683010193688491694572425231599139974726246205888139</span></span><br><span class="line">c = <span class="number">66173406204647583141174847814283540389326401056490970592017577810775087017197392456634167609680060931553017712058528056769618111925816921272571306246667527546366331057781905353553621522209713637253380859235235590286779517552635935384231694255450099095196595516174794966487058693308544109311774074970769293357</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">qh = <span class="built_in">int</span>(gmpy2.iroot(n//<span class="number">2</span>,<span class="number">2</span>)[<span class="number">0</span>] &gt;&gt; <span class="number">360</span> &lt;&lt; <span class="number">360</span>)</span><br><span class="line">ph = (n // qh) &gt;&gt; <span class="number">360</span> &lt;&lt; <span class="number">360</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 boneh and durfee to get d</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">1</span>):</span><br><span class="line">    m = <span class="number">3</span></span><br><span class="line">    delta = <span class="number">0.33</span></span><br><span class="line">    t = <span class="built_in">int</span>((<span class="number">1</span>-<span class="number">2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">    X = <span class="number">2</span>*floor(n^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">    Y = <span class="number">2</span>^<span class="number">360</span>   <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line"></span><br><span class="line">    A = (n+<span class="number">1</span>)//<span class="number">2</span> - (ph+qh)//<span class="number">2</span></span><br><span class="line">    PR.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    f = <span class="number">1</span>+x*(A+y)</span><br><span class="line">    res = boneh_durfee(f, e, m, t, X, Y)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get d</span></span><br><span class="line">res = (<span class="number">11905625603785812461702294975756895543980946484478574101835243414442286593759448613358049647316155274</span>, <span class="number">152665725363549086276160040606397627101715395584023352342706962320368673856094243978666140464721353176202314</span>)</span><br><span class="line">k2 = <span class="number">11905625603785812461702294975756895543980946484478574101835243414442286593759448613358049647316155274</span></span><br><span class="line">pl_ql = <span class="number">152665725363549086276160040606397627101715395584023352342706962320368673856094243978666140464721353176202314</span></span><br><span class="line">d = (<span class="number">1</span>+k2*(A+pl_ql)) // e</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(<span class="built_in">bin</span>(d)))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;68f1880cdafd99fbf9a156946cb39dd86477886f1d115636e149e12c16f99af0&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="重生之我要当oi爷-pro"><a href="#重生之我要当oi爷-pro" class="headerlink" title="重生之我要当oi爷 pro"></a>重生之我要当oi爷 pro</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">算法什么的很简单啦</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">a, b, p</span>):</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)):</span><br><span class="line">        t += <span class="built_in">pow</span>(a, i, p) * b[i] % p</span><br><span class="line">    <span class="keyword">return</span> t % p</span><br><span class="line"></span><br><span class="line">p = <span class="number">1041231053</span></span><br><span class="line"></span><br><span class="line">a = <span class="built_in">open</span>(<span class="string">&quot;flag.png&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">b = <span class="built_in">open</span>(<span class="string">&quot;enc.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    b.write(<span class="built_in">str</span>(i) + <span class="built_in">str</span>(f(i, a, p)) + <span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>题目是今年picoCTF的原题flag_printer，是基于普通拉格朗日插值的优化，由于有一百多万个点对所以直接插值会相当慢，必须要用分治法去减小复杂度。</p>
<p>算法具体原理我并没有仔细去研究，可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://oi-wiki.org/math/poly/multipoint-eval-interpolation/">多项式多点求值|快速插值 - OI Wiki (oi-wiki.org)</a></p>
<p>由于是原题所以找个exp就能直接跑了，我直接用的普通速度的脚本，sage9.3大约跑了3h左右，听说用原repository的fast脚本只需要十分钟。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing <span class="keyword">as</span> mp</span><br><span class="line"></span><br><span class="line">p = <span class="number">1041231053</span></span><br><span class="line"></span><br><span class="line">X = []</span><br><span class="line">Y = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">r&#x27;D:\CTF_challs\py\crypto\2024\XYCTF 2024\encoded.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read().strip().split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">    x, y = line.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    X.append(<span class="built_in">int</span>(x))</span><br><span class="line">    Y.append(<span class="built_in">int</span>(y))</span><br><span class="line"></span><br><span class="line">K = GF(p)</span><br><span class="line">R = PolynomialRing(K, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compZ</span>(<span class="params">X</span>):</span><br><span class="line">    x = R.gen()</span><br><span class="line">    Z = K(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> xk <span class="keyword">in</span> X:</span><br><span class="line">        Z *= (x-xk)</span><br><span class="line">    <span class="keyword">return</span> Z</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">comp</span>(<span class="params">X, Y, Xother</span>):</span><br><span class="line">    Z = compZ(Xother)</span><br><span class="line">    Y = [y/Z(x) <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(X, Y)]</span><br><span class="line">    <span class="keyword">return</span> Y, Z</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">X, Y</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(Y)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Solving for&quot;</span>, n, <span class="string">&quot;points...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># just use lagrange interpolation if the degree is small enough</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">return</span> R.lagrange_polynomial(<span class="built_in">list</span>(<span class="built_in">zip</span>(X, Y)))</span><br><span class="line"></span><br><span class="line">    nhalf = n // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    X1 = X[:nhalf]</span><br><span class="line">    Y1 = Y[:nhalf]</span><br><span class="line">    X2 = X[nhalf:]</span><br><span class="line">    Y2 = Y[nhalf:]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># parallelize the computation of the two halves</span></span><br><span class="line">    <span class="keyword">if</span> nhalf &gt; <span class="number">10000</span>:</span><br><span class="line">        <span class="keyword">with</span> mp.Pool(<span class="number">2</span>) <span class="keyword">as</span> pool:</span><br><span class="line">            result1 = pool.apply_async(comp, (X1, Y1, X2))</span><br><span class="line">            result2 = pool.apply_async(comp, (X2, Y2, X1))</span><br><span class="line"></span><br><span class="line">            Y1, Z2 = result1.get()</span><br><span class="line">            Y2, Z1 = result2.get()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        Y1, Z2 = comp(X1, Y1, X2)</span><br><span class="line">        Y2, Z1 = comp(X2, Y2, X1)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solve recursively</span></span><br><span class="line">    f1 = solve(X1, Y1)</span><br><span class="line">    f2 = solve(X2, Y2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># put it back together</span></span><br><span class="line">    <span class="keyword">return</span> f1*Z2 + f2*Z1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    Xt = X[:<span class="number">1000</span>]</span><br><span class="line">    Yt = Y[:<span class="number">1000</span>]</span><br><span class="line">    f = solve(Xt, Yt)</span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(Xt, Yt):</span><br><span class="line">        <span class="keyword">assert</span> f(x) == y</span><br><span class="line"></span><br><span class="line">test()</span><br><span class="line"></span><br><span class="line">f = solve(X, Y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;111.bmp&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> tt:</span><br><span class="line">    tt.write(<span class="built_in">bytearray</span>(f.coefficients(sparse=<span class="literal">False</span>)[:-<span class="number">1</span>]))</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Random-rr"><a href="#Random-rr" class="headerlink" title="Random_rr"></a>Random_rr</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">你们最爱的随机数</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">flag=<span class="string">b&#x27;XYCTF&#123;uuid&#125;&#x27;</span></span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line">n = <span class="number">472993274721871037103726599805149366727531552333249750035977291933239067588481589544777397613192273114354221827196579379954069925604091911249655707080927769808587176515295614018992848517984372306879552247519117116110554431341268358177159108949791969262793325836353834899335531293329721598226413212541536002401507477776699642647348576111445702197483449777741566350285229621935507081895389023444249054515395783080003733803406382744631528246608154546123270319561514117323480441428953306734274538511770278887429407127143049023747710881993279361892937905382946820141513009017756811296722630617325141162244806884220212939955235410280899112731530527048274396186038160728562551536558223235783656985493518204710943916486379681906506757757594165379493317173050550893487151879681122510523721157284728808336110950008840684602353984682117748018347433177541603140491131603068512706893984834735290809952944273565203183330739252949245209529232254867201402656024997949207918675051941911990640248052951780195402390132237903538546705181463959793972284823588987652138458328270662652334799233015314673544813649692428544375538627858921763941533600553536579901589575693816746953261108022490849251974419402753031545629158199093099096735356165044275617408697</span></span><br><span class="line">rr = <span class="number">11898141078345200236264081467585899457224809417108457314508072413792599039332439547789237898270544336909458761754683941320649771736625000667170176071314483</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate</span>():</span><br><span class="line">    fw = <span class="built_in">open</span>(<span class="string">&quot;random&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">648</span>):</span><br><span class="line">        fw.write(<span class="built_in">str</span>(random.getrandbits(<span class="number">32</span>))+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    fw.close()</span><br><span class="line">generate()</span><br><span class="line">key = <span class="built_in">str</span>(random.getrandbits(<span class="number">32</span>))</span><br><span class="line">key1= <span class="built_in">int</span>(<span class="built_in">str</span>(key)[<span class="number">0</span>])</span><br><span class="line">ks = [randint(<span class="number">0</span>, rr**(i+key1-<span class="number">1</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">c1 = <span class="built_in">pow</span>(<span class="built_in">sum</span>(k*flag**i <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(ks)), <span class="number">127</span>, n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(flag, <span class="number">65537</span>, n)</span><br><span class="line">ks = [<span class="built_in">pow</span>(<span class="number">69</span>, k+key, rr**(i+key1)) <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(ks)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ks = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c1 = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c2 = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>这个题目交给队友去完成了，在完成第一步MT19937的伪随机数预测之后，剩下的部分和bi0sCTF的rr一题完全相同，可以参考：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/d4b677a0.html">2024-bi0sCTF-wp-crypto | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p><br></p>
<p><br></p>
<h3 id="Complex-dlp"><a href="#Complex-dlp" class="headerlink" title="Complex_dlp"></a>Complex_dlp</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">复数域下的dlp</span><br><span class="line"></span><br><span class="line">hint：如何把复数转成实数</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, re, im</span>):</span><br><span class="line">        self.re = re</span><br><span class="line">        self.im = im</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, c</span>):</span><br><span class="line">        re_ = self.re * c.re - self.im * c.im</span><br><span class="line">        im_ = self.re * c.im + self.im * c.re</span><br><span class="line">        <span class="keyword">return</span> Complex(re_, im_)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.im == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(self.re)</span><br><span class="line">        <span class="keyword">elif</span> self.re == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(self.im) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;-&#x27;</span> <span class="keyword">if</span> self.im &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>i&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.im&#125;</span>i&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.re&#125;</span> <span class="subst">&#123;<span class="string">&#x27;+&#x27;</span> <span class="keyword">if</span> self.im &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;-&#x27;</span>&#125;</span> <span class="subst">&#123;<span class="built_in">abs</span>(self.im)&#125;</span>i&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complex_pow</span>(<span class="params">c, exp, n</span>):</span><br><span class="line">    result = Complex(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = result * c</span><br><span class="line">            result.re = result.re % n</span><br><span class="line">            result.im = result.im % n</span><br><span class="line">        c = c * c</span><br><span class="line">        c.re = c.re % n</span><br><span class="line">        c.im = c.im % n</span><br><span class="line">        exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = flag.strip(<span class="string">b&quot;XYCTF&#123;&quot;</span>).strip(<span class="string">b&quot;&#125;&quot;</span>)</span><br><span class="line">p = <span class="number">1127236854942215744482170859284245684922507818478439319428888584898927520579579027</span></span><br><span class="line">g = Complex(<span class="number">3</span>, <span class="number">7</span>)</span><br><span class="line">x = bytes_to_long(flag)</span><br><span class="line"><span class="built_in">print</span>(complex_pow(g, x, p))</span><br><span class="line"><span class="comment"># 5699996596230726507553778181714315375600519769517892864468100565238657988087817 + 198037503897625840198829901785272602849546728822078622977599179234202360717671908i</span></span><br></pre></td></tr></table></figure>
<p>这个题目我先按照hint对应的思路讲，因为我的做法相比较起来不容易理解一些。</p>
<h4 id="hint解法"><a href="#hint解法" class="headerlink" title="hint解法"></a>hint解法</h4><p>hint指出想办法把复数转化到实数上，其实这个意思和矩阵利用行列式转化到实数上很像。比如对于复数c，由于有：</p>
<script type="math/tex; mode=display">
c = a + bi</script><p>其模长为：</p>
<script type="math/tex; mode=display">
|c| = \sqrt{a^2 + b^2}</script><p>而对于c的平方来说：</p>
<script type="math/tex; mode=display">
c^2 = (a^2 - b^2) + 2abi</script><p>所以其模长为：</p>
<script type="math/tex; mode=display">
|c^2| = \sqrt{(a^2 - b^2)^2 + 4a^2b^2} = a^2 + b^2</script><p>可以看出对于复数来说，将其做平方，其模长也会对应做平方；推而广之，复数的n次幂的模长也就是复数模长的n次幂。所以这样一来就可以把复数域的dlp转化到GF(p)上求解了，由于p-1很光滑所以dlp易求。</p>
<p>实际处理可能会遇到一个问题，就是模长的根号内部可能并不是二次剩余，但是处理方式也很简单，把模长的dlp再转化为模长平方的dlp即可。</p>
<p><br></p>
<h4 id="我的思路"><a href="#我的思路" class="headerlink" title="我的思路"></a>我的思路</h4><p>我的做法和抽象代数关系大一些，由于题目p模4余3，因此x^2+1是个不可约多项式，所以模p下的复数域其实可以看做是由该多项式作为双边理想构成的GF(p)的二次扩域：</p>
<script type="math/tex; mode=display">
C = \frac{Z_p[x]}{x^2 + 1}</script><p>这个扩域的大小是p^2，其乘法群是一个大小为p^2-1的循环群(去掉零元)，所以分别有大小为p-1、p+1的子群，由于p-1光滑所以可以直接在该子群求解dlp。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">1127236854942215744482170859284245684922507818478439319428888584898927520579579027</span></span><br><span class="line">F.&lt;i&gt; = GF(p^<span class="number">2</span>, modulus = x^<span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">g = F(<span class="number">3</span> + <span class="number">7</span>*i)</span><br><span class="line">c = F(<span class="number">5699996596230726507553778181714315375600519769517892864468100565238657988087817</span> + <span class="number">198037503897625840198829901785272602849546728822078622977599179234202360717671908</span>*i)</span><br><span class="line"></span><br><span class="line">m = discrete_log(F(c^(p+<span class="number">1</span>)) , F(g^(p+<span class="number">1</span>)) , operation=<span class="string">&quot;*&quot;</span> , <span class="built_in">ord</span>=p-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;___c0mp13x_d1p_15_3@5y_f0r_y0u___&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Sign1n-签到"><a href="#Sign1n-签到" class="headerlink" title="Sign1n[签到]"></a>Sign1n[签到]</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">看看密码签到题吧 :D</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">flag=<span class="string">b&#x27;XYCTF&#123;uuid&#125;&#x27;</span></span><br><span class="line">flag=bytes_to_long(flag)</span><br><span class="line">leak=<span class="built_in">bin</span>(<span class="built_in">int</span>(flag))</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    leak += <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(leak) == <span class="number">514</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">swap_bits</span>(<span class="params">input_str</span>):</span><br><span class="line">    input_list = <span class="built_in">list</span>(input_str[<span class="number">2</span>:])</span><br><span class="line">    length = <span class="built_in">len</span>(input_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length // <span class="number">2</span>):</span><br><span class="line">        temp = input_list[i]</span><br><span class="line">        input_list[i] = input_list[length - <span class="number">1</span> - i]</span><br><span class="line">        input_list[length - <span class="number">1</span> - i] = temp</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(input_list)</span><br><span class="line"></span><br><span class="line">input_str = leak</span><br><span class="line">result = swap_bits(input_str)</span><br><span class="line">a=result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_add</span>(<span class="params">input_str</span>):</span><br><span class="line">    input_list = <span class="built_in">list</span>(input_str)</span><br><span class="line">    length = <span class="built_in">len</span>(input_list)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        input_list[i] = <span class="built_in">str</span>((<span class="built_in">int</span>(input_list[i]) + i + <span class="number">1</span>) % <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span>.join(input_list)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input_str = a</span><br><span class="line">result = custom_add(input_str)</span><br><span class="line">b=result</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="comment">#12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567891134567799012455779902334677900124556899012356679001344567990233457780113445788911245667991134457799122355788001245578890223467799013445688902335578800123457889113346778902344567991223557880013355689911245667900124556789122355788001234678891133467799023445679902334568900123556899012456679001344578801233467789112355779912234577990233556780113</span></span><br></pre></td></tr></table></figure>
<p>把代码理完就可以知道直接回推就可以得到初始值。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">b = <span class="number">12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567891134567799012455779902334677900124556899012356679001344567990233457780113445788911245667991134457799122355788001245578890223467799013445688902335578800123457889113346778902344567991223557880013355689911245667900124556789122355788001234678891133467799023445679902334568900123556899012456679001344578801233467789112355779912234577990233556780113</span></span><br><span class="line">c = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,<span class="built_in">str</span>(b)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 reverse custom</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">    c[i] = (c[i] - <span class="number">1</span> - i) % <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 recover swap</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)//<span class="number">2</span>):</span><br><span class="line">    temp = c[i]</span><br><span class="line">    c[i] = c[<span class="number">511</span>-i]</span><br><span class="line">    c[<span class="number">511</span>-i] = temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 get flag</span></span><br><span class="line">flag = <span class="string">&quot;0&quot;</span> + <span class="string">&quot;&quot;</span>.join(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">str</span>,c)))[:-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;38d8d9e8-0c9e-48e0-b1b6-5593dd30f6ea&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="babyRSAMAX"><a href="#babyRSAMAX" class="headerlink" title="babyRSAMAX"></a>babyRSAMAX</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">听说你们数学很好，我不信我不信；）</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;XYCTF&#123;******&#125;&#x27;</span></span><br><span class="line">e = <span class="string">&#x27;?&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getBabyPrime</span>(<span class="params">nbits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> p.bit_length() &lt;= nbits:</span><br><span class="line">            p *= choice(sieve_base)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> isPrime(p+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> p+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">p = getBabyPrime(<span class="number">512</span>)</span><br><span class="line">q = getBabyPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">gift1 = (<span class="built_in">pow</span>(p,e,n)-<span class="built_in">pow</span>(q,e,n)) % n</span><br><span class="line">gift2 = <span class="built_in">pow</span>(p+q,e,n)</span><br><span class="line"></span><br><span class="line">t = <span class="number">65537</span></span><br><span class="line">x = bytes_to_long(e)</span><br><span class="line">y = <span class="built_in">pow</span>(x, t, n)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = powmod(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;gift1 = <span class="subst">&#123;gift1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;gift2 = <span class="subst">&#123;gift2&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;y = <span class="subst">&#123;y&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 39332423872740210783246069030855946244104982381157166843977599780233911183158560901377359925435092326653303964261550158658551518626014048783435245471536959844874036516931542444719549997971482644905523459407775392702211086149279473784796202020281909706723380472571862792003687423791576530085747716706475220532321</span></span><br><span class="line"><span class="string">gift1 = 4549402444746338327349007235818187793950285105091726167573552412678416759694660166956782755631447271662108564084382098562999950228708300902201571583419116299932264478381197034402338481872937576172197202519770782458343606060544694608852844228400457232100904217062914047342663534138668490328400022651816597367310</span></span><br><span class="line"><span class="string">gift2 = 111061215998959709920736448050860427855012026815376672067601244053580566359594802604251992986382187891022583247997994146019970445247509119719411310760491983876636264003942870756402328634092146799825005835867245563420135253048223898334460067523975023732153230791136870324302259127159852763634051238811969161011462</span></span><br><span class="line"><span class="string">c = 16938927825234407267026017561045490265698491840814929432152839745035946118743714566623315033802681009017695526374397370343984360997903165842591414203197184946588470355728984912522040744691974819630118163976259246941579063687857994193309554129816268931672391946592680578681270693589911021465752454315629283033043</span></span><br><span class="line"><span class="string">y = 1813650001270967709841306491297716908969425248888510985109381881270362755031385564927869313112540534780853966341044526856705589020295048473305762088786992446350060024881117741041260391405962817182674421715239197211274668450947666394594121764333794138308442124114744892164155894256326961605137479286082964520217</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>题目基于RSA分解，不过给了很多额外条件，具体来说有如下几个：</p>
<ul>
<li>p-1、q-1均光滑</li>
</ul>
<p>算了不写了，因为只用上面这个条件就可以完成n的分解，之后就可以解第一层得到加密指数e为4096，之后可以用rabin解flag也可以直接有限域开根。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">39332423872740210783246069030855946244104982381157166843977599780233911183158560901377359925435092326653303964261550158658551518626014048783435245471536959844874036516931542444719549997971482644905523459407775392702211086149279473784796202020281909706723380472571862792003687423791576530085747716706475220532321</span></span><br><span class="line">gift1 = <span class="number">4549402444746338327349007235818187793950285105091726167573552412678416759694660166956782755631447271662108564084382098562999950228708300902201571583419116299932264478381197034402338481872937576172197202519770782458343606060544694608852844228400457232100904217062914047342663534138668490328400022651816597367310</span></span><br><span class="line">gift2 = <span class="number">111061215998959709920736448050860427855012026815376672067601244053580566359594802604251992986382187891022583247997994146019970445247509119719411310760491983876636264003942870756402328634092146799825005835867245563420135253048223898334460067523975023732153230791136870324302259127159852763634051238811969161011462</span></span><br><span class="line">c = <span class="number">16938927825234407267026017561045490265698491840814929432152839745035946118743714566623315033802681009017695526374397370343984360997903165842591414203197184946588470355728984912522040744691974819630118163976259246941579063687857994193309554129816268931672391946592680578681270693589911021465752454315629283033043</span></span><br><span class="line">y = <span class="number">1813650001270967709841306491297716908969425248888510985109381881270362755031385564927869313112540534780853966341044526856705589020295048473305762088786992446350060024881117741041260391405962817182674421715239197211274668450947666394594121764333794138308442124114744892164155894256326961605137479286082964520217</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 factor n(p-1 smooth)</span></span><br><span class="line">a = <span class="number">2</span></span><br><span class="line">m = <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    a = <span class="built_in">pow</span>(a, m, n)</span><br><span class="line">    p = GCD(a-<span class="number">1</span>, n)</span><br><span class="line">    <span class="keyword">if</span> p != <span class="number">1</span> <span class="keyword">and</span> p != n:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    m += <span class="number">1</span></span><br><span class="line">q = n // p</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get e</span></span><br><span class="line">e = <span class="built_in">pow</span>(y,inverse(<span class="number">65537</span>,phi),n)</span><br><span class="line"><span class="comment">#print(long_to_bytes(e))</span></span><br><span class="line">e = <span class="number">4096</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 get flag</span></span><br><span class="line">res = Zmod(p)(c).nth_root(e, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    temp = long_to_bytes(<span class="built_in">int</span>(i))</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">b&quot;XYCTF&quot;</span> <span class="keyword">in</span> temp):</span><br><span class="line">        <span class="built_in">print</span>(temp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;Rabin_is_so_biggggg!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="fakeRSA"><a href="#fakeRSA" class="headerlink" title="fakeRSA"></a>fakeRSA</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">无描述就是最好的描述，嘿嘿！</span><br><span class="line"></span><br><span class="line">hint：考点:jordan</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;XYCTF&#123;******&#125;&#x27;</span></span><br><span class="line">n = ZZ(bytes_to_long(flag))</span><br><span class="line">p = getPrime(<span class="built_in">int</span>(<span class="number">320</span>))</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line">G = Zmod(p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">function</span>(<span class="params">X, Y, Z</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">part</span>(<span class="params">a, b, c</span>):</span><br><span class="line">        <span class="keyword">return</span> vector([<span class="number">9</span> * a - <span class="number">36</span> * c, <span class="number">6</span> * a - <span class="number">27</span> * c, b])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parts</span>(<span class="params">n</span>):</span><br><span class="line">        Gx.&lt;a, b, c&gt; = G[]</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>: <span class="keyword">return</span> vector([a, b, c])</span><br><span class="line">        mid = parts(n // <span class="number">2</span>)</span><br><span class="line">        result = mid(*mid)</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>: <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">else</span>: <span class="keyword">return</span> part(*result)</span><br><span class="line">    <span class="keyword">return</span> parts(n)(X, Y, Z)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(function(<span class="number">69</span>, <span class="number">48</span>, <span class="number">52</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#1849790472911267366045392456893126092698743308291512220657006129900961168811898822553602045875909</span></span><br><span class="line"><span class="comment">#(1431995965813617415860695748430644570118959991271395110995534704629241309597572003500157255135707, 1011565891130611736600822618382801465506651972373410962205810570075870804325974377971089090196019, 784497518859893244278116222363814433595961164446277297084989532659832474887622082585456138030246)</span></span><br></pre></td></tr></table></figure>
<p>完成这个题目要分析清楚function函数的功能，对于part函数，其作用为实现一个如下的线性变换：</p>
<script type="math/tex; mode=display">
\left(
 \begin{matrix}
   a'\\
   b'\\
   c'
  \end{matrix}
  \right)
  =
\left(
 \begin{matrix}
 9 && -36 \\
 6 && -27 \\
  & 1 &  \\
  \end{matrix}
  \right)
\left(
 \begin{matrix}
   a\\
   b\\
   c
  \end{matrix}
  \right)
  \quad(mod\;p)</script><p>而parts函数则是在用递归方式实现矩阵快速幂，所以function最终返回的结果其实是：</p>
<script type="math/tex; mode=display">
\left(
 \begin{matrix}
   a'\\
   b'\\
   c'
  \end{matrix}
  \right)
  =
\left(
 \begin{matrix}
 9 && -36 \\
 6 && -27 \\
  & 1 &  \\
  \end{matrix}
  \right)^n
\left(
 \begin{matrix}
   69\\
   48\\
   52
  \end{matrix}
  \right)
  \quad(mod\;p)</script><p>其中n是flag的值，也就是说我们实际上是要解决一个矩阵dlp问题。</p>
<p>而这个题目必须要使用jordan form来求解，这是因为如果使用行列式方法，p-1并不光滑；如果使用一般线性群的阶，他所有的子群阶也都不光滑。而jordan form求dlp的本质是解一个模p下的线性方程组，所以和p-1是否光滑并没有关系。</p>
<p>具体来说，现在的问题如下，记：</p>
<script type="math/tex; mode=display">
L = \left(
 \begin{matrix}
 9 && -36 \\
 6 && -27 \\
  & 1 &  \\
  \end{matrix}
  \right)</script><script type="math/tex; mode=display">
Ln = \left(
 \begin{matrix}
 9 && -36 \\
 6 && -27 \\
  & 1 &  \\
  \end{matrix}
  \right)^n</script><p>其中Ln可以由初始态和终态去继续递推几次，得到满秩的线性方程组求解得到，所以现在就是已知L和Ln，求解指数n的dlp问题。</p>
<p>而化为jordan form的做法原理如下，任何一个非奇异矩阵L都可以通过如下方式变换成jordan form：</p>
<script type="math/tex; mode=display">
L = PJP^{-1}</script><p>其中P是可逆矩阵，J是jordan型矩阵。这样做的好处在于矩阵的幂次可以写为：</p>
<script type="math/tex; mode=display">
Ln = L^n = (L)^n = (PJP^{-1})^n = PJ^nP^{-1}</script><p>所以有：</p>
<script type="math/tex; mode=display">
P^{-1}LnP = J^n</script><p>而对于题目的L，其jordan form是一个特征值为3的三阶jordan块：</p>
<script type="math/tex; mode=display">
J = 
\left(
 \begin{matrix}
 3 &1& \\
  &3& 1 \\
  &  &3  \\
  \end{matrix}
  \right)</script><blockquote>
<p>特征值为a的n阶jordan块就是指如下形式的矩阵：</p>
<script type="math/tex; mode=display">
J_{n}(a) = 
\left(
 \begin{matrix}
a &1&& \\
&a& 1& \\
&& \ddots& \\
&  &&a&1  \\
&  &&&a  \\
  \end{matrix}
  \right)</script></blockquote>
<p>可以看出这样的jordan块其实满足：</p>
<script type="math/tex; mode=display">
J_n(a) = J_n(0) + aE</script><p>所以对于本题的J^n，可以将下式用二项式定理展开：</p>
<script type="math/tex; mode=display">
J^n = (J(0) + 3E)^n = J(0)^n + 3nJ(0)^{n-1} + ... + 3^nE</script><p>而由于J(0)自乘三次之后就会变成0矩阵，所以其实最后就剩：</p>
<script type="math/tex; mode=display">
J^n = (J(0) + 3E)^n = C^n_{2}3^{n-2}J(0)^{2} + n3^{n-1}J(0) + 3^nE</script><blockquote>
<p>类似的可以推到更高阶的二项式展开情形</p>
</blockquote>
<p>所以J^n最终为：</p>
<script type="math/tex; mode=display">
J^n = 
\left(
 \begin{matrix}
 3^n &n3^{n-1}&C^n_{2}3^{n-2} \\
  &3^n& n3^{n-1} \\
  &  &3^n  \\
  \end{matrix}
  \right)</script><p>所以通过取他的左上角的值，可以得到3^n和n3^(n-1)在模p下的值，所以求n就很简单了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">1849790472911267366045392456893126092698743308291512220657006129900961168811898822553602045875909</span></span><br><span class="line">G = Zmod(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">L = Matrix(Zmod(p),[</span><br><span class="line">    [<span class="number">9</span>,<span class="number">0</span>,-<span class="number">36</span>],</span><br><span class="line">    [<span class="number">6</span>,<span class="number">0</span>,-<span class="number">27</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">])</span><br><span class="line">vec1 = (<span class="number">69</span>, <span class="number">48</span>, <span class="number">52</span>)</span><br><span class="line">vec2 = (<span class="number">1431995965813617415860695748430644570118959991271395110995534704629241309597572003500157255135707</span>, <span class="number">1011565891130611736600822618382801465506651972373410962205810570075870804325974377971089090196019</span>, <span class="number">784497518859893244278116222363814433595961164446277297084989532659832474887622082585456138030246</span>)</span><br><span class="line"></span><br><span class="line">vec1 = vector(Zmod(p),vec1)</span><br><span class="line">vec2 = vector(Zmod(p),vec2)</span><br><span class="line"></span><br><span class="line">M1 = Matrix(Zmod(p),Matrix(vec1).T)</span><br><span class="line">M1 = M1.augment(L*vec1)</span><br><span class="line">M1 = M1.augment(L^<span class="number">2</span>*vec1)</span><br><span class="line"></span><br><span class="line">M2 = Matrix(Zmod(p),Matrix(vec2).T)</span><br><span class="line">M2 = M2.augment(L*vec2)</span><br><span class="line">M2 = M2.augment(L^<span class="number">2</span>*vec2)</span><br><span class="line"></span><br><span class="line">R = M2*M1^(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">gl, P = L.jordan_form(transformation=<span class="literal">True</span>)</span><br><span class="line">gr = P^(-<span class="number">1</span>)*R*P</span><br><span class="line"></span><br><span class="line">g = gl[<span class="number">0</span>,<span class="number">0</span>] </span><br><span class="line">t = gr[<span class="number">0</span>,<span class="number">1</span>] <span class="comment"># t = ng^(n-1)</span></span><br><span class="line">k = gr[<span class="number">1</span>,<span class="number">1</span>] <span class="comment"># k = g^n</span></span><br><span class="line"><span class="comment">#so gt = nk  -&gt;  n = gtk^(-1)</span></span><br><span class="line"></span><br><span class="line">n = g * t * inverse(k,p) % p</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(n)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;y0u_finally_f0und_t3h_s3cr3ts!!&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="铜匠"><a href="#铜匠" class="headerlink" title="铜匠"></a>铜匠</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copper练习</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">m1 = getRandomRange(<span class="number">1</span>, m)</span><br><span class="line">m2 = getRandomRange(<span class="number">1</span>, m)</span><br><span class="line">m3 = m - m1 - m2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task1</span>():</span><br><span class="line">    e = <span class="number">149</span></span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = getPrime(<span class="number">512</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(m1, e, n), d &gt;&gt; <span class="number">222</span> &lt;&lt; <span class="number">222</span>, n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task2</span>():</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    q = getPrime(<span class="number">1024</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(m2, e, n), (p + q) &amp; ((<span class="number">1</span> &lt;&lt; <span class="number">624</span>) - <span class="number">1</span>), n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task3</span>():</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = getPrime(<span class="number">512</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(m3, e, n), (p ^ q) &gt;&gt; <span class="number">200</span>, n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c1, leak1, n1 = task1()</span><br><span class="line">c2, leak2, n2 = task2()</span><br><span class="line">c3, leak3, n3 = task3()</span><br><span class="line"><span class="built_in">print</span>(c1, leak1, n1)</span><br><span class="line"><span class="built_in">print</span>(c2, leak2, n2)</span><br><span class="line"><span class="built_in">print</span>(c3, leak3, n3)</span><br><span class="line"><span class="comment"># (89623543982221289730635223555830551523170205418976759060541832483843039074358160566735322009158596405712449020903311144480669706226166537602750967447480664875090686428406188847601970724994074417752345460791736191511081890913041143570455636020205647345764692062144226011846336769477026234106683791286490222089, 138474880017294332349992670187778287774153347391371789199005713563195654993662610111557185709277805165708109047494971468100563949333712521647405765501704478862377527360106399421209690341743821320754482338590671565510629203215009008479290995785318405211007685664887994061938667418220613430135743123498167435264, 146331610798417415036517077006943013321623040860385791423062775325646472298267580898028515394910588437521335092742913111680737790430660749825981979147191282007208147041227246620008377726207734522466015971515317594545750944838673018946440525615131606652748549901880641896940968837669894325535750125282351577689)</span></span><br><span class="line"><span class="comment"># (5473961166821344576614003060897848014482672788904094340704447882490091115468180944569409159343222459801235179587721232166576530621751748850763430788036935832653535110975154800191323351333883661451331971042214143454441651165718504131976920077768864850035471790911190772583977173388975105970866592974077361193822302653046511418190410043729876062517148438923211673300268277037622337403526399584759202097925983596261279676101079771530118525540842499517622478819211528345668513680064744443628779623340175578509413636950545134641050948185944279029949957748464529075830770617236599864271566534714755373562527112224962839980,62964793504732923650344975634773688108135580826064134090114181449607062497690184718845295432644650580930430061411603385577783897575232298084007041511817031640186953023971498914096209984730,20748652069632848434897928314437138341436264859802586939154590237186029244907936870477844563166827587536149170710720365760129683024401957095447466056746469055173897234659911291443605912459271248059341147358511860537769587963189092648473894868209838600346115919726589891777340166174017389513260737891557712152871714337946675533597049874155202056200170954033849176655928144354665553271709442011723088448485570394208728775665739819536229908847043007472178803394055783543378990699834066614262050119443421709878598533329555838915158259138297060574425019923291353077080236769586821808150397875920110335669136563171420068201)</span></span><br><span class="line"><span class="comment"># (34640310217688693418173336791306022698488916505988760907493665070072623574363578354500529023855888624978101429772253437880445815006839767802433777006836665709335479076676231470534690281412388704665083311568028710188940132495410474044569100181764053297307413009214044407982980600917158732129850605715306726034, 3763587651775261955566046684899146246387485307521708557610018711932791630073528010801142052497, 94848869174430082173244966077736519396702141299429965725051314270443078621842166791082354594193554380275167898342497998871366256044865879909218309960595691008663632410356093966762639308253848450178310347612630814852054763933063313537694449475061227647475480417779126252294793767003555255527593551612032661749)</span></span><br></pre></td></tr></table></figure>
<p>题目是三个part的copper，这里分开阐述。</p>
<h4 id="part1"><a href="#part1" class="headerlink" title="part1"></a>part1</h4><p>第一部分似乎和密码挑战赛的赛题11撞了，这里不太好直接展开说做法，密码挑战赛结束之后再更新。</p>
<h4 id="part2"><a href="#part2" class="headerlink" title="part2"></a>part2</h4><p>题目泄露的信息是p+q的低624位。由于有：</p>
<script type="math/tex; mode=display">
n = pq</script><p>这个等式自然在任何模数下都成立，也就有：</p>
<script type="math/tex; mode=display">
n = pq \quad(mod\;2^{624})</script><p>把已知条件放进来：</p>
<script type="math/tex; mode=display">
n = p(leak-p) \quad(mod\;2^{624})</script><p>所以可以在模2^624下解得p可能的低624bit，然后就转化成p低位泄露的问题了，对所有可能值逐一copper来得到正确解。</p>
<h4 id="part3"><a href="#part3" class="headerlink" title="part3"></a>part3</h4><p>题目泄露的信息是p^q的高312位，这里需要把剪枝和copper结合起来，做法可以参考鹏城杯的一道题目：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/e872e217.html">2023-鹏城杯-wp-crypto | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line"></span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    </span><br><span class="line">    k = ZZ(f.coefficients().pop(<span class="number">0</span>))</span><br><span class="line">    g = gcd(k, N)</span><br><span class="line">    k = R(k/g)</span><br><span class="line"></span><br><span class="line">    f *= <span class="number">1</span>/k</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vars</span> = f.variables()</span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m-k+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> subvars <span class="keyword">in</span> itertools.combinations_with_replacement(<span class="built_in">vars</span>[<span class="number">1</span>:], i):</span><br><span class="line">                g = f**k * prod(subvars) * N**(<span class="built_in">max</span>(d-k, <span class="number">0</span>))</span><br><span class="line">                G.append(g)</span><br><span class="line"></span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, Integer(<span class="number">1</span>)/factor)</span><br><span class="line"></span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B*monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c1,leak1,n1 = (<span class="number">89623543982221289730635223555830551523170205418976759060541832483843039074358160566735322009158596405712449020903311144480669706226166537602750967447480664875090686428406188847601970724994074417752345460791736191511081890913041143570455636020205647345764692062144226011846336769477026234106683791286490222089</span>, <span class="number">138474880017294332349992670187778287774153347391371789199005713563195654993662610111557185709277805165708109047494971468100563949333712521647405765501704478862377527360106399421209690341743821320754482338590671565510629203215009008479290995785318405211007685664887994061938667418220613430135743123498167435264</span>, <span class="number">146331610798417415036517077006943013321623040860385791423062775325646472298267580898028515394910588437521335092742913111680737790430660749825981979147191282007208147041227246620008377726207734522466015971515317594545750944838673018946440525615131606652748549901880641896940968837669894325535750125282351577689</span>)</span><br><span class="line">c2,leak2,n2 = (<span class="number">5473961166821344576614003060897848014482672788904094340704447882490091115468180944569409159343222459801235179587721232166576530621751748850763430788036935832653535110975154800191323351333883661451331971042214143454441651165718504131976920077768864850035471790911190772583977173388975105970866592974077361193822302653046511418190410043729876062517148438923211673300268277037622337403526399584759202097925983596261279676101079771530118525540842499517622478819211528345668513680064744443628779623340175578509413636950545134641050948185944279029949957748464529075830770617236599864271566534714755373562527112224962839980</span>,<span class="number">62964793504732923650344975634773688108135580826064134090114181449607062497690184718845295432644650580930430061411603385577783897575232298084007041511817031640186953023971498914096209984730</span>,<span class="number">20748652069632848434897928314437138341436264859802586939154590237186029244907936870477844563166827587536149170710720365760129683024401957095447466056746469055173897234659911291443605912459271248059341147358511860537769587963189092648473894868209838600346115919726589891777340166174017389513260737891557712152871714337946675533597049874155202056200170954033849176655928144354665553271709442011723088448485570394208728775665739819536229908847043007472178803394055783543378990699834066614262050119443421709878598533329555838915158259138297060574425019923291353077080236769586821808150397875920110335669136563171420068201</span>)</span><br><span class="line">c3,leak3,n3 = (<span class="number">34640310217688693418173336791306022698488916505988760907493665070072623574363578354500529023855888624978101429772253437880445815006839767802433777006836665709335479076676231470534690281412388704665083311568028710188940132495410474044569100181764053297307413009214044407982980600917158732129850605715306726034</span>, <span class="number">3763587651775261955566046684899146246387485307521708557610018711932791630073528010801142052497</span>, <span class="number">94848869174430082173244966077736519396702141299429965725051314270443078621842166791082354594193554380275167898342497998871366256044865879909218309960595691008663632410356093966762639308253848450178310347612630814852054763933063313537694449475061227647475480417779126252294793767003555255527593551612032661749</span>)</span><br><span class="line">e1,e2,e3 = <span class="number">149</span>,<span class="number">65537</span>,<span class="number">65537</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################# task1</span></span><br><span class="line">k1 = e1*leak1 // n1 + <span class="number">1</span></span><br><span class="line">PR.&lt;x,y&gt; = PolynomialRing(Zmod(e1*leak1))</span><br><span class="line">f = <span class="number">1</span> + k1*((n1+<span class="number">1</span>)-y) - e1*x</span><br><span class="line">bounds = (<span class="number">2</span>^<span class="number">222</span>,<span class="number">2</span>^<span class="number">513</span>)</span><br><span class="line"></span><br><span class="line">res = small_roots(f,bounds,m=<span class="number">2</span>,d=<span class="number">2</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(RealField(<span class="number">1000</span>))</span><br><span class="line">f = x*(leak-x) - n1</span><br><span class="line">ph = <span class="built_in">int</span>(f.roots()[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n1))</span><br><span class="line">f = ph + x</span><br><span class="line">res = f.small_roots(X=<span class="number">2</span>^(<span class="number">222</span>+<span class="number">6</span>), beta=<span class="number">0.499</span>,epsilon=<span class="number">0.02</span>)[<span class="number">0</span>]</span><br><span class="line">p1 = <span class="built_in">int</span>(ph + res)</span><br><span class="line">q1 = n1 // p1</span><br><span class="line">d1 = inverse(e1,(p1-<span class="number">1</span>)*(q1-<span class="number">1</span>))</span><br><span class="line">m1 = <span class="built_in">pow</span>(c1,d1,n1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################# task1</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n2))</span><br><span class="line">    pl = var(<span class="string">&#x27;pl&#x27;</span>)</span><br><span class="line">    p0 = solve_mod([pl*(leak2-pl) - n2  == <span class="number">0</span>], <span class="number">2</span>^<span class="number">624</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(p0):</span><br><span class="line">        temp = <span class="built_in">int</span>(i[<span class="number">0</span>])</span><br><span class="line">        f = <span class="number">2</span>^<span class="number">624</span>*x + temp</span><br><span class="line">        f = f.monic()</span><br><span class="line">        res = f.small_roots(X=<span class="number">2</span>^(<span class="number">1024</span>-<span class="number">624</span>), beta=<span class="number">0.499</span>,epsilon=<span class="number">0.05</span>)</span><br><span class="line">        <span class="keyword">if</span>(res != []):</span><br><span class="line">            <span class="built_in">print</span>(res,i)</span><br><span class="line">p2 = <span class="number">2</span>^<span class="number">624</span>*<span class="number">1818858780662674672546519234621144829011634239453991533158800384602749900390376290902354433158869501621068317141437803547</span> + <span class="number">30799806171826831530692477758473366666506107409058776239288103697521834047472422841398780886795811096950227412499497614896605408091510012455390741008241034524397897872311534501791582888829</span></span><br><span class="line">q2 = n2 // p2</span><br><span class="line">d2 = inverse(e2,(p2-<span class="number">1</span>)*(q2-<span class="number">1</span>))</span><br><span class="line">m2 = <span class="built_in">pow</span>(c2,d2,n2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################# task1</span></span><br><span class="line">leak3 = leak3 &lt;&lt; <span class="number">200</span></span><br><span class="line">LEAK = <span class="built_in">bin</span>(leak3)[<span class="number">2</span>:].zfill(<span class="number">512</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">ph,qh,h</span>):</span><br><span class="line">    pM = <span class="built_in">int</span>(ph + (<span class="number">512</span>-h)*<span class="string">&quot;1&quot;</span>,<span class="number">2</span>)</span><br><span class="line">    qM = <span class="built_in">int</span>(qh + (<span class="number">512</span>-h)*<span class="string">&quot;1&quot;</span>,<span class="number">2</span>)</span><br><span class="line">    pm = <span class="built_in">int</span>(ph + (<span class="number">512</span>-h)*<span class="string">&quot;0&quot;</span>,<span class="number">2</span>)</span><br><span class="line">    qm = <span class="built_in">int</span>(qh + (<span class="number">512</span>-h)*<span class="string">&quot;0&quot;</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(h == <span class="number">512</span> - <span class="number">200</span>):</span><br><span class="line">        PR.&lt;x&gt; = PolynomialRing(Zmod(n3))</span><br><span class="line">        f = pm + x</span><br><span class="line">        res = f.small_roots(X=<span class="number">2</span>^<span class="number">200</span>,beta=<span class="number">0.499</span>)</span><br><span class="line">        <span class="keyword">if</span>(res != []):</span><br><span class="line">            p3 = <span class="built_in">int</span>(pm + <span class="built_in">int</span>(res[<span class="number">0</span>]))</span><br><span class="line">            q3 = n3 // p3</span><br><span class="line">            d3 = inverse(e3,(p3-<span class="number">1</span>)*(q3-<span class="number">1</span>))</span><br><span class="line">            m3 = <span class="built_in">pow</span>(c3,d3,n3)</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m1+m2+m3)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(pM*qM &lt; n3 <span class="keyword">or</span> pm*qm &gt; n3):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(LEAK[h] == <span class="string">&quot;0&quot;</span>):</span><br><span class="line">        find(ph+<span class="string">&quot;1&quot;</span>,qh+<span class="string">&quot;1&quot;</span>,h+<span class="number">1</span>)</span><br><span class="line">        find(ph+<span class="string">&quot;0&quot;</span>,qh+<span class="string">&quot;0&quot;</span>,h+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        find(ph+<span class="string">&quot;1&quot;</span>,qh+<span class="string">&quot;0&quot;</span>,h+<span class="number">1</span>)</span><br><span class="line">        find(ph+<span class="string">&quot;0&quot;</span>,qh+<span class="string">&quot;1&quot;</span>,h+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">find(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;___y0u_k0nW_h0w_t0_s01v3_c0pP3r_th15_15_y0r_fl@9_hahahaha!!!___&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="factor3"><a href="#factor3" class="headerlink" title="factor3"></a>factor3</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这个e咋比n还大啊*逆天！*逆天！</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;XYCTF&#123;*****&#125;&#x27;</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gainPrime</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x = random.getrandbits(<span class="number">256</span>)</span><br><span class="line">        y = random.getrandbits(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> y % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        p = x ** <span class="number">3</span> + <span class="number">3</span> * y ** <span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> p.bit_length() == <span class="number">768</span> <span class="keyword">and</span> p % <span class="number">2</span> == <span class="number">1</span> <span class="keyword">and</span> isPrime(p):</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">p, q = gainPrime(), gainPrime()</span><br><span class="line">N = p * q</span><br><span class="line">phi = (p ** <span class="number">2</span> + p + <span class="number">1</span>) * (q ** <span class="number">2</span> + q + <span class="number">1</span>)</span><br><span class="line">d = getPrime(<span class="number">320</span>)</span><br><span class="line">e = inverse(d, phi)</span><br><span class="line">c = d**<span class="number">2</span>^m</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;N: <span class="subst">&#123;N&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c: <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">N: <span class="number">913125842482770239379848062277162627509794409924607555622246822717218133091223291889541294440266178282194506242444509803611492259403578922020590849630191477864719052980160940803309686069818208833547621252544423652489179493083138385424424384165228024273745733240109761707533778691158938848158094054261174692601673435971526522219273943464877956131040249169850420336023942653021547841666224446678539579529590840999008107782784268926145671962239929431694391039559247</span></span><br><span class="line">e: <span class="number">494518390582436635999115147756676313570637682518235195828939117782099618734167908630788943568232122157772909140885391963441876427590731524706959546524212914108888799081844320513851526790475333924396837458796755678072486028072639014677580265244176441153444956871730684233063789931539669072735599696830757690822185323538738397827461580678488181113667710378657058297572328491762536595872579603698945272140918157163640403488075948987156585480146162739943419183496337465468187233821931312507662218106713861638334075899266373256620752680354704533272722692596941861606161634082613228896420520465402725359166156632884432690715903666803067996854084671477445131853993177110154928274312496230096270510089973592664248613332000290545537840595645944390047611474888693558676781309912289044962293014118087259307560444929227407113819165713213046898243995956550944640168932947118400215917515277554126694376415569909534496134700668701465649939</span></span><br><span class="line">c: <span class="number">4450931337369461482106945992542133557585962894030505065110870389112565329875502952762182372926117037373210509516570958483606566274369840551132381128665744266165792377925899683228751870742727716</span></span><br></pre></td></tr></table></figure>
<p>题目基于求解RSA的私钥，需要获取d^2并与c异或得到明文m的值。而参数具有如下特殊性：</p>
<ul>
<li>d仅有320bit</li>
<li>e和d满足的式子为：</li>
</ul>
<script type="math/tex; mode=display">
ed = 1 + k(p^2+p+1)(q^2+q+1)</script><p>其中k和d数量级相近。</p>
<p>我的思路依然是copper，将式子展开得到：</p>
<script type="math/tex; mode=display">
ed = 1 + k(n^2 + pq^2 + q^2 + p^2q + n + q + p^2 + p + 1)</script><p>合并一下同类项：</p>
<script type="math/tex; mode=display">
ed = 1 + k[n^2 + n + 1 +  n(p+q) + p^2 + q^2 + p + q]</script><p>再变换：</p>
<script type="math/tex; mode=display">
ed = 1 + k[n^2 + n + 1 +  n(p+q) + (p+q)^2 - 2n + p + q]</script><p>所以最终得到：</p>
<script type="math/tex; mode=display">
ed = 1 + k[n^2 - n + 1 +  (n+1)(p+q) + (p+q)^2]</script><p>令x=k，y=p+q，得到模e下的多项式：</p>
<script type="math/tex; mode=display">
f = 1 + x[n^2 - n + 1 +  (n+1)y + y^2] \quad(mod\;e)</script><p>然后就可以copper求解出k和p+q的值了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line"></span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line"></span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line"></span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line"></span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">n = <span class="number">913125842482770239379848062277162627509794409924607555622246822717218133091223291889541294440266178282194506242444509803611492259403578922020590849630191477864719052980160940803309686069818208833547621252544423652489179493083138385424424384165228024273745733240109761707533778691158938848158094054261174692601673435971526522219273943464877956131040249169850420336023942653021547841666224446678539579529590840999008107782784268926145671962239929431694391039559247</span></span><br><span class="line">e = <span class="number">494518390582436635999115147756676313570637682518235195828939117782099618734167908630788943568232122157772909140885391963441876427590731524706959546524212914108888799081844320513851526790475333924396837458796755678072486028072639014677580265244176441153444956871730684233063789931539669072735599696830757690822185323538738397827461580678488181113667710378657058297572328491762536595872579603698945272140918157163640403488075948987156585480146162739943419183496337465468187233821931312507662218106713861638334075899266373256620752680354704533272722692596941861606161634082613228896420520465402725359166156632884432690715903666803067996854084671477445131853993177110154928274312496230096270510089973592664248613332000290545537840595645944390047611474888693558676781309912289044962293014118087259307560444929227407113819165713213046898243995956550944640168932947118400215917515277554126694376415569909534496134700668701465649939</span></span><br><span class="line">c = <span class="number">4450931337369461482106945992542133557585962894030505065110870389112565329875502952762182372926117037373210509516570958483606566274369840551132381128665744266165792377925899683228751870742727716</span></span><br><span class="line"></span><br><span class="line">PR.&lt;x,y&gt;=PolynomialRing(Zmod(e))</span><br><span class="line">f = <span class="number">1</span> + x*(n^<span class="number">2</span>-n+<span class="number">1</span> + (n+<span class="number">1</span>)*y + y^<span class="number">2</span>)</span><br><span class="line">res = small_roots(f, (<span class="number">2</span>^<span class="number">320</span>,<span class="number">2</span>^<span class="number">769</span>), m=<span class="number">2</span>, d=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">pplusq = <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">pminusq = iroot(pplusq^<span class="number">2</span>-<span class="number">4</span>*n,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">p = (pplusq + pminusq) // <span class="number">2</span></span><br><span class="line">q = n // p</span><br><span class="line"></span><br><span class="line">d = inverse(e,(p^<span class="number">2</span>+p+<span class="number">1</span>)*(q^<span class="number">2</span>+q+<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(d^<span class="number">2</span> ^^ c))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#XYCTF&#123;I_love_to_read_the_crypto_paper_and_try_to_ak_them&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/146254b2.html" title="2024-XYCTF-wp-crypto">https://tangcuxiaojikuai.xyz/post/146254b2.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/7848573.html" rel="prev" title="2024-DASCTF-GFCTF-wp-crypto">
      <i class="fa fa-chevron-left"></i> 2024-DASCTF-GFCTF-wp-crypto
    </a></div>
      <div class="post-nav-item">
    <a href="/post/9b3c95d4.html" rel="next" title="最近更新">
      最近更新 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#x0r"><span class="nav-number">1.</span> <span class="nav-text">x0r</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Complex-rsa"><span class="nav-number">2.</span> <span class="nav-text">Complex_rsa</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#factor1"><span class="nav-number">3.</span> <span class="nav-text">factor1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#new-LCG"><span class="nav-number">4.</span> <span class="nav-text">new_LCG</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LCG1"><span class="nav-number">4.1.</span> <span class="nav-text">LCG1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LCG2"><span class="nav-number">4.2.</span> <span class="nav-text">LCG2</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-ecc"><span class="nav-number">5.</span> <span class="nav-text">easy_ecc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E6%96%B9%E5%90%91%E7%9A%84%E5%AF%86%E7%A0%81-%E7%9B%B8%E6%80%9D"><span class="nav-number">6.</span> <span class="nav-text">反方向的密码 相思</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E6%96%B9%E5%90%91%E7%9A%84%E5%AF%86%E7%A0%81-%E6%83%85%E9%9A%BE"><span class="nav-number">7.</span> <span class="nav-text">反方向的密码 情难</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LCG-and-HNP"><span class="nav-number">8.</span> <span class="nav-text">LCG_and_HNP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#happy-to-solve1"><span class="nav-number">9.</span> <span class="nav-text">happy_to_solve1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#happy-to-solve2"><span class="nav-number">10.</span> <span class="nav-text">happy_to_solve2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#happy-to-solve3"><span class="nav-number">11.</span> <span class="nav-text">happy_to_solve3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E7%94%9F%E4%B9%8B%E6%88%91%E8%A6%81%E5%BD%93oi%E7%88%B7-pro"><span class="nav-number">12.</span> <span class="nav-text">重生之我要当oi爷 pro</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Random-rr"><span class="nav-number">13.</span> <span class="nav-text">Random_rr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Complex-dlp"><span class="nav-number">14.</span> <span class="nav-text">Complex_dlp</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#hint%E8%A7%A3%E6%B3%95"><span class="nav-number">14.1.</span> <span class="nav-text">hint解法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%88%91%E7%9A%84%E6%80%9D%E8%B7%AF"><span class="nav-number">14.2.</span> <span class="nav-text">我的思路</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sign1n-%E7%AD%BE%E5%88%B0"><span class="nav-number">15.</span> <span class="nav-text">Sign1n[签到]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babyRSAMAX"><span class="nav-number">16.</span> <span class="nav-text">babyRSAMAX</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fakeRSA"><span class="nav-number">17.</span> <span class="nav-text">fakeRSA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%93%9C%E5%8C%A0"><span class="nav-number">18.</span> <span class="nav-text">铜匠</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#part1"><span class="nav-number">18.1.</span> <span class="nav-text">part1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#part2"><span class="nav-number">18.2.</span> <span class="nav-text">part2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#part3"><span class="nav-number">18.3.</span> <span class="nav-text">part3</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#factor3"><span class="nav-number">19.</span> <span class="nav-text">factor3</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">74</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
