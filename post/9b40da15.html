<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="该文章主要记录一些格相关的趣题">
<meta property="og:type" content="article">
<meta property="og:title" content="Crypto趣题-Lattice">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/9b40da15.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="该文章主要记录一些格相关的趣题">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-09-29T01:54:15.000Z">
<meta property="article:modified_time" content="2024-02-27T03:14:02.325Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/9b40da15.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Crypto趣题-Lattice | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/9b40da15.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Crypto趣题-Lattice
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-29 09:54:15" itemprop="dateCreated datePublished" datetime="2023-09-29T09:54:15+08:00">2023-09-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-27 11:14:02" itemprop="dateModified" datetime="2024-02-27T11:14:02+08:00">2024-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/crypto%E8%B6%A3%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">crypto趣题</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/9b40da15.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/9b40da15.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>该文章主要记录一些格相关的趣题</p>
<span id="more"></span>
<h3 id="转化AGCD"><a href="#转化AGCD" class="headerlink" title="转化AGCD"></a>转化AGCD</h3><p>题目来源：暂不明确</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">nbits = <span class="number">512</span></span><br><span class="line">delta = <span class="number">.93</span></span><br><span class="line">kbits = <span class="built_in">int</span>(nbits*delta) &gt;&gt; <span class="number">1</span></span><br><span class="line">bound = <span class="number">2</span>**kbits</span><br><span class="line"></span><br><span class="line">m = <span class="number">53</span></span><br><span class="line">p = getPrime(nbits)</span><br><span class="line">x = randint(<span class="number">2</span>, p - <span class="number">1</span>)</span><br><span class="line">a = [randint(<span class="number">2</span>, bound) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m)]</span><br><span class="line">b = [inverse(a[i] * x + randint(<span class="number">2</span>, bound), p) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;a = &#125;</span>\n<span class="subst">&#123;b = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">n = p * getPrime(nbits)</span><br><span class="line">c = <span class="built_in">pow</span>(bytes_to_long(flag), e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>\n<span class="subst">&#123;n = &#125;</span>\n<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a = [226623173423524660762660587272926713775967113908071780918074044654746571, 99264763681859867816401881797921542580399607408617989905539839585323915, 177386736426181055874933306917112626356703658087900095566603898769091471, 5081587307910189127020749833744000992860852972311811125838243285877024, 411574110749659943703486080205654180795533263258790540505729307655142415, 1932137082695732276757073197845160804183868657578020568122170798605640, 103124563846054461729937757543103647655652920105466714505493351091607258, 65504504807895104765113845019342631211794998326986693051403166347389343, 151981136459515488882551190881724794060443302721456924436833810784219984, 3718222682937746804225225548712093487815785751144078132168082568580360, 113510621144631490440930342566441462111997352193075435129065142534001691, 120974784665251812036673794948678799274628176126865320042025545119228958, 193781634902416477262894357163294897773986019836290716577623654684669134, 24723078645443091017196603549741156206848230267873373213787667300835247, 113165730428784680251415263617027036564335843097634063978942541861726366, 407969345567975756778713582637075079783087682011802438819519567067241979, 151997755976755754648644424339697978791639952976423703068460739754839735, 253811682402531882908516509348937060650658679039884817907013090700281326, 404019046883201096048575369492824679211148242588135515488831100750933, 216725815105749574244056185735609680710954976727370948136589694286539150, 131605791470353972911656132280131756304373156215254629027113994962767833, 180190835657942894146705472335255090682179032409197893415067330574923084, 280086867488286721744184104208965143004904898002959657537412170401510680, 141039650035922882497777354937772530276454847300329950111476878397654053, 319858542602843767926919031049756704694256249776295683733693049522108872, 135633729043152514436339515687850041275739968837263316059461122379487161, 5038078437655552457504448170918674775639811066221990939957937239270167, 31918623105281221407484700216805581554894830335850729735403857505547002, 424092292941284354705774693468403308534554297314522980647422106907791591, 300635399575681097924575337707842439619576566621368558814406755486658723, 323686536134235835297820679361020300261642147835330856978902402517820801, 392620731408972775834827063986182511057173023783228673505487358356342114, 108681888409433100038410892044516773350200560613740266422720530715166828, 182338238967593331173372924666322484559869636981878410128856193538847678, 242630103099393630296862580986126439159331512930513337684897019399319621, 439737851682655515589311041364295341910822514202794661846391952824593066, 84115222835816390632388766236883091861894245716624041418721833768917547, 83926810016448863267608537461154878096011055852547156452557576634691363, 354588657997053098464002945990025178880458974438409486331146607111950617, 170413334241108032297843362994773587930354677207616527135896108692092457, 283185550452196010949673962093382632839937948488235076418296451706429923, 390000015988537819093964185756696910433784324036454283227484980367608884, 121370082693927496814267201484843687844578996855559797026014779421645731, 357164702199289826402900456464935203585119719343409406742172822868770420, 124276883926433089715798954125363260298740714164810098876501303684201565, 122912426324401068572433533096099229494021528981601203447594706478943744, 287527827124819650763642012585104162743364640051014410357971387706781531, 135819408760576908301747047938951002691288880199213610653148681326046091, 239644892459756283997004399339163555215985564639569406081575642996080481, 241513055132921096791997556818670497379598444881679976542299970876463098, 144152466563589166040797814966860917437020789050031353309848917297959088, 120162009732086541189519736083838746833770360960800721525565383293404918, 121547756201941339094205049920057111793191461762212554355070565584802804]</span></span><br><span class="line"><span class="string">b = [6914108949558554967947157128371931777410399406424987472871265954007536210016000226325059466226417032321637768264366355381358552354005990800271210820573485, 4243350947524503250221141283676871054961767761533372535893799777316644277502608136805589201625364130457811586620275507258712882614289496389903620348266876, 7207723049065039433195103268720351560639394404931218738588797743896531445162073256971205066381805731964498662913612257697112297701515506572915529630749649, 9478867353430476119494189313998177997736272254097122188128236485373498544996365281925749885278741955783336542038044934310609039388320259421902808190444639, 10092751897940937230080778690510245631681516769761757712615337492357689455504789850857408988921202275660819814611602363226676960504340172006698418415173603, 5925826079655586275072881965974452367893696237983922405515651101142466142890347074549417916208251973477786424292583294611467079137685936757690986611634840, 2705681917429356111941316419951220642197423059675588735077708172236184161647753066851383893342803615318493417826483637576437939588768131347824859258545037, 5793481213766970753853702438948943122939283534830229656699291673833482520096412620329053619097899786691202045974184168665694248732396928571682405270896258, 3212965229314647637209688663583343281038324880827825190075824389072703574155472958687615046177029380089781167897141334668918512246004114927754397070032450, 507858897452123392345795058512546587866098555419275815786154069852495346820264502978622507708545904809967228104858456493411165322256241259977367791849042, 1910673108437857460691507244808588742883010826641687685721219894695257479961884688001651060796296482279750896861871054549713247272267814842634417960819168, 2886899741243848325873884252302617091514751717162909139186588257257958079130295099942906361136727891394692438504521454612873780003451672796809495226053047, 9475112027697464127079619380873273645977046666164164866182205134451664768516062572467782141714310693479352016031210905832129007401065693258638549100340615, 6500556077535313473248384729914564751019267303740919343852356539545383313100771434642240039386190890442297569489225045989569513367190888305128046797790102, 4352575880916080525863863641402979108455803235156616467981920947190189719209876636528864672410548581564537392488508689158499605332674737341258230577454475, 8855806560115120193748486720541724804359134126331550182497194629659837334220708039976726151383523965042432921330088347099157101222325916589506823343303429, 2774687136241363374520941544838376461935832170671324174983217598018541119488143069001573950404074015672792681188308412236177101695870429933915439814455887, 3592625154014227818614640279472091377202566130067513443394635609406915223429475106920133466069573358784994632708606215548054720669924050172507230811524716, 6955167231829680836198358545532458408492109230130585460528670650387346748536700767474985024643177587060440925065292948599577822789464670224006606550191671, 9194240450171813716718107852597217121362901491312541712415368806074976814988492806542250961496723482200369134039024809109124268301878344007510329535899615, 5950577443108124534632225089717156798651285826327691188035165834526053749015025923590404663092184546183617748745220821771671541995250149683517797527521402, 8147536282406177354958293970877926560729452459282692121940762677425779306283487924160782780299072205173184092679363257393333408904258459452274140791704067, 2559838851622656651952688025212080768394118716136473174419624432065878751831257138924556995347285973152404103332115858073203707432778426111325160735797721, 4949359541993387232537947394033362386729434824378846379892748514319807403496542405321037377319385099259508143211518009425440208974571177165892037150309091, 1811673815510905036234500180939767229691774807773077679609856974935852997557959138952513786288094951891092390620085630282790435640054840555430191851155313, 4777885082419038381870076531532991228660498200204585112220314790970263737966241042846160101892845251352987027168075888559622541458466624868511496707956221, 10238413710887745087366241938666680877364662925315040665408262063559110391570620624035047723405526398382375337996702653261521046541231508963525281969167278, 3473340971529025694371400010471019993671985537666177271712164477185774211271764180735799413043127038518985595844132844447764288680922052782557764949946998, 867350328105510555601266520733196439839458877892746826352327206388533426010006967907349245075237097927904721917883721235095421696529792601733014134854086, 2222551217354471458254572360148123193413834831993026644829243162796014361851880328878269533732240093458365703558737637137958860294765246560791514120259973, 11135205396103944017696365595462393888434601100415179875833418713405171505514194213145570969708606144837327906949671055964664374675657263466390592843391795, 8522093767526974938129274822063573020978729589640216089964237075835492415426711219243729120235033613444547687888110911207624759350428715822663409802746531, 618066223420558653541360712487038985426207412776033652080372792996567809564864490136174039188920973110051946250308952735815050129654446357610891600358247, 9409683398358516350960966400164689353665188916574105692687503875332913200043983566205433723664581043184720605266180639045542588369320481456882129188045630, 10444912184036485133367095187175276878779180732948191228469107836744786278456394810069942330852023901190983084405589604802372025661121698806608507168815980, 5576808818750933483753823503921696491223987341840901931564632327098735945058071342467846031030536056935288275893098409520502499556978787294107531192342888, 11386170831130547392066338523237385342399839863674855226178213470159061980868639851406716227763244070078162813390834461297132500087558187715637626334931068, 9266567474732845229716988973436914937598698459994255583719094874193822181675544832905800318876640152861212158602258489908050910803591150200525814954449464, 783592057196685768383414375510915255040313296240508052297125547577301394194342174502254618660494179262947294784116190346971775913769035176336764690986707, 9105502180406569116340185218615179260760299848734930041602247299415927012355894700609320722623370139135122342263713846033304524885782445949914570572453737, 2297513067567074587355421795953863750627166311403426281361312466297059134183355298180726594771668216966732975569375780641995446201527865824229865021970151, 11188600115372846854366137972585164923834717935898376598627276542371780275188751807941476083838808640337088079259756154889298297211898790479562768420072518, 9656534484640562909118084019762167873291009773232637365213178341424207965285682074941363264934464618450896824843786922345950140473512635227211478685645772, 9343461413426168572561103655466265435717795505657355206522619014228487030194629865342342831380623629471381377128476731390629039248389925891691539701146309, 8681682631345831952913045584970984843073645909076987924890403622460027832467542651987623584349089629585531159664847835287269602153108548311564650707486153, 2656022193773767486949157049738671449721427276944394094199310567891807831351152318018854466905531462256724938253289337125816757790150607033652302227218868, 8508384570273623974802293014504152838556567399448174508834295467479347400327605230626491770497722014885725768213847610504091563629074470937893415637338996, 9716708016762837073052660164394053927821481998442639097920157163041635386583167412600530638659299593644342722890385260143682043966383262553995449944733956, 10231440381205182517403356785692369093270060843919065205063057623835967990844569366866607452179015606536153761832574542432676397053147658371344410148994418, 5146017765041682548648007957706007143803297597587388958721578537741505373387718545092695689770641249769257901519197825087801304735466239843061128683798476, 5222787643951107881679620487297380490422971146509273142662864657570322385794688143091615970726544447887548792995773377472568754141261595697499826832283200, 10464709627510729920064247596403868144579001206027850090117534773353171042729174225448975480540265139445689560336303762183734720331072177316589830221880977, 8615548684371129329547908465444932886632829509038689025840147771114904826804441395348568994340729561487767929565347408386252378372026787346043297419998538]</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">n = 97853623351997296064353255135588846396569970130207954701198599507389250544514082114957455795330569730103385876268186267851194017938003005329258612122178955978821786063623918361705120943030241043571056282806763102278839262572943852578441568495106906583558313075633340995336324665255745279078992160547871869557</span></span><br><span class="line"><span class="string">c = 44431449479567561261917922338101462065458737366369232901780150553091038211618354850829522817943842817713545313017593484450672219262670055539455602698182643653128488160901383204333856589371756831501857423631322915113418699087489759910739942878900174507138454184974875778861767989603951090385047953725189919178</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>观察题目，题目给了如下形式的53组等式：</p>
<script type="math/tex; mode=display">
b_i = (a_i*x + r_i)^{-1} \quad(mod\;p)</script><p>其中，各个值的已知信息如下：</p>
<ul>
<li>x 为 (2，p - 1) 之间的随机数，并且在53组等式中保持不变</li>
<li>a、r 为 (2，2**238) 之间的随机数</li>
<li>给出 a 、b</li>
</ul>
<p>首先，有两点信息暗示要用格：</p>
<p>1、a、r 限制了数据范围，可以看作是小量，暗示用LLL</p>
<p>2、多组线性等式，暗示用矩阵</p>
<p><br></p>
<p>所以关键就是转化到一个可以运用格的问题形式，推导如下：</p>
<p>首先要想明白下面的式子：(推导比较容易，就不讲了)</p>
<script type="math/tex; mode=display">
inverse(b,n) = inverse(b,p)\quad(mod\;p)</script><p>然后就可以将问题按下面的方式逐步转化：</p>
<p>1、<strong>将b逆元转化到模n</strong></p>
<script type="math/tex; mode=display">
(a_0*x + r_0) = inverse(b_0,p) \quad(mod\;p)</script><p>​        代入上面的式子，变成：</p>
<script type="math/tex; mode=display">
(a_0*x + r_0) = inverse(b_0,n) \quad(mod\;p)</script><p>​        同理：</p>
<script type="math/tex; mode=display">
(a_1*x + r_1) = inverse(b_1,n) \quad(mod\;p)</script><p>2、<strong>联立消元</strong></p>
<script type="math/tex; mode=display">
a_1*(a_0*x + r_0) = a_1*inverse(b_0,n) \quad(mod\;p)</script><script type="math/tex; mode=display">
a_0*(a_1*x + r_1) = a_0*inverse(b_1,n) \quad(mod\;p)</script><p>​        相减得到：</p>
<script type="math/tex; mode=display">
a_1*r_0 + a_0*r_1 = a_1*inverse(b_0,n) - a_0*inverse(b_1,n)\quad(mod\;p)</script><p>​        有没有发现，小量已经全部移到了等式同一边</p>
<p>3、<strong>转化为AGCD问题</strong></p>
<p>将模等式利用同余定理展开：</p>
<script type="math/tex; mode=display">
a_1*inverse(b_0,n) - a_0*inverse(b_1,n) = k*p + a_1*r_0 + a_0*r_1</script><p>​        此时，问题已经变成了AGCD问题，这是因为：</p>
<p>​        AGCD问题通常形式：</p>
<script type="math/tex; mode=display">
X = q*p + r</script><p>​        在本题中，各个量如下：</p>
<script type="math/tex; mode=display">
X = a_1*inverse(b_0,n) - a_0*inverse(b_1,n)</script><script type="math/tex; mode=display">
q = k,\quad
p = p,\quad
r = a_1*r_0 + a_0*r_1</script><p>至此问题推导就结束了。</p>
<p>exp.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">P_bits = <span class="number">512</span></span><br><span class="line">Q_bits = <span class="number">238</span>+<span class="number">1024</span>-<span class="number">512</span></span><br><span class="line">R_bits = <span class="number">238</span>+<span class="number">238</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">226623173423524660762660587272926713775967113908071780918074044654746571</span>, <span class="number">99264763681859867816401881797921542580399607408617989905539839585323915</span>, <span class="number">177386736426181055874933306917112626356703658087900095566603898769091471</span>, <span class="number">5081587307910189127020749833744000992860852972311811125838243285877024</span>, <span class="number">411574110749659943703486080205654180795533263258790540505729307655142415</span>, <span class="number">1932137082695732276757073197845160804183868657578020568122170798605640</span>, <span class="number">103124563846054461729937757543103647655652920105466714505493351091607258</span>, <span class="number">65504504807895104765113845019342631211794998326986693051403166347389343</span>, <span class="number">151981136459515488882551190881724794060443302721456924436833810784219984</span>, <span class="number">3718222682937746804225225548712093487815785751144078132168082568580360</span>, <span class="number">113510621144631490440930342566441462111997352193075435129065142534001691</span>, <span class="number">120974784665251812036673794948678799274628176126865320042025545119228958</span>, <span class="number">193781634902416477262894357163294897773986019836290716577623654684669134</span>, <span class="number">24723078645443091017196603549741156206848230267873373213787667300835247</span>, <span class="number">113165730428784680251415263617027036564335843097634063978942541861726366</span>, <span class="number">407969345567975756778713582637075079783087682011802438819519567067241979</span>, <span class="number">151997755976755754648644424339697978791639952976423703068460739754839735</span>, <span class="number">253811682402531882908516509348937060650658679039884817907013090700281326</span>, <span class="number">404019046883201096048575369492824679211148242588135515488831100750933</span>, <span class="number">216725815105749574244056185735609680710954976727370948136589694286539150</span>, <span class="number">131605791470353972911656132280131756304373156215254629027113994962767833</span>, <span class="number">180190835657942894146705472335255090682179032409197893415067330574923084</span>, <span class="number">280086867488286721744184104208965143004904898002959657537412170401510680</span>, <span class="number">141039650035922882497777354937772530276454847300329950111476878397654053</span>, <span class="number">319858542602843767926919031049756704694256249776295683733693049522108872</span>, <span class="number">135633729043152514436339515687850041275739968837263316059461122379487161</span>, <span class="number">5038078437655552457504448170918674775639811066221990939957937239270167</span>, <span class="number">31918623105281221407484700216805581554894830335850729735403857505547002</span>, <span class="number">424092292941284354705774693468403308534554297314522980647422106907791591</span>, <span class="number">300635399575681097924575337707842439619576566621368558814406755486658723</span>, <span class="number">323686536134235835297820679361020300261642147835330856978902402517820801</span>, <span class="number">392620731408972775834827063986182511057173023783228673505487358356342114</span>, <span class="number">108681888409433100038410892044516773350200560613740266422720530715166828</span>, <span class="number">182338238967593331173372924666322484559869636981878410128856193538847678</span>, <span class="number">242630103099393630296862580986126439159331512930513337684897019399319621</span>, <span class="number">439737851682655515589311041364295341910822514202794661846391952824593066</span>, <span class="number">84115222835816390632388766236883091861894245716624041418721833768917547</span>, <span class="number">83926810016448863267608537461154878096011055852547156452557576634691363</span>, <span class="number">354588657997053098464002945990025178880458974438409486331146607111950617</span>, <span class="number">170413334241108032297843362994773587930354677207616527135896108692092457</span>, <span class="number">283185550452196010949673962093382632839937948488235076418296451706429923</span>, <span class="number">390000015988537819093964185756696910433784324036454283227484980367608884</span>, <span class="number">121370082693927496814267201484843687844578996855559797026014779421645731</span>, <span class="number">357164702199289826402900456464935203585119719343409406742172822868770420</span>, <span class="number">124276883926433089715798954125363260298740714164810098876501303684201565</span>, <span class="number">122912426324401068572433533096099229494021528981601203447594706478943744</span>, <span class="number">287527827124819650763642012585104162743364640051014410357971387706781531</span>, <span class="number">135819408760576908301747047938951002691288880199213610653148681326046091</span>, <span class="number">239644892459756283997004399339163555215985564639569406081575642996080481</span>, <span class="number">241513055132921096791997556818670497379598444881679976542299970876463098</span>, <span class="number">144152466563589166040797814966860917437020789050031353309848917297959088</span>, <span class="number">120162009732086541189519736083838746833770360960800721525565383293404918</span>, <span class="number">121547756201941339094205049920057111793191461762212554355070565584802804</span>]</span><br><span class="line">b = [<span class="number">6914108949558554967947157128371931777410399406424987472871265954007536210016000226325059466226417032321637768264366355381358552354005990800271210820573485</span>, <span class="number">4243350947524503250221141283676871054961767761533372535893799777316644277502608136805589201625364130457811586620275507258712882614289496389903620348266876</span>, <span class="number">7207723049065039433195103268720351560639394404931218738588797743896531445162073256971205066381805731964498662913612257697112297701515506572915529630749649</span>, <span class="number">9478867353430476119494189313998177997736272254097122188128236485373498544996365281925749885278741955783336542038044934310609039388320259421902808190444639</span>, <span class="number">10092751897940937230080778690510245631681516769761757712615337492357689455504789850857408988921202275660819814611602363226676960504340172006698418415173603</span>, <span class="number">5925826079655586275072881965974452367893696237983922405515651101142466142890347074549417916208251973477786424292583294611467079137685936757690986611634840</span>, <span class="number">2705681917429356111941316419951220642197423059675588735077708172236184161647753066851383893342803615318493417826483637576437939588768131347824859258545037</span>, <span class="number">5793481213766970753853702438948943122939283534830229656699291673833482520096412620329053619097899786691202045974184168665694248732396928571682405270896258</span>, <span class="number">3212965229314647637209688663583343281038324880827825190075824389072703574155472958687615046177029380089781167897141334668918512246004114927754397070032450</span>, <span class="number">507858897452123392345795058512546587866098555419275815786154069852495346820264502978622507708545904809967228104858456493411165322256241259977367791849042</span>, <span class="number">1910673108437857460691507244808588742883010826641687685721219894695257479961884688001651060796296482279750896861871054549713247272267814842634417960819168</span>, <span class="number">2886899741243848325873884252302617091514751717162909139186588257257958079130295099942906361136727891394692438504521454612873780003451672796809495226053047</span>, <span class="number">9475112027697464127079619380873273645977046666164164866182205134451664768516062572467782141714310693479352016031210905832129007401065693258638549100340615</span>, <span class="number">6500556077535313473248384729914564751019267303740919343852356539545383313100771434642240039386190890442297569489225045989569513367190888305128046797790102</span>, <span class="number">4352575880916080525863863641402979108455803235156616467981920947190189719209876636528864672410548581564537392488508689158499605332674737341258230577454475</span>, <span class="number">8855806560115120193748486720541724804359134126331550182497194629659837334220708039976726151383523965042432921330088347099157101222325916589506823343303429</span>, <span class="number">2774687136241363374520941544838376461935832170671324174983217598018541119488143069001573950404074015672792681188308412236177101695870429933915439814455887</span>, <span class="number">3592625154014227818614640279472091377202566130067513443394635609406915223429475106920133466069573358784994632708606215548054720669924050172507230811524716</span>, <span class="number">6955167231829680836198358545532458408492109230130585460528670650387346748536700767474985024643177587060440925065292948599577822789464670224006606550191671</span>, <span class="number">9194240450171813716718107852597217121362901491312541712415368806074976814988492806542250961496723482200369134039024809109124268301878344007510329535899615</span>, <span class="number">5950577443108124534632225089717156798651285826327691188035165834526053749015025923590404663092184546183617748745220821771671541995250149683517797527521402</span>, <span class="number">8147536282406177354958293970877926560729452459282692121940762677425779306283487924160782780299072205173184092679363257393333408904258459452274140791704067</span>, <span class="number">2559838851622656651952688025212080768394118716136473174419624432065878751831257138924556995347285973152404103332115858073203707432778426111325160735797721</span>, <span class="number">4949359541993387232537947394033362386729434824378846379892748514319807403496542405321037377319385099259508143211518009425440208974571177165892037150309091</span>, <span class="number">1811673815510905036234500180939767229691774807773077679609856974935852997557959138952513786288094951891092390620085630282790435640054840555430191851155313</span>, <span class="number">4777885082419038381870076531532991228660498200204585112220314790970263737966241042846160101892845251352987027168075888559622541458466624868511496707956221</span>, <span class="number">10238413710887745087366241938666680877364662925315040665408262063559110391570620624035047723405526398382375337996702653261521046541231508963525281969167278</span>, <span class="number">3473340971529025694371400010471019993671985537666177271712164477185774211271764180735799413043127038518985595844132844447764288680922052782557764949946998</span>, <span class="number">867350328105510555601266520733196439839458877892746826352327206388533426010006967907349245075237097927904721917883721235095421696529792601733014134854086</span>, <span class="number">2222551217354471458254572360148123193413834831993026644829243162796014361851880328878269533732240093458365703558737637137958860294765246560791514120259973</span>, <span class="number">11135205396103944017696365595462393888434601100415179875833418713405171505514194213145570969708606144837327906949671055964664374675657263466390592843391795</span>, <span class="number">8522093767526974938129274822063573020978729589640216089964237075835492415426711219243729120235033613444547687888110911207624759350428715822663409802746531</span>, <span class="number">618066223420558653541360712487038985426207412776033652080372792996567809564864490136174039188920973110051946250308952735815050129654446357610891600358247</span>, <span class="number">9409683398358516350960966400164689353665188916574105692687503875332913200043983566205433723664581043184720605266180639045542588369320481456882129188045630</span>, <span class="number">10444912184036485133367095187175276878779180732948191228469107836744786278456394810069942330852023901190983084405589604802372025661121698806608507168815980</span>, <span class="number">5576808818750933483753823503921696491223987341840901931564632327098735945058071342467846031030536056935288275893098409520502499556978787294107531192342888</span>, <span class="number">11386170831130547392066338523237385342399839863674855226178213470159061980868639851406716227763244070078162813390834461297132500087558187715637626334931068</span>, <span class="number">9266567474732845229716988973436914937598698459994255583719094874193822181675544832905800318876640152861212158602258489908050910803591150200525814954449464</span>, <span class="number">783592057196685768383414375510915255040313296240508052297125547577301394194342174502254618660494179262947294784116190346971775913769035176336764690986707</span>, <span class="number">9105502180406569116340185218615179260760299848734930041602247299415927012355894700609320722623370139135122342263713846033304524885782445949914570572453737</span>, <span class="number">2297513067567074587355421795953863750627166311403426281361312466297059134183355298180726594771668216966732975569375780641995446201527865824229865021970151</span>, <span class="number">11188600115372846854366137972585164923834717935898376598627276542371780275188751807941476083838808640337088079259756154889298297211898790479562768420072518</span>, <span class="number">9656534484640562909118084019762167873291009773232637365213178341424207965285682074941363264934464618450896824843786922345950140473512635227211478685645772</span>, <span class="number">9343461413426168572561103655466265435717795505657355206522619014228487030194629865342342831380623629471381377128476731390629039248389925891691539701146309</span>, <span class="number">8681682631345831952913045584970984843073645909076987924890403622460027832467542651987623584349089629585531159664847835287269602153108548311564650707486153</span>, <span class="number">2656022193773767486949157049738671449721427276944394094199310567891807831351152318018854466905531462256724938253289337125816757790150607033652302227218868</span>, <span class="number">8508384570273623974802293014504152838556567399448174508834295467479347400327605230626491770497722014885725768213847610504091563629074470937893415637338996</span>, <span class="number">9716708016762837073052660164394053927821481998442639097920157163041635386583167412600530638659299593644342722890385260143682043966383262553995449944733956</span>, <span class="number">10231440381205182517403356785692369093270060843919065205063057623835967990844569366866607452179015606536153761832574542432676397053147658371344410148994418</span>, <span class="number">5146017765041682548648007957706007143803297597587388958721578537741505373387718545092695689770641249769257901519197825087801304735466239843061128683798476</span>, <span class="number">5222787643951107881679620487297380490422971146509273142662864657570322385794688143091615970726544447887548792995773377472568754141261595697499826832283200</span>, <span class="number">10464709627510729920064247596403868144579001206027850090117534773353171042729174225448975480540265139445689560336303762183734720331072177316589830221880977</span>, <span class="number">8615548684371129329547908465444932886632829509038689025840147771114904826804441395348568994340729561487767929565347408386252378372026787346043297419998538</span>]</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">97853623351997296064353255135588846396569970130207954701198599507389250544514082114957455795330569730103385876268186267851194017938003005329258612122178955978821786063623918361705120943030241043571056282806763102278839262572943852578441568495106906583558313075633340995336324665255745279078992160547871869557</span></span><br><span class="line">c = <span class="number">44431449479567561261917922338101462065458737366369232901780150553091038211618354850829522817943842817713545313017593484450672219262670055539455602698182643653128488160901383204333856589371756831501857423631322915113418699087489759910739942878900174507138454184974875778861767989603951090385047953725189919178</span></span><br><span class="line"></span><br><span class="line">N = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">51</span>):</span><br><span class="line">    N.append(a[i+<span class="number">1</span>]*inverse(b[i],n) - a[i]*inverse(b[i+<span class="number">1</span>],n))</span><br><span class="line">X = <span class="number">2</span>**R_bits</span><br><span class="line">m = <span class="built_in">len</span>(N)</span><br><span class="line"></span><br><span class="line">PR = PolynomialRing(ZZ, names=[<span class="built_in">str</span>(<span class="string">&#x27;x%d&#x27;</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1</span> + m)])</span><br><span class="line"></span><br><span class="line">h = <span class="number">3</span></span><br><span class="line">u = <span class="number">1</span></span><br><span class="line">variables = PR.gens()</span><br><span class="line"></span><br><span class="line">gg = []</span><br><span class="line">monomials = [variables[<span class="number">0</span>]**<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">    gg.append(N[i] - variables[i])</span><br><span class="line">    monomials.append(variables[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(monomials), <span class="built_in">len</span>(gg))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;monomials:&#x27;</span>, monomials)</span><br><span class="line"></span><br><span class="line">B = Matrix(ZZ, <span class="built_in">len</span>(gg), <span class="built_in">len</span>(monomials))</span><br><span class="line"><span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(gg)):</span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(monomials)):</span><br><span class="line">        <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">            B[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj]([X] * m)</span><br><span class="line"></span><br><span class="line">B = B.LLL()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span> * <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">new_pol = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(gg)):</span><br><span class="line">    tmp_pol = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(monomials)):</span><br><span class="line">        tmp_pol += monomials[j](variables) * B[i, j] / monomials[j]([X] * m)</span><br><span class="line">    new_pol.append(tmp_pol)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(new_pol) &gt; <span class="number">0</span>:</span><br><span class="line">    Ideal = ideal(new_pol[:m-<span class="number">1</span>])</span><br><span class="line">    GB = Ideal.groebner_basis()</span><br><span class="line">    function_variables = var([<span class="built_in">str</span>(<span class="string">&#x27;y%d&#x27;</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1</span> + m)])</span><br><span class="line">    res = solve([pol(function_variables) <span class="keyword">for</span> pol <span class="keyword">in</span> GB], function_variables)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;got %d basis&#x27;</span> % <span class="built_in">len</span>(GB))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;solved result:&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    PRRR.&lt; x, y&gt; = PolynomialRing(QQ)</span><br><span class="line">    q = <span class="built_in">abs</span>(PRRR(res[<span class="number">0</span>][<span class="number">0</span>](x, y)).coefficients()[<span class="number">0</span>].denominator())</span><br><span class="line">    p = N[-<span class="number">1</span>] // q</span><br><span class="line"></span><br><span class="line">p = <span class="built_in">abs</span>(<span class="built_in">int</span>(p))</span><br><span class="line">q = n//p</span><br><span class="line">d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;755f85c2723bb39381c7379a604160d8&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Matrix"><a href="#Matrix" class="headerlink" title="Matrix"></a>Matrix</h3><p>题目来源：暂不明确</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># Problem by rec, with nothing.</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> secret</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"></span><br><span class="line">LEN = <span class="number">32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([a[i%<span class="built_in">len</span>(a)] ^^ b[i%<span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>(<span class="params">m: <span class="built_in">bytes</span>, pbits: <span class="built_in">int</span>, level: <span class="built_in">int</span>=<span class="number">0</span></span>):</span><br><span class="line">    p = getPrime(pbits)</span><br><span class="line">    M = random_matrix(GF(p), LEN).matrix_from_rows_and_columns(<span class="built_in">range</span>(LEN), <span class="built_in">range</span>(LEN-level))</span><br><span class="line">    c = vector(GF(p), m) * M</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;p&quot;</span>: p, <span class="string">&quot;M&quot;</span>: M.<span class="built_in">list</span>(), <span class="string">&quot;c&quot;</span>: c.<span class="built_in">list</span>()&#125;</span><br><span class="line"></span><br><span class="line">args = &#123;</span><br><span class="line">    <span class="string">&quot;chall1&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;m&quot;</span>: os.urandom(LEN),</span><br><span class="line">        <span class="string">&quot;pbits&quot;</span>: <span class="number">512</span>,</span><br><span class="line">        <span class="string">&quot;level&quot;</span>: <span class="number">0x00</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;chall2&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;m&quot;</span>: os.urandom(LEN),</span><br><span class="line">        <span class="string">&quot;pbits&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="string">&quot;level&quot;</span>: <span class="number">0x01</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;chall3&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;m&quot;</span>: os.urandom(LEN),</span><br><span class="line">        <span class="string">&quot;pbits&quot;</span>: <span class="number">256</span>,</span><br><span class="line">        <span class="string">&quot;level&quot;</span>: <span class="number">0x10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">out = <span class="built_in">dict</span>()</span><br><span class="line">enc = pad(secret.flag, LEN)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    out[<span class="string">f&quot;chall<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>&quot;</span>] = challenge(**args[<span class="string">f&quot;chall<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>&quot;</span>])</span><br><span class="line">    enc = xor(enc, hashlib.sha512(args[<span class="string">f&quot;chall<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>&quot;</span>][<span class="string">&quot;m&quot;</span>]).digest())</span><br><span class="line">out[<span class="string">&quot;enc&quot;</span>] = enc.<span class="built_in">hex</span>()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">f&quot;<span class="subst">&#123;out = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>梳理一下解密流程：</p>
<ul>
<li>先将flag串填充至32的整数倍</li>
<li>生成三组challenge需要的参数：m，pbits，level</li>
<li>将每一组的m用sha512加密后，依次与flag异或</li>
<li>给出每组challenge的对应输出与最终密文值</li>
</ul>
<p>其中，challenge的各个参数值在加密过程中的作用依次是：</p>
<ul>
<li>生成一个pbits的素数p，并以该p生成一个有限域Gf(p)</li>
<li>将m的32个随机字节转换成Gf(p)下的长度为32的向量</li>
<li>生成一个大小为32*(32-level)的矩阵M，M中元素均为Gf(p)中的随机数</li>
<li>计算c=m*M，并给出p、M和c</li>
</ul>
<p>因此，我们要做的就是由c、M反解出m，并计算其sha512值后与密文依次异或，就能得到明文，但是三次求解的方法由M的大小而产生不同。</p>
<h4 id="challenge1"><a href="#challenge1" class="headerlink" title="challenge1"></a>challenge1</h4><p>第一轮，M的大小为32*32，因此有：</p>
<script type="math/tex; mode=display">
m_{1\times 32}*M_{32\times 32} = c_{1\times 32}\quad(mod\;p)</script><p>可以看作是m的32个变量对应了32组方程，因此满秩，可以直接求解线性方程组(数据有点大，想要复现的师傅可以联系我)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p = </span><br><span class="line">M = []</span><br><span class="line">c = []</span><br><span class="line"></span><br><span class="line">c = vector(GF(p),c)</span><br><span class="line">m = matrix(GF(p),<span class="number">32</span>,<span class="number">32</span>,M)</span><br><span class="line">flag1 = m.solve_left(c)</span><br><span class="line">flag1 = <span class="built_in">bytes</span>(flag1)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="challenge2"><a href="#challenge2" class="headerlink" title="challenge2"></a>challenge2</h4><p>第二轮，M的大小为32*31，因此有：</p>
<script type="math/tex; mode=display">
m_{1\times 32}*M_{32\times 31} = c_{1\times 31}\quad(mod\;p)</script><p>也就是说，m的32个变量只有31组方程了，因此可以求出无穷多组解。不过由于只差一组方程，因此也只需要选取一个自由变量，并从c中对应减去其值后，解一个31变量的满秩方程。而判断解正确的依据就是解出来的m向量中所有值均在0-256之间。</p>
<p>说起来可能不那么明白，还是上个例子，这里以下面这个线性方程组简单说明一下：</p>
<script type="math/tex; mode=display">
m_{1\times 4}*M_{4\times 3} = c_{1\times 3}</script><p>写出来：</p>
<script type="math/tex; mode=display">
s = (x_1,x_2,x_3,x_4)*\left(
 \begin{matrix}
   m_{11} & m_{12} & m_{13}\\
   m_{21} & m_{22} & m_{23} \\
   m_{31} & m_{32} & m_{33} \\
   m_{41} & m_{42} & m_{43}  \\
  \end{matrix}
  \right)
  =(c_1,c_2,c_3)</script><p>变成方程组形式就是：</p>
<script type="math/tex; mode=display">
\begin{cases}
        m_{11}x_{1} + m_{21}x_{2} + m_{31}x_{3} + m_{41}x_{4} = c_1 \\
        m_{12}x_{1} + m_{22}x_{2} + m_{32}x_{3} + m_{42}x_{4} = c_2 \\ 
        m_{13}x_{1} + m_{23}x_{2} + m_{33}x_{3} + m_{43}x_{4} = c_3 
    \end{cases}</script><p>现在我们假设已经知道了x4的值(对应于题目中，就是在0-256中爆破)，那么把方程组中含x4的项都移到右边，就变成：</p>
<script type="math/tex; mode=display">
\begin{cases}
        m_{11}x_{1} + m_{21}x_{2} + m_{31}x_{3}  = c_1 - m_{41}x_{4}\\
        m_{12}x_{1} + m_{22}x_{2} + m_{32}x_{3}  = c_2 - m_{42}x_{4}\\ 
        m_{13}x_{1} + m_{23}x_{2} + m_{33}x_{3}  = c_3 - m_{43}x_{4}
    \end{cases}</script><p>接下来解的就是这个满秩方程：</p>
<script type="math/tex; mode=display">
s = (x_1,x_2,x_3)*\left(
 \begin{matrix}
   m_{11} & m_{12} & m_{13}\\
   m_{21} & m_{22} & m_{23} \\
   m_{31} & m_{32} & m_{33} 
  \end{matrix}
  \right)
  =(c_1 - m_{41}x_{4},c_2 - m_{42}x_{4},c_3 - m_{43}x_{4})</script><p>很容易想到，当解出的向量 $ (x_1,x_2,x_3)$ 均在0-256之间时，就正确求解了。放在本题中也不过是对这个例子的扩大而已，取x32进行爆破，方法是完全一样的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">p = </span><br><span class="line">M = []</span><br><span class="line">c = []</span><br><span class="line"></span><br><span class="line">c = vector(GF(p),c)</span><br><span class="line">m = matrix(GF(p),<span class="number">32</span>,<span class="number">31</span>,M)</span><br><span class="line">MM = m.delete_rows([<span class="number">31</span>])</span><br><span class="line">M_ = m[-<span class="number">1</span>]</span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">	cc = c - i * M_</span><br><span class="line">	ans = MM.solve_left(cc)</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">all</span>(ans[i] &lt;= <span class="number">256</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>)):</span><br><span class="line">		k = i</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">flag2 = <span class="built_in">bytes</span>(<span class="built_in">list</span>(ans)+[k])</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="challenge3"><a href="#challenge3" class="headerlink" title="challenge3"></a>challenge3</h4><p>第三轮，M的大小为32*16，因此有：</p>
<script type="math/tex; mode=display">
m_{1\times 32}*M_{32\times 16} = c_{1\times 16}\quad(mod\;p)</script><p>可以想到，如果继续用第二轮中的方法，那么需要爆破256的16次方种可能，数量级达到了2^128，是显然不可能的，所以需要另谋他法。而其实你应该早就想到了，m在每个challenge中，都是一个由32个0-256的值组成的向量。0-256意味着，<strong>在模p下这些值都很小</strong>，因此很自然地就会联想到格。</p>
<p>所以challenge3其实是一个格基规约问题，但是想构造出这样的格还是有点难度的。首先还是列出构造格需要的多个等式：</p>
<script type="math/tex; mode=display">
s = (x_1,x_2,...,x_{31},x_{32})*\left(
 \begin{matrix}
   m_{1,1} & m_{1,2} &... &m_{1,16}\\
   m_{2,1} & m_{2,2} &... &m_{2,16} \\
   & &...\\
   m_{31,1} & m_{31,2} &... &m_{31,16} \\
   m_{32,1} & m_{32,2} &... &m_{32,16}  \\
  \end{matrix}
  \right)
  =(c_1,c_2,...,c_{15},x_{16})\quad(mod\;p)</script><p>从这个矩阵乘法中，可以提取出其中的十六个等式：(i = 1,2,…,16)</p>
<script type="math/tex; mode=display">
m_{1,i}*x_1+m_{2,i}*x_2...+m_{31,i}*x_{31}+m_{32,i}*x_{32}+ k_i*p=c_i</script><p>以这些等式为基础，我们构造出下面的格：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MM = matrix(ZZ,<span class="number">32</span>,<span class="number">16</span>,M)</span><br><span class="line">E = diagonal_matrix([<span class="number">1</span>]*<span class="number">32</span>)</span><br><span class="line">P = diagonal_matrix([p]*<span class="number">16</span>)</span><br><span class="line">C = matrix(ZZ,c)</span><br><span class="line">L = block_matrix(ZZ,[[MM,E],[P,<span class="number">0</span>],[C,<span class="number">0</span>]])</span><br></pre></td></tr></table></figure>
<p>写清楚点就是：</p>
<script type="math/tex; mode=display">
\left(
 \begin{matrix}
   m_{1,1} & m_{1,2} &... &m_{1,16}   &1&0&...&0&0\\
   m_{2,1} & m_{2,2} &... &m_{2,16}   &0&1&...&0&0 \\
   & &...\\
   m_{31,1} & m_{31,2} &... &m_{31,16}&0&0&...&1&0\\
   m_{32,1} & m_{32,2} &... &m_{32,16}&0&0&...&0&1  \\
   p&0&...&0&0&0&...&0&0\\
   0&p&...&0&0&0&...&0&0\\
   &&...\\
   0&0&...&p&0&0&...&0&0\\
   c_1&c_2&...&c_{16}&0&0&...&0&0\\
  \end{matrix}
  \right)</script><p>这是一个49x48的矩阵，而我们用这个矩阵规约的依据等式是：</p>
<script type="math/tex; mode=display">
(x_1,x_2,...,x_{32},k_1,k_2,...,k_{16},-1)*
\left(
 \begin{matrix}
   m_{1,1} & m_{1,2} &... &m_{1,16}   &1&0&...&0&0\\
   m_{2,1} & m_{2,2} &... &m_{2,16}   &0&1&...&0&0 \\
   & &...\\
   m_{31,1} & m_{31,2} &... &m_{31,16}&0&0&...&1&0\\
   m_{32,1} & m_{32,2} &... &m_{32,16}&0&0&...&0&1  \\
   p&0&...&0&0&0&...&0&0\\
   0&p&...&0&0&0&...&0&0\\
   &&...\\
   0&0&...&p&0&0&...&0&0\\
   c_1&c_2&...&c_{16}&0&0&...&0&0\\
  \end{matrix}
  \right)
  =
  (0,0,...,0,x_1,x_2,...,x_{32})</script><p>可以看出，规约出的向量 $(0,0,…,0,x_1,x_2,…,x_{32})$ 是非常短的，因此LLL就能得到这个解(不过实际操作会发现满足要求的向量在第二行)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">p = </span><br><span class="line">M = []</span><br><span class="line">c = []</span><br><span class="line"></span><br><span class="line">MM = matrix(ZZ,<span class="number">32</span>,<span class="number">16</span>,M)</span><br><span class="line">E = diagonal_matrix([<span class="number">1</span>]*<span class="number">32</span>)</span><br><span class="line">P = diagonal_matrix([p]*<span class="number">16</span>)</span><br><span class="line">C = matrix(ZZ,c)</span><br><span class="line">L = block_matrix(ZZ,[[MM,E],[P,<span class="number">0</span>],[C,<span class="number">0</span>]])</span><br><span class="line">ML = L.LLL()</span><br><span class="line">ans = <span class="built_in">list</span>(ML[<span class="number">1</span>][<span class="number">16</span>:])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ans)):</span><br><span class="line">      ans[i] = -ans[i]</span><br><span class="line">flag3 = <span class="built_in">bytes</span>(ans)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="final"><a href="#final" class="headerlink" title="final"></a>final</h4><p>得到三个flag之后，进行sha512后依次与密文异或就好。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([a[i%<span class="built_in">len</span>(a)] ^^ b[i%<span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1</span></span><br><span class="line">p = </span><br><span class="line">c = vector(GF(p),c)</span><br><span class="line">m = matrix(GF(p),<span class="number">32</span>,<span class="number">32</span>,M)</span><br><span class="line">flag1 = m.solve_left(c)</span><br><span class="line">flag1 = <span class="built_in">bytes</span>(flag1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2</span></span><br><span class="line">p = <span class="number">661</span></span><br><span class="line">M = []</span><br><span class="line">c = []</span><br><span class="line"></span><br><span class="line">c = vector(GF(p),c)</span><br><span class="line">m = matrix(GF(p),<span class="number">32</span>,<span class="number">31</span>,M)</span><br><span class="line">MM = m.delete_rows([<span class="number">31</span>])</span><br><span class="line">M_ = m[-<span class="number">1</span>]</span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">	cc = c - i * M_</span><br><span class="line">	ans = MM.solve_left(cc)</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">all</span>(ans[i] &lt;= <span class="number">256</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>)):</span><br><span class="line">		k = i</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">flag2 = <span class="built_in">bytes</span>(<span class="built_in">list</span>(ans)+[k])</span><br><span class="line"></span><br><span class="line"><span class="comment">#part3</span></span><br><span class="line">p = </span><br><span class="line">M = []</span><br><span class="line">c = []</span><br><span class="line"></span><br><span class="line">MM = matrix(ZZ,<span class="number">32</span>,<span class="number">16</span>,M)</span><br><span class="line">E = diagonal_matrix([<span class="number">1</span>]*<span class="number">32</span>)</span><br><span class="line">P = diagonal_matrix([p]*<span class="number">16</span>)</span><br><span class="line">C = matrix(ZZ,c)</span><br><span class="line">L = block_matrix(ZZ,[[MM,E],[P,<span class="number">0</span>],[C,<span class="number">0</span>]])</span><br><span class="line">ML = L.LLL()</span><br><span class="line">ans = <span class="built_in">list</span>(ML[<span class="number">1</span>][<span class="number">16</span>:])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ans)):</span><br><span class="line">      ans[i] = -ans[i]</span><br><span class="line">flag3 = <span class="built_in">bytes</span>(ans)</span><br><span class="line"></span><br><span class="line"><span class="comment">#final</span></span><br><span class="line">c = <span class="number">0x72c0e8ef53c726969a91368ca600a081f38f5cfaa1d0669d9049f278fb2f0fb4f36dced86bf9b7e9ef59af082cc5a5b2458cae490ab23c0c8c5b9361499ae2e2</span></span><br><span class="line">enc = long_to_bytes(c)</span><br><span class="line">flag = [flag1,flag2,flag3]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    enc = xor(enc, hashlib.sha512(flag[i]).digest())</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;db1ebd0c-1cac-55d5-763e-b05f3d9af423&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="SSSMMM"><a href="#SSSMMM" class="headerlink" title="SSSMMM"></a>SSSMMM</h3><p>题目来源：2023福建省工控赛</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long, inverse</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">flag = pad(flag, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">ecc_table = &#123;</span><br><span class="line">    <span class="string">&#x27;n&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;p&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;g&#x27;</span>: <span class="string">&#x27;32c4ae2c1f1981195f9904466a39c9948fe30bbff2660be1715a4589334c74c7&#x27;</span></span><br><span class="line">         <span class="string">&#x27;bc3736a2f4f6779c59bdcee36b692153d0a9877cc62a474002df32e52139f0a0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TSM2</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, sk, ecc_table</span>):</span><br><span class="line">        self.ecc_table = ecc_table</span><br><span class="line">        self.n = <span class="built_in">int</span>(ecc_table[<span class="string">&#x27;n&#x27;</span>], <span class="number">16</span>)</span><br><span class="line">        self.para_len = <span class="built_in">len</span>(ecc_table[<span class="string">&#x27;n&#x27;</span>])</span><br><span class="line">        self.ecc_a3 = (<span class="built_in">int</span>(ecc_table[<span class="string">&#x27;a&#x27;</span>], base=<span class="number">16</span>) +</span><br><span class="line">                       <span class="number">3</span>) % <span class="built_in">int</span>(ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line"> </span><br><span class="line">        self.sk = sk</span><br><span class="line">        self.pk = self._kg(self.sk, ecc_table[<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self, data, K</span>):</span><br><span class="line">        e = data</span><br><span class="line">        d = self.sk</span><br><span class="line">        k = K</span><br><span class="line"> </span><br><span class="line">        P1 = self._kg(k, self.ecc_table[<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">        x = <span class="built_in">int</span>(P1[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">        R = ((e + x) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;n&#x27;</span>], base=<span class="number">16</span>))</span><br><span class="line">        <span class="keyword">if</span> R == <span class="number">0</span> <span class="keyword">or</span> R + k == <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;n&#x27;</span>], base=<span class="number">16</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        d_1 = <span class="built_in">pow</span>(</span><br><span class="line">            d+<span class="number">1</span>, <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;n&#x27;</span>], base=<span class="number">16</span>) - <span class="number">2</span>, <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;n&#x27;</span>], base=<span class="number">16</span>))</span><br><span class="line">        S = (d_1*(k + R) - R) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;n&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> S == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;%064x%064x&#x27;</span> % (R, S)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">self, Sign, data</span>):</span><br><span class="line">        r = <span class="built_in">int</span>(Sign[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">        s = <span class="built_in">int</span>(Sign[self.para_len:<span class="number">2</span> * self.para_len], <span class="number">16</span>)</span><br><span class="line">        e = <span class="built_in">int</span>(data.<span class="built_in">hex</span>(), <span class="number">16</span>)</span><br><span class="line">        t = (r + s) % self.n</span><br><span class="line">        <span class="keyword">if</span> t == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">        P1 = self._kg(s, self.ecc_table[<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">        P2 = self._kg(t, self.pk)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> P1 == P2:</span><br><span class="line">            P1 = <span class="string">&#x27;%s%s&#x27;</span> % (P1, <span class="number">1</span>)</span><br><span class="line">            P1 = self._double_point(P1)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            P1 = <span class="string">&#x27;%s%s&#x27;</span> % (P1, <span class="number">1</span>)</span><br><span class="line">            P1 = self._add_point(P1, P2)</span><br><span class="line">            P1 = self._convert_jacb_to_nor(P1)</span><br><span class="line"> </span><br><span class="line">        x = <span class="built_in">int</span>(P1[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">return</span> r == ((e + x) % self.n)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_kg</span>(<span class="params">self, k, Point</span>):</span><br><span class="line">        <span class="keyword">if</span> (k % self.n) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span> * <span class="number">128</span></span><br><span class="line">        Point = <span class="string">&#x27;%s%s&#x27;</span> % (Point, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        mask_str = <span class="string">&#x27;8&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.para_len - <span class="number">1</span>):</span><br><span class="line">            mask_str += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        mask = <span class="built_in">int</span>(mask_str, <span class="number">16</span>)</span><br><span class="line">        Temp = Point</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(self.para_len * <span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> flag:</span><br><span class="line">                Temp = self._double_point(Temp)</span><br><span class="line">            <span class="keyword">if</span> (k &amp; mask) != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> flag:</span><br><span class="line">                    Temp = self._add_point(Temp, Point)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    flag = <span class="literal">True</span></span><br><span class="line">                    Temp = Point</span><br><span class="line">            k = k &lt;&lt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self._convert_jacb_to_nor(Temp)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_double_point</span>(<span class="params">self, Point</span>):</span><br><span class="line">        l = <span class="built_in">len</span>(Point)</span><br><span class="line">        len_2 = <span class="number">2</span> * self.para_len</span><br><span class="line">        <span class="keyword">if</span> l &lt; self.para_len * <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x1 = <span class="built_in">int</span>(Point[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">            y1 = <span class="built_in">int</span>(Point[self.para_len:len_2], <span class="number">16</span>)</span><br><span class="line">            <span class="keyword">if</span> l == len_2:</span><br><span class="line">                z1 = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                z1 = <span class="built_in">int</span>(Point[len_2:], <span class="number">16</span>)</span><br><span class="line"> </span><br><span class="line">            T6 = (z1 * z1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (y1 * y1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (x1 + T6) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T4 = (x1 - T6) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T3 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (y1 * z1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T4 = (T2 * <span class="number">8</span>) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T5 = (x1 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T1 * <span class="number">3</span>) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T6 = (T6 * T6) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T6 = (self.ecc_a3 * T6) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T1 + T6) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            z3 = (T3 + T3) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (T1 * T1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (T2 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            x3 = (T3 - T5) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (T5 % <span class="number">2</span>) == <span class="number">1</span>:</span><br><span class="line">                T4 = (T5 + ((T5 + <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)) &gt;&gt; <span class="number">1</span>) - T3) % <span class="built_in">int</span>(</span><br><span class="line">                    self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                T4 = (T5 + (T5 &gt;&gt; <span class="number">1</span>) - T3) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line"> </span><br><span class="line">            T1 = (T1 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            y3 = (T1 - T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line"> </span><br><span class="line">            form = <span class="string">&#x27;%%0%dx&#x27;</span> % self.para_len</span><br><span class="line">            form = form * <span class="number">3</span></span><br><span class="line">            <span class="keyword">return</span> form % (x3, y3, z3)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_add_point</span>(<span class="params">self, P1, P2</span>):</span><br><span class="line">        <span class="keyword">if</span> P1 == <span class="string">&#x27;0&#x27;</span> * <span class="number">128</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;%s%s&#x27;</span> % (P2, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> P2 == <span class="string">&#x27;0&#x27;</span> * <span class="number">128</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;%s%s&#x27;</span> % (P1, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        len_2 = <span class="number">2</span> * self.para_len</span><br><span class="line">        l1 = <span class="built_in">len</span>(P1)</span><br><span class="line">        l2 = <span class="built_in">len</span>(P2)</span><br><span class="line">        <span class="keyword">if</span> (l1 &lt; len_2) <span class="keyword">or</span> (l2 &lt; len_2):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            X1 = <span class="built_in">int</span>(P1[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">            Y1 = <span class="built_in">int</span>(P1[self.para_len:len_2], <span class="number">16</span>)</span><br><span class="line">            <span class="keyword">if</span> l1 == len_2:</span><br><span class="line">                Z1 = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                Z1 = <span class="built_in">int</span>(P1[len_2:], <span class="number">16</span>)</span><br><span class="line">            x2 = <span class="built_in">int</span>(P2[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">            y2 = <span class="built_in">int</span>(P2[self.para_len:len_2], <span class="number">16</span>)</span><br><span class="line"> </span><br><span class="line">            T1 = (Z1 * Z1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (y2 * Z1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (x2 * T1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T1 * T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (T3 - X1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (T3 + X1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T4 = (T2 * T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T1 - Y1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            Z3 = (Z1 * T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (T2 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (T3 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T5 = (T1 * T1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T4 = (X1 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            X3 = (T5 - T3) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (Y1 * T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (T4 - X3) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T1 * T3) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            Y3 = (T1 - T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line"> </span><br><span class="line">            form = <span class="string">&#x27;%%0%dx&#x27;</span> % self.para_len</span><br><span class="line">            form = form * <span class="number">3</span></span><br><span class="line">            <span class="keyword">return</span> form % (X3, Y3, Z3)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_convert_jacb_to_nor</span>(<span class="params">self, Point</span>):</span><br><span class="line">        len_2 = <span class="number">2</span> * self.para_len</span><br><span class="line">        x = <span class="built_in">int</span>(Point[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">        y = <span class="built_in">int</span>(Point[self.para_len:len_2], <span class="number">16</span>)</span><br><span class="line">        z = <span class="built_in">int</span>(Point[len_2:], <span class="number">16</span>)</span><br><span class="line">        z_inv = <span class="built_in">pow</span>(</span><br><span class="line">            z, <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>) - <span class="number">2</span>, <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>))</span><br><span class="line">        z_invSquar = (z_inv * z_inv) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        z_invQube = (z_invSquar * z_inv) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        x_new = (x * z_invSquar) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        y_new = (y * z_invQube) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        z_new = (z * z_inv) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> z_new == <span class="number">1</span>:</span><br><span class="line">            form = <span class="string">&#x27;%%0%dx&#x27;</span> % self.para_len</span><br><span class="line">            form = form * <span class="number">2</span></span><br><span class="line">            <span class="keyword">return</span> form % (x_new, y_new)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak</span>(<span class="params">start, bits, k</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">bin</span>(k)[<span class="number">2</span>:][-start-bits:-start],<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">sk = getrandbits(<span class="number">256</span>) % <span class="built_in">int</span>(ecc_table[<span class="string">&#x27;n&#x27;</span>], <span class="number">16</span>)</span><br><span class="line">sm2 = TSM2(sk, ecc_table)</span><br><span class="line">start = <span class="number">130</span></span><br><span class="line">bits = <span class="number">7</span></span><br><span class="line">num = <span class="number">50</span></span><br><span class="line"></span><br><span class="line">sigs = []</span><br><span class="line">L = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">    msg = getrandbits(<span class="number">256</span>) % <span class="built_in">int</span>(ecc_table[<span class="string">&#x27;n&#x27;</span>], <span class="number">16</span>)</span><br><span class="line">    k = getrandbits(<span class="number">256</span>) % <span class="built_in">int</span>(ecc_table[<span class="string">&#x27;n&#x27;</span>], <span class="number">16</span>)</span><br><span class="line">    leaks=leak(start, bits, k)</span><br><span class="line">    L.append(leaks)</span><br><span class="line">    sigs.append(sm2.sign(msg, k))</span><br><span class="line"></span><br><span class="line">key = hashlib.md5(<span class="built_in">str</span>(sk).encode()).digest()</span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">enc = aes.encrypt(flag)</span><br><span class="line"><span class="built_in">print</span>(sigs)</span><br><span class="line"><span class="built_in">print</span>(L)</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[&#x27;1de6f33a8366acbdd0b87ec7beb59e429936b43bae9b8ee2538d2b97d6640c70143fa04e7f1880d22b0e9cbce938edd880d69fc4ed9a6315abd905880a8d38f7&#x27;, &#x27;9d5f8a16fe8d951cbab0a6dca86427286ca389aca6497f20ca3421fa0aa27f4ddf2db6c58229182eaccca41bfebf56961ff1f683ba94b81137c41f61c98c1368&#x27;, &#x27;4d20e1aa4e4f6a4948158fabbdadec3c4d6049b6439981efcb70900d954d0a8f18bce67831d426c12726c321e6eb69e8708739fc74bfde6ad601433bcd896ca7&#x27;, &#x27;e5358c986a12ec11bcd495e8822c5a71b2545dc11ce09521edaa47c11b739b12bbe76ca89bd08beb969355dec56dfcdd6cff121bb61eaea148d25e9a6e428145&#x27;, &#x27;fb06d41eafbcc77d464fe41ca356641cbb92289d28b0ff37caad95619c34557969acf9f615214f3ecf6c15943fc63470da0785687ae535045145d5e161a69210&#x27;, &#x27;2e97f02e82642c033af0fc9686788c1acd8841b65228fab3e66f5328e790d702edadb13e99ed1d411482cd913ec6730803e6fcff29206d9e1fc1b68e1f631e25&#x27;, &#x27;4f1ffd080380e945b24596135e5772058ee8adc26272ed3147f0701063b4b9f435e5ac679ef2cd950332ea5139d64ffee7f1211ea64c5beffa162bb942683fac&#x27;, &#x27;0882c54ba0409f28ab3907831eedab320bf3645fd70888266393704f81998ed57778912ededb54c58efd6fc9f22188566824ae312d4585f87d37339fd87827e6&#x27;, &#x27;9dafe7cee839389cbd5a72ac17befad3228b47192ed3a94a319eef67704c094adfeca2f14a1cea54540e7d69c6033c53fdbe60969cc910b31b1fce8c9d6a9d5b&#x27;, &#x27;627357126622ad1b76354b4f6974120f670baf035e24599e36c9f14527f225e6acb0e00482c3ab7442858070181eb3a7fc4acd8de5e5411aa482b094c6e1a1fa&#x27;, &#x27;a9c7c29b800677ac44427204bc2137f0641465a411a521d3567911ab364c426c7a340ad1dcddb2330667bc78925bbec8bfd47cbf8031496e468f5ff3f9cc8a71&#x27;, &#x27;23429d961d3bcf2e4873379afba581b351441c2d33c37c1fb5e84cdc22045a99bac91b3d8e3c90de3d56d443e439246872ab8fbd4ff42fbbd37509f79ccedd6e&#x27;, &#x27;2847983b8f9492fe88c988d04b8086b94d8f827684e10cf2d4db1f5c65c1a7354c6e15df548df379ea5a56b57de9e36faf36c8d05270dc4bf69577ecbb5c1300&#x27;, &#x27;c684e4714cd002abea6fa5bd23014a152cf358ab848179fdc29f1b79b090b42c550ea43718e3e2c4bea2ece080db41fb9433539cac0b8ac8e419bcdbb6477017&#x27;, &#x27;34e969156c0ff98ccff9dbe2757a365e24e81857937cc3056a1b837d67a5bc0215c99aa15ac8150c6cee089623000104017ac535ef3a7fd10bb46b008e64bf12&#x27;, &#x27;b79275b644dd73661b947fb786054b114fc90bcdf19cdd2a4cc96c426a3581d854619d95c3b9864534f9fe66445336e55c1a79527825706500527392ebac7ba6&#x27;, &#x27;f7302bd4f492be0537536a5327dab593b903346a5e32bf0262f494f11bb3968a736ae1a90abebe7ab600d899b001e8e4704117b862cf7787df29b1b8cda76227&#x27;, &#x27;e7d378b1f273baaaab041d3d81d669a351abe21d5987403fbb7d35f957a82ebcf0ffbbef77a08c1807d6e19d33053a62801f151bb81d0179bdb09fefd45a845d&#x27;, &#x27;8c8dddfe7c2ee295c4aad0f207517cb00a5870c93c38af0e7438510f80b6788f7e863da10ec0650ab661ead1ae799dc63d3f7115c018a1d1961a068cff25ff21&#x27;, &#x27;7382adaeab3aaed04178cf90bcb2750e11498f17dda2e058bbed931e9ff55faaa3fcc5af423ac139fd936fff916c78a5de316e67b5226d804e2590c65ad191c8&#x27;, &#x27;70385b3c8fa2fd47be6963683256ebcbf2eb0a81f76856cb9524d59dcc1f910f98b0c37687857da008c6901fd78a9cf3b8b0ea9d744c8ab3b3d1b70277372572&#x27;, &#x27;13f510e214b5bb7dbb81fadd772835f6fd0f082252ab775ab72c1b62b1573466a39d634f428202dd67bb4cdbb692a2a5dd148a49504d021d4aa5d903fac02cb1&#x27;, &#x27;0910c842616b8b4c7f2ab265172e1d682a89b79f97019473d517b606dd43999e343ad4b08a71b69a1f4ffc8db39f7deb0a3c51c44652b1c63e090d901f43b33d&#x27;, &#x27;7129bd6c31cc1e7f480fa713d9ba5386fdac580593229ca77baf96ea41e87fcd5b4c83693fc4b6b37959fc80391e05b279acad320fbd03e1c332e4cedc86a5b7&#x27;, &#x27;b6b80ce7dfe5a9fe066fce563a486c4a5f07611ab484131faf9381dc794a329390c60b53080d8360903f5759a18a1eca1b265655ef43ca213544c31e99fe0087&#x27;, &#x27;7bfdca43b8d21d48e18dae387ea95c4ba690bff5fe22f3a29637c196a2288fdde98ec73554123dc33c8af567c7b98f9775600a0e34f32eae62655b47a0182171&#x27;, &#x27;b93eb6af65de700306b7a22816a1d461451c694de5ce55464be57cce89e8349f81a6d3fcc52da72c5d14df88bbe5ff683b591788d3edc91006a99ed1171ecce0&#x27;, &#x27;1ab26e7f8a1e8854a73f2904d781f9f551d5b325fea4ec3f7ec45a03fc8d0b087b054f6475c21a473f5b47d6a980539b6a0aaf207bf89b3cc46eaf7fbf63411d&#x27;, &#x27;bea21a265e48c2624ba85137392dde1971325909fdfb97f57397f422cd6a152ef75c99b0634d6863aa4d7b4f07648d10c7ed3eeb210dc86691d0e2b463471ba8&#x27;, &#x27;e49e1b08e4865d8da0a278c049b2826a6b97911adbdaa836fd57f509f96db436327318bbf82c98b8d9f607e99c48db663473e4e941eb6109b174375a157eeb60&#x27;, &#x27;72f00c548fc2539a8914b135b80a37e5137fa267579bcf11b566d4c44ee57defced7d0d3a2ec9923aa2790e80ac61a151b79e7b2dd17accbc7dd66c8e41d7489&#x27;, &#x27;c0d86918879d4ccfa4adf3fbd449c9b26a17b61073221a15d576e9528e0e29fcf3b164020043ac2a5752768ac996fa15e551c36dfd6c1dbf0d24d81d2e5b6724&#x27;, &#x27;ffd6eca8075af0c4fe4f38d4b3950ed76a4cc1474eadbd65b38484138456a98a4f4cc697c2d455d386e432679722f32cc59d1aa5135eb72cb10b5a82380b4e71&#x27;, &#x27;a3407cb209c1a6788ba1ca992a7b6cc04ef1130f92be63b9738dae873f3e407b440788115edd81ef3c2e791e10798c3fd1830ca5b4773523ef246cf13fbd5a5c&#x27;, &#x27;3b1fe148835ebeece99b0df444cb2705e195d5d364fdbaf2fa754797c8f7484461327d471b258f9b0b5dcfb757a08d50b0ac334154fd6d4d0d68c2a846de4163&#x27;, &#x27;cc12da7bed20a53b5af9eebae5a94177f745ed5d48c4690cb462c498019e6a516b52cc9953620c04e12a79b45e99fc8164a79f00268c648801824a690a01b78f&#x27;, &#x27;e4e36894a7323e5fb1dc54366acd4fd3f6d9ec2817bd1c153d3d84ed544893d6f5c8a7fe839acf4880eb8df6c8ced3f2f7d947835a496da7b010bf6c5b04d669&#x27;, &#x27;a365dd19731e2d0ad844856da269d53a895ddcf5195b16f4e858ba4f83d99f2bbc49f7e7f61a431297545a3c9f3b99815a5a9645f83b1ac3acf1ca61481812fd&#x27;, &#x27;0feb0860a5f6f2eaffc35e02a63633335b702e8bb1ef5c24dc82848cf3145149f4cede4352366db459784fa843ba0a20cec648b2674704bfe8facc2eb97a0fc5&#x27;, &#x27;47c15d55e9a7f31ad5566213f8d0bdb6c4082b3dc2506f6d9d55af00fefe41a8c7ebe0255430efc5f6e7f5858fadd8478959afaf23ed57871ff78c676d0a1cd0&#x27;, &#x27;c15d5a156453862bd6d7d3634dbbc711fcbe38e04a71cec69ff936347417fe439343f93a0a0a0d51712ce44fa277861cee82c350341fe00c28448e3fc6956cfa&#x27;, &#x27;42a93a785ff208608b4deeac184a7f882e75c9d45e5c1fec6c4cd08f5efe08c27d5a670676e4c8697ad0813b02fe50f19e7a0bf189716a2796b9804f737d5a98&#x27;, &#x27;33e06326cc15e21e9a7d2f5b45facd397d9ef13315bb792356432fcb63e22ce15f1da0a8db378660ee1b8ce9286f772663f16da0cf6bbce149392d50e24096cc&#x27;, &#x27;1c11c1cbd0b3e468b7671c2ad1030506542935716c27cd0e241bc68144390a615f50af737bc2da9a72872ebae750e962a225d0dff561d879f919d187f95e4878&#x27;, &#x27;d96905497145789b9734797625ede70eafcb8fc5eedbac4278091aba0d7c4b2bfe74e97ef5f966c1a3b408d91a36290a94027677c8b02d62e1a2b6498550c61a&#x27;, &#x27;ab5accec0103e2809ff5a59c8b3ac3d1426441981f8c6413003c4b69494f54d1cc7d6bf352373c2d60f8aa3b0b2236d2ae150b02bea2f5d353e9b3400519be8e&#x27;, &#x27;341cd45d80593cf158aac070433333500633f6bca596ea07b758729f7f1c2c9391a9dfa56bfd6810b2e21b0009fc84e4a309805288ace599b80eabe35feaebc7&#x27;, &#x27;944769dafb279eb7998d136427e894cba7fb2fbc7f13e4137eabfaaec26f0bdc0779c212756e5c0ac849d285a5b6900174d2042759eeb1d3f5b0e49c58176e2c&#x27;, &#x27;2dfaea9976d6d33109c778e28acb0647a01a4abff01df29b35d51b2359cccc75bac8772de117a47c64821566087de13bd8ab16f72e189c7a934b19b56734fee0&#x27;, &#x27;c613ddab5dd81096088f185a1ead16ea0e6d99facd0249535b4327e11bd53fac5fd1b3807fef181a93cc048dbd4387e64c8281ead7bf2a28970739900633b7ad&#x27;]</span></span><br><span class="line"><span class="string">[87, 18, 88, 63, 30, 66, 60, 85, 13, 82, 35, 28, 21, 74, 47, 6, 30, 111, 97, 51, 42, 61, 92, 70, 113, 43, 7, 21, 68, 10, 99, 57, 87, 51, 43, 44, 60, 39, 117, 6, 88, 48, 47, 51, 56, 91, 6, 29, 92, 82]</span></span><br><span class="line"><span class="string">b&#x27;s\xda\xed\r\x8e/\xde\xa4\x99\x93\xcdCBB\x1c\xae\xcbB\x9f\xdd\xd4\x96\x9f\xa5O\xbf\x16\xa4\xecL\xe7J\x97\x1a\xdf\xa1\xa1\x92i,\xdd\x8a\xb6\xcfp&#125;ho&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>题目实现了一个代码很长的椭圆曲线类，不过注意到类中某个函数名：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_convert_jacb_to_nor</span>(<span class="params">self, Point</span>)</span><br></pre></td></tr></table></figure>
<p>而从其他地方了解过，椭圆曲线有一种基于雅可比坐标的计算，可以增加运算效率。具体可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/87490028">椭圆曲线—雅可比坐标 - 知乎 (zhihu.com)</a></p>
<p>那么这些函数应该就是雅可比坐标意义下的点加法和倍乘法的实现，所以可以不用去理解坐标的计算过程，直接把这个ecc_table中的各参数用sage中的标准ECC表示即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ecc_table1 = &#123;</span><br><span class="line">    <span class="string">&#x27;n&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;p&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;gx&#x27;</span>: <span class="string">&#x27;32c4ae2c1f1981195f9904466a39c9948fe30bbff2660be1715a4589334c74c7&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;gy&#x27;</span>: <span class="string">&#x27;bc3736a2f4f6779c59bdcee36b692153d0a9877cc62a474002df32e52139f0a0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ecc1 = EllipticCurve(GF(<span class="built_in">int</span>(ecc_table1[<span class="string">&#x27;p&#x27;</span>],<span class="number">16</span>)),[<span class="built_in">int</span>(ecc_table1[<span class="string">&#x27;a&#x27;</span>],<span class="number">16</span>),<span class="built_in">int</span>(ecc_table1[<span class="string">&#x27;b&#x27;</span>],<span class="number">16</span>)])</span><br><span class="line">g1 = ecc1((<span class="built_in">int</span>(ecc_table1[<span class="string">&#x27;gx&#x27;</span>],<span class="number">16</span>),<span class="built_in">int</span>(ecc_table1[<span class="string">&#x27;gy&#x27;</span>],<span class="number">16</span>)))</span><br></pre></td></tr></table></figure>
<p>而可以验证，给出的g点是一个满足阶等于曲线阶的生成元，n也就是曲线的阶，并且是一个素数。把ECC这一层理解清楚之后，就明白其实很长一段代码都是不太需要理解的。</p>
<p>因此我们直接来看题目核心的加密任务：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">leak</span>(<span class="params">start, bits, k</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">bin</span>(k)[<span class="number">2</span>:][-start-bits:-start],<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">sk = getrandbits(<span class="number">256</span>) % <span class="built_in">int</span>(ecc_table[<span class="string">&#x27;n&#x27;</span>], <span class="number">16</span>)</span><br><span class="line">sm2 = TSM2(sk, ecc_table)</span><br><span class="line">start = <span class="number">130</span></span><br><span class="line">bits = <span class="number">7</span></span><br><span class="line">num = <span class="number">50</span></span><br><span class="line"></span><br><span class="line">sigs = []</span><br><span class="line">L = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">    msg = getrandbits(<span class="number">256</span>) % <span class="built_in">int</span>(ecc_table[<span class="string">&#x27;n&#x27;</span>], <span class="number">16</span>)</span><br><span class="line">    k = getrandbits(<span class="number">256</span>) % <span class="built_in">int</span>(ecc_table[<span class="string">&#x27;n&#x27;</span>], <span class="number">16</span>)</span><br><span class="line">    leaks=leak(start, bits, k)</span><br><span class="line">    L.append(leaks)</span><br><span class="line">    sigs.append(sm2.sign(msg, k))</span><br><span class="line"></span><br><span class="line">key = hashlib.md5(<span class="built_in">str</span>(sk).encode()).digest()</span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">enc = aes.encrypt(flag)</span><br><span class="line"><span class="built_in">print</span>(sigs)</span><br><span class="line"><span class="built_in">print</span>(L)</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br></pre></td></tr></table></figure>
<p>可以看到，给出了一个leak函数，它可以泄露一个数k的中间130-136比特，共7比特。然后题目给出了如下加密过程：</p>
<ul>
<li>随机生成一个数sk，并以其作为私钥生成一个TSM2的类对象sm2</li>
<li>进行50次基于ECC的变种签名操作，并给出每一次的临时密钥(nonce)k的leak，以及每一次的签名值(R,S)</li>
<li>用私钥sk作为AES密钥，对flag进行加密，并给出密文</li>
</ul>
<p>那么思路就是从50次签名操作的泄露信息中，还原出私钥sk，并解AES得到flag。因此我们主要关注签名操作：</p>
<ul>
<li>计算kg的横坐标作为x，其中g为给定的生成元，k为该次签名的临时密钥(nonce)</li>
<li>计算</li>
</ul>
<script type="math/tex; mode=display">
R = msg + x \quad (mod\;n)</script><ul>
<li>计算(n是一个素数，所以可以由费马小定理推出下式)</li>
</ul>
<script type="math/tex; mode=display">
d_1 = (sk+1)^{-1} \quad(mod\;n)</script><ul>
<li>计算</li>
</ul>
<script type="math/tex; mode=display">
S = (sk+1)^{-1}(k+R) - R \quad(mod\;n)</script><p>然后将(R,S)作为本次签名值返回，并每次泄漏k的中间7比特。</p>
<p>其实看到比特泄漏就能想到应该是构造HNP求解，那么什么是我们需要的短向量呢？</p>
<p>首先注意到，每一次的临时密钥k可以写成如下形式：</p>
<script type="math/tex; mode=display">
k_i = 2^{137}k_{hi} + 2^{130}k_{leaki} + k_{li}</script><p>也就是把k分成三部分，高位、leak位和低位，其中高位和低位是未知的，其比特数大概为119比特和130比特。而这就是我们构造HNP的关键，<strong>短向量中要有每个临时密钥的高位和低位！</strong>而我们只要能恢复任何一个临时密钥k，我们就可以通过S的签名式，计算出sk的值。</p>
<p>而显然我们需要根据S的这个等式构造格：</p>
<script type="math/tex; mode=display">
S = (sk+1)^{-1}(k+R) - R \quad(mod\;n)</script><p>如何构造呢？我们简单变形一下：</p>
<p>移项，并乘逆元至左端：</p>
<script type="math/tex; mode=display">
(S_i+R_i)(sk+1) = k_i+R_i \quad(mod\;n)</script><p>再移个项，这样做是为了把k置于一端，其他置于另一端：</p>
<script type="math/tex; mode=display">
(S_i+R_i)(sk+1)-R_i = k_i \quad(mod\;n)</script><p>然后我们知道，sk是一个256比特的量，我们是不希望他出现在规约后的结果中的，因此想办法联立两个式子把他消去，这里我们取i=0与i!=0的式子做消除，如下：</p>
<script type="math/tex; mode=display">
(S_0+R_0)(sk+1)-R_0 = k_0 \quad(mod\;n)</script><script type="math/tex; mode=display">
(S_i+R_i)(sk+1)-R_i = k_i \quad(mod\;n)</script><p>上下各自乘上对应系数：</p>
<script type="math/tex; mode=display">
(S_i+R_i)(S_0+R_0)(sk+1)-(S_i+R_i)R_0 = (S_i+R_i)k_0 \quad(mod\;n)</script><script type="math/tex; mode=display">
(S_0+R_0)(S_i+R_i)(sk+1)-(S_0+R_0)R_i = (S_0+R_0)k_i \quad(mod\;n)</script><p>作差：</p>
<script type="math/tex; mode=display">
R_i(S_0+R_0)-(S_i+R_i)R_0 = (S_i+R_i)k_0 - (S_0+R_0)k_i \quad(mod\;n)</script><p>左边是个已知的数字，为了表示方便，我们把这个先写成一个简单形式bi：</p>
<script type="math/tex; mode=display">
b_i = R_i(S_0+R_0)-(S_i+R_i)R_0</script><p>即：</p>
<script type="math/tex; mode=display">
b_i= (S_i+R_i)k_0 - (S_0+R_0)k_i \quad(mod\;n)</script><p>然后为了找到HNP的形式，我们继续移一下项：</p>
<script type="math/tex; mode=display">
(S_0+R_0)k_i = (S_i+R_i)k_0 - b_i \quad(mod\;n)</script><p>此时我们把k展开为三部分形式：</p>
<script type="math/tex; mode=display">
(S_0+R_0)(2^{137}k_{hi} + 2^{130}k_{leaki} + k_{li}) = (S_i+R_i)(2^{137}k_{h0} + 2^{130}k_{leak0} + k_{l0}) - b_i \quad(mod\;n)</script><p>然后由于kleak已知，那么又可以剔出一部分常量：</p>
<script type="math/tex; mode=display">
2^{130}k_{leaki}(S_0+R_0) + (S_0+R_0)(2^{137}k_{hi} + k_{li}) = 2^{130}k_{leak0}(S_i+R_i) + (S_i+R_i)(2^{137}k_{h0} + k_{l0}) - b_i \quad(mod\;n)</script><p>移项：</p>
<script type="math/tex; mode=display">
(S_0+R_0)(2^{137}k_{hi} + k_{li}) =  (S_i+R_i)(2^{137}k_{h0} + k_{l0}) + 2^{130}k_{leak0}(S_i+R_i) - 2^{130}k_{leaki}(S_0+R_0) - b_i \quad(mod\;n)</script><p>然后为了表示方便，更新一下bi：</p>
<script type="math/tex; mode=display">
b_i = 2^{130}k_{leak0}(S_i+R_i) - 2^{130}k_{leaki}(S_0+R_0) - b_i</script><p>那么又有：</p>
<script type="math/tex; mode=display">
(S_0+R_0)(2^{137}k_{hi} + k_{li}) = (S_i+R_i)(2^{137}k_{h0} + k_{l0}) + b_i \quad(mod\;n)</script><p>然后我们把(S0+R0)乘到右边去：</p>
<script type="math/tex; mode=display">
(2^{137}k_{hi} + k_{li}) = (S_i+R_i)(S_0+R_0)^{-1}(2^{137}k_{h0} + k_{l0}) + b_i(S_0+R_0)^{-1} \quad(mod\;n)</script><p>此时，应该可以发现HNP形式了，我们令：</p>
<script type="math/tex; mode=display">
A_i = (S_i+R_i)(S_0+R_0)^{-1}</script><script type="math/tex; mode=display">
B_i = b_i(S_0+R_0)^{-1}</script><p>则有：</p>
<script type="math/tex; mode=display">
(2^{137}k_{hi} + k_{li}) = A_i(2^{137}k_{h0} + k_{l0}) + B_i \quad(mod\;n)</script><p>把模n去掉，写成等式形式：</p>
<script type="math/tex; mode=display">
(2^{137}k_{hi} + k_{li}) + t_in = A_i(2^{137}k_{h0} + k_{l0}) + B_i</script><p>那么我们就可以根据这个等式构造格，请注意我们构造格的目的是想要kh与kl在规约出的向量中，因此构造如下格：</p>
<script type="math/tex; mode=display">
\left(
 \begin{matrix}
   n  &   & &   &0&&&&&&\\
   &n &  &  &&0&&&&& \\
   &  &...&& &&...&&&&\\
   &  &&n &&&&&&&0  \\

   2^{137}&&&&2^{11}&&&&&&\\
   &2^{137}&&&&2^{11}&&&&&\\
   &&...&&&&...&&&&\\
   &&&2^{137}&&&&2^{11}&&&\\

   -2^{137}A_1&-2^{137}A_2&...&-2^{137}A_{49}&&&&&2^{11}&&\\
   -A_1&-A_2&...&-A_{49}&&&...&&&1&\\
   -B_1&-B_2&...&-B_{49}&&&...&&&&2^{130}\\
  \end{matrix}
  \right)</script><p>这样写可能有点不太清楚，直接上分块矩阵的代码好明白一点：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">length = <span class="number">50</span></span><br><span class="line"></span><br><span class="line">O = matrix(ZZ,(length-<span class="number">1</span>),(length-<span class="number">1</span>)+<span class="number">3</span>)</span><br><span class="line">E = diagonal_matrix([<span class="number">2</span>^<span class="number">11</span>]*((length-<span class="number">1</span>)+<span class="number">3</span>))</span><br><span class="line">T1 = diagonal_matrix([n]*((length-<span class="number">1</span>)))</span><br><span class="line">T2 = matrix(ZZ,(length-<span class="number">1</span>)+<span class="number">3</span>,length-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length-<span class="number">1</span>):</span><br><span class="line">    T2[i,i] = <span class="number">2</span>^<span class="number">137</span></span><br><span class="line">    T2[-<span class="number">1</span>,i] = -B[i]</span><br><span class="line">    T2[-<span class="number">2</span>,i] = -A[i]</span><br><span class="line">    T2[-<span class="number">3</span>,i] = -A[i] * <span class="number">2</span>^<span class="number">137</span></span><br><span class="line"></span><br><span class="line">L = block_matrix(ZZ,[[T1,O],[T2,E]])</span><br><span class="line"></span><br><span class="line">K = <span class="number">2</span>^<span class="number">130</span></span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = K</span><br><span class="line">L[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">L[-<span class="number">3</span>,-<span class="number">3</span>] = <span class="number">2</span>^<span class="number">11</span></span><br></pre></td></tr></table></figure>
<p>把刚才的格记为L，对该格有如下线性关系：</p>
<script type="math/tex; mode=display">
(t_1,t_2,...,t_{49},k_{h1},k_{h2},...k_{h49},k_{h0},k_{l0},1)L = (k_{l1},k_{l2},...,k_{49},2^{11}k_{h1},2^{11}k_{h2},...2^{11}k_{h49},2^{11}k_{h0},k_{l0},2^{130})</script><p>如此一来规约出的向量数量级相当，均为2^130比特左右，因此对L进行规约有机会找到这个向量，从而恢复k，进而解密出sk。</p>
<p>事实上，采用BKZ算法，该向量会出现在每项均非0的第一行，问题得解</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">ecc_table1 = &#123;</span><br><span class="line">    <span class="string">&#x27;n&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;p&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;gx&#x27;</span>: <span class="string">&#x27;32c4ae2c1f1981195f9904466a39c9948fe30bbff2660be1715a4589334c74c7&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;gy&#x27;</span>: <span class="string">&#x27;bc3736a2f4f6779c59bdcee36b692153d0a9877cc62a474002df32e52139f0a0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ecc1 = EllipticCurve(GF(<span class="built_in">int</span>(ecc_table1[<span class="string">&#x27;p&#x27;</span>],<span class="number">16</span>)),[<span class="built_in">int</span>(ecc_table1[<span class="string">&#x27;a&#x27;</span>],<span class="number">16</span>),<span class="built_in">int</span>(ecc_table1[<span class="string">&#x27;b&#x27;</span>],<span class="number">16</span>)])</span><br><span class="line">g1 = ecc1((<span class="built_in">int</span>(ecc_table1[<span class="string">&#x27;gx&#x27;</span>],<span class="number">16</span>),<span class="built_in">int</span>(ecc_table1[<span class="string">&#x27;gy&#x27;</span>],<span class="number">16</span>)))</span><br><span class="line"></span><br><span class="line">sigs = [<span class="string">&#x27;1de6f33a8366acbdd0b87ec7beb59e429936b43bae9b8ee2538d2b97d6640c70143fa04e7f1880d22b0e9cbce938edd880d69fc4ed9a6315abd905880a8d38f7&#x27;</span>, <span class="string">&#x27;9d5f8a16fe8d951cbab0a6dca86427286ca389aca6497f20ca3421fa0aa27f4ddf2db6c58229182eaccca41bfebf56961ff1f683ba94b81137c41f61c98c1368&#x27;</span>, <span class="string">&#x27;4d20e1aa4e4f6a4948158fabbdadec3c4d6049b6439981efcb70900d954d0a8f18bce67831d426c12726c321e6eb69e8708739fc74bfde6ad601433bcd896ca7&#x27;</span>, <span class="string">&#x27;e5358c986a12ec11bcd495e8822c5a71b2545dc11ce09521edaa47c11b739b12bbe76ca89bd08beb969355dec56dfcdd6cff121bb61eaea148d25e9a6e428145&#x27;</span>, <span class="string">&#x27;fb06d41eafbcc77d464fe41ca356641cbb92289d28b0ff37caad95619c34557969acf9f615214f3ecf6c15943fc63470da0785687ae535045145d5e161a69210&#x27;</span>, <span class="string">&#x27;2e97f02e82642c033af0fc9686788c1acd8841b65228fab3e66f5328e790d702edadb13e99ed1d411482cd913ec6730803e6fcff29206d9e1fc1b68e1f631e25&#x27;</span>, <span class="string">&#x27;4f1ffd080380e945b24596135e5772058ee8adc26272ed3147f0701063b4b9f435e5ac679ef2cd950332ea5139d64ffee7f1211ea64c5beffa162bb942683fac&#x27;</span>, <span class="string">&#x27;0882c54ba0409f28ab3907831eedab320bf3645fd70888266393704f81998ed57778912ededb54c58efd6fc9f22188566824ae312d4585f87d37339fd87827e6&#x27;</span>, <span class="string">&#x27;9dafe7cee839389cbd5a72ac17befad3228b47192ed3a94a319eef67704c094adfeca2f14a1cea54540e7d69c6033c53fdbe60969cc910b31b1fce8c9d6a9d5b&#x27;</span>, <span class="string">&#x27;627357126622ad1b76354b4f6974120f670baf035e24599e36c9f14527f225e6acb0e00482c3ab7442858070181eb3a7fc4acd8de5e5411aa482b094c6e1a1fa&#x27;</span>, <span class="string">&#x27;a9c7c29b800677ac44427204bc2137f0641465a411a521d3567911ab364c426c7a340ad1dcddb2330667bc78925bbec8bfd47cbf8031496e468f5ff3f9cc8a71&#x27;</span>, <span class="string">&#x27;23429d961d3bcf2e4873379afba581b351441c2d33c37c1fb5e84cdc22045a99bac91b3d8e3c90de3d56d443e439246872ab8fbd4ff42fbbd37509f79ccedd6e&#x27;</span>, <span class="string">&#x27;2847983b8f9492fe88c988d04b8086b94d8f827684e10cf2d4db1f5c65c1a7354c6e15df548df379ea5a56b57de9e36faf36c8d05270dc4bf69577ecbb5c1300&#x27;</span>, <span class="string">&#x27;c684e4714cd002abea6fa5bd23014a152cf358ab848179fdc29f1b79b090b42c550ea43718e3e2c4bea2ece080db41fb9433539cac0b8ac8e419bcdbb6477017&#x27;</span>, <span class="string">&#x27;34e969156c0ff98ccff9dbe2757a365e24e81857937cc3056a1b837d67a5bc0215c99aa15ac8150c6cee089623000104017ac535ef3a7fd10bb46b008e64bf12&#x27;</span>, <span class="string">&#x27;b79275b644dd73661b947fb786054b114fc90bcdf19cdd2a4cc96c426a3581d854619d95c3b9864534f9fe66445336e55c1a79527825706500527392ebac7ba6&#x27;</span>, <span class="string">&#x27;f7302bd4f492be0537536a5327dab593b903346a5e32bf0262f494f11bb3968a736ae1a90abebe7ab600d899b001e8e4704117b862cf7787df29b1b8cda76227&#x27;</span>, <span class="string">&#x27;e7d378b1f273baaaab041d3d81d669a351abe21d5987403fbb7d35f957a82ebcf0ffbbef77a08c1807d6e19d33053a62801f151bb81d0179bdb09fefd45a845d&#x27;</span>, <span class="string">&#x27;8c8dddfe7c2ee295c4aad0f207517cb00a5870c93c38af0e7438510f80b6788f7e863da10ec0650ab661ead1ae799dc63d3f7115c018a1d1961a068cff25ff21&#x27;</span>, <span class="string">&#x27;7382adaeab3aaed04178cf90bcb2750e11498f17dda2e058bbed931e9ff55faaa3fcc5af423ac139fd936fff916c78a5de316e67b5226d804e2590c65ad191c8&#x27;</span>, <span class="string">&#x27;70385b3c8fa2fd47be6963683256ebcbf2eb0a81f76856cb9524d59dcc1f910f98b0c37687857da008c6901fd78a9cf3b8b0ea9d744c8ab3b3d1b70277372572&#x27;</span>, <span class="string">&#x27;13f510e214b5bb7dbb81fadd772835f6fd0f082252ab775ab72c1b62b1573466a39d634f428202dd67bb4cdbb692a2a5dd148a49504d021d4aa5d903fac02cb1&#x27;</span>, <span class="string">&#x27;0910c842616b8b4c7f2ab265172e1d682a89b79f97019473d517b606dd43999e343ad4b08a71b69a1f4ffc8db39f7deb0a3c51c44652b1c63e090d901f43b33d&#x27;</span>, <span class="string">&#x27;7129bd6c31cc1e7f480fa713d9ba5386fdac580593229ca77baf96ea41e87fcd5b4c83693fc4b6b37959fc80391e05b279acad320fbd03e1c332e4cedc86a5b7&#x27;</span>, <span class="string">&#x27;b6b80ce7dfe5a9fe066fce563a486c4a5f07611ab484131faf9381dc794a329390c60b53080d8360903f5759a18a1eca1b265655ef43ca213544c31e99fe0087&#x27;</span>, <span class="string">&#x27;7bfdca43b8d21d48e18dae387ea95c4ba690bff5fe22f3a29637c196a2288fdde98ec73554123dc33c8af567c7b98f9775600a0e34f32eae62655b47a0182171&#x27;</span>, <span class="string">&#x27;b93eb6af65de700306b7a22816a1d461451c694de5ce55464be57cce89e8349f81a6d3fcc52da72c5d14df88bbe5ff683b591788d3edc91006a99ed1171ecce0&#x27;</span>, <span class="string">&#x27;1ab26e7f8a1e8854a73f2904d781f9f551d5b325fea4ec3f7ec45a03fc8d0b087b054f6475c21a473f5b47d6a980539b6a0aaf207bf89b3cc46eaf7fbf63411d&#x27;</span>, <span class="string">&#x27;bea21a265e48c2624ba85137392dde1971325909fdfb97f57397f422cd6a152ef75c99b0634d6863aa4d7b4f07648d10c7ed3eeb210dc86691d0e2b463471ba8&#x27;</span>, <span class="string">&#x27;e49e1b08e4865d8da0a278c049b2826a6b97911adbdaa836fd57f509f96db436327318bbf82c98b8d9f607e99c48db663473e4e941eb6109b174375a157eeb60&#x27;</span>, <span class="string">&#x27;72f00c548fc2539a8914b135b80a37e5137fa267579bcf11b566d4c44ee57defced7d0d3a2ec9923aa2790e80ac61a151b79e7b2dd17accbc7dd66c8e41d7489&#x27;</span>, <span class="string">&#x27;c0d86918879d4ccfa4adf3fbd449c9b26a17b61073221a15d576e9528e0e29fcf3b164020043ac2a5752768ac996fa15e551c36dfd6c1dbf0d24d81d2e5b6724&#x27;</span>, <span class="string">&#x27;ffd6eca8075af0c4fe4f38d4b3950ed76a4cc1474eadbd65b38484138456a98a4f4cc697c2d455d386e432679722f32cc59d1aa5135eb72cb10b5a82380b4e71&#x27;</span>, <span class="string">&#x27;a3407cb209c1a6788ba1ca992a7b6cc04ef1130f92be63b9738dae873f3e407b440788115edd81ef3c2e791e10798c3fd1830ca5b4773523ef246cf13fbd5a5c&#x27;</span>, <span class="string">&#x27;3b1fe148835ebeece99b0df444cb2705e195d5d364fdbaf2fa754797c8f7484461327d471b258f9b0b5dcfb757a08d50b0ac334154fd6d4d0d68c2a846de4163&#x27;</span>, <span class="string">&#x27;cc12da7bed20a53b5af9eebae5a94177f745ed5d48c4690cb462c498019e6a516b52cc9953620c04e12a79b45e99fc8164a79f00268c648801824a690a01b78f&#x27;</span>, <span class="string">&#x27;e4e36894a7323e5fb1dc54366acd4fd3f6d9ec2817bd1c153d3d84ed544893d6f5c8a7fe839acf4880eb8df6c8ced3f2f7d947835a496da7b010bf6c5b04d669&#x27;</span>, <span class="string">&#x27;a365dd19731e2d0ad844856da269d53a895ddcf5195b16f4e858ba4f83d99f2bbc49f7e7f61a431297545a3c9f3b99815a5a9645f83b1ac3acf1ca61481812fd&#x27;</span>, <span class="string">&#x27;0feb0860a5f6f2eaffc35e02a63633335b702e8bb1ef5c24dc82848cf3145149f4cede4352366db459784fa843ba0a20cec648b2674704bfe8facc2eb97a0fc5&#x27;</span>, <span class="string">&#x27;47c15d55e9a7f31ad5566213f8d0bdb6c4082b3dc2506f6d9d55af00fefe41a8c7ebe0255430efc5f6e7f5858fadd8478959afaf23ed57871ff78c676d0a1cd0&#x27;</span>, <span class="string">&#x27;c15d5a156453862bd6d7d3634dbbc711fcbe38e04a71cec69ff936347417fe439343f93a0a0a0d51712ce44fa277861cee82c350341fe00c28448e3fc6956cfa&#x27;</span>, <span class="string">&#x27;42a93a785ff208608b4deeac184a7f882e75c9d45e5c1fec6c4cd08f5efe08c27d5a670676e4c8697ad0813b02fe50f19e7a0bf189716a2796b9804f737d5a98&#x27;</span>, <span class="string">&#x27;33e06326cc15e21e9a7d2f5b45facd397d9ef13315bb792356432fcb63e22ce15f1da0a8db378660ee1b8ce9286f772663f16da0cf6bbce149392d50e24096cc&#x27;</span>, <span class="string">&#x27;1c11c1cbd0b3e468b7671c2ad1030506542935716c27cd0e241bc68144390a615f50af737bc2da9a72872ebae750e962a225d0dff561d879f919d187f95e4878&#x27;</span>, <span class="string">&#x27;d96905497145789b9734797625ede70eafcb8fc5eedbac4278091aba0d7c4b2bfe74e97ef5f966c1a3b408d91a36290a94027677c8b02d62e1a2b6498550c61a&#x27;</span>, <span class="string">&#x27;ab5accec0103e2809ff5a59c8b3ac3d1426441981f8c6413003c4b69494f54d1cc7d6bf352373c2d60f8aa3b0b2236d2ae150b02bea2f5d353e9b3400519be8e&#x27;</span>, <span class="string">&#x27;341cd45d80593cf158aac070433333500633f6bca596ea07b758729f7f1c2c9391a9dfa56bfd6810b2e21b0009fc84e4a309805288ace599b80eabe35feaebc7&#x27;</span>, <span class="string">&#x27;944769dafb279eb7998d136427e894cba7fb2fbc7f13e4137eabfaaec26f0bdc0779c212756e5c0ac849d285a5b6900174d2042759eeb1d3f5b0e49c58176e2c&#x27;</span>, <span class="string">&#x27;2dfaea9976d6d33109c778e28acb0647a01a4abff01df29b35d51b2359cccc75bac8772de117a47c64821566087de13bd8ab16f72e189c7a934b19b56734fee0&#x27;</span>, <span class="string">&#x27;c613ddab5dd81096088f185a1ead16ea0e6d99facd0249535b4327e11bd53fac5fd1b3807fef181a93cc048dbd4387e64c8281ead7bf2a28970739900633b7ad&#x27;</span>]</span><br><span class="line">leak = [<span class="number">87</span>, <span class="number">18</span>, <span class="number">88</span>, <span class="number">63</span>, <span class="number">30</span>, <span class="number">66</span>, <span class="number">60</span>, <span class="number">85</span>, <span class="number">13</span>, <span class="number">82</span>, <span class="number">35</span>, <span class="number">28</span>, <span class="number">21</span>, <span class="number">74</span>, <span class="number">47</span>, <span class="number">6</span>, <span class="number">30</span>, <span class="number">111</span>, <span class="number">97</span>, <span class="number">51</span>, <span class="number">42</span>, <span class="number">61</span>, <span class="number">92</span>, <span class="number">70</span>, <span class="number">113</span>, <span class="number">43</span>, <span class="number">7</span>, <span class="number">21</span>, <span class="number">68</span>, <span class="number">10</span>, <span class="number">99</span>, <span class="number">57</span>, <span class="number">87</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">60</span>, <span class="number">39</span>, <span class="number">117</span>, <span class="number">6</span>, <span class="number">88</span>, <span class="number">48</span>, <span class="number">47</span>, <span class="number">51</span>, <span class="number">56</span>, <span class="number">91</span>, <span class="number">6</span>, <span class="number">29</span>, <span class="number">92</span>, <span class="number">82</span>]</span><br><span class="line">enc = <span class="string">b&#x27;s\xda\xed\r\x8e/\xde\xa4\x99\x93\xcdCBB\x1c\xae\xcbB\x9f\xdd\xd4\x96\x9f\xa5O\xbf\x16\xa4\xecL\xe7J\x97\x1a\xdf\xa1\xa1\x92i,\xdd\x8a\xb6\xcfp&#125;ho&#x27;</span></span><br><span class="line"></span><br><span class="line">n = <span class="built_in">int</span>(<span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123&#x27;</span>,<span class="number">16</span>)</span><br><span class="line">R = []</span><br><span class="line">S = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sigs:</span><br><span class="line">    R.append(<span class="built_in">int</span>(i[:<span class="number">64</span>],<span class="number">16</span>))</span><br><span class="line">    S.append(<span class="built_in">int</span>(i[<span class="number">64</span>:],<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">length = <span class="number">50</span></span><br><span class="line">A = []</span><br><span class="line">B = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,length):</span><br><span class="line">    temp = inverse((S[<span class="number">0</span>]+R[<span class="number">0</span>]),n) * (S[i]+R[i])</span><br><span class="line">    temp = temp % n</span><br><span class="line">    A.append(temp)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,length):</span><br><span class="line">    temp = R[<span class="number">0</span>]*(S[i]+R[i]) - R[i]*(S[<span class="number">0</span>]+R[<span class="number">0</span>]) + <span class="number">2</span>^<span class="number">130</span>*leak[<span class="number">0</span>]*(S[i]+R[i])  - <span class="number">2</span>^<span class="number">130</span>*leak[i]*(S[<span class="number">0</span>]+R[<span class="number">0</span>])</span><br><span class="line">    temp = temp * inverse((S[<span class="number">0</span>]+R[<span class="number">0</span>]),n) % n</span><br><span class="line">    B.append(temp)</span><br><span class="line"></span><br><span class="line">O = matrix(ZZ,(length-<span class="number">1</span>),(length-<span class="number">1</span>)+<span class="number">3</span>)</span><br><span class="line">E = diagonal_matrix([<span class="number">2</span>^<span class="number">11</span>]*((length-<span class="number">1</span>)+<span class="number">3</span>))</span><br><span class="line">T1 = diagonal_matrix([n]*((length-<span class="number">1</span>)))</span><br><span class="line">T2 = matrix(ZZ,(length-<span class="number">1</span>)+<span class="number">3</span>,length-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length-<span class="number">1</span>):</span><br><span class="line">    T2[i,i] = <span class="number">2</span>^<span class="number">137</span></span><br><span class="line">    T2[-<span class="number">1</span>,i] = -B[i]</span><br><span class="line">    T2[-<span class="number">2</span>,i] = -A[i]</span><br><span class="line">    T2[-<span class="number">3</span>,i] = -A[i] * <span class="number">2</span>^<span class="number">137</span></span><br><span class="line"></span><br><span class="line">L = block_matrix(ZZ,[[T1,O],[T2,E]])</span><br><span class="line"></span><br><span class="line">K = <span class="number">2</span>^<span class="number">130</span></span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = K</span><br><span class="line">L[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">L[-<span class="number">3</span>,-<span class="number">3</span>] = <span class="number">2</span>^<span class="number">11</span></span><br><span class="line"></span><br><span class="line">temp = L.BKZ()</span><br><span class="line"><span class="comment">#print(temp)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#从上面的格中找到满足要求的一行</span></span><br><span class="line">k0h = <span class="number">127539877108597124515923590046076573696</span> // (<span class="number">2</span>**<span class="number">11</span>)    </span><br><span class="line">k0l = <span class="number">62747361493076885745985101978595693282</span></span><br><span class="line">k0leak = <span class="number">87</span></span><br><span class="line"></span><br><span class="line">k0 = k0h*<span class="number">2</span>**<span class="number">137</span> + k0leak*<span class="number">2</span>**<span class="number">130</span> + k0l</span><br><span class="line">S0 = <span class="number">9158674732422433584753600528499586749789902603207175171281211487385948076279</span></span><br><span class="line">R0 = <span class="number">13525126135691078619994352845806011492310052282990714228513050055938589068400</span></span><br><span class="line">n = <span class="built_in">int</span>(<span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123&#x27;</span>,<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">sk = ((k0+R0)*inverse(S0+R0,n) - <span class="number">1</span>) % n</span><br><span class="line"></span><br><span class="line">enc = <span class="string">b&#x27;s\xda\xed\r\x8e/\xde\xa4\x99\x93\xcdCBB\x1c\xae\xcbB\x9f\xdd\xd4\x96\x9f\xa5O\xbf\x16\xa4\xecL\xe7J\x97\x1a\xdf\xa1\xa1\x92i,\xdd\x8a\xb6\xcfp&#125;ho&#x27;</span></span><br><span class="line">key = hashlib.md5(<span class="built_in">str</span>(sk).encode()).digest()</span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">dec = aes.decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(dec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;cfe090d0-2888-a84d-ac6e-0e6aef017744&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="e2D1p"><a href="#e2D1p" class="headerlink" title="e2D1p"></a>e2D1p</h3><p>这一题我是跟着maple的wp复现的，原wp指路：</p>
<p><a target="_blank" rel="noopener" href="https://blog.maple3142.net/2023/10/23/n1ctf-2023-writeups/#e2d1p">N1CTF 2023 Writeups | 廢文集中區 (maple3142.net)</a></p>
<p>主要详细记录一下自己的思考。</p>
<p>题目来源：N1CTF 2023</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">FLAG = os.environ.get(<span class="string">&#x27;FLAG&#x27;</span>, <span class="string">b&#x27;n1ctf&#123;XXXXFAKE_FLAGXXXX&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> FLAG[:<span class="number">6</span>] == <span class="string">b&#x27;n1ctf&#123;&#x27;</span> <span class="keyword">and</span> FLAG[-<span class="number">1</span>:] == <span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line">FLAG = FLAG[<span class="number">6</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>(<span class="params">nbits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        q = getPrime(nbits)</span><br><span class="line">        <span class="keyword">if</span> isPrime(<span class="number">2</span>*q+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">pow</span>(<span class="number">0x10001</span>, q, <span class="number">2</span>*q+<span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">2</span>*q+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">key, message, mask</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="number">0x10001</span>, message^mask, key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = keygen(<span class="number">512</span>)</span><br><span class="line">flag = bytes_to_long(FLAG)</span><br><span class="line">messages = [getRandomNBitInteger(flag.bit_length()) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>)]</span><br><span class="line">enc = [encrypt(p, message, flag) <span class="keyword">for</span> message <span class="keyword">in</span> messages]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;message = <span class="subst">&#123;messages&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>题目内容比较简短，其加密流程如下：</p>
<ul>
<li>生成一个素数p，满足p=2q+1，且q是一个512比特的大素数</li>
<li>生成200个与flag同比特(159比特)的message，作为之后加密的mask</li>
<li>用这200个message分别进行encrypt加密，并给出这200个message与对应密文，要求还原flag</li>
</ul>
<p>其中，encrypt函数加密如下：</p>
<script type="math/tex; mode=display">
e = 65537</script><script type="math/tex; mode=display">
c_i \equiv e^{m_i \oplus flag} \quad(mod\;p)</script><h4 id="一些预备"><a href="#一些预备" class="headerlink" title="一些预备"></a>一些预备</h4><p>首先肯定要恢复p，而如果指数上没有异或这个未知的flag的话，那么问题变成已知多组如下形式的等式，恢复模数p：</p>
<script type="math/tex; mode=display">
c_i \equiv e^{m_i} \quad(mod\;p)</script><p>这个问题其实就是NSS二周年的一道题，具体分析过程可以看我的这篇：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/39588.html">NSSCTF-2nd-wp-crypto | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>不过这里我仍然简单写一下构造格的思路，我们期望找到一组a，满足：</p>
<script type="math/tex; mode=display">
\sum_{i=1}^{20}{a_im_i} = 0</script><p>这样我们就有：</p>
<script type="math/tex; mode=display">
\prod_{i=1}^{20}{c_i^{a_i}} \equiv \prod_{i=1}^{20}{e^{a_im_i}} \equiv e^{\sum_{i=1}^{20}{a_im_i}} \equiv e^0 \equiv 1 \quad(mod\;p)</script><p>如果我们能找到多组满足条件的较小的a，我们就能在较短时间内算出多组整数域上的下式：</p>
<script type="math/tex; mode=display">
\prod_{i=1}^{20}{c_i^{a_i}} - 1</script><p>然后求解gcd即可恢复模数。而为了找到这样的多组满足条件的较小的a，我们构造了如下格：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}
Ke1 & 1 & 0 & 0 ... & 0\\
Ke2 & 0 & 1 & 0 ... & 0\\
Ke3 & 0 & 0 & 1 ... & 0\\
...\\
Ke20 & 0 & 0 & 0 ... & 1\\
\end{matrix}\right)</script><p>他满足下面的关系式：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}
a1 & a2 & a3 ... & a20
\end{matrix}\right)

*
\left(\begin{matrix}
Ke1 & 1 & 0 & 0 ... & 0\\
Ke2 & 0 & 1 & 0 ... & 0\\
Ke3 & 0 & 0 & 1 ... & 0\\
...\\
Ke20 & 0 & 0 & 0 ... & 1\\
\end{matrix}\right)

=

\left(\begin{matrix}
0 & a1 & a2 ... & a20
\end{matrix}\right)</script><p>所以我们对格进行规约，取规约出的前几行短向量作为我们需要的a，然后按上述方法计算出多个kp并求解gcd即可恢复p。</p>
<h4 id="恢复p"><a href="#恢复p" class="headerlink" title="恢复p"></a>恢复p</h4><p>回到本题，这个题目在指数上异或了未知的flag：</p>
<script type="math/tex; mode=display">
c_i \equiv e^{m_i \oplus flag} \quad(mod\;p)</script><p>那么我们就没法知道每一组密文对应的幂次具体是多少，所以上面问题中的格也就无从构造。但问题依然是相似的，我们仍然是想找到多组满足条件的a，去求解gcd从而恢复p。那么就要想办法将问题转化成较为简单的形式。</p>
<p>首先要理解一点，指数上的异或究竟指什么？我们不妨拆开这个问题，先只关注异或：</p>
<script type="math/tex; mode=display">
t_i = m_i \oplus flag</script><p>我们把mi拆成159个二进制位，记作mij(j从0到158)，同理flag的159个比特位也记作flagj，那么其实异或就是对flag进行了如下的改变得到ti：</p>
<script type="math/tex; mode=display">
t_i = flag + \sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}}</script><p>一眼看上去是有点复杂，但其实他表达的意思很简单，我们取mi的任意一个二进制位mij做如下说明：</p>
<ul>
<li>mij有0、1两个取值。取0，说明这一位不发生翻转，也就是对ti没有影响；取1，说明这一位发生了翻转</li>
<li>而发生翻转又有两种情况：0-&gt;1和1-&gt;0，这要视flagj的取值而定，flagj同样有0、1两种取值。因此可以以(-1)^(flagj)来表示翻转情况</li>
<li>2^j表示的是翻转的具体量</li>
</ul>
<p>举个简单的例子：假设flag二进制为101，message为011，那么异或其实也就是：</p>
<ul>
<li>最后一位1-&gt;0</li>
<li>倒数第二位0-&gt;1</li>
<li>最高位不翻转</li>
</ul>
<p>那么这样计算出ti其实就等于：</p>
<script type="math/tex; mode=display">
t_i = flag + 2^1 -2^0</script><p>这就是说，我们可以把异或转化为一种加法形式表示，那么我们再把这种形式放回指数上，又会如何呢？</p>
<script type="math/tex; mode=display">
c_i \equiv e^{m_i \oplus flag} \equiv e^{flag + \sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}}} \quad(mod\;p)</script><p>也就可以写成：</p>
<script type="math/tex; mode=display">
c_i  \equiv e^{flag }*e^{\sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}}} \quad(mod\;p)</script><p>而正如刚才讲的预备题目中所说，我们要恢复模数p，就要找到多组满足如下条件的a，然后求解gcd：</p>
<script type="math/tex; mode=display">
\prod_{i=1}^{200}{c_i^{a_i}} \equiv 1 \quad(mod\;p)</script><p>代入到本题中的式子，就会有如下形式：</p>
<script type="math/tex; mode=display">
\prod_{i=1}^{200}{c_i^{a_i}} \equiv \prod_{i=1}^{200}e^{a_i(flag + \sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}})} \quad(mod\;p)</script><p>又因为右边底数部分e是相同的，因此累乘可以变成指数上的累加：</p>
<script type="math/tex; mode=display">
\prod_{i=1}^{200}{c_i^{a_i}} \equiv e^{\sum_{i=1}^{200}a_i(flag + \sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}})} \quad(mod\;p)</script><p>所以我们其实希望有：</p>
<script type="math/tex; mode=display">
e^{\sum_{i=1}^{200}a_i(flag + \sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}})} \equiv 1 \quad(mod\;p)</script><p>那么其实也就是有：</p>
<script type="math/tex; mode=display">
\sum_{i=1}^{200}a_i(flag + \sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}}) = 0</script><p>所以现在我们的目标就是靠这个式子，去找到若干组较小的a满足上式，然后就可以求gcd得到p了。而想要达到这个目的其实也很容易，注意到这个等式其实由可以拆成两部分组成：</p>
<script type="math/tex; mode=display">
\sum_{i=1}^{200}a_iflag + \sum_{i=1}^{200}a_i\sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}} = 0</script><p>那么我们不妨使两部分均为0，那么其和也肯定为0，也就是：</p>
<script type="math/tex; mode=display">
\sum_{i=1}^{200}a_iflag = 0</script><script type="math/tex; mode=display">
\sum_{i=1}^{200}a_i\sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}} = 0</script><p>而如何使两部分分别为0呢？首先，对于第一部分，显而易见只要使得：</p>
<script type="math/tex; mode=display">
\sum_{i=1}^{200}a_i = 0</script><p>也就是ai的和为0就可以。而对于第二部分，列式观察就会发现，我们也只需要满足下式即可：</p>
<script type="math/tex; mode=display">
\forall j\;,\; \sum_{i=1}^{200}a_im_{ij} = 0</script><p>由这两个关系我们可以构造如下矩阵：</p>
<script type="math/tex; mode=display">
L = \left(\begin{matrix}
m_{0,0} & m_{0,1} & ... & m_{0,158}& 1\\
m_{1,0} & m_{1,1} & ... & m_{1,158}& 1\\
&&...\\
m_{199,0} & m_{199,1} & ... & m_{199,158} & 1\\
\end{matrix}\right)</script><p>这个矩阵具有如下线性关系：</p>
<script type="math/tex; mode=display">
(a_0,a_1,...,a_{200})
\left(\begin{matrix}
m_{0,0} & m_{0,1} & ... & m_{0,158}& 1\\
m_{1,0} & m_{1,1} & ... & m_{1,158}& 1\\
&&...\\
m_{199,0} & m_{199,1} & ... & m_{199,158} & 1\\
\end{matrix}\right)
=
(0,0,...,0)</script><p>其中，L的最后一列是满足刚才写的第一部分，而L的前面的列是满足第二部分。</p>
<p>这样一来，我们能够看出，我们想要的满足条件的a其实就是L的左核空间中的向量，而为了让他更小，我们对左核空间的基向量组进行规约即可。</p>
<p>规约后我们取几组a按照上面所说的办法就能得到p。</p>
<h4 id="求解flag"><a href="#求解flag" class="headerlink" title="求解flag"></a>求解flag</h4><p>有了p之后，我们仍然要继续想办法用已知的如下式子恢复flag：</p>
<script type="math/tex; mode=display">
c_i \equiv e^{m_i \oplus flag} \quad(mod\;p)</script><p>显然如果我们能求解DLP得到指数部分的话，就能再异或mi得到flag。不过由于题目中，p由2q+1的方式生成，所以p-1肯定不光滑，并且也没有别的好的方式直接求解这个离散对数。</p>
<blockquote>
<p>不过之前翻春哥文章看到过一篇，用调cado求解这种p-1只有一个大素因子的离散对数问题：</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/428567414">[调包侠] 利用cado-nfs计算离散对数的调包记录 暨 第四届“强网”拟态防御国际精英挑战赛 Crypto - speedrun writeup - 知乎 (zhihu.com)</a></p>
<p>不过这个要使用好像挺麻烦，不知道在这里是否可行</p>
</blockquote>
<p>回到正题，既然直接求解这个离散对数问题是难解的，那么就要另寻办法。这个时候再观察我们刚才的式子：</p>
<script type="math/tex; mode=display">
c_i  \equiv e^{flag }*e^{\sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}}} \quad(mod\;p)</script><p>里面的这一部分是由flag的每一个二进制比特计算得到的：</p>
<script type="math/tex; mode=display">
e^{\sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}}}</script><p>那么我们是否可以利用这个式子逐比特恢复flag？首先仍然注意刚才的矩阵：</p>
<script type="math/tex; mode=display">
L = \left(\begin{matrix}
m_{0,0} & m_{0,1} & ... & m_{0,158}& 1\\
m_{1,0} & m_{1,1} & ... & m_{1,158}& 1\\
&&...\\
m_{199,0} & m_{199,1} & ... & m_{199,158} & 1\\
\end{matrix}\right)</script><p>刚才我们求解这个矩阵的左核空间并规约，求gcd并去除小因子得到了p。之所以能这么做，是基于我们拆出了下面这个式子，并令两部分分别为0的缘故：</p>
<script type="math/tex; mode=display">
\sum_{i=1}^{200}a_iflag + \sum_{i=1}^{200}a_i\sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}} = 0</script><p>这个时候我们找到的ai满足：</p>
<script type="math/tex; mode=display">
(a_0,a_1,...,a_{200})
L
=
(0,0,...,0)</script><p>而如果我们改变右边的解为：</p>
<script type="math/tex; mode=display">
(0,0,...,1)</script><p>这时候如果我们能解矩阵方程得到a，那么向量a应该满足：</p>
<script type="math/tex; mode=display">
(a_0,a_1,...,a_{200})
L
=
(0,0,...,1)</script><p>也就是说，我们分割出的两部分和，此时第二部分仍为0，而第一部分变成了1，也就是：</p>
<script type="math/tex; mode=display">
\sum_{i=1}^{200}a_iflag = 1*flag = flag</script><p>此时我们再求c的累乘，得到的就应该是e的flag次方。但是我们好像仍然没有办法求解离散对数得到flag，并且更绝望的是，这个矩阵方程无解。</p>
<p>然后看maple的思路，发现大致相同，但是他发现如果target向量是如下形式的话都有解：</p>
<script type="math/tex; mode=display">
(1,0,0,0,...,1)</script><script type="math/tex; mode=display">
(1,1,0,0,...,1)</script><script type="math/tex; mode=display">
(1,1,1,0,...,1)</script><p>而这其实就给我们逐比特还原flag带来了机会，比如我们第一次以第一个向量作为目标向量求解矩阵方程，会得到一个向量a，然后我们用这个向量a进行累乘，得到的结果应该是：</p>
<script type="math/tex; mode=display">
\prod_{i=1}^{200}{c_i^{a_i}} 
\equiv 
e^{\sum_{i=1}^{200}a_i(flag + \sum_{j=0}^{158}{2^jm_{ij}(-1)^{flag_j}})}
\equiv
e^{flag}e^{2^{k}(-1)^{flag_k}} \quad(mod\;p)</script><p>k在这里是最高比特位，flagk也就是flag的最高比特位，也就是1。然后我们把这次累乘的结果记作y1：</p>
<script type="math/tex; mode=display">
y_1 = e^{flag}e^{2^{k}(-1)^{flag_k}} \quad(mod\;p)</script><p>然后，我们选择第二个向量求解矩阵方程，并且同样用结果进行累乘得到第二组结果y2：</p>
<script type="math/tex; mode=display">
y_2 = \prod_{i=1}^{200}{c_i^{a_i}}  
\equiv 
e^{flag}e^{2^{k}(-1)^{flag_k}}e^{2^{k-1}(-1)^{flag_{k-1}}}\quad(mod\;p)</script><p>可以发现y1、y2具有如下关系：</p>
<script type="math/tex; mode=display">
y_2 = y_1e^{2^{k-1}(-1)^{flag_{k-1}}} \quad(mod\;p)</script><p>然后你会发现，由于flag的每一比特只有两种取值，因此这个部分也只有两种取值：</p>
<script type="math/tex; mode=display">
e^{2^{k-1}(-1)^{flag_{k-1}}}</script><p>我们算出这两种取值，然后分别与y1相乘看哪个等于y2，就得到了flag的这一比特位。往后也同理，由此我们就可以逐比特还原flag的所有比特位了。</p>
<p>这里有一点需要注意，虽然解矩阵方程的矩阵和目标向量都定义在ZZ域上，但是实际解出来并不是整数，所以计算累乘时需要额外处理一下。我这里就直接用了maple的field_exp函数。并且由于最后一步模的计算较多我就用了powmod加快，虽然好像效果并不是非常明显。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> powmod</span><br><span class="line"><span class="keyword">from</span> output <span class="keyword">import</span> message,enc</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 recover p</span></span><br><span class="line">L = Matrix(ZZ,<span class="number">200</span>,<span class="number">160</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    temp = <span class="built_in">bin</span>(message[i])[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">159</span>):</span><br><span class="line">        L[i,j] = <span class="built_in">int</span>(temp[j])</span><br><span class="line">    L[i,-<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">L_kernel = L.left_kernel().basis()</span><br><span class="line">res = Matrix(ZZ,L_kernel).LLL()</span><br><span class="line"></span><br><span class="line">kp = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    left = <span class="number">1</span></span><br><span class="line">    right = <span class="number">1</span></span><br><span class="line">    a = res[i]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">        <span class="keyword">if</span>(a[j] &gt; <span class="number">0</span>):</span><br><span class="line">            left *= <span class="built_in">pow</span>(enc[j],a[j])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right *= <span class="built_in">pow</span>(enc[j],-a[j])</span><br><span class="line">    kp.append(left-right)</span><br><span class="line">p = GCD(kp[<span class="number">0</span>],kp[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">10000</span>):</span><br><span class="line">    <span class="keyword">while</span>(p % i == <span class="number">0</span>):</span><br><span class="line">        p //= i</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="comment">#25070940894294854944213724808057610995878580501834029791436842569011975159898869595617649716256078890953233822913946718277574163417715224718477846001735447</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 Get flag</span></span><br><span class="line">L = Matrix(ZZ,<span class="number">200</span>,<span class="number">160</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    temp = <span class="built_in">bin</span>(message[i])[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">159</span>):</span><br><span class="line">        L[i,j] = <span class="built_in">int</span>(temp[j])</span><br><span class="line">    L[i,-<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">field_exp</span>(<span class="params">el, e</span>):</span><br><span class="line">    a, b = e.numerator(), e.denominator()</span><br><span class="line">    el **= a</span><br><span class="line">    q = el.parent().characteristic() // <span class="number">2</span></span><br><span class="line">    d = inverse(b, q)</span><br><span class="line">    <span class="keyword">return</span> el**d</span><br><span class="line"></span><br><span class="line">y1 = <span class="number">0</span></span><br><span class="line">y2 = <span class="number">0</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">159</span>):</span><br><span class="line">    target = vector(ZZ,[<span class="number">1</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>)] + [<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">158</span>-i)] + [<span class="number">1</span>])</span><br><span class="line">    s = L.solve_left(target)</span><br><span class="line">    F = GF(p)</span><br><span class="line">    c = product([field_exp(F(y), z) <span class="keyword">for</span> y, z <span class="keyword">in</span> <span class="built_in">zip</span>(enc, s)])</span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">0</span>):</span><br><span class="line">        y1 = c</span><br><span class="line">        flag += <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        y2 = c</span><br><span class="line">    temp = powmod(<span class="number">65537</span>,<span class="number">2</span>**(<span class="number">158</span>-i),p)</span><br><span class="line">    <span class="keyword">if</span>(temp*y1 % p == y2):</span><br><span class="line">        flag += <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += <span class="string">&quot;1&quot;</span></span><br><span class="line">    y1 = c</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#n1ctf&#123;30o0_ezzz_dLLLp%$#@!&#125;</span></span><br></pre></td></tr></table></figure>
<p>总的来说这题对我来说难度还是很大，路还很长。</p>
<p><br></p>
<p><br></p>
<h3 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h3><p>题目来源：暂不明确</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint, getrandbits, choices</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genX</span>(<span class="params">rho, eta, gam, p</span>):</span><br><span class="line">    <span class="keyword">return</span> p * getrandbits(gam-eta) + getrandbits(rho)</span><br><span class="line"></span><br><span class="line">rho = <span class="number">12</span></span><br><span class="line">eta = <span class="number">256</span></span><br><span class="line">gamma = <span class="number">1000</span></span><br><span class="line">x = getPrime(<span class="number">256</span>)</span><br><span class="line">X = genX(rho, eta, gamma, x)</span><br><span class="line">p = getPrime(<span class="built_in">int</span>(X.bit_length() * <span class="number">2.5</span>))</span><br><span class="line">A = randint(<span class="number">2</span>, p - <span class="number">1</span>)</span><br><span class="line">B = randint(<span class="number">2</span>, p - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(b64encode(long_to_bytes(p)).decode())</span><br><span class="line">signal.alarm(<span class="number">30</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    choice = <span class="built_in">input</span>().strip()</span><br><span class="line">    <span class="keyword">if</span> choice == <span class="string">&quot;reset1&quot;</span>:</span><br><span class="line">        y = randint(<span class="number">1</span>, X)</span><br><span class="line">        a = randint(<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">        b = (y**<span class="number">2</span> - (X**<span class="number">3</span> + a*X)) % p</span><br><span class="line">        A = a</span><br><span class="line">        B = b</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;reset successful.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(b64encode(long_to_bytes(A) + <span class="string">b&quot;||&quot;</span> + long_to_bytes(B)).decode())</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">&quot;reset2&quot;</span>:</span><br><span class="line">        X = genX(rho, eta, gamma, x)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;reset successful.&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">&quot;check&quot;</span>:</span><br><span class="line">        user_input = <span class="built_in">int</span>(<span class="built_in">input</span>().strip())</span><br><span class="line">        <span class="keyword">if</span> user_input == x:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            exit(-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        exit(-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>是一个师傅问我的一道靶机题，但是我没有环境，所以就讲讲思路。</p>
<p>题目任务如下：</p>
<ul>
<li>生成一个256bit的素数x，同时生成一个X，满足：</li>
</ul>
<script type="math/tex; mode=display">
X = qx+r</script><ul>
<li>生成一个2500bit数量级的p并发送给我们，然后限时30s，交互开始</li>
</ul>
<p>交互开始后，我们在时间允许范围内有无限次交互机会，每次交互我们可以：</p>
<ul>
<li>输入”reset1”，题目会随机生成yi、ai，并计算出对应bi后，发送(ai，bi)给我们。满足(X,yi)在下面的椭圆曲线上：</li>
</ul>
<script type="math/tex; mode=display">
y_i^{2} = X^3 + a_iX + b_i \quad(mod \; p)</script><ul>
<li>输入”reset2”，题目会更新X的值</li>
<li>输入”check”，我们可以给靶机核对小写x(就是最初生成的256bit的素数)的值，正确则可以得到flag</li>
</ul>
<p>那么首先就要明白reset1、reset2这两个交互功能各有什么作用。首先我们知道有：</p>
<script type="math/tex; mode=display">
X = qx+r</script><p>那么如果能知道多组X的值，这就变成了一个AGCD问题，这也就是reset2的作用。</p>
<p>因此，我们的想法就是：</p>
<ul>
<li>每次reset2，得到一个未知的Xi</li>
<li>想办法用reset1来解出Xi的值</li>
<li>得到多组Xi后，解AGCD得到x去通过核验，拿到flag</li>
</ul>
<p>那么接下来的任务就落在了如何利用reset1上。我们已知每次reset1会提供给我们一组满足如下等式的(ai，bi)：</p>
<script type="math/tex; mode=display">
y_i^{2} = X^3 + a_iX + b_i \quad(mod \; p)</script><p>看上去是引导人往椭圆曲线想，就会自然想到groebner，但是稍微再想一想就知道变量多了，肯定groebner不出来。</p>
<p>而实际上，既然我们可以多次reset1，那么这其实也是一个HNP问题。我们把模等式展开：</p>
<script type="math/tex; mode=display">
y_i^{2} = X^3 + a_iX + b_i + k_ip</script><p>那么我们完全可以同样用HNP构造格的思路，构造下面的格来求解X：</p>
<script type="math/tex; mode=display">
L = 
\left(\begin{matrix}
p &  & ... & & \\
 &p & ... & & \\
  & & ... & & \\
 & & ... &p & \\
1&1&...&1&1\\
a_1 & a_2 & ... &a_n  & &1\\
b_1 & b_2 & ... &b_n  & &&1\\
\end{matrix}
\right)</script><p>这个格具有如下线性关系：</p>
<script type="math/tex; mode=display">
(k_1,k_2,...k_n,X^3,X,1)
\left(\begin{matrix}
p &  & ... & & \\
 &p & ... & & \\
  & & ... & & \\
 & & ... &p & \\
1&1&...&1&1\\
a_1 & a_2 & ... &a_n  & &1\\
b_1 & b_2 & ... &b_n  & &&1\\
\end{matrix}
\right)
=
(y_1^2,y_2^2,...y_n^2,X^3,X,1)</script><p>然后，我们配平一下这个格并进行规约就有机会得到目标向量。经过测试，申请四组(ai，bi)，就可以在第三行得到我们需要的目标向量，并且所用时间也很短，符合要求。</p>
<p>得到一个Xi后我们就reset2更新下一个Xi，并继续按这个方法求解即可。然后有多组Xi就可以AGCD求x了。</p>
<p>由于没有靶机，这里我就放一下我本地验证HNP问题的exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint, getrandbits, choices</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genX</span>(<span class="params">rho, eta, gam, p</span>):</span><br><span class="line">    <span class="keyword">return</span> p * getrandbits(gam-eta) + getrandbits(rho)</span><br><span class="line"></span><br><span class="line">rho = <span class="number">12</span></span><br><span class="line">eta = <span class="number">256</span></span><br><span class="line">gamma = <span class="number">1000</span></span><br><span class="line">x = getPrime(<span class="number">256</span>)</span><br><span class="line">X = genX(rho, eta, gamma, x)</span><br><span class="line">p = getPrime(<span class="built_in">int</span>(X.bit_length() * <span class="number">2.5</span>))</span><br><span class="line"></span><br><span class="line">Alist = []</span><br><span class="line">Blist = []</span><br><span class="line"><span class="built_in">round</span> = <span class="number">4</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">round</span>):</span><br><span class="line">    y = randint(<span class="number">1</span>, X)</span><br><span class="line">    a = randint(<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">    b = (y**<span class="number">2</span> - (X**<span class="number">3</span> + a*X)) % p</span><br><span class="line">    Alist.append(a)</span><br><span class="line">    Blist.append(b)</span><br><span class="line"></span><br><span class="line">L = Matrix(ZZ,<span class="number">3</span>+<span class="built_in">round</span>,<span class="number">3</span>+<span class="built_in">round</span>)</span><br><span class="line">K = <span class="number">2</span>^<span class="number">1000</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">round</span>):</span><br><span class="line">    L[i,i] = p*K</span><br><span class="line">    L[-<span class="number">3</span>,i] = <span class="number">1</span>*K</span><br><span class="line">    L[-<span class="number">2</span>,i] = Alist[i]*K</span><br><span class="line">    L[-<span class="number">1</span>,i] = Blist[i]*K</span><br><span class="line"></span><br><span class="line">L[-<span class="number">3</span>,-<span class="number">3</span>] = <span class="number">1</span></span><br><span class="line">L[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">2</span>^<span class="number">2000</span></span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = <span class="number">2</span>^<span class="number">3000</span></span><br><span class="line"><span class="built_in">print</span>(X)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">abs</span>(L.LLL()[<span class="number">2</span>][-<span class="number">2</span>]) // <span class="number">2</span>^<span class="number">2000</span>)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="HNP"><a href="#HNP" class="headerlink" title="HNP"></a>HNP</h3><p>题目来源：暂不明确</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag, x, y, z</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory <span class="keyword">import</span> prevprime</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"></span><br><span class="line">Round = <span class="number">32</span></span><br><span class="line">q = <span class="number">2</span> ** <span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [x,y,z]:</span><br><span class="line">    <span class="keyword">assert</span> i.bit_length() == <span class="number">256</span></span><br><span class="line"></span><br><span class="line">A = []</span><br><span class="line">B = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Round):</span><br><span class="line">    a = getRandomInteger(<span class="number">256</span>)</span><br><span class="line">    A.append(a)</span><br><span class="line">    b = (a * x % q) &gt;&gt; (<span class="number">256</span> - <span class="number">8</span>)</span><br><span class="line">    B.append(b)</span><br><span class="line"><span class="built_in">print</span>(A)</span><br><span class="line"><span class="built_in">print</span>(B)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[3561678147813669042672186969104055553515262226168087322052560790885260761433, 17346407693442644010055116546363960164095133759884497841925887458500171929994, 10970839811545507511408260800883769581649579684426188079142754412064502787585, 109417222922540235139013912297145185193443712852193270682885305502867182588403, 88171850234002600580608014259219586239590114856448092326801813245774395730496, 5113619435362108938262679062561727235116615800676783173565082653599747645155, 54576089683044230333058389148818602636893918880220233916359714009830588044131, 46319652232696496987147414399965164805770427009639155019904825551069668519260, 92142202700489403870481152403139465532735056770434774464930082474517829581964, 9084526539780165183228300902059842905058839285187659313361650962576085292818, 89120115360204223476154240731792191817638074392691790750005020564226279037550, 108874944765319253896194176909539011617418473448207058050594223215460183828033, 48697630410338199345605370644643425030874923782845194702123578264330641464094, 90490831141215467713642375752174358047945797806394912036159392371419919773636, 5407847525945777533863763148921176292074562577253075889320641646783216244238, 95326999116234880776873896438659550308182265903511015349887289749187746932743, 13848646478536701368088661040908693291788138011605835864557858216170511016083, 12688154545015600072136788151484672710661959298941783293908174000377900727747, 103416430654164637952330806792686485956010294787748757584715063906414248209722, 36213989454986448247979083323211284869162879484215027121399406834805531673463, 83477199408920970502661396196378764693640078246444907844363833717275362253336, 54685544287120130615023910691215446521783587675140445694155062634358785975223, 57209914633582227771666953772776413914105217956486621477363100169491699389485, 60722705656546434007907580733214759241271810206392571495455413850603913610651, 62666312072142619643565102615355724228875566515181602729719018682721112131326, 17892029370519322177254795109531838575579273633357811419566887056272012019617, 23387537005911727415991488713130020055341902697712259630978747015670850612866, 57084096974333718635810536400151484653413307540676932220675888461543384910791, 64672020284448913361212245534680048800817888816777270292913433441383929287826, 30879668079119218442051482226185849538064516289533962210948424807374221747937, 67805294126621083377517953883639091568886644480832055617022550683600509359637, 80971248361778969534551851802629859076303703583702628504189145200772632698437]</span></span><br><span class="line"><span class="string">[185, 121, 74, 192, 66, 208, 189, 5, 248, 216, 222, 49, 199, 122, 212, 109, 36, 135, 9, 43, 94, 192, 67, 176, 165, 34, 241, 27, 255, 216, 71, 156]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">q = prevprime(q)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line">A = []</span><br><span class="line">B = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Round+<span class="number">1</span>):</span><br><span class="line">    a = getRandomInteger(<span class="number">256</span>)</span><br><span class="line">    A.append(a)</span><br><span class="line">    b = (a * y % q) &amp; (<span class="number">2</span> ** <span class="number">8</span> - <span class="number">1</span>)</span><br><span class="line">    B.append(b)</span><br><span class="line"><span class="built_in">print</span>(A)</span><br><span class="line"><span class="built_in">print</span>(B)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">115792089237316195423570985008687907853269984665640564039457584007913129639747</span></span><br><span class="line"><span class="string">[46504565744057869379592149118750005180204315285587793650459698458291497313095, 58007957093934046182693035826219870499452741234326847327688846747059237094075, 50185124619087453830679170251457196445767905313509337058697814870412730362947, 13460057838246434192804076595664204927155595158673092664009965681276162112064, 1701081975560116286696366369808334022446618430663926380667987754925635360535, 26884871731419084105623632272724863769910293366201375037286643905133449526668, 86148369125917615329995354501659454507150263427394081644953922899405044908942, 86965847264933041291798488655625963084424620038983026175910367027955449692128, 51359332101276868450990110421905601457823984827989287103931757850844231666586, 48796757902016638482644909388959646721244669665114474829651238484065619118952, 100070448202859232758452766870542683109402601193511866026529530855112793822109, 96580256984898125874774601478072811945116066886633284314860596683569097605765, 38808894076998102467847013020946201384521577320197543440467015636483307894892, 4134554141092625841029701614640247691101835437566908306546904884177729072687, 74873085435488619613395208820994521773265984299598688734149106712561237976724, 15654842239708870234259249156913701671624803564647865424705391694462101457862, 88322093034453332197643606249439750127876581478584569790806716889277489637972, 22499556277754006237442593359493863007223009260764163505327306701416065559119, 67089035688878297307085968283413144678391442218184879365509351597884743967932, 27674630243557284124557851587722479960748242794492773619925160133318279977692, 9119521864491019262790789925266797995577993021425216600126182732190292182948, 101288882073195598657612116292233377922026161322404160341330451374348438098216, 67804446744028818432860934046262550895247933787912806120088242004054790700495, 26086948144209799352019678059923693118044934151861294461002114985645656470189, 38144657569843600236424138168852321656171547769351620499893335164030638528328, 29607623036881080673594862278805535156351844098214001235565521439825687173709, 73322408962909922161031457562287596779866102699954700495813418822123077110802, 71841446787131237842866428647552570448973984694577468650052516966413175250298, 1230436323839997562475731649322922330998915952913300933165504728647309839568, 107223013661981482036189531938571461516528131559156846625598018135279924645933, 40439925178577390217639900040814034803597438472158408491211685077053585300286, 26978587850306490903937574562860250724695533954879823140348556476663322417613, 82195886203427304567763311291077205482622324404366375181470500496565215770146]</span></span><br><span class="line"><span class="string">[115, 240, 228, 198, 160, 178, 214, 160, 96, 140, 89, 186, 159, 102, 192, 93, 135, 30, 17, 9, 138, 224, 109, 116, 76, 116, 180, 196, 121, 187, 210, 208, 14]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">q = <span class="number">2</span>**<span class="number">256</span></span><br><span class="line">A = []</span><br><span class="line">B = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">103</span>):</span><br><span class="line">    a = getRandomInteger(<span class="number">256</span>)</span><br><span class="line">    A.append(a)</span><br><span class="line">    b = (a * z % q) &gt;&gt; (<span class="number">256</span> - <span class="number">4</span>)</span><br><span class="line">    B.append(b)</span><br><span class="line"><span class="built_in">print</span>(A)</span><br><span class="line"><span class="built_in">print</span>(B)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[56666422659665306957613341966104139188430887040369382699811066965734652038579, 41608423494025514337106193470276163502869431432921281068110444274310186909892, 95312645577996377489331859379729367791539181995403307071242251663306260824059, 114007089082826788908311397311915638668862713690403097281136795912671634293903, 77470602549297888428039543840134276433567854766634294661906479236200644990851, 67265570384781545307301479187933437206481537999752352862466291209724038113997, 101015220564168271842813302532972922828562060680762307341661161853013181455988, 73596220918173964622453801478597395507613363519777836354319778006747628725943, 80276240092293162850897330969848557221924558822619435206166856373482558821153, 60387041856575123107349887176488814324533329129026453912394888320971261329267, 37588667650535221417005569007639921039223353621264869144904381190769978830432, 30201673227033963823582196954697293400001560479877858941307825349312312395908, 46517796724693810353256110303591718873843585558937781709113232176049614134229, 110476911183528409932385631377040635032167229294859921626233104995069707326026, 33913880276956766352570275848477001195330941450588079882929631222080051897977, 108738411950576541236703456832793461013595057668683247592686862598082364613770, 87211442745029489881514515811064102429019356351722823450170249465088775249507, 39600946693670273230261533720839589755726946308581706825676138619972092199256, 4979886914346369664911891403751631037886315717549974065878536283157637402320, 22272529908653383795002294860870129574984518813560375272257703512940569602004, 100135751785995415247695765442899140606914076750888419237400306294448451415863, 85613534858376605408667291532701284666560850915689941354202786014968649139457, 38496246133430733988750968353732662162312705079114417415163071485082991344590, 55980481790171446152748793757788577465044360548729573345122559743628093363153, 71280277172994137969689292719624075379102489317199533126561191722460505314026, 110446223482446943024326135434573497276437669060614612856002207641927747194266, 16456085922385532110267651711339329146652084370610067373716816178321924748791, 101653629730678493695114228522885120593522618541788967122785214737946157867999, 74467527492811608068163160348674720595757862332879609098404557441577413104820, 41884843126443673947662657085537596879702074001592844509379139860812151553968, 29815687077578101251522932333124915023192910276895021601688368611558697857638, 44840628789800333625015337751638405696233468515566263356197320268202190223769, 102427595787595418722722430130631701884337456325150921017413824991597185452849, 2975107125099035075044003816426206055437890428466365543585422202932381886186, 94699511483779321185024950255977801474453881858185354369860946591141828290326, 31810607567540037649472765223870019465281477418301020106850480432511306591757, 75713781109794200255529510371465092460190607870508383754795316160075282283862, 55429849762380955520557448208384572772400405309708977900727750338226215580736, 71351843550447097631722656769410630908972124288367169285559142896305583201390, 84145371680533342029399999651802676680665442500082991947093355443249540103162, 18059328520840928370924328960454198116073475240703647573736616851363995779497, 83839387396741626377342400188482404639827411621171844172874897800772466334269, 25788978353065311499638204532308969267343091396798096623404684254370926606489, 46416171203559401945669998573205329748734005210989064607057470628982156110053, 42839223735347899899704913105525407073907314464785013094063759450820513757342, 88826657766811054515837039931572449230721258604658317309512814974116100196733, 53796508595019468595537500010909399217450133587528313928622717009905225347437, 56531378551320964008977461547054273860909442858252049481923559030063639435057, 48217679285988263588226655808041000825638438349841115697751615792350031644869, 64424297190010710116212288045994884168253983939992794298642423963632550451160, 46474911280506479688705284230861217499981118516937627597481370505066926962182, 64032029526907010327735757773865326038078238679652707012855320952596919166618, 5529383900219431454017233184818428510888383480088262580036064976358985800985, 69322608357555546086372761692837205200171798855109065251575534608627560525776, 76098979682650954216202311601813089916970156784884278240596741668163729505020, 91674126062289237651839995587104059408995800143522837051179562018281051100557, 90571390404208688843585603192800843878382529323359914123528861146103857760661, 72012664155317843790423022518639753138262519729890141457716216773019826138388, 66863180243825712563555363518892364864799935770917594234609418534062748300787, 5838945753982677965177087293687053018953448675487050703226841119623778529018, 4440280122867898274880560103713163505203269339591832639427292037957483435863, 113585052040012311817152621651926546174704034369418207806360593735979071392560, 96503008028224334771028807273628056037391407459560685791940303889130903300826, 67050454088005224845748627326789053425990922831763041158174139321910165797537, 56354656300386637831392267891729486882144501924180334206591055551662859511145, 108875538744684454340615686969559999736352047181969993978724550037003168200211, 105856150301241056513738964497224079598648612469774416566110150235952602587129, 103072133631485922917570773603973545510240103328265914435430955113182187850847, 105071449786380370702657927006338895312230491406739601631939501577997184496876, 101559564666645844079948496433098525970583827093303201782110972272082979410831, 45696832977481706385123240351386677526237953026854755659089774125668886575190, 92930863035601609905246064160817660898443604755800516139761871009073979122573, 7136157467487063026530735850363136522687472196852313490264738121297870888865, 62220552837071854508303645903133799707167271140998125870619424819338409845248, 71964156627499707284955744986659480338185350890617779236004729406075442337650, 56432954135882530785013240455908855171502152827770214700998108134515682426307, 24818258540494883741910232014072726664585493319546426193565346084848631309292, 68946604449180849807706382163388201284725162066731407078323925073762784383918, 78305860067531640486978712479618549593532447916095131216323237767823095149213, 40019412274222034245452650116905171509558126077504657023971877193155638952620, 6226049816877252622825028481234412013581804081798123571329306780957341285518, 72008834916679466207298598830558721788070004796890262626592503036925690499953, 24120184417962346330989331701326680837413020607663960631051474032512470756250, 106358126840983882959473879360172954895361540456426525458062716824086971706859, 96125062326106069117227627865988038851006615609777159985287487409738006940292, 33054514553432552301350757403482219452773112411443533998213496297361397155535, 41581969631676286214097564630767898944747546622643163224140263014954932195321, 22904365609725269502635057676962583581851475921482302591306344959978794545764, 64290237869656947632842147827818163107378784367086448814380499121557877108860, 30680084243764095315357070546550118749025091482163732007754607769361116153541, 13691292022145271355849518605344621718116294468846185203111794890637243685470, 25132284761110457596793743234989234799586919369754843892751414241493192284491, 12389505381820778753642609476404562621082110924974170017133920070419933455780, 71535924312884292159182314202796515340797288002505186265430063222078901533504, 12742977582401193716850400144097310370558409977576217736024733304490605337769, 75139886864475235332970108571588085544527733256425836467715638485512421268158, 106812400623906721014312287501764424395430875573845869345085033374152396156108, 91345106193584221920864389152087560188260652160092982315871571692181571481755, 65785148879985691725045496265911886841068140761050563941336015575029243383380, 1452703135528066004669796386925101704795733053841911703671961494738444465175, 44818107645190027629062089844645267760294751459286511227307352668787518517867, 26767624780451051554599928370950639364780468287039403780345758419855142782301, 73520682616655688427241752929498638616275480985470608873569998909405046919540]</span></span><br><span class="line"><span class="string">[11, 14, 12, 1, 13, 15, 1, 14, 12, 12, 15, 6, 2, 15, 13, 15, 6, 6, 11, 12, 2, 9, 3, 15, 0, 14, 10, 10, 13, 10, 6, 13, 6, 9, 0, 4, 9, 0, 15, 5, 2, 13, 12, 12, 5, 11, 3, 3, 12, 13, 5, 5, 14, 15, 12, 10, 9, 6, 8, 5, 8, 4, 12, 1, 15, 1, 14, 11, 11, 14, 6, 10, 6, 3, 14, 10, 10, 14, 5, 15, 6, 4, 13, 1, 5, 4, 7, 4, 13, 7, 0, 14, 6, 7, 2, 14, 1, 14, 6, 9, 14, 4, 13]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># enc</span></span><br><span class="line">key = x ^ y ^ z</span><br><span class="line">key = long_to_bytes(key)</span><br><span class="line">aes = AES.new(key,mode = AES.MODE_ECB)</span><br><span class="line"><span class="built_in">print</span>(aes.encrypt(pad(flag,<span class="number">16</span>)))</span><br><span class="line"><span class="comment"># b&#x27;\xda\xfc\xb7\x93\xfb\x9d\xbe\x82\xb3\xb5\x87`]&#125;\x0b*\xd53AR\x8bb\xfeQ,\xd9\xff\xf6\n\xa2\x1b)H\\\xf24&gt;E\xac+\x01\xf3)F\x8c\xee\xb8j\x18zb\xa8\x8b\xba\xbc\xbb\x03\xbb&#125;\xb6\x8cO#\xeb\x0c\xce\xbd\x07\x8aWP\x90\xf2\xaep\x02\x11&#123;\xdf\xc5&#x27;</span></span><br></pre></td></tr></table></figure>
<p>有两个师傅今天都问到了我这个题目，乍一看是很经典的HNP，但是做的过程中会发现这题没有那么简单，需要做不少优化处理，因此还是写一写。</p>
<p>基本HNP构造格的思路可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/581146119">[HNP] 一类基于各种DSA的HNP问题求解 - 知乎 (zhihu.com)</a></p>
<p>简而言之，题目任务为：</p>
<ul>
<li>三部分HNP，每部分分别对应一个待求数x、y、z，用x^y^z组成AES密钥并对flag进行加密</li>
<li>第一部分HNP，给了32组数据，泄漏高8位</li>
<li>第二部分HNP，给了33组数据，泄漏低8位</li>
<li>第三部分HNP，给了103组数据，泄漏高四位</li>
</ul>
<p>那么接下来就逐个部分说明。每部分还是会简单写一写题目内容和其最基本的格构造方法。</p>
<h4 id="泄露高8位"><a href="#泄露高8位" class="headerlink" title="泄露高8位"></a>泄露高8位</h4><p>a、b具有如下关系：</p>
<script type="math/tex; mode=display">
a_ix = b_i \quad(mod\;q)</script><p>然后，题目给出32组ai以及bi的高八位，要求解出x。由于bi只有高八位知道，所以我们把bi拆成以下形式：</p>
<script type="math/tex; mode=display">
a_ix = 2^{248}b_{hi} + b_{li} \quad(mod\;q)</script><p>为了转化为HNP形式，我们将第i组数据与第0组数据两两作差消除x：</p>
<script type="math/tex; mode=display">
a_0a_ix = a_02^{248}b_{hi} + a_0b_{li} \quad(mod\;q)</script><script type="math/tex; mode=display">
a_ia_0x = a_i2^{248}b_{h0} + a_ib_{l0} \quad(mod\;q)</script><p>即得到：</p>
<script type="math/tex; mode=display">
a_02^{248}b_{hi} + a_0b_{li} = a_i2^{248}b_{h0} + a_ib_{l0} \quad(mod\;q)</script><p>ai以及b的高位bhi均为已知值，进行移项：</p>
<script type="math/tex; mode=display">
a_0b_{li} =  a_ib_{l0} + (a_i2^{248}b_{h0} - a_02^{248}b_{hi}) \quad(mod\;q)</script><p>然后把a0的逆元乘至右侧(注意q是2^256，所以需要选一个逆元存在的当作a0，不过这一题正好a0逆元存在)，即得到HNP形式：</p>
<script type="math/tex; mode=display">
b_{li} = A_ib_{l0} +B_i \quad(mod\;q)</script><p>其中：</p>
<script type="math/tex; mode=display">
A_i = a_0^{-1}a_i</script><script type="math/tex; mode=display">
B_i = a_0^{-1}(a_i2^{248}b_{h0} - a_02^{248}b_{hi})</script><p>将模等式展开得到：</p>
<script type="math/tex; mode=display">
b_{li} = A_ib_{l0} +B_i + k_iq</script><p>因此我们可以构造如下形式的格：</p>
<script type="math/tex; mode=display">
L = 
\left(\begin{matrix}
q &  &  & & \\
 &q &  & & \\
  & & ... & & \\
 & &  &q & \\
A_1 & A_2 & ... &A_n  & &1\\
B_1 & B_2 & ... &B_n  & &&2^{248}\\
\end{matrix}
\right)</script><p>这个格具有如下线性关系：</p>
<script type="math/tex; mode=display">
(k_1,k_2,...k_n,b_{l0},1)
\left(\begin{matrix}
q &  &  & & \\
 &q &  & & \\
  & & ... & & \\
 & &  &q & \\
A_1 & A_2 & ... &A_n  & &1\\
B_1 & B_2 & ... &B_n  & &&2^{248}\\
\end{matrix}
\right)
=
(b_{l1},b_{l2},...b_{ln},b_{l0},2^{248})</script><p>那么一般来说我们对这个格进行LLL规约就能得到我们的目标向量。但是试一试会发现完全不行，规约出的向量最后一列几乎全为0，而不是我们期望的2^248。</p>
<p>然后我就按照上面参考文章那样，试了试BKZ，结果同样是不乐观的，没有办法得到我们的目标向量。</p>
<p>然后计算格的高斯启发式，会发现数量级与我们的目标向量非常相近，这说明我们的方法并没有错，而是被卡了界。给32、33、103组数据的目的估计就在于此，经过我自己测试，给的数据多几组，BKZ确实是可以得到结果的。</p>
<p>那么接下来就是如何优化这个格，而显然这个格的行列式基本变不了多少，所以不能显著提高其高斯启发式，因此只能从缩短目标向量入手。</p>
<p>而要缩短目标向量，就要改变bhi的数量级，因此我采用的办法是改变最初的拆分策略。最初的拆分策略是：</p>
<script type="math/tex; mode=display">
b_i = 2^{248}b_{hi} + b_{li} \quad(mod\;q)</script><p>这样拆分是因为题目给了我们bhi，所以会这么思考也很正常。这样其实也保证了bli是一个正数。而现在需要思考：我们好像不一定需要bhi是一个正数，我们想要的是缩小他的数量级，那么有没有什么拆分方式可以使他的数量级从2^248缩小一些？</p>
<p>所以我采用了如下方式：</p>
<script type="math/tex; mode=display">
b_i = (2^{248}b_{hi}+2^{247}) + (b_{li}-2^{247}) \quad(mod\;q)</script><p>此时，用这种拆分去构造格，规约出的向量的每一项就变成了如下的形式：</p>
<script type="math/tex; mode=display">
b_{li}-2^{247}</script><p>其预期的平均数量级就成功下降了1比特。事实证明这就是压垮骆驼的最后一根稻草，因为这样我们就能用BKZ算法规约出我们需要的向量了。</p>
<p>当然，我测了几组数据发现目标向量并不一定就在第一行，因此还需要加一个核验。核验思路也很简单，直接用求出的x与给定的32组ai去计算bi高位，看看与题目给的是不是相同即可。</p>
<p>不过我这里应该还是有点小bug的，因为bli-2^247应该有正有负，求x0时需要把两种情况都算一遍，但是既然能出结果我也就不调了，以后遇到再说。</p>
<p>第一部分exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_high</span>(<span class="params">res,A1,B1,q,bits</span>):</span><br><span class="line">    <span class="keyword">if</span>(res[-<span class="number">1</span>] == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    B0_low = res[-<span class="number">2</span>]</span><br><span class="line">    B0 = B1[<span class="number">0</span>] - B0_low</span><br><span class="line">    x0 = inverse(A1[<span class="number">0</span>],q)*B0 % q</span><br><span class="line"></span><br><span class="line">    B_1 = [(i-<span class="number">2</span>^(bits-<span class="number">1</span>)) &gt;&gt; bits  <span class="keyword">for</span> i <span class="keyword">in</span> B1] </span><br><span class="line">    B_2 = [(i*x0 % q) &gt;&gt; bits <span class="keyword">for</span> i <span class="keyword">in</span> A1]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(B_1 == B_2):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#part1 high_8_bits</span></span><br><span class="line">Round = <span class="number">32</span></span><br><span class="line">q = <span class="number">2</span> ** <span class="number">256</span></span><br><span class="line">A1 = [<span class="number">3561678147813669042672186969104055553515262226168087322052560790885260761433</span>, <span class="number">17346407693442644010055116546363960164095133759884497841925887458500171929994</span>, <span class="number">10970839811545507511408260800883769581649579684426188079142754412064502787585</span>, <span class="number">109417222922540235139013912297145185193443712852193270682885305502867182588403</span>, <span class="number">88171850234002600580608014259219586239590114856448092326801813245774395730496</span>, <span class="number">5113619435362108938262679062561727235116615800676783173565082653599747645155</span>, <span class="number">54576089683044230333058389148818602636893918880220233916359714009830588044131</span>, <span class="number">46319652232696496987147414399965164805770427009639155019904825551069668519260</span>, <span class="number">92142202700489403870481152403139465532735056770434774464930082474517829581964</span>, <span class="number">9084526539780165183228300902059842905058839285187659313361650962576085292818</span>, <span class="number">89120115360204223476154240731792191817638074392691790750005020564226279037550</span>, <span class="number">108874944765319253896194176909539011617418473448207058050594223215460183828033</span>, <span class="number">48697630410338199345605370644643425030874923782845194702123578264330641464094</span>, <span class="number">90490831141215467713642375752174358047945797806394912036159392371419919773636</span>, <span class="number">5407847525945777533863763148921176292074562577253075889320641646783216244238</span>, <span class="number">95326999116234880776873896438659550308182265903511015349887289749187746932743</span>, <span class="number">13848646478536701368088661040908693291788138011605835864557858216170511016083</span>, <span class="number">12688154545015600072136788151484672710661959298941783293908174000377900727747</span>, <span class="number">103416430654164637952330806792686485956010294787748757584715063906414248209722</span>, <span class="number">36213989454986448247979083323211284869162879484215027121399406834805531673463</span>, <span class="number">83477199408920970502661396196378764693640078246444907844363833717275362253336</span>, <span class="number">54685544287120130615023910691215446521783587675140445694155062634358785975223</span>, <span class="number">57209914633582227771666953772776413914105217956486621477363100169491699389485</span>, <span class="number">60722705656546434007907580733214759241271810206392571495455413850603913610651</span>, <span class="number">62666312072142619643565102615355724228875566515181602729719018682721112131326</span>, <span class="number">17892029370519322177254795109531838575579273633357811419566887056272012019617</span>, <span class="number">23387537005911727415991488713130020055341902697712259630978747015670850612866</span>, <span class="number">57084096974333718635810536400151484653413307540676932220675888461543384910791</span>, <span class="number">64672020284448913361212245534680048800817888816777270292913433441383929287826</span>, <span class="number">30879668079119218442051482226185849538064516289533962210948424807374221747937</span>, <span class="number">67805294126621083377517953883639091568886644480832055617022550683600509359637</span>, <span class="number">80971248361778969534551851802629859076303703583702628504189145200772632698437</span>]</span><br><span class="line">B1 = [<span class="number">185</span>, <span class="number">121</span>, <span class="number">74</span>, <span class="number">192</span>, <span class="number">66</span>, <span class="number">208</span>, <span class="number">189</span>, <span class="number">5</span>, <span class="number">248</span>, <span class="number">216</span>, <span class="number">222</span>, <span class="number">49</span>, <span class="number">199</span>, <span class="number">122</span>, <span class="number">212</span>, <span class="number">109</span>, <span class="number">36</span>, <span class="number">135</span>, <span class="number">9</span>, <span class="number">43</span>, <span class="number">94</span>, <span class="number">192</span>, <span class="number">67</span>, <span class="number">176</span>, <span class="number">165</span>, <span class="number">34</span>, <span class="number">241</span>, <span class="number">27</span>, <span class="number">255</span>, <span class="number">216</span>, <span class="number">71</span>, <span class="number">156</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(B1)):</span><br><span class="line">    B1[i] = (B1[i]&lt;&lt;<span class="number">248</span>) + <span class="number">2</span>^<span class="number">247</span></span><br><span class="line"></span><br><span class="line">L1 = Matrix(ZZ,<span class="number">1</span>+<span class="built_in">len</span>(A1),<span class="number">1</span>+<span class="built_in">len</span>(A1))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A1)-<span class="number">1</span>):</span><br><span class="line">    L1[i,i] = q</span><br><span class="line">    L1[-<span class="number">2</span>,i] = inverse(A1[<span class="number">0</span>],q)*A1[i+<span class="number">1</span>]%q</span><br><span class="line">    L1[-<span class="number">1</span>,i] = inverse(A1[<span class="number">0</span>],q)*(B1[<span class="number">0</span>]*A1[i+<span class="number">1</span>]-B1[i+<span class="number">1</span>]*A1[<span class="number">0</span>])%q</span><br><span class="line">L1[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">L1[-<span class="number">1</span>,-<span class="number">1</span>] = <span class="number">2</span>^<span class="number">247</span></span><br><span class="line"></span><br><span class="line">res = L1.BKZ(block_size=<span class="number">16</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="keyword">if</span>(check_high(i,A1,B1,q,<span class="number">248</span>) == <span class="literal">True</span>):</span><br><span class="line">        B0_low = i[-<span class="number">2</span>]</span><br><span class="line">        B0 = B1[<span class="number">0</span>] - B0_low</span><br><span class="line">        x = inverse(A1[<span class="number">0</span>],q)*B0 % q</span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Part1 Done!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="泄露低8位"><a href="#泄露低8位" class="headerlink" title="泄露低8位"></a>泄露低8位</h4><p>与泄漏高八位异曲同工，我们仍然按刚才的方式，消除x转化到HNP。然后也和预期一样，直接LLL或BKZ都出不了，界依然被卡了，所以还是要改变拆分方式。</p>
<p>已知低八位时，正常应该如下拆分：</p>
<script type="math/tex; mode=display">
b_i = 2^{8}b_{hi} + b_{li} \quad(mod\;q)</script><p>同样的道理，我们现在规约出来的目标向量的每一项应该是bhi，要想办法降低他的数量级。所以处理手段也基本一样，我们拆成如下形式就好：</p>
<script type="math/tex; mode=display">
b_i = 2^{8}(b_{hi}-2^{247}) + (2^{255}+b_{li}) \quad(mod\;q)</script><p>最要命的是这样规约依然出不了，但是没想到其他优化方式了，于是就只能不断抬高BKZ算法的blocksize，发现由于格的维数并不高，所以blocksize提高很多也不会有多慢，抬到30后总算是出结果了。</p>
<p>依然也需要核验，不过道理相同，同样也应该会存在bug。</p>
<p>这一部分exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_low</span>(<span class="params">res,A1,B1,q,bits</span>):</span><br><span class="line">    <span class="keyword">if</span>(res[-<span class="number">1</span>] == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    B0_high = res[-<span class="number">2</span>]</span><br><span class="line">    B0 = <span class="number">2</span>^bits*B0_high + B1[<span class="number">0</span>]</span><br><span class="line">    x0 = inverse(A1[<span class="number">0</span>],q)*B0 % q</span><br><span class="line"></span><br><span class="line">    B_1 = [i-<span class="number">2</span>^<span class="number">255</span> <span class="keyword">for</span> i <span class="keyword">in</span> B1] </span><br><span class="line">    B_2 = [(i*x0 % q) &amp; ((<span class="number">2</span>^bits)-<span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> A1]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(B_1 == B_2):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#part2 low_8_bits</span></span><br><span class="line">Round = <span class="number">33</span></span><br><span class="line">q = <span class="number">115792089237316195423570985008687907853269984665640564039457584007913129639747</span></span><br><span class="line">A1 = [<span class="number">46504565744057869379592149118750005180204315285587793650459698458291497313095</span>, <span class="number">58007957093934046182693035826219870499452741234326847327688846747059237094075</span>, <span class="number">50185124619087453830679170251457196445767905313509337058697814870412730362947</span>, <span class="number">13460057838246434192804076595664204927155595158673092664009965681276162112064</span>, <span class="number">1701081975560116286696366369808334022446618430663926380667987754925635360535</span>, <span class="number">26884871731419084105623632272724863769910293366201375037286643905133449526668</span>, <span class="number">86148369125917615329995354501659454507150263427394081644953922899405044908942</span>, <span class="number">86965847264933041291798488655625963084424620038983026175910367027955449692128</span>, <span class="number">51359332101276868450990110421905601457823984827989287103931757850844231666586</span>, <span class="number">48796757902016638482644909388959646721244669665114474829651238484065619118952</span>, <span class="number">100070448202859232758452766870542683109402601193511866026529530855112793822109</span>, <span class="number">96580256984898125874774601478072811945116066886633284314860596683569097605765</span>, <span class="number">38808894076998102467847013020946201384521577320197543440467015636483307894892</span>, <span class="number">4134554141092625841029701614640247691101835437566908306546904884177729072687</span>, <span class="number">74873085435488619613395208820994521773265984299598688734149106712561237976724</span>, <span class="number">15654842239708870234259249156913701671624803564647865424705391694462101457862</span>, <span class="number">88322093034453332197643606249439750127876581478584569790806716889277489637972</span>, <span class="number">22499556277754006237442593359493863007223009260764163505327306701416065559119</span>, <span class="number">67089035688878297307085968283413144678391442218184879365509351597884743967932</span>, <span class="number">27674630243557284124557851587722479960748242794492773619925160133318279977692</span>, <span class="number">9119521864491019262790789925266797995577993021425216600126182732190292182948</span>, <span class="number">101288882073195598657612116292233377922026161322404160341330451374348438098216</span>, <span class="number">67804446744028818432860934046262550895247933787912806120088242004054790700495</span>, <span class="number">26086948144209799352019678059923693118044934151861294461002114985645656470189</span>, <span class="number">38144657569843600236424138168852321656171547769351620499893335164030638528328</span>, <span class="number">29607623036881080673594862278805535156351844098214001235565521439825687173709</span>, <span class="number">73322408962909922161031457562287596779866102699954700495813418822123077110802</span>, <span class="number">71841446787131237842866428647552570448973984694577468650052516966413175250298</span>, <span class="number">1230436323839997562475731649322922330998915952913300933165504728647309839568</span>, <span class="number">107223013661981482036189531938571461516528131559156846625598018135279924645933</span>, <span class="number">40439925178577390217639900040814034803597438472158408491211685077053585300286</span>, <span class="number">26978587850306490903937574562860250724695533954879823140348556476663322417613</span>, <span class="number">82195886203427304567763311291077205482622324404366375181470500496565215770146</span>]</span><br><span class="line">B1 = [<span class="number">115</span>, <span class="number">240</span>, <span class="number">228</span>, <span class="number">198</span>, <span class="number">160</span>, <span class="number">178</span>, <span class="number">214</span>, <span class="number">160</span>, <span class="number">96</span>, <span class="number">140</span>, <span class="number">89</span>, <span class="number">186</span>, <span class="number">159</span>, <span class="number">102</span>, <span class="number">192</span>, <span class="number">93</span>, <span class="number">135</span>, <span class="number">30</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">138</span>, <span class="number">224</span>, <span class="number">109</span>, <span class="number">116</span>, <span class="number">76</span>, <span class="number">116</span>, <span class="number">180</span>, <span class="number">196</span>, <span class="number">121</span>, <span class="number">187</span>, <span class="number">210</span>, <span class="number">208</span>, <span class="number">14</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(B1)):</span><br><span class="line">    B1[i] += <span class="number">2</span>^<span class="number">255</span></span><br><span class="line">L1 = Matrix(ZZ,<span class="number">1</span>+<span class="built_in">len</span>(A1),<span class="number">1</span>+<span class="built_in">len</span>(A1))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A1)-<span class="number">1</span>):</span><br><span class="line">    L1[i,i] = q</span><br><span class="line">    L1[-<span class="number">2</span>,i] = inverse(A1[<span class="number">0</span>],q)*A1[i+<span class="number">1</span>]%q</span><br><span class="line">    L1[-<span class="number">1</span>,i] = inverse(A1[<span class="number">0</span>]*<span class="number">2</span>^<span class="number">8</span>,q)*(B1[<span class="number">0</span>]*A1[i+<span class="number">1</span>]-B1[i+<span class="number">1</span>]*A1[<span class="number">0</span>])%q</span><br><span class="line">L1[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">L1[-<span class="number">1</span>,-<span class="number">1</span>] = <span class="number">2</span>^<span class="number">247</span></span><br><span class="line"></span><br><span class="line">res1 = L1.BKZ(block_size=<span class="number">30</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">    <span class="keyword">if</span>(check_low(i,A1,B1,q,<span class="number">8</span>)):</span><br><span class="line">        B0_high = i[-<span class="number">2</span>]</span><br><span class="line">        B0 = <span class="number">2</span>^<span class="number">8</span>*B0_high + B1[<span class="number">0</span>]</span><br><span class="line">        y = inverse(A1[<span class="number">0</span>],q)*B0 % q</span><br><span class="line">        <span class="built_in">print</span>(y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Part2 Done!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="泄露高4位"><a href="#泄露高4位" class="headerlink" title="泄露高4位"></a>泄露高4位</h4><p>这一部分和第一部分就没什么差别了，优化手段也是一样，但是blocksize要适当提高，我这里是抬到22后出了结果。而且由于数据也更多，耗时也会相对更久。</p>
<p>这一部分exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_high</span>(<span class="params">res,A1,B1,q,bits</span>):</span><br><span class="line">    <span class="keyword">if</span>(res[-<span class="number">1</span>] == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    B0_low = res[-<span class="number">2</span>]</span><br><span class="line">    B0 = B1[<span class="number">0</span>] - B0_low</span><br><span class="line">    x0 = inverse(A1[<span class="number">0</span>],q)*B0 % q</span><br><span class="line"></span><br><span class="line">    B_1 = [(i-<span class="number">2</span>^(bits-<span class="number">1</span>)) &gt;&gt; bits  <span class="keyword">for</span> i <span class="keyword">in</span> B1] </span><br><span class="line">    B_2 = [(i*x0 % q) &gt;&gt; bits <span class="keyword">for</span> i <span class="keyword">in</span> A1]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(B_1 == B_2):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#part3 high_4_bits</span></span><br><span class="line">Round = <span class="number">103</span></span><br><span class="line">q = <span class="number">2</span>**<span class="number">256</span></span><br><span class="line">A1 = [<span class="number">56666422659665306957613341966104139188430887040369382699811066965734652038579</span>, <span class="number">41608423494025514337106193470276163502869431432921281068110444274310186909892</span>, <span class="number">95312645577996377489331859379729367791539181995403307071242251663306260824059</span>, <span class="number">114007089082826788908311397311915638668862713690403097281136795912671634293903</span>, <span class="number">77470602549297888428039543840134276433567854766634294661906479236200644990851</span>, <span class="number">67265570384781545307301479187933437206481537999752352862466291209724038113997</span>, <span class="number">101015220564168271842813302532972922828562060680762307341661161853013181455988</span>, <span class="number">73596220918173964622453801478597395507613363519777836354319778006747628725943</span>, <span class="number">80276240092293162850897330969848557221924558822619435206166856373482558821153</span>, <span class="number">60387041856575123107349887176488814324533329129026453912394888320971261329267</span>, <span class="number">37588667650535221417005569007639921039223353621264869144904381190769978830432</span>, <span class="number">30201673227033963823582196954697293400001560479877858941307825349312312395908</span>, <span class="number">46517796724693810353256110303591718873843585558937781709113232176049614134229</span>, <span class="number">110476911183528409932385631377040635032167229294859921626233104995069707326026</span>, <span class="number">33913880276956766352570275848477001195330941450588079882929631222080051897977</span>, <span class="number">108738411950576541236703456832793461013595057668683247592686862598082364613770</span>, <span class="number">87211442745029489881514515811064102429019356351722823450170249465088775249507</span>, <span class="number">39600946693670273230261533720839589755726946308581706825676138619972092199256</span>, <span class="number">4979886914346369664911891403751631037886315717549974065878536283157637402320</span>, <span class="number">22272529908653383795002294860870129574984518813560375272257703512940569602004</span>, <span class="number">100135751785995415247695765442899140606914076750888419237400306294448451415863</span>, <span class="number">85613534858376605408667291532701284666560850915689941354202786014968649139457</span>, <span class="number">38496246133430733988750968353732662162312705079114417415163071485082991344590</span>, <span class="number">55980481790171446152748793757788577465044360548729573345122559743628093363153</span>, <span class="number">71280277172994137969689292719624075379102489317199533126561191722460505314026</span>, <span class="number">110446223482446943024326135434573497276437669060614612856002207641927747194266</span>, <span class="number">16456085922385532110267651711339329146652084370610067373716816178321924748791</span>, <span class="number">101653629730678493695114228522885120593522618541788967122785214737946157867999</span>, <span class="number">74467527492811608068163160348674720595757862332879609098404557441577413104820</span>, <span class="number">41884843126443673947662657085537596879702074001592844509379139860812151553968</span>, <span class="number">29815687077578101251522932333124915023192910276895021601688368611558697857638</span>, <span class="number">44840628789800333625015337751638405696233468515566263356197320268202190223769</span>, <span class="number">102427595787595418722722430130631701884337456325150921017413824991597185452849</span>, <span class="number">2975107125099035075044003816426206055437890428466365543585422202932381886186</span>, <span class="number">94699511483779321185024950255977801474453881858185354369860946591141828290326</span>, <span class="number">31810607567540037649472765223870019465281477418301020106850480432511306591757</span>, <span class="number">75713781109794200255529510371465092460190607870508383754795316160075282283862</span>, <span class="number">55429849762380955520557448208384572772400405309708977900727750338226215580736</span>, <span class="number">71351843550447097631722656769410630908972124288367169285559142896305583201390</span>, <span class="number">84145371680533342029399999651802676680665442500082991947093355443249540103162</span>, <span class="number">18059328520840928370924328960454198116073475240703647573736616851363995779497</span>, <span class="number">83839387396741626377342400188482404639827411621171844172874897800772466334269</span>, <span class="number">25788978353065311499638204532308969267343091396798096623404684254370926606489</span>, <span class="number">46416171203559401945669998573205329748734005210989064607057470628982156110053</span>, <span class="number">42839223735347899899704913105525407073907314464785013094063759450820513757342</span>, <span class="number">88826657766811054515837039931572449230721258604658317309512814974116100196733</span>, <span class="number">53796508595019468595537500010909399217450133587528313928622717009905225347437</span>, <span class="number">56531378551320964008977461547054273860909442858252049481923559030063639435057</span>, <span class="number">48217679285988263588226655808041000825638438349841115697751615792350031644869</span>, <span class="number">64424297190010710116212288045994884168253983939992794298642423963632550451160</span>, <span class="number">46474911280506479688705284230861217499981118516937627597481370505066926962182</span>, <span class="number">64032029526907010327735757773865326038078238679652707012855320952596919166618</span>, <span class="number">5529383900219431454017233184818428510888383480088262580036064976358985800985</span>, <span class="number">69322608357555546086372761692837205200171798855109065251575534608627560525776</span>, <span class="number">76098979682650954216202311601813089916970156784884278240596741668163729505020</span>, <span class="number">91674126062289237651839995587104059408995800143522837051179562018281051100557</span>, <span class="number">90571390404208688843585603192800843878382529323359914123528861146103857760661</span>, <span class="number">72012664155317843790423022518639753138262519729890141457716216773019826138388</span>, <span class="number">66863180243825712563555363518892364864799935770917594234609418534062748300787</span>, <span class="number">5838945753982677965177087293687053018953448675487050703226841119623778529018</span>, <span class="number">4440280122867898274880560103713163505203269339591832639427292037957483435863</span>, <span class="number">113585052040012311817152621651926546174704034369418207806360593735979071392560</span>, <span class="number">96503008028224334771028807273628056037391407459560685791940303889130903300826</span>, <span class="number">67050454088005224845748627326789053425990922831763041158174139321910165797537</span>, <span class="number">56354656300386637831392267891729486882144501924180334206591055551662859511145</span>, <span class="number">108875538744684454340615686969559999736352047181969993978724550037003168200211</span>, <span class="number">105856150301241056513738964497224079598648612469774416566110150235952602587129</span>, <span class="number">103072133631485922917570773603973545510240103328265914435430955113182187850847</span>, <span class="number">105071449786380370702657927006338895312230491406739601631939501577997184496876</span>, <span class="number">101559564666645844079948496433098525970583827093303201782110972272082979410831</span>, <span class="number">45696832977481706385123240351386677526237953026854755659089774125668886575190</span>, <span class="number">92930863035601609905246064160817660898443604755800516139761871009073979122573</span>, <span class="number">7136157467487063026530735850363136522687472196852313490264738121297870888865</span>, <span class="number">62220552837071854508303645903133799707167271140998125870619424819338409845248</span>, <span class="number">71964156627499707284955744986659480338185350890617779236004729406075442337650</span>, <span class="number">56432954135882530785013240455908855171502152827770214700998108134515682426307</span>, <span class="number">24818258540494883741910232014072726664585493319546426193565346084848631309292</span>, <span class="number">68946604449180849807706382163388201284725162066731407078323925073762784383918</span>, <span class="number">78305860067531640486978712479618549593532447916095131216323237767823095149213</span>, <span class="number">40019412274222034245452650116905171509558126077504657023971877193155638952620</span>, <span class="number">6226049816877252622825028481234412013581804081798123571329306780957341285518</span>, <span class="number">72008834916679466207298598830558721788070004796890262626592503036925690499953</span>, <span class="number">24120184417962346330989331701326680837413020607663960631051474032512470756250</span>, <span class="number">106358126840983882959473879360172954895361540456426525458062716824086971706859</span>, <span class="number">96125062326106069117227627865988038851006615609777159985287487409738006940292</span>, <span class="number">33054514553432552301350757403482219452773112411443533998213496297361397155535</span>, <span class="number">41581969631676286214097564630767898944747546622643163224140263014954932195321</span>, <span class="number">22904365609725269502635057676962583581851475921482302591306344959978794545764</span>, <span class="number">64290237869656947632842147827818163107378784367086448814380499121557877108860</span>, <span class="number">30680084243764095315357070546550118749025091482163732007754607769361116153541</span>, <span class="number">13691292022145271355849518605344621718116294468846185203111794890637243685470</span>, <span class="number">25132284761110457596793743234989234799586919369754843892751414241493192284491</span>, <span class="number">12389505381820778753642609476404562621082110924974170017133920070419933455780</span>, <span class="number">71535924312884292159182314202796515340797288002505186265430063222078901533504</span>, <span class="number">12742977582401193716850400144097310370558409977576217736024733304490605337769</span>, <span class="number">75139886864475235332970108571588085544527733256425836467715638485512421268158</span>, <span class="number">106812400623906721014312287501764424395430875573845869345085033374152396156108</span>, <span class="number">91345106193584221920864389152087560188260652160092982315871571692181571481755</span>, <span class="number">65785148879985691725045496265911886841068140761050563941336015575029243383380</span>, <span class="number">1452703135528066004669796386925101704795733053841911703671961494738444465175</span>, <span class="number">44818107645190027629062089844645267760294751459286511227307352668787518517867</span>, <span class="number">26767624780451051554599928370950639364780468287039403780345758419855142782301</span>, <span class="number">73520682616655688427241752929498638616275480985470608873569998909405046919540</span>]</span><br><span class="line">B1 = [<span class="number">11</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(B1)):</span><br><span class="line">    B1[i] = (B1[i]&lt;&lt;<span class="number">252</span>) + <span class="number">2</span>^<span class="number">251</span></span><br><span class="line"></span><br><span class="line">L1 = Matrix(ZZ,<span class="number">1</span>+<span class="built_in">len</span>(A1),<span class="number">1</span>+<span class="built_in">len</span>(A1))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A1)-<span class="number">1</span>):</span><br><span class="line">    L1[i,i] = q</span><br><span class="line">    L1[-<span class="number">2</span>,i] = inverse(A1[<span class="number">0</span>],q)*A1[i+<span class="number">1</span>]%q</span><br><span class="line">    L1[-<span class="number">1</span>,i] = inverse(A1[<span class="number">0</span>],q)*(B1[<span class="number">0</span>]*A1[i+<span class="number">1</span>]-B1[i+<span class="number">1</span>]*A1[<span class="number">0</span>])%q</span><br><span class="line">L1[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">L1[-<span class="number">1</span>,-<span class="number">1</span>] = <span class="number">2</span>^<span class="number">251</span></span><br><span class="line"></span><br><span class="line">res = L1.BKZ(block_size=<span class="number">22</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="keyword">if</span>(check_high(i,A1,B1,q,<span class="number">252</span>) == <span class="literal">True</span>):</span><br><span class="line">        B0_low = i[-<span class="number">2</span>]</span><br><span class="line">        B0 = B1[<span class="number">0</span>] - B0_low</span><br><span class="line">        z = inverse(A1[<span class="number">0</span>],q)*B0 % q</span><br><span class="line">        <span class="built_in">print</span>(z)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Part3 Done!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">guass_Heuristic</span>(<span class="params">L</span>):</span><br><span class="line">    n = L.nrows()</span><br><span class="line">    efficient = (n/(<span class="number">2</span>*math.pi*math.e))**(<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(efficient*iroot(<span class="built_in">abs</span>(L.det()),n)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_high</span>(<span class="params">res,A1,B1,q,bits</span>):</span><br><span class="line">    <span class="keyword">if</span>(res[-<span class="number">1</span>] == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    B0_low = res[-<span class="number">2</span>]</span><br><span class="line">    B0 = B1[<span class="number">0</span>] - B0_low</span><br><span class="line">    x0 = inverse(A1[<span class="number">0</span>],q)*B0 % q</span><br><span class="line"></span><br><span class="line">    B_1 = [(i-<span class="number">2</span>^(bits-<span class="number">1</span>)) &gt;&gt; bits  <span class="keyword">for</span> i <span class="keyword">in</span> B1] </span><br><span class="line">    B_2 = [(i*x0 % q) &gt;&gt; bits <span class="keyword">for</span> i <span class="keyword">in</span> A1]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(B_1 == B_2):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_low</span>(<span class="params">res,A1,B1,q,bits</span>):</span><br><span class="line">    <span class="keyword">if</span>(res[-<span class="number">1</span>] == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    B0_high = res[-<span class="number">2</span>]</span><br><span class="line">    B0 = <span class="number">2</span>^bits*B0_high + B1[<span class="number">0</span>]</span><br><span class="line">    x0 = inverse(A1[<span class="number">0</span>],q)*B0 % q</span><br><span class="line"></span><br><span class="line">    B_1 = [i-<span class="number">2</span>^<span class="number">255</span> <span class="keyword">for</span> i <span class="keyword">in</span> B1] </span><br><span class="line">    B_2 = [(i*x0 % q) &amp; ((<span class="number">2</span>^bits)-<span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> A1]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(B_1 == B_2):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#part1 high_8_bits</span></span><br><span class="line">Round = <span class="number">32</span></span><br><span class="line">q = <span class="number">2</span> ** <span class="number">256</span></span><br><span class="line">A1 = [<span class="number">3561678147813669042672186969104055553515262226168087322052560790885260761433</span>, <span class="number">17346407693442644010055116546363960164095133759884497841925887458500171929994</span>, <span class="number">10970839811545507511408260800883769581649579684426188079142754412064502787585</span>, <span class="number">109417222922540235139013912297145185193443712852193270682885305502867182588403</span>, <span class="number">88171850234002600580608014259219586239590114856448092326801813245774395730496</span>, <span class="number">5113619435362108938262679062561727235116615800676783173565082653599747645155</span>, <span class="number">54576089683044230333058389148818602636893918880220233916359714009830588044131</span>, <span class="number">46319652232696496987147414399965164805770427009639155019904825551069668519260</span>, <span class="number">92142202700489403870481152403139465532735056770434774464930082474517829581964</span>, <span class="number">9084526539780165183228300902059842905058839285187659313361650962576085292818</span>, <span class="number">89120115360204223476154240731792191817638074392691790750005020564226279037550</span>, <span class="number">108874944765319253896194176909539011617418473448207058050594223215460183828033</span>, <span class="number">48697630410338199345605370644643425030874923782845194702123578264330641464094</span>, <span class="number">90490831141215467713642375752174358047945797806394912036159392371419919773636</span>, <span class="number">5407847525945777533863763148921176292074562577253075889320641646783216244238</span>, <span class="number">95326999116234880776873896438659550308182265903511015349887289749187746932743</span>, <span class="number">13848646478536701368088661040908693291788138011605835864557858216170511016083</span>, <span class="number">12688154545015600072136788151484672710661959298941783293908174000377900727747</span>, <span class="number">103416430654164637952330806792686485956010294787748757584715063906414248209722</span>, <span class="number">36213989454986448247979083323211284869162879484215027121399406834805531673463</span>, <span class="number">83477199408920970502661396196378764693640078246444907844363833717275362253336</span>, <span class="number">54685544287120130615023910691215446521783587675140445694155062634358785975223</span>, <span class="number">57209914633582227771666953772776413914105217956486621477363100169491699389485</span>, <span class="number">60722705656546434007907580733214759241271810206392571495455413850603913610651</span>, <span class="number">62666312072142619643565102615355724228875566515181602729719018682721112131326</span>, <span class="number">17892029370519322177254795109531838575579273633357811419566887056272012019617</span>, <span class="number">23387537005911727415991488713130020055341902697712259630978747015670850612866</span>, <span class="number">57084096974333718635810536400151484653413307540676932220675888461543384910791</span>, <span class="number">64672020284448913361212245534680048800817888816777270292913433441383929287826</span>, <span class="number">30879668079119218442051482226185849538064516289533962210948424807374221747937</span>, <span class="number">67805294126621083377517953883639091568886644480832055617022550683600509359637</span>, <span class="number">80971248361778969534551851802629859076303703583702628504189145200772632698437</span>]</span><br><span class="line">B1 = [<span class="number">185</span>, <span class="number">121</span>, <span class="number">74</span>, <span class="number">192</span>, <span class="number">66</span>, <span class="number">208</span>, <span class="number">189</span>, <span class="number">5</span>, <span class="number">248</span>, <span class="number">216</span>, <span class="number">222</span>, <span class="number">49</span>, <span class="number">199</span>, <span class="number">122</span>, <span class="number">212</span>, <span class="number">109</span>, <span class="number">36</span>, <span class="number">135</span>, <span class="number">9</span>, <span class="number">43</span>, <span class="number">94</span>, <span class="number">192</span>, <span class="number">67</span>, <span class="number">176</span>, <span class="number">165</span>, <span class="number">34</span>, <span class="number">241</span>, <span class="number">27</span>, <span class="number">255</span>, <span class="number">216</span>, <span class="number">71</span>, <span class="number">156</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(B1)):</span><br><span class="line">    B1[i] = (B1[i]&lt;&lt;<span class="number">248</span>) + <span class="number">2</span>^<span class="number">247</span></span><br><span class="line"></span><br><span class="line">L1 = Matrix(ZZ,<span class="number">1</span>+<span class="built_in">len</span>(A1),<span class="number">1</span>+<span class="built_in">len</span>(A1))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A1)-<span class="number">1</span>):</span><br><span class="line">    L1[i,i] = q</span><br><span class="line">    L1[-<span class="number">2</span>,i] = inverse(A1[<span class="number">0</span>],q)*A1[i+<span class="number">1</span>]%q</span><br><span class="line">    L1[-<span class="number">1</span>,i] = inverse(A1[<span class="number">0</span>],q)*(B1[<span class="number">0</span>]*A1[i+<span class="number">1</span>]-B1[i+<span class="number">1</span>]*A1[<span class="number">0</span>])%q</span><br><span class="line">L1[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">L1[-<span class="number">1</span>,-<span class="number">1</span>] = <span class="number">2</span>^<span class="number">247</span></span><br><span class="line"></span><br><span class="line">res = L1.BKZ(block_size=<span class="number">16</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="keyword">if</span>(check_high(i,A1,B1,q,<span class="number">248</span>) == <span class="literal">True</span>):</span><br><span class="line">        B0_low = i[-<span class="number">2</span>]</span><br><span class="line">        B0 = B1[<span class="number">0</span>] - B0_low</span><br><span class="line">        x = inverse(A1[<span class="number">0</span>],q)*B0 % q</span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Part1 Done!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 low_8_bits</span></span><br><span class="line">Round = <span class="number">33</span></span><br><span class="line">q = <span class="number">115792089237316195423570985008687907853269984665640564039457584007913129639747</span></span><br><span class="line">A1 = [<span class="number">46504565744057869379592149118750005180204315285587793650459698458291497313095</span>, <span class="number">58007957093934046182693035826219870499452741234326847327688846747059237094075</span>, <span class="number">50185124619087453830679170251457196445767905313509337058697814870412730362947</span>, <span class="number">13460057838246434192804076595664204927155595158673092664009965681276162112064</span>, <span class="number">1701081975560116286696366369808334022446618430663926380667987754925635360535</span>, <span class="number">26884871731419084105623632272724863769910293366201375037286643905133449526668</span>, <span class="number">86148369125917615329995354501659454507150263427394081644953922899405044908942</span>, <span class="number">86965847264933041291798488655625963084424620038983026175910367027955449692128</span>, <span class="number">51359332101276868450990110421905601457823984827989287103931757850844231666586</span>, <span class="number">48796757902016638482644909388959646721244669665114474829651238484065619118952</span>, <span class="number">100070448202859232758452766870542683109402601193511866026529530855112793822109</span>, <span class="number">96580256984898125874774601478072811945116066886633284314860596683569097605765</span>, <span class="number">38808894076998102467847013020946201384521577320197543440467015636483307894892</span>, <span class="number">4134554141092625841029701614640247691101835437566908306546904884177729072687</span>, <span class="number">74873085435488619613395208820994521773265984299598688734149106712561237976724</span>, <span class="number">15654842239708870234259249156913701671624803564647865424705391694462101457862</span>, <span class="number">88322093034453332197643606249439750127876581478584569790806716889277489637972</span>, <span class="number">22499556277754006237442593359493863007223009260764163505327306701416065559119</span>, <span class="number">67089035688878297307085968283413144678391442218184879365509351597884743967932</span>, <span class="number">27674630243557284124557851587722479960748242794492773619925160133318279977692</span>, <span class="number">9119521864491019262790789925266797995577993021425216600126182732190292182948</span>, <span class="number">101288882073195598657612116292233377922026161322404160341330451374348438098216</span>, <span class="number">67804446744028818432860934046262550895247933787912806120088242004054790700495</span>, <span class="number">26086948144209799352019678059923693118044934151861294461002114985645656470189</span>, <span class="number">38144657569843600236424138168852321656171547769351620499893335164030638528328</span>, <span class="number">29607623036881080673594862278805535156351844098214001235565521439825687173709</span>, <span class="number">73322408962909922161031457562287596779866102699954700495813418822123077110802</span>, <span class="number">71841446787131237842866428647552570448973984694577468650052516966413175250298</span>, <span class="number">1230436323839997562475731649322922330998915952913300933165504728647309839568</span>, <span class="number">107223013661981482036189531938571461516528131559156846625598018135279924645933</span>, <span class="number">40439925178577390217639900040814034803597438472158408491211685077053585300286</span>, <span class="number">26978587850306490903937574562860250724695533954879823140348556476663322417613</span>, <span class="number">82195886203427304567763311291077205482622324404366375181470500496565215770146</span>]</span><br><span class="line">B1 = [<span class="number">115</span>, <span class="number">240</span>, <span class="number">228</span>, <span class="number">198</span>, <span class="number">160</span>, <span class="number">178</span>, <span class="number">214</span>, <span class="number">160</span>, <span class="number">96</span>, <span class="number">140</span>, <span class="number">89</span>, <span class="number">186</span>, <span class="number">159</span>, <span class="number">102</span>, <span class="number">192</span>, <span class="number">93</span>, <span class="number">135</span>, <span class="number">30</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">138</span>, <span class="number">224</span>, <span class="number">109</span>, <span class="number">116</span>, <span class="number">76</span>, <span class="number">116</span>, <span class="number">180</span>, <span class="number">196</span>, <span class="number">121</span>, <span class="number">187</span>, <span class="number">210</span>, <span class="number">208</span>, <span class="number">14</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(B1)):</span><br><span class="line">    B1[i] += <span class="number">2</span>^<span class="number">255</span></span><br><span class="line">L1 = Matrix(ZZ,<span class="number">1</span>+<span class="built_in">len</span>(A1),<span class="number">1</span>+<span class="built_in">len</span>(A1))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A1)-<span class="number">1</span>):</span><br><span class="line">    L1[i,i] = q</span><br><span class="line">    L1[-<span class="number">2</span>,i] = inverse(A1[<span class="number">0</span>],q)*A1[i+<span class="number">1</span>]%q</span><br><span class="line">    L1[-<span class="number">1</span>,i] = inverse(A1[<span class="number">0</span>]*<span class="number">2</span>^<span class="number">8</span>,q)*(B1[<span class="number">0</span>]*A1[i+<span class="number">1</span>]-B1[i+<span class="number">1</span>]*A1[<span class="number">0</span>])%q</span><br><span class="line">L1[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">L1[-<span class="number">1</span>,-<span class="number">1</span>] = <span class="number">2</span>^<span class="number">247</span></span><br><span class="line"></span><br><span class="line">res1 = L1.BKZ(block_size=<span class="number">30</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">    <span class="keyword">if</span>(check_low(i,A1,B1,q,<span class="number">8</span>)):</span><br><span class="line">        B0_high = i[-<span class="number">2</span>]</span><br><span class="line">        B0 = <span class="number">2</span>^<span class="number">8</span>*B0_high + B1[<span class="number">0</span>]</span><br><span class="line">        y = inverse(A1[<span class="number">0</span>],q)*B0 % q</span><br><span class="line">        <span class="built_in">print</span>(y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Part2 Done!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 high_4_bits</span></span><br><span class="line">Round = <span class="number">103</span></span><br><span class="line">q = <span class="number">2</span>**<span class="number">256</span></span><br><span class="line">A1 = [<span class="number">56666422659665306957613341966104139188430887040369382699811066965734652038579</span>, <span class="number">41608423494025514337106193470276163502869431432921281068110444274310186909892</span>, <span class="number">95312645577996377489331859379729367791539181995403307071242251663306260824059</span>, <span class="number">114007089082826788908311397311915638668862713690403097281136795912671634293903</span>, <span class="number">77470602549297888428039543840134276433567854766634294661906479236200644990851</span>, <span class="number">67265570384781545307301479187933437206481537999752352862466291209724038113997</span>, <span class="number">101015220564168271842813302532972922828562060680762307341661161853013181455988</span>, <span class="number">73596220918173964622453801478597395507613363519777836354319778006747628725943</span>, <span class="number">80276240092293162850897330969848557221924558822619435206166856373482558821153</span>, <span class="number">60387041856575123107349887176488814324533329129026453912394888320971261329267</span>, <span class="number">37588667650535221417005569007639921039223353621264869144904381190769978830432</span>, <span class="number">30201673227033963823582196954697293400001560479877858941307825349312312395908</span>, <span class="number">46517796724693810353256110303591718873843585558937781709113232176049614134229</span>, <span class="number">110476911183528409932385631377040635032167229294859921626233104995069707326026</span>, <span class="number">33913880276956766352570275848477001195330941450588079882929631222080051897977</span>, <span class="number">108738411950576541236703456832793461013595057668683247592686862598082364613770</span>, <span class="number">87211442745029489881514515811064102429019356351722823450170249465088775249507</span>, <span class="number">39600946693670273230261533720839589755726946308581706825676138619972092199256</span>, <span class="number">4979886914346369664911891403751631037886315717549974065878536283157637402320</span>, <span class="number">22272529908653383795002294860870129574984518813560375272257703512940569602004</span>, <span class="number">100135751785995415247695765442899140606914076750888419237400306294448451415863</span>, <span class="number">85613534858376605408667291532701284666560850915689941354202786014968649139457</span>, <span class="number">38496246133430733988750968353732662162312705079114417415163071485082991344590</span>, <span class="number">55980481790171446152748793757788577465044360548729573345122559743628093363153</span>, <span class="number">71280277172994137969689292719624075379102489317199533126561191722460505314026</span>, <span class="number">110446223482446943024326135434573497276437669060614612856002207641927747194266</span>, <span class="number">16456085922385532110267651711339329146652084370610067373716816178321924748791</span>, <span class="number">101653629730678493695114228522885120593522618541788967122785214737946157867999</span>, <span class="number">74467527492811608068163160348674720595757862332879609098404557441577413104820</span>, <span class="number">41884843126443673947662657085537596879702074001592844509379139860812151553968</span>, <span class="number">29815687077578101251522932333124915023192910276895021601688368611558697857638</span>, <span class="number">44840628789800333625015337751638405696233468515566263356197320268202190223769</span>, <span class="number">102427595787595418722722430130631701884337456325150921017413824991597185452849</span>, <span class="number">2975107125099035075044003816426206055437890428466365543585422202932381886186</span>, <span class="number">94699511483779321185024950255977801474453881858185354369860946591141828290326</span>, <span class="number">31810607567540037649472765223870019465281477418301020106850480432511306591757</span>, <span class="number">75713781109794200255529510371465092460190607870508383754795316160075282283862</span>, <span class="number">55429849762380955520557448208384572772400405309708977900727750338226215580736</span>, <span class="number">71351843550447097631722656769410630908972124288367169285559142896305583201390</span>, <span class="number">84145371680533342029399999651802676680665442500082991947093355443249540103162</span>, <span class="number">18059328520840928370924328960454198116073475240703647573736616851363995779497</span>, <span class="number">83839387396741626377342400188482404639827411621171844172874897800772466334269</span>, <span class="number">25788978353065311499638204532308969267343091396798096623404684254370926606489</span>, <span class="number">46416171203559401945669998573205329748734005210989064607057470628982156110053</span>, <span class="number">42839223735347899899704913105525407073907314464785013094063759450820513757342</span>, <span class="number">88826657766811054515837039931572449230721258604658317309512814974116100196733</span>, <span class="number">53796508595019468595537500010909399217450133587528313928622717009905225347437</span>, <span class="number">56531378551320964008977461547054273860909442858252049481923559030063639435057</span>, <span class="number">48217679285988263588226655808041000825638438349841115697751615792350031644869</span>, <span class="number">64424297190010710116212288045994884168253983939992794298642423963632550451160</span>, <span class="number">46474911280506479688705284230861217499981118516937627597481370505066926962182</span>, <span class="number">64032029526907010327735757773865326038078238679652707012855320952596919166618</span>, <span class="number">5529383900219431454017233184818428510888383480088262580036064976358985800985</span>, <span class="number">69322608357555546086372761692837205200171798855109065251575534608627560525776</span>, <span class="number">76098979682650954216202311601813089916970156784884278240596741668163729505020</span>, <span class="number">91674126062289237651839995587104059408995800143522837051179562018281051100557</span>, <span class="number">90571390404208688843585603192800843878382529323359914123528861146103857760661</span>, <span class="number">72012664155317843790423022518639753138262519729890141457716216773019826138388</span>, <span class="number">66863180243825712563555363518892364864799935770917594234609418534062748300787</span>, <span class="number">5838945753982677965177087293687053018953448675487050703226841119623778529018</span>, <span class="number">4440280122867898274880560103713163505203269339591832639427292037957483435863</span>, <span class="number">113585052040012311817152621651926546174704034369418207806360593735979071392560</span>, <span class="number">96503008028224334771028807273628056037391407459560685791940303889130903300826</span>, <span class="number">67050454088005224845748627326789053425990922831763041158174139321910165797537</span>, <span class="number">56354656300386637831392267891729486882144501924180334206591055551662859511145</span>, <span class="number">108875538744684454340615686969559999736352047181969993978724550037003168200211</span>, <span class="number">105856150301241056513738964497224079598648612469774416566110150235952602587129</span>, <span class="number">103072133631485922917570773603973545510240103328265914435430955113182187850847</span>, <span class="number">105071449786380370702657927006338895312230491406739601631939501577997184496876</span>, <span class="number">101559564666645844079948496433098525970583827093303201782110972272082979410831</span>, <span class="number">45696832977481706385123240351386677526237953026854755659089774125668886575190</span>, <span class="number">92930863035601609905246064160817660898443604755800516139761871009073979122573</span>, <span class="number">7136157467487063026530735850363136522687472196852313490264738121297870888865</span>, <span class="number">62220552837071854508303645903133799707167271140998125870619424819338409845248</span>, <span class="number">71964156627499707284955744986659480338185350890617779236004729406075442337650</span>, <span class="number">56432954135882530785013240455908855171502152827770214700998108134515682426307</span>, <span class="number">24818258540494883741910232014072726664585493319546426193565346084848631309292</span>, <span class="number">68946604449180849807706382163388201284725162066731407078323925073762784383918</span>, <span class="number">78305860067531640486978712479618549593532447916095131216323237767823095149213</span>, <span class="number">40019412274222034245452650116905171509558126077504657023971877193155638952620</span>, <span class="number">6226049816877252622825028481234412013581804081798123571329306780957341285518</span>, <span class="number">72008834916679466207298598830558721788070004796890262626592503036925690499953</span>, <span class="number">24120184417962346330989331701326680837413020607663960631051474032512470756250</span>, <span class="number">106358126840983882959473879360172954895361540456426525458062716824086971706859</span>, <span class="number">96125062326106069117227627865988038851006615609777159985287487409738006940292</span>, <span class="number">33054514553432552301350757403482219452773112411443533998213496297361397155535</span>, <span class="number">41581969631676286214097564630767898944747546622643163224140263014954932195321</span>, <span class="number">22904365609725269502635057676962583581851475921482302591306344959978794545764</span>, <span class="number">64290237869656947632842147827818163107378784367086448814380499121557877108860</span>, <span class="number">30680084243764095315357070546550118749025091482163732007754607769361116153541</span>, <span class="number">13691292022145271355849518605344621718116294468846185203111794890637243685470</span>, <span class="number">25132284761110457596793743234989234799586919369754843892751414241493192284491</span>, <span class="number">12389505381820778753642609476404562621082110924974170017133920070419933455780</span>, <span class="number">71535924312884292159182314202796515340797288002505186265430063222078901533504</span>, <span class="number">12742977582401193716850400144097310370558409977576217736024733304490605337769</span>, <span class="number">75139886864475235332970108571588085544527733256425836467715638485512421268158</span>, <span class="number">106812400623906721014312287501764424395430875573845869345085033374152396156108</span>, <span class="number">91345106193584221920864389152087560188260652160092982315871571692181571481755</span>, <span class="number">65785148879985691725045496265911886841068140761050563941336015575029243383380</span>, <span class="number">1452703135528066004669796386925101704795733053841911703671961494738444465175</span>, <span class="number">44818107645190027629062089844645267760294751459286511227307352668787518517867</span>, <span class="number">26767624780451051554599928370950639364780468287039403780345758419855142782301</span>, <span class="number">73520682616655688427241752929498638616275480985470608873569998909405046919540</span>]</span><br><span class="line">B1 = [<span class="number">11</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(B1)):</span><br><span class="line">    B1[i] = (B1[i]&lt;&lt;<span class="number">252</span>) + <span class="number">2</span>^<span class="number">251</span></span><br><span class="line"></span><br><span class="line">L1 = Matrix(ZZ,<span class="number">1</span>+<span class="built_in">len</span>(A1),<span class="number">1</span>+<span class="built_in">len</span>(A1))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A1)-<span class="number">1</span>):</span><br><span class="line">    L1[i,i] = q</span><br><span class="line">    L1[-<span class="number">2</span>,i] = inverse(A1[<span class="number">0</span>],q)*A1[i+<span class="number">1</span>]%q</span><br><span class="line">    L1[-<span class="number">1</span>,i] = inverse(A1[<span class="number">0</span>],q)*(B1[<span class="number">0</span>]*A1[i+<span class="number">1</span>]-B1[i+<span class="number">1</span>]*A1[<span class="number">0</span>])%q</span><br><span class="line">L1[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">L1[-<span class="number">1</span>,-<span class="number">1</span>] = <span class="number">2</span>^<span class="number">251</span></span><br><span class="line"></span><br><span class="line">res = L1.BKZ(block_size=<span class="number">22</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="keyword">if</span>(check_high(i,A1,B1,q,<span class="number">252</span>) == <span class="literal">True</span>):</span><br><span class="line">        B0_low = i[-<span class="number">2</span>]</span><br><span class="line">        B0 = B1[<span class="number">0</span>] - B0_low</span><br><span class="line">        z = inverse(A1[<span class="number">0</span>],q)*B0 % q</span><br><span class="line">        <span class="built_in">print</span>(z)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Part3 Done!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part4 getflag</span></span><br><span class="line">enc = <span class="string">b&#x27;\xda\xfc\xb7\x93\xfb\x9d\xbe\x82\xb3\xb5\x87`]&#125;\x0b*\xd53AR\x8bb\xfeQ,\xd9\xff\xf6\n\xa2\x1b)H\\\xf24&gt;E\xac+\x01\xf3)F\x8c\xee\xb8j\x18zb\xa8\x8b\xba\xbc\xbb\x03\xbb&#125;\xb6\x8cO#\xeb\x0c\xce\xbd\x07\x8aWP\x90\xf2\xaep\x02\x11&#123;\xdf\xc5&#x27;</span></span><br><span class="line">key = x ^^ y ^^ z</span><br><span class="line">key = long_to_bytes(key)</span><br><span class="line">aes = AES.new(key,mode = AES.MODE_ECB)</span><br><span class="line"><span class="built_in">print</span>(aes.decrypt(enc))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;Even_jus7_le4k_l1ttle_B1ts_We_CAN_Sovle_The_H1dd3n_Numb3r_Pr0blem&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="pack"><a href="#pack" class="headerlink" title="pack"></a>pack</h3><p>题目来源：JQCTF 2023</p>
<p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hint:实测LLL后剔除不满足向量再做BKZ效果有提升</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">FLAG = os.environ.get(<span class="string">&#x27;FLAG&#x27;</span>, <span class="string">&#x27;flag&#123;XXXXFAKE_FLAGXXXX&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> FLAG[:<span class="number">5</span>] == <span class="string">&#x27;flag&#123;&#x27;</span> <span class="keyword">and</span> FLAG[-<span class="number">1</span>] == <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">FLAG = FLAG[<span class="number">5</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pack</span>(<span class="params">dim</span>):</span><br><span class="line">    sc = [-<span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">    a = [getPrime(<span class="number">256</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(dim-<span class="number">1</span>)]</span><br><span class="line">    s = [sc[random.randint(<span class="number">0</span>, <span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(dim)]</span><br><span class="line">    a.append(-s[-<span class="number">1</span>]*<span class="built_in">sum</span>(a[i]*s[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim-<span class="number">1</span>)))</span><br><span class="line">    <span class="keyword">return</span> a, s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">epack</span>(<span class="params">error, dim</span>):</span><br><span class="line">    a, s_ = pack(dim)</span><br><span class="line">    s = [i <span class="keyword">if</span> i&gt;<span class="number">0</span> <span class="keyword">else</span> i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> s_]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">        s[_] ^= <span class="built_in">int</span>(error[_])</span><br><span class="line">    <span class="keyword">return</span> a, <span class="built_in">sum</span>(a[_]*s[_] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(dim))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    bits = <span class="built_in">bin</span>(bytes_to_long(FLAG.encode()))[<span class="number">2</span>:].zfill(<span class="built_in">len</span>(FLAG)*<span class="number">8</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        <span class="built_in">print</span>(epack(<span class="built_in">list</span>(bits), <span class="built_in">len</span>(bits)))</span><br></pre></td></tr></table></figure>
<p>output较长这里不放出，需要的师傅可以找我要或者去NSSCTF上下载附件。</p>
<p>简单阐述一下题目内容：</p>
<ul>
<li>将flag转化为二进制序列，并将长度补齐至8的整数倍</li>
<li>对flag的二进制序列进行两次如下加密</li>
</ul>
<p>每一次加密的具体加密流程为：</p>
<p>1.先进行pack</p>
<ul>
<li>随机生成长度为127的列表a，每一个元素为256bit的素数</li>
<li>随机生成长度为128的列表s，每一个元素为-1或1</li>
<li>通过计算a的最后一个元素，来保证a和s列表具有如下关系：</li>
</ul>
<script type="math/tex; mode=display">
\sum_{i=0}^{127}{a_is_i} = 0</script><ul>
<li>返回a和s列表，用于epack加密</li>
</ul>
<p>2.进行epack</p>
<p>epack在这里我认为就是error-pack的意思，具体来说，他将flag的二进制序列当作error，然后按如下流程加密：</p>
<ul>
<li>先将pack得到的列表s转换成01列表s1，具体为：-1-&gt;0，1-&gt;1</li>
<li>将s1与error逐比特异或得到s2</li>
<li>最后一步就是个普通的01背包</li>
</ul>
<p>然后，题目提供给我们两次加密的列表a1、a2，和对应的子集和sum1、sum2，需要我们还原error。</p>
<p>首先这个背包的密度只有0.5左右，因此我觉得可以直接LLL求解出两次的s2，但是事实上不行。(这是我直到做完这个题目也没有想通的一点，密度这么小为什么不行？开始觉得可能是因为a的最后一个元素是负数的缘故，但自己生成了几组全是正数的数据也规约不出来。)</p>
<p>然后就照着题目提示尝试了一下先LLL再BKZ(如果目标向量够短，这肯定是可行的，因为这实际上就是在LLL得到的一组格基中，继续用BKZ寻找更短的格基)，但是block_size提升到24也出不来结果，提升到26又一直跑不完，太慢了，但是按照题目提示来说肯定就是这个方法没错，因此要么就是继续硬跑更大的block_size，要么就是做一点格的优化。</p>
<p>因此我用上了一个我之前考虑过的优化背包格的方法，正常来说背包格是如下形式：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}
1 &   &    &  &a_1\\
  & 1 &    &  &a_2\\
  &   & ... &  &...\\
  &   &  & 1 & a_n\\
  &   &  &  & -sum\\
\end{matrix}\right)</script><p>对这个格，01向量s满足下式：</p>
<script type="math/tex; mode=display">
s
\left(\begin{matrix}
1 &   &    &  &a_1\\
  & 1 &    &  &a_2\\
  &   & ... &  &...\\
  &   &  & 1 & a_n\\
  &   &  &  & -sum\\
\end{matrix}\right)
=
(s,0)</script><p>目标向量也是0、1向量，虽然是短向量，但是它内部的数量级在这个小范围内其实并不相当(0是0bit，1是1bit)。而我们可以改变格为如下形式：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}
2 &   &    &  &a_1\\
  & 2 &    &  &a_2\\
  &   & ... &  &...\\
  &   &  & 2 & a_n\\
-1  & -1  & -1 & -1 & -sum\\
\end{matrix}\right)</script><p>对于同一个0、1向量s，线性关系变成了：</p>
<script type="math/tex; mode=display">
s
\left(\begin{matrix}
2 &   &    &  &a_1\\
  & 2 &    &  &a_2\\
  &   & ... &  &...\\
  &   &  & 2 & a_n\\
-1  & -1  & -1 & -1 & -sum\\
\end{matrix}\right)
=
(s',0)</script><p>而此时，s’是一个由-1，1组成的向量，因此数量级相当，更有利于对目标向量的规约。事实上改成这样后，LLL+block_size=24的BKZ就可以规约出两次epack用的s2了。</p>
<p>有了两个s2后，要解出error可能有以下两个方向：</p>
<ul>
<li>想办法解出两个s，然后与对应s2异或即得到error</li>
<li>直接规约出error</li>
</ul>
<p>对于第一个方向，实际上跟刚才的背包差不多，区别在于s本身就是个由-1、1组成的向量，因此格可以直接用最原始的背包格去掉最后一行就好，然后依然LLL+block_size=24的BKZ莽使一波——并没有想要的结果。</p>
<p>那么就走第二个路子：直接规约出error。而对于error我们有如下信息可用，首先是两组：</p>
<script type="math/tex; mode=display">
\sum_{i=0}^{127}{a_is_i} = 0</script><p>然后我们知道，s到s1经历了如下变换：</p>
<script type="math/tex; mode=display">
s1_i = \frac{(s_i + 1)}{2}</script><p>那么代入原式就有：</p>
<script type="math/tex; mode=display">
\sum_{i=0}^{127}{a_i(2s1_i-1)} = 0</script><p>而对于s1，我们又知道：</p>
<script type="math/tex; mode=display">
s1_i \oplus error_i = s2_i</script><p>因此有：</p>
<script type="math/tex; mode=display">
s1_i = s2_i \oplus error_i</script><p>那么继续代入求和式：</p>
<script type="math/tex; mode=display">
\sum_{i=0}^{127}{a_i(2(s2_i \oplus error_i)-1)} = 0</script><p>由于s2、error都是按比特取值，所以一共只有四种组合，很轻松就能找到一个同态来把异或运算同态到乘法：</p>
<script type="math/tex; mode=display">
\sum_{i=0}^{127}{a_i[(2s2_i-1)(2error_i-1))]} = 0</script><p>然后把这个式子组合一下：</p>
<script type="math/tex; mode=display">
\sum_{i=0}^{127}{[a_i(2s2_i-1)](2error_i-1)} = 0</script><p>这就又变成了一个背包问题，但是加密了两次，就对2errori-1组成的向量有两组约束，因此可以写到同一个格中进行规约，规约出2errori-1后，将-1，1组成的向量映射回01向量就好。</p>
<p>然后需要注意的是规约出的向量与本身目标向量的正负可能是相反的，因此把两种情况都考虑到更好(de一次bug太久了)。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pack_output <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get epack&#x27;s s1,s2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mapping</span>(<span class="params">vec</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(vec)</span><br><span class="line">    temp = vector(ZZ,n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        temp[i] = (vec[i] + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">vec</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> vec:</span><br><span class="line">        <span class="keyword">if</span>(i != -<span class="number">1</span> <span class="keyword">and</span> i != <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pack_reduction</span>(<span class="params">L</span>):</span><br><span class="line">    res = L.LLL()[:-<span class="number">1</span>]</span><br><span class="line">    res = res.BKZ(block_size=<span class="number">24</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">epack</span>(<span class="params">a,<span class="built_in">sum</span>,n</span>):</span><br><span class="line">    K = <span class="number">2</span>^<span class="number">100</span></span><br><span class="line">    L = Matrix(ZZ, n+<span class="number">1</span>, n+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        L[i,i] = <span class="number">2</span></span><br><span class="line">        L[i,-<span class="number">1</span>] = K*a[i]</span><br><span class="line">        L[-<span class="number">1</span>,i] = -<span class="number">1</span></span><br><span class="line">    L[-<span class="number">1</span>,-<span class="number">1</span>] = -K*<span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line">    res = pack_reduction(L)[:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span>(check(res)):</span><br><span class="line">        <span class="keyword">return</span> mapping(res)</span><br><span class="line"></span><br><span class="line">dim = <span class="number">128</span></span><br><span class="line">epack_s1 = epack(a1,sum1,dim)</span><br><span class="line">epack_s2 = epack(a2,sum2,dim)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get pack&#x27;s error</span></span><br><span class="line">K = <span class="number">2</span>^<span class="number">100</span></span><br><span class="line">L = Matrix(ZZ,dim,dim+<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">    L[i,i] = <span class="number">1</span></span><br><span class="line">    L[i,-<span class="number">2</span>] = K*(<span class="number">2</span>*epack_s1[i]-<span class="number">1</span>)*a1[i]</span><br><span class="line">    L[i,-<span class="number">1</span>] = K*(<span class="number">2</span>*epack_s2[i]-<span class="number">1</span>)*a2[i]</span><br><span class="line">res = pack_reduction(L)[:-<span class="number">2</span>]</span><br><span class="line">res = mapping(res)</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">1</span>):</span><br><span class="line">        flag += <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;n0is3_41way5_bad&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Lattice"><a href="#Lattice" class="headerlink" title="Lattice"></a>Lattice</h3><p>题目来源：强网杯 2022</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.modules.free_module_integer <span class="keyword">import</span> IntegerLattice</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line">n = <span class="number">75</span></span><br><span class="line">m = <span class="number">150</span></span><br><span class="line">r = <span class="number">10</span></span><br><span class="line">N = <span class="number">126633165554229521438977290762059361297987250739820462036000284719563379254544315991201997343356439034674007770120263341747898897565056619503383631412169301973302667340133958109</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>(<span class="params">n, m, r, N</span>):</span><br><span class="line">    t1 = [ZZ.random_element(-<span class="number">2</span>^<span class="number">15</span>, <span class="number">2</span>^<span class="number">15</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n*m)]</span><br><span class="line">    t2 = [ZZ.random_element(N) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(r*n)]</span><br><span class="line">    B = matrix(ZZ, n, m, t1)</span><br><span class="line">    L = IntegerLattice(B)</span><br><span class="line">    A = matrix(ZZ, r, n, t2)</span><br><span class="line">    C = (A * B) % N</span><br><span class="line">    <span class="keyword">return</span> L, C</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> s + (<span class="number">16</span> - <span class="built_in">len</span>(s) % <span class="number">16</span>) * <span class="string">b&quot;\x00&quot;</span></span><br><span class="line"></span><br><span class="line">signal.alarm(<span class="number">60</span>)</span><br><span class="line">token = <span class="built_in">input</span>(<span class="string">&quot;team token:&quot;</span>).strip().encode()</span><br><span class="line">L, C = gen(n, m, r, N)</span><br><span class="line"><span class="built_in">print</span>(C)</span><br><span class="line">key = sha256(<span class="built_in">str</span>(L.reduced_basis[<span class="number">0</span>]).encode()).digest()</span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">ct = b64encode(aes.encrypt(pad(flag))).decode()</span><br><span class="line"><span class="built_in">print</span>(ct)</span><br></pre></td></tr></table></figure>
<p>题目基于如下一个矩阵等式：</p>
<script type="math/tex; mode=display">
C_{10 \times 150} = A_{10 \times 75}B_{75 \times 150} \quad(mod\;N)</script><p>其中，A是一个由小于N的随机数组成的矩阵，B是一个-2^15到2^15的随机数组成的矩阵。题目用矩阵B进行LLL后的第一行当作AES密钥加密flag，并给出密文和矩阵C，要求还原flag。</p>
<p>先说结论：这是一个比较典型的正交格攻击(Orthogonal Lattice Attack)，在当时应该是一篇论文题，论文为：</p>
<p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2020/461.pdf">461.pdf (iacr.org)</a></p>
<p>不过他的核心思路还是能够理解的，这里就介绍一下。</p>
<p>首先，由于矩阵B本身元素就很小，再LLL一遍第一行应该会更小，所以是有希望用格找到他的。首先转置一下得到：</p>
<script type="math/tex; mode=display">
C^T_{150 \times 10} = B^T_{150 \times 75}A^T_{75 \times 10} \quad(mod\;N)</script><p>然后假设可以找到这样一个矩阵M，使得他和C^T正交，也就是：</p>
<script type="math/tex; mode=display">
MC^T = 0 \quad(mod\;N)</script><p>那么对于原式就会有：</p>
<script type="math/tex; mode=display">
MB^T_{150 \times 75}A^T_{75 \times 10} = 0\quad(mod\;N)</script><p>再转置回来就有：</p>
<script type="math/tex; mode=display">
A_{10 \times 75}B_{75 \times 150}M^T = 0\quad(mod\;N)</script><p>那么B的向量应该都在M^T的左核空间中，且由于B中向量都较短，所以对左核空间的基向量进行规约就有机会能找到B了。</p>
<p>而为了找到这样的M，方式就是构造一个如下形式的格：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}
I_{150 \times 150} & C^T_{150 \times 10} \\
O & N_{10 \times 10}
\end{matrix}\right)</script><p>那么对于满足如下条件的m向量：</p>
<script type="math/tex; mode=display">
(m_1,m_2,...,m_{150},k_1,k_2,...,k_{10})
\left(\begin{matrix}
I_{150 \times 150} & C^T_{150 \times 10} \\
O & N_{10 \times 10}
\end{matrix}\right)
=
(m_1,m_2,...,m_{150},0,0,...,0)</script><p>那么这样的m向量就在M中。论文也提到了这样预期规约出的前m-n-1行会是需要的向量，不过感觉理论上来说B^T的左核会有m-n个向量，事实上也有m-n个向量符合条件。</p>
<p>找到这样的M矩阵后对其转置矩阵M^T求左核后LLL，其第一行也就是矩阵B进行LLL后的第一行，然后分正负两个情况去尝试解密AES得到flag就好。</p>
<p>不过实际操作会发现，sage求左核真的有点慢，而细想一下我们其实也就是想找到短向量b使得bM^T=0而已，所以依然可以用前一个格来解决，只是需要在最后一些列配上一个大系数(一般配N就合适)。这样就一分钟之内就能搞定。</p>
<p>同时，由于M和B都是小量，所以模不模N其实没差，因此最后的格还可以优化掉一些行，进一步减少耗时，虽然减少的并不多。</p>
<p>规约出来不是需要的向量也是正常的，多来几次就好。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Pwn4Sage.pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256,sha1</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>, <span class="number">28571</span>)</span><br><span class="line">sh.sendline(<span class="string">b&quot;token&quot;</span>)</span><br><span class="line"></span><br><span class="line">n = <span class="number">75</span></span><br><span class="line">m = <span class="number">150</span></span><br><span class="line">r = <span class="number">10</span></span><br><span class="line">N = <span class="number">126633165554229521438977290762059361297987250739820462036000284719563379254544315991201997343356439034674007770120263341747898897565056619503383631412169301973302667340133958109</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 handle the data</span></span><br><span class="line">C = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r):</span><br><span class="line">    temp = sh.recvline().strip().decode()[<span class="number">1</span>:-<span class="number">1</span>].split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(temp)-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> temp[k] == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            temp.remove(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        C[i][j] = <span class="built_in">int</span>(temp[j])</span><br><span class="line">C = Matrix(ZZ,C)</span><br><span class="line">enc = b64decode(sh.recvline().strip().decode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 get M satisfying MC = 0 % N</span></span><br><span class="line">L = block_matrix(</span><br><span class="line">    [</span><br><span class="line">        [identity_matrix(m),C.T],</span><br><span class="line">        [matrix.zero(r,m),identity_matrix(r)*N]</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line">res = L.LLL()</span><br><span class="line"></span><br><span class="line">M = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">all</span>(j == <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> i[-r:])):</span><br><span class="line">        M.append(i[:-r])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">M = Matrix(ZZ,M)</span><br><span class="line">MT = Matrix(ZZ,M).T</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 get B.LLL()[0]</span></span><br><span class="line">L = block_matrix(</span><br><span class="line">    [</span><br><span class="line">        [identity_matrix(m),MT*N],</span><br><span class="line">        <span class="comment">#[matrix.zero(n,m),identity_matrix(n)*N*N]  no need of these rows cause B and M both short</span></span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line">res = L.LLL()[<span class="number">0</span>][:m]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part3 decrypt the message and get flag</span></span><br><span class="line">key1 = sha256(<span class="built_in">str</span>(res).encode()).digest()</span><br><span class="line">key2 = sha256(<span class="built_in">str</span>(-res).encode()).digest()</span><br><span class="line">aes = AES.new(key1, AES.MODE_ECB)</span><br><span class="line"><span class="built_in">print</span>(aes.decrypt(enc))</span><br><span class="line">aes = AES.new(key2, AES.MODE_ECB)</span><br><span class="line"><span class="built_in">print</span>(aes.decrypt(enc))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#NSSCTF&#123;c6678b20-be7a-4792-af76-6c4da9a95102&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="crys"><a href="#crys" class="headerlink" title="crys"></a>crys</h3><p>题目来源：强网杯 2022</p>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gpp</span>(<span class="params">eta,etamin=<span class="number">256</span></span>):</span><br><span class="line">  <span class="keyword">if</span> eta&lt;=(<span class="number">2</span>*etamin):</span><br><span class="line">    <span class="keyword">return</span> random_prime(<span class="number">2</span>^eta,<span class="literal">False</span>,<span class="number">2</span>^(eta-<span class="number">1</span>))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">return</span> random_prime(<span class="number">2</span>^etamin,<span class="literal">False</span>,<span class="number">2</span>^(etamin-<span class="number">1</span>))*gpp(eta-etamin)</span><br><span class="line">    </span><br><span class="line">p = <span class="number">2</span>*gpp(<span class="number">3217</span>)+<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> p <span class="keyword">not</span> <span class="keyword">in</span> Primes():</span><br><span class="line">    p = <span class="number">2</span>*gpp(<span class="number">3217</span>)+<span class="number">1</span> </span><br><span class="line">g=Zmod(p)(<span class="number">4</span>)</span><br><span class="line">padding=randint(<span class="number">0</span>,<span class="number">2</span>^<span class="number">3217</span>)</span><br><span class="line">x=Zmod((p-<span class="number">1</span>)//<span class="number">2</span>)(<span class="built_in">int</span>.from_bytes(flag,<span class="string">&#x27;big&#x27;</span>)^^padding)</span><br><span class="line">y=g^x</span><br><span class="line"><span class="comment"># Fast RNG Init</span></span><br><span class="line">a, b = [], []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">168</span>):</span><br><span class="line">    a.append(randint(<span class="number">1</span>,(p-<span class="number">1</span>)//<span class="number">2</span>))</span><br><span class="line">    b.append(g^a[i])</span><br><span class="line"></span><br><span class="line">output = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14500</span>):</span><br><span class="line">    r = <span class="number">1</span></span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">168</span>):</span><br><span class="line">        <span class="keyword">if</span> randint(<span class="number">0</span>,<span class="number">1</span>):</span><br><span class="line">            r*=b[j]</span><br><span class="line">            k+=a[j]</span><br><span class="line">    e = <span class="built_in">int</span>(hashlib.sha256(<span class="string">f&quot;c<span class="subst">&#123;r&#125;</span>ys&quot;</span>.encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line">    s = k - x*e</span><br><span class="line">    <span class="keyword">assert</span> e == <span class="built_in">int</span>(hashlib.sha256(<span class="string">f&quot;c<span class="subst">&#123;g^s*y^e&#125;</span>ys&quot;</span>.encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line">    <span class="built_in">print</span>(s, e, file=output)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p, y, padding, file=output)</span><br></pre></td></tr></table></figure>
<p>题目首先生成一个3217bit数量级的素数p，使得它是2t+1的形式，其中t是一个难以分解的合数(这样做的目的应该是难以求模p下的DLP)。然后题目生成了一个2^3217以内的padding，并将其与flag异或，并模(p-1)//2得到x，在下文为了方便表示，把(p-1)//2记作q。</p>
<p>之后题目做的事情就比较奇怪了，首先取g=4作为底数，然后生成两个长为168的列表a、b。其中，a中元素ai是小于q的随机数，b是模p下g的对应ai次幂。之后进行了14500次操作，这一过程可以写成矩阵形式：</p>
<script type="math/tex; mode=display">
s_{14500 \times 1} + xe_{14500 \times 1} = k_{14500 \times 1} \quad(mod\; q)</script><p>其中k又可以写为：</p>
<script type="math/tex; mode=display">
k_{14500 \times 1} = X_{14500 \times 168}a_{168 \times 1} \quad(mod\; q)</script><p>X是一个仅由0、1组成的矩阵。那么整个式子就可以写作：</p>
<script type="math/tex; mode=display">
\mathbf{s} + x\mathbf{e} = X\mathbf{a} \quad(mod\; q)</script><p>后面的assert其实并不重要，这也侧面说明r的值以及列表b其实没什么用。因此我们的目的就是根据上面这个式子去求出x来。</p>
<p>而我们拥有的所有信息是：</p>
<ul>
<li>p、s、e的值</li>
<li>X是一个01矩阵</li>
<li>e是一个较小的量</li>
</ul>
<p>由第二条可以看出应该还是与正交格有关，事实上上面论文中也有提及过这个问题，叫做ahssp(Affine Hidden Subset Sum Problem)。而了解了上一个题目原理的话，这个题目就应该会有些思路，如下：</p>
<p>先是找到一个矩阵M，使得：</p>
<script type="math/tex; mode=display">
M\mathbf{s} = M\mathbf{e} = 0 \quad(mod\;q)</script><p>那么就有：</p>
<script type="math/tex; mode=display">
MX\mathbf{a} = 0 \quad(mod\;q)</script><p>转置一下得到：</p>
<script type="math/tex; mode=display">
\mathbf{a}^TX^TM^T = 0 \quad(mod\;q)</script><p>you因为T是01矩阵，非常小，所以在M^T的左核里LLL应该就能找到T矩阵来。找到T之后再找M’矩阵，使得：</p>
<script type="math/tex; mode=display">
M'\mathbf{e} = 0 \quad(mod\;q)</script><p>代回原式就有：</p>
<script type="math/tex; mode=display">
M'\mathbf{s} = M'X\mathbf{a} \quad(mod\; q)</script><p>就可以解出向量a，然后再代回去就可以取一个值算出x了。如何找到这样的M、M’矩阵在上面的Lattice一题已经提到过。</p>
<p>但是有一个很严峻的问题就是，这一题的向量长度达到了14500。而一般来说格的维度达到几百的话规约已经相当慢了，所以全部用上并不现实。</p>
<blockquote>
<p>事实上14500这个数值和论文附录H里提及到的数字$\frac{n^2 + 3n}{2}$很接近，但是我没有看太明白</p>
</blockquote>
<p>然后我的思路就是取用其中一些数据来做，综合考虑了一下耗时与规约效果决定最终取700条数据。跑了一个多小时后跑完了，发现很悲剧，应该是数据组数不太够，导致求X的那一步并不对，求出来的不是01矩阵。</p>
<p>今晚挂一下900组数据看看，再高的话感觉就是做法有点问题了。</p>
<h4 id="2-27更新"><a href="#2-27更新" class="headerlink" title="(2.27更新)"></a>(2.27更新)</h4><p>挂了一晚上还是没跑出正确结果，再多选数据应该也跑不出来了。今早上就自己生成了一些数据做观察，发现两个有点古怪的地方：</p>
<ul>
<li>q是不是素数，会对规约的正确性有影响</li>
<li>e的大小会对规约的正确性有影响</li>
</ul>
<p>试了一下发现当e比较小，且q不是素数的时候(也就是题目的情况)，上面的方法就会出错。然后发现一个事实：要按照论文的要求，严格取前面的m-n-1行来组成M(论文里也限制了e的取值范围在2^t以内，也就是一个较小值)，进而求X。多取一行规约结果就会很差。</p>
<p>不过道理我也没有想的太明白，也许是因为e比较小，所以对于他来说没有必要模q？</p>
<p>然后测试出来也是取2n组数据一般就够了，保险起见我多取了一些，sage10.2差不多要做20min左右。得到x后还有一个小问题就是padding是略大于q的，所以要用带余除法算出原本没有模q的x，再去求flag。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = <span class="number">350</span></span><br><span class="line">n = <span class="number">168</span></span><br><span class="line"></span><br><span class="line">p = </span><br><span class="line">y = </span><br><span class="line">padding = </span><br><span class="line">h = </span><br><span class="line">e = </span><br><span class="line"></span><br><span class="line">q = (p-<span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">h = Matrix(ZZ,h[:m])</span><br><span class="line">e = Matrix(ZZ,e[:m])</span><br><span class="line"></span><br><span class="line"><span class="comment">#solve</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():  </span><br><span class="line">    <span class="comment">#part1 get M satisfying Me=Mh=0</span></span><br><span class="line">    he = block_matrix(</span><br><span class="line">        [</span><br><span class="line">            [h.T,e.T]</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    L = block_matrix(</span><br><span class="line">        [</span><br><span class="line">            [he , identity_matrix(m)],</span><br><span class="line">            [identity_matrix(<span class="number">2</span>)*q,<span class="number">0</span>]</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    res = L.LLL()</span><br><span class="line"></span><br><span class="line">    M = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">all</span>(j == <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> i[:<span class="number">2</span>])):</span><br><span class="line">            M.append(i[<span class="number">2</span>:])</span><br><span class="line">    M = Matrix(ZZ,M)</span><br><span class="line">    rows = M.dimensions()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#part2 get X</span></span><br><span class="line">    L = block_matrix(</span><br><span class="line">        [</span><br><span class="line">            [(M.T)*q , identity_matrix(m)],</span><br><span class="line">            [identity_matrix(rows)*q^<span class="number">2</span>,matrix.zero(rows,m)]</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    L = L.LLL()</span><br><span class="line"></span><br><span class="line">    XT = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        XT.append(L[i][rows:])</span><br><span class="line">    XT = Matrix(ZZ,XT)</span><br><span class="line">    X = XT.T</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#part3 get Me satisfying Me*e = 0</span></span><br><span class="line">    L = block_matrix(</span><br><span class="line">        [</span><br><span class="line">            [e.T , identity_matrix(m)],</span><br><span class="line">            [identity_matrix(<span class="number">1</span>)*q,<span class="number">0</span>]</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    L[:,:<span class="number">1</span>] *= q</span><br><span class="line">    res = L.LLL()</span><br><span class="line"></span><br><span class="line">    Me = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">all</span>(j == <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> i[:<span class="number">1</span>])):</span><br><span class="line">            Me.append(i[<span class="number">1</span>:])</span><br><span class="line">    Me = Matrix(Zmod(q),Me)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#part4 solve Matrix_equation</span></span><br><span class="line">    MeX = Me*X</span><br><span class="line">    alpha = MeX.solve_right(Me*(h.T))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#part5 get flag</span></span><br><span class="line">    x = (X*alpha - h.T)[<span class="number">0</span>][<span class="number">0</span>] * inverse(e[<span class="number">0</span>][<span class="number">0</span>],q) % q</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>):</span><br><span class="line">    solve()</span><br><span class="line"></span><br><span class="line">x = <span class="number">612117363963183636384061017748874955672735689361723523166934161930548362110528132748854224889132227134892963632264858985504494256041853933575304930051002962832249221199876875543858197143759437040160522812192609322189381152131402557127123821310897832468959454180821245363122106475904047956246627954600562153927507243637604870409543115797000848798496677735276442207321208207152206767495046709649070876719645211337462313662076313345513936632345901891335824932718521304752750587670681073748814081161674853723409391972492346216963887247812043140850467713372670135733019783395613050323976347922050060487216125158440171495374240242317148655318512620613495467419513956899948386217293379511094515632848050969451203204086978507123045301979514289179539758858640669371414569240445681550159551534183557059019194621042018552549142048047790277281807582292279323528024506734559017221580490929648282577700618947071089744735643102170603675086599861420840111753270894635567521740077793</span></span><br><span class="line">i = padding // q</span><br><span class="line">m = (x + i*q) ^^ padding</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;AFF1NE_HSSSSSSSP_T4KE_E4SY&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/9b40da15.html" title="Crypto趣题-Lattice">https://tangcuxiaojikuai.xyz/post/9b40da15.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/187210a7.html" rel="prev" title="Crypto趣题-曲线">
      <i class="fa fa-chevron-left"></i> Crypto趣题-曲线
    </a></div>
      <div class="post-nav-item">
    <a href="/post/165cec8c.html" rel="next" title="Crypto趣题-古典密码">
      Crypto趣题-古典密码 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AC%E5%8C%96AGCD"><span class="nav-number">1.</span> <span class="nav-text">转化AGCD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Matrix"><span class="nav-number">2.</span> <span class="nav-text">Matrix</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#challenge1"><span class="nav-number">2.1.</span> <span class="nav-text">challenge1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#challenge2"><span class="nav-number">2.2.</span> <span class="nav-text">challenge2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#challenge3"><span class="nav-number">2.3.</span> <span class="nav-text">challenge3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#final"><span class="nav-number">2.4.</span> <span class="nav-text">final</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSSMMM"><span class="nav-number">3.</span> <span class="nav-text">SSSMMM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e2D1p"><span class="nav-number">4.</span> <span class="nav-text">e2D1p</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E9%A2%84%E5%A4%87"><span class="nav-number">4.1.</span> <span class="nav-text">一些预备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%81%A2%E5%A4%8Dp"><span class="nav-number">4.2.</span> <span class="nav-text">恢复p</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B1%82%E8%A7%A3flag"><span class="nav-number">4.3.</span> <span class="nav-text">求解flag</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vector"><span class="nav-number">5.</span> <span class="nav-text">vector</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HNP"><span class="nav-number">6.</span> <span class="nav-text">HNP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%84%E9%9C%B2%E9%AB%988%E4%BD%8D"><span class="nav-number">6.1.</span> <span class="nav-text">泄露高8位</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%84%E9%9C%B2%E4%BD%8E8%E4%BD%8D"><span class="nav-number">6.2.</span> <span class="nav-text">泄露低8位</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%84%E9%9C%B2%E9%AB%984%E4%BD%8D"><span class="nav-number">6.3.</span> <span class="nav-text">泄露高4位</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4exp"><span class="nav-number">6.4.</span> <span class="nav-text">完整exp</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pack"><span class="nav-number">7.</span> <span class="nav-text">pack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lattice"><span class="nav-number">8.</span> <span class="nav-text">Lattice</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#crys"><span class="nav-number">9.</span> <span class="nav-text">crys</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-27%E6%9B%B4%E6%96%B0"><span class="nav-number">9.1.</span> <span class="nav-text">(2.27更新)</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">105</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tangcuxiaojikuai" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tangcuxiaojikuai" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
