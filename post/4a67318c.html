<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="和@yolbby、@三顺七组队参加了这次挑战赛，最后只拿了三等奖，因为确实是完全当CTF在打——不够位数的就靠爆，没有指导老师，没有仔细考虑过时间的优化，也没有想过要搞一些创新点XD，但还是写篇博客记录一下。">
<meta property="og:type" content="article">
<meta property="og:title" content="2024-高校密码挑战赛赛题一-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/4a67318c.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="和@yolbby、@三顺七组队参加了这次挑战赛，最后只拿了三等奖，因为确实是完全当CTF在打——不够位数的就靠爆，没有指导老师，没有仔细考虑过时间的优化，也没有想过要搞一些创新点XD，但还是写篇博客记录一下。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/image-20240826154329895.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/image-20240826154345916.png">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/8afcb1e5869e61d33367f338d30dcb3c-1724663567380.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/f48699be1cef74f1b5c4fada2a8cb2de.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/de94e6a3aa86efaeac517426dec1755d.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/b724e0abe737c7fbfb91f2232982d108.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/18d99231b7ce1408f378332d7fc33ede.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/4ca607d5271fdfd58cb6e5a5f1cdbe2f.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/45f151e112ae82fbae7afe733b71f005.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/649e610311ed3d6235da762fdbf4b2bf.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/a07f462d11e7a160b6ec0208c71cc9a2.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/537d38274ba41bd2fec1f936dde5e2cf.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/6ce95227da3b2359a0db27ef33745b80.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/8adf0708c978ec86ead4bb16bbfb49e1.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/1c11dd212bc5a8609bc3f36ddae91913.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/ee974d5601e9a5f8d1c1ea34c84cd211.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/b017d8b62f16f59815f76b688cdf9d4e.jpg">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/923385ac4aae687ea0ecb38b6cb27d6e.jpg">
<meta property="article:published_time" content="2024-08-26T03:22:42.000Z">
<meta property="article:modified_time" content="2024-09-09T07:30:56.914Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tangcuxiaojikuai.xyz/post/4a67318c/image-20240826154329895.png">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/4a67318c.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2024-高校密码挑战赛赛题一-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/4a67318c.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2024-高校密码挑战赛赛题一-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-08-26 11:22:42" itemprop="dateCreated datePublished" datetime="2024-08-26T11:22:42+08:00">2024-08-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-09 15:30:56" itemprop="dateModified" datetime="2024-09-09T15:30:56+08:00">2024-09-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/4a67318c.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/4a67318c.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>和<a target="_blank" rel="noopener" href="https://yolbby.github.io/">@yolbby</a>、<a target="_blank" rel="noopener" href="https://march-7th.tech/">@三顺七</a>组队参加了这次挑战赛，最后只拿了三等奖，因为确实是完全当CTF在打——不够位数的就靠爆，没有指导老师，没有仔细考虑过时间的优化，也没有想过要搞一些创新点XD，但还是写篇博客记录一下。</p>
<span id="more"></span>
<h2 id="第一部分——RSA特定密钥泄露攻击"><a href="#第一部分——RSA特定密钥泄露攻击" class="headerlink" title="第一部分——RSA特定密钥泄露攻击"></a>第一部分——RSA特定密钥泄露攻击</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">N1=<span class="number">0xa4d80845630d3b332f74f667ec8a0e49aba15b6f0c4f4006161d62c91b78cf6811421cc76609d2d9dba2c43be9d8ecdc6a0dff64a8041dcde52c7f92820b0a38fc91419e8ec9a5c69d47edc6e347934b4d87f97c5759886dac6c1143ff55b8eb11acfaa6cc70956a8ec7796e1a063b123bc2e467e30937c5a69c7ab5f8ed17e1</span>;</span><br><span class="line">e1=<span class="number">0x3458c2e97adef45f741c7db11ece6c0814aa5b6fad9144242cdaa16a6b4f3622477935f98a41765b92892b4de22a391cf08767447df113f5151c86edd109b97f9b045fd8ad5d7a51084684d4e2353db6c0e474d5d79f399a2bf4fd867ec85b7960845ab5497f705914912f797804c06dcff57139e040596d22b141e54835e0d3</span>;</span><br><span class="line">c1=<span class="number">0x91b097a5b1f6b12accdbda15cd2247384e1b3ed8311085a0f3e0dbb5fffce650a355600a02674189d1b7f4075df079c70354a08646e85ecf31dd150220cd1d4ce22d55a946500f4bd8def74fb0acea3e8d2e7bb1d27ebf2ca2e80fc28c3f0d88a041d4a556a18147f66b88c65f19c99b4b94c3f78d468b8accb4da7e7ce31b29</span></span><br></pre></td></tr></table></figure>
<p>信息：</p>
<ul>
<li>d的范围在$[2^{249},2^{250}]$</li>
</ul>
<p>显然d太小了，直接wiener或者boneh&amp;durfee都行。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N1=<span class="number">0xa4d80845630d3b332f74f667ec8a0e49aba15b6f0c4f4006161d62c91b78cf6811421cc76609d2d9dba2c43be9d8ecdc6a0dff64a8041dcde52c7f92820b0a38fc91419e8ec9a5c69d47edc6e347934b4d87f97c5759886dac6c1143ff55b8eb11acfaa6cc70956a8ec7796e1a063b123bc2e467e30937c5a69c7ab5f8ed17e1</span></span><br><span class="line">e1=<span class="number">0x3458c2e97adef45f741c7db11ece6c0814aa5b6fad9144242cdaa16a6b4f3622477935f98a41765b92892b4de22a391cf08767447df113f5151c86edd109b97f9b045fd8ad5d7a51084684d4e2353db6c0e474d5d79f399a2bf4fd867ec85b7960845ab5497f705914912f797804c06dcff57139e040596d22b141e54835e0d3</span></span><br><span class="line">c1=<span class="number">0x91b097a5b1f6b12accdbda15cd2247384e1b3ed8311085a0f3e0dbb5fffce650a355600a02674189d1b7f4075df079c70354a08646e85ecf31dd150220cd1d4ce22d55a946500f4bd8def74fb0acea3e8d2e7bb1d27ebf2ca2e80fc28c3f0d88a041d4a556a18147f66b88c65f19c99b4b94c3f78d468b8accb4da7e7ce31b29</span></span><br><span class="line"></span><br><span class="line">a = continued_fraction(e1/N1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    d,k = a.denominator(i) , a.numerator(i)</span><br><span class="line">    m = <span class="built_in">pow</span>(c1, d, N1)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        flag = long_to_bytes(m)[::-<span class="number">1</span>].decode()</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="comment">#print(d)</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Mathematics is the queen of sciences, and arithmetic [number theory] is the queen of mathematics.</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">N2=<span class="number">0xd231f2c194d3971821984dec9cf1ef58d538975f189045ef8a706f6165aab4929096f61a3eb7dd8021bf3fdc41fe3b3b0e4ecc579b4b5e7e035ffcc383436c9656533949881dca67c26d0e770e4bf62a09718dbabc2b40f2938f16327e347f187485aa48b044432e82f5371c08f6e0bbde46c713859aec715e2a2ca66574f3eb</span>;</span><br><span class="line">e2=<span class="number">0x5b5961921a49e3089262761e89629ab6dff2da1504a0e5eba1bb7b20d63c785a013fd6d9e021c01baf1b23830954d488041b92bca2fe2c92e3373dedd7e625da11275f6f18ee4aef336d0637505545f70f805902ddbacb21bb8276d34a0f6dfe37ede87dd95bb1494dbb5763639ba3984240f1178e32aa36ee3c5fcc8115dde5</span>;</span><br><span class="line">c2=<span class="number">0x6a88a8fa2b8f28d96284298bab2061efeb35e3a086370e19523c15c429f5d783b9d4f32e31a402916f45ad4f2760ab30e77177335af44756bfbeef0f168b5e0dc8c3ddf75d141c358969cca0e7c2b8ab99ef8e33b031be1cbccd95b687682ac7b0dcc0d56f5651ee671d6358128d2e0801f247a6af4fe0dc5e8fb199eba0780f</span>;</span><br></pre></td></tr></table></figure>
<p>信息：</p>
<ul>
<li>d的范围在$[2^{285},2^{286}]$</li>
</ul>
<p>d虽然变大了，但还是低于boneh&amp;durfee的理论强上界不少，所以把参数m调大到12就行。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Config</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting debug to true will display more informations</span></span><br><span class="line"><span class="string">about the lattice, the bounds, the vectors...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">debug = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting strict to true will stop the algorithm (and</span></span><br><span class="line"><span class="string">return (-1, -1)) if we don&#x27;t have a correct</span></span><br><span class="line"><span class="string">upperbound on the determinant. Note that this</span></span><br><span class="line"><span class="string">doesn&#x27;t necesseraly mean that no solutions</span></span><br><span class="line"><span class="string">will be found since the theoretical upperbound is</span></span><br><span class="line"><span class="string">usualy far away from actual results. That is why</span></span><br><span class="line"><span class="string">you should probably use `strict = False`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">This is experimental, but has provided remarkable results</span></span><br><span class="line"><span class="string">so far. It tries to reduce the lattice as much as it can</span></span><br><span class="line"><span class="string">while keeping its efficiency. I see no reason not to use</span></span><br><span class="line"><span class="string">this option, but if things don&#x27;t work, you should try</span></span><br><span class="line"><span class="string">disabling it</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># stop removing if lattice reaches that dimension</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Functions</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display stats on helpful vectors</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>:</span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tries to remove unhelpful vectors</span></span><br><span class="line"><span class="comment"># we start at current = n-1 (last vector)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line">    <span class="comment"># end of our recursive function</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we start by checking from the end</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment"># if it is unhelpful:</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">            <span class="comment"># let&#x27;s check if it affects other vectors</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># if another vector is affected:</span></span><br><span class="line">                <span class="comment"># we increase the count</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:0</span></span><br><span class="line">            <span class="comment"># if no other vectors end up affected</span></span><br><span class="line">            <span class="comment"># we remove it</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:1</span></span><br><span class="line">            <span class="comment"># if just one was affected we check</span></span><br><span class="line">            <span class="comment"># if it is affecting someone else</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># if it is affecting even one vector</span></span><br><span class="line">                    <span class="comment"># we give up on this one</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># remove both it if no other vector was affected and</span></span><br><span class="line">                <span class="comment"># this helpful vector is not helpful enough</span></span><br><span class="line">                <span class="comment"># compared to our unhelpful one</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;* removing unhelpful vectors&quot;</span>, ii, <span class="string">&quot;and&quot;</span>, affected_vector_index)</span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1,-1 if `strict=true`, and determinant doesn&#x27;t bound</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string">    * d &lt; N^delta</span></span><br><span class="line"><span class="string">    * |x| &lt; e^delta</span></span><br><span class="line"><span class="string">    * |y| &lt; e^0.5</span></span><br><span class="line"><span class="string">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts list of monomials</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts (selected by Herrman and May)</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts list of monomials</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Prototype to reduce the lattice</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment"># automatically remove</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># reset dimension</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if vectors are helpful</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># check if determinant is correctly bounded</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;looking for independent vectors in the lattice&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line">            <span class="comment"># for i and j, create the two polynomials</span></span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># resultant</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># are these good polynomials?</span></span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>():</span><br><span class="line">    <span class="comment">############################################</span></span><br><span class="line">    <span class="comment"># How To Use This Script</span></span><br><span class="line">    <span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># The problem to solve (edit the following values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the modulus</span></span><br><span class="line">    N=<span class="number">0xd231f2c194d3971821984dec9cf1ef58d538975f189045ef8a706f6165aab4929096f61a3eb7dd8021bf3fdc41fe3b3b0e4ecc579b4b5e7e035ffcc383436c9656533949881dca67c26d0e770e4bf62a09718dbabc2b40f2938f16327e347f187485aa48b044432e82f5371c08f6e0bbde46c713859aec715e2a2ca66574f3eb</span>;</span><br><span class="line">    e=<span class="number">0x5b5961921a49e3089262761e89629ab6dff2da1504a0e5eba1bb7b20d63c785a013fd6d9e021c01baf1b23830954d488041b92bca2fe2c92e3373dedd7e625da11275f6f18ee4aef336d0637505545f70f805902ddbacb21bb8276d34a0f6dfe37ede87dd95bb1494dbb5763639ba3984240f1178e32aa36ee3c5fcc8115dde5</span>;</span><br><span class="line">    c=<span class="number">0x6a88a8fa2b8f28d96284298bab2061efeb35e3a086370e19523c15c429f5d783b9d4f32e31a402916f45ad4f2760ab30e77177335af44756bfbeef0f168b5e0dc8c3ddf75d141c358969cca0e7c2b8ab99ef8e33b031be1cbccd95b687682ac7b0dcc0d56f5651ee671d6358128d2e0801f247a6af4fe0dc5e8fb199eba0780f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># the hypothesis on the private exponent (the theoretical maximum is 0.292)</span></span><br><span class="line">    delta = <span class="number">.278</span> <span class="comment"># this means that d &lt; N^delta</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Lattice (tweak those values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you should tweak this (after a first run), (e.g. increment it until a solution is found)</span></span><br><span class="line">    m = <span class="number">11</span> <span class="comment"># size of the lattice (bigger the better/slower)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you need to be a lattice master to tweak these</span></span><br><span class="line">    t = <span class="built_in">int</span>((<span class="number">1</span>-<span class="number">2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">    X = <span class="number">2</span>*floor(N^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">    Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>))    <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Don&#x27;t touch anything below</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Problem put in equation</span></span><br><span class="line">    P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    A = <span class="built_in">int</span>((N+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">    pol = <span class="number">1</span> + x * (A + y)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Find the solutions!</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Checking bounds</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== checking values ===&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* delta:&quot;</span>, delta)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* delta &lt; 0.292&quot;</span>, delta &lt; <span class="number">0.292</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* size of e:&quot;</span>, <span class="built_in">int</span>(log(e)/log(<span class="number">2</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* size of N:&quot;</span>, <span class="built_in">int</span>(log(N)/log(<span class="number">2</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* m:&quot;</span>, m, <span class="string">&quot;, t:&quot;</span>, t)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># boneh_durfee</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== running algorithm ===&quot;</span>)</span><br><span class="line">        start_time = time.time()</span><br><span class="line"></span><br><span class="line">    solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># found a solution?</span></span><br><span class="line">    <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">        d = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">        pplusq = <span class="built_in">int</span>(soly*<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">import</span> gmpy2</span><br><span class="line">        pminusq = gmpy2.iroot(pplusq^<span class="number">2</span>-<span class="number">4</span>*N,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">        p = (pplusq + pminusq) // <span class="number">2</span></span><br><span class="line">        q = N // p</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;d =&quot;</span>, d)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>,p)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;q =&quot;</span>,q)</span><br><span class="line">        <span class="keyword">assert</span> p*q == N</span><br><span class="line">        m = <span class="built_in">pow</span>(c,d,N)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m))[::-<span class="number">1</span>])</span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== no solution was found ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>((<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    example()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#96884485470809436429011642866838703862114673941017100586009098363273491491514356269093</span></span><br><span class="line"><span class="comment">#Cryptography is typically bypassed,not penetrated.</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">N3=<span class="number">0xf4c548636db62ffcc7ac4a0797952bea9a65bd426175af2435f72657e67ec8194667bfa94ce23c6f1e5baf3201867ab41701f6b8768e71009c41a3d5e9e7c109455341d549c7611f9f52851a2f017906aa9ccbedb95d238468e2c8577d30ecc4f158e3811fd5e2a6051443d468e3506bbc39bba710e34a604ac9e85d0feef8b3</span>;</span><br><span class="line">e3=<span class="number">0x16f4b438ba14e05afa944f7da9904f8c78ea52e4ca0be7fa2b5f84e22ddd7b0578a3477b19b7bb4a7f825acc45da2dd10e62dbd94a3386b97d92ee817b0c66c1507514a7860b9139bc2ac3a4e0fe304199214da00a4ca82bfcb7b18253e7e6144828e584dac2dfb9a03fabaf2376ce7c269923fbb60fc68325b9f6443e1f896f</span>;</span><br><span class="line">c3=<span class="number">0x26b1823cf836b226e2f5c90fdcd8420dbfcd02765b26e52ef3e5c0ab494c2f4650e475e280b0b5fff0d5016621186420b09e4706a5866e4a3319f23ef09d92c4e36acba39a0f6213fbe5ee1a736ce383e6e12351e6cbfd43f10a96b7fe34bdbaf948f2fb075d9063723c9f747fe6247ae9209e5d417faf2e37e6fee2eb863556</span>;</span><br></pre></td></tr></table></figure>
<p>信息：</p>
<ul>
<li>d的范围在$[2^{299},2^{300}]$</li>
</ul>
<p>这题d的范围增大到了boneh&amp;durfee的理论强上界，在0.292-0.293之间，对应格的维数无穷的情况。因此在没有更优秀的shift的情况下，直接规约肯定是不可能了，因此要想办法爆破一些高位才行。</p>
<p>这里参考的是这篇论文爆破p高位的方法：</p>
<p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2023/367.pdf">367.pdf (iacr.org)</a></p>
<p>经测试，m=12的情况下，有p的高19位MSB就可以稳定求解，去掉已知的最高位1的情况下还需要硬爆18位，开32进程也都还需要10天左右，太慢了。</p>
<p>所以就要想优化的办法，主要的思路有下面三个：</p>
<ul>
<li><p>参考Takayasu这篇的办法，把爆破p高位改成去爆破私钥d的MSB或者LSB：</p>
<p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2018/516.pdf">516.pdf (iacr.org)</a></p>
<p>这是目前为止私钥MSB、LSB泄露的小解密指数攻击的最优结果。然而有个严峻的问题在于我的能力复现不出来这篇文章XD，感觉他的实现太复杂了。</p>
</li>
<li><p>用上第二部分RNG的高位结果去得到更多p高位，这也是我们初赛的做法，速度很快。但这个方法终究是取巧，所以决赛没有再用这个。</p>
</li>
<li><p>用类似剪枝的策略去把不可能存在的p高位给筛掉，这个策略也就是：</p>
</li>
<li><ul>
<li>如果把当前p高位后面全部填0的值记作p0，那么N除以p0得到的结果应该大于q，也就是应该大于等于512bit</li>
<li>如果把当前p高位后面全部填1的值记作p1，那么N除以p1得到的结果应该小于q，也就是应该小于等于512bit</li>
</ul>
</li>
</ul>
<p>这个剪枝策略非常有效，可以用如下程序简单验证一下减小的复杂度：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">N3=<span class="number">0xf4c548636db62ffcc7ac4a0797952bea9a65bd426175af2435f72657e67ec8194667bfa94ce23c6f1e5baf3201867ab41701f6b8768e71009c41a3d5e9e7c109455341d549c7611f9f52851a2f017906aa9ccbedb95d238468e2c8577d30ecc4f158e3811fd5e2a6051443d468e3506bbc39bba710e34a604ac9e85d0feef8b3</span>;</span><br><span class="line"></span><br><span class="line">possible = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">18</span>):</span><br><span class="line">    t1 = (<span class="number">2</span>^<span class="number">18</span> + i)*<span class="number">2</span>^(<span class="number">512</span>-<span class="number">19</span>)</span><br><span class="line">    t2 = (<span class="number">2</span>^<span class="number">18</span> + i)*<span class="number">2</span>^(<span class="number">512</span>-<span class="number">19</span>) + (<span class="number">2</span>^(<span class="number">512</span>-<span class="number">19</span>)-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(<span class="built_in">bin</span>(N3//t1)[<span class="number">2</span>:]) &gt;= <span class="number">512</span> <span class="keyword">and</span> <span class="built_in">len</span>(<span class="built_in">bin</span>(N3//t2)[<span class="number">2</span>:]) &lt;= <span class="number">512</span>):</span><br><span class="line">        possible.append(i)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ph = int(&quot;111111010000111110&quot;,2)</span></span><br><span class="line"><span class="comment">#print(ph in possible)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(possible))</span><br><span class="line"><span class="built_in">print</span>(<span class="number">2</span>^<span class="number">18</span>)</span><br></pre></td></tr></table></figure>
<p>输出结果是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">22998</span></span><br><span class="line"><span class="number">262144</span></span><br></pre></td></tr></table></figure>
<p>可以看出搜索空间变成了原来的十分之一不到，这样就可以在一天以内求解出来结果了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> check_output</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flatter</span>(<span class="params">M</span>):</span><br><span class="line">    <span class="comment"># compile https://github.com/keeganryan/flatter and put it in $PATH</span></span><br><span class="line">    z = <span class="string">&quot;[[&quot;</span> + <span class="string">&quot;]\n[&quot;</span>.join(<span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, row)) <span class="keyword">for</span> row <span class="keyword">in</span> M) + <span class="string">&quot;]]&quot;</span></span><br><span class="line">    ret = check_output([<span class="string">&quot;flatter&quot;</span>], <span class="built_in">input</span>=z.encode())</span><br><span class="line">    <span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line">    <span class="keyword">return</span> matrix(M.nrows(), M.ncols(), <span class="built_in">map</span>(<span class="built_in">int</span>, findall(<span class="string">b&quot;-?\\d+&quot;</span>, ret)))</span><br><span class="line"></span><br><span class="line">debug = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># 如果格达到该尺寸，则停止移除</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示有用矢量的统计数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示带有 0 和 X 的矩阵</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>: </span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="comment">#print (a)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试删除无用的向量</span></span><br><span class="line"><span class="comment"># 从当前 = n-1（最后一个向量）开始</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line">    <span class="comment"># 我们从当前 = n-1（最后一个向量）开始</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始从后面检查</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment">#  如果它没有用</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">             <span class="comment"># 让我们检查它是否影响其他向量</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># 如果另一个向量受到影响：</span></span><br><span class="line">                <span class="comment"># 我们增加计数</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 等级：0</span></span><br><span class="line">            <span class="comment"># 如果没有其他载体最终受到影响</span></span><br><span class="line">            <span class="comment"># 我们删除它</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="comment">#print (&quot;* removing unhelpful vector&quot;, ii)</span></span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">           <span class="comment"># 等级：1</span></span><br><span class="line">            <span class="comment">#如果只有一个受到影响，我们会检查</span></span><br><span class="line">            <span class="comment"># 如果它正在影响别的向量</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># 如果它影响哪怕一个向量</span></span><br><span class="line">                    <span class="comment"># 我们放弃这个</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># 如果没有其他向量受到影响，则将其删除，并且</span></span><br><span class="line">                <span class="comment"># 这个有用的向量不够有用</span></span><br><span class="line">                <span class="comment">#与我们无用的相比</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="comment">#print (&quot;* removing unhelpful vectors&quot;, ii, &quot;and&quot;, affected_vector_index)</span></span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1，-1 如果 &quot;strict=true&quot;，并且行列式不受约束</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string"> 在以下情况下找到解决方案：</span></span><br><span class="line"><span class="string">* d &lt; N^delta</span></span><br><span class="line"><span class="string">* |x|&lt; e^delta</span></span><br><span class="line"><span class="string">* |y|&lt; e^0.5</span></span><br><span class="line"><span class="string">每当 delta &lt; 1 - sqrt（2）/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)   <span class="comment">#多项式环</span></span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u)        <span class="comment">#  u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-移位</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 单项式 x 移位列表</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials(): <span class="comment">#对于多项式中的单项式。单项式（）：</span></span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:  <span class="comment"># 如果单项不在单项中</span></span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-移位</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 单项式 y 移位列表</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构造格 B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#约化格的原型</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment">#  #自动删除</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 重置维度</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查向量是否有帮助</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查行列式是否正确界定</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#BB = BB.BKZ(block_size=25)</span></span><br><span class="line">    BB = flatter(BB)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 替换向量 i 和 j -&gt;多项式 1 和 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;在格中寻找线性无关向量&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    pol1_idx = <span class="number">0</span></span><br><span class="line">    pol2_idx = <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">    <span class="comment"># 对于i and j, 构造两个多项式</span></span><br><span class="line">    </span><br><span class="line">    PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">    pol1 = pol2 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">        pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 结果</span></span><br><span class="line">    PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">    rr = pol1.resultant(pol2)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]):</span><br><span class="line">        found_polynomials = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>(<span class="params">pM</span>):</span><br><span class="line">    t1 = time.time()</span><br><span class="line"></span><br><span class="line">    size=<span class="number">512</span>     <span class="comment">#The size of p; size=1024 in Tables 10</span></span><br><span class="line">    length_N = <span class="number">2</span>*size</span><br><span class="line">    s=<span class="number">19</span>;      <span class="comment">#s is the number of MSBs exhaustion,  which can be chosen as we need.</span></span><br><span class="line">    nw=<span class="number">3</span>     <span class="comment">#2^nw windows</span></span><br><span class="line">    delta = <span class="number">0.292</span></span><br><span class="line"></span><br><span class="line">    N = <span class="number">0xf4c548636db62ffcc7ac4a0797952bea9a65bd426175af2435f72657e67ec8194667bfa94ce23c6f1e5baf3201867ab41701f6b8768e71009c41a3d5e9e7c109455341d549c7611f9f52851a2f017906aa9ccbedb95d238468e2c8577d30ecc4f158e3811fd5e2a6051443d468e3506bbc39bba710e34a604ac9e85d0feef8b3</span>;</span><br><span class="line">    e = <span class="number">0x16f4b438ba14e05afa944f7da9904f8c78ea52e4ca0be7fa2b5f84e22ddd7b0578a3477b19b7bb4a7f825acc45da2dd10e62dbd94a3386b97d92ee817b0c66c1507514a7860b9139bc2ac3a4e0fe304199214da00a4ca82bfcb7b18253e7e6144828e584dac2dfb9a03fabaf2376ce7c269923fbb60fc68325b9f6443e1f896f</span>;</span><br><span class="line">    c = <span class="number">0x26b1823cf836b226e2f5c90fdcd8420dbfcd02765b26e52ef3e5c0ab494c2f4650e475e280b0b5fff0d5016621186420b09e4706a5866e4a3319f23ef09d92c4e36acba39a0f6213fbe5ee1a736ce383e6e12351e6cbfd43f10a96b7fe34bdbaf948f2fb075d9063723c9f747fe6247ae9209e5d417faf2e37e6fee2eb863556</span>;</span><br><span class="line">    <span class="comment"># The parameters (N, e) can be chosen as we need. </span></span><br><span class="line">    m = <span class="number">12</span>   <span class="comment"># 格大小（越大越好/越慢）</span></span><br><span class="line">    <span class="comment">#guess=100</span></span><br><span class="line">    <span class="comment"># you need to be a lattice master to tweak these</span></span><br><span class="line">    t = <span class="built_in">round</span>(((<span class="number">1</span>-<span class="number">2</span>*delta) * m))  <span class="comment"># 来自 Herrmann 和 May 的优化</span></span><br><span class="line">    X = floor(N^delta)  <span class="comment"># </span></span><br><span class="line">    Y = <span class="number">2</span>*floor(N^(<span class="number">1</span>/<span class="number">2</span>)/<span class="number">2</span>^s)    <span class="comment"># 如果 p、 q 大小相同，则正确</span></span><br><span class="line"></span><br><span class="line">    p0=pM*<span class="number">2</span>^(size-s)+<span class="number">2</span>^(size-s-<span class="number">1</span>);</span><br><span class="line">    q0=N/p0;</span><br><span class="line">    qM=<span class="built_in">int</span>(q0/<span class="number">2</span>^(size-s))</span><br><span class="line">    A = N + <span class="number">1</span>-pM*<span class="number">2</span>^(size-s)-qM*<span class="number">2</span>^(size-s);</span><br><span class="line">    P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    pol = <span class="number">1</span> + x * (A + y)  <span class="comment">#构建的方程</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="comment">##print (&quot;=== running algorithm ===&quot;)</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">    solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="comment">#print (&quot;=== solution found ===&quot;)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line"></span><br><span class="line">        d_sol = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">        <span class="comment">#print (&quot;私钥d:&quot;, d)</span></span><br><span class="line">        <span class="comment">#if(d_sol==d):</span></span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;p的高比特为：&quot;</span>,pM)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;q的高比特为：&quot;</span>,qM)</span><br><span class="line">        <span class="comment">#print(&quot;p的真实高比特：&quot;,int(p/2^(512-s)))</span></span><br><span class="line">        <span class="comment">#print(&quot;q的真实高比特：&quot;,int(q/2^(512-s)))</span></span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;d=&quot;</span>,d_sol)</span><br><span class="line">        </span><br><span class="line">    t2 = time.time()</span><br><span class="line">    <span class="built_in">print</span>(t2-t1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    possible = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">18</span>):</span><br><span class="line">        t1 = (<span class="number">2</span>^<span class="number">18</span> + i)*<span class="number">2</span>^(<span class="number">512</span>-<span class="number">19</span>)</span><br><span class="line">        t2 = (<span class="number">2</span>^<span class="number">18</span> + i)*<span class="number">2</span>^(<span class="number">512</span>-<span class="number">19</span>) + (<span class="number">2</span>^(<span class="number">512</span>-<span class="number">19</span>)-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(<span class="built_in">bin</span>(N3//t1)[<span class="number">2</span>:]) &gt;= <span class="number">512</span> <span class="keyword">and</span> <span class="built_in">len</span>(<span class="built_in">bin</span>(N3//t2)[<span class="number">2</span>:]) &lt;= <span class="number">512</span>):</span><br><span class="line">            possible.append(<span class="number">2</span>^<span class="number">18</span> + i)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> Pool(<span class="number">32</span>) <span class="keyword">as</span> pool:</span><br><span class="line">        r = <span class="built_in">list</span>(pool.imap(example, possible))</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">N4=<span class="number">0xd46dd141810786e451320ca452b379024fd263501ae767760f3dcf34b79806b85e36b0fee538dac61a5872c37d051a8a026384d09f12b7e1adae7eb15c4d75878007ee0043c2186cf8999c59eb66f689f55baf190bd80e70bf47b553be76bd4efffc782a51b43314d54b83fc19461e1beb6021164f64723b505e5a619cb62335</span>；</span><br><span class="line">e4=<span class="number">0x92fbeeef2d40eb125234cfe4c063c4607f12aec7e3014b32fb4600e58c4eac1ec485192a1b03745632f2966311ad68bd1e49dd9d08b2bff67f58e214c8d7bae0142559994c24e347ff7555c86aa30ccd03cf794e6f00eead7f15e24f33da61fae11ec81e4e09bcc76c1a0ed5ca8c2f512856cdb42470beee7111a2410188697d</span>；</span><br><span class="line">c4=<span class="number">0x8c5e9db89f96d769f6514836407755caf71b7bc6f5db2246200b0f824dac7ea3be5ba022c0e191d76c69b7d20c7cad5c49e381479c7cbe7ba055ce8aec2cad1a19d42aa5c4b8c07c67e22c70289891d53c3d55dff50e506ec7fb480df44f9b3219f8c73e0702d8072e9f6aabed8bb5d35f583bea30ce850b154d4fd8c39e4fb8</span>；</span><br></pre></td></tr></table></figure>
<p>信息：</p>
<ul>
<li>d在$2^{399}-2^{400}$之间</li>
<li>d最高310位比特汉明重量不超过5</li>
</ul>
<p>考虑先将d拆分为高310位dh与低90位dl，那么如下等式成立：</p>
<script type="math/tex; mode=display">
e(d_h+d_l) = 1 + k[n+1 - (p+q)]</script><p>这里的dh直接表示一个400bit，且低90位LSB全为0的量。由题目信息得知dh汉明重量不超过5，又因为其MSB一定为1，所以等价于dh的2-310位汉明重量不超过4，因此存在汉明重量为0、1、2、3、4的几种情况，其爆破复杂度分别为：</p>
<script type="math/tex; mode=display">
C(309,0) = 1</script><script type="math/tex; mode=display">
C(309,1) = 309</script><script type="math/tex; mode=display">
C(309,2) = 47586</script><script type="math/tex; mode=display">
C(309,3) = 4869634 \approx 2^{23}</script><script type="math/tex; mode=display">
C(309,4) = 372527001 \approx 2^{29}</script><p>复杂度都还可以接受，因此用爆破方式，对于每个可能的dh，利用上述等式构造出如下三元copper：</p>
<script type="math/tex; mode=display">
f = ex - 1 - y(n+1 - z)  \quad(mod\;ed_h)</script><p>这个模多项式具有小根$(dl,k,p+q)$，其bounds可设为$(2^{90},2^{400},2^{513})$，利用defund的多元coppersmith代码先进行数据测试出m=2，d=3时，在dh正确时可以得到预期的正确小根$(dl,k,p+q)$</p>
<p>同时，设置上述参数可以发现在实验过程中，能够求解的dl小根上界能够达到118bit，也就是对于$(2^{118},2^{400},2^{513})$的bounds，这样的copper几乎也能达到100%的成功率。所以考虑令dl表示d的低118位，dh表示一个400bit，且低118位LSB全为0的量。此时重新估计爆破复杂度：</p>
<script type="math/tex; mode=display">
C(281,0) = 1</script><script type="math/tex; mode=display">
C(281,1) = 281</script><script type="math/tex; mode=display">
C(281,2) = 39340</script><script type="math/tex; mode=display">
C(281,3) = 3658620 \approx 2^{22}</script><script type="math/tex; mode=display">
C(281,4) = 254274090 \approx 2^{28}</script><p>可以看到复杂度降低的并不算很多，但是有一点需要注意，就是如果高310位的汉明重量构成中，有至少一个1分布在90-118这个LSB区间内的话，就可以把复杂度直接降一阶。而如果把高2-310位的几个1视作完全随机散落在其中的话，那么可以简单估计一下至少有一个1落在90-118这个LSB区间内的概率为：</p>
<script type="math/tex; mode=display">
P = 1 - \frac{C(281,4)}{C(309,4)} \approx 0.317</script><p>因此有31.7%的不算低的概率显著降低爆破复杂度，并且最终结果也证明的确有一个1分布在此区间内。</p>
<p>开48进程跑，最终耗时约为三小时，不过如果不满足这种情况的话会很麻烦，复杂度会增加2^6倍左右。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#coppersmith</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">bits</span>):</span><br><span class="line">    n=<span class="number">0xd46dd141810786e451320ca452b379024fd263501ae767760f3dcf34b79806b85e36b0fee538dac61a5872c37d051a8a026384d09f12b7e1adae7eb15c4d75878007ee0043c2186cf8999c59eb66f689f55baf190bd80e70bf47b553be76bd4efffc782a51b43314d54b83fc19461e1beb6021164f64723b505e5a619cb62335</span></span><br><span class="line">    e=<span class="number">0x92fbeeef2d40eb125234cfe4c063c4607f12aec7e3014b32fb4600e58c4eac1ec485192a1b03745632f2966311ad68bd1e49dd9d08b2bff67f58e214c8d7bae0142559994c24e347ff7555c86aa30ccd03cf794e6f00eead7f15e24f33da61fae11ec81e4e09bcc76c1a0ed5ca8c2f512856cdb42470beee7111a2410188697d</span></span><br><span class="line">    c=<span class="number">0x8c5e9db89f96d769f6514836407755caf71b7bc6f5db2246200b0f824dac7ea3be5ba022c0e191d76c69b7d20c7cad5c49e381479c7cbe7ba055ce8aec2cad1a19d42aa5c4b8c07c67e22c70289891d53c3d55dff50e506ec7fb480df44f9b3219f8c73e0702d8072e9f6aabed8bb5d35f583bea30ce850b154d4fd8c39e4fb8</span></span><br><span class="line"></span><br><span class="line">    dh = <span class="number">1</span> &lt;&lt; <span class="number">399</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> bits:</span><br><span class="line">        dh += <span class="built_in">int</span>(<span class="number">1</span> &lt;&lt; j)</span><br><span class="line"></span><br><span class="line">    PR.&lt;x,y,z&gt; = PolynomialRing(Zmod(e*dh))</span><br><span class="line">    f = e*x - <span class="number">1</span> - y*(n+<span class="number">1</span>-z)</span><br><span class="line">    bounds = (<span class="number">2</span>^<span class="number">118</span>,<span class="number">2</span>^<span class="number">400</span>,<span class="number">2</span>^<span class="number">513</span>)</span><br><span class="line"></span><br><span class="line">    res = small_roots(f,bounds,m=<span class="number">2</span>,d=<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span>(res != []):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Found :&quot;</span> , bits , res)</span><br><span class="line"></span><br><span class="line">bits_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">118</span>,<span class="number">399</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>,<span class="number">399</span>):</span><br><span class="line">        bits_list.append((i,j))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> Pool(<span class="number">48</span>) <span class="keyword">as</span> pool:</span><br><span class="line">        r = <span class="built_in">list</span>(pool.imap(attack, bits_list))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Found : (249, 384) [(5192297506701663409346420477763893, 893384003511473915730729716053400071808197337898454780292963816952680159001572448270279758619478210599539972781994723065, 24525002309255501553376344678840111819444126206525944516411655318006503268196948978108788630740241285503306697779442437584553316771409973418709483848235094)]</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">N5=<span class="number">0x94eab94581f4931a5ea6aabcfe0598600fa3e0a06573887aed69e274f14484472dc3feaf50d4ef384e502f747f5605c1d2a4c8172b6ef134b7e96d6c383a9cb967ccbbd8b3647848d34928982a274999c2df00bd7dd11bf25acd61411e3395637e85dd84ecf785ff1027eed91f3976c8186e2e940edcb5fed8d759a5028b47a1</span>;</span><br><span class="line">e5=<span class="number">0x124c552642ef2467aaecde51b0f3e1bee2ebe87bae39a956ad56cf7eec669cdc7b9664ea435b4c3492b8e610e0a182e1a76c7af443ca2962672b4e703c4f359cf8d88a67db77be2491b74bcdae58691b69e6ea06d067815b26fc0d669d8c06f11a728154dc8cdf983a056633fecadc417df4304625c3e6f91ec3d655a91a29e9</span>;</span><br><span class="line">c5=<span class="number">0x63e09028c774513b5420236f8405f970c8d97c8347697c44f50b23e5cc964c921413b5e6742bb5ba7ef49f032e372f502babc0040f9c7cc2c9f4e27d18aefff0e764529ba70f6a7b22d525d0aaeb1d21432817b6b148b8143c80a6401a5c9adfecf0c033181bb076a2192a4866c5355c9e401fba78d5f22b9c1661c0065a1a28</span>;</span><br></pre></td></tr></table></figure>
<p>信息：</p>
<ul>
<li>d在$2^{511}-2^{512}$之间</li>
<li>d的高256位以及低176位已知，中间80位未知</li>
</ul>
<p>由题目已知信息，d可以写作：</p>
<script type="math/tex; mode=display">
d = d_l + 2^{176}d_x + 2^{256}d_m</script><p>那么有如下等式成立：</p>
<script type="math/tex; mode=display">
e(d_l + 2^{176}d_x + 2^{256}d_m) = 1 + k[(n+1) - (p+q)]</script><p>而由于d存在高256bit的泄露，因此对于下面的等式：</p>
<script type="math/tex; mode=display">
ed = 1 + k\phi(n)</script><p>可以得到一个近似关系为：</p>
<script type="math/tex; mode=display">
e(2^{256}d_m) \approx k'n</script><p>因此可以得到一个k的近似值k’：</p>
<script type="math/tex; mode=display">
k' = \frac{e(2^{256}d_m)}{n}</script><p>这样得到的k与真实k’的差值也在256bit附近，可以将差值记作x：</p>
<script type="math/tex; mode=display">
k = k' + x</script><p>代入等式得到：</p>
<script type="math/tex; mode=display">
e(d_l + 2^{176}d_x + 2^{256}d_m) = 1 + (k'+x)[(n+1) - (p+q)]</script><p>此时可以将该等式写成模多项式的形式如下：</p>
<script type="math/tex; mode=display">
f  = 1 + (k' + x)[(n+1) - y] - edl \quad(mod\;2^{176}e)</script><p>该多项式有小根$(x,p+q)$，其bounds可设为$(2^{256},2^{513})$，利用defund的多元coppersmith代码进行数据测试，测试出直接令LSB泄露位数为176时，copper的效果并不是很好。而当LSB泄露位数达到181时，取m=4，d=5，在dh正确时可以在较短时间内得到预期的正确小根$(x,p+q)$，因此最终考虑爆破5位LSB，并结合copper去解如下模多项式的小根：</p>
<script type="math/tex; mode=display">
f  = 1 + (k' + x)[(n+1) - y] - edl \quad(mod\;2^{181}e)</script><p>此时sage10.2可在2min内求解出小根，不过这是因为爆破的5位恰好全为0导致的，平均期望时间为16*2min，约为半小时。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="comment">#coppersmith</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">iii</span>):</span><br><span class="line">    leakh = <span class="number">256</span></span><br><span class="line">    leakl = <span class="number">181</span></span><br><span class="line">    n=<span class="number">0x94eab94581f4931a5ea6aabcfe0598600fa3e0a06573887aed69e274f14484472dc3feaf50d4ef384e502f747f5605c1d2a4c8172b6ef134b7e96d6c383a9cb967ccbbd8b3647848d34928982a274999c2df00bd7dd11bf25acd61411e3395637e85dd84ecf785ff1027eed91f3976c8186e2e940edcb5fed8d759a5028b47a1</span></span><br><span class="line">    e=<span class="number">0x124c552642ef2467aaecde51b0f3e1bee2ebe87bae39a956ad56cf7eec669cdc7b9664ea435b4c3492b8e610e0a182e1a76c7af443ca2962672b4e703c4f359cf8d88a67db77be2491b74bcdae58691b69e6ea06d067815b26fc0d669d8c06f11a728154dc8cdf983a056633fecadc417df4304625c3e6f91ec3d655a91a29e9</span></span><br><span class="line">    c=<span class="number">0x63e09028c774513b5420236f8405f970c8d97c8347697c44f50b23e5cc964c921413b5e6742bb5ba7ef49f032e372f502babc0040f9c7cc2c9f4e27d18aefff0e764529ba70f6a7b22d525d0aaeb1d21432817b6b148b8143c80a6401a5c9adfecf0c033181bb076a2192a4866c5355c9e401fba78d5f22b9c1661c0065a1a28</span></span><br><span class="line"></span><br><span class="line">    dbits = <span class="number">512</span></span><br><span class="line">    dl=<span class="number">0x2b26d177dc20ceea15de6e3c5a03207fb326a42d53a9</span> + iii*<span class="number">2</span>^<span class="number">176</span></span><br><span class="line">    dh=<span class="number">0xacfad4bbb97a99b6bbc82c8b44a5260bcfe9c4a0acf437186ff4d5d1594cc5c1</span> * <span class="number">2</span>^<span class="number">256</span></span><br><span class="line"></span><br><span class="line">    k_ = e*dh // n</span><br><span class="line"></span><br><span class="line">    PR.&lt;x,y&gt; = PolynomialRing(Zmod(e*<span class="number">2</span>^leakl))</span><br><span class="line">    f = <span class="number">1</span> + (k_ + x) * ((n+<span class="number">1</span>) - y) - e*dl</span><br><span class="line"></span><br><span class="line">    bounds = (<span class="number">2</span>^(dbits - leakh),<span class="number">2</span>^<span class="number">513</span>)</span><br><span class="line">    res = small_roots(f,bounds,m=<span class="number">4</span>,d=<span class="number">5</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">ilist = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">5</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(ilist):</span><br><span class="line">    attack(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#[(282010924167718115516906667153545502501458151856718764152936084250030151051, 20661478341083012421041400219228187859079281634475352660573325439758998053149827536900946611679931330854849964562295456435862096666323900861438939486653810)]</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="6"><a href="#6" class="headerlink" title="6"></a>6</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">N6=<span class="number">0x94e4c83c67c6d6e33d83cc2953df899e8c4b33894f653d5bbc84d7dd9058e6949221897f6e5b7b8bd9013f495c906862e401436e77be585474066f6c220751dd9b2b8be66f07ad7f090547a6e759e482ba263b941b32c27c62c4b558d96dda168b28c52e550b7d7ff145a5996c0b398714cf5ee8f0ea1a3d5b17c592f1c15275</span>;</span><br><span class="line">e6=<span class="number">0x949b2e72766be1e83ee278a56bc86a2d3268b719507068ac62c6d249a810284edaac39335e8d699630887c13864f4cdf1c0c423b2f7ae88ccc60a827332e6c410800c7c7a1677918c28aa51086991d1290fc64b8e1b0f14b482f35d86139bb3491a59e2ad99dcd35bd129a44c3b8e2667e405dc2d307a5bb5a1504d7ded3bda3</span>;</span><br><span class="line">c6=<span class="number">0x6fd6fae8ab4e95e622e5dad2921c6f12e911df08768abf2d10d212ad9a26e4c5ec71640d7a6b3488064fd424224bc2c762b956af95a3212de37a57d74c0299936f48ae3d8b8803e644e8d1306ab735c94fd815fe8c77982b32d51e9b6f3b3d4f3753810b61fb528c3e9eb774dabd93a3c5c9919ae3fb90e8e998ed3e7f949738</span>;</span><br></pre></td></tr></table></figure>
<p>信息：</p>
<ul>
<li>d在$2^{559}-2^{560}$之间</li>
<li>d的最高123位比特取值未知，但其剩余437位比特取值已知</li>
<li>d的低437位取值很小，为0x6da211f0d34b，也就是说d的中间大部分比特均为0</li>
</ul>
<p>题目基于私钥特定低比特位的泄露，可以观察到其泄露的低位数据相当特殊，其中间位置为很多连续的0。如果将所有数据表示为：</p>
<script type="math/tex; mode=display">
e = N^{\alpha},d = N^{\beta}</script><script type="math/tex; mode=display">
d = 2^rd_1+d_2 , 2^r = N^{\delta}</script><p>则其所有参数完全符合给出的参考文献三的如下条件：</p>
<script type="math/tex; mode=display">
\alpha \approx 1 ,d_2 < N^{\beta-0.5}</script><script type="math/tex; mode=display">
\beta - \delta \leq \frac{3}{4} - \frac{1}{4}\sqrt{8\beta+1} - \epsilon</script><p>因此参考文献三的特殊LSB泄露情况理论上能够解决本题，构造模多项式如下：</p>
<script type="math/tex; mode=display">
A - Nx + xy = 0 \quad(mod\;W)</script><p>其中：</p>
<script type="math/tex; mode=display">
x = k,y = p+q-1,W = e2^r</script><p>此外采用线性化模方程处理，引入新变量$u = xy + A$，则得到方程：</p>
<script type="math/tex; mode=display">
-Nx + u = 0 \quad(mod\;W)</script><p>然后选用如下单项式与对应多项式集合进行格构造：</p>
<script type="math/tex; mode=display">
G_t = \{x^{t-j}u^j \mid j = 0,1,2,\cdots t\} \quad G_t^{*} = \{x^{t-j}f^jW^{m-j} \mid j = 0,1,2,\cdots t\}</script><script type="math/tex; mode=display">
P_i = \{y^iu^j \mid j = \theta_i,\theta_i+1,\theta_i+2,\cdots m\} \quad P_i^{*} = \{y^if^jW^{m-j} \mid \theta_i,\theta_i+1,\theta_i+2,\cdots m\}</script><p>最终参考实验数据，选择参数：</p>
<script type="math/tex; mode=display">
m=7,\tau=6,\theta = \{2,3,4,5,6,7\}</script><p>可以在1min左右求解。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#gen params</span></span><br><span class="line">alpha = <span class="number">1</span></span><br><span class="line">beta = <span class="number">560</span>/<span class="number">1024</span></span><br><span class="line">delta = <span class="number">437</span>/<span class="number">1024</span></span><br><span class="line"></span><br><span class="line">r = <span class="built_in">int</span>(<span class="number">1024</span>*delta)</span><br><span class="line">N = <span class="number">0x94e4c83c67c6d6e33d83cc2953df899e8c4b33894f653d5bbc84d7dd9058e6949221897f6e5b7b8bd9013f495c906862e401436e77be585474066f6c220751dd9b2b8be66f07ad7f090547a6e759e482ba263b941b32c27c62c4b558d96dda168b28c52e550b7d7ff145a5996c0b398714cf5ee8f0ea1a3d5b17c592f1c15275</span>;</span><br><span class="line">e = <span class="number">0x949b2e72766be1e83ee278a56bc86a2d3268b719507068ac62c6d249a810284edaac39335e8d699630887c13864f4cdf1c0c423b2f7ae88ccc60a827332e6c410800c7c7a1677918c28aa51086991d1290fc64b8e1b0f14b482f35d86139bb3491a59e2ad99dcd35bd129a44c3b8e2667e405dc2d307a5bb5a1504d7ded3bda3</span>;</span><br><span class="line">c = <span class="number">0x6fd6fae8ab4e95e622e5dad2921c6f12e911df08768abf2d10d212ad9a26e4c5ec71640d7a6b3488064fd424224bc2c762b956af95a3212de37a57d74c0299936f48ae3d8b8803e644e8d1306ab735c94fd815fe8c77982b32d51e9b6f3b3d4f3753810b61fb528c3e9eb774dabd93a3c5c9919ae3fb90e8e998ed3e7f949738</span>;</span><br><span class="line">d2 = dl=<span class="number">0x6da211f0d34b</span></span><br><span class="line"></span><br><span class="line">m = <span class="number">7</span></span><br><span class="line">tau = <span class="number">6</span></span><br><span class="line">theta = [<span class="string">&quot;pad&quot;</span>] + [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#attack</span></span><br><span class="line">A = e*d2-<span class="number">1</span></span><br><span class="line">W = e*<span class="number">2</span>^r</span><br><span class="line">X = <span class="built_in">int</span>(N^(alpha+beta-<span class="number">1</span>))</span><br><span class="line">Y = <span class="built_in">int</span>(<span class="number">3</span>*N^<span class="number">0.5</span>)</span><br><span class="line">U = <span class="built_in">int</span>(<span class="number">7</span>*N^(alpha+beta-<span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line">PR.&lt;x,y,u&gt; = PolynomialRing(ZZ)</span><br><span class="line">x,y,u = PR.gens()</span><br><span class="line">f = -N*x + u</span><br><span class="line">f_ = u - (x*y + A)</span><br><span class="line"></span><br><span class="line">poly = []</span><br><span class="line">monomials=<span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">#G</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,m+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,t+<span class="number">1</span>):</span><br><span class="line">        G = x^(t-j) * f^j * W^(m-j)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#deal with xy</span></span><br><span class="line">        <span class="keyword">for</span> mono <span class="keyword">in</span> G.monomials():</span><br><span class="line">            <span class="keyword">while</span>(mono % (x*y) == <span class="number">0</span>):</span><br><span class="line">                temp = G.monomial_coefficient(mono)</span><br><span class="line">                G -= temp*mono</span><br><span class="line">                mono //= (x*y)</span><br><span class="line">                mono *= (u-A)</span><br><span class="line">                G += temp*mono</span><br><span class="line">        poly.append(G)</span><br><span class="line">        <span class="keyword">for</span> mono <span class="keyword">in</span> G.monomials():</span><br><span class="line">            monomials.add(mono)</span><br><span class="line"></span><br><span class="line"><span class="comment">#P</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,tau+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(theta[i],m+<span class="number">1</span>):</span><br><span class="line">        P = y^i * f^j * W^(m-j)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#deal with xy</span></span><br><span class="line">        <span class="keyword">for</span> mono <span class="keyword">in</span> P.monomials():</span><br><span class="line">            <span class="keyword">while</span>(mono % (x*y) == <span class="number">0</span>):</span><br><span class="line">                temp = P.monomial_coefficient(mono)</span><br><span class="line">                P -= temp*mono</span><br><span class="line">                mono //= (x*y)</span><br><span class="line">                mono *= (u-A)</span><br><span class="line">                P += temp*mono</span><br><span class="line">        poly.append(P)</span><br><span class="line">        <span class="keyword">for</span> mono <span class="keyword">in</span> P.monomials():</span><br><span class="line">            monomials.add(mono)</span><br><span class="line"></span><br><span class="line">L = Matrix(ZZ,<span class="built_in">len</span>(poly),<span class="built_in">len</span>(monomials))</span><br><span class="line"></span><br><span class="line">monomials = <span class="built_in">sorted</span>(monomials)</span><br><span class="line"><span class="keyword">for</span> row,shift <span class="keyword">in</span> <span class="built_in">enumerate</span>(poly):</span><br><span class="line">    <span class="keyword">for</span> col,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">        L[row,col] = shift.monomial_coefficient(monomial)*monomial(X,Y,U)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(L.dimensions())</span><br><span class="line"></span><br><span class="line">res = L.LLL()</span><br><span class="line">vec1 = res[<span class="number">2</span>]</span><br><span class="line">vec2 = res[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">f1 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> idx,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">	f1 += (vec1[idx] // monomial(X,Y,U)) * monomial</span><br><span class="line">f1 = f1.change_ring(ZZ)</span><br><span class="line">f2 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> idx,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">	f2 += (vec2[idx] // monomial(X,Y,U)) * monomial</span><br><span class="line">f2 = f2.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">g1 = f_.sylvester_matrix(f1, u).det()</span><br><span class="line">g2 = f_.sylvester_matrix(f2, u).det()</span><br><span class="line">h = g1.sylvester_matrix(g2, x).det()</span><br><span class="line">res1 = h.univariate_polynomial().monic().roots()</span><br><span class="line"><span class="built_in">print</span>(res1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#p+q-1 is:</span></span><br><span class="line"><span class="comment">#[(20669116529972280868235472642422776201909637285884516155862888589837342513282316090088342096364702368094391219552254156670270390106105101130869387179628885, 1)]</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="7"><a href="#7" class="headerlink" title="7"></a>7</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">N7=<span class="number">0xaeb75bb97217271bf312a7897da81a544fe469ba0f1cf75304f2a5629717e1e3d0a9a28e71135443cc19f78c60dd3f7ea4ea28ae64657d5ac3b46e9755020de73cb5c4f89a682e0193916221bc8f4abb595f2c058bbb99e199a66144a9a9b258a74db847b2460107233280c94e854394595043f62bf77cd96c9ed3eca71b726d</span>;</span><br><span class="line">e7=<span class="number">0x42b63e1113b4a84d0b037006a9bb729b52db495fa6b475bb64129a855a4ed6511792d0df946c5d7e22085d0db07bce5e408454a61c0cea51cf6d25e2455a2c6dc092e4b09bf4efb2157ffc1d1db3e969499479d721330ec4ac864e656318bc7bb9831a0dccf582406c87ae5d3ab9ffec351271dbb5481a0b6ed75a760b4f7e0d</span>;</span><br><span class="line">c7=<span class="number">0xe1f90d9f115f9ba0b65ea8826ffec785bbe1b195fbb6f93c6ea28940f0d9b571930addb3e2714999ba5a19d17af22f1bc8da49f8b515ab03b6d276140b69fedf980d1aef78d0f3c0f6effdf2e92ce9195866f85672037537021178f8c65989b57f29de2c4c9306fe3e13aef29f962f86b8d5216907e85f28260b9f41cfe2651</span>;</span><br></pre></td></tr></table></figure>
<p>信息：</p>
<ul>
<li>$\phi-d$的范围在$2^{267}-2^{268}$之间</li>
</ul>
<p>记这个小差值为t，就有：</p>
<script type="math/tex; mode=display">
d = \phi - t</script><p>可以看出目标是把t作为某个模多项式的小根，因此仍然利用e、d与$\phi(n)$的关系式：</p>
<script type="math/tex; mode=display">
e(\phi - t) = 1 + k\phi</script><p>移项整理一下：</p>
<script type="math/tex; mode=display">
(e - k)\phi = et + 1</script><p>这是一个等式，而由于$\phi,e$数量级是相近的，所以e-k和t数量级也只能相近，因此e-k也差不多在$2^{267}-2^{268}$这个范围，记这个值为r，那么在模e下就有：</p>
<script type="math/tex; mode=display">
r(n - (p+q) + 1) - 1 = 0 \quad(mod\;e)</script><p>所以有以(r,p+q)为小根的多项式：</p>
<script type="math/tex; mode=display">
f(x,y) = x(n - y + 1) - 1 \quad(mod\;e)</script><p>之后用defund的copper就行。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line"> </span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line"> </span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line"> </span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line"> </span><br><span class="line">    B, monomials = G.coefficients_monomials()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line"> </span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line"> </span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line"> </span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line"> </span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">n = <span class="number">0xaeb75bb97217271bf312a7897da81a544fe469ba0f1cf75304f2a5629717e1e3d0a9a28e71135443cc19f78c60dd3f7ea4ea28ae64657d5ac3b46e9755020de73cb5c4f89a682e0193916221bc8f4abb595f2c058bbb99e199a66144a9a9b258a74db847b2460107233280c94e854394595043f62bf77cd96c9ed3eca71b726d</span>;</span><br><span class="line">e = <span class="number">0x42b63e1113b4a84d0b037006a9bb729b52db495fa6b475bb64129a855a4ed6511792d0df946c5d7e22085d0db07bce5e408454a61c0cea51cf6d25e2455a2c6dc092e4b09bf4efb2157ffc1d1db3e969499479d721330ec4ac864e656318bc7bb9831a0dccf582406c87ae5d3ab9ffec351271dbb5481a0b6ed75a760b4f7e0d</span>;</span><br><span class="line">c = <span class="number">0xe1f90d9f115f9ba0b65ea8826ffec785bbe1b195fbb6f93c6ea28940f0d9b571930addb3e2714999ba5a19d17af22f1bc8da49f8b515ab03b6d276140b69fedf980d1aef78d0f3c0f6effdf2e92ce9195866f85672037537021178f8c65989b57f29de2c4c9306fe3e13aef29f962f86b8d5216907e85f28260b9f41cfe2651</span>;</span><br><span class="line"></span><br><span class="line">R.&lt;x,y&gt; = PolynomialRing(Zmod(e))</span><br><span class="line">f = <span class="number">1</span>+x*(n+<span class="number">1</span>-y)</span><br><span class="line">bounds = (<span class="number">2</span>^<span class="number">268</span>,<span class="number">2</span>^<span class="number">513</span>)</span><br><span class="line">res = small_roots(f,bounds,m=<span class="number">3</span>,d=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">pplusq = <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">pminusq = iroot(pplusq^<span class="number">2</span>-<span class="number">4</span>*n,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">p = (pplusq + pminusq) // <span class="number">2</span></span><br><span class="line">q = n // p</span><br><span class="line"></span><br><span class="line">d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q =&quot;</span>,q)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n)))[::-<span class="number">1</span>].decode(<span class="string">&#x27;ISO-8859-1&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="8"><a href="#8" class="headerlink" title="8"></a>8</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">N8=<span class="number">0xf12eac2099c4190a6f586bea0b4fc3f9dff4f23f0cb8e42cbeff950aa1df8a373c49df7974fb33b4b6619eadb2d6c01f80da1b433295b199df11b323114c439884eb31fa568bd747ae37079e885e2490c3b5a56d61b9d10533983ff78fe85e07876fe2ae07ae7ea1c71f0f9c2d6beccdcd8baf046a58549aec19d45d48d7d92d</span>;</span><br><span class="line">e8=<span class="number">0xb8906f5097658f27cc448d98974d9e7ccd4e8a8f25a80007826c341dcb2ac42420f899e5a89045fbefd9163bc94e6f98b4953546203be4bec249031587a27dbf</span>;</span><br><span class="line">c8=<span class="number">0x162a6dee8bcbe24698b9249137c2a157890910fa74a56e7d2792b5b4f29112aba03448995ff32ed24bec5118f7433212196d3f99e1c794b61395d8183e4658c9dc05953a87c069c9390773c7f885907840ebd29676afac7bf3374d54c81c4e404f09716b9885d243c41dc48db561f8291b88826cae32bfd575a472e523f455c4</span>;</span><br></pre></td></tr></table></figure>
<p>信息：</p>
<ul>
<li>e仅有512bit，约为$n^{0.5}$</li>
<li>d的低900位已知，高124位未知</li>
</ul>
<p>题目为私钥d的LSB泄露情况，并且加密指数e的比特数约为N的一半，结合此种情况找到参考文献：</p>
<p><a target="_blank" rel="noopener" href="https://iacr.org/archive/crypto2003/27290027/27290027.pdf">27290027.pdf (iacr.org)</a></p>
<p>题目完全符合其section 6的LSB泄露情况，记数据为：</p>
<script type="math/tex; mode=display">
d = d_1M + d_0</script><p>则可以写出模多项式：</p>
<script type="math/tex; mode=display">
f_{eM}(y,z) =  y(N-z) - ed_0 + 1 \quad(mod\;eM)</script><p>此时多项式有小根：</p>
<script type="math/tex; mode=display">
(y_0,z_0) = (k,p+q-1)</script><p>并分别选择如下y-shift和z-shift多项式来构造格：</p>
<script type="math/tex; mode=display">
g_{i,j} = y^j(eM)^if_{eM}^{m-i} \quad i=0,1,\cdots ,m;j = 0,1,\cdots ,i</script><script type="math/tex; mode=display">
h_{i,j} = z^j(eM)^if_{eM}^{m-i} \quad i=0,1,\cdots ,m;j = 1,2,\cdots ,t</script><p>选取参数：</p>
<script type="math/tex; mode=display">
m = 7 , t = 2</script><p>经测试可以在2min内可以求解泄露910bit的情况，而由于题目仅泄露910bit，因此考虑爆破10bit，结合多进程缩短求解时间，最终开八进程耗时约为2h。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> check_output</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flatter</span>(<span class="params">M</span>):</span><br><span class="line">    <span class="comment"># compile https://github.com/keeganryan/flatter and put it in $PATH</span></span><br><span class="line">    z = <span class="string">&quot;[[&quot;</span> + <span class="string">&quot;]\n[&quot;</span>.join(<span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, row)) <span class="keyword">for</span> row <span class="keyword">in</span> M) + <span class="string">&quot;]]&quot;</span></span><br><span class="line">    ret = check_output([<span class="string">&quot;flatter&quot;</span>], <span class="built_in">input</span>=z.encode())</span><br><span class="line">    <span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line">    <span class="keyword">return</span> matrix(M.nrows(), M.ncols(), <span class="built_in">map</span>(<span class="built_in">int</span>, findall(<span class="string">b&quot;-?\\d+&quot;</span>, ret)))</span><br><span class="line"></span><br><span class="line">ebits = <span class="number">512</span></span><br><span class="line">n=<span class="number">0xf12eac2099c4190a6f586bea0b4fc3f9dff4f23f0cb8e42cbeff950aa1df8a373c49df7974fb33b4b6619eadb2d6c01f80da1b433295b199df11b323114c439884eb31fa568bd747ae37079e885e2490c3b5a56d61b9d10533983ff78fe85e07876fe2ae07ae7ea1c71f0f9c2d6beccdcd8baf046a58549aec19d45d48d7d92d</span></span><br><span class="line">e=<span class="number">0xb8906f5097658f27cc448d98974d9e7ccd4e8a8f25a80007826c341dcb2ac42420f899e5a89045fbefd9163bc94e6f98b4953546203be4bec249031587a27dbf</span></span><br><span class="line">c=<span class="number">0x162a6dee8bcbe24698b9249137c2a157890910fa74a56e7d2792b5b4f29112aba03448995ff32ed24bec5118f7433212196d3f99e1c794b61395d8183e4658c9dc05953a87c069c9390773c7f885907840ebd29676afac7bf3374d54c81c4e404f09716b9885d243c41dc48db561f8291b88826cae32bfd575a472e523f455c4</span></span><br><span class="line">dl=<span class="number">0x4cbec287edc86c5b2a9e1975d64d2a24d3930075f0d445163c7b1ceec9ee0319fe1166af348b49004d2420b83bcb82d4879e93dba01ee76c5ca1b7141490465e824bdb5e91d04016c6bbbaa41c4470747ee8163f710b2d8adb8ab2168dcc996b5ab5f85a2269dc459379fb68848cec487</span></span><br><span class="line">leak = <span class="number">910</span></span><br><span class="line">M = <span class="number">2</span>^leak</span><br><span class="line">alpha = ebits/<span class="number">1024</span></span><br><span class="line">Y = <span class="built_in">int</span>(n^alpha)</span><br><span class="line">Z = <span class="built_in">int</span>(<span class="number">3</span>*n^<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#attack</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">iii</span>):</span><br><span class="line">	t1 = time.time()</span><br><span class="line">	d0 = dl + <span class="number">2</span>^<span class="number">900</span>*iii</span><br><span class="line"></span><br><span class="line">	m = <span class="number">7</span></span><br><span class="line">	t = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	poly = []</span><br><span class="line">	monomials=<span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">	PR.&lt;y,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">	y,z = PR.gens()</span><br><span class="line">	f = y*(n-z) - e*d0 + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,m+<span class="number">1</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,i+<span class="number">1</span>):</span><br><span class="line">			g = y^j * (e*M)^i * f^(m-i)</span><br><span class="line">			poly.append(g)</span><br><span class="line">			<span class="keyword">for</span> mono <span class="keyword">in</span> g.monomials():</span><br><span class="line">				monomials.add(mono)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,m+<span class="number">1</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,t+<span class="number">1</span>):</span><br><span class="line">			h = z^j * (e*M)^i * f^(m-i)</span><br><span class="line">			poly.append(h)</span><br><span class="line">			<span class="keyword">for</span> mono <span class="keyword">in</span> h.monomials():</span><br><span class="line">				monomials.add(mono)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	L = Matrix(ZZ,<span class="built_in">len</span>(poly),<span class="built_in">len</span>(monomials))</span><br><span class="line"></span><br><span class="line">	monomials = <span class="built_in">sorted</span>(monomials)</span><br><span class="line">	<span class="keyword">for</span> row,shift <span class="keyword">in</span> <span class="built_in">enumerate</span>(poly):</span><br><span class="line">		<span class="keyword">for</span> col,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">			L[row,col] = shift.monomial_coefficient(monomial)*monomial(Y,Z)</span><br><span class="line"></span><br><span class="line">	<span class="comment">#print(L.dimensions())</span></span><br><span class="line"></span><br><span class="line">	res = flatter(L)</span><br><span class="line">	vec1 = res[<span class="number">0</span>]</span><br><span class="line">	vec2 = res[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">	f1 = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> idx,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">			f1 += (vec1[idx] // monomial(Y,Z)) * monomial</span><br><span class="line">	f1 = f1.change_ring(ZZ)</span><br><span class="line">	f2 = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> idx,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">			f2 += (vec2[idx] // monomial(Y,Z)) * monomial</span><br><span class="line">	f2 = f2.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">	h = f1.sylvester_matrix(f2, y).det()</span><br><span class="line">	res1 = h.univariate_polynomial().monic().roots()</span><br><span class="line">	t2 = time.time()</span><br><span class="line">	<span class="built_in">print</span>(t2-t1)</span><br><span class="line">	<span class="keyword">if</span>(res1 != []):</span><br><span class="line">		<span class="built_in">print</span>(res1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ilist = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">10</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> Pool(<span class="number">8</span>) <span class="keyword">as</span> pool:</span><br><span class="line">    r = <span class="built_in">list</span>(pool.imap(attack, ilist[::-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#p+q-1 is:</span></span><br><span class="line"><span class="comment">#26034831836893224902673168159369440840844528954669232434446445029015830075273876167180768873144179504296085932127304140645470361784554913695920045941531153</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="9"><a href="#9" class="headerlink" title="9"></a>9</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e9=<span class="number">65537</span></span><br><span class="line">N9=<span class="number">0xcc5b706f373a79c680cec9527aac573fd435129cf16c23334085bf97832e5a6c78b633c2f244b12a62f87ec5295dd89fcf3c808c39e45a9afdbda2f8d2d0b50d61b685c0fe9eb41a7018a40f98892f96d738e2a4e740d4e507bcbd07f68c1ecb2ca10bd780ce65265a7e4da00f1031a5db9d038878a29a5ffefcaf2119720005</span>;</span><br><span class="line">c9=<span class="number">0x20bac8a7d73a74c9913377846c13c3d2bd9f47e6df118d1486a96ed184ca9910e0f250500065cfb44105a41dff655364cabc3067ef3cd3d7d983e75c9303b786ac97507cfe803b788b12e582232028ca9772d05004aef194076ec442e3ee55e17fbb4a57f332b4393ac056c024141cc2b82f9dbc6d3c77f6eff20cd0ecc9cbab</span>;</span><br></pre></td></tr></table></figure>
<p>第九题主要有以下几个信息：</p>
<ul>
<li>e=65537</li>
<li>d的低530位已知，剩余高位未知</li>
</ul>
<p>题目基于私钥d的LSB泄露，相比于第八题，将LSB的泄露位数减少到530位，但同时将加密指数e减少到了65537。不妨将d记为：</p>
<script type="math/tex; mode=display">
d = 2^{530}d_1 + d_2</script><p>由于公钥较小，此类情况与参考文献二的section 4.2.9完全符合。对于下式：</p>
<script type="math/tex; mode=display">
ed = 1 + k\phi(n)</script><p>由于$d &lt; \phi(n)$，因此一定有$k &lt; e$，而由于e仅有65537，所以k可以在(0,e)这个小范围内进行爆破，而对于正确的k，下面式子成立：</p>
<script type="math/tex; mode=display">
e(2^{530}d_1 + d_2) = 1 + k(n+1-p-q)</script><p>上式自然在模2^530下也成立，也就有：</p>
<script type="math/tex; mode=display">
ed_2 = 1 + k(n+1-p-q) \quad(mod\;2^{530})</script><p>上式有两个变量p、q，利用n=pq这一点进行单元化，则可以化成模2^530下的单元方程：</p>
<script type="math/tex; mode=display">
ped_2 = p + k(pn+p-p^2-n) \quad(mod\;2^{530})</script><p>整理一下就得到：</p>
<script type="math/tex; mode=display">
kp^2 + (ed_2 - kn - 1 - k)p +kn = 0 \quad(mod\;2^{530})</script><p>于是在模2^530下求解上述方程，得到的解即为可能的p低530位，而p、q本身只是512bit的素数，所以并不需要再用copper逐一求解p低位泄露，直接检查是否被n整除即可获得n的分解。sage10.2期望耗时约为半小时左右。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">0xcc5b706f373a79c680cec9527aac573fd435129cf16c23334085bf97832e5a6c78b633c2f244b12a62f87ec5295dd89fcf3c808c39e45a9afdbda2f8d2d0b50d61b685c0fe9eb41a7018a40f98892f96d738e2a4e740d4e507bcbd07f68c1ecb2ca10bd780ce65265a7e4da00f1031a5db9d038878a29a5ffefcaf2119720005</span></span><br><span class="line">c = <span class="number">0x20bac8a7d73a74c9913377846c13c3d2bd9f47e6df118d1486a96ed184ca9910e0f250500065cfb44105a41dff655364cabc3067ef3cd3d7d983e75c9303b786ac97507cfe803b788b12e582232028ca9772d05004aef194076ec442e3ee55e17fbb4a57f332b4393ac056c024141cc2b82f9dbc6d3c77f6eff20cd0ecc9cbab</span></span><br><span class="line">dl = <span class="number">0x20142ae2802b877eb4dfa8a462e7d017c4d348181c367fd1a661ec9b6bbcca9dcb6601ccb6c10416b7f3c20129527346bbc136ee60f9945125cba03a9bba3720f7411</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">k</span>):</span><br><span class="line">    p = var(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">    p0 = solve_mod([-k*p^<span class="number">2</span> + (k*(n+<span class="number">1</span>)+<span class="number">1</span>-e*dl)*p -k*n  == <span class="number">0</span>], <span class="number">2</span>^<span class="number">530</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(p0) != <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> p0:</span><br><span class="line">            <span class="keyword">if</span>(n % <span class="built_in">int</span>(j[<span class="number">0</span>]) == <span class="number">0</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Found p:&quot;</span> , <span class="built_in">int</span>(j[<span class="number">0</span>]))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> trange(<span class="number">1</span>,e):</span><br><span class="line">        find = attack(k)</span><br><span class="line">        <span class="keyword">if</span>(find):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">k = <span class="number">22348</span></span><br><span class="line">p = <span class="number">10846327614507406655792564994667714933899253952298425269758486277699020260863878841336945944423557227322075142932155647161674834513419649086027797728283207</span></span><br><span class="line">q = n // p</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,phi)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;d =&quot;</span>,d)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q =&quot;</span>,q)</span><br><span class="line"><span class="keyword">assert</span> p*q == n</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n)))[::-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#Resolving the composite numbers into their prime factors is known to be one of the most important and useful in arithmetic.</span></span><br></pre></td></tr></table></figure>
<p>可能是因为sage解模2^530下方程的速度并不快，所以这个方法效率真的很低，赛中听<a target="_blank" rel="noopener" href="https://d33b4t0.com/">@deebato</a>讲了一个明显更优的方式是：</p>
<ul>
<li>爆破k，由$ed \approx kn$去解d高位</li>
<li>和d低位拼起来解c得到明文</li>
</ul>
<p>这样就只需要几秒就行了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> powmod</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">0xcc5b706f373a79c680cec9527aac573fd435129cf16c23334085bf97832e5a6c78b633c2f244b12a62f87ec5295dd89fcf3c808c39e45a9afdbda2f8d2d0b50d61b685c0fe9eb41a7018a40f98892f96d738e2a4e740d4e507bcbd07f68c1ecb2ca10bd780ce65265a7e4da00f1031a5db9d038878a29a5ffefcaf2119720005</span></span><br><span class="line">c = <span class="number">0x20bac8a7d73a74c9913377846c13c3d2bd9f47e6df118d1486a96ed184ca9910e0f250500065cfb44105a41dff655364cabc3067ef3cd3d7d983e75c9303b786ac97507cfe803b788b12e582232028ca9772d05004aef194076ec442e3ee55e17fbb4a57f332b4393ac056c024141cc2b82f9dbc6d3c77f6eff20cd0ecc9cbab</span></span><br><span class="line">dl = <span class="number">0x20142ae2802b877eb4dfa8a462e7d017c4d348181c367fd1a661ec9b6bbcca9dcb6601ccb6c10416b7f3c20129527346bbc136ee60f9945125cba03a9bba3720f7411</span></span><br><span class="line">d = <span class="number">48934776628725324382665082114299447937340082241799544768710753959849031360081579743041602050591310715229818997116081242616359194543184338502069650397869985126397078720094810145259742806152398430221459833419493737528368084683621557302194467494851616524101832395135547354509904758069472861546701396840400516113</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,e):</span><br><span class="line">    dh = k*n // e</span><br><span class="line">    d = (dh &gt;&gt; <span class="number">530</span> &lt;&lt; <span class="number">530</span>) + dl</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(powmod(c,d,n)).decode()[::-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Resolving the composite numbers into their prime factors is known to be one of the most important and useful in arithmetic.</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="10"><a href="#10" class="headerlink" title="10"></a>10</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e10=<span class="number">65537</span></span><br><span class="line">N10=<span class="number">0x8d0df1ce526c39f9b057de462778a61ceda2049c7e32ee99d40baa4b22b7fd438e9ca1dfd7467684625add252095ee97c698199f4c5991279f6d3e74d4c14d01d137d42722df0d4565ff2a5275f9cac66dc4dfdf3304f85cbdc3d18eda1e32ac5d03675141a722ceefe0ea0533b53d7e50ed7eda1a1bbce47ed0ecb966f8678d</span></span><br><span class="line">c10=<span class="number">0x3b42fa3dc9089a21e9dabfe18297df47272f7e0ff59bf9bf16bc55e7fa70504c03fed56ca5ae93ac028f60ce5da3c145c6d181c5bd3c267288ec4765a19ca6b957b4535a1a185bd1b87d2e39b30e2430ed648175c29fdc1fde3787c426783dd66ba17f98b42ba13a7b3532970d0aa31b5ffa5f3eae243337a1668bae456bfbfb</span></span><br><span class="line">a=<span class="number">0x19ffe8024fcf0320b3107f380f2e7deff71d561c4266c0f439d1aca20cd43d2aa6aed8679a16b2e1d3ff4ba3fc4da69cf34e35ead6f7eb79923960b9c83d9923e591b07b65275bf67f0b3d424cd7e6e6dd88ea39a5cfa27ecee61caaacc93e751dbb2a4c196f0ce0c36d44c35d6658d71b6c48b7b29400ab9161a0000000000</span></span><br><span class="line">b=<span class="number">0x19ffe8024fcf0320b3107f380f2e7deff71d561c4266c0f439d1aca20cd43d2aa6aed8679a16b2e1d3ff4ba3fc4da69cf34e35ead6f7eb79923960b9c83d9923e591b07b65275bf67f0b3d424cd7e6e6dd88ea39a5cfa27ecee61caaacc93e751dbb2a4c196f0ce0c36d44c35d6658d71b6c48b7b29400ab9161affffffffff</span></span><br></pre></td></tr></table></figure>
<p>信息：</p>
<ul>
<li>e=65537</li>
<li>d的取值范围在已知的a到b的闭区间内，范围大小约为2^40</li>
</ul>
<p>题目等价于d的低40位未知，记这低40bit为dl，那么d可以写作：</p>
<script type="math/tex; mode=display">
d = 2^{40}d_h + d_l</script><p>又因为模n下有：</p>
<script type="math/tex; mode=display">
2^{ed} = 1 \quad(mod\;n)</script><p>代入就得到：</p>
<script type="math/tex; mode=display">
2^{e(2^{40}d_h + d_l)} = 1 \quad(mod\;n)</script><p>考虑mitm，不妨把低40位再拆做两半d1和d2，就得到：</p>
<script type="math/tex; mode=display">
2^{e(2^{40}d_h + 2^{20}d_1 + d_2)} = 1 \quad(mod\;n)</script><p>分别移到等式两侧：</p>
<script type="math/tex; mode=display">
2^{e(2^{40}d_h + 2^{20}d_1)} = 2^{-ed_2} \quad(mod\;n)</script><p>之后mitm就好了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">0x8d0df1ce526c39f9b057de462778a61ceda2049c7e32ee99d40baa4b22b7fd438e9ca1dfd7467684625add252095ee97c698199f4c5991279f6d3e74d4c14d01d137d42722df0d4565ff2a5275f9cac66dc4dfdf3304f85cbdc3d18eda1e32ac5d03675141a722ceefe0ea0533b53d7e50ed7eda1a1bbce47ed0ecb966f8678d</span></span><br><span class="line">c = <span class="number">0x3b42fa3dc9089a21e9dabfe18297df47272f7e0ff59bf9bf16bc55e7fa70504c03fed56ca5ae93ac028f60ce5da3c145c6d181c5bd3c267288ec4765a19ca6b957b4535a1a185bd1b87d2e39b30e2430ed648175c29fdc1fde3787c426783dd66ba17f98b42ba13a7b3532970d0aa31b5ffa5f3eae243337a1668bae456bfbfb</span></span><br><span class="line">dl = <span class="number">0x19ffe8024fcf0320b3107f380f2e7deff71d561c4266c0f439d1aca20cd43d2aa6aed8679a16b2e1d3ff4ba3fc4da69cf34e35ead6f7eb79923960b9c83d9923e591b07b65275bf67f0b3d424cd7e6e6dd88ea39a5cfa27ecee61caaacc93e751dbb2a4c196f0ce0c36d44c35d6658d71b6c48b7b29400ab9161a0000000000</span></span><br><span class="line">dh = <span class="number">0x19ffe8024fcf0320b3107f380f2e7deff71d561c4266c0f439d1aca20cd43d2aa6aed8679a16b2e1d3ff4ba3fc4da69cf34e35ead6f7eb79923960b9c83d9923e591b07b65275bf67f0b3d424cd7e6e6dd88ea39a5cfa27ecee61caaacc93e751dbb2a4c196f0ce0c36d44c35d6658d71b6c48b7b29400ab9161affffffffff</span></span><br><span class="line"></span><br><span class="line">k = powmod(<span class="number">2</span>,e,n)</span><br><span class="line">k20 = powmod(k,<span class="number">2</span>**<span class="number">20</span>,n)</span><br><span class="line">tmp = <span class="number">1</span></span><br><span class="line">l = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">1</span>,<span class="number">2</span>**<span class="number">20</span>):</span><br><span class="line">    tmp = tmp * k20 % n</span><br><span class="line">    l[tmp] = i</span><br><span class="line"></span><br><span class="line">ki = invert(<span class="built_in">int</span>(k),n)</span><br><span class="line">tmp = <span class="number">2</span>*powmod(ki,dl,n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">2</span>**<span class="number">20</span>):</span><br><span class="line">    tmp = tmp * ki % n</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> tmp <span class="keyword">in</span> l.keys():</span><br><span class="line">        <span class="built_in">print</span>(i,l[tmp])</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="11"><a href="#11" class="headerlink" title="11"></a>11</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e11=<span class="number">65537</span></span><br><span class="line">N11=<span class="number">0xcb5645c59c402b0edcf96cbd6a7308b64aac2f37a3c6f96be7c421c4b7f0a4adbdecd88cbea1128352fb21baae583fe4ceb3fc93c4905803ad3e9214ada050d5c0ff785a13a5c9157c3154ad8d7015a2d239fe13ef836d3279c5cd5dc96013ac40f372a9c9226d2f5fe73f312c56e11d9cdfbf9fb0db627ac1a752f5f0bd2b29</span></span><br><span class="line">c11=<span class="number">0x84e4aa0be481e9c4bbd4c71dba5235cccd8312759de35c326c7e4cdda494196d1c0cae298240942af3082fac215965999c908a79bf07e093ee0c402e727a09a1c1f13831875d66ebbc3f89507163de90339af055bcd7d778574775214accfbd8ae20001f27bc196b974cb3ac215fea3debb7b17a21a8ebb1a9880a671539ef21</span></span><br><span class="line">a=<span class="number">0x4f77b72b04e6fb2d02e5a43edef4784a2e22df0d42bfc7c9093a58ec35eb21a11962103be960b0088d0cc2e0dfb473bc2ba0a22cea1c73997442c8fab5e4bad22cd131055b0382eb9264ad40ec8257abaff11b33b173ffd0168039bf40dc203eb325d884d2845fd2b5a37f41a0f64183db0c256c244500000000000000000000</span></span><br><span class="line">b=<span class="number">0x4f77b72b04e6fb2d02e5a43edef4784a2e22df0d42bfc7c9093a58ec35eb21a11962103be960b0088d0cc2e0dfb473bc2ba0a22cea1c73997442c8fab5e4bad22cd131055b0382eb9264ad40ec8257abaff11b33b173ffd0168039bf40dc203eb325d884d2845fd2b5a37f41a0f64183db0c256c2445ffffffffffffffffffff</span></span><br></pre></td></tr></table></figure>
<p>信息：</p>
<ul>
<li>e=65537</li>
<li>d的取值范围在已知的a到b的闭区间内，范围大小约为2^80</li>
</ul>
<p>相较于第十题，本题将私钥d的未知低位提升到了80位，如果继续采用mitm的思路，则时间复杂度和建立字典的空间复杂度都过大了，因此需要转换思路。首先将d写为：</p>
<script type="math/tex; mode=display">
d = a + d_l</script><p>所以有：</p>
<script type="math/tex; mode=display">
e(a + d_l) = 1 + k(n+1-p-q)</script><p>由于d大部分高位已知，所以可以直接做整除得到k：</p>
<script type="math/tex; mode=display">
k = \frac{ae}{n} + 1</script><p>在有了k的准确值之后，上述式子可以看作一个模ea下的模多项式：</p>
<script type="math/tex; mode=display">
f = 1 + k(n-y) - ex \quad(mod\;ea)</script><p>此时其含有小根：</p>
<script type="math/tex; mode=display">
(x_0,y_0) = (d_l,p+q-1)</script><p>将这个式子与赛题四的式子进行对比，可以发现两者区别为：</p>
<ul>
<li>本题已知k</li>
<li>本题模多项式的模数更大</li>
<li>本题d的LSB对应的小根更小</li>
</ul>
<p>因此理论上来说赛题4的copper构造完全能够求解本题的情况，然而实际测试发现copper虽然能求出来根，但其根的值并不是我们需要的$(d_l,p+q-1)$，而是一个x0仅有十几bit的更小的根。</p>
<p>思考发现，这是因为如下形式的根均是上述方程的根：</p>
<script type="math/tex; mode=display">
(x_0,y_0) = (d_l - tk,p+q-1 + t) \quad ,\; t \in Z</script><p>这本质上是在说这个方程的根可以写作如下线性组合的形式：</p>
<script type="math/tex; mode=display">
(x_0,y_0) = (d_l,p+q-1) + t(-k,1) \quad, \; t \in Z</script><p>因此copper得到的是一个相对于我们期望的$(d_l,p+q-1)$来说更小的一个根，因此得到的十几bit的小量其实是dl减去t倍的k后得到的值，对应的，得到的y0就是p+q-1+t的值。</p>
<p>而由于t显然不超过80bit，因此我们得到的小根中的y0与真实的p+q的误差也不会超过80bit，这就可以转化为已知p+q的高位分解n的问题。具体来说，记有误差的p+q为leak，则可以在实数域上求解下面的方程得到p的高位：</p>
<script type="math/tex; mode=display">
f = x(leak-x) - n</script><p>此时得到的p的高位与p的真实值的误差也在80bit左右，因此可以直接copper求解p高位泄露问题得到n的分解。此种方式自然也能解决赛题10的情形。并且耗时极短。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line"></span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    </span><br><span class="line">    k = ZZ(f.coefficients().pop(<span class="number">0</span>))</span><br><span class="line">    g = gcd(k, N)</span><br><span class="line">    k = R(k/g)</span><br><span class="line"></span><br><span class="line">    f *= <span class="number">1</span>/k</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vars</span> = f.variables()</span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m-k+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> subvars <span class="keyword">in</span> itertools.combinations_with_replacement(<span class="built_in">vars</span>[<span class="number">1</span>:], i):</span><br><span class="line">                g = f**k * prod(subvars) * N**(<span class="built_in">max</span>(d-k, <span class="number">0</span>))</span><br><span class="line">                G.append(g)</span><br><span class="line"></span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, Integer(<span class="number">1</span>)/factor)</span><br><span class="line"></span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B*monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">0xcb5645c59c402b0edcf96cbd6a7308b64aac2f37a3c6f96be7c421c4b7f0a4adbdecd88cbea1128352fb21baae583fe4ceb3fc93c4905803ad3e9214ada050d5c0ff785a13a5c9157c3154ad8d7015a2d239fe13ef836d3279c5cd5dc96013ac40f372a9c9226d2f5fe73f312c56e11d9cdfbf9fb0db627ac1a752f5f0bd2b29</span></span><br><span class="line">c = <span class="number">0x84e4aa0be481e9c4bbd4c71dba5235cccd8312759de35c326c7e4cdda494196d1c0cae298240942af3082fac215965999c908a79bf07e093ee0c402e727a09a1c1f13831875d66ebbc3f89507163de90339af055bcd7d778574775214accfbd8ae20001f27bc196b974cb3ac215fea3debb7b17a21a8ebb1a9880a671539ef21</span></span><br><span class="line">a = <span class="number">0x4f77b72b04e6fb2d02e5a43edef4784a2e22df0d42bfc7c9093a58ec35eb21a11962103be960b0088d0cc2e0dfb473bc2ba0a22cea1c73997442c8fab5e4bad22cd131055b0382eb9264ad40ec8257abaff11b33b173ffd0168039bf40dc203eb325d884d2845fd2b5a37f41a0f64183db0c256c244500000000000000000000</span></span><br><span class="line">k = a*e//n+<span class="number">1</span></span><br><span class="line">hbits = <span class="number">80</span></span><br><span class="line"></span><br><span class="line">PR.&lt;x,y&gt; = PolynomialRing(Zmod(e*a))</span><br><span class="line">f = <span class="number">1</span> + k*(n-y) - e*x</span><br><span class="line">bounds = (<span class="number">2</span>^hbits,<span class="number">2</span>^<span class="number">513</span>)</span><br><span class="line"></span><br><span class="line">res = small_roots(f,bounds,m=<span class="number">2</span>,d=<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">#res[0][2] is an approximate of p+q-1</span></span><br><span class="line"><span class="comment">#[(2540, 23935042650629633992243477175701638513817665297585812420605495051321315935163840064093820856826734951317982015362656048928090686340260908156176320805788498)]</span></span><br></pre></td></tr></table></figure>
<p>同时，通过分析此种方法，可以知道这个方式可以拓展到私钥d未知LSB位数更多的情况，其理论求解上界就是p高位未知的求解上界，也就是p比特位数的一半。经测试，对于题目情况，理论上可以求解d低256bit未知的情况，下附测试脚本，其在d低235bit未知情况下依然快速且准确：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line"></span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    </span><br><span class="line">    k = ZZ(f.coefficients().pop(<span class="number">0</span>))</span><br><span class="line">    g = gcd(k, N)</span><br><span class="line">    k = R(k/g)</span><br><span class="line"></span><br><span class="line">    f *= <span class="number">1</span>/k</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vars</span> = f.variables()</span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m-k+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> subvars <span class="keyword">in</span> itertools.combinations_with_replacement(<span class="built_in">vars</span>[<span class="number">1</span>:], i):</span><br><span class="line">                g = f**k * prod(subvars) * N**(<span class="built_in">max</span>(d-k, <span class="number">0</span>))</span><br><span class="line">                G.append(g)</span><br><span class="line"></span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, Integer(<span class="number">1</span>)/factor)</span><br><span class="line"></span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B*monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,phi)</span><br><span class="line">k = (e*d-<span class="number">1</span>)//phi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hbits = <span class="number">235</span></span><br><span class="line">a = d &gt;&gt; hbits &lt;&lt; hbits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PR.&lt;x,y&gt; = PolynomialRing(Zmod(e*a))</span><br><span class="line">f = <span class="number">1</span> + k*((n+<span class="number">1</span>)-y) - e*x</span><br><span class="line">bounds = (<span class="number">2</span>^hbits,<span class="number">2</span>^<span class="number">513</span>)</span><br><span class="line"></span><br><span class="line">res = small_roots(f,bounds,m=<span class="number">2</span>,d=<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line">leak = <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 get leak2</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(RealField(<span class="number">1000</span>))</span><br><span class="line">f = x*(leak-x) - n </span><br><span class="line">ph = <span class="built_in">int</span>(f.roots()[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = ph + x</span><br><span class="line">res = f.small_roots(X=<span class="number">2</span>^(hbits+<span class="number">6</span>), beta=<span class="number">0.499</span>,epsilon=<span class="number">0.02</span>)[<span class="number">0</span>]</span><br><span class="line">p = <span class="built_in">int</span>(ph + res)</span><br><span class="line">q = n // p</span><br><span class="line">d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;d =&quot;</span>,d)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q =&quot;</span>,q)</span><br><span class="line"><span class="keyword">assert</span> p*q == n</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="12"><a href="#12" class="headerlink" title="12"></a>12</h3><p>题目数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e12=<span class="number">65537</span></span><br><span class="line">N12=<span class="number">0x9fac422a93f6e486e3ddae088bb5f5d06dec183ab81290042a9c98c53352961a00db3e9def7adff842381a395cedf1d06294f0b63457133e4e44cabb7633c562dcbfffdffe541d66c46ddf6a28b686c478300bcf31945f2a6495f140e64f78fa5cd47d1885233f175f28e38f1bfc422a6853ca19a7dd47a291a9e7de78a67bf1</span></span><br><span class="line">c12=<span class="number">0x35476c9d0e5ad9d364ea31d8f6628b92a4f6307b1fef754e49286bc7f53ea8cd013a7ebf2a21b2327af44498d267e19526c2051a02f22cca9cab567f7ceefe5003137e396c23742370e14ec2c6a90943ca848908e87420f560d34eae4635475effa867722276710c6f4b6cb9b295777d62f3f03c57603ac815072864aadbf041</span></span><br><span class="line">N=<span class="number">0x8199f8d487909988daf7d692ce8b1ffb4c37aa8010c8ca337ae4398c521383dc51007645cb6a1743c9b52ec5808e9e0e6f54d5fbb143cf81651240beab342dfb4622f073c4f8ab968dd5c8d4be3b7dd55c2cb9ef9c06294cd87e5fa29e38279c850f03687dc8c83c68104dca88e3a5c8559a01c040e7d5107e4a9f2385429f90</span></span><br></pre></td></tr></table></figure>
<p>信息：</p>
<ul>
<li>e=65537</li>
<li>额外给出一个值N，N=kq+r，其中k的取值范围是$(2^{511},2^{512})$ ，r取值范围是$(2^{255},2^{256})$ </li>
</ul>
<p>显然是一个ACD(近似公约数)问题，然而由于只有这两个数据，所以直接造常见的格难以规约出目标向量，因此查找到文献：</p>
<p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2016/215.pdf">ACD.dvi (iacr.org)</a></p>
<p>参照论文section5(Multivariate polynomial approach)的方式，记数据为：</p>
<script type="math/tex; mode=display">
N = pq_0 \;,\; a_1 = pq_1 + r_1</script><p>可构造如下多个均以r1为根的模多项式去构造格：</p>
<script type="math/tex; mode=display">
Q(x_1) = (x_1-a_1)^{i_1}N^l \quad(mod\;p^k)</script><p>其中，r1的bounds为$R = 2^{256}$，并且索引i1满足：</p>
<script type="math/tex; mode=display">
i_1 + l \geq k \;,\; i_1 \leq t</script><p>经测试，选取参数$t=20,k=10$，利用上述多项式去构造格，能够规约出的小根上界约为243bit，因此最终选择64进程爆破13bit并结合copper解决，耗时约3min。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="comment">################################################ gen data</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">N = <span class="number">0x9fac422a93f6e486e3ddae088bb5f5d06dec183ab81290042a9c98c53352961a00db3e9def7adff842381a395cedf1d06294f0b63457133e4e44cabb7633c562dcbfffdffe541d66c46ddf6a28b686c478300bcf31945f2a6495f140e64f78fa5cd47d1885233f175f28e38f1bfc422a6853ca19a7dd47a291a9e7de78a67bf1</span></span><br><span class="line">c = <span class="number">0x35476c9d0e5ad9d364ea31d8f6628b92a4f6307b1fef754e49286bc7f53ea8cd013a7ebf2a21b2327af44498d267e19526c2051a02f22cca9cab567f7ceefe5003137e396c23742370e14ec2c6a90943ca848908e87420f560d34eae4635475effa867722276710c6f4b6cb9b295777d62f3f03c57603ac815072864aadbf041</span></span><br><span class="line">m = <span class="number">1</span></span><br><span class="line">rho = <span class="number">243</span></span><br><span class="line">a = [<span class="string">&quot;pad&quot;</span>] + [<span class="number">0x8199f8d487909988daf7d692ce8b1ffb4c37aa8010c8ca337ae4398c521383dc51007645cb6a1743c9b52ec5808e9e0e6f54d5fbb143cf81651240beab342dfb4622f073c4f8ab968dd5c8d4be3b7dd55c2cb9ef9c06294cd87e5fa29e38279c850f03687dc8c83c68104dca88e3a5c8559a01c040e7d5107e4a9f2385429f90</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">ii</span>):</span><br><span class="line">    a = [<span class="string">&quot;pad&quot;</span>] + [<span class="number">0x8199f8d487909988daf7d692ce8b1ffb4c37aa8010c8ca337ae4398c521383dc51007645cb6a1743c9b52ec5808e9e0e6f54d5fbb143cf81651240beab342dfb4622f073c4f8ab968dd5c8d4be3b7dd55c2cb9ef9c06294cd87e5fa29e38279c850f03687dc8c83c68104dca88e3a5c8559a01c040e7d5107e4a9f2385429f90</span> - <span class="number">2</span>^<span class="number">243</span>*ii]</span><br><span class="line"></span><br><span class="line">    <span class="comment">################################################ params</span></span><br><span class="line">    t,k = <span class="number">20</span>,<span class="number">10</span></span><br><span class="line">    R = <span class="number">2</span>^rho</span><br><span class="line">    indices = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t+<span class="number">1</span>)] , repeat=m):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sum</span>(<span class="built_in">list</span>(i)) &lt;= t):</span><br><span class="line">            indices.append([<span class="string">&quot;pad&quot;</span>] + <span class="built_in">list</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">################################################ attack</span></span><br><span class="line">    PR = ZZ[<span class="built_in">tuple</span>(<span class="string">f&quot;X<span class="subst">&#123;i&#125;</span>&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m))]</span><br><span class="line">    X = [<span class="string">&quot;pad&quot;</span>] + <span class="built_in">list</span>(PR.gens())</span><br><span class="line">    poly = []</span><br><span class="line">    monomials=<span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> indices:</span><br><span class="line">        f = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> ij <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(i)):</span><br><span class="line">            f *= (X[ij] - a[ij])^i[ij]</span><br><span class="line">        l = <span class="built_in">max</span>(k-<span class="built_in">sum</span>(i[<span class="number">1</span>:]),<span class="number">0</span>)</span><br><span class="line">        f *= N^l</span><br><span class="line">        poly.append(f)</span><br><span class="line">        <span class="keyword">for</span> mono <span class="keyword">in</span> f.monomials():</span><br><span class="line">            monomials.add(mono)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">################################################# LLL and resultant to find roots</span></span><br><span class="line">    L = Matrix(ZZ,<span class="built_in">len</span>(poly),<span class="built_in">len</span>(monomials))</span><br><span class="line">    monomials = <span class="built_in">sorted</span>(monomials)</span><br><span class="line">    <span class="keyword">for</span> row,shift <span class="keyword">in</span> <span class="built_in">enumerate</span>(poly):</span><br><span class="line">        <span class="keyword">for</span> col,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">            L[row,col] = shift.monomial_coefficient(monomial)*monomial(*([R]*m))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    res = L.LLL()</span><br><span class="line">    vec1 = res[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    h = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> idx,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">        h += (vec1[idx] // monomial(*([R]*m))) * monomial</span><br><span class="line">    h = h.change_ring(ZZ)</span><br><span class="line">    res1 = h.monic().roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(res1 != []):</span><br><span class="line">        <span class="built_in">print</span>(ii,res1)</span><br><span class="line"></span><br><span class="line">lists = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">13</span>)]</span><br><span class="line"><span class="keyword">with</span> Pool(<span class="number">64</span>) <span class="keyword">as</span> pool:</span><br><span class="line">    r = <span class="built_in">list</span>(pool.imap(attack, lists[::-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#7827 [(2727306697565320519371211661141555049815806719986025448322625067833341383, 1)]</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="第二部分——随机数生成器分析"><a href="#第二部分——随机数生成器分析" class="headerlink" title="第二部分——随机数生成器分析"></a>第二部分——随机数生成器分析</h2><p>这个部分感觉意义不大，就看谁的脑洞更有道理了，最后知道是D.J. Bernstein的这篇论文中的周期性素数的变体：</p>
<p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2013/599.pdf">https://eprint.iacr.org/2013/599.pdf</a></p>
<p>不太想研究这个方法具体是怎么回事，这里就讲一下我们队的脑洞吧。</p>
<p>首先，由于素数p内部有很明显的周期结构，所以很容易就能区分出两个素因子中哪一个是RNG生成的p，哪一个是完全随机的q，得到的所有RNG生成的p的具体数据如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">p1 = <span class="number">11731831938699772462127271873430115361544445093018344205508116263256543526314353604701640010896040499228777875913175294497034647460453248703129442880389173</span></span><br><span class="line">p2 = <span class="number">11869583389521634999588895814931899209282833085315990491955438271004312624703796644214104875335462616923607689499528893181399330078966918201596985360139071</span></span><br><span class="line">p3 = <span class="number">13330845672573024992365639486752475385999567065045919858101721586084914271256015026405358632247506825358937845584228131670535560699881432539142260730819941</span></span><br><span class="line">p4 = <span class="number">13356226842357346737299091759568737514939276729394541933682607177699916097721417538518090968081806167054821348691588113727076061555620082009933657711769897</span></span><br><span class="line">p5 = <span class="number">11797427867662564146182859301962255785374906066890850699284196012236748859126205065537843301272358073955564140004170138426605342997392924076900907292525053</span></span><br><span class="line">p6 = <span class="number">11833356611593562341229096501593508761656941850083383088968539373645279952186053495258337344120872950675089393986589783361936057299170335249974124458348637</span></span><br><span class="line">p7 = <span class="number">13204460550157942878056813628171921855910516854422240597500159684956753622537766390184760454941785574216947386843201357603678055340797551538526069521464359</span></span><br><span class="line">p8 = <span class="number">13315973629394688741750834853401728156006855695593283379566321523012211881375220806451907810948637676359456552867934749729358048834207948267102347900846147</span></span><br><span class="line">p9 = <span class="number">13230698921743059551824416344443899403552566005548844066885308262194945624798691552085027494542401017580805838924364362875395655984648652258879913619766611</span></span><br><span class="line">p10 = <span class="number">11771189496077447472415256585690278237732856915764247194903035840506904720003320569381951682128930227151469309640903353145013377646752106391473373652877601</span></span><br><span class="line">p11 = <span class="number">12625904132876024391053747255529472882205295003498735138849760876178996107401873371263341157195294988792537890500933341025075865608380995322266553378244827</span></span><br><span class="line">p12 = <span class="number">13332483168606238737181696873100104751420317885066608062141583458038224144727215840015557177200814570451949655836044414422384438369627145548625958519764109</span></span><br></pre></td></tr></table></figure>
<p>把他们的二进制打印出来观察，可以发现以下几个显著特征：</p>
<ul>
<li>高三位都是111</li>
<li>中间位有明显周期结构，但是有部分比特翻转</li>
<li>最后一些比特比较杂乱</li>
</ul>
<p>那么接下来就逐个分析这些特点。</p>
<h3 id="1-周期结构"><a href="#1-周期结构" class="headerlink" title="1.周期结构"></a>1.周期结构</h3><p>观察所有数字的中间位，可以看出很明显的分成了三类：</p>
<ul>
<li>循环节全是0的，这一部分包含素数为p1</li>
<li>最小循环节长9的，这一部分包含素数有p2,p5,p7,p8,p9,p10</li>
<li>最小循环节长11的，这一部分包含素数有p3,p4,p6,p11,p12</li>
</ul>
<p>而”循环节“这个说法并不是说他们真的完全在以这个长度循环，而是一个能看出节长的最小单位，真正存在的周期其实是由多个循环节一起构成的，我们称为类周期，举两个例子如下：</p>
<p>长9的循环节的类周期：</p>
<p><img src="/post/4a67318c/image-20240826154329895.png" alt="image-20240826154329895"></p>
<p>长11的循环节的类周期：</p>
<p><img src="/post/4a67318c/image-20240826154345916.png" alt="image-20240826154345916"></p>
<p>对于以p2为例的节长为9的素数，将其第一个节称为a，第四个节称为b，很显然它呈现一个的规律：3a-4b-3a-4b-…</p>
<p>而对于以p3为代表的节长为11的素数，我们的实现思路是将第一个节的前7bit与后4bit拆分开来，令它们为t1和t2，将第一个节往左循环移位两位后的前7bit与后4bit拆分开来，令它们为t3和t4，此时所有的节都可以使用以下几个式子来进行表示，并且仍然是有周期性的：</p>
<script type="math/tex; mode=display">
t_1 + t_2, t_1 + t_4, t_3 + t_2, t_3 + t_4</script><blockquote>
<p>这里的加号是比特串的连接的意思</p>
</blockquote>
<p>记9和11的比特串构造式分别为C9和C11，就可以把两种类周期分别通过统一的表达式表示出来：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C9 = <span class="string">&#x27;111&#x27;</span> + <span class="number">8</span>(3a+4b) + <span class="string">&#x27;00000&#x27;</span></span><br><span class="line"></span><br><span class="line">C11 =  <span class="string">&#x27;111&#x27;</span></span><br><span class="line">     + <span class="number">2</span>[<span class="number">2</span>(t1+t2) + (t1+t4) + <span class="number">2</span>(t3+t4) + (t3+t2)]</span><br><span class="line">     + <span class="number">2</span>[<span class="number">2</span>(t1+t2) + <span class="number">3</span>(t3+t4) + (t1+t2)]</span><br><span class="line">     + <span class="number">3</span>[(t1+t2) + (t1+t4) + <span class="number">2</span>(t3+t4) + (t3+t2) + (t1+t2)]</span><br><span class="line">     +  [(t1+t2) + (t1+t4) + <span class="number">2</span>(t3+t4)]</span><br></pre></td></tr></table></figure>
<p>以此为类周期构造，就可以恢复素数p的雏形。</p>
<p><br></p>
<h3 id="2-比特翻转"><a href="#2-比特翻转" class="headerlink" title="2.比特翻转"></a>2.比特翻转</h3><p>刚刚的周期结构恢复的只是雏形，可以发现利用这个周期结构去构造素数的话，有很少量的比特是对不上的，这就是比特翻转。</p>
<p>而处理这个比特翻转的依据主要有以下两个：</p>
<ul>
<li>p1代表的素数完全没有比特翻转(虽然他在2^16的位置存在一个1，这个的用处马上讲)</li>
<li>剩余的一共有11组数据，而种子明确告诉我们是在0-2048，也就是11bit</li>
</ul>
<p>很容易确定的一个事实是：p1对应的种子肯定是0。而p1没有比特翻转，说明比特翻转很可能是关于种子11个bit位的线性关系式</p>
<p>而刚刚提出的第二点正好可以佐证整个想法的，由于剩余的刚刚好是11组数据，因此对于11bit的种子来说，恰好能够求出这个线性关系的唯一解。</p>
<p>此时还面临着两个问题：</p>
<ul>
<li>每个素数的哪些比特位才是这个线性关系作用的结果？</li>
<li>每个素数究竟对应哪个11bit的种子？</li>
</ul>
<p>对于第一个问题，由刚才的分析可以知道，高三位既然都是111，所以是不参与线性方程中的，因此线性关系的求解应该从第4位开始。</p>
<p>那么到哪里结束呢？p1在2^16的位置存在一个1，这就显然是一个重要提示了。由于p1种子为全0，所以参与线性方程的部分理应也是全0，那么这个1就是一个信号，这个1左边的部分才参与线性方程，而右边的部分只用于nextprime。所以参与线性方程的比特范围就确定下来了。</p>
<p>接下来是第二个问题——每个素数究竟对应什么种子，循环节长度为11的倒还好，关键是循环节长为9的，究竟是去除了哪两个bit，这很值得商榷。</p>
<p>然而有个很重要的信息是：既然两种循环节以不同的长度循环着，那么它们对应的种子一定有一个可以区分的特征，这才使得循环长度不同。那么既然我们拥有循环节长度为11的几个素数p3,p4,p6,p11,p12的种子，那么我们不妨观察一下他们种子比特串的共同特征：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11110100001</span></span><br><span class="line"><span class="number">11111000000</span></span><br><span class="line">00001111100</span><br><span class="line"><span class="number">10001000100</span></span><br><span class="line"><span class="number">11110100011</span></span><br></pre></td></tr></table></figure>
<p>可以看出一个相当明显的共同特征是：这些种子的2-4bit是三个完全相同的值，那么我们将长为9的循环节填至11的原则也就确定了：在2、3bit插入数据，让他们不符合这个特征即可。</p>
<p><br></p>
<h3 id="3-完整步骤"><a href="#3-完整步骤" class="headerlink" title="3.完整步骤"></a>3.完整步骤</h3><p>此时得到了全部的种子，也就可以解线性关系式了，最终生成素数的全步骤为：</p>
<ul>
<li>初始化一个512bit的全0串</li>
<li>最高三位填1</li>
<li>检查种子2-4bit，如果完全相同则保留整个种子，否则删去2bit</li>
<li>根据上一步处理得到的长度，分别应用长9和长11的构造式C9、C11得到素数雏形</li>
<li>在[4,-16]的比特范围应用线性关系，产生比特翻转应用于当前的素数雏形上，再将倒数第十六位比特翻转</li>
<li>取nextprime得到最终素数</li>
</ul>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p1 = <span class="number">11731831938699772462127271873430115361544445093018344205508116263256543526314353604701640010896040499228777875913175294497034647460453248703129442880389173</span></span><br><span class="line">p2 = <span class="number">11869583389521634999588895814931899209282833085315990491955438271004312624703796644214104875335462616923607689499528893181399330078966918201596985360139071</span></span><br><span class="line">p3 = <span class="number">13330845672573024992365639486752475385999567065045919858101721586084914271256015026405358632247506825358937845584228131670535560699881432539142260730819941</span></span><br><span class="line">p4 = <span class="number">13356226842357346737299091759568737514939276729394541933682607177699916097721417538518090968081806167054821348691588113727076061555620082009933657711769897</span></span><br><span class="line">p5 = <span class="number">11797427867662564146182859301962255785374906066890850699284196012236748859126205065537843301272358073955564140004170138426605342997392924076900907292525053</span></span><br><span class="line">p6 = <span class="number">11833356611593562341229096501593508761656941850083383088968539373645279952186053495258337344120872950675089393986589783361936057299170335249974124458348637</span></span><br><span class="line">p7 = <span class="number">13204460550157942878056813628171921855910516854422240597500159684956753622537766390184760454941785574216947386843201357603678055340797551538526069521464359</span></span><br><span class="line">p8 = <span class="number">13315973629394688741750834853401728156006855695593283379566321523012211881375220806451907810948637676359456552867934749729358048834207948267102347900846147</span></span><br><span class="line">p9 = <span class="number">13230698921743059551824416344443899403552566005548844066885308262194945624798691552085027494542401017580805838924364362875395655984648652258879913619766611</span></span><br><span class="line">p10 = <span class="number">11771189496077447472415256585690278237732856915764247194903035840506904720003320569381951682128930227151469309640903353145013377646752106391473373652877601</span></span><br><span class="line">p11 = <span class="number">12625904132876024391053747255529472882205295003498735138849760876178996107401873371263341157195294988792537890500933341025075865608380995322266553378244827</span></span><br><span class="line">p12 = <span class="number">13332483168606238737181696873100104751420317885066608062141583458038224144727215840015557177200814570451949655836044414422384438369627145548625958519764109</span></span><br><span class="line"></span><br><span class="line">f1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]</span><br><span class="line">f2 = [<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">12</span>]</span><br><span class="line"></span><br><span class="line">PD = []</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Possible_Construction_1</span>(<span class="params">t</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    t : p头部111后的前9个bit</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    tt = <span class="string">&#x27;111&#x27;</span>+<span class="number">8</span>*(<span class="number">3</span>*t+<span class="number">4</span>*(t[-<span class="number">1</span>]+t[:-<span class="number">1</span>]))+<span class="string">&#x27;00000&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> tt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Possible_Construction_2</span>(<span class="params">p1,p2</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    p1: p循环节前11个bit中的前7bit</span></span><br><span class="line"><span class="string">    p2: p循环节前11个bit中的后4bit</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    phead = p1[:<span class="number">2</span>]</span><br><span class="line">    p3,p4 = p1[<span class="number">2</span>:]+p2[:<span class="number">2</span>],p2[<span class="number">2</span>:]+p1[:<span class="number">2</span>]</span><br><span class="line">    tt = <span class="string">&#x27;111&#x27;</span>+<span class="number">2</span>*(<span class="number">2</span>*(p1+p2)+(p1+p4)+<span class="number">2</span>*(p3+p4)+(p3+p2))+<span class="number">2</span>*(<span class="number">2</span>*(p1+p2)+<span class="number">3</span>*(p3+p4)+(p1+p2))+<span class="number">3</span>*((p1+p2)+(p1+p4)+<span class="number">2</span>*(p3+p4)+(p3+p2)+(p1+p2))+(p1+p2)+(p1+p4)+<span class="number">2</span>*(p3+p4)+<span class="string">&#x27;000&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> tt</span><br><span class="line"></span><br><span class="line">Lst = []</span><br><span class="line">Lf2st = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">给出初始化的种子列表Lst,初始化的噪音列表PD</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">12</span>):</span><br><span class="line">    <span class="keyword">if</span> k+<span class="number">1</span> <span class="keyword">in</span> f1:</span><br><span class="line">        p = <span class="built_in">eval</span>(<span class="string">f&#x27;p<span class="subst">&#123;k+<span class="number">1</span>&#125;</span>&#x27;</span>)</span><br><span class="line">        pp = <span class="built_in">bin</span>(p)[<span class="number">2</span>:]</span><br><span class="line">        p0 = pp[<span class="number">3</span>:<span class="number">12</span>]</span><br><span class="line">        tt = Possible_Construction_1(p0)</span><br><span class="line"></span><br><span class="line">        pd = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">502</span>):</span><br><span class="line">            <span class="keyword">if</span> pp[i] != tt[i]:</span><br><span class="line">                pd.append(i)</span><br><span class="line">        Lst.append([<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> p0])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p = <span class="built_in">eval</span>(<span class="string">f&#x27;p<span class="subst">&#123;k+<span class="number">1</span>&#125;</span>&#x27;</span>)</span><br><span class="line">        pp = <span class="built_in">bin</span>(p)[<span class="number">2</span>:]</span><br><span class="line">        p_1,p_2 = pp[<span class="number">3</span>:<span class="number">10</span>],pp[<span class="number">10</span>:<span class="number">14</span>]</span><br><span class="line">        tt = Possible_Construction_2(p_1,p_2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">int</span>(tt,<span class="number">2</span>),k+<span class="number">1</span>,p_1,p_2)</span><br><span class="line"></span><br><span class="line">        pd = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">502</span>):</span><br><span class="line">            <span class="keyword">if</span> pp[i] != tt[i]:</span><br><span class="line">                pd.append(i)</span><br><span class="line">        Lst.append([<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> p_1+p_2])</span><br><span class="line">        Lf2st.append([<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> p_1+p_2])</span><br><span class="line">    PD.append(pd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">对9bit区的种子矩阵进行修正，爆破11×11的完整种子矩阵</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Get_4ll_Construction</span>(<span class="params">Lst,seq</span>):</span><br><span class="line">    LLst = []</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">12</span>):</span><br><span class="line">        <span class="keyword">if</span> i+<span class="number">1</span> <span class="keyword">in</span> f1:</span><br><span class="line">            LLst.append([Lst[i-<span class="number">1</span>][<span class="number">0</span>]]+seq[t*<span class="number">2</span>:t*<span class="number">2</span>+<span class="number">2</span>]+Lst[i-<span class="number">1</span>][<span class="number">1</span>:])</span><br><span class="line">            t += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            LLst.append(Lst[i-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> LLst</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">解线性关系</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">bl = <span class="number">509</span></span><br><span class="line">P = matrix(<span class="number">11</span>,bl+<span class="number">1</span>)</span><br><span class="line">index = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(bl):</span><br><span class="line">        <span class="keyword">if</span> j <span class="keyword">in</span> PD[i]:</span><br><span class="line">            P[i,j] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            P[i,j] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">PC = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> P.columns():</span><br><span class="line">    <span class="keyword">if</span> i:</span><br><span class="line">        PC.append(<span class="built_in">list</span>(i))</span><br><span class="line">PC = matrix(PC)</span><br><span class="line"></span><br><span class="line">P[<span class="number">4</span>,-<span class="number">8</span>] = <span class="number">1</span></span><br><span class="line">P[<span class="number">4</span>,-<span class="number">7</span>] = <span class="number">1</span></span><br><span class="line">P[<span class="number">4</span>,-<span class="number">6</span>] = <span class="number">1</span></span><br><span class="line">P[<span class="number">6</span>,-<span class="number">8</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">2</span>^<span class="number">12</span>):</span><br><span class="line">    ctrl = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">    seq = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">bin</span>(_)[<span class="number">2</span>:].zfill(<span class="number">12</span>)]</span><br><span class="line">    flag = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">1</span>-ctrl[i] <span class="keyword">not</span> <span class="keyword">in</span> seq[<span class="number">2</span>*i:<span class="number">2</span>*i+<span class="number">2</span>]:</span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    LLst = Get_4ll_Construction(Lst,seq)</span><br><span class="line"></span><br><span class="line">    LLst = matrix(GF(<span class="number">2</span>),LLst).T</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        LLst.solve_left(PC)        </span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    LLst = LLst.T</span><br><span class="line">    <span class="built_in">print</span>(P.nrows(),P.ncols(),LLst.nrows(),[<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">bin</span>(_)[<span class="number">2</span>:].zfill(<span class="number">12</span>)])</span><br><span class="line">    C = LLst.solve_right(P)</span><br><span class="line">    <span class="built_in">print</span>(LLst)</span><br><span class="line">    <span class="comment">#C:解矩阵，用种子向量与之相乘就能够得到噪音向量</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    for i,j in zip(Lst,LLst.T):</span></span><br><span class="line"><span class="string">        print(j,&#x27;1&#x27; if len(i) == 9 else &#x27;2&#x27;)</span></span><br><span class="line"><span class="string">        print(i)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">        a = (matrix(LLst[i])*C)[<span class="number">0</span>]</span><br><span class="line">        a = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>(a)])</span><br><span class="line">        t = []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">502</span>):</span><br><span class="line">            <span class="keyword">if</span> a[j] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                t.append(j)</span><br><span class="line">        <span class="comment">#print(t)</span></span><br><span class="line">        <span class="comment">#print(PD[i])</span></span><br><span class="line">        seed = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(j) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">list</span>(LLst[i])])</span><br><span class="line">        <span class="keyword">if</span> seed[<span class="number">1</span>:<span class="number">4</span>] <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&#x27;111&#x27;</span> , <span class="string">&#x27;000&#x27;</span>]:</span><br><span class="line">            p = Possible_Construction_1(seed[<span class="number">0</span>:<span class="number">1</span>]+seed[<span class="number">3</span>:<span class="number">11</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p = Possible_Construction_2(seed[<span class="number">0</span>:<span class="number">7</span>],seed[<span class="number">7</span>:<span class="number">11</span>])</span><br><span class="line">            <span class="comment">#print(seed[0:7],seed[7:11])</span></span><br><span class="line"></span><br><span class="line">        p = <span class="built_in">int</span>(p,<span class="number">2</span>)</span><br><span class="line">        p ^^= <span class="built_in">int</span>(a.ljust(<span class="number">512</span>,<span class="string">&#x27;0&#x27;</span>),<span class="number">2</span>)</span><br><span class="line">        <span class="comment">#print((seed[1:4] not in [&#x27;111&#x27; , &#x27;000&#x27;]) , (i+2 in f1),seed,i+2,seed[1:4])</span></span><br><span class="line">        <span class="comment">#print(p)</span></span><br><span class="line">        <span class="comment">#print(eval(f&#x27;p&#123;i+2&#125;&#x27;))</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">eval</span>(<span class="string">f&#x27;p<span class="subst">&#123;i+<span class="number">2</span>&#125;</span>&#x27;</span>)-p,next_prime(p) == <span class="built_in">eval</span>(<span class="string">f&#x27;p<span class="subst">&#123;i+<span class="number">2</span>&#125;</span>&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(ans)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h3 id="4-缺陷"><a href="#4-缺陷" class="headerlink" title="4.缺陷"></a>4.缺陷</h3><p>但是这个RNG显然并不成熟，比较大的两个缺陷是：</p>
<ul>
<li>在由长9的循环节反推种子这一步，显然有多种插入数据都会符合2-4bit不完全相同的要求，我们的做法是随便取其中一组，这显然不够有说服力</li>
<li>最后的线性关系虽然可以唯一求解，但是将这个线性关系应用于其他种子的素数生成的话，有个明显的弊端：他们的比特翻转数量无法控制</li>
</ul>
<p><br></p>
<p><br></p>
<h2 id="第三部分——游记"><a href="#第三部分——游记" class="headerlink" title="第三部分——游记"></a>第三部分——游记</h2><p>这个总结并不是对整个wp的总结，而是总结一下这次比赛经过。这次参赛体验真的一点都不好，体现在很多方面：</p>
<p>第一点就是，主办方不报销路费以及住宿费，我们三个是跨校组队，指导老师也是随便挂个名，所以也没法找自己学校报销，就只能自费了，而路费、酒店费很容易就上千，真的肉疼。同时比赛的奖金虽然不能说低，但肯定也不高。除去我们肯定拿不到的特等奖以外，一等奖一万一个队伍，二等奖五千一个队伍，三等奖一千一个队伍。并且事先就知道百分之六七十的队伍都是拿三等奖的，就算是拿了二等奖，都还补不够路费、住宿费的开销。所以等于是完全亏钱来找罪受了，因此开始真的很纠结。</p>
<blockquote>
<p>唯一包的吃还是山大食堂的餐券XD，虽然说味道确实还可以</p>
</blockquote>
<p>这个时候才体会到，一个线下赛如果要自己掏钱参加的话，真的会很打击比赛的热情。</p>
<p><br></p>
<p>第二点，对于住宿的酒店，本来主办方是安排住在青岛美爵酒店的。这个酒店相当好，主办方也和酒店谈了房间协议价的，应该是三百多。</p>
<p>然而，然而，主办方最后没有谈到足够所有参赛队伍入住的协议价房间，所以剩下的没抢到房间的队伍只能预订开在旁边的一家海悦度假公寓——这个度假公寓是新开的，性质更类似于业主自己营业的民宿。</p>
<p>住进去的感觉真的很差：空调效果不好、热水也不好、地板很脏、虫子也多，并且肯定没有仔细打理过，因为每个柜子里面都是一些放了很久的杂物，甚至卫生间的纸都长霉了。而最重要的一点是，入住价格居然和美爵酒店花的差不多，真的很无语。</p>
<p>早饭也很一般，住在美爵的师傅们早上应该可以酒店餐厅里吃自助，而我们说是会送饭到每个人的房间，结果第二天一早让我们自己去另外一层楼的房间拿早饭。早饭也很简陋——杯装的粥、鸡蛋和油条，都已经有一点点冷了，而且最重要的是压根没有地方让我们坐下来吃，我们只能直接提走到楼下再想办法。</p>
<p>此外就是酒店位置实在太偏太偏，我还记得第一天下午到酒店的时候问了问<a target="_blank" rel="noopener" href="https://algellar.github.io/">@Lvsun</a>去哪吃饭，他告诉我点个最近的外卖都要一个多小时的心情。为了吃顿晚饭，需要自己先走二十多分钟去博览中心地铁站，然后坐地铁去山大外面的街上觅食，一趟来回两三个小时就没了。</p>
<p>可以说，这次青岛之行，关于比赛的几乎所有部分体验感都很差很差，如果让我回头选一次的话，是肯定不会来了。</p>
<p><br></p>
<p>但是反过来想，如果去除掉比赛、去除掉花钱这部分，这次青岛之行还是挺不错的。首先就是头一次在线下见到了<a target="_blank" rel="noopener" href="https://d33b4t0.com/">@deebato</a>、<a target="_blank" rel="noopener" href="https://hash-hash.github.io/">@hash_hash</a>、<a target="_blank" rel="noopener" href="https://shinichicun.top/">@Shin</a>这几个师傅，也认识了自己素未谋面的队友<a target="_blank" rel="noopener" href="https://yolbby.github.io/">@yolbby</a>和<a target="_blank" rel="noopener" href="https://march-7th.tech/">@三顺七</a>，算是社恐飞跃般迈出的重大一步。然后就是第二天比赛完，晚上和yolbby去山大外面吃了顿海鲜烧烤，分量真的很足，我们边吃边聊从八点多吃到快十一点，听yolbby讲了很久他精彩又离奇的大学生活(相比起来我大学过的也太平淡了)。</p>
<p><br></p>
<p>此外就是答辩完的当天下午，为了给这次比赛留下点旅游的记忆，我坐地铁去了五四广场。</p>
<blockquote>
<p>以下图都是手机随手拍的，不好看轻喷，我对摄影本来也一窍不通(⌒ω⌒)</p>
</blockquote>
<p>三点多出发，到的时候五点多了，但是人还是不少：</p>
<p><img src="/post/4a67318c/8afcb1e5869e61d33367f338d30dcb3c-1724663567380.jpg" alt="img"></p>
<p>走几步路之后右转就能看见五四广场的标志性雕塑”五月的风”了，凑近拍了一张：</p>
<p><img src="/post/4a67318c/f48699be1cef74f1b5c4fada2a8cb2de.jpg" alt="img"></p>
<p>再走几步路就到了海边了，海上有很多渡轮和帆船，在四川是从来见不到的：</p>
<p><img src="/post/4a67318c/de94e6a3aa86efaeac517426dec1755d.jpg" alt="img"></p>
<p><img src="/post/4a67318c/b724e0abe737c7fbfb91f2232982d108.jpg" alt="img"></p>
<p>下一个想去的地方是八大关，那里离这里还有好几公里，我就一直沿着海边这条路向那边慢慢走。这个时候太阳已经退下去了很多，时不时有傍晚的海风吹在脸上，突然就有不少因素触动心弦——没来过的城市、独自旅行、最近几个月经历的很多烦心事，再加上近在咫尺的望不到尽头的海，我不知道怎么就想到了一些很多年没有见到过的人，这种感受很微妙。</p>
<p>八大关的方向是一直向西边走，所以不刺眼的夕阳一直在我的前面勾勒着高楼的轮廓，更加深了这种复杂的感觉：</p>
<p><img src="/post/4a67318c/18d99231b7ce1408f378332d7fc33ede.jpg" alt="img"></p>
<p>走了一会儿之后发现前面围了很多人，细看发现是包围圈的中间是一些大叔大爷在排队跳海，虽然之前看过天津某个桥上大爷排队跳水的报道，但是这种事情头一次在现实里出现在自己面前还是感觉很新奇——而且这可是跳海XD：</p>
<p><img src="/post/4a67318c/4ca607d5271fdfd58cb6e5a5f1cdbe2f.jpg" alt="img"></p>
<p><img src="/post/4a67318c/45f151e112ae82fbae7afe733b71f005.jpg" alt="img"></p>
<p><img src="/post/4a67318c/649e610311ed3d6235da762fdbf4b2bf.jpg" alt="img"></p>
<p><img src="/post/4a67318c/a07f462d11e7a160b6ec0208c71cc9a2.jpg" alt="img"></p>
<p>我一直走，到了更空旷、人更少的一段路的时候，我突然就想到了高中的时候全班在音乐课上一起看的爱乐之城，想了想却觉得没有哪个场景和我看到的这一幕相像。我也不知道我是想到了那一部电影还是想到了我的高中生活。</p>
<p><img src="/post/4a67318c/537d38274ba41bd2fec1f936dde5e2cf.jpg" alt="img"></p>
<p><img src="/post/4a67318c/6ce95227da3b2359a0db27ef33745b80.jpg" alt="img"></p>
<p>走着走着到了就到了一个人特别多特别多的地方，应该是个海水浴场：</p>
<p><img src="/post/4a67318c/8adf0708c978ec86ead4bb16bbfb49e1.jpg" alt="img"></p>
<p><img src="/post/4a67318c/1c11dd212bc5a8609bc3f36ddae91913.jpg" alt="img"></p>
<p><img src="/post/4a67318c/ee974d5601e9a5f8d1c1ea34c84cd211.jpg" alt="img"></p>
<p><img src="/post/4a67318c/b017d8b62f16f59815f76b688cdf9d4e.jpg" alt="img"></p>
<p>我就这么一直走了两个小时左右，走到了八大关。但是到了地方，我却没看出来到底我要看些什么风景，正好这时候yolbby告诉我说他很饿了，我就去找地铁站赶往山大了。</p>
<p>写到这里突然很想说几句感性的话，因为海和山带给人的感觉不一样，爬了很多次山，都没有过这次沿海边走两小时的心情。上一次去海边已经是小学的事情了，当时和爸妈一起去了秦皇岛，人比较小，除了旅行的开心之外，没有什么别的感受；之后18年初中刚毕业的时候和父母旅行，来了一次上海，但是没有去海边玩；再之后是21年，高中毕业了来上海上大学，但在上海待了快三年了也没有去过一趟海边；再之后就到现在了，终于又一次看见了海。</p>
<p>海让我觉得广阔，但是也让我觉得很不轻松——也许是因为海太广阔了吧。</p>
<p><img src="/post/4a67318c/923385ac4aae687ea0ecb38b6cb27d6e.jpg" alt="img"></p>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/4a67318c.html" title="2024-高校密码挑战赛赛题一-wp-crypto">https://tangcuxiaojikuai.xyz/post/4a67318c.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/f41d32ca.html" rel="prev" title="2024-NSSCTF-3rd-wp-crypto">
      <i class="fa fa-chevron-left"></i> 2024-NSSCTF-3rd-wp-crypto
    </a></div>
      <div class="post-nav-item">
    <a href="/post/689431.html" rel="next" title="2024-羊城杯-wp-crypto">
      2024-羊城杯-wp-crypto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E2%80%94%E2%80%94RSA%E7%89%B9%E5%AE%9A%E5%AF%86%E9%92%A5%E6%B3%84%E9%9C%B2%E6%94%BB%E5%87%BB"><span class="nav-number">1.</span> <span class="nav-text">第一部分——RSA特定密钥泄露攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1"><span class="nav-number">1.1.</span> <span class="nav-text">1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2"><span class="nav-number">1.2.</span> <span class="nav-text">2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3"><span class="nav-number">1.3.</span> <span class="nav-text">3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4"><span class="nav-number">1.4.</span> <span class="nav-text">4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5"><span class="nav-number">1.5.</span> <span class="nav-text">5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6"><span class="nav-number">1.6.</span> <span class="nav-text">6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7"><span class="nav-number">1.7.</span> <span class="nav-text">7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8"><span class="nav-number">1.8.</span> <span class="nav-text">8</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9"><span class="nav-number">1.9.</span> <span class="nav-text">9</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10"><span class="nav-number">1.10.</span> <span class="nav-text">10</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11"><span class="nav-number">1.11.</span> <span class="nav-text">11</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12"><span class="nav-number">1.12.</span> <span class="nav-text">12</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E2%80%94%E2%80%94%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90%E5%99%A8%E5%88%86%E6%9E%90"><span class="nav-number">2.</span> <span class="nav-text">第二部分——随机数生成器分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%91%A8%E6%9C%9F%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.</span> <span class="nav-text">1.周期结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%AF%94%E7%89%B9%E7%BF%BB%E8%BD%AC"><span class="nav-number">2.2.</span> <span class="nav-text">2.比特翻转</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AE%8C%E6%95%B4%E6%AD%A5%E9%AA%A4"><span class="nav-number">2.3.</span> <span class="nav-text">3.完整步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E7%BC%BA%E9%99%B7"><span class="nav-number">2.4.</span> <span class="nav-text">4.缺陷</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E2%80%94%E2%80%94%E6%B8%B8%E8%AE%B0"><span class="nav-number">3.</span> <span class="nav-text">第三部分——游记</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">99</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
