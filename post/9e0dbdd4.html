<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_small.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RnN18ZogmZl_dLVpxZ6y8kjKL73Mu9VLVEkw9d3qrq0" />
  <meta name="msvalidate.01" content="DC3050AD55F30DDF75AAB78517714910" />
  <meta name="baidu-site-verification" content="codeva-PPofu3dNxe" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tangcuxiaojikuai.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="比赛记录">
<meta property="og:type" content="article">
<meta property="og:title" content="2023-NewStarCTF-wp-crypto">
<meta property="og:url" content="https://tangcuxiaojikuai.xyz/post/9e0dbdd4.html">
<meta property="og:site_name" content="糖醋小鸡块的blog">
<meta property="og:description" content="比赛记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tangcuxiaojikuai.xyz/post/9e0dbdd4/image-20231016231545646.png">
<meta property="article:published_time" content="2023-11-05T08:54:21.000Z">
<meta property="article:modified_time" content="2023-11-05T09:53:02.000Z">
<meta property="article:author" content="糖醋小鸡块">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tangcuxiaojikuai.xyz/post/9e0dbdd4/image-20231016231545646.png">

<link rel="canonical" href="https://tangcuxiaojikuai.xyz/post/9e0dbdd4.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2023-NewStarCTF-wp-crypto | 糖醋小鸡块的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">糖醋小鸡块的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tangcuxiaojikuai.xyz/post/9e0dbdd4.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="糖醋小鸡块">
      <meta itemprop="description" content=""追风赶月莫停留，平芜尽处是春山"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="糖醋小鸡块的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2023-NewStarCTF-wp-crypto
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-11-05 16:54:21 / 修改时间：17:53:02" itemprop="dateCreated datePublished" datetime="2023-11-05T16:54:21+08:00">2023-11-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp-crypto/" itemprop="url" rel="index"><span itemprop="name">wp-crypto</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/post/9e0dbdd4.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/9e0dbdd4.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>比赛记录</p>
<span id="more"></span>
<h2 id="Week-1"><a href="#Week-1" class="headerlink" title="Week 1"></a>Week 1</h2><p>题目很基础，这里就不讲了。</p>
<p><br></p>
<p><br></p>
<p><br></p>
<h2 id="Week-2"><a href="#Week-2" class="headerlink" title="Week 2"></a>Week 2</h2><p>挑一道题说一说。</p>
<h3 id="partial-decrypt"><a href="#partial-decrypt" class="headerlink" title="partial decrypt"></a>partial decrypt</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">解密, 但是只解密一半</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">n = p*q </span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line">dp = inverse(e, (p-<span class="number">1</span>))</span><br><span class="line">dq = inverse(e, (q-<span class="number">1</span>))</span><br><span class="line">m1 = <span class="built_in">pow</span>(c,dp, p)</span><br><span class="line">m2 = <span class="built_in">pow</span>(c,dq, q)</span><br><span class="line">q_inv = inverse(q, p)</span><br><span class="line">h = (q_inv*(m1-m2)) % p</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m2 =&#x27;</span>, m2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;h =&#x27;</span>, h)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;q =&#x27;</span>, q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># m2 = 4816725107096625408335954912986735584642230604517017890897348901815741632668751378729851753037917164989698483856004115922538576470127778342121497852554884</span></span><br><span class="line"><span class="comment"># h = 4180720137090447835816240697100630525624574275</span></span><br><span class="line"><span class="comment"># q = 7325294399829061614283539157853382831627804571792179477843187097003503398904074108324900986946175657737035770512213530293277111992799331251231223710406931</span></span><br></pre></td></tr></table></figure>
<p>之所以想说一下这个题，是因为可能不少cryptoer随便试了试，发现h*q+m2就能得出答案，却不明白这是否是一个巧合。</p>
<p>这里先说结论，无论明文m长度多大，只要他小于n，这个求解方法都是完全可行的，原理如下。</p>
<p>首先由题目可以看出，m1，m2其实就是：</p>
<script type="math/tex; mode=display">
m1 \equiv m \quad(mod\;p)</script><script type="math/tex; mode=display">
m2 \equiv m \quad(mod\;q)</script><p>我们先把此处的模等式展开，写成等式形式：</p>
<script type="math/tex; mode=display">
m1 = m - k1*p</script><script type="math/tex; mode=display">
m2 = m - k2*q</script><p>然后，由题目知道，h满足：</p>
<script type="math/tex; mode=display">
h \equiv q^{-1}(m1-m2) \quad (mod\;p)</script><p>不妨把刚才得到的等式代入上式：</p>
<script type="math/tex; mode=display">
h \equiv q^{-1}(m - k1*p-(m - k2*q)) \quad (mod\;p)</script><p>即：</p>
<script type="math/tex; mode=display">
h \equiv q^{-1}(k1*p + k2*q) \quad (mod\;p)</script><p>展开就能消去q^-1*q，得到：</p>
<script type="math/tex; mode=display">
h \equiv q^{-1}*k1*p + k2 \quad (mod\;p)</script><p>又因为在模p意义下，所以：</p>
<script type="math/tex; mode=display">
h \equiv  k2 \quad (mod\;p)</script><p>而这两者仅仅是模p下相等吗？事实上他们完全相等，这是因为：(//代表整除)</p>
<script type="math/tex; mode=display">
k2 = m // q < n // q = p</script><p>也就是说k2&lt;p，因此k2模p等于没模，所以k2 = h。</p>
<p>因此就有：</p>
<script type="math/tex; mode=display">
m2 + h*q = m2+k*q = m</script><p>所以上式一定成立，因此就能恢复明文。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m2 = <span class="number">4816725107096625408335954912986735584642230604517017890897348901815741632668751378729851753037917164989698483856004115922538576470127778342121497852554884</span></span><br><span class="line">h = <span class="number">4180720137090447835816240697100630525624574275</span></span><br><span class="line">q = <span class="number">7325294399829061614283539157853382831627804571792179477843187097003503398904074108324900986946175657737035770512213530293277111992799331251231223710406931</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">m1 = h*q + m2</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m1))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;rsa_with_crt#b12a3a020c9cc5f1a6df4618256f7c88c83fdd95aab1a2b2656d760475bd0bf1&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="Week-3"><a href="#Week-3" class="headerlink" title="Week 3"></a>Week 3</h2><h3 id="Rabin’s-RSA"><a href="#Rabin’s-RSA" class="headerlink" title="Rabin’s RSA"></a>Rabin’s RSA</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Michael O. Rabin的加密方案</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">p = getPrime(<span class="number">64</span>)</span><br><span class="line">q = getPrime(<span class="number">64</span>)</span><br><span class="line"><span class="keyword">assert</span> p % <span class="number">4</span> == <span class="number">3</span></span><br><span class="line"><span class="keyword">assert</span> q % <span class="number">4</span> == <span class="number">3</span></span><br><span class="line"></span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">e = <span class="number">2</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 201354090531918389422241515534761536573</span></span><br><span class="line"><span class="comment"># c = 20442989381348880630046435751193745753</span></span><br></pre></td></tr></table></figure>
<p>首先观察到n较小，因此可以直接factordb分解出p、q。然后就是普通Rabin加密，原理不详述了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">n = <span class="number">201354090531918389422241515534761536573</span></span><br><span class="line">c1 = <span class="number">20442989381348880630046435751193745753</span></span><br><span class="line">e = <span class="number">2</span></span><br><span class="line">p = <span class="number">13934102561950901579</span></span><br><span class="line">q = <span class="number">14450452739004884887</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span>  <span class="title function_">merge</span>(<span class="params">a1,n1,a2,n2</span>):</span><br><span class="line">    d = math.gcd(n1,n2)</span><br><span class="line">    c = a2-a1</span><br><span class="line">    <span class="keyword">if</span> c%d!=<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    c = (c%n2+n2)%n2</span><br><span class="line">    c = c//d</span><br><span class="line">    n1 = n1//d</span><br><span class="line">    n2 = n2//d</span><br><span class="line">    c *= gmpy2.invert(n1,n2)</span><br><span class="line">    c %= n2</span><br><span class="line">    c *= n1*d</span><br><span class="line">    c += a1</span><br><span class="line">    <span class="keyword">global</span> n3</span><br><span class="line">    <span class="keyword">global</span> a3</span><br><span class="line">    n3 = n1*n2*d</span><br><span class="line">    a3 = (c%n3+n3)%n3</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exCRT</span>(<span class="params">a,n</span>):</span><br><span class="line">    a1=a[<span class="number">0</span>]</span><br><span class="line">    n1=n[<span class="number">0</span>]</span><br><span class="line">    le= <span class="built_in">len</span>(a)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,le):</span><br><span class="line">        a2 = a[i]</span><br><span class="line">        n2=n[i]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> merge(a1,n1,a2,n2):</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        a1 = a3</span><br><span class="line">        n1 = n3</span><br><span class="line">    <span class="keyword">global</span> mod</span><br><span class="line">    mod=n1</span><br><span class="line">    <span class="keyword">return</span> (a1%n1+n1)%n1</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exCRT_getequation</span>(<span class="params">a,n</span>):</span><br><span class="line">    a1=a[<span class="number">0</span>]</span><br><span class="line">    n1=n[<span class="number">0</span>]</span><br><span class="line">    le= <span class="built_in">len</span>(a)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,le):</span><br><span class="line">        a2 = a[i]</span><br><span class="line">        n2=n[i]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> merge(a1,n1,a2,n2):</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        a1 = a3</span><br><span class="line">        n1 = n3</span><br><span class="line">    <span class="keyword">return</span> (a1,n1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n =  [p,q]</span><br><span class="line">c =  [<span class="built_in">pow</span>(c1,(p+<span class="number">1</span>)//<span class="number">4</span>,p),<span class="built_in">pow</span>(c1,(q+<span class="number">1</span>)//<span class="number">4</span>,q)]</span><br><span class="line">m =exCRT(c,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line">n =  [p,q]</span><br><span class="line">c =  [<span class="built_in">pow</span>(c1,(p+<span class="number">1</span>)//<span class="number">4</span>,p),-<span class="built_in">pow</span>(c1,(q+<span class="number">1</span>)//<span class="number">4</span>,q)]</span><br><span class="line">m =exCRT(c,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line">n =  [p,q]</span><br><span class="line">c =  [-<span class="built_in">pow</span>(c1,(p+<span class="number">1</span>)//<span class="number">4</span>,p),<span class="built_in">pow</span>(c1,(q+<span class="number">1</span>)//<span class="number">4</span>,q)]</span><br><span class="line">m =exCRT(c,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line">n =  [p,q]</span><br><span class="line">c =  [-<span class="built_in">pow</span>(c1,(p+<span class="number">1</span>)//<span class="number">4</span>,p),-<span class="built_in">pow</span>(c1,(q+<span class="number">1</span>)//<span class="number">4</span>,q)]</span><br><span class="line">m =exCRT(c,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;r4b1n#4c58&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="小明的密码题"><a href="#小明的密码题" class="headerlink" title="小明的密码题"></a>小明的密码题</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">小明正在完成课后作业, 但是屏幕的某一块地方被墨水涂黑了(我们不妨假设小明无法擦去墨水, 并且该电脑是一个真空中的球形电脑)</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> *</span><br><span class="line">flag_part = flag_content + <span class="string">&#x27;#&#x27;</span> + secret_token</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag_part.encode())</span><br><span class="line"></span><br><span class="line">e = <span class="number">5</span></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag_part =&#x27;</span>, flag_part)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;--- hint begin ---&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag = &quot;flag&#123;&quot; + flag_part + &quot;&#125;&quot;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;type of secret_token is&#x27;</span>, <span class="built_in">type</span>(secret_token))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;length of secret_token is&#x27;</span>, <span class="built_in">len</span>(secret_token))</span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 131889193322687215946601811511407251196213571687093913054335139712633125177496800529685285401802802683116451016274353008428347997732857844896393358010946452397522017632024075459908859131965234835870443110233375074265933004741459359128684375786221535003839961829770182916778717973782408036072622166388614214899</span></span><br><span class="line"><span class="comment"># c = 11188201757361363141578235564807411583085091933389381887827791551369738717117549969067660372214366275040055647621817803877495473068767571465521881010707873686036336475554105314475193676388608812872218943728455841652208711802376453034141883236142677345880594246879967378770573385522326039206400578260353074379</span></span><br><span class="line"><span class="comment"># flag_part = sm4ll_r00ts_is_brilliant#◼️◼️◼️◼️◼️◼️◼️◼️</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># --- hint begin ---</span></span><br><span class="line"><span class="comment"># flag = &quot;flag&#123;&quot; + flag_part + &quot;&#125;&quot;</span></span><br><span class="line"><span class="comment"># type of secret_token is &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line"><span class="comment"># length of secret_token is 8</span></span><br></pre></td></tr></table></figure>
<p>已知m高位攻击，构造的多项式如下：</p>
<script type="math/tex; mode=display">
f(x) = (m_{high} + x)^5 - c \quad (mod\;n)</script><p>x为未知的m低位小根，smallroots求解该多项式即可。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">131889193322687215946601811511407251196213571687093913054335139712633125177496800529685285401802802683116451016274353008428347997732857844896393358010946452397522017632024075459908859131965234835870443110233375074265933004741459359128684375786221535003839961829770182916778717973782408036072622166388614214899</span></span><br><span class="line">c = <span class="number">11188201757361363141578235564807411583085091933389381887827791551369738717117549969067660372214366275040055647621817803877495473068767571465521881010707873686036336475554105314475193676388608812872218943728455841652208711802376453034141883236142677345880594246879967378770573385522326039206400578260353074379</span></span><br><span class="line">m = bytes_to_long(<span class="string">b&quot;sm4ll_r00ts_is_brilliant#&quot;</span> + <span class="string">b&quot;\x00&quot;</span>*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (m + x)^<span class="number">5</span> - c</span><br><span class="line">f = f.monic()</span><br><span class="line">roots = f.small_roots(X = <span class="number">2</span>^<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">m = m + <span class="built_in">int</span>(roots[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;sm4ll_r00ts_is_brilliant#cc0dac72&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="babyrandom"><a href="#babyrandom" class="headerlink" title="babyrandom"></a>babyrandom</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个简易的LCG随机数生成器</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"></span><br><span class="line">p = <span class="number">64999433139797068147576269731948390094958654326970231465808792590598519729077</span></span><br><span class="line"></span><br><span class="line">a = randrange(<span class="number">2</span>, p)</span><br><span class="line">b = randrange(<span class="number">2</span>, p)</span><br><span class="line">x = bytes_to_long(flag)</span><br><span class="line">menu = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Random as a Service with LCG backend</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter your option</span></span><br><span class="line"><span class="string">1. Reset</span></span><br><span class="line"><span class="string">2. Get</span></span><br><span class="line"><span class="string">3. Exit</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GetRandom</span>():</span><br><span class="line">    <span class="keyword">global</span> x</span><br><span class="line">    nx = (a*x + b) % p</span><br><span class="line">    <span class="built_in">print</span>(nx)</span><br><span class="line">    x = nx</span><br><span class="line">    </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(menu)</span><br><span class="line">    opt = <span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        opt = <span class="built_in">int</span>(opt)</span><br><span class="line">        <span class="keyword">if</span> opt == <span class="number">1</span>:</span><br><span class="line">            x = bytes_to_long(flag)</span><br><span class="line">        <span class="keyword">elif</span> opt == <span class="number">2</span>:</span><br><span class="line">            GetRandom()</span><br><span class="line">        <span class="keyword">elif</span> opt == <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;invalid option&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;oh no, something wrong!&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>
<p>其实就是一个未知a、b的LCG，只是换成了交互题。先发送1设置种子为flag，再发送2申请三组未知数即可还原参数a、b，进而得到种子flag。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">29676</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">    c.append(<span class="built_in">int</span>(r.recvline().strip().decode()))</span><br><span class="line"></span><br><span class="line">p = <span class="number">64999433139797068147576269731948390094958654326970231465808792590598519729077</span></span><br><span class="line">c1,c2,c3 = c</span><br><span class="line"></span><br><span class="line">a = inverse(c2-c1,p)*(c3-c2) %p</span><br><span class="line">b = (-a*c1 + c2) % p</span><br><span class="line"></span><br><span class="line">temp = c1</span><br><span class="line">temp = ((temp - b) * inverse(a,p)) % p</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(temp))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;lcg_1s_n0t_s3cur3#fb528ba5&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="knapsack"><a href="#knapsack" class="headerlink" title="knapsack"></a>knapsack</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">来自ASIS Quals 的背包密码题</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"></span><br><span class="line">m = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">bin</span>(<span class="built_in">int</span>(codecs.encode(flag,  <span class="string">&#x27;hex&#x27;</span>), <span class="number">16</span>))[<span class="number">2</span>:]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># from ASIS Cyber Security Contest Quals 2014</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">makeKey</span>(<span class="params">n</span>):</span><br><span class="line">    privKey = [random.randint(<span class="number">1</span>, <span class="number">4</span>**n)]</span><br><span class="line">    s = privKey[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n):</span><br><span class="line">        privKey.append(random.randint(s + <span class="number">1</span>, <span class="number">4</span>**(n + i)))</span><br><span class="line">        s += privKey[i]</span><br><span class="line">    q = random.randint(privKey[n-<span class="number">1</span>] + <span class="number">1</span>, <span class="number">2</span>*privKey[n-<span class="number">1</span>])</span><br><span class="line">    r = random.randint(<span class="number">1</span>, q)</span><br><span class="line">    <span class="keyword">while</span> gmpy2.gcd(r, q) != <span class="number">1</span>:</span><br><span class="line">        r = random.randint(<span class="number">1</span>, q)</span><br><span class="line">    pubKey = [ r*w % q <span class="keyword">for</span> w <span class="keyword">in</span> privKey ]</span><br><span class="line">    <span class="keyword">return</span> privKey, q, r, pubKey</span><br><span class="line"></span><br><span class="line">priv, q, r, pub = makeKey(<span class="built_in">len</span>(m))</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="built_in">sum</span>([i*j <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">zip</span>(pub, m)])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ciphertext)</span><br><span class="line"><span class="built_in">print</span>(pub)</span><br></pre></td></tr></table></figure>
<p>作为ctf wiki讲解背包加密的例题，其经典性无需多言：</p>
<p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/crypto/asymmetric/knapsack/knapsack/">背包加密 - CTF Wiki (ctf-wiki.org)</a></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">c = </span><br><span class="line">b = </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = len(b)</span></span><br><span class="line"><span class="string">L = Matrix(ZZ, n+1, n+1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for i in range(n):</span></span><br><span class="line"><span class="string">    L[i,i] = 1</span></span><br><span class="line"><span class="string">    L[i,-1] = b[i]</span></span><br><span class="line"><span class="string">L[-1,-1] = -c</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">res = L.LLL()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for i in range(n + 1):</span></span><br><span class="line"><span class="string">    M = res.row(i).list()</span></span><br><span class="line"><span class="string">    flag = True</span></span><br><span class="line"><span class="string">    for m in M:</span></span><br><span class="line"><span class="string">        if m != 0 and m != 1:</span></span><br><span class="line"><span class="string">            flag = False</span></span><br><span class="line"><span class="string">            break</span></span><br><span class="line"><span class="string">    if flag:</span></span><br><span class="line"><span class="string">        print(i, M)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">flag =  [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">flag = <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">str</span>, flag[:-<span class="number">1</span>]))), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;Lattice_reduction#c3662541&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Door"><a href="#Door" class="headerlink" title="Door"></a>Door</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">你被锁在了自然哲学学院里面, 想办法逃出来吧</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">key = urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">menu = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[+] WatchDog Security System</span></span><br><span class="line"><span class="string">[+] Copyright (c) 1010 by School of Natural Philosophy </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">please select your option:</span></span><br><span class="line"><span class="string">1. Unlock Secret Entry</span></span><br><span class="line"><span class="string">2. Help</span></span><br><span class="line"><span class="string">3. Exit</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">valid_code = [<span class="number">1033</span>,<span class="number">3329</span>,<span class="number">4431</span>,<span class="number">5052</span>]</span><br><span class="line"></span><br><span class="line">auth_context_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;^SoNP#[0-9]&#123;4&#125;$&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">auth_context_checker</span>(<span class="params">ctx : <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> ctx:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">chr</span>(c) <span class="keyword">not</span> <span class="keyword">in</span> string.printable:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> auth_context_pattern.<span class="keyword">match</span>(ctx.decode()) : <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unlock</span>():</span><br><span class="line">    token = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&#x27;Enter your token &gt; &#x27;</span>))</span><br><span class="line">    auth_code = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&#x27;Enter your authentication code &gt; &#x27;</span>))</span><br><span class="line"></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC,token)</span><br><span class="line">    </span><br><span class="line">    check = cipher.decrypt(auth_code)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        </span><br><span class="line">        msg = unpad(check, <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> auth_context_checker(msg) <span class="keyword">and</span> <span class="built_in">int</span>(msg[<span class="number">5</span>:].decode()) <span class="keyword">in</span> valid_code:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;door unlocked, here is your reward&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;get out&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;oops, something wrong&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">help</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;To unlock the door, please enter your token and authentication code.&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(menu)</span><br><span class="line">    opt = <span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        opt = <span class="built_in">int</span>(opt)</span><br><span class="line">        <span class="keyword">if</span> opt == <span class="number">1</span>:</span><br><span class="line">            unlock()</span><br><span class="line">        <span class="keyword">elif</span> opt == <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">help</span>()</span><br><span class="line">        <span class="keyword">elif</span> opt == <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;invalid option&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;oh no, something wrong!&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>CBC模式的预言填充攻击，这是我从Xenny师傅的密码工坊里学到的我觉得很有意思的一种攻击方式，所以在这里展开说一说。</p>
<p>首先看看靶机能够提供什么样的功能，首先，在与靶机连接后，靶机生成一个16字节的随机串作为AES的密钥key，然后可以：</p>
<ul>
<li>选择1，可以输入两段十六进制串，分别是token和auth_code。靶机将会把token作为AES中CBC模式的iv向量，将auth_code作为密文进行解密。</li>
<li>在成功解密之后，靶机将尝试对密文进行解填充，如果解填充失败，将会输出”oops, something wrong”</li>
<li>如果解填充成功，靶机将会对解密得到的明文进行核验，核验要求：1、明文为”SoNP#”+4个数字的字符串的形式；2、四个数字需要是valid_code中的其中之一。</li>
<li>通过核验，则得到flag；通不过核验，则输出”get out”</li>
</ul>
<p>那么分几个部分讲一下如何进行这个攻击。</p>
<h4 id="解填充"><a href="#解填充" class="headerlink" title="解填充"></a>解填充</h4><p>很重要的一点是，解密出来的明文通不过核验，和解填充失败，靶机输出的信息分别是”get out”和”oops, something wrong”，这个区别是很重要的。那么到底针对一个明文是如何解填充的呢？查看unpad源码可以知道，pad和unpad函数默认使用的是PKCS7的填充模式。</p>
<p>在这个模式下，如果最后一组明文长度为15，就需要填充一字节的b”\x01”；如果为14，就需要填充两字节的b”\x02”，以此类推。需要注意的是，当明文恰好为16的整数倍时，仍然需要填充16字节的b”\x10”，这是为了在解密时能正确地识别填充字节。</p>
<p>可以发现，以这种方式填充，填充后的明文会有一个很重要的特性：</p>
<ul>
<li>填充后的明文的最后一字节等于填充的字节的长度</li>
</ul>
<p>因此，明文只要满足上述特性，就能正确解填充。</p>
<h4 id="预言填充攻击"><a href="#预言填充攻击" class="headerlink" title="预言填充攻击"></a>预言填充攻击</h4><p>那么如何利用解填充的这个特性进行CBC模式下的预言填充攻击呢？我们先画一个只有一个分组的CBC模式解密图示：</p>
<p><img src="/post/9e0dbdd4/image-20231016231545646.png" alt="image-20231016231545646"></p>
<p>其中，cipher是我们输入的auth_code，iv是我们输入的token。cipher经AES解密后，得到dec_msg，并与iv异或后得到plain，也就是题目中的msg。</p>
<p>由于密钥key随机且未知，因此我们不管输入什么auth_code，我们都没有办法获得dec_msg的具体值。然而，dec_msg需要和iv异或，而iv是我们自行输入的。因此我们完全可以固定cipher，调整iv，来改变最终解密得到的plain。</p>
<p>那么我们假设某一次输入的cipher，iv，解密后得到的恰好是下面这样的plain：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&quot;justatest\x07\x07\x07\x07\x07\x07\x07&quot;</span></span><br></pre></td></tr></table></figure>
<p>可以看到，他满足PKCS7的填充模式，因此unpad是可以正确解密的。而我们可以调整iv的最后一字节，从而对应改变plain的最后一字节，这样他就无法正确解填充了。</p>
<p>然而，在某一个特殊的iv下，他仍然能正确解密，这也是我们进行攻击的根本依据。想一想在什么时候他仍然会正确解填充？</p>
<p>其实就是当我们输入的iv使得明文变成下面这样时：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&quot;justatest\x07\x07\x07\x07\x07\x07\x01&quot;</span></span><br></pre></td></tr></table></figure>
<p>这也是满足PKCS7填充模式的吧！所以当iv使得plain变成上面这种形式时，靶机会返回”get out”，而不是”oops, something wrong”。而这为我们也带来了一个很重要的信息，也就是dec_msg的最后一字节的值，就等于当前iv的最后一字节异或b”\x01”的值。</p>
<p>在这之后呢，我们将iv的最后一字节对应修改一下，使得其解密得到的plain最后一字节变成b”\x02”，接下来就如法炮制，爆破iv的倒数第二个字节，使得明文为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&quot;justatest\x07\x07\x07\x07\x07\x02\x02&quot;</span></span><br></pre></td></tr></table></figure>
<p>此时也可以正确解填充，对应的，dec_msg的倒数第二个字节值就为当前iv的倒数第二个字节异或b”\x02”的值。</p>
<p>那么接下来就是对剩下十四个字节按这个方式逐个爆破，就能获得完整的dec_msg，而此时我们取token为dec_msg异或需要的msg值，就可以解密出我们需要的明文值，从而得到flag了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">valid_code = [<span class="number">1033</span>,<span class="number">3329</span>,<span class="number">4431</span>,<span class="number">5052</span>]</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">28412</span>)</span><br><span class="line"></span><br><span class="line">dec_list = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">use_list = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">auth_code = (<span class="string">b&quot;\x00&quot;</span>*<span class="number">16</span>).<span class="built_in">hex</span>().encode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">256</span>):</span><br><span class="line">        r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">        r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">        r.recvuntil(<span class="string">b&quot;token &gt; &quot;</span>)</span><br><span class="line"></span><br><span class="line">        temp1 = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> use_list[:<span class="number">15</span>-j]:</span><br><span class="line">            temp1 += long_to_bytes(k)</span><br><span class="line">        temp2 = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> use_list[<span class="number">15</span>-j+<span class="number">1</span>:]:</span><br><span class="line">            temp2 += long_to_bytes(k)</span><br><span class="line">        change_byte = long_to_bytes(i)</span><br><span class="line">        token = (temp1 + change_byte + temp2).<span class="built_in">hex</span>().encode()</span><br><span class="line"></span><br><span class="line">        r.sendline(token)</span><br><span class="line">        r.recvuntil(<span class="string">b&quot;code &gt; &quot;</span>)</span><br><span class="line">        r.sendline(auth_code)</span><br><span class="line"></span><br><span class="line">        temp = r.recvline()</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">b&quot;get out&quot;</span> <span class="keyword">in</span> temp):</span><br><span class="line">            dec_list[<span class="number">15</span>-j] = i ^ (j+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(j+<span class="number">1</span>):</span><br><span class="line">                use_list[<span class="number">15</span>-k] = dec_list[<span class="number">15</span>-k] ^ (j+<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#getflag</span></span><br><span class="line">final = bytes_to_long(pad(<span class="string">b&quot;SoNP#1033&quot;</span>,<span class="number">16</span>))</span><br><span class="line">temp = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> dec_list:</span><br><span class="line">    temp += long_to_bytes(k)</span><br><span class="line">temp = final ^ bytes_to_long(temp)</span><br><span class="line">final_token = long_to_bytes(temp).<span class="built_in">hex</span>().encode()</span><br><span class="line">r.recvuntil(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;token &gt; &quot;</span>)</span><br><span class="line">r.sendline(final_token)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;code &gt; &quot;</span>)</span><br><span class="line">r.sendline(auth_code)</span><br><span class="line">temp = r.recvline()</span><br><span class="line">temp = r.recvline()</span><br><span class="line"><span class="built_in">print</span>(temp)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;d0_n0t_3xpose_th3_padd1ng_5tatus&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="eazy-crt"><a href="#eazy-crt" class="headerlink" title="eazy_crt"></a>eazy_crt</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, p, q</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="string">&#x27;flag&#123;&#x27;</span> + md5(<span class="built_in">str</span>(p).encode()).hexdigest() + <span class="string">&#x27;&#125;&#x27;</span> == flag</span><br><span class="line"><span class="keyword">assert</span> isPrime(p), isPrime(q)</span><br><span class="line"><span class="keyword">assert</span> p.bit_length() == <span class="number">1024</span>, q.bit_length() == <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">m = random.getrandbits(<span class="number">400</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = inverse(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">r1, r2, r3 = getPrime(<span class="number">20</span>), getPrime(<span class="number">20</span>), getPrime(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">dp, dq = d % (p - <span class="number">1</span>), d % (q - <span class="number">1</span>)</span><br><span class="line">Sp, Sq = <span class="built_in">pow</span>(m + getPrime(<span class="number">10</span>), dp, r1 * p), <span class="built_in">pow</span>(m, dq, r2 * q)</span><br><span class="line">s1, s2 = <span class="built_in">pow</span>(m, dp % (r1 - <span class="number">1</span>), r1), <span class="built_in">pow</span>(m, dq % (r2 - <span class="number">1</span>), r2)</span><br><span class="line">S_ = Sq + (q * r2) * (<span class="built_in">int</span>(inverse(q * r2, p * r1)) * (Sp - Sq) % (p * r1))</span><br><span class="line">c1, c2 = (S_ - s1 + <span class="number">1</span>) % r1, (S_ - s2 + <span class="number">1</span>) % r2</span><br><span class="line">gamma = (r3 * c1 + (<span class="number">2</span> ** <span class="number">10</span> - r3) * c2) // (<span class="number">2</span> ** <span class="number">10</span>)</span><br><span class="line">S = <span class="built_in">pow</span>(S_, gamma, p * q)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(p * q)</span><br><span class="line"><span class="built_in">print</span>(S_)</span><br><span class="line"><span class="built_in">print</span>(S)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">m=2180240512138982889935733758776025289492848542072999905411903898302427496814336475436552230920326681809745778470583226987</span></span><br><span class="line"><span class="string">n=25505131259827344749407187081729819350996141100990518281765117676936124636084125400315049858697199427401342785804654120926568235761577895862889807660442415521870277729420875825744007886870384790308986342360349597392841568418588521694478184632631896474390291958350681472768485356865513284619086754437723630874827593280089682939629265210875169009057935264259019861755270570945614034505771690412042781423771110441028258110022746603974882162934979726300741541857444013708508946471384525030286343828680432038605288717842755346907256658746733811881247992925881684393431852248253701825024590345480994598867741811599162649467</span></span><br><span class="line"><span class="string">S_=5510086561842250138908875342533294108331951659612671466695801343686972919443402163401521040457640602756777910081639191753436122171756174730531385913865951826869995984787102439679170684422717808771260217541439878677750508065703064081375473845405916674327932798153100574555933448570618732842365795738120491532398081467312017203933413296779070611024124965772787502242499016884537233028947865288037718074352448773759363242111080540630360902388540661831992776707600133253329779003707938065020121645530719140954554800986771763343191398210100325971573069812381693089384221441735278736889673500218274673196333806222266248844379127652366</span></span><br><span class="line"><span class="string">S=11422623501509574650959962952004985925543723972567988534433510888436662069119800576321679344425052011563473005275801787271861671898318523033415642388512047035650991047953319601346912194462122313366888126100093635969476696871403883687946617575837061694813669883782221006701704487938500886952347003631626326127154081787016692856628561200386941683756397734100698520464199249811238013146899352390453500132666840606585760306723894654933077094375810666168464835756607377998959675132305971721109661644231613426322675350973373434138686086023265910883509514575554429502214217460059521619625693750938117427832654792355808803321</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>题目改编自广东强网杯2021的easycrt，并且这一题给出了S，更加简单。具体题解见我的另一篇博客：</p>
<p><a href="https://tangcuxiaojikuai.xyz/post/ea445335.html#more">Crypto趣题-RSA | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m=<span class="number">2180240512138982889935733758776025289492848542072999905411903898302427496814336475436552230920326681809745778470583226987</span></span><br><span class="line">n=<span class="number">25505131259827344749407187081729819350996141100990518281765117676936124636084125400315049858697199427401342785804654120926568235761577895862889807660442415521870277729420875825744007886870384790308986342360349597392841568418588521694478184632631896474390291958350681472768485356865513284619086754437723630874827593280089682939629265210875169009057935264259019861755270570945614034505771690412042781423771110441028258110022746603974882162934979726300741541857444013708508946471384525030286343828680432038605288717842755346907256658746733811881247992925881684393431852248253701825024590345480994598867741811599162649467</span></span><br><span class="line">S_=<span class="number">5510086561842250138908875342533294108331951659612671466695801343686972919443402163401521040457640602756777910081639191753436122171756174730531385913865951826869995984787102439679170684422717808771260217541439878677750508065703064081375473845405916674327932798153100574555933448570618732842365795738120491532398081467312017203933413296779070611024124965772787502242499016884537233028947865288037718074352448773759363242111080540630360902388540661831992776707600133253329779003707938065020121645530719140954554800986771763343191398210100325971573069812381693089384221441735278736889673500218274673196333806222266248844379127652366</span></span><br><span class="line">S=<span class="number">11422623501509574650959962952004985925543723972567988534433510888436662069119800576321679344425052011563473005275801787271861671898318523033415642388512047035650991047953319601346912194462122313366888126100093635969476696871403883687946617575837061694813669883782221006701704487938500886952347003631626326127154081787016692856628561200386941683756397734100698520464199249811238013146899352390453500132666840606585760306723894654933077094375810666168464835756607377998959675132305971721109661644231613426322675350973373434138686086023265910883509514575554429502214217460059521619625693750938117427832654792355808803321</span></span><br><span class="line"></span><br><span class="line">c2 = <span class="number">1</span></span><br><span class="line">c1 = <span class="built_in">pow</span>(S,<span class="number">65537</span>,n)</span><br><span class="line">q = GCD(<span class="built_in">pow</span>(S_,<span class="number">65537</span>,n)-m,n)</span><br><span class="line">p = n // q</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag&#123;&#x27;</span> + md5(<span class="built_in">str</span>(p).encode()).hexdigest() + <span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;b40ea076da8c73572ae5d067aa0fc22e&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="Week-4"><a href="#Week-4" class="headerlink" title="Week 4"></a>Week 4</h2><p>第四周题目其实我觉得比第三周更容易一点。</p>
<h3 id="RSA-Variation-II"><a href="#RSA-Variation-II" class="headerlink" title="RSA Variation II"></a>RSA Variation II</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Schmidt Samoa&quot;</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">N = p*p*q</span><br><span class="line"></span><br><span class="line">d= inverse(N, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)//GCD(p-<span class="number">1</span>, q-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m, N, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;N =&#x27;</span>, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;d =&#x27;</span>, d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c = 1653396627113549535760516503668455111392369905404419847336187180051939350514408518095369852411718553340156505246372037811032919080426885042549723125598742783778413642221563616358386699697645814225855089454045984443096447166740882693228043505960011332616740785976743150624114653594631779427044055729185392854961786323215146318588164139423925400772680226861699990332420246447180631417523181196631188540323779487858453719444807515638025771586275969579201806909799448813112034867089866513864971414742370516244653259347267231436131850871346106316007958256749016599758599549180907260093080500469394473142003147643172770078092713912200110043214435078277125844112816260967490086038358669788006182833272351526796228536135638071670829206746835346784997437044707950580087067666459222916040902038574157577881880027391425763503693184264104932693985833980182986816664377018507487697769866530103927375926578569947076633923873193100147751463</span></span><br><span class="line"><span class="comment"># N = 1768427447158131856514034889456397424027937796617829756303525705316152314769129050888899742667986532346611229157207778487065194513722005516611969754197481310330149721054855689646133721600838194741123290410384315980339516947257172981002480414254023253269098539962527834174781356657779988761754582343096332391763560921491414520707112852896782970123018263505426447126195645371941116395659369152654368118569516482251442513192892626222576419747048343942947570016045016127917578272819812760632788343321742583353340158009324794626006731057267603803701663256706597904789047060978427573361035171008822467120148227698893238773305320215769410594974360573727150122036666987718934166622785421464647946084162895084248352643721808444370307254417501852264572985908550839933862563001186477021313236113690793843893640190378131373214104044465633483953616402680853776480712599669132572907096151664916118185486737463253559093537311036517461749439</span></span><br><span class="line"><span class="comment"># d = 20650646933118544225095544552373007455928574480175801658168105227037950105642248948645762488881219576174131624593293487325329703919313156659700002234392400636474610143032745113473842675857323774566945229148664969659797779146488402588937762391470971617163496433008501858907585683428652637958844902909796849080799141999490231877378863244093900363251415972834146031490928923962271054053278056347181254936750536280638321211545167520935870220829786490686826062142415755063724639110568511969041175019898031990455911525941036727091961083201123910761290998968240338217895275414072475701909497518616112236380389851984377079</span></span><br></pre></td></tr></table></figure>
<p>题目已经告知是Schmidt Samoa加密方式，其加密流程类似RSA却又有不同，具体如下：</p>
<script type="math/tex; mode=display">
N = p^2q</script><script type="math/tex; mode=display">
e = N</script><script type="math/tex; mode=display">
d \equiv e^{-1} \quad (mod\;\phi(pq))</script><p>其加密为：</p>
<script type="math/tex; mode=display">
c \equiv m^N \quad(mod\;N)</script><p>解密为：</p>
<script type="math/tex; mode=display">
m \equiv c^d \quad(mod\;pq)</script><p>之所以可以正确解密是因为：</p>
<script type="math/tex; mode=display">
c^d \equiv m^{Nd} \equiv m^{1+\phi(pq)} \equiv m \quad(mod\;pq)</script><p>而现在我们有N和d，则由解密流程知道，对于任意x，有：</p>
<script type="math/tex; mode=display">
x^{Nd} \equiv x \quad(mod\;pq)</script><p>因此有：</p>
<script type="math/tex; mode=display">
gcd(x^{Nd}-x,n) = pq</script><p>然后我们就能得到pq，就可以用他的解密方法解密得到明文了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = <span class="number">1653396627113549535760516503668455111392369905404419847336187180051939350514408518095369852411718553340156505246372037811032919080426885042549723125598742783778413642221563616358386699697645814225855089454045984443096447166740882693228043505960011332616740785976743150624114653594631779427044055729185392854961786323215146318588164139423925400772680226861699990332420246447180631417523181196631188540323779487858453719444807515638025771586275969579201806909799448813112034867089866513864971414742370516244653259347267231436131850871346106316007958256749016599758599549180907260093080500469394473142003147643172770078092713912200110043214435078277125844112816260967490086038358669788006182833272351526796228536135638071670829206746835346784997437044707950580087067666459222916040902038574157577881880027391425763503693184264104932693985833980182986816664377018507487697769866530103927375926578569947076633923873193100147751463</span></span><br><span class="line">n = <span class="number">1768427447158131856514034889456397424027937796617829756303525705316152314769129050888899742667986532346611229157207778487065194513722005516611969754197481310330149721054855689646133721600838194741123290410384315980339516947257172981002480414254023253269098539962527834174781356657779988761754582343096332391763560921491414520707112852896782970123018263505426447126195645371941116395659369152654368118569516482251442513192892626222576419747048343942947570016045016127917578272819812760632788343321742583353340158009324794626006731057267603803701663256706597904789047060978427573361035171008822467120148227698893238773305320215769410594974360573727150122036666987718934166622785421464647946084162895084248352643721808444370307254417501852264572985908550839933862563001186477021313236113690793843893640190378131373214104044465633483953616402680853776480712599669132572907096151664916118185486737463253559093537311036517461749439</span></span><br><span class="line">d = <span class="number">20650646933118544225095544552373007455928574480175801658168105227037950105642248948645762488881219576174131624593293487325329703919313156659700002234392400636474610143032745113473842675857323774566945229148664969659797779146488402588937762391470971617163496433008501858907585683428652637958844902909796849080799141999490231877378863244093900363251415972834146031490928923962271054053278056347181254936750536280638321211545167520935870220829786490686826062142415755063724639110568511969041175019898031990455911525941036727091961083201123910761290998968240338217895275414072475701909497518616112236380389851984377079</span></span><br><span class="line"></span><br><span class="line">pq = GCD(<span class="built_in">pow</span>(<span class="number">2</span>,n*d,n)-<span class="number">2</span>,n)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,pq)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;l3arn_s0m3_e1ement4ry_numb3r_the0ry&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="babyNTRU"><a href="#babyNTRU" class="headerlink" title="babyNTRU"></a>babyNTRU</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NTRU, 但是只有常数项</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">q = getPrime(<span class="number">2048</span>)</span><br><span class="line"></span><br><span class="line">f = getPrime(<span class="number">1024</span>)</span><br><span class="line">g = getPrime(<span class="number">768</span>)</span><br><span class="line"></span><br><span class="line">h = (inverse(f, q) * g) % q</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">e = (getPrime(<span class="number">32</span>) * h + m) % q</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>((h, q))</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (8916452722821418463248726825721257021744194286874706915832444631771596616116491775091473142798867278598586482678387668986764461265131119164500473719939894343163496325556340181429675937641495981353857724627081847304246987074303722642172988864138967404024201246050387152854001746763104417773214408906879366958729744259612777257542351501592019483745621824894790096639205771421560295175633152877667720038396154571697861326821483170835238092879747297506606983322890706220824261581533324824858599082611886026668788577757970984892292609271082176311433507931993672945925883985629311514143607457603297458439759594085898425992, 31985842636498685945330905726539498901443694955736332073639744466389039373143618920511122288844282849407290205804991634167816417468703459229138891348115191921395278336695684210437130681337971686008048054340499654721317721241239990701099685207253476642931586563363638141636011941268962999641130263828151538489139254625099330199557503153680089387538863574480134898211311252227463870838947777479309928195791241005127445821671684607237706849308372923372795573732000365072815112119533702614620325238183899266147682193892866330678076925199674554569018103164228278742151778832319406135513140669049734660019551179692615505961)</span></span><br><span class="line"><span class="comment"># 20041713613876382007969284056698149007154248857420752520496829246324512197188211029665990713599667984019715503486507126224558092176392282486689347953069815123212779090783909545244160318938357529307482025697769394114967028564546355310883670462197528011181768588878447856875173263800885048676190978206851268887445527785387532167370943745180538168965461612097037041570912365648125449804109299630958840398397721916860876687808474004391843869813396858468730877627733234832744328768443830669469345926766882446378765847334421595034470639171397587395341977453536859946410431252287203312913117023084978959318406160721042580688</span></span><br></pre></td></tr></table></figure>
<p>格入门时肯定会见过的一个题目，这里不做阐述了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">h,q = (<span class="number">8916452722821418463248726825721257021744194286874706915832444631771596616116491775091473142798867278598586482678387668986764461265131119164500473719939894343163496325556340181429675937641495981353857724627081847304246987074303722642172988864138967404024201246050387152854001746763104417773214408906879366958729744259612777257542351501592019483745621824894790096639205771421560295175633152877667720038396154571697861326821483170835238092879747297506606983322890706220824261581533324824858599082611886026668788577757970984892292609271082176311433507931993672945925883985629311514143607457603297458439759594085898425992</span>, <span class="number">31985842636498685945330905726539498901443694955736332073639744466389039373143618920511122288844282849407290205804991634167816417468703459229138891348115191921395278336695684210437130681337971686008048054340499654721317721241239990701099685207253476642931586563363638141636011941268962999641130263828151538489139254625099330199557503153680089387538863574480134898211311252227463870838947777479309928195791241005127445821671684607237706849308372923372795573732000365072815112119533702614620325238183899266147682193892866330678076925199674554569018103164228278742151778832319406135513140669049734660019551179692615505961</span>)</span><br><span class="line">e = <span class="number">20041713613876382007969284056698149007154248857420752520496829246324512197188211029665990713599667984019715503486507126224558092176392282486689347953069815123212779090783909545244160318938357529307482025697769394114967028564546355310883670462197528011181768588878447856875173263800885048676190978206851268887445527785387532167370943745180538168965461612097037041570912365648125449804109299630958840398397721916860876687808474004391843869813396858468730877627733234832744328768443830669469345926766882446378765847334421595034470639171397587395341977453536859946410431252287203312913117023084978959318406160721042580688</span></span><br><span class="line"></span><br><span class="line">L = Matrix(ZZ, [[<span class="number">1</span>, h],</span><br><span class="line">                [<span class="number">0</span>, q]])</span><br><span class="line"></span><br><span class="line">f, g = L.LLL()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">m = (f*e) % q % g * inverse_mod(f, g) % g</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;Lattice_reduction_magic_on_NTRU#82b08b2d&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="Smart"><a href="#Smart" class="headerlink" title="Smart"></a>Smart</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个解决ECDLP的好方法</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = <span class="number">75206427479775622966537995406541077245842499523456803092204668034148875719001</span></span><br><span class="line">a = <span class="number">40399280641537685263236367744605671534251002649301968428998107181223348036480</span></span><br><span class="line">b = <span class="number">34830673418515139976377184302022321848201537906033092355749226925568830384464</span></span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line"></span><br><span class="line">d = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">G = E.random_element()</span><br><span class="line"></span><br><span class="line">P = d * G</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(G)</span><br><span class="line"><span class="built_in">print</span>(P)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (63199291976729017585116731422181573663076311513240158412108878460234764025898 : 11977959928854309700611217102917186587242105343137383979364679606977824228558 : 1)</span></span><br><span class="line"><span class="comment"># (75017275378438543246214954287362349176908042127439117734318700769768512624429 : 39521483276009738115474714281626894361123804837783117725653243818498259351984 : 1)</span></span><br></pre></td></tr></table></figure>
<p>题目标题明示Smart attack，那么也不需要检查曲线阶是否等于p了，直接Smart attack就好。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MD5</span>(<span class="params">m</span>):<span class="keyword">return</span> md5(<span class="built_in">str</span>(m).encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">p = <span class="number">75206427479775622966537995406541077245842499523456803092204668034148875719001</span></span><br><span class="line">a = <span class="number">40399280641537685263236367744605671534251002649301968428998107181223348036480</span></span><br><span class="line">b = <span class="number">34830673418515139976377184302022321848201537906033092355749226925568830384464</span></span><br><span class="line">G = (<span class="number">63199291976729017585116731422181573663076311513240158412108878460234764025898</span> , <span class="number">11977959928854309700611217102917186587242105343137383979364679606977824228558</span>)</span><br><span class="line">dG = (<span class="number">75017275378438543246214954287362349176908042127439117734318700769768512624429</span> , <span class="number">39521483276009738115474714281626894361123804837783117725653243818498259351984</span>)</span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(p),[a,b])</span><br><span class="line"></span><br><span class="line">P = E(G)</span><br><span class="line">Q = E(dG)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SmartAttack</span>(<span class="params">P,Q,p</span>):</span><br><span class="line">    E = P.curve()</span><br><span class="line">    Eqp = EllipticCurve(Qp(p, <span class="number">2</span>), [ ZZ(t) + randint(<span class="number">0</span>,p)*p <span class="keyword">for</span> t <span class="keyword">in</span> E.a_invariants() ])</span><br><span class="line"></span><br><span class="line">    P_Qps = Eqp.lift_x(ZZ(P.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> P_Qp <span class="keyword">in</span> P_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(P_Qp.xy()[<span class="number">1</span>]) == P.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    Q_Qps = Eqp.lift_x(ZZ(Q.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> Q_Qp <span class="keyword">in</span> Q_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(Q_Qp.xy()[<span class="number">1</span>]) == Q.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    p_times_P = p*P_Qp</span><br><span class="line">    p_times_Q = p*Q_Qp</span><br><span class="line"></span><br><span class="line">    x_P,y_P = p_times_P.xy()</span><br><span class="line">    x_Q,y_Q = p_times_Q.xy()</span><br><span class="line"></span><br><span class="line">    phi_P = -(x_P/y_P)</span><br><span class="line">    phi_Q = -(x_Q/y_Q)</span><br><span class="line">    k = phi_Q/phi_P</span><br><span class="line">    <span class="keyword">return</span> ZZ(k)</span><br><span class="line"></span><br><span class="line">d = <span class="built_in">int</span>(SmartAttack(P, Q, p))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(d)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;m1nd_y0ur_p4rameter#167d&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">签个道吧</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime,bytes_to_long, sieve_base</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uniPrime</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        n = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> n.bit_length() &lt; bits:</span><br><span class="line">            n *= choice(sieve_base)</span><br><span class="line">        <span class="keyword">if</span> isPrime(n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> n + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p=uniPrime(<span class="number">512</span>)</span><br><span class="line">q=uniPrime(<span class="number">512</span>)</span><br><span class="line">n=p*q</span><br><span class="line">e= <span class="number">196608</span></span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n= 3326716005321175474866311915397401254111950808705576293932345690533263108414883877530294339294274914837424580618375346509555627578734883357652996005817766370804842161603027636393776079113035745495508839749006773483720698066943577445977551268093247748313691392265332970992500440422951173889419377779135952537088733</span></span><br><span class="line"><span class="string">c= 2709336316075650177079376244796188132561250459751152184677022745551914544884517324887652368450635995644019212878543745475885906864265559139379903049221765159852922264140740839538366147411533242116915892792672736321879694956051586399594206293685750573633107354109784921229088063124404073840557026747056910514218246</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>可以发现素数的生成方式均满足p-1光滑，因此可以求出p、q。然后发现：</p>
<script type="math/tex; mode=display">
e = 2^{16}*3</script><p>那么预期应该是先求出3的逆元，然后高次Rabin解。不过最近才新学了一招nth_root，试验一下发现真行，这函数很舒服。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"></span><br><span class="line">n= <span class="number">3326716005321175474866311915397401254111950808705576293932345690533263108414883877530294339294274914837424580618375346509555627578734883357652996005817766370804842161603027636393776079113035745495508839749006773483720698066943577445977551268093247748313691392265332970992500440422951173889419377779135952537088733</span></span><br><span class="line">c= <span class="number">2709336316075650177079376244796188132561250459751152184677022745551914544884517324887652368450635995644019212878543745475885906864265559139379903049221765159852922264140740839538366147411533242116915892792672736321879694956051586399594206293685750573633107354109784921229088063124404073840557026747056910514218246</span></span><br><span class="line"><span class="comment">#e = 2^16*3</span></span><br><span class="line">e= <span class="number">196608</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#smooth p-1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a = 2</span></span><br><span class="line"><span class="string">m = 2</span></span><br><span class="line"><span class="string">while True:</span></span><br><span class="line"><span class="string">    a = pow(a, m, n)</span></span><br><span class="line"><span class="string">    p = GCD(a-1, n)</span></span><br><span class="line"><span class="string">    if p != 1 and p != n:</span></span><br><span class="line"><span class="string">        break</span></span><br><span class="line"><span class="string">    m += 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">q = n // p</span></span><br><span class="line"><span class="string">print(p)</span></span><br><span class="line"><span class="string">print(q)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">p = <span class="number">11104262127139631006017377403513327506789883414594983803879501935187577746510780983414313264114974863256190649020310407750155332724309172387489473534782137699</span></span><br><span class="line">q = <span class="number">299589109769881744982450090354913727490614194294955470269590615599558785111624291036465332556249607131912597764625231248581361283506625311199114064303807167</span></span><br><span class="line"></span><br><span class="line">dp = inverse(<span class="number">3</span>,p-<span class="number">1</span>)</span><br><span class="line">dq = inverse(<span class="number">3</span>,q-<span class="number">1</span>)</span><br><span class="line">cp = <span class="built_in">pow</span>(c,dp,p)</span><br><span class="line">cq = <span class="built_in">pow</span>(c,dq,q)</span><br><span class="line"></span><br><span class="line">F = Zmod(p)</span><br><span class="line">cp = F(cp)</span><br><span class="line">resp = cp.nth_root(<span class="number">2</span>^<span class="number">16</span>,<span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">F = Zmod(q)</span><br><span class="line">cq = F(cq)</span><br><span class="line">resq = cq.nth_root(<span class="number">2</span>^<span class="number">16</span>,<span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> resp:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> resq:</span><br><span class="line">        mod = [p,q]</span><br><span class="line">        c = [<span class="built_in">int</span>(i),<span class="built_in">int</span>(j)]</span><br><span class="line">        m = crt(mod,c)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> long_to_bytes(m)):</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;new1sstar_welcome_you&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从错误中学习</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">data = [<span class="built_in">ord</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> flag]</span><br><span class="line"></span><br><span class="line">mod = <span class="number">0x42</span></span><br><span class="line">n = <span class="number">200</span></span><br><span class="line">p = <span class="number">5</span></span><br><span class="line">q = <span class="number">2</span>**<span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">E</span>():</span><br><span class="line">  <span class="keyword">return</span> vector(ZZ, [<span class="number">1</span> - random.randint(<span class="number">0</span>,p) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">creatematrix</span>():</span><br><span class="line">  <span class="keyword">return</span> matrix(ZZ, [[q//<span class="number">2</span> - random.randint(<span class="number">0</span>,q) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(mod)])</span><br><span class="line"></span><br><span class="line">A, B, C= creatematrix(), creatematrix(), creatematrix()</span><br><span class="line">x = vector(ZZ, data[<span class="number">0</span>:mod])</span><br><span class="line">y = vector(ZZ, data[mod:<span class="number">2</span>*mod])</span><br><span class="line">z = vector(ZZ, data[<span class="number">2</span>*mod:<span class="number">3</span>*mod])</span><br><span class="line">e = E()</span><br><span class="line">b = x*B+y*A+z*C + e</span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line">res += <span class="string">&quot;A=&quot;</span> + <span class="built_in">str</span>(A) +<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">res += <span class="string">&quot;B=&quot;</span> + <span class="built_in">str</span>(B) +<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">res += <span class="string">&quot;C=&quot;</span> + <span class="built_in">str</span>(C) +<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">res += <span class="string">&quot;b=&quot;</span> + <span class="built_in">str</span>(b) +<span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;enc.out&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">  f.write(res)</span><br></pre></td></tr></table></figure>
<p>题目描述与标题都说明这是一个LWE(Learning With Errors)问题，不过这道题目自己造格也很容易，这里还是先梳理一下题目加密流程。</p>
<ul>
<li>将flag每个字符的ASCII码存储到列表data中，并将data分为长度相等的三段，分别作为向量x、y、z</li>
<li>生成三个随机矩阵A、B、C，其大小均为mod*n，其中元素为(-q/2,q/2)之间的随机数</li>
<li>生成一个误差向量e，其元素为(-4,1)的随机数</li>
<li>计算向量b，满足：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b = x*B+y*A+z*C + e</span><br></pre></td></tr></table></figure>
<ul>
<li>给出A、B、C、b，要求还原flag</li>
</ul>
<p>由于flag的ASCII码被存在列表data中，而data又被分为三段向量x、y、z，因此本题其实就是要还原x、y、z向量。而我们拥有的等量关系是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b = x*B+y*A+z*C + e</span><br></pre></td></tr></table></figure>
<p>把他展开写为直观形式：</p>
<script type="math/tex; mode=display">
(b_1,b_2,...b_n)
=
(x_1,x_2,...x_{mod})*
\left(
 \begin{matrix}
   A_{1,1}&A_{1,2}&    &\\
   A_{2,1}&A_{2,2}&    &\\
          &       &... &\\
          &       &    &A_{mod,n}
  \end{matrix}
  \right)
  +
  (y_1,y_2,...y_{mod})*
\left(
 \begin{matrix}
   B_{1,1}&B_{1,2}&    &\\
   B_{2,1}&B_{2,2}&    &\\
          &       &... &\\
          &       &    &B_{mod,n}
  \end{matrix}
  \right)
  +
  (z_1,z_2,...z_{mod})*
\left(
 \begin{matrix}
   C_{1,1}&C_{1,2}&    &\\
   C_{2,1}&C_{2,2}&    &\\
          &       &... &\\
          &       &    &C_{mod,n}
  \end{matrix}
  \right)
  +
  (e_1,e_2,...,e_n)</script><p>其实也就是下面的形式：</p>
<script type="math/tex; mode=display">
b
=
(x,y,z)*
\left(
 \begin{matrix}
   A\\
   B\\
   C\\
  \end{matrix}
  \right)
  +
  e</script><p>稍微移项变形一下：</p>
<script type="math/tex; mode=display">
-e
=
(x,y,z,-1)*
\left(
 \begin{matrix}
   A\\
   B\\
   C\\
   b\\
  \end{matrix}
  \right)</script><p>而由于误差e是个很短的向量，那么以此关系就能构造一个格：</p>
<script type="math/tex; mode=display">
\left(
 \begin{matrix}
   A\\
   B\\
   C\\
   b\\
  \end{matrix}
  \right)</script><p>LLL就能规约得到向量e，然后解下面这个矩阵方程就能得到x、y、z，就能还原flag了：</p>
<script type="math/tex; mode=display">
b - e
=
(x,y,z)*
\left(
 \begin{matrix}
   A\\
   B\\
   C\\
  \end{matrix}
  \right)</script><p>实际上手操作时，由于sage矩阵的输出形式有点不尽人意，没办法直接读取，所以需要做一点处理。我的处理方式是：</p>
<ul>
<li>新建一个空白matrix.txt文件</li>
<li>把enc.out的所有内容粘贴到matrix.txt文件中</li>
<li>将”    “(四个空格)全局替换为”,”，再将”   “(三个空格)全局替换为”,”，再将”   “(两个空格)全局替换为”,”，再将”   “(一个空格)全局替换为”,”</li>
<li>将”[,”全局替换为”[“，并在每个矩阵开头多加一个”[“，在每个矩阵结尾多加一个”]”</li>
<li>将”A=”、”B=”、”C=”、”b=”全部替换为”=”，主要是为了分隔几个矩阵</li>
<li>再进行一些可能进行的微调</li>
</ul>
<p>然后就可以以如下方式读入矩阵和向量：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;matrix.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read().split(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">A = matrix(ZZ, <span class="built_in">eval</span>(data[<span class="number">0</span>].strip()))</span><br><span class="line">B = matrix(ZZ, <span class="built_in">eval</span>(data[<span class="number">1</span>].strip()))</span><br><span class="line">C = matrix(ZZ, <span class="built_in">eval</span>(data[<span class="number">2</span>].strip()))</span><br><span class="line">b = vector(ZZ, <span class="built_in">eval</span>(data[<span class="number">3</span>].strip()))</span><br></pre></td></tr></table></figure>
<p>其实用正则表达式来寻找每一行的所有数字应该会更方便，但是我不太会操作。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;matrix.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read().split(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">A = matrix(ZZ, <span class="built_in">eval</span>(data[<span class="number">0</span>].strip()))</span><br><span class="line">B = matrix(ZZ, <span class="built_in">eval</span>(data[<span class="number">1</span>].strip()))</span><br><span class="line">C = matrix(ZZ, <span class="built_in">eval</span>(data[<span class="number">2</span>].strip()))</span><br><span class="line">b = vector(ZZ, <span class="built_in">eval</span>(data[<span class="number">3</span>].strip()))</span><br><span class="line"></span><br><span class="line"><span class="comment">#LLL</span></span><br><span class="line">L = block_matrix([[A],[B],[C],[matrix(b)]])</span><br><span class="line">res = L.LLL()</span><br><span class="line">e = vector(ZZ, res[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#getflag</span></span><br><span class="line">coeffients = block_matrix([[A],[B],[C]])</span><br><span class="line">flag = coeffients.solve_left(b-e)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i),end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;try_lear1n_wi0h_t1e_error&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="Week-5"><a href="#Week-5" class="headerlink" title="Week 5"></a>Week 5</h2><h3 id="last-signin"><a href="#last-signin" class="headerlink" title="last_signin"></a>last_signin</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">coppersmith可以帮助你</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;?&#x27;</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p, q = getPrime(<span class="number">1024</span>), getPrime(<span class="number">1024</span>)</span><br><span class="line">N = p * q</span><br><span class="line">gift = p&amp;(<span class="number">2</span>**<span class="number">923</span>-<span class="number">2</span>**<span class="number">101</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;N = &quot;</span>,N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;gift = &quot;</span>,gift)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c = &quot;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">N =  12055968471523053394851394038007091122809367392467691213651520944038861796011063965460456285088011754895260428814358599592032865236006733879843493164411907032292051539754520574395252298997379020268868972160297893871261713263196092380416876697472160104980015554834798949155917292189278888914003846758687215559958506116359394743135211950575060201887025032694825084104792059271584351889134811543088404952977137809673880602946974798597506721906751835019855063462460686036567578835477249909061675845157443679947730585880392110482301750827802213877643649659069945187353987713717145709188790427572582689339643628659515017749</span></span><br><span class="line"><span class="string">p0 =  70561167908564543355630347620333350122607189772353278860674786406663564556557177660954135010748189302104288155939269204559421198595262277064601483770331017282701354382190472661583444774920297367889959312517009682740631673940840597651219956142053575328811350770919852725338374144</span></span><br><span class="line"><span class="string">c =  2475592349689790551418951263467994503430959303317734266333382586608208775837696436139830443942890900333873206031844146782184712381952753718848109663188245101226538043101790881285270927795075893680615586053680077455901334861085349972222680322067952811365366282026756737185263105621695146050695385626656638309577087933457566501579308954739543321367741463532413790712419879733217017821099916866490928476372772542254929459218259301608413811969763001504245717637231198848196348656878611788843380115493744125520080930068318479606464623896240289381601711908759450672519228864487153103141218567551083147171385920693325876018</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>这题前段时间也有个师傅问过我，其实是D3CTF的一道原题，wp如下：</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/193939#h3-28">D^3CTF 官方Write Up-安全客 - 安全资讯平台 (anquanke.com)</a></p>
<p>用wp中的exp可以进行这道题目的二元copper求解，而用普通的二元copper的话，不管是调参还是多爆破几位也出不来结果，具体原因就没研究过了。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N =  <span class="number">12055968471523053394851394038007091122809367392467691213651520944038861796011063965460456285088011754895260428814358599592032865236006733879843493164411907032292051539754520574395252298997379020268868972160297893871261713263196092380416876697472160104980015554834798949155917292189278888914003846758687215559958506116359394743135211950575060201887025032694825084104792059271584351889134811543088404952977137809673880602946974798597506721906751835019855063462460686036567578835477249909061675845157443679947730585880392110482301750827802213877643649659069945187353987713717145709188790427572582689339643628659515017749</span></span><br><span class="line">p0 =  <span class="number">70561167908564543355630347620333350122607189772353278860674786406663564556557177660954135010748189302104288155939269204559421198595262277064601483770331017282701354382190472661583444774920297367889959312517009682740631673940840597651219956142053575328811350770919852725338374144</span></span><br><span class="line">c =  <span class="number">2475592349689790551418951263467994503430959303317734266333382586608208775837696436139830443942890900333873206031844146782184712381952753718848109663188245101226538043101790881285270927795075893680615586053680077455901334861085349972222680322067952811365366282026756737185263105621695146050695385626656638309577087933457566501579308954739543321367741463532413790712419879733217017821099916866490928476372772542254929459218259301608413811969763001504245717637231198848196348656878611788843380115493744125520080930068318479606464623896240289381601711908759450672519228864487153103141218567551083147171385920693325876018</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bivariate</span>(<span class="params">pol, XX, YY, kk=<span class="number">4</span></span>):</span><br><span class="line">    N = pol.parent().characteristic()</span><br><span class="line"></span><br><span class="line">    f = pol.change_ring(ZZ)</span><br><span class="line">    PR, (x, y) = f.parent().objgens()</span><br><span class="line"></span><br><span class="line">    idx = [(k - i, i) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(kk + <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k + <span class="number">1</span>)]</span><br><span class="line">    monomials = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> t: PR(x ** t[<span class="number">0</span>] * y ** t[<span class="number">1</span>]), idx))</span><br><span class="line">    <span class="comment"># collect the shift-polynomials</span></span><br><span class="line">    g = []</span><br><span class="line">    <span class="keyword">for</span> h, i <span class="keyword">in</span> idx:</span><br><span class="line">        <span class="keyword">if</span> h == <span class="number">0</span>:</span><br><span class="line">            g.append(y ** h * x ** i * N)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            g.append(y ** (h - <span class="number">1</span>) * x ** i * f)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice basis</span></span><br><span class="line">    M = Matrix(ZZ, <span class="built_in">len</span>(g))</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(M.nrows()):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(M.ncols()):</span><br><span class="line">            h, i = idx[col]</span><br><span class="line">            M[row, col] = g[row][h, i] * XX ** h * YY ** i</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    B = M.LLL()</span><br><span class="line"></span><br><span class="line">    PX = PolynomialRing(ZZ, <span class="string">&#x27;xs&#x27;</span>)</span><br><span class="line">    xs = PX.gen()</span><br><span class="line">    PY = PolynomialRing(ZZ, <span class="string">&#x27;ys&#x27;</span>)</span><br><span class="line">    ys = PY.gen()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Transform LLL-reduced vectors to polynomials</span></span><br><span class="line">    H = [(i, PR(<span class="number">0</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(B.nrows())]</span><br><span class="line">    H = <span class="built_in">dict</span>(H)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(B.nrows()):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(B.ncols()):</span><br><span class="line">            H[i] += PR((monomials[j] * B[i, j]) / monomials[j](XX, YY))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Find the root</span></span><br><span class="line">    poly1 = H[<span class="number">0</span>].resultant(H[<span class="number">1</span>], y).subs(x=xs)</span><br><span class="line">    poly2 = H[<span class="number">0</span>].resultant(H[<span class="number">2</span>], y).subs(x=xs)</span><br><span class="line">    poly = gcd(poly1, poly2)</span><br><span class="line">    x_root = poly.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    poly1 = H[<span class="number">0</span>].resultant(H[<span class="number">1</span>], x).subs(y=ys)</span><br><span class="line">    poly2 = H[<span class="number">0</span>].resultant(H[<span class="number">2</span>], x).subs(y=ys)</span><br><span class="line">    poly = gcd(poly1, poly2)</span><br><span class="line">    y_root = poly.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x_root, y_root</span><br><span class="line"></span><br><span class="line">PR = PolynomialRing(Zmod(N), names=<span class="string">&#x27;x,y&#x27;</span>)</span><br><span class="line">x, y = PR.gens()</span><br><span class="line">pol = <span class="number">2</span> ** <span class="number">924</span> * x + y + p0</span><br><span class="line"></span><br><span class="line">x, y = bivariate(pol, <span class="number">2</span> ** <span class="number">100</span>, <span class="number">2</span> ** <span class="number">100</span>)</span><br><span class="line">p = <span class="number">2</span> ** <span class="number">924</span> * x + y + p0</span><br><span class="line">q = N // p</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">d = inverse(e, (p - <span class="number">1</span>)*(q - <span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">int</span>(<span class="built_in">pow</span>(c, d, N))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;although_11ts_norma11_tis_still_stay_dsadsa&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="School-of-CRC32"><a href="#School-of-CRC32" class="headerlink" title="School of CRC32"></a>School of CRC32</h3><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">来点CRC32挑战</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"></span><br><span class="line">ROUND = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">LENGTH = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Extreme hard CRC32 challenge&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;ARE YOU READY&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROUND):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ROUND&#x27;</span>, i, <span class="string">&#x27;!&#x27;</span>*<span class="built_in">int</span>(i/<span class="number">75</span> + <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    target = secrets.randbits(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Here is my CRC32 value: &#x27;</span>, <span class="built_in">hex</span>(target))</span><br><span class="line"></span><br><span class="line">    dat = <span class="built_in">input</span>(<span class="string">&#x27;Show me some data &gt; &#x27;</span>)</span><br><span class="line">    raw = <span class="built_in">bytes</span>.fromhex(dat)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> zlib.crc32(raw) == target <span class="keyword">and</span> <span class="built_in">len</span>(raw) == LENGTH:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;GREAT&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;OH NO&quot;</span>)</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Congratulation! Here is your flag&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>题目要求进行一百轮挑战，全部通过就有flag，挑战的具体内容是：</p>
<ul>
<li>生成32bit的随机数target，作为CRC32的目标值</li>
<li>输入一段长度为20的字节流，使得该字节流的CRC32值与给定target相等</li>
</ul>
<p>当然可以去根据CRC的仿射与差分的相关性质去建立矩阵，然后求解矩阵方程得到碰撞。但是实际上知道有个轮子的话就很简单了：</p>
<p><a target="_blank" rel="noopener" href="https://pypi.org/project/crcsolver/">crcsolver · PyPI</a></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> crcsolver</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">28240</span>)</span><br><span class="line"></span><br><span class="line">ROUND = <span class="number">100</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(ROUND):</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;CRC32 value:  &quot;</span>)</span><br><span class="line">    temp = <span class="built_in">eval</span>(sh.recvline().strip().decode())</span><br><span class="line">    cc = crcsolver.solve(<span class="string">b&#x27;_&#x27;</span>*<span class="number">20</span>, <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">20</span>*<span class="number">8</span>), temp, binascii.crc32)</span><br><span class="line">    raw = <span class="built_in">bytes</span>.fromhex(cc.<span class="built_in">hex</span>())</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;Show me some data &gt; &quot;</span>)</span><br><span class="line">    sh.sendline(cc.<span class="built_in">hex</span>().encode())</span><br><span class="line">sh.recvline()</span><br><span class="line">sh.recvline()</span><br><span class="line"><span class="built_in">print</span>(sh.recvline())</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;a1gebra_i5_ma4ic#cf5d4a5d&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h3 id="PseudoHell-EASY-PseudoHell-HARD"><a href="#PseudoHell-EASY-PseudoHell-HARD" class="headerlink" title="PseudoHell_EASY/PseudoHell_HARD"></a>PseudoHell_EASY/PseudoHell_HARD</h3><p>两个题其实共用一个附件，因此也放在一起说了</p>
<p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">欢迎来到随机天堂，来猜猜我投的硬币是1还是0吧</span><br></pre></td></tr></table></figure>
<p>题目：</p>
<p>problems.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> challenge <span class="keyword">import</span> Challenge1,Challenge2,Challenge3,Challenge4,Challenge5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag_easy,flag_hard</span><br><span class="line">roll_left = <span class="number">56</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">guess_coin</span>(<span class="params">level, query_num</span>):</span><br><span class="line">    Ch = level()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(query_num):</span><br><span class="line">        msg = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;msg? &gt; &quot;</span>))</span><br><span class="line">        inverse = <span class="built_in">input</span>(<span class="string">&quot;inverse? &gt; &quot;</span>) == <span class="string">&#x27;y&#x27;</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(msg) == Ch.input_size</span><br><span class="line">        <span class="built_in">print</span>(Ch.roll(msg, inverse).<span class="built_in">hex</span>())</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">input</span>(<span class="string">&quot;coin? &gt; &quot;</span>) == <span class="built_in">str</span>(Ch.coin) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">roll_challenge</span>(<span class="params">challenge_level, challenge</span>):</span><br><span class="line">    <span class="keyword">global</span> roll_left</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Challenge Level: <span class="subst">&#123;challenge_level&#125;</span>&quot;</span>)</span><br><span class="line">    roll_num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">f&quot;How many times are required to roll for solving <span class="subst">&#123;challenge_level&#125;</span>? &gt; &quot;</span>))</span><br><span class="line">    roll_left -= roll_num</span><br><span class="line">    [guess_coin(challenge, roll_num) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>)]</span><br><span class="line"></span><br><span class="line">roll_challenge(<span class="string">&quot;1&quot;</span>, Challenge1)</span><br><span class="line">roll_challenge(<span class="string">&quot;2&quot;</span>, Challenge2)</span><br><span class="line">roll_challenge(<span class="string">&quot;3&quot;</span>, Challenge3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> roll_left &lt;= <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;You passed all challenges for EASY but times limit exceeded. Try harder :(&quot;</span>)</span><br><span class="line">    exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag for easy is &quot;</span>, flag_easy)</span><br><span class="line"></span><br><span class="line">roll_challenge(<span class="string">&quot;4&quot;</span>, Challenge4)</span><br><span class="line">roll_challenge(<span class="string">&quot;5&quot;</span>, Challenge5)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> roll_left &lt;= <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;You passed all challenges for HARD but times limit exceeded. Try harder :(&quot;</span>)</span><br><span class="line">    exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag for hard is &quot;</span>, flag_hard)</span><br></pre></td></tr></table></figure>
<p>challenge.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a:<span class="built_in">bytes</span>,b:<span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="built_in">len</span>(b)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([i ^ j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(a,b)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PRP</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        self.domain_cache = &#123;&#125;</span><br><span class="line">        self.range_cache = &#123;&#125;</span><br><span class="line">        self.n = n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tran</span>(<span class="params">self, m, inverse = <span class="literal">False</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inverse:</span><br><span class="line">            x = m</span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">in</span> self.domain_cache:</span><br><span class="line">                <span class="keyword">return</span> self.domain_cache[x]</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                y = os.urandom(self.n)</span><br><span class="line">                <span class="keyword">if</span> y <span class="keyword">in</span> self.range_cache:<span class="keyword">continue</span></span><br><span class="line">                self.domain_cache[x] = y</span><br><span class="line">                self.range_cache[y] = x    </span><br><span class="line">                <span class="keyword">return</span> y</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y = m</span><br><span class="line">            <span class="keyword">if</span> y <span class="keyword">in</span> self.range_cache:</span><br><span class="line">                <span class="keyword">return</span> self.range_cache[y]</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                x = os.urandom(self.n)</span><br><span class="line">                <span class="keyword">if</span> x <span class="keyword">in</span> self.domain_cache:<span class="keyword">continue</span></span><br><span class="line">                self.domain_cache[x] = y</span><br><span class="line">                self.range_cache[y] = x    </span><br><span class="line">                <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PRF</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        self.domain_cache = &#123;&#125;</span><br><span class="line">        self.range_cache = &#123;&#125;</span><br><span class="line">        self.n = n </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tran</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> self.domain_cache:</span><br><span class="line">            self.domain_cache[x] = os.urandom(self.n)</span><br><span class="line">        <span class="keyword">return</span> self.domain_cache[x]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge1</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> self.RO2.tran(M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge1, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge2</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> self.RO2.tran(M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge2, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge3</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inverse:</span><br><span class="line">            L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">if</span> inverse <span class="keyword">or</span> <span class="keyword">not</span> inverse:        </span><br><span class="line">            <span class="keyword">return</span> self.RO2.tran(M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M,inverse)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge4</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.PRP1 = PRP(self.block_size)</span><br><span class="line">        self.PRP2 = PRP(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        X, T = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        X = xor(X, T)</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            X = xor(self.PRP1.tran(X, inverse),T)</span><br><span class="line">        <span class="keyword">return</span> X</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">return</span> self.PRP2.tran(M, inverse)[:self.block_size]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M,inverse)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge5</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">1</span></span><br><span class="line">        self.input_size = self.block_size</span><br><span class="line">        self.PRP = PRP(self.block_size)</span><br><span class="line">        self.PRF = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> xor(<span class="built_in">bytes</span>(<span class="number">1</span>),self.PRP.tran(M))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> xor(self.PRF.tran(M),<span class="built_in">bytes</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge 5, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br></pre></td></tr></table></figure>
<p>题目代码挺长的，先简要地描述一下主要任务：</p>
<ul>
<li>题目连续生成五个猜硬币挑战，通过一个挑战才能进行下一个挑战</li>
<li>对于每个挑战，需要猜测成功33次硬币即可通过挑战</li>
<li>猜测硬币的依据是：靶机提供输入功能可以输入一段字节流，而对于硬币为0或为1，会有不同的随机数产生方式，对输入的字节流产生随机数并返回。</li>
<li>对于每个挑战中的每一次猜硬币，可以指定输入次数，这个次数是五次挑战共享的，也就是说，如果前面用的次数多，后面能用的次数就少；前面用的少，后面能用的次数就很充裕。</li>
<li>对于指定的challenge，可以使用inverse功能，获取某个输入的解密结果</li>
</ul>
<p>那么核心任务就是：</p>
<ul>
<li>判断出每个challenge中，硬币为0或1时产生的随机数有什么不同，从而构造对应的输入，用得到的对应输出的特点去判断</li>
<li>对每一次挑战，尽可能用更少的输入次数，从而使后面的次数更加充裕</li>
</ul>
<p>然后，对于5个challenge，其随机数产生都是基于两个类的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PRP</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        self.domain_cache = &#123;&#125;</span><br><span class="line">        self.range_cache = &#123;&#125;</span><br><span class="line">        self.n = n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tran</span>(<span class="params">self, m, inverse = <span class="literal">False</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inverse:</span><br><span class="line">            x = m</span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">in</span> self.domain_cache:</span><br><span class="line">                <span class="keyword">return</span> self.domain_cache[x]</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                y = os.urandom(self.n)</span><br><span class="line">                <span class="keyword">if</span> y <span class="keyword">in</span> self.range_cache:<span class="keyword">continue</span></span><br><span class="line">                self.domain_cache[x] = y</span><br><span class="line">                self.range_cache[y] = x    </span><br><span class="line">                <span class="keyword">return</span> y</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y = m</span><br><span class="line">            <span class="keyword">if</span> y <span class="keyword">in</span> self.range_cache:</span><br><span class="line">                <span class="keyword">return</span> self.range_cache[y]</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                x = os.urandom(self.n)</span><br><span class="line">                <span class="keyword">if</span> x <span class="keyword">in</span> self.domain_cache:<span class="keyword">continue</span></span><br><span class="line">                self.domain_cache[x] = y</span><br><span class="line">                self.range_cache[y] = x    </span><br><span class="line">                <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PRF</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        self.domain_cache = &#123;&#125;</span><br><span class="line">        self.range_cache = &#123;&#125;</span><br><span class="line">        self.n = n </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tran</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> self.domain_cache:</span><br><span class="line">            self.domain_cache[x] = os.urandom(self.n)</span><br><span class="line">        <span class="keyword">return</span> self.domain_cache[x]</span><br></pre></td></tr></table></figure>
<p>这两个类分别指的是伪随机置换(PRP)和伪随机函数(PRF)，其具体区别可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_50984266/article/details/109551506">【密码学】PRP和PRF_prf算法-CSDN博客</a></p>
<p>那么接下来就逐个挑战分析：</p>
<h4 id="challenge-1"><a href="#challenge-1" class="headerlink" title="challenge 1"></a>challenge 1</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge1</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> self.RO2.tran(M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge1, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br></pre></td></tr></table></figure>
<p>可以看到，对于硬币为0或为1，其对输入的串的处理方式不同：</p>
<ul>
<li>为0，把输入串分为左右两部分，然后如下得到结果</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">L, R = R, xor(L, self.RO1.tran(R))</span><br></pre></td></tr></table></figure>
<ul>
<li>为1，直接输出一个长度为16的随机字节流</li>
</ul>
<p>那么如何区分也很显然。我们请求一次输入次数，然后输入长度为16的全0字节，然后若靶机返回的输出前8个字节为全0，说明硬币为0；否则为1。</p>
<h4 id="challenge-2"><a href="#challenge-2" class="headerlink" title="challenge 2"></a>challenge 2</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge2</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> self.RO2.tran(M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge2, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br></pre></td></tr></table></figure>
<p>与challenge1的区别在于，硬币为0时，这个类feistel结构多进行了一轮，因此无法直接从输出进行判断。</p>
<p>但是解决方式也很容易，我们请求两次输入次数：</p>
<p>如果硬币是0：</p>
<ul>
<li>第一次，输入长度为16的全0字节流，得到对应输出，推导一下可以知道输出的左右两部分是如下形式：</li>
</ul>
<script type="math/tex; mode=display">
t(0),t(t(0))</script><ul>
<li>第二次，我们输入：</li>
</ul>
<script type="math/tex; mode=display">
t(0),0</script><ul>
<li>可以简单推导一下，我们得到的输出应该是：</li>
</ul>
<script type="math/tex; mode=display">
0,t(0)</script><p>而如果硬币是1，显然输出不会是这个结构，因此我们就可以通过挑战二。</p>
<h4 id="challenge-3"><a href="#challenge-3" class="headerlink" title="challenge 3"></a>challenge 3</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge3</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inverse:</span><br><span class="line">            L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">if</span> inverse <span class="keyword">or</span> <span class="keyword">not</span> inverse:        </span><br><span class="line">            <span class="keyword">return</span> self.RO2.tran(M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M,inverse)</span><br></pre></td></tr></table></figure>
<p>相比起challenge2，又多加了一轮feistel，不过不同的是，我们可以通过inverse进行解密。</p>
<p>那就很简单了，我们请求两次输入次数，第一次随便输入一个字节流并获得其加密结果，第二轮输入得到的加密结果，并看inverse的结果与第一轮是否相等就好了。相等为0，否则为1。</p>
<h4 id="challenge-4"><a href="#challenge-4" class="headerlink" title="challenge 4"></a>challenge 4</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge4</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.PRP1 = PRP(self.block_size)</span><br><span class="line">        self.PRP2 = PRP(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        X, T = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        X = xor(X, T)</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            X = xor(self.PRP1.tran(X, inverse),T)</span><br><span class="line">        <span class="keyword">return</span> X</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">return</span> self.PRP2.tran(M, inverse)[:self.block_size]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M,inverse)</span><br></pre></td></tr></table></figure>
<p>挑战4中，如果硬币为0，则会将输入分为左右两部分，并反复进行tran和异或操作。不过可以看出，如果我们将输入的右半部分取为全0，异或操作相当于没有进行，而只有两轮tran。</p>
<p>那么同样，我们请求两次输入，第一次输入长度为16的全0字节流得到加密结果，然后第二次将加密结果再连接上8字节的0去inverse，解密得到全0说明硬币为0，否则为1。</p>
<h4 id="challenge-5"><a href="#challenge-5" class="headerlink" title="challenge 5"></a>challenge 5</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge5</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">1</span></span><br><span class="line">        self.input_size = self.block_size</span><br><span class="line">        self.PRP = PRP(self.block_size)</span><br><span class="line">        self.PRF = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> xor(<span class="built_in">bytes</span>(<span class="number">1</span>),self.PRP.tran(M))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> xor(self.PRF.tran(M),<span class="built_in">bytes</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge 5, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br></pre></td></tr></table></figure>
<p>这题与前面的4个challenge有两个明显区别：</p>
<ul>
<li>加密的明文仅有1字节</li>
<li>既有PRP又有PRF</li>
</ul>
<p>那么肯定就是要利用两者的区别。而最明显的区别就在于，PRP会建立一个双射，从而保证能进行逆操作，但是PRF不会。</p>
<p>什么意思呢？比如我们输入1和2，PRP能保证输入的两个自变量对应的函数值不同，但是PRF不保证，也就是说输入1，2，返回值可能均为1。</p>
<p>而我们前面共请求了1+2+2+2次，还可以用48次。因此可以请求48次输入次数，并用靶机返回的值建立字典并检查字典长度。如果长度为48则硬币大概率为0，否则为1。</p>
<p>注意我这里说的是大概率为0，概率具体有多大呢？我们其实可以把他看做一个等价的事件，也就是：</p>
<ul>
<li>从0-255中随机抽取48次，48次全部都不一样。</li>
</ul>
<p>这个时候我们的判断就会失败，因为此时PRF和PRP字典长度均为48。而这个失败的概率为：</p>
<script type="math/tex; mode=display">
\frac{256}{256}*\frac{255}{256}*\frac{254}{256}*...\frac{209}{256}</script><p>而经计算，这个概率大约为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t = <span class="number">0.009029416209217144</span></span><br></pre></td></tr></table></figure>
<p>可以看到对于每一次，我们只有不到1%的非常小的概率失败，而我们同样也可以计算33次全部成功的概率如下：</p>
<script type="math/tex; mode=display">
P = (1-t)^{33}</script><p>计算得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.7413190801200953</span><br></pre></td></tr></table></figure>
<p>所以我们有很大概率成功，这也是生日攻击的理论基础。</p>
<p>完整exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">r = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">27756</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Easy</span></span><br><span class="line"><span class="comment">#challenge1</span></span><br><span class="line">r.recvuntil(<span class="string">b&quot;solving 1? &gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">33</span>):</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;msg? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;0&quot;</span> * <span class="number">32</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;inverse? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;n&quot;</span>)</span><br><span class="line">    temp = r.recvline().strip().decode()</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;0000000000000000&quot;</span> <span class="keyword">in</span> temp):</span><br><span class="line">        r.sendline(<span class="string">b&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#challenge2</span></span><br><span class="line">r.recvuntil(<span class="string">b&quot;solving 2? &gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">33</span>):</span><br><span class="line">    temp = [<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#first</span></span><br><span class="line">    r.recvuntil(<span class="string">b&quot;msg? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;0&quot;</span> * <span class="number">32</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;inverse? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;n&quot;</span>)</span><br><span class="line">    temp[<span class="number">0</span>] = r.recvline().strip().decode()</span><br><span class="line">    <span class="comment">#second</span></span><br><span class="line">    r.recvuntil(<span class="string">b&quot;msg? &gt;&quot;</span>)</span><br><span class="line">    r.sendline((temp[<span class="number">0</span>][:<span class="number">16</span>]+<span class="string">&quot;0&quot;</span>*<span class="number">16</span>).encode())</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;inverse? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;n&quot;</span>)</span><br><span class="line">    temp[<span class="number">1</span>] = r.recvline().strip().decode()</span><br><span class="line">    <span class="keyword">if</span>(temp[<span class="number">1</span>][:<span class="number">16</span>] == <span class="string">&quot;0000000000000000&quot;</span>):</span><br><span class="line">        r.sendline(<span class="string">b&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#challenge3</span></span><br><span class="line">r.recvuntil(<span class="string">b&quot;solving 3? &gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">33</span>):</span><br><span class="line">    temp = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#first</span></span><br><span class="line">    r.recvuntil(<span class="string">b&quot;msg? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;0&quot;</span> * <span class="number">32</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;inverse? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;n&quot;</span>)</span><br><span class="line">    temp[<span class="number">0</span>] = r.recvline().strip().decode()</span><br><span class="line">    <span class="comment">#second</span></span><br><span class="line">    r.recvuntil(<span class="string">b&quot;msg? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(temp[<span class="number">0</span>].encode())</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;inverse? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;y&quot;</span>)</span><br><span class="line">    temp[<span class="number">1</span>] = r.recvline().strip().decode()</span><br><span class="line">    <span class="comment">#third</span></span><br><span class="line">    <span class="keyword">if</span>(temp[<span class="number">1</span>][:<span class="number">16</span>] == <span class="string">&quot;0000000000000000&quot;</span>):</span><br><span class="line">        r.sendline(<span class="string">b&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.recvline())</span><br><span class="line"><span class="comment">#flag&#123;7b106778-5048-4d9d-bd30-84cfc7d5b48e&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Hard</span></span><br><span class="line"><span class="comment">#challenge4</span></span><br><span class="line">r.recvuntil(<span class="string">b&quot;solving 4? &gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">33</span>):</span><br><span class="line">    temp = [<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#first</span></span><br><span class="line">    r.recvuntil(<span class="string">b&quot;msg? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;0&quot;</span> * <span class="number">32</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;inverse? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;n&quot;</span>)</span><br><span class="line">    temp[<span class="number">0</span>] = r.recvline().strip().decode()</span><br><span class="line">    <span class="comment">#second</span></span><br><span class="line">    r.recvuntil(<span class="string">b&quot;msg? &gt;&quot;</span>)</span><br><span class="line">    r.sendline((temp[<span class="number">0</span>]+<span class="string">&quot;0&quot;</span>*<span class="number">16</span>).encode())</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;inverse? &gt;&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&quot;y&quot;</span>)</span><br><span class="line">    temp[<span class="number">1</span>] = r.recvline().strip().decode()</span><br><span class="line">    <span class="comment">#third</span></span><br><span class="line">    <span class="keyword">if</span>(temp[<span class="number">1</span>] == <span class="string">&quot;0000000000000000&quot;</span>):</span><br><span class="line">        r.sendline(<span class="string">b&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#challenge5</span></span><br><span class="line">r.recvuntil(<span class="string">b&quot;solving 5? &gt; &quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;48&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">33</span>):</span><br><span class="line">    dic = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>):</span><br><span class="line">        r.recvuntil(<span class="string">b&quot;msg? &gt;&quot;</span>)</span><br><span class="line">        r.sendline((<span class="built_in">hex</span>(j)[<span class="number">2</span>:].zfill(<span class="number">2</span>).encode()))</span><br><span class="line">        r.recvuntil(<span class="string">b&quot;inverse? &gt;&quot;</span>)</span><br><span class="line">        r.sendline(<span class="string">b&quot;n&quot;</span>)</span><br><span class="line">        temp = r.recvline().strip().decode()</span><br><span class="line">        dic[temp] = j</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(dic) == <span class="number">48</span>):</span><br><span class="line">        r.sendline(<span class="string">b&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;u_4re_Prf&amp;Pr9_M4st3r!#28a3gg31_82jf124d3_3842sa16ds29&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>糖醋小鸡块
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tangcuxiaojikuai.xyz/post/9e0dbdd4.html" title="2023-NewStarCTF-wp-crypto">https://tangcuxiaojikuai.xyz/post/9e0dbdd4.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sacreative/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SACREATIVE</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/e872e217.html" rel="prev" title="2023-鹏城杯-wp-crypto">
      <i class="fa fa-chevron-left"></i> 2023-鹏城杯-wp-crypto
    </a></div>
      <div class="post-nav-item">
    <a href="/post/a6ed3bb1.html" rel="next" title="Thoughts">
      Thoughts <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Week-1"><span class="nav-number">1.</span> <span class="nav-text">Week 1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Week-2"><span class="nav-number">2.</span> <span class="nav-text">Week 2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#partial-decrypt"><span class="nav-number">2.1.</span> <span class="nav-text">partial decrypt</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Week-3"><span class="nav-number">3.</span> <span class="nav-text">Week 3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Rabin%E2%80%99s-RSA"><span class="nav-number">3.1.</span> <span class="nav-text">Rabin’s RSA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E6%98%8E%E7%9A%84%E5%AF%86%E7%A0%81%E9%A2%98"><span class="nav-number">3.2.</span> <span class="nav-text">小明的密码题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babyrandom"><span class="nav-number">3.3.</span> <span class="nav-text">babyrandom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#knapsack"><span class="nav-number">3.4.</span> <span class="nav-text">knapsack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Door"><span class="nav-number">3.5.</span> <span class="nav-text">Door</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%A1%AB%E5%85%85"><span class="nav-number">3.5.1.</span> <span class="nav-text">解填充</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%84%E8%A8%80%E5%A1%AB%E5%85%85%E6%94%BB%E5%87%BB"><span class="nav-number">3.5.2.</span> <span class="nav-text">预言填充攻击</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#eazy-crt"><span class="nav-number">3.6.</span> <span class="nav-text">eazy_crt</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Week-4"><span class="nav-number">4.</span> <span class="nav-text">Week 4</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RSA-Variation-II"><span class="nav-number">4.1.</span> <span class="nav-text">RSA Variation II</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babyNTRU"><span class="nav-number">4.2.</span> <span class="nav-text">babyNTRU</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Smart"><span class="nav-number">4.3.</span> <span class="nav-text">Smart</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#signin"><span class="nav-number">4.4.</span> <span class="nav-text">signin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#error"><span class="nav-number">4.5.</span> <span class="nav-text">error</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Week-5"><span class="nav-number">5.</span> <span class="nav-text">Week 5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#last-signin"><span class="nav-number">5.1.</span> <span class="nav-text">last_signin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#School-of-CRC32"><span class="nav-number">5.2.</span> <span class="nav-text">School of CRC32</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PseudoHell-EASY-PseudoHell-HARD"><span class="nav-number">5.3.</span> <span class="nav-text">PseudoHell_EASY&#x2F;PseudoHell_HARD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#challenge-1"><span class="nav-number">5.3.1.</span> <span class="nav-text">challenge 1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#challenge-2"><span class="nav-number">5.3.2.</span> <span class="nav-text">challenge 2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#challenge-3"><span class="nav-number">5.3.3.</span> <span class="nav-text">challenge 3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#challenge-4"><span class="nav-number">5.3.4.</span> <span class="nav-text">challenge 4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#challenge-5"><span class="nav-number">5.3.5.</span> <span class="nav-text">challenge 5</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="糖醋小鸡块"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">糖醋小鸡块</p>
  <div class="site-description" itemprop="description">"追风赶月莫停留，平芜尽处是春山"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">70</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/1142381085@qq.com" title="E-Mail → 1142381085@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6394335993" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6394335993" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">糖醋小鸡块</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UPEMA7DyYbIIEyOW72ohgytU-gzGzoHsz',
      appKey     : 'M7rXAfeP3JOslroay2n0Jv2R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
